Springer Texts in Statistics
Advisors: George Casella Stephen Fienberg Ingram Olkin

Springer Texts in Statistics
AJfred: Elements of Statistics for the Life and Social Sciences Berger: An Introduction to Probability and Stochastic Processes Bilodeau and Brenner: Theory of Multivariate Statistics BIom: Probability and Statistics: Theory and Applications Brockwell and Davis: Introduction to Times Series and Forecasting,
Second Edition Chow and Teicher: Probability Theory: Independence, Interchangeability,
Martingales, Third Edition Christensen: Advanced Linear Modeling: Multivariate, Time Series, and
Spatial Data; Nonparametric Regression and Response Surface Maximization, Second Edition
Christensen: Log-Linear Models and Logistic Regression, Second Edition Christensen: Plane Answers to Complex Questions: The Theory of Linear
Models, Third Edition Creighton: A First Course in Probability Models and Statistical Inference Davis: Statistical Methods for the Analysis of Repeated Measurements Dean and Voss: Design and Analysis of Experiments du Toit, Steyn, and Stumpf Graphical Exploratory Data Analysis Durrett: Essentials of Stochastic Processes Edwards: Introduction to Graphical Modelling, Second Edition Finkelstein and Levin: Statistics for Lawyers Flury: A First Course in Multivariate Statistics Jobson: Applied Multivariate Data Analysis, Volume I: Regression and
Experimental Design Jobson: Applied Multivariate Data Analysis, Volume II: Categorical and
Multivariate Methods Kalbfleisch: Probability and Statistical Inference, Volume I: Probability,
Second Edition Kalbfleisch: Probability and Statistical Inference, Volume II : Statistical Inference,
Second Edition Karr: Probability Keyfitz: Applied Mathematical Demography, Second Edition Kiefer: Introduction to Statistical Inference Kokoska and Nevison: Statistical Tables and Fonnulae Kulkarni: Modeling, Analysis, Design, and Control of Stochastic Systems Lange: Applied Probability Lehmann: Elements of Large-Sample Theory Lehmann: Testing Statistical Hypotheses, Second Edition Lehmann and Casella: Theory of Point Estimation, Second Edition Lindman: Analysis of Variance in Experimental Design Lindsey: Applying Generalized LinearModels
(continued after index)

Larry Wassennan
All of Statistics
A Concise Course in Statistical Inference
With 95 Figures
, Springer

Larry Wassennan Department of Statistics Carnegie Mellon University Baker Hali 228A Pittsburgh, PA 15213-3890 USA larry@ stat.cmu.edu

Editorial Board
George Casella Department of Statistics University of Florida Gainesville, FL 32611-8545 USA

Stephen Fienberg Department of Statistics Carnegie Mellon University Pittsburgh, PA 15213-3890 USA

Ingram Olkin Department of Statistics Stanford University Stanford, CA 94305 USA

Library of Congress Cataloging-in-Publication Data Wasserman, Larry A. (Larry Alan), 1959-
All of statistics: a concise course in statistica! inference 1Larry a. Wasserman. p. cm. - (Springer texts in statistics)
Includes bibliographical references and index.

1. Mathematical statistics. 1. Title. Il. Series. QA276.12.W37 2003 519.5-dc21

2003062209

ISBN 978-1-4419-2322-6

ISBN 978-0-387-21736-9 (eBook)

DOI 10.1007/978-0-387-21736-9

© 2004 Springer Science+Business Media New York Originally published by Springer Science+Business Media, !ne in 2004
Softcover reprint of the hardcover 1st edition 2004 All rights reserved. This work may not be translated or copied in whole or in part without the written permission of the publisher (Springer Science+Business Media, LLC ), except for brief excerpts in connection with reviews or scholarly analysis. Use in connection with any form of information storage and retrieval, electronic adaptation, computer software, or by similar or dissimilar methodology now known or hereafter developed is forbidden. The use in this publication of trade names, trademarks, service marks, and similar terms, even if they are not identified as such, is not to be taken as an expression of opinion as to whether or not they are subject to proprietary rights.

9 8 7 6 5 4 3 (Corrected second printing, 2005) springeronline.com

To Isa

Preface
Taken literally, the title "All of Statistics" is an exaggeration. But in spirit, the title is apt, as the book does cover a much broader range of topics than a typical introductory book on mathematical statistics.
This book is for people who want to learn probability and statistics quickly. It is suitable for graduate or advanced undergraduate students in computer science, mathematics, statistics, and related disciplines. The book includes modern topics like nonparametric curve estimation, bootstrapping, and classification, topics that are usually relegated to follow-up courses. The reader is presumed to know calculus and a little linear algebra. No previous knowledge of probability and statistics is required.
Statistics, data mining, and machine learning are all concerned with collecting and analyzing data. For some time, statistics research was conducted in statistics departments while data mining and machine learning research was conducted in computer science departments. Statisticians thought that computer scientists were reinventing the wheel. Computer scientists thought that statistical theory didn't apply to their problems.
Things are changing. Statisticians now recognize that computer scientists are making novel contributions while computer scientists now recognize the generality of statistical theory and methodology. Clever data mining algorithms are more scalable than statisticians ever thought possible. Formal statistical theory is more pervasive than computer scientists had realized.
Students who analyze data, or who aspire to develop new methods for analyzing data, should be well grounded in basic probability and mathematical statistics. Using fancy tools like neural nets, boosting, and support vector

viii Preface
machines without understanding basic statistics is like doing brain surgery before knowing how to use a band-aid.
But where can students learn basic probability and statistics quickly? Nowhere. At least, that was my conclusion when my computer science colleagues kept asking me: "Where can I send my students to get a good understanding of modern statistics quickly?" The typical mathematical statistics course spends too much time on tedious and uninspiring topics (counting methods, two dimensional integrals, etc.) at the expense of covering modern concepts (bootstrapping, curve estimation, graphical models, etc. ). So I set out to redesign our undergraduate honors course on probability and mathematical statistics. This book arose from that course. Here is a summary of the main features of this book.
1. The book is suitable for graduate students in computer science and honors undergraduates in math, statistics, and computer science. It is also useful for students beginning graduate work in statistics who need to fill in t heir background on mathematical statistics.
2. I cover advanced topics that are traditionally not taught in a first course. For example, nonparametr ic regression, bootstrapping, density estimation, and graphical models.
3. I have omitted topics in probability that do not play a central role in statistical inference. For example, counting methods are virtually absent.
4. Whenever possible, I avoid tedious calculations in favor of emphasizing concepts.
5. I cover nonparametric inference before parametric inference.
6. I abandon the usual "First Term = Probability" and "Second Term = Statistics" approach . Some students only take the fi rst half and it would be a crime if they did not see any statistical theory. Furthermore, probability is more engaging when students can see it put to work in the context of statistics. An exception is the topic of stochastic processes which is included ill the later material.
7. T he course moves very quickly and covers much material . My colleagues joke t hat I cover all of statistics in this course and hence the title. The course is demanding but I have worked hard to make the material as intuitive as possible so t hat the material is very understandable despite the fast pace.
8. Rigor and clarity are not synonymous. I have tried to strike a good balance. To avoid getting bogged down in uninteresting technical details, many results are stated without proof. The bibliographic references at the end of each chapter point the student to appropriate sources.

Preface ix

Probability

Data generating process

C

~ Ob.e""d data

~------------~ Inference and Data Mining

FIGURE L Probability and inference.
9. On my website are files with R code which students can use for doing all the computing. The website is:
http://www.stat.cmu.eduf''-'larry/all-of-statistics
However, the book is not tied to R and any computing language can be used.
Part I of the text is concerned with probability theory, the formal language of uncertainty which is the basis of statistical inference. The basic problem that we study in probability is:
Given a data generating process, what are the properties of the outcomes?
Part II is about statistical inference and its close cousins, data mining and machine learning. The basic problem of statistical inference is the inverse of probability:
Given the outcomes, what can we say about the process that generated the data?
These ideas are illustrated in Figure 1. Prediction, classification , clustering, and estimation are all special cases of statistical inference. Data analysis, machine learning and data mining are various names given to t he practice of statistical inference, depending on the context.

x Preface
Part III applies the ideas from Part II to specific problems such as regression, graphical models, causation, density est imation, smoothing, classifica~ t ion , and simulation. Part III contains one more chaptcr on probability that covers stochastic processes including Markov chains.
I have drawn on other books in many places. Most chapters contain a section called Bibliographic Remarks which serves both to acknowledge my debt to other authors and to point readers to other useful references. I would especially like to mention t he books by DeGroot and Schervish (2002) and Grimmett and Stirzaker (1982) from which I adapted many examples and exercises.
As one develops a book ovcr several years it is easy to lose track of where presentation ideas and, especially, homework problems originated. Some I made up. Some I remembered from my education. Some I borrowed from other books. I hope I do not offend anyone if I have used a problem from their book and failed to give proper credit . As my colleague Mark Schervish wrote in his book (Schcrvish (1995)),
"... the problems at the ends of each chapter have come from many sources.... These problems, in turn , came from various sources unknown to me ... If I have used a problem without giving proper credit, please take it as a compliment."
I am indebted to many people without whose help I could not have written t his book. First and foremost , the many students who used earlier versions of t his text and provided much feedback . In particular, Liz P rather and Jen~ nifer Bakal read t he book carefully. Rob Reeder valiantly read t hrough the entire book in excruciating detail and gave me countless suggestions for im~ provements. Chris Genovese deserves special mention. He not only provided helpful ideas about intellectual content, but also spent many, many hours writing ~'IEXcode for t he book. The best aspects of the book's layout are due to his hard work; any stylistic deficiencies are due to my lack of expertise. David Hand , Sam Roweis, and David Scott read the book very carefully and made numerous suggestions that greatly improved t he book. J ohn Lafferty and Peter Spirtes also provided helpful feedback. John Kimmel has been supportive and helpful throughout t he writing process. Finally, my wife Isabella Verdinelli has been an invaluable source of love, support, and inspiration.
Larry Wasserman Pittsburgh, Pennsylvania
July 2003

Preface Xl
Statistics/Data Mining Dictionary
Statisticians and computer scientists often use different language for the same thing. Here is a dictionary that the reader may want to return to throughout the course.

Statistics estimation classification clustering data covariates classifier hypothesis confidence interval
directed acyclic graph
Bayesian inference
frequentist inference
large deviation bounds

Computer Science learning supervised learning unsupervised learning training sample features hypothesis
Bayes net Bayesian inference
PAC learning

Meaning using data to estimate
an unknown quantity predicting a discrete Y
from X putting data into groups (Xl, Yd,· .. ,(Xn , Yn ) the Xi'S a map from covariates
to outcomes subset of a parameter
space e
interval that contains an unknown quantity with given frequency
multivariate distribution with given conditional independence relations
statistical methods for using data to update beliefs
statistical methods with guaranteed frequency behavior
uniform bounds on probability of errors

Contents

I Probability

1 Probability

3

1.1 Introduction . . . . . . . . .

3

1.2 Sample Spaces and Events .

3

1.3 Probability . . . . . . . . .

5

1.4 Probability on Finite Sample Spaces

7

1.5 Independent Events ..

8

1.6 Conditional Probability

10

1.7 Bayes' Theorem ... .

12

1.8 Bibliographic Remarks

13

1.9 Appendix

13

1.10 Exercises . . . .

13

2 Random Variables

19

2.1 Introduction . . .

19

2.2 Distribution Functions and Probability Functions

20

2.3 Some Important Discrete Random Variables . .

25

2.4 Some Important Continuous Random Variables

27

2.5 Bivariate Distributions . . . . .

31

2.6 Marginal Distributions . . . . .

33

2.7 Independent Random Variables

34

2.8 Conditional Distributions . . .

36

xiv Contents

2.9 Multivariate Distributions and lID Samples

38

2.10 Two Important Multivariate Distributions .

39

2.11 Transformations of Random Variables . . .

41

2.12 Transformations of Several Random Variables

42

2.13 Appendix

43

2.14 Exercises

43

3 Expectation

47

3.1 Expectation of a Random Variable

47

3.2 Properties of Expectations . . . . .

50

3.3 Variance and Covariance . . . . . .

50

3.4 Expectation and Variance of Important Random Variables.

52

3.5 Conditional Expectation . . . .

54

3.6 Moment Generating Functions

56

3.7 Appendix

58

3.8 Exercises

58

4 Inequalities

63

4.1 Probability Inequalities

63

4.2 Inequalities For Expectations

66

4.3 Bibliographic Remarks

66

4.4 Appendix

67

4.5 Exercises

68

5 Convergence of Random Variables

71

5.1 Introduction . . . . . . . . .

71

5.2 Types of Convergence .. .

72

5.3 The Law of Large Numbers

76

5.4 The Central Limit Theorem

77

5.5 The Delta Method . .

79

5.6 Bibliographic Remarks . . .

80

5.7 Appendix . . . . . . . . . .

81

5.7.1 Almost Sure and L1 Convergence.

81

5.7.2 Proof of the Central Limit Theorem

81

5.8 Exercises . . . . . . . . . . . . . . . . . . .

82

II Statistical Inference

6 Models, Statistical Inference and Learning

87

6.1 Introduction .. .. . . . . . . . . . . . .

87

6.2 Parametric and Nonparametric Models.

87

6.3 Fundamental Concepts in Inference .

90

6.3.1 Point Estimation

90

6.3.2 Confidence Sets . . . . . .. .

92

Contents xv

6.3.3 Hypothesis Testing

94

6.4 Bibliographic Remarks

95

6.5 Appendix

95

6.6 Exercises . . . . . . . .

95

7 Estimating the CDF and Statistical Functionals

97

7.1 The Empirical Distribution Function

97

7.2 Statistical F\mctionals .

99

7.3 Bibliographic Remarks .

104

7.4 Exercises .

104

8 The Bootstrap

107

8.1 Simulation.

108

8.2 Bootstrap Variance Estimation

108

8.3 Bootstrap Confidence Intervals

110

8.4 Bibliographic Remarks

115

8.5 Appendix . . .

1I5

8.5.1 The Jackknife .

1I5

8.5 .2 Justification For The Percentile Interval

1I6

8.6 Exercises .

1I6

9 Parametric Inference

119

9.1 Parameter of Interest.

120

9.2 The Method of Moments. . .....

120

9.3 Maximum Likelihood.

122

9.4 Properties of Maximum Likelihood Estimators

124

9.5 Consistency of Maximum Likelihood Estimators .

126

9.6 Equivariance of the MLE

127

9.7 Asymptotic Normality

128

9.8 Optimality . . . .

130

9.9 The Delta Method

131

9.10 Multiparameter Models

133

9.11 The Parametric Bootstrap.

134

9.12 Checking Assumptions

135

9.13 Appendix .... .

135

9.13.1 Proofs . . . . .

135

9.13.2 Sufficiency .. .

137

9.13.3 Exponential Families .

140

9.13.4 Computing Maximum Likelihood Estimates

142

9.14 Exercises

146

10 Hypothesis Testing and p-values

149

10.1 The Wald Test . .

152

10.2 p-vaiues . . . . .

156

10.3 The X2 Distribution

159

xvi Contents

10.4 Pearson's X2 Test For Multinomial Data

160

10.5 The Permutation Test . . .

161

10.6 The Likelihood Ratio Test .

164

10.7 Multiple Testing . . . .

165

10.8 Goodness-of-fit Tests ..

168

10.9 Bibliographic Remarks .

169

1O.lOAppendix . . . . . . . .

170

10.10.1 The Neyman-Pearson Lemma.

170

10.10.2 The t-test

170

10.11Exercises . . . .

170

11 Bayesian Inference

175

11.1 The Bayesian Philosophy

175

11.2 The Bayesian Method .

176

11.3 Functions of Parameters .

180

11.4 Simulation. . . . . . . . .

180

11.5 Large Sample Properties of Bayes' Procedures.

181

11.6 Flat Priors, Improper Priors, and "Noninformative" Priors. 181

11.7 Multiparameter Problems . . . . . . . . . . . . .

183

11.8 Bayesian Testing . . . . . . . . . . . . . . . . . . 184

11.9 Strengths and Weaknesses of Bayesian Inference

185

11.10Bibliographic Remarks.

189

11.11Appendix

190

11.12Exercises . . . . . . . .

190

12 Statistical Decision Theory 12.1 Preliminaries . . . . . . . 12.2 Comparing Risk Functions. 12.3 Bayes Estimators . . . . . . 12.4 Minimax Rules . . . . . . . 12.5 Maximum Likelihood, Minimax, and Bayes 12.6 Admissibility . . . . . . 12.7 Stein's Paradox . . . . . 12.8 Bibliographic Remarks . 12.9 Exercises . . . . . .. .

193 193 194 197 198 .201 · 202 · 204 · 204 · 204

III Statistical Models and Methods
13 Linear and Logistic Regression 13.1 Simple Linear Regression . . . . . . . . . . 13.2 Least Squares and Maximum Likelihood . . 13.3 Properties of the Least Squares Estimators 13.4 Prediction . . . . . . 13.5 Multiple Regression . . . . . . . . . . . . .

209 · 209 · 212 · 214 · 215 · 216

Contents xvii

13.6 Model Selection . . . . . 13.7 Logistic Regression . . . 13.8 Bibliographic Remarks . 13.9 Appendix 13.lOExercises .....

· 218 · 223 · 225 · 225 · 226

14 Multivariate Models 14.1 Random Vectors . . . . . . 14.2 Estimating the Correlation 14.3 Multivariate Normal . . 14.4 Multinomial . . . . .. . 14.5 Bibliographic Remarks . 14.6 Appendix 14.7 Exercises . . . . . . . .

231 232
· 233 · 234 · 235 · 237 · 237 · 238

15 Inference About Independence 15.1 Two Binary Variables .. . 15.2 Two Discrete Variables . . . . . 15.3 Two Continuous Variables .. . 15.4 One Continuous Variable and One Discrete 15.5 Appendix 15.6 Exercises ..

239 239 · 243 · 244 · 244 · 245 · 248

16 Causal Inference 16.1 The Counterfactual Model. 16.2 Beyond Binary Treatments . . . . . . . 16.3 Observational Studies and Confounding 16.4 Simpson's Paradox . . 16.5 Bibliographic Remarks 16.6 Exercises . . . . .. .

251 · 251
255 257 259 261 · 261

17 Directed Graphs and Conditional Independence 17.1 Introduction . . . . . . . . 17.2 Conditional Independence 17.3 DAGs . . . . . . . . . . . 17.4 Probability and DAGs . . 17.5 More Independence Relations 17.6 Estimation for DAGs . . 17.7 Bibliographic Remarks . 17.8 Appendix 17.9 Exercises . . . .

263 · 263 · 264 · 264 · 266 · 267 · 272 .272
272 · 276

18 Undirected Graphs 18.1 Undirected Graphs 18.2 Probability and Graphs

281 · 281 · 282

xviii Contents

18.3 Cliques and Potentials

285

18.4 Fitting Graphs to Data

286

18.5 Bibliographic Remarks .

286

18.6 Exercises . . ..

286

19 Log-Linear Models 19.1 The Log-Linear Model . . . . . 19.2 Graphical Log-Linear Models . 19.3 Hierarchical Log-Linear Models 19.4 Model Generators . . . . . . . . 19.5 Fitting Log-Linear Models to Data 19.6 Bibliographic Remarks 19.7 Exercises . . . . . . . . . . . . .

291 . 291 . 294 . 296 . 297 . 298 . 300 . 301

20 N onparametric Curve Estimation 20.1 The Bias-Variance Tradeoff 20.2 Histograms . . . . . . . . . 20.3 Kernel Density Estimation. 20.4 Nonparametric Regression 20.5 Appendix . . . . . . . 20.6 Bibliographic Remarks 20.7 Exercises . . . . . . .

303 . 304 . 305 . 312 . 319 . 324 . 325 . 325

21 Smoothing Using Orthogonal Functions 21.1 Orthogonal Functions and L2 Spaces 21.2 Density Estimation. 21.3 Regression. 21.4 Wavelets . . . . . . . 21.5 Appendix . . . . . . 21.6 Bibliographic Remarks . 21. 7 Exercises . . . . . . . .

327 . 327 . 331 . 335 . 340 . 345 . 346 . 346

22 Classification

349

22.1 Introduction . . . . . . . . . . . . . .

. 349

22.2 Error Rates and the Bayes Classifier.

. 350

22.3 Gaussian and Linear Classifiers. . . .

. 353

22.4 Linear Regression and Logistic Regression

. 356

22.5 Relationship Between Logistic Regression and LDA

. 358

22.6 Density Estimation and Naive Bayes . . . . . . . . .

. 359

22.7 Trees . . . . . . . . . . . . . . . . . . . . . . . . . 36.0

.

22.8 Assessing Error Rates and Choosing a Good Classifier .

. 362

22.9 Support Vector Machines

. 368

22.10 Kernelization . . . . . .

. 371

22.11 Other Classifiers . . . .

. 375

22.12 Bibliographic Remarks

. 377

Contents xix

22.13 Exercises . . . . . . . . . . . . . . . . . .

.377

23 Probability Redux: Stochastic Processes 23.1 Introduction . . . . 23.2 Markov Chains . . . . 23.3 Poisson Processes . . . 23.4 Bibliographic Remarks 23.5 Exercises .. ...

381 · 381 · 383 · 394 · 397 · 398

24 Simulation Methods 24.1 Bayesian Inference Revisited . 24.2 Basic Monte Carlo Integration 24.3 Importance Sampling. . . . . . 24.4 MCMC Part I: The Metropolis- Hastings Algorithm 24.5 MCMC Part II: Different Flavors 24.6 Bibliographic Remarks . 24.7 Exercises . . . . . . . . . . . . .

403 .403 .404 .408 · 411 · 415 · 420 .420

Index

434

Part I
Probability

1
Probability
1.1 Introduction
Probability is a mathematical language for quantifying uncertainty. In this Chapter we introduce the basic concepts underlying probability theory. We begin with the sample space, which is the set of possible outcomes.
1.2 Sample Spaces and Events The sample space n is the set of possible outcomes of an experiment. Points w in n are called sample outcomes, realizations, or elements. Subsets of n are called Events.
n 1.1 Example. If we toss a coin twice then = {HH, HT, T H, TT}. The event
that the first toss is heads is A = {HH, HT} .·
1.2 Example. Let w be the outcome of a measurement of some physical quan-
tity, for example, temperature. Then n = IR = (-00,00). One could argue that taking n = IR is not accurate since temperature has a lower bound. But there
is usually no harm in taking the sample space to be larger than needed. The event that the measurement is larger than 10 but less than or equal to 23 is
A = (10, 23] .·

4 1. Probability

1.3 Example. If we toss a coin forever , then the sample space is the infinite set
n = = {W (WI,W2,W3 , ... ,): Wi E {H,T}}.
Let E be the event that the first head appears on the third toss. Then

= { E

(WI, W2, W3, . . . ,) :

WI = T, W2 = T, W3 = H,

Wi E {H, T} for i > 3}.

·

Given an event A, let AC = {w En: W 1:. A} denote the complement of
n A. Informally, ACcan be read as "not A." The complement of is the empty
set 0. The union of events A and B is defined

AU B = {w En: W E A or wEB or W E both}

which can be thought of as "A or B." If AI, A2 , .. . is a sequence of sets then
U00 A i = {W En: W E Ai for at least one i}.
i=l
The intersection of A and B is

read "A and B ." Sometimes we write An Bas AB or (A, B) . If AI , A2 , .. . is a sequence of sets then
n00 Ai = {W En: W E A i for all i}.
i=l
The set difference is defined by A - B = {w: W E A,W 1:. B}. If every element of A is also contained in B we write A c B or, equivalently, B J A. If A is a
finite set, let IAI denote the number of elements in A. See the following table
for a summary.

Summary of Terminology

sample space

W

outcome (point or element)

A

event (subset of n)

AC

complement of A (not A)

AUB

union (A or B)

AnB or AB intersection (A and B)

A-B

set difference (w in A but not in B)

AcB
o
n

set inclusion null event (always false) true event (always true)

1.3 Probability 5
n We say t hat AI , A2, .. . are disjoint or are mutua lly exclusive if Ai Aj = owhenever i =F j . For example, Al = [0, 1), A2 = [1, 2), A3 = [2, 3) , .. . arc
disjoint . A partition of n i s asequence of disjoint sets A I, A 2, .. . such t hat U:I A i = n. Given an veent A , define t he indicator function of A by

A sequence of sets At, A2, .. . is monotone increasing if A t C A2 C
and we define lirnn .....oo A n = U: I Ai . A sequence of sets A t, A2 , ... is
n:monotone decreasing if A t ::l A2 ::l ... and then we define lirnn .....oo A n = 1 Ai· In either case, we will write A n --+ A.

1.4 Example. Let n = IR and Jet Ai = [0, l/i) fori = 1, 2, .... ThenU:l A i =

n: 1 [0, 1) and

Ai = {O}. If instead we define Ai = (0, I ii) then U:I Ai =

n: l (0, 1) and

Ai = 0 . ·

1.3 Probability
We will assign areal number IP(A) to every event A , called the probability of A. t We also call lP a probability distribution or a probability measure . To qualify as a probability, IP must satisfy three axioms:
1.5 Definition. A function IP that assigns a real number IP(A) to each event A is a probability dis tribution or a probability measure if it
° satisfies the following three axioms:
Axiom 1: IP(A) 2: for every A Axiom 2: iP'(n ) = 1 Axiom 3: If A I, A2, .. . are disjoint then

l it is not always possible to assign a probability to every event A if th e sample space is large. such as the whole real line. Instead. we assign probabil it ies to a limited class of set call ed a .,.·field. See the appendi:< for details.

6 1. Probability
There are many interpretations of IP'(A). The two common interpretations are frequencies and degrees of beliefs. In the frequency interpretation, IP'(A) is the long run proportion of times that A is true in repetitions. For example, if we say that the probability of heads is 1/2, we mean that if we flip the coin many times then the proportion of times we get heads tends to 1/2 as the number of tosses increases. An infinitely long, unpredictable sequence of tosses whose limiting proportion tends to a constant is an idealization, much like the idea of a straight line in geometry. The degree-of-belief interpretation is that IP'(A) measures an observer's strength of belief that A is true. In either interpretation, we require that Axioms 1 to 3 hold. The difference in interpretation will not matter much until we deal with statistical inference. There, the differing interpretations lead to two schools of inference: the frequentist and the Bayesian schools. We defer discussion until Chapter 11.
One can derive many properties of IP' from the axioms, such as:

IP'( 0) AcB
o~
IP'( A C) An B =0

===?
IP'(A)
===}

0 IP'(A) ~ IP'(B)
~1
1 -IP'(A)
U IP' (A B) = IP'(A) + IP'(B).

(1.1 )

A less obvious property is given in the following Lemma.

1.6 lemma. For any events A and B,
U IP' (A B) = IP'(A) + IP'(B) -IP'(AB).

PROOF. Write AUB = (ABC) U(AB) U(ACB) and note that these events
are disjoint. Hence, making repeated use of the fact that IP' is additive for disjoint events, we see that

U IP' (A B)

B)) IP' ((ABC) U(AB) U(AC

= IP'(ABC) + IP'(AB) + IP'(ACB)

= IP'(ABC) + IP'(AB) + IP'(ACB) + IP'(AB) - IP'(AB)

P ((ABC) U(AB)) + IP' ((ACB) U(AB)) -IP'(AB) IP'(A) + IP'(B) -IP'(AB). ·

1.7 Example. Two coin tosses. Let HI be the event that heads occurs on toss 1 and let H2 be the event that heads occurs on toss 2. If all outcomes are

1.4 Probability on Finite Sample Spaces 7
·
1.8 Theorem (Continuity of Probabilities). If An ~ A then
as n ~ 00. PROOF. Suppose that An is monotone increasing so that Al C A2 C ....
Let A = limn -+oo An = U:I Ai. Define BI = AI, B2 = {w En: W E
A2 , w rJ. AI}, B3 = {w En: W E A3,w rJ. A2 ,w rJ. AI}, ... It can be
shown that B I , B 2 , ... are disjoint, An = U~=l Ai = U~=l Bi for each nand U:I Bi = U:I Ai· (See exercise 1.) From Axiom 3,
and hence, using Axiom 3 again,
1.4 Probability on Finite Sample Spaces Suppose that the sample space n = {WI, ... ,wn } is finite. For example, if we toss a die twice, then n has 36 elements: n = {(i,j); i,j E {I, ... 6}}. If each
outcome is equally likely, then ]peA) = IAI/36 where IAI denotes the number
of elements in A. The probability that the sum of the dice is 11 is 2/ 36 since there are two outcomes that correspond to this event.
If n is finite and if each outcome is equally likely, then
]peA) = TIAnIT'
which is called the uniform probability distribution. To compute probabilities, we need to count the number of points in an event A. Methods for counting points are called combinatorial methods. We needn't delve into these in any great detail. We will, however, need a few facts from counting theory that will be useful later. Given n objects, the number of ways of ordering

8 1. Probability

these objects is n! = n(n - 1)(n - 2)···3·2· 1. For convenience, we define

O! = 1. We also define

(

n) k

-

n! k!(n-k)!'

(1.2)

read "n choose k", which is the number of distinct ways of choosing k objects from n. For example, if we have a class of 20 people and we want to select a committee of 3 students, then there are

( 20) = 3

20! = 3!17!

20 x 19 x 18 = 3 x 2x1

1140

possible committees. We note the following properties:

1.5 Independent Events

If we flip a fair coin twice, then the probability of two heads is ~ x ~. We multiply the probabilities because we regard the two tosses as independent. The formal definition of independence is as follows:

1.9 Definition. Two events A and B are independent if

JP'(AB) = JP'(A)JP'(B)

(1.3)

and we write A Il B. A set of events {Ai: i E I} is independent if

for every finite subset J of I. If A and B are not independent, we write
A~B
Independence can arise in two distinct ways. Sometimes, we explicitly assume that two events are independent. For example, in tossing a coin twice, we usually assume the tosses are independent which reflects the fact that the coin has no memory of the first toss. In other instances, we derive indepen-
dence by verifying that JP'(AB) = JP'(A)JP'(B) holds. For example, in tossing
a fair die, let A = {2,4,6} and let B = {1,2,3,4}. Then, AnB = {2,4},

1.5 Independent Events 9

IP'(AB) = 2/6 = IP'(A)IP'(B) = (1/2) X (2/3) and so A and B are independent. In this case, we didn't assume that A and B are independent - it just turned out that they were.
Suppose that A and B are disjoint events, each with positive probability.
Can they be independent? No. This follows since IP'(A)IP'(B) > 0 yet IP'(AB) = 1P'(0) = O. Except in this special case, there is no way to judge independence
by looking at the sets in a Venn diagram.

1.10 Example. Toss a fair coin 10 times. Let A ="at least one head." Let Tj be the event that tails occurs on the jth toss. Then

IP'(A)

1 -1P'(AC)

1 - 1P'(all tails)

1 -1P'(T1T2 ... TlO )

1 -1P'(TdlP'(T2) .. ·1P'(TlO )
(1) 1-"2 lO ~ .999. -

using independence

1.11 Example. Two people take turns trying to sink a basketball into a net. Person 1 succeeds with probability 1/3 while person 2 succeeds with probability 1/4. What is the probability that person 1 succeeds before person 2? Let E denote the event of interest. Let Aj be the event that the first success is by person 1 and that it occurs on trial number j. Note that AI, A2 , ·.· are
disjoint and that E = Uj:1 Aj . Hence,
00
IP'(E) = LIP'(Aj).
j=l
Now, IP'(A1) = 1/3. A2 occurs if we have the sequence person 1 misses, person 2 misses, person 1 succeeds. This has probability IP'(A2) = (2/3)(3/4)(1/3) = (1/2)(1/3). Following this logic we see that IP'(Aj) = (1/2)j-1(1/3). Hence,

L L IP'(E) = 00 31 "(21)j-1 = 31 00 (1"2)j-1

2 3

j=l

j=l

Here we used that fact that, if 0 < r < 1 then L:j:k rj = rk /(1 - r). _

10 1. Probability Summary of Independence
1. A and B are independent if and only if IP'(AB) = IP'(A)IP'(B). 2. Independence is sometimes assumed and sometimes derived. 3. Disjoint events with positive probability are not independent.

1.6 Conditional Probability

Assuming that IP'(B) > 0, we define the conditional probability of A given
that B has occurred as follows:

1.12 Definition. IflP'(B) > 0 then the conditional probability of A

given B is

IP'(AIB) = IP'(AB)
IP'(B) .

(1.4)

Think of IP'(AIB) as the fraction of times A occurs among those in which
B occurs. For any fixed B such that IP'(B) > 0, IP'('IB) is a probability (i.e., it satisfies the three axioms of probability). In particular, IP'(AIB) ~ 0, 1P'(f2IB) = 1 and if At, A2 , ·.. are disjoint then IP'(U:l AiIB) = L::IIP'(AiIB). But it
is in general not true that IP'(AIB U C) = IP'(AIB) + IP'(AIC) . The rules of
probability apply to events on the left of the bar. In general it is not the case
that IP'(AIB) = IP'(BIA). People get this confused all the time. For example,
the probability of spots given you have measles is 1 but the probability that you have measles given that you have spots is not 1. In this case, the difference between IP'(AIB) and IP'(BIA) is obvious but there are cases where it is less obvious. This mistake is made often enough in legal cases that it is sometimes called the prosecutor's fallacy.
1.13 Example. A medical test for a disease D has outcomes + and -. The
probabilities are:
+ .009 .099
.001 .891

1.6 Conditional Probability 11

From the definition of conditional probability,

n JP'( +ID)

=

JP'(+ D) JP'(D)

=

.009.0+09.001

=

.9

and

n JP'(-IDC) = JP'( - DC) = .891 ~ .9.

JP'(Dc)

.891 + .099

Apparently, the test is fairly accurate. Sick people yield a positive 90 percent

of the time and healthy people yield a negative about 90 percent of the time.

Suppose you go for a test and get a positive. What is the probability you have

the disease? Most people answer .90. The correct answer is

n JP'(DI+) = JP'(+ D) = .009 ~ .08.

JP'( + )

.009 + .099

The lesson here is that you need to compute the answer numerically. Don't trust your intuition. _

The results in the next lemma follow directly from the definition of conditional probability.
1.14 Lemma. If A and B are independent events then JP'(AIB) = JP'(A). Also, for any pair of events A and B,
JP'(AB) = JP'(AIB)JP'(B) = JP'(BIA)JP'(A).
From the last lemma, we see that another interpretation of independence is
that knowing B doesn't change the probability of A. The formula JP'(AB) =
JP'(A)JP'(BIA) is sometimes helpful for calculating probabilities.
1.15 Example. Draw two cards from a deck, without replacement. Let A be the event that the first draw is the Ace of Clubs and let B be the event that
the second draw is the Queen of Diamonds. Then JP'(AB) = JP'(A)JP'(BIA) =
(1/52) x (1/51). _

Summary of Conditional Probability

1. If JP'(B) > 0, then

JP'(AIB) = JP'(AB) JP'(B) .

2. JP'(·IB) satisfies the axioms of probability, for fixed B. In general, JP'(AI·) does not satisfy the axioms of probability, for fixed A.

3. In general, JP'(AIB) -=I- JP'(BIA).

12 1. Probability
4. A and B are independent if and only if IP'(AIB) = IP'(A).

1.7 Bayes' Theorem
Bayes' theorem is the basis of "expert systems" and "Bayes' nets," which are discussed in Chapter 17. First, we need a preliminary result.
1.16 Theorem (The Law of Total Probability). Let Al , ... , Ak be a partition of 0.. Then, for any event B,
k
IP'(B) = LIP'(BIAi)IP'(Ai).
i=l
PROOF. Define OJ = BAj and note that 0 11 ... , Ok are disjoint and that
B = U;=l OJ. Hence,

j

j

j

since IP'(BAj) = IP'(BIAj)IP'(Aj) from the definition of conditional probability.
·

n 1.17 Theorem (Bayes' Theorem). Let A l , ... ,Ak be a partition of such
that IP'(Ai) > 0 for each i. If IP'(B) > 0 then, for each i = 1, ... ,k,

(1.5)

1.18 Remark. We call1P'(Ai) the prior probability of A and IP'(AiIB) the posterior probability of A.
PROOF. We apply the definition of conditional probability twice, followed by the law of total probability:

1.19 Example. I divide my email into three categories: Al = "spam," A2 =
"low priority" and A3 = "high priority." From previous experience I find that

1.8 Bibliographic Remarks 13

IP'(AI) = .7, IP'(A2) = .2 and IP'(A3) = .1. Of course, .7 +.2 +.1 = 1. Let B be
the event that the email contains the word "free." From previous experience,
IP'(BIAd = .9, IP'(BIA2) = .01, IP'(BIAd = .01. (Note: .9 + .01 + .01 -=I- 1.) I
receive an email with the word "free." What is the probability that it is spam? Bayes' theorem yields,

IP'(Al IB ) =

.9 x .7

= .995. ·

(.9 x .7) + (.01 x .2) + (.01 x .1)

1.8 Bibliographic Remarks
The material in this chapter is standard. Details can be found in any number of books. At the introductory level, there is DeGroot and Schervish (2002); at the intermediate level, Grimmett and Stirzaker (1982) and Karr (1993); at the advanced level there are Billingsley (1979) and Breiman (1992). I adapted many examples and exercises from DeGroot and Schervish (2002) and Grimmett and Stirzaker (1982).

1.9 Appendix

Generally, it is not feasible to assign probabilities to all subsets of a sample

space D. Instead, one restricts attention to a set of events called a a-algebra

or a a-field which is a class A that satisfies:

U: (i) 0 E A,
(ii) if AI, A2, ... , E A then

I Ai E A and

(iii) A E A implies that AC E A.

The sets in A are said to be measurable. We call (D, A) a measurable

space. If IP' is a probability measure defined on A, then (D, A, IP') is called a

probability space. When D is the real line, we take A to be the smallest

a-field that contains all the open subsets, which is called the Borel a-field.

1.10 Exercises
1. Fill in the details of the proof of Theorem 1.8. Also, prove the monotone decreasing case.
2. Prove the statements in equation (1.1).

14 1. Probability
n 3. Let be a sample space and let AI , A2, .. . , be events. Define Bn
U:n Ai and Cn = n:n Ai·
(a) Show that Bl J B2 J ... and that Cl C C2 C ... .
(b) Show that W E n:=l Bn if and only if w belongs to an infinite
number of the events Ab A2, . . ..
(c) Show that w E U:=l Cn if and only if w belongs to all the events
AI, A 2,·· . except possibly a finite number of those events.
4. Let {Ai: i E I} be a collection of events where I is an arbitrary index set. Show that

Hint: First prove this for I = {I , ... ,n}.
5. Suppose we toss a fair coin until we get exactly two heads. Describe the sample space S. What is the probability that exactly k tosses are required?
6. Let n = {O, 1, ... ,} . Prove that there does not exist a uniform distri-
n bution on (i.e. , if IF'(A) = IF'(B) whenever IAI = IBI, then IF' cannot
satisfy the axioms of probability).
7. Let Ab A 2, . .. be events. Show that

U:-: Hint: Define Bn = An -

Ai. Then show that the Bn are disjoint

and that U:=l An = U:=l Bn.

8. Suppose that IF'(Ai) = 1 for each i. Prove that

9. For fixed B such that IF'(B) > 0, show that IF'(-IB) satisfies the axioms
of probability.
10. You have probably heard it before. Now you can solve it rigorously. It is called the "Monty Hall Problem." A prize is placed at random

1.10 Exercises 15
behind one of three doors. You pick a door. To be concrete, let's suppose you always pick door 1. Now Monty Hall chooses one of the other two doors, opens it and shows you that it is empty. He then gives you the opportunity to keep your door or switch to the other unopened door. Should you stay or switch? Intuition suggests it doesn't matter. The correct answer is that you should switch. Prove it. It will help to specify
n the sample space and the relevant events carefully. Thus write =
{(Wl,W2): Wi E {1,2,3}} where Wl is where the prize is and W2 is the door Monty opens.
11. Suppose that A and B are independent events. Show that AC and B C are independent events.

12. There are three cards. The first is green on both sides, the second is red on both sides and the third is green on one side and red on the other. We choose a card at random and we see one side (also chosen at random) . If the side we see is green, what is the probability that the other side is also green? Many people intuitively answer 1/2. Show that the correct answer is 2/3.

13. Suppose that a fair coin is tossed repeatedly until both a head and tail have appeared at least once.
(a) Describe the sample space n.
(b) What is the probability that three tosses will be required?
14. Show that if peA) = 0 or peA) = 1 then A is independent of every other
event. Show that if A is independent of itself then peA) is either 0 or 1.

15. The probability that a child has blue eyes is 1/4. Assume independence between children. Consider a family with 3 children.
(a) If it is known that at least one child has blue eyes, what is the probability that at least two children have blue eyes?
(b) If it is known that the youngest child has blue eyes, what is the probability that at least two children have blue eyes?

16. Prove Lemma 1.14.

17. Show that

JP'(ABC) = JP'(AIBC)P(BIC)P(C).

16 1. Probability
18. Suppose k events form a partition of the sample space n, i.e., they
are disjoint and U7=I Ai = n. Assume that IP'(B) > O. Prove that if
IP'(AIIB) < IP'(AI) then IP'(AiIB) > IP'(Ai) for some i = 2, ... , k.
19. Suppose that 30 percent of computer owners use a Macintosh, 50 percent use Windows, and 20 percent use Linux. Suppose that 65 percent of the Mac users have succumbed to a computer virus, 82 percent of the Windows users get the virus, and 50 percent of the Linux users get the virus. We select a person at random and learn that her system was infected with the virus. What is the probability that she is a Windows user?
20. A box contains 5 coins and each has a different probability of showing heads. Let PI, .. . ,P5 denote the probability of heads on each coin. Suppose that
PI = 0, P2 = 1/4, P3 = 1/2, P4 = 3/4 and P5 = 1.
Let H denote "heads is obtained" and let Ci denote the event that coin i is selected.
(a) Select a coin at random and toss it. Suppose a head is obtained. What is the posterior probability that coin i was selected (i = 1, ... , 5)?
In other words, find IP'(CiIH) for i = 1, ... ,5.
(b) Toss the coin again. What is the probability of another head? In
other words find IP'(H2IHd where H j = "heads on toss j."
Now suppose that the experiment was carried out as follows: We select a coin at random and toss it until a head is obtained.
(c) Find IP'(Ci IB4) where B4 = "first head is obtained on toss 4."
21. (Computer Experiment.) Suppose a coin has probability P of falling heads up. If we flip the coin many times, we would expect the proportion of
heads to be near p. We will make this formal later. Take P = .3 and
n = 1,000 and simulate n coin flips. Plot the proportion of heads as a
function of n. Repeat for P = .03.
22. (Computer Experiment.) Suppose we flip a coin n times and let P denote the probability of heads. Let X be the number of heads. We call X a binomial random variable, which is discussed in the next chapter. Intuition suggests that X will be close to n p. To see if this is true, we can repeat this experiment many times and average the X values. Carry

1.10 Exercises 17
out a simulation and compare the average of the X's to n p . Try this for p =.3 and n = 10, n = 100, and n = 1,000.
23. (Computer Experiment.) Here we will get some experience simulating
conditional probabilities. Consider tossing a fair die. Let A = {2, 4, 6}
and B = {l, 2, 3, 4}. Then, lP'(A) = 1/2, lP'(B) = 2/3 and lP'(AB) = 1/3.
Since lP'(AB) = lP'(A)lP'(B), the events A and B are independent. Simu-
late draws from the sample space and verify that P(AB) = P(A)P(B) where P(A) is the proportion of times A occurred in the simulation and similarly for P(AB) and P(B). Now find two events A and B that are not independent. Compute P(A),P(B) and P(AB). Compare the calculated values to their theoretical values. Report your results and interpret.

2
Random Variables
2.1 Introduction
Statistics and data mining are concerned with data. How do we link sample spaces and events to data? The link is provided by the concept of a random variable.
2.1 Definition. A random variable is a mapping!
that assigns a real number X(w) to each outcome w.
At a certain point in most probability courses, the sample space is rarely mentioned anymore and we work directly with random variables. But you should keep in mind that the sample space is really there, lurking in the background. 2.2 Example. Flip a coin ten times. Let X(w) be the number of heads in the sequence w. For example, if w = HHTHHTHHTT, then X(w) = 6.·
1Technically, a random variable must be measurable. See the appendix for deta ils.

20 2. Random Variables
2.3 Example. Let n = { (X , y); x2 + y2 S I} be the unit disk. Consider drawing a point at random from n. (We will make t his idea more precise
later.) A typical outcome is of the form w = (x,y) . Some examples of random
variables are X(w) = x , Y(w) = y, Z(w) = x + y, and W(w) = Jx2 + y2 . ·

Given a random variable X and a subset A of the real line, define X - I (A) = {w En: X(w) E A} and let

PiX E A) ~ P(X-'(A)) ~ P«w E 11; X(w) E A)) PiX ~ x) ~ P(X - '(x)) ~ P({w E 11; X(w) ~ x)).

Notice t hat X denotes the random variable a nd x denotes a particular value of X.

2.4 Example. Flip a coin twice and let X be the number of heads. Then , Pi X ~ 0) ~ P({TT ) ) ~ 1/4, PiX ~ 1) ~ P({ H T,TH)) ~ 1/2 and IP'( X = 2) = JP'( {HH} ) = 1/4. The random variable and its distribution can be summarized as follows:

w P({w)) X(w)

TT 1/ 4

o

T H 1/4

1

HT 1/4

1

HH 1/4

2

x P(X ~ x)
o 1/ 4
1 1/ 2
2 1/4

Try generalizing this to n flips . ·

2.2 Distribution Functions and Probability Functions
Given a random variable X, we define the cumulat ive distribution function (or distribution function) as follows .

2.5 Definition. The cumulative d istribution functio n , 01' CDF, is the
function Fx : IR -+ [0, 11defined by

Fx(x) ~ PiX ,; x).

(2.1)

2.2 Distribution Functions and Probability Functions 21

Fx(x)

1

·

. 75

··- - - - - c o

.50

.25 ....- - - ( )

o

1

2

x

FIGURE 2.1. CDF for flipping a coin twice (Example 2.6.)

We will see later that the CDF effectively contains all the information about the random variable. Sometimes we write the CDF as F instead of Fx.
2.6 Example. Flip a fair coin twice and let X be the number of heads. Then JP'(X = 0) = JP'(X = 2) = 1/4 and JP'(X = 1) = 1/2. The distribution function is
Ox < 0
{ 1/40:S;x<1 Fx(x) = 3/41:S;x<2
1 x ~ 2.
The CDF is shown in Figure 2.1. Although this example is simple, study it carefully. CDF's can be very confusing. Notice that the function is right continuous, non-decreasing, and that it is defined for all x, even though the random variable only takes values 0,1, and 2. Do you see why Fx(1.4) = .757 ·
The following result shows that the CDF completely determines the distribution of a random variable.
2.7 Theorem. Let X have CDF F and let Y have CDF G. If F(x) = G(x) for all x, then JP'(X E A) = JP'(Y E A) for all A. 2
2.8 Theorem. A function F mapping the real line to [0,1] is a CDF for some probability JP' if and only if F satisfies the following three conditions:
(i) F is non-decreasing: Xl < X2 implies that F(Xl) :s; F(X2)'
(ii) F is normalized: lim F(x) = 0
x----+-CX)
2Technically, we only have that JlD(X E A) = JlD(Y E A) for every measurable event A.

22

2. Random Variables

and lim F(x) = l.
x-+oo
(iii) F is right-continuous: F(x) = F(x+) for all x, where

F(x+) = lim F(y).

PROOF. Suppose that F is a CDF. Let us show that (iii) holds. Let x be a real number and let YI, Y2,'" be a sequence of real numbers such that
YI > Y2 > ... and limiYi = x. Let Ai = (-OO,Yi] and let A = (-oo,x]. Note
that A = n : l Ai and also note that Al =:> A2 =:> .. '. Because the events are monotone, limi IP'(Ad = lP'(ni Ai). Thus,

Showing (i) and (ii) is similar. Proving the other direction - namely, that if F satisfies (i), (ii), and (iii) then it is a CDF for some random variable - uses some deep tools in analysis. _

2.9 Definition. X is discrete if it takes countably3 many values {Xl, X2, .. .}. We define the probability function or probability mass function for X by fx(x) = IP'(X = x).

Thus, f x (x) :;0. 0 for all x E lR and Li f x (Xi) = l. Sometimes we write f instead of Ix. The CDF of X is related to fx by

L Fx(x) = IP'(X ::; x) =

fX(Xi).

X'i::;X

2.10 Example. The probability function for Example 2.6 is

1/4 x = 0

fx(x) = {

1/2 1/4

x= 1 x=2

o otherwise.

See Figure 2.2. _

3 A set is countable if it is finite or it can be put in a one-to-one correspondence with the integers. The even numbers, the odd numbers, and the rationals are countable; the set of real numbers between 0 and 1 is not countable.

2.2 Distribution Functions and Probability Functions 23

fx(x)

1

.75

.5

·

.25

o

1

2

X

FIGURE 2.2. Probability function for flipping a coin twice (Example 2.6).

2.11 Definition. A random variable X is continuous if there exists a function fx such that fx(x) 20 for all x, J~oo fx(x)dx = 1 and for

every a :::; b,

W(a < X

< b) =

J/b a

fx(x)dx.

(2.2)

The function fx is called the probability density function (PDF). We

have that

Fx(x) = iXoo fx(t)dt

and fx(x) = F'x(x) at all points x at which Fx is differentiable.

J J Sometimes we write f(x)dx or f to mean J~oo f(x)dx.

2.12 Example. Suppose that X has PDF

fx(x) =

{

I 0

for 0 < x < 1
other;ise.-

J Clearly, f x (x) 2 0 and f x (x )dx = 1. A random variable with this density
is said to have a Uniform (0,1) distribution. This is meant to capture the idea of choosing a point at random between 0 and 1. The CDF is given by

~ ~ Fx(x) {

x<O O:::;x:::;1

x>1.

See Figure 2.3.·

24 2. Random Variables
Fx(x)
1

o

1

x

FIGURE 2.3. CDF for Uniform (0,1).

2.13 Example. Suppose that X has PDF

f(x) = { 0 1
(1+x)2

for x < 0
otherwise.

Since f f(x)dx = 1, this is a well-defined PDF.·

Warning! Continuous random variables can lead to confusion. First, note
that if X is continuous then JP'(X = x) = 0 for every x. Don't try to think
of f(x) as JP'(X = x). This only holds for discrete random variables. We get probabilities from a PDF by integrating. A PDF can be bigger than 1 (unlike
a mass function). For example, if f(x) = 5 for x E [0,1/5] and 0 otherwise,
then f(x) ~ 0 and f f(x)dx = 1 so this is a well-defined PDF even though
f(x) = 5 in some places. In fact, a PDF can be unbounded. For example, if
f(x) = (2/3)x- 1/ 3 for 0 < x < 1 and f(x) = 0 otherwise, then f f(x)dx = 1
even though f is not bounded.

2.14 Example. Let

j(. x) = { 0_1_
(1+x)

for x < 0
otherwise.

fooo This is not a PDF since f f(x)dx =

dx/(l +x) = J~oo du/u = log(oo) = 00.

·

2.15 lemma. Let F be the CDF for a random variable X. Then: 1. JP'(X = x) = F(x) - F(x-) where F(x-) = limytx F(y);

2.3 Some Important Discrete Random Variables 25
2. lP'(x < X ::; y) = F(y) - F(x);

3. lP'(X > x) = 1 - F(x);

4. If X is continuous then

F(b) - F(a)

lP'(a < X < b) = lP'(a ::; X < b) lP'(a < X ::; b) = lP'(a ::; X::; b).

It is also useful to define the inverse CDF (or quantile function).
2.16 Definition. Let X be a random variable with CDF F. The inverse CDF or quantile function is defined by4
F- 1 (q) = inf{ x: F(x) > q}
for q E [0,1]. If F is strictly increasing and continuous then F- 1 (q) is the
unique real number x such that F(x) = q.
We call F- 1(1/4) the first quartile, F- 1 (1/2) the median (or second quartile), and F- 1(3/4) the third quartile.
Two random variables X and Yare equal in distribution - written X ~ Y - if Fx(x) = Fy(x) for all x. This does not mean that X and Yare equal. Rather, it means that all probability statements about X and Y will be the same. For example, suppose that lP'(X = 1) = lP'(X = -1) = 1/2. Let Y = -X. Then lP'(Y = 1) = lP'(Y = -1) = 1/2 and so X =d Y. But X and Y are not equal. In fact, lP'(X = Y) = O.

2.3 Smne Irnportant Discrete Randmn Variables
Warning About Notation! It is traditional to write X F rv to indicate that X has distribution F. This is unfortunate notation since the symbol rv is also used to denote an approximation. The notation X F rv is so pervasive that we are stuck with it. Read X rv F as "X has distribution F" not as "X is approximately F" .
41f you are unfamiliar with "inf", just think of it as the minimum.

26

2. Random Variables

THE POINT MASS DISTRIBUTION. X has a point mass distribution at a,

written X rv 6a , if J1D(X = a) = 1 in which case

~ F(x) = {

x<a
x:;:, a.

The probability mass function is f(x) = 1 for x = a and 0 otherwise.

THE DISCRETE UNIFORM DISTRIBUTION. Let k > 1 be a given integer.

Suppose that X has probability mass function given by

f(x) = { ~/k

for x = 1, ... , k otherwise.

We say that X has a uniform distribution on {I, ... , k}.

THE BERNOULLI DISTRIBUTION. Let X represent a binary coin flip. Then J1D(X = 1) = p and J1D(X = 0) = 1 - p for some p E [0,1]. We say that X has a Bernoulli distribution written X rv Bernoulli(p). The probability function is f(x) = pX(l - p)l-X for x E {O, I}.

THE BINOMIAL DISTRIBUTION. Suppose we have a coin which falls heads
s: s: up with probability p for some 0 p 1. Flip the coin n times and let
X be the number of heads. Assume that the tosses are independent. Let
f(x) = J1D(X = x) be the mass function. It can be shown that

f(x)= {

o(xn)

X(l P

)n-x
-p

for x = 0, ... ,n

otherwise.

A random variable with this mass function is called a Binomial random variable and we write X rv Binomial(n,p). If Xl rv Binomial(nl,p) and
X 2 rv Binomial(n2,p) then Xl + X 2 rv Binomial(nl + n2,p).

Warning! Let us take this opportunity to prevent some confusion. X is a random variable; x denotes a particular value of the random variable; nand p are parameters, that is, fixed real numbers. The parameter p is usually unknown and must be estimated from data; that's what statistical inference is all about. In most statistical models, there are random variables and parameters: don't confuse them.

THE GEOMETRIC DISTRIBUTION. X has a geometric distribution with parameter p E (0, 1), written X rv Geom(p), if
J1D(X = k) = p(l - p)k-\ k:;:, 1.

We have that

2.4 Some Important Continuous Random Variables 27

Think of X as the number of flips needed until the first head when flipping a coin.
THE POISSON DISTRIBUTION. X has a Poisson distribution with parameter A, written X rv Poisson(A) if

Note that

L L , 00

00 AX

f(x) = e-A

= e-AeA = 1.

x=o

x=o x.

The Poisson is often used as a model for counts of rare events like radioactive

decay and traffic accidents. If Xl rv Poisson(Ad and X 2 rv Poisson(A2) then
Xl + X 2 rv PoiSSOn(Al + A2)'

Warning! We defined random variables to be mappings from a sample space D to Jl{ but we did not mention the sample space in any of the distributions above. As I mentioned earlier, the sample space often "disappears" but it is really there in the background. Let's construct a sample space ex-
°: ; plicitly for a Bernoulli random variable. Let D = [0,1] and define IF' to satisfy
1F'([a, b]) = b - a for a::; b::; 1. Fix p E [0,1] and define

~ X(w) = {

w ::; p
w > p.

Then IF'(X = 1) = IF'(w ::; p) = 1F'([O,p]) = p and IF'(X = 0) = 1 - p. Thus,
X rv Bernoulli(p). We could do this for all the distributions defined above. In practice, we think of a random variable like a random number but formally it is a mapping defined on some sample space.

2.4 Smne Irnportant Continuous Randmn Variables
THE UNIFORM DISTRIBUTION. X has a Uniform(a, b) distribution, written X rv Uniform(a, b), if
for x E [a, b] otherwise

28

2. Random Variables

where a < b. The distribution function is
x<a x E [a,b] x> b.

NORMAL (GAUSSIAN). X has a Normal (or Gaussian) distribution with
parameters IL and (T, denoted by X rv N(fL, (T2), if

f(x) = _(T1V2_]r exp { _2(_ IT2 (x _ fL)2} , xElR

(2.3)

where fL E lR and (T > O. The parameter fL is the "center" (or mean) of the
distribution and (T is the "spread" (or standard deviation) of the distribution. (The mean and standard deviation will be formally defined in the next chapter.) The Normal plays an important role in probability and statistics. Many phenomena in nature have approximately Normal distributions. Later, we shall study the Central Limit Theorem which says that the distribution of a sum of random variables can be approximated by a Normal distribution.
We say that X has a standard Normal distribution if fL = 0 and (T = l. Tradition dictates that a standard Normal random variable is denoted by Z. The PDF and CDF of a standard Normal are denoted by ¢(z) and <1>(z). The PDF is plotted in Figure 2.4. There is no closed-form expression for <1>. Here are some useful facts:

(i) If X rv N(fL, (T2), then Z = (X - fL)/(T rv N(O, 1).
(ii) If Z rv N(O, 1), then X = fL + (T Z rv N(fL, (T2).

(iii) If Xi rv N(ILi, (T;), i = 1, ... , n are independent, then

It follows from (i) that if X rv N(fL, (T2), then

IF' (a < X < b)

IF'(a:IL <Z< b:/L)

Thus we can compute any probabilities we want as long as we can compute the CDF <1>(z) of a standard Normal. All statistical computing packages will

2.4 Some Important Continuous Random Variables 29

-2 -1 o 1 2
FIGURE 2.4. Density of a standard Normal.
compute <I>(z) and <I>-1(q). Most statistics texts, including this one, have a table of values of <I>(z).

2.17 Example. Suppose that X rv N(3, 5). Find IF'(X > 1). The solution is

(z ;g3) IF'(X> 1) = 1 -IF'(X < 1) = 1 -IF' < 1

= 1 - <I> (-0.8944) = 0.81.

Now find q = <I>-1(0.2). This means we have to find q such that IF'(X < q) =
0.2. We solve this by writing
0.2 = IF'(X < q) = IF' ( Z < q: jt) = <I> ( q : jt) .

From the Normal table, <I> (-0.8416) = 0.2. Therefore,

jt -0.8416 = q - = q - 3

(J"

y'5

and hence q = 3 - 0.8416y'5 = 1.1181. ·

EXPONENTIAL DISTRIBUTION. X has an Exponential distribution with parameter (3, denoted by X rv Exp((3), if
f(x) = l1Je-x/(3, x> 0
where (3 > o. The exponential distribution is used to model the lifetimes of
electronic components and the waiting times between rare events.
GAMMA DISTRIBUTION. For a > 0, the Gamma function is defined by
Jo e- r(a) = oo yO'.-1 Y dy. X has a Gamma distribution with parameters a and

30

2. Random Variables

fJ, denoted by X rv Gamma(0:, fJ), if

_

1

a-I -x/(3

f(x) - fJaf(o:) X e ,

x>o

where 0:, fJ > O. The exponential distribution is just a Gamma(l, fJ) distribution. If Xi rv Gamma(O:i, fJ) are independent, then 2:~=1 Xi rv Gamma(2:~=l O:i, fJ).

THE BETA DISTRIBUTION. X has a Beta distribution with parameters
0: > 0 and fJ > 0, denoted by X rv Beta(0:, fJ), if

f

( X

)

_
-

f(o: + fJ) a-l(
f(o:)r(fJ) X 1 -

, )(3-1

X

,0

<

:x;

<

1.

t AND CAUCHY DISTRIBUTION. X has a t distribution with z; degrees of freedom - written X rv tv - if

X = f (f)

1

f()

f (':'.)
2

( 1

+

";,2)

(v+l)/2'

The t distribution is similar to a Normal but it has thicker tails. In fact, the
Normal corresponds to a t with z; = 00. The Cauchy distribution is a special
case of the t distribution corresponding to z; = 1. The density is

. j(x)

=

'if(l

1
+

x2)"

I:To see that this is indeed a density:

f(x)dx

.'i!f.

/00 -00

~
1+ x 2

=

.'i!f.

/00 -00

dtan-1(x) dx

1;: [ta-n1 (00) -tan-1 (-00)1=;1: ['"i2f - (-'"if2)] = 1.

THE X2 DISTRIBUTION. X has a X2 distribution with p degrees of freedom - written X rv X~ - if
f(x) = / \ /2x(P/2)-le-X/2 x> O. f(p 2 2P
If Zl,"" Zp are independent standard Normal random variables then 2:f=l Z; rv Xp2 '

2.5 Bivariate Distributions

2.5 Bivariate Distributions 31

Given a pair of discrete random variables X and Y, define the joint mass function by f(x, y) = IP'(X = x and Y = y). From now on, we write IP'(X = x and Y = y) as IP'(X = x, Y = y). We write f as fx,y when we want to be more explicit.

2.18 Example. Here is a bivariate distribution for two random variables X and Y each taking values 0 or 1:

x=o 1/9
X=1 2/9
1/3

Y=1 2/9 1/3 4/9 2/3 2/3 1

Thus, f(l, 1) = IP'(X = 1, Y = 1) = 4/9.·

2.19 Definition. In the continuous case, we call a function f(x, y) a PDF for the random variables (X, Y) if
(i) f(x, y) 20 for all (x, y), (ii) J~= J~= f(x, y)dxdy = 1 and,
J (iii) for any set A c Jl{ x Jl{, IP'((X, Y) E A) = J~ f(x, y)dxdy.

In the discrete or continuous case we define the joint CDF as Fx,Y(x, y) = IP'(X S x, Y S y).

2.20 Example. Let (X, Y) be uniform on the unit square. Then,

{I f(x, y) =

o

if 0 S ~ S 1,
otherwIse.

0SYS 1

Find IP'(X < 1/2, Y < 1/2). The event A = {X < 1/2, Y < 1/2} corresponds to a subset of the unit square. Integrating f over this subset corresponds, in this case, to computing the area ofthe set A which is 1/4. So, IP'(X < 1/2, Y <
1/2) = 1/4.·

32 2. Random Variables

2.21 Example. Let (X, Y) have density

f(x ) = { x + y if 0 -<; x -<; 1, 0 -<; Y -<; 1

,Y

0

otherwise.

Then
J{oI J{oI (x + y)dxdy

101 [10 1 X dX] dy + 101 [10 1 Y dX] dy

Jo{I

~dy
2

+

Jo{I

Y

dy

=

~ +~ =
22

1

which verifies that this is a PDF.

2.22 Example. If the distribution is defined over a non-rectangular region, then the calculations are a bit more complicated. Here is an example which I borrowed from DeGroot and Schervish (2002). Let (X, Y) have density

.

{ C x 2 y if x 2 -<; y -<; 1

j(x, y) = 0

otherwise.

Note first that -1 -<; x -<; 1. Now let us find the value of c. The trick here is to be careful about the range of integration. We pick one variable, x say, and let it range over its values. Then, for each fixed value of x, we let y vary over its range, which is x 2 -<; Y -<; 1. It may help if you look at Figure 2.5. Thus,

11 [;,1] ;.1 4 C

x2

Y dy dx = C x 2 ~ 1 dx = -4.:.:...

-1

x2

-1

2

21

Hence, c = 21/4. Now let us compute J1D(X ~ Y). This corresponds to the set

A = {(x, y); 0 -<; x -<; 1, x 2 -<; Y -<; x}. (You can see this by drawing a diagram.)

So,

J1D(X ~ Y)

11 11 [l -21 1 x x2 Ydy dx = -21

x 2 X Y dy] dx

4 0 x2

40

x2

21 j.l (x2 - x4) 3

-

x2

dx = - .·

40

2

20

2.6 Marginal Distributions 33

o

1

x

FIGURE 2.5. The light shaded region is x 2 ::; y ::; 1. The density is positive over this region. The hatched region is the event X 2> Y intersected with x 2 ::; y ::; 1.

2.6 Marginal Distributions

2.23 Definition. If (X, Y) have joint distribution with mass function fx,Y, then the marginal mass function for X is defined by

L L fx(x) = JlD(X = x) = JlD(X = x, Y = y) = f(x, y)

(2.4)

y

y

and the marginal mass function for Y is defined by

L L fy(y) = JlD(Y = y) = JlD(X = x, Y = y) = f(x, y).

(2.5)

x

x

2.24 Example. Suppose that fx,Y is given in the table that follows. The marginal distribution for X corresponds to the row totals and the marginal distribution for Y corresponds to the columns totals.

x=o 1/10
X=l 3/10
4/10

Y= 1 2/10 3/10 4/10 7/10 6/10 1

For example, fx(O) = 3/10 and fx(1) = 7/10.·

34

2. Random Variables

2.25 Definition. For continuous random variables, the marginal densities

are

J J fx(x) = f(x, y)dy, and jy(y) = f(x, y)dx.

(2.6)

The corresponding marginal distribution functions are denoted by Fx and Fy.

2.26 Example. Suppose that fx,Y(x, y) = e-(x+y)

2.27 Example. Suppose that

f(x, y) = { + ·Ox y if 0 ::; x ::; 1, 0::; y ::; 1
otherwise.

Then

11 11 11 jy(y) = (x+y)dx= xdx+ ydx=1-+y._

o

00

2

2.28 Example. Let (X, Y) have density

21 x 2 y if x 2 ::; y ::; 1

f(x, y) = { 04

otherwise.

Thus,

. J jx(x)= f(x,y)dy=2-1x 211 ydy=21-x2(1-x4)

4

X2

8

for -1 ::; x ::; 1 and fx(x) = 0 otherwise. _

2.7 Independent Randorn Variables

2.29 Definition. Two random variables X and Yare independent if, for every A and B,

W(X E A, Y E B) = W(X E A)W(Y E B)

(2.7)

and we write X II Y. Otherwise we say that X and Yare dependent and we write X IQ6OO' Y.

2.7 Independent Random Variables 35
In principle, to check whether X and Yare independent we need to check equation (2.7) for all subsets A and B. Fortunately, we have the following result which we state for continuous random variables though it is true for discrete random variables too.
2.30 Theorem. Let X and Y have joint PDF fx,Y. Then X IT Y if and only if fx,Y(x, y) = fx(x)Jy(y) for all values x and y. 5

2.31 Example. Let X and Y have the following distribution:

X=O 1/4 X=1 1/4
1/2

Y=1

1/4 1/2

1/4 1/2

1/2

1

Then, fx(O) = fx(l) = 1/2 and Jy(O) = Jy(I) = 1/2. X and Yare independent because fx(O)Jy(O) = f(O,O), fx(O)Jy(I) = f(O, 1), fx(I)Jy(O) = f(l, 0), fx(I)Jy(I) = f(l, 1). Suppose instead that X and Y have the following distribution:

Y=O Y = 1

X=O 1/2 0

1/2

X=1 0

1/2 1/2

1/2 1/2 1

These are not independent because fx(O)fy(l) f(O, 1) = O.·

(1/2)(1/2)

1/4 yet

2.32 Example. Suppose that X and Yare independent and both have the

same density

. {2X if 0 < x < 1
j (x) = 0 othe;'-wis;'

Let us find JP'(X + Y ~ 1). Using independence, the joint density is

{4X f( ) = f ( )f ( ) =

Y if 0 ~ x ~ 1, 0 ~ y ~ 1

x, y x x Y Y

0 otherwise.

5The statement is not rigorous because the density is defined only up to sets of
measure o.

36

2. Random Variables

Now,

W(X + Y <::: 1)

J1 f(x, y)dydx

411 [11- x+y:'Ol x

X YdY] dx

r4 1 x (1 x)2 dx =~ . ·

Jo 2

6

The following result is helpful for verifying independence.

2.33 Theorem. Suppose that the range of X and Y is a (possibly infinite) rectangle. If f(x, y) = g(x)h(y) for some functions g and h (not necessarily probability density functions) then X and Yare independent.

2.34 Example. Let X and Y have density

_ { 2e-(x+2y) f(x,y) - 0

if x > 0 and y > 0
otherwise.

The range of X and Y is the rectangle (0, (0) x (0, (0). We can write f(x, y) = g(x)h(y) where g(x) = 2e- X and h(y) = e- 2y . Thus, X II Y .·

2.8 Conditional Distributions

If X and Yare discrete, then we can compute the conditional distribution of
X given that we have observed Y = y. Specifically, W(X = xlY = y) = W(X =
x, Y = y)jW(Y = y). This leads us to define the conditional probability mass function as follows.

2.35 Definition. The conditional probability mass function is

W(X = x, Y = y)
fXIY(xly) = W(X = xlY = y) = W(Y=y )

fx,Y(x, y) Jy(y)

if Jy(y) > O.

For continuous distributions we use the same definitions. 6 The interpretation differs: in the discrete case, fXIY(xly) is W(X = xlY = y), but in the continuous case, we must integrate to get a probability.

6We are treading in deep water here. When we compute J1D(X E AIY = y) in the continuous case we are conditioning on the event {Y = y} which has probability O. We

2.8 Conditional Distributions 37

2.36 Definition. For continuous random variables, the conditional probability density function is

f

XIY (XIy)

-

fx,Y(x,y) jy(y)

assuming that jy(y) > O. Then,
i lP'(X E AIY = y) = fXly(xly)dx.

2.37 Example. Let X and Y have a joint uniform distribution on the unit
square. Thus, fXly(xly) = 1 for 0 <::: x <::: 1 and 0 otherwise. Given Y = y, X
is Uniform(O, 1). We can write this as XIY = y rv Uniform(O, 1) .·

From the definition of the conditional density, we see that fx,Y(x, y) fXIY(xly)jy(y) = jylx(Ylx)fx(x). This can sometimes be useful as in example 2.39.

2.38 Example. Let

X + y if 0 <::: x <::: 1, 0 <::: y <::: 1

f(x,y)= { 0

oth erW'lse.

Let us find lP'(X < 1/41Y
y + (1/2). Hence,

1/3). In example 2.27 we saw that jy(y)

f

XIY

(xIy)

-

fx,y(x,y) jy(y)

So,

~) 11/4 fxlY (x I dx

11/4

X+
-1--

1.
13

dX

=

..l.. +..l..

321

112

o 3+2

3+2

11 80

·

2.39 Example. Suppose that X rv Uniform(O, 1). After obtaining a value of X we generate YIX = x rv Uniform(x, 1). What is the marginal distribution

avoid this problem by defining things in terms of the PDF. The fact that this leads to a well-defined theory is proved in more advanced courses. Here, we simply take it as a definition.

38

2. Random Variables

of Y? First note that,

~ fx(x) = {

if 0 ::; x ::; 1 otherwise

and ifO<x<y<1 otherwise.
So,
3-_1_ ifO<x<y<1
fx,Y(x, y) = fylx(Ylx)fx(x) = { x otherwise.

The marginal for Y is

l lY J Y y
fy(y) = fx,Y(x, y)dx =

-d-x, = - 1- -du = -log(1 - y)

o

0 I-x

1

U

for 0 < y < 1. ·

2.40 Example. Consider the density in Example 2.28. Let's find fYlx(ylx). When X = x, y must satisfy x 2 ::; y ::; 1. Earlier, we saw that fx(x) (21/8)x 2 (1 - x 4 ). Hence, for x 2 ::; Y ::; 1,

2y 1- x4 '

Now let us compute W(Y ::;, 3/41X = 1/2). This can be done by first noting that fylx(yll/2) = 32y/15. Thus,

r r =~ W(Y ::;, 3/41 X = 1/2) = 1 f(yll/2)dy = 1 32y dy

.·

J3/4

J3/4 15

15

2.9 Multivariate Distributions and lID Sarnples

Let X = (Xl, ... ,Xn ) where Xl, ... ,Xn are random variables. We call X a random vector. Let f(X1,"" x n ) denote the PDF. It is possible to define their marginals, conditionals etc. much the same way as in the bivariate case.

We say that Xl"'" Xn are independent if, for every A 1, ... , An,

I In
W(X1 E A 1, ... , Xn E An) = W(Xi E A;).

(2.8)

i=l

It suffices to check that f(X1,"" x n ) = TI~=l fXi (Xi).

2.10 Two Important Multivariate Distributions 39
2.41 Definition. If Xl' ... ' Xn are independent and each has the same marginal distribution with CDF F, we say that Xl, ... ,Xn are IID (independent and identically distributed) and we write
If F has density f we also write Xl, ... Xn rv f. We also call Xl'···' Xn a random sample of size n from F.
Much of statistical theory and practice begins with IID observations and we shall study this case in detail when we discuss statistics.
2.10 Two Irnportant Multivariate Distributions
MULTINOMIAL. The multivariate version of a Binomial is called a Multinomial. Consider drawing a ball from an urn which has balls with k different
colors labeled "color 1, color 2, ... , color k." Let p = (PI, ... ,pd where
Pj ~ 0 and L~=l Pj = 1 and suppose that Pj is the probability of drawing a ball of color j. Draw n times (independent draws with replacement) and let X = (Xl' ... ' X k ) where Xj is the number of times that color j appears. Hence, n = L~=l Xj. We say that X has a Multinomial (n,p) distribution written X rv Multinomial(n,p). The probability function is
(2.9)
where
n!
2.42 Lemma. Suppose that X rv Multinomial(n,p) where X = (Xl, ... , Xk) and p = (PI, ... ,Pk). The marginal distribution of Xj is Binomial (n,pj).
MULTIVARIATE NORMAL. The univariate Normal has two parameters, It and a. In the multivariate version, fL is a vector and a is replaced by a matrix ~. To begin, let

40

2. Random Variables

where Zl,' .. , Zk rv N(O, 1) are independent. The density of Z is 7

f(z)

g f; k f(zi) = (27f~k/2 exp { -~ k zJ }

(27f~k/2 exp { _~zTz } .
We say that Z has a standard multivariate Normal distribution written Z rv N(O, I) where it is understood that 0 represents a vector of k zeroes and I is the k x k identity matrix.
More generally, a vector X has a multivariate Normal distribution, denoted by X rv N(,t, ~), if it has density 8
f(x; fL,~) = (27f)k/2~(~)ll/2 exp {-~(x - fL)T~-l(x - fL)} (2.10)
where I~I denotes the determinant of ~, fL is a vector of length k and ~ is a
k x k symmetric, positive definite matrix. 9 Setting fL = 0 and ~ = I gives
back the standard Normal. Since ~ is symmetric and positive definite, it can be shown that there exists
a matrix ~1/2 - called the square root of ~ - with the following properties: (i) ~1/2 is symmetric, (ii) ~ = ~1/2~1/2 and (iii) ~1/2~-1/2 = ~-1/2~1/2 = I where ~-1/2 = (~1/2)-1.
2.43 Theorem. If Z rv N(O,I) and X = fL + ~1/2 Z then X rv N(,t, ~).
Conversely, if X rv N(,t, ~), then ~-1/2(X -It) rv N(O, I).
Suppose we partition a random Normal vector X as X = (Xa, X b) We can similarly partition fL = (fLa, fLb) and
~ = (~aa ~ab). ~ba ~bb
2.44 Theorem. Let X rv N(fL, ~). Then: (1) The marginal distribution of Xa is Xa rv N(fLa, ~aa). (2) The conditional distribution of Xb given Xa = Xa is
XblXa = Xa rv N ( fLb + ~ba~~;(Xa - fLa), ~bb - ~ba~~;~ab ) .
(3) Ifa is a vector then aTX rv N(aTfL,aT~a).
x%. (4) V = (X - fL)T~-l(X -It) rv

71f a and b are vectors then aTb = 2:~=1 aibi .
8~-1 is the inverse of the matrix ~.
9A matrix ~ is positive definite if, for all nonzero vectors x, xT~x > o.

2.11 Transformations of Random Variables 41
2.11 Transforrnations of Randorn Variables

Suppose that X is a random variable with PDF fx and CDF Fx. Let Y = r(X) be a function of X, for example, Y = X 2 or Y = eX. We call Y = r(X) a transformation of X. How do we compute the PDF and CDF of Y? In the discrete case, the answer is easy. The mass function of Y is given by

fy(y)

lP'(Y = y) = lP'(r(X) = y) lP'({x; r(x) = y}) = lP'(X E r- 1 (y)).

2.45 Example. Suppose that lP'(X = -1) = lP'(X = 1) = 1/4 and lP'(X = 0) =

1/2. Let Y = X2. Then, lP'(Y = 0) = lP'(X = 0) = 1/2 and lP'(Y = 1) = lP'(X =
1) + lP'(X = -1) = 1/2. Summarizing:

x fx(x)
-1 1/4
o 1/2
1 1/4

y fy(y)
o 1/2
1 1/2

Y takes fewer values than X because the transformation is not one-to-one. _

The continuous case is harder. There are three steps for finding fy:

Three Steps for Transformations
1. For each y, find the set Ay = {x: r(x):::; y}.

2. Find the CDF

Fy(y)

lP'(Y :::; y) = lP'(r(X) :::; y)
IlP'({x; r(x):::; y}) fx(x)dx. A"

3. The PDF is fy(y) = FHy).

(2.11)

2.46 Example. Let j"x(x) = e- x for x > O. Hence, Fx(x) = J~T fx(s)ds =
1- e- x . Let Y = r(X) = logX. Then, Ay = {x: x:::; eY} and

Fy(y)

lP'(Y :::; y) = lP'(logX :::; y) lP'(X :::; eY) = Fx(eY) = 1 - e-e".

Therefore, fy(y) = eYe-e Y for y E R _

42

2. Random Variables

2.47 Example. Let X rv Uniform (-1,3). Find the PDF of Y

density of X is

fx(x) = {1o/4

if - 1~ x < 3
otherwlse.

Y can only take values in (0,9). Consider two cases: (i) 0 < y < 1 and (ii) 1 <:::
y < 9. For case (i), Ay = [-JY, JYl and Fy(y) = fA fx(x)dx = (1/2)JY. For case (ii), Ay = [-1, JYl and Fy(y) = J~ fx(x)dx = (1/4)(JY + 1).
y
Differentiating F we get

4~ if 0 < y < 1 Jy(y) = { 8~ if 1 < y < 9
o otherwise._

When r is strictly monotone increasing or strictly monotone decreasing then r has an inverse s = r- 1 and in this case one can show that

Jy(y) = fx(s(y)) -d--S-;(JY;J)j I . I

(2.12)

2.12 Transformations of Several Randorn Variables
In some cases we are interested in transformations of several random variables. For example, if X and Yare given random variables, we might want to know
the distribution of X/Y, X + Y, max{X, Y} or min{X, Y}. Let Z = r(X, Y)
be the function of interest. The steps for finding fz are the same as before:

Three Steps for Transformations

1. For each z, find the set A z = {(x,y): r(x,y) <::: z}. 2. Find the CDF

Fz(z)

t, IP'(Z <::: z) = lP'(r(X, Y) <::: z)
1P'({(x,y); r(x,y) <::: z}) = /

fX,y(x,y)dxdy.

3. Then fz(z) = F~(z).

2.13 Appendix 43

2.48 Example. Let X I ,X2 rv Uniform(O, 1) be independent. Find the density
of Y = Xl + X 2 . The joint density of (Xl, X 2 ) is

f( Xl, X2 ) =

{

I 0

0 < Xl < 1, 0 < X2 < 1
otherwise.

Fy(y)

IF'(Y <::: y) = 1F'(r-(XI ,X2 ) <::: y)

J rJAy 1F'({(XI,X2): r-(XI,X2) <::: y}) =

f(XI,X2) dx l dx 2.

Now comes the hard part: finding A y. First suppose that 0 < y <::: 1. Then Ay
is the triangle with vertices (0,0), (y, 0) and (0, y). See Figure 2.6. In this case,
J JAy f(XI, X2) dx l dx 2 is the area of this triangle which is y2/2. If 1 < y < 2,
then Ay is everything in the unit square except the triangle with vertices (1, y - 1), (1, 1), (y - 1,1). This set has area 1 - (2 - y)2/2. Therefore,

~ 1 Fy(y)

0
y -OJ
""2 1 _ (2_y)2

2

1

y<O O<:::y<l 1<:::y<2 Y ?:. 2.

By differentiation, the PDF is

y Jy(y) = { 2 - y
o

O<:::y<:::l
1 <::: y <::: 2 otherwise._

2.13 Appendix
Recall that a probability measure IF' is defined on a a-field A of a sample
space n. A random variable X is a measurable map X : n -+ R Measurable
means that, for every X, {w: X(w) <::: x} E A.
2.14 Exercises
1. Show that

44 2. Random Variables
1 ,----------, (O ,y)

(y - 1, 1) 1
(1, Y - 1)

°o

1

This is the case 0 :::; y < 1.

°o

1

This is the case 1 :::; Y :::; 2.

FIGURE 2.6. The set Ay for example 2.48. Ay consists of all points (Xl,X2) in the square below the line X2 = Y - Xl.

2. Let X be such that J1D(X = 2) = J1D(X = 3) = 1/10 and J1D(X = 5) = 8/10.
Plot the CDF F. Use F to find J1D(2 < X :::; 4.8) and J1D(2 :::; X :::; 4.8).
3. Prove Lemma 2.15.
4. Let X have probability density function
1/4 0 < x < 1 fx(x) = { 3/8 3 < x < 5
o otherwise.

(a) Find the cumulative distribution function of X.

(b) Let Y = 1/X. Find the probability density function jy (y) for Y.

i : :; Hint: Consider three cases:

y :::; ~, ~ :::; y :::; 1, and y ::;> 1.

5. Let X and Y be discrete random variables. Show that X and Yare independent if and only if fx,Y(x,y) = fx(x)jy(y) for all x and y.

6. Let X have distribution F and density function f and let A be a subset
of the real line. Let I A (x) be the indicator function for A:

Let Y = IA(X), Find an expression for the cumulative distribution of Y. (Hint: first find the probability mass function for Y.)

2.14 Exercises 45
7. Let X and Y be independent and suppose that each has a Uniform(O, 1)
distribution. Let Z = min{X, Y}. Find the density fz(z) for Z. Hint: It might be easier to first find J1D( Z > z).
8. Let X have CDF F. Find the CDF of X+ = max{O, X}.
9. Let X rv Exp(,6). Find F(x) and F-I(q).
10. Let X and Y be independent. Show that g(X) is independent of h(Y) where 9 and h are functions.
11. Suppose we toss a coin once and let p be the probability of heads. Let X denote the number of heads and let Y denote the number of tails. (a) Prove that X and Yare dependent. (b) Let N rv Poisson(>.) and suppose we toss a coin N times. Let X and Y be the number of heads and tails. Show that X and Yare independent.
12. Prove Theorem 2.33.
13. Let X rv N(O, 1) and let Y = eX.
(a) Find the PDF for Y. Plot it.
(b) (Computer Experiment.) Generate a vector x = (Xl, ... ,XlO,OOO) con-
sisting of 10,000 random standard Normals. Let Y = (YI,"" YIO,OOO) where Yi = eX;. Draw a histogram of Y and compare it to the PDF you found in part (a).
14. Let (X, Y) be uniformly distributed on the unit disk {(x, y) : x2 + y2 ~ I}. Let R = -JX2 + y2. Find the CDF and PDF of R.
15. (A universal random number generator.) Let X have a continuous, strictly increasing CDF F. Let Y = F(X). Find the density of Y. This is called the probability integral transform. Now let U rv Uniform(O,l) and let X = F-I(U). Show that X rv F. Now write a program that takes Uniform (0,1) random variables and generates random variables from an Exponential (,6) distribution.
16. Let X rv Poisson(>.) and Y rv Poisson(lL) and assume that X and Yare
independent. Show that the distribution of X given that X + Y = n is Binomial(n, 'if) where 'if = >.j(>. + IL).

46

2. Random Variables

Hint 1: You may use the following fact: If X rv Poisson(>.) and Y rv Poisson(/L), and X and Yare independent, then X +Y rv Poisson(tt+>'). Hint 2: Note that {X = x, X + Y = n} = {X = x, Y = n - x}.

17. Let

f .X.Y (.x,y ) -_ { 0c(x + y2)

o :::; x :::; 1 and 0 :::; y :::; 1
otherwise.

Find P (X < ~ I Y = ~).

18. Let X rv N(3, 16). Solve the following using the Normal table and using a computer package.
(a) Find JII'(X < 7). (b) Find JII'(X > -2). (c) Find x such that JII'(X > x) = .05. (d) Find JII'(O :::; X < 4). (e) Find x such that JII'(IXI > Ixl) = .05.

19. Prove formula (2.12).

20. Let X, Y rv Uniform(O, 1) be independent. Find the PDF for X - Y and X/Yo

21. Let Xl, ... ,Xn rv Exp(,6) be IID. Let Y = max{X1, ... ,Xn }. Find the PDF of Y. Hint: Y :::; y if and only if Xi :::; y for 'i = 1, ... , n.

3
Expectation

3.1 Expectation of a Randorn Variable x. The mean, or expectation, of a random variable X is the average value of

3.1 Definition. The expected value, or mean, or first moment, of X is defined to be

J lE(X) = jXdF(X) = { Lxxf(x) if X is discrete xf(x)dx if X is continuous

(3.1)

assuming that the sum (or integral) is well defined. We use the following
notation to denote the expected value of x:

lE(X) = lEX = j xdF(x) = M = Mx·

(3.2)

The expectation is a one-number summary of the distribution. Think of lE(X) as the average L~=l X;/n of a large number of IID draws Xl, ... ,Xn . The fact that lE(X) ~ L~=l X;/n is actually more than a heuristic; it is a
theorem called the law of large numbers that we will discuss in Chapter 5.
J The notation x dF (x) deserves some comment. We use it merely as a
convenient unifying notation so we don't have to write Lx xf(x) for discrete

48 3. Expectation
I random variables and xf(x)dx for continuous random variables, but you I should be aware that x dF (x) has a precise meaning that is discussed in real
analysis courses.
Ix To ensure that lE(X) is well defined, we say that lE(X) exists if IxldFx (x) <
00. Otherwise we say that the expectation does not exist.
3.2 Example. Let X '" Bernoulli(p). Then lE(X) = L;=o xf(x) = (0 x (1 -
p)) + (1 x p) = p. _

3.3 Example. Flip a fair coin two times. Let X be the number of heads. Then,
lE(X) = I xdFx(x) = Lx xfx(x) = (0 x f(O)) + (1 x f(l)) + (2 x f(2)) =
(0 x (1/4)) + (1 x (1/2)) + (2 x (1/4)) = 1. _

3.4 Example. Let x'" Uniform( -1,3). Then, lE(X) = I xdFx(x) = I xfx(x)dx =
i I~l xdx = 1. -

3.5 Example. Recall that a random variable has a Cauchy distribution if it

has density fx(x) = + {7f(1 X2)}-1. Using integration by parts, (set u = x

and v = tan- 1 x),

J 1 ;'00 00 00 IxldF(x) = -2

-x-d2 x = [x tan-1(x)jo -

tan-1xdx = 00

7f 0 l+x

0

so the mean does not exist. If you simulate a Cauchy distribution many times and take the average, you will see that the average never settles down. This is because the Cauchy has thick tails and hence extreme observations are common. _

From now on, whenever we discuss expectations, we implicitly assume that
they exist. Let Y = r(X). How do we compute lE(Y)? One way is to find Jy(y) and
I then compute lE(Y) = yfy(y)dy. But there is an easier way.

3.6 Theorem (The Rule of the Lazy Statistician). Let Y = r(X). Then

J lE(Y) = lE(r(X)) = r(x)dFx(x).

(3.3)

This result makes intuitive sense. Think of playing a game where we draw X at random and then I pay you Y = r(X). Your average income is r(x) times the chance that X = x, summed (or integrated) over all values of x. Here is

3.1 Expectation of a Random Variable 49
a special case. Let A be an event and let r(x) = IA(x) where IA(x) = 1 if
x E A and IA(x) = 0 if x ~ A. Then
J L IE(IA(X)) = IA(x)fx(x)dx = fx(x)dx = JF'(X E A).

In other words, probability is a special case of expectation.
3.7 Example. Let X rv Unif(O, 1). Let Y = r(X) = eX. Then,
11 10 IE(Y) = {I eX f(x)dx = 0 eXdx = e - 1.

Alternatively, you could find jy(y) which turns out to be jy(y) = l/y for
1 < y < e. Then, IE(Y) = J~e y f(y)dy = e - 1. ·

3.8 Example. Take a stick of unit length and break it at random. Let Y be

the length of the longer piece. What is the mean of Y? If X is the break point

then X rv Unif(O,l) and Y = r(X) = max{X,l - X}. Thus, r(x) = 1 - x

when 0 < x < 1/2 and r(x) = x when 1/2 -s: x < 1. Hence,

j. 11/2 ;.1 IE(Y) = r(:r)dF(.T) =

(1 - :r)d:r +

1/2 o

3
:rd:r = - .·
4

Functions of several variables are handled in a similar way. If Z = r(X, Y)

then

JJ IE(Z) = IE(r(X, Y)) =

r(x,y)dF(x,y).

(3.4)

3.9 Example. Let (X, Y) have a jointly uniform distribution on the unit
square. Let Z = r(X, Y) = X 2 + y2. Then,

JJ 11 11 IE(Z) =

r(x, y)dF(x, y) =

(x2 + y2) dxdy

112 11 2 x dx + y dy = -2.·

o

0

3

The kth moment of X is defined to be IE(Xk) assuming that IE(IXlk) < 00.

3.10 Theorem. If the kth moment exists and if j < k then the jth moment
exists.

PROOF. We have

£: Ixlj fx(x)dx

50 3. Expectation

j . j' Ixlj fx(x)dx +

Ixl j fx(x)dx

1 1 Ixl9

<

fx(x)dx +

Ixl>l Ixl kfx(x)dx

Ixl9

Ixl>l

< 1 + lE(IXlk) < 00. _

The kth central moment is defined to be lE((X - J.L)k).

3.2 Properties of Expectations
3.11 Theorem. If Xl"'" Xn are random variables and al,"" an are constants, then
(3.5)
3.12 Example. Let X rv Binomial(n,p). What is the mean of X? We could try to appeal to the definition:

but this is not an easy sum to evaluate. Instead, note that X = L~=l Xi where Xi = 1 if the ith toss is heads and Xi = 0 otherwise. Then lE(Xi ) =
(p x 1) + ((1 - p) x 0) = p and lE(X) = lE(Li Xi) = Li lE(Xi) = np. _
3.13 Theorem. Let Xl"'" Xn be independent random variables. Then,
(3.6)
Notice that the summation rule does not require independence but the multiplication rule does.
3.3 Variance and Covariance
The variance measures the "spread" of a distribution. 1
lWe can't use lE(X - /1) as a measure of spread since lE(X - /1) = lE(X) - /1 = /1- /1 = O.
We can and sometimes do use lElX - /11 as a measure of spread but more often we use the variance.

3.3 Variance and Covariance 51
3.14 Definition. Let X be a random variable with mean IL. The variance of X - denoted by (}2 or ()~ or V(X) or VX - is defined by
(3.7)
assuming this expectation exists. The standard deviation is sd(X) = y'V(X) and is also denoted by () and (}x.
3.15 Theorem. Assuming the variance is well defined, it has the following properties:

2. If a and b are constants then V(aX + b) = a2V(X).
3. If Xl, ... , Xn are independent and al, ... , an are constants, then
(3.8)
3.16 Example. Let X rv Binomial(n,p). We write X = Li Xi where Xi = 1 if toss i is heads and Xi = 0 otherwise. Then X = Li Xi and the random variables are independent. Also, lP'(Xi = 1) = p and lP'(Xi = 0) = 1- p. Recall that

Now,
JE(X;) = (PX 12) + ((l- P)X02) =p.
Therefore, V(Xi) = JE(Xf) - p2 = P - p2 = p(l - p). Finally, V(X) V(LiXi) = Li V(Xi ) = LiP(1 - p) = np(l - p). Notice that V(X) = 0 if p = 1 or p = O. Make sure you see why this makes intuitive sense. _
If Xl, ... ,Xn are random variables then we define the sample mean to be
(3.9)

and the sample variance to be

L Sn2 =

- n -1- 1

n
i=l

( Xi

-

-X n )2 .

(3.10)

52 3. Expectation
3.17 Theorem. Let Xl"'" Xn be IID and let It = IE(Xi ), (J2 = V(Xi)' Then

If X and Yare random variables, then the covariance and correlation between X and Y measure how strong the linear relationship is between X and Y.

3.18 Definition. Let X and Y be random variables with means fLx and fLy and standard deviations (Jx and (Jy. Define the covariance between X and Y by

Cov(X, Y) = IE ((X - fLx)(Y - fLY))

(3.11)

and the correlation by

p

-_

PX,y

-_

P(X,Y)-_

Cov(X, Y) (Jx(Jy

.

(3.12)

3.19 Theorem. The covariance satisfies:
Cov(X, Y) = IE(XY) - IE(X)IE(Y).
The correlation satisfies:
-1::; p(X, Y)::; 1.
If Y = aX + b for some constants a and b then p(X, Y) = 1 if a > 0 and
p(X, Y) = -1 if a < O. If X and Yare independent, then Cov(X, Y) = P = O.
The converse is not true in general.
3.20 Theorem. V(X + Y) = V(X) + V(Y) + 2Cov(X, Y) and V(X - Y) = V(X) +V(Y) -2Cov(X, Y). More generally, for random variables Xl,"" X n ,

v (LaiXi) = La;V(Xi ) +2LLaiajCov(Xi,Xj).

I

1

1<)

3.4 Expectation and Variance of Irnportant Randorn Variables
Here we record the expectation of some important random variables:

3.4 Expectation and Variance of Important Random Variables 53

Distribution
Point mass at a
Bernoulli(p) Binomial(71, p)
Geometric(p) Poisson(>.)
Uniform(a, b)
un Normal(/L,0- 2)
Exponential Gamma(a, (3)
Beta(a, (3)
tv
X~
Multinomial(n,p) Multivariate Normal(/L, ~)

Mean
a
P 71p
l/p >.
(a + b)/2
/L {3 a{3
a/(a + (3) o (if v > 1)
p np
/L

Variance
0 p(l - p) 71p(l - p) (1 _ p)/p2
>. (b - a)2/12 0- 2 (32
a{32
a{3/((a + (3)2(a + (3 + 1))
v/(v-2) (ifv>2) 2p
see below
~

We derived lE(X) and V(X) for the Binomial in the previous section. The calculations for some of the others are in the exercises.
The last two entries in the table are multivariate models which involve a random vector X of the form

The mean of a random vector X is defined by

The variance-covariance matrix ~ is defined to be

V(X) =

V(XI)

COV(XI' X 2 )

COV(X2' Xl) V(X2)

COV(XI' X k ) CoV(X2, Xk )

If X rv Multinomial(71,p) then lE(X) = 71p = 71(PI, ... ,Pk) and

71pI(l-pI) -71pIP2

V(X) = (

-np2PI .

np2(1 - P2)

-npkPI

54 3. Expectation
To see this, note that the marginal distribution of anyone component of the vector Xi rv Binomial(n,pi)' Thus, lE(Xi) = npi and V(Xi) = npi(l - Pi)'
Note also that Xi + Xj rv Binomial(n,pi + Pj). Thus, V(Xi + Xj) = n(pi + pj)(l - [pi + Pj]). On the other hand, using the formula for the variance of a sum, we have that V(Xi + Xj) = V(Xi) + V(Xj) + 2COV(Xi' Xj) = npi(l - Pi) + npj(l - Pj) + 2COV(Xi' Xj)' If we equate this formula with n(pi + pj)(l - [Pi + Pj]) and solve, we get COV(Xi' Xj) = -npiPj'
Finally, here is a lemma that can be useful for finding means and variances of linear combinations of multivariate random vectors.
3.21 lemma. If a is a vector and X is a random vector with mean It and variance~, thenlE(aTX) = aT,t andV(aTX) = aT~a. If A is a matrix then lE(AX) = AIL and V(AX) = A~AT.

3.5 Conditional Expectation

Suppose that X and Yare random variables. What is the mean of X among those times when Y = y? The answer is that we compute the mean of X as before but we substitute fXIY(xly) for fx(x) in the definition of expectation.

3.22 Definition. The conditional expectation of X given Y = y is

lE(XIY = y) =

{

LX fXly(xly) dx Jx fXIY(xly) dx

discrete case continuous case.

(3.13)

If r(x, y) is a function of x and y then

lE(r(X, Y)IY = y) = {

L r(x, y) fXIY(xly) dx
Jr(x, y) fXIY(xly) dx

discrete case
continuous case. (3.14)

Warning! Here is a subtle point. Whereas lE(X) is a number, lE(XIY = y) is a function of y. Before we observe Y, we don't know the value oflE(XIY = y) so it is a random variable which we denote lE(XIY). In other words, lE(XIY) is the random variable whose value is lE(XIY = y) when Y = y. Similarly,
lE(r(X, Y)IY) is the random variable whose value is lE(r(X, Y)IY = y) when
Y = y. This is a very confusing point so let us look at an example.
3.23 Example. Suppose we draw X rv Unif(O, 1). After we observe X = x, we draw YIX = x rv Unif(x, 1). Intuitively, we expect that lE(YIX = x) =

3.5 Conditional Expectation 55

(1 + x)/2. In fact, jylx(ylx) = 1/(1 - x) for x < y < 1 and

; .1 ;.1 IE(YIX = x) =

1
y jylx(ylx)dy = - -

1+x
ydy = - -

x

I-x x

2

as expected. Thus, IE(YIX) = (1 + X)/2. Notice that IE(YIX) = (1 + X)/2 is a random variable whose value is the number IE(YIX = x) = (1 + x)/2 once
X = x is observed. _

3.24 Theorem (The Rule of Iterated Expectations). For random variables X and Y, assuming the expectations exist, we have that

IE [IE(YIX)] = IE(Y) and IE [IE(XIY)] = IE(X).

(3.15)

More generally, for any function r(x, y) we have

IE [IE(r(X, Y)IX)] = IE(r(X, Y)).

(3.16)

PROOF. We'll prove the first equation. Using the definition of conditional expectation and the fact that f(x, y) = f(x)f(Ylx),

IE [IE(YIX)]

J IE(YIX = x)fx(x)dx = J J yf(ylx)dyf(x)dx

J J yf(ylx)f(x)dxdy = J J yf(x, y)dxdy = IE(Y). -

3.25 Example. Consider example 3.23. How can we compute IE(Y)? One
method is to find the joint density f(x, y) and then compute IE(Y) = JJ yf(x, y)dxdy.
An easier way is to do this in two steps. First, we already know that IE(YIX) =
(1 + X) /2. Thus,

IE(Y)

((1 IEIE(YIX) = IE ~ X))

(1 + IE(X)) = (1 + (1/2)) = 3/4. _

2

2

3.26 Definition. The conditional variance is defined as

V(YIX = x) = J(y -/L(X))2f(ylx)dy

(3.17)

where fL(X) = IE(YIX = x). 3.27 Theorem. For random variables X and Y,
V(Y) = IEV(YIX) + VIE(YIX).

56 3. Expectation

3.28 Example. Draw a county at random from the United States. Then draw 17, people at random from the county. Let X be the number of those people who have a certain disease. If Q denotes the proportion of people in that county with the disease, then Q is also a random variable since it varies from county to county. Given Q = q, we have that X rv Binomial(n, q). Thus,
IE(XIQ = q) = nq and V(XIQ = q) = nq(l - q). Suppose that the random variable Q has a Uniform (0,1) distribution. A distribution that is constructed
in stages like this is called a hierarchical model and can be written as

Q XIQ=q

Uniform(O, 1) Binomial(n, q).

Now, IE(X) = IEIE(XIQ) = IE(nQ) = nIE(Q) = n/2. Let us compute the
variance of X. Now, V(X) = IEV(XIQ) + VJE(XIQ). Let's compute these
two terms. First, IEV(XIQ) = IE[nQ(l - Q)] = nIE(Q(l - Q)) = n I q(l q)f(q)dq = n I01 q(l - q)dq = n/6. Next, VIE(XIQ) = V(nQ) = n 2V(Q)
n 2 I(q - (1/2))2dq = 17,2/12. Hence, V(X) = (n/6) + (n 2/12) .·

3.6 Moment Generating Functions
Now we will define the moment generating function which is used for finding moments, for finding the distribution of sums of random variables and which is also used in the proofs of some theorems.
3.29 Definition. The moment generating function MGF, or Laplace transform, of X is defined by

where t varies over the real numbers.

In what follows, we assume that the MGF is well defined for all t in some open interval around t = O. 2
When the MGF is well defined, it can be shown that we can interchange the operations of differentiation and "taking expectation." This leads to

1j;'(O) = [.!!:...-IEetX] = IE [.!!:...-etX ] = IE [XetXL=o = IE(X).

dt

t=O

dt

t=O

2 A related function is the characteristic function, defined by lEteitX ) where i = y'=1. This
function is always well defined for all t.

3.6 Moment Generating Functions 57
By taking k derivatives we conclude that 1j)k) (0) = JE(Xk). This gives us a method for computing the moments of a distribution.
3.30 Example. Let X rv Exp(l). For any t < 1,
The integral is divergent if t ~ 1. So, 1jJx(t) = 1/(1 - t) for all t < 1. Now,
¢'(O) = 1 and 1/;//(0) = 2. Hence, JE(X) = 1 and V(X) = JE(X2) -1L2 = 2 -1 = 1..
3.31 Lemma. Properties of the MGF.
(1) IfY = aX + b, then¢y(t) = ebt¢x(at).
(2) If Xl"'" Xn are independent and Y = Li Xi, then 1jJy(t) = ITi 1/;i(t) where 1jJi is the MGF of Xi'
3.32 Example. Let X rv Binomial(n,p). We know that X = L~=l Xi where
JP'(Xi = 1) = p and JP'(Xi = 0) = 1 - p. Now¢i(t) = JEeX;t = (p x et ) + ((1 p)) = pet + q where q = 1 - p. Thus, 1jJx(t) = ITi 1jJi(t) = (pet + q)n .·
Recall that X and Yare equal in distribution if they have the same distribution function and we write X ~ Y.
3.33 Theorem. Let X and Y be random variables. If 1/;x(t) =¢y(t) for all t
in an open interval around 0, then X ~ Y.
3.34 Example. Let Xl rv Binomial(nl,p) and X 2 rv Binomial(n2,p) be inde-
pendent. Let Y = Xl + X 2 · Then,
and we recognize the latter as the MGF of a Binomial(nl + n2,p) distribu-
tion. Since the MGF characterizes the distribution (i.e., there can't be another random variable which has the same MGF) we conclude that Y rv
Binomial(nl + n2,p).·

58 3. Expectation

Moment Generating Functions for Some Common Distributions

Distribution

MGF 'tjJ(t)

Bernoulli(p) pet +(l-p)
Binomial(n, p) (pet + (1 _ p))n

Poisson(A) Normal(fL,cr) Gamma(a,j3)

e.\(et -1)
{Id exp + ,,~t2 }
r(I!;3t for t < 1/j3

3.35 Example. Let Y1 rv Poisson(A1) and Y2 rv Poisson(A2) be independent.
The moment generating function of Y = Y1+Y + 2 is 'ljJy (t) = VJy, (t )'ljJY2 (t) =
e'\1(e l -1)e'\2(e l -1) = e('\1+'\2)(el -1) which is the moment generating function
of a Poisson(A1 + A2)' We have thus proved that the sum of two independent
Poisson random variables has a Poisson distribution. _

3.7 Appendix
EXPECTATION AS AN INTEGRAL. The integral of a measurable function r(x) is defined as follows. First suppose that r is simple, meaning that it takes finitely many values aI, ... , ak over a partition AI, ... , A k. Then define
Jk r(x)dF(x) = LaiJID(r(X) E Ai). i=l
J The integral of a positive measurable function r is defined by r(x)dF(x) = limi Jri(x)dF(x) where ri is a sequence of simple functions such that ri(x) ::;
r(x) and ri(x) -+ r(x) as i -+ 00. This does not depend on the particular se-
J quence. The integral of a measurable function r is defined to be r(x)dF(x) = Jr+(x)dF(x)- Jr-(x)dF(x) assuming both integrals are finite, where r+(x) =
max{r(x),O} and r- (x) = - min{r(x), O}.

3.8 Exercises
1. Suppose we playa game where we start with c dollars. On each play of the game you either double or halve your money, with equal probability. What is your expected fortune after n trials?

2. Show that V(X)
P(X = c) = 1.

3.8 Exercises 59
o if and only if there is a constant c such that

3. Let XI, ... ,Xn rv Uniform(O,l) and let Yn = max{XI, ... ,Xn}. Find JE(Yn).

4. A particle starts at the origin of the real line and moves along the line in jumps of one unit. For each jump the probability is p that the particle will jump one unit to the left and the probability is 1-p that the particle will jump one unit to the right. Let Xn be the position of the particle after n units. Find JE(Xn) and V(Xn). (This is known as a random walk.)

5. A fair coin is tossed until a head is obtained. What is the expected number of tosses that will be required?

6. Prove Theorem 3.6 for discrete random variables.

7. Let X be a continuous random variable with CDF F. Suppose that
P(X > 0) = 1 and that JE(X) exists. Show that JE(X) = fOCXlJP'(X >
x)dx.
Hint: Consider integrating by parts. The following fact is helpful: ifJE(X) exists then limX --+CXl x[l - F(x)] = O.

8. Prove Theorem 3.17.

9. (Computer Experiment.) Let Xl, X 2 , ... , Xn be N(O, 1) random variables and let Xn = n-IL~=IXi' Plot Xn versus n for n = 1, ... ,10,000. Repeat for Xl, X 2 , .. . , Xn rv Cauchy. Explain why there is such a difference.

10. Let X rv N(O, 1) and let Y = eX. Find JE(Y) and V(Y).

11. (Computer Experiment: Simulating the Stock Market.) Let YI , Y2 , ... be independent random variables such that P(li = 1) = P(li = -1) =
1/2. Let Xn = L~=l li. Think of li = 1 as "the stock price increased by one dollar", li = -1 as "the stock price decreased by one dollar",
and Xn as the value of the stock on day n.
(a) Find JE(Xn) and V(Xn)'
(b) Simulate Xn and plot Xn versus n for n = 1,2, ... ,10,000. Repeat the whole simulation several times. Notice two things. First, it's easy to "see" patterns in the sequence even though it is random. Second,

60 3. Expectation
you will find that the four runs look very different even though they were generated the same way. How do the calculations in (a) explain the second observation?
12. Prove the formulas given in the table at the beginning of Section 3.4 for the Bernoulli, Poisson, Uniform, Exponential, Gamma, and Beta. Here are some hints. For the mean of the Poisson, use the fact that
ea = 2..:::=0 aX Ix!. To compute the variance, first compute lE(X(X -1)).
For the mean of the Gamma, it will help to multiply and divide by f(a + 1)/;600+1 and use the fact that a Gamma density integrates to l. For the Beta, multiply and divide by r(a + l)f(;6)/f(a +;6 + 1).
13. Suppose we generate a random variable X in the following way. First we flip a fair coin. If the coin is heads, take X to have a Unif(O,l) distribution. If the coin is tails, take X to have a Unif(3,4) distribution.
(a) Find the mean of X.
(b) Find the standard deviation of X.
14. Let Xl, ... ,Xm and Yl , ... , Yn be random variables and let al, ... , am and bl , ... ,bn be constants. Show that

15. Let

f X,Y (x,y ) = {

-31 (x + y)
0

0 <_ x <_ 1, 0 <_ Y <_ 2
otherwise.

Find V(2X - 3Y + 8).

16. Let r(x) be a function of x and let s(y) be a function of y. Show that

lE(r(X)s(Y)IX) = r(X)lE(s(Y)IX).

Also, show that lE(r(X)IX) = r(X).

17. Prove that

V(Y) = lEV(Y I X) + VlE(Y I X).

Hint: Let m = lE(Y) and let b(x) = lE(YIX = x). Note that lE(b(X)) = lElE(YIX) = lE(Y) = m. Bear in mind that b is a function of x. Now write V(Y) = lE(Y - m)2 = lE( (Y - b(X)) + (b(X) - m))2. Expand the

3.8 Exercises 61

square and take the expectation. You then have to take the expectation of three terms. In each case, use the rule of the iterated expectation: lE(stuff) = lE(lE(stuffIX)).
18. Show that if lE(XIY = y) = c for some constant c, then X and Yare
uncorrelated.

19. This question is to help you understand the idea of a sampling dis-
tribution. Let Xl, . .. ,Xn be lID with mean f.L and variance (}2. Let
l Xn = n- L~=l Xi. Then Xn is a statistic, that is, a function of the
data. Since X n is a random variable, it has a distribution. This distribution is called the sampling distribution of the statistic. Recall from
Theorem 3.17 that lE(Xn) = It and V(Xn) = (}2/ n . Don't confuse the
distribution of the data fx and the distribution of the statistic f x ,,' To make this clear, let Xl, ... ,Xn '" Uniform(O, 1). Let fx be the density
of the Uniform(O, 1). Plot fx. Now let Xn = n- l L~=l Xi' Find lE(Xn)
and V(Xn). Plot them as a function of n. Interpret. Now simulate the distribution of Xn for n = 1,5,25,100. Check that the simulated values oflE(Xn) and V(Xn) agree with your theoretical calculations. What do you notice about the sampling distribution of X n as n increases?

20. Prove Lemma 3.21.

21. Let X and Y be random variables. Suppose that lE(YIX) = X. Show that Cov(X, Y) = V(X).

22. Let X '" Uniform(O, 1). Let 0 < a < b < 1. Let

O<x<b
otherwise

and let

~ Z = {

a<x<l
otherwise

(a) Are Y and Z independent? Why/Why not? (b) Find lE(YIZ). Hint: What values z can Z take? Now find lE(YIZ = z).

23. Find the moment generating function for the Poisson, Normal, and Gamma distributions.

24. Let Xl,"" Xn '" Exp(p). Find the moment generating function of Xi' Prove that L~=l Xi'" Gamma(n, p).

4
Inequalities

4.1 Probability Inequalities
Inequalities are useful for bounding quantities that might otherwise be hard to compute. They will also be used in the theory of convergence which is discussed in the next chapter. Our first inequality is Markov's inequality.

4.1 Theorem (Markov's inequality). Let X be a non-negative random
variable and suppose that lE(X) exists. For any t > 0,

J1D(X > t) <::: lE(;) .

( 4.1)

PROOF. Since X > 0,

lE(X)

1 lt 1 00 xf(x)dx = xf(x)dx + 00 xf(x)dx

1 1 >

~ 00 xf(x)dx t 00 f(x)dx = tJID(X > t) ·

64 4. Inequalities

4.2 Theorem (Chebyshev's inequality). Let It = IE(X) and (J2 = V(X).

Then,

and

IP'(IZI

~

k)

::;

1 k2

(4.2)

where Z = (X -It)/(J. In particular, IP'(IZI > 2) ::; 1/4 and IP'(IZI > 3) ::; 1/9.

PROOF. We use Markov's inequality to conclude that

The second part follows by setting t = k(J .·

4.3 Example. Suppose we test a prediction method, a neural net for example, on a set of n new test cases. Let Xi = 1 if the predictor is wrong and Xi = 0 if the predictor is right. Then Xn = n- 1 L~=l Xi is the observed error rate. Each Xi may be regarded as a Bernoulli with unknown mean p. We would like to know the true - but unknown - error rate p. Intuitively, we expect that X n should be close to p. How likely is X n to not be within E of p? We have that V(Xn) = V(Xd/n = p(l - p)/n and

IP'(IX _ I > ) < V(Xn) = p(l - p) < _I_

n p E-

E2

nE2 - 4nE2

i since p(l - p) ::; for all p. For E = .2 and n = 100 the bound is .0625.·

Hoeffding's inequality is similar in spirit to Markov's inequality but it is a sharper inequality. We present the result here in two parts.

4.4 Theorem (Hoeffding's Inequality). Let Y1 , ... , Yn be independent observations such that
IE(Yi) = 0 and ai ::; Yi ::; bi . Let E > O. Then, for any t > 0,

IIn
::; e -tE et2 (b.; -ai)2 /8.
i=l

(4.3)

4.1 Probability Inequalities 65
4.5 Theorem. Let Xl' ... ' Xn rv Bernoulli(p). Then, for any E > 0,
( 4.4)

4.6 Example. Let Xl, ... , Xn rv Bernoulli(p). Let n saw that Chebyshev's inequality yielded

100 and E = .2. We

According to Hoeffding's inequality,
1P'(IXn - pi > .2) ::; 2e- 2(lOO)(.2)2 = .00067

which is much smaller than .0625.·

Hoeffding's inequality gives us a simple way to create a confidence interval for a binomial parameter p. We will discuss confidence intervals in detail
later (see Chapter 6) but here is the basic idea. Fix a > 0 and let

J:.- log (3.) .

2n

a

By Hoeffding's inequality,

Let C = (Xn - En, Xn + En). Then, lP'(p ~ C) = 1P'(IXn - pi > En) ::; a. Hence,
lP'(p E C) ~ 1 - a, that is, the random interval C traps the true parameter value p with probability 1 - a; we call Cal - a confidence interval. More on this later.
The following inequality is useful for bounding probability statements about Normal random variables.
4.7 Theorem (Mill's Inequality). Let Z rv N(O, 1). Then,
IP'(IZI > t) ::; V(;2 -e-tt2-/2·

66

4. Inequalities

4.2 Inequalities For Expectations

This section contains two inequalities on expected values.

4.8 Theorem (Cauchy-Schwartz inequality). If X and Y have finite variances then
(4.5)

Recall that a function 9 is convex if for each x, y and each a E [0,1],
g(ax + (1 - a)y) <::: ag(x) + (1 - a)g(y).
If 9 is twice differentiable and g" (x) :;0. 0 for all x, then 9 is convex. It can be shown that if 9 is convex, then 9 lies above any line that touches 9 at some point, called a tangent line. A function 9 is concave if -g is convex. Examples of convex functions are g(x) = x 2 and g(x) = eX. Examples of concave functions are g(x) = _x2 and g(x) = logx.

4.9 Theorem (Jensen's inequality). If 9 is convex, then

IEg(X) :;0. g(IEX).

(4.6)

If 9 is concave, then

IEg(X) <::: g(IEX).

(4.7)

PROOF. Let L(x) = a + bx be a line, tangent to g(x) at the point IE(X).
Since 9 is convex, it lies above the line L(x). So,
IEg(X) :;0. IEL(X) = IE(a + bX) = a + bIE(X) = L(IE(X)) = g(IEX) . ·
From Jensen's inequality we see that IE(X2) :;0. (IEX)2 and if X is positive, then IE(ljX) :;0. 1jIE(X). Since log is concave, IE(logX) <::: 10gIE(X).

4.3 Bibliographic Rernarks
Devroye et al. (1996) is a good reference on probability inequalities and their use in statistics and pattern recognition. The following proof of Hoeffding's inequality is from that text.

4.4 Appendix

4.4 Appendix 67

PROOF OF HOEFFDING'S INEQUALITY. We will make use of the exact form of
e Taylor's theorem: if 9 is a smooth function, then there is a number E (0, u)
such that g(u) = g(O) + ug'(O) + '~2 9" (e).
PROOF of Theorem 4.4. For any t > 0, we have, from Markov's inequality,
that
(t tf) lP' ~ Yi ~ = lP' (et ~:,=, Y; ~ etE )

< e-tEIE (et~:'~l Yi) = e- tE IIIE(etY;).

(4.8)

Since ai <:::: Yi <:::: bi , we can write Yi as a convex combination of ai and bi , namely, Yi = abi + (1 - a)ai where a = (Yi - ai)/(bi - ai). So, by the

convexity of e ty we have

etY'

<
-

-Ybii----aae ii tb'+

-bbii--- -Yaiiet'a.

Take expectations of both sides and use the fact that IE(Yi) = 0 to get

IEetYi < - - -a '_etb; + - -b'_etai = eg(")

- bi - ai

bi - ai

(4.9)

where u = t(bi - ai), g(u) = -,u + log(l - , + ,e") and, = -ai/(bi - ai).

Note that g(O) = g'(O) = o. Also, g" (u) <:::: 1/4 for all u > o. By Taylor's
e theorem, there is a E (0, u) such that

g(u)

g(O)

+

,
ug (0)

+

u2 fI 2"g

(e)

u2 " 2"g (e)

<::::

u2
8

=

t 2(bi 8

ai)2

Hence,

IEetYi <:::: eg(,,) <:::: et2 (b;-a;)2/8.

The result follows from (4.8) .·

PROOF of Theorem 4.5. Let Yi (l/n)(Xi - p). Then IE(Yi) = 0 and a <:::: Yi <:::: b where a = -pin and b = (1 - p)/n. Also, (b - a)2 = 1/n2.

Applying Theorem 4.4 we get

f) f) ~Yi lP'(Xn - p > = lP'(

> <:::: e- tE et2 /(8n).

The above holds for any t > o. In particular, take t = 4nf and we get lP'(Xnp> f) <:::: e- 2nE2 . By a similar argument we can show that lP'(Xn - p < -f) <:::: e- 2m2 . Putting these together we get lP' (IXn - pi > f) <:::: 2e- 2nE2 .·

68 4. Inequalities
4.5 Exercises

1. Let X rv Exponential(p). Find J1D(IX - /Lxi 2 k(Jx) for k > 1. Compare
this to the bound you get from Chebyshev's inequality.
2. Let X rv Poisson(,,\). Use Chebyshev's inequality to show that J1D(X 2
2,,\) -s: 1/,,\.
3. Let Xl,"" Xn rv Bernoulli(p) and Xn = 71.- 1 L~=l Xi' Bound J1D(IXn -
pi > E) using Chebyshev's inequality and using Hoeffding's inequality.
Show that, when 71. is large, the bound from Hoeffding's inequality is smaller than the bound from Chebyshev's inequality.

4. Let Xl"'" Xn rv Bernoulli(p).
(a) Let Q > 0 be fixed and define

~ log (3.).

271.

Q

Let fin = 71.- 1 L~=l Xi. Define Cn = (fin - En, fin + En). Use Hoeffding's
inequality to show that

J1D(Cn contains p) 2 1 - Q.

In practice, we truncate the interval so it does not go below 0 or above l.
(b) (Computer Experiment.) Let's examine the properties of this confidence interval. Let Q = 0.05 and p = 0.4. Conduct a simulation study to see how often the interval contains p (called the coverage). Do this for various values of 71. between 1 and 10000. Plot the coverage versus 71..
(c) Plot the length of the interval versus 71.. Suppose we want the length of the interval to be no more than .05. How large should 71. be?
5. Prove Mill's inequality, Theorem 4.7. Hint. Note that J1D(IZI > t) = 2J1D(Z > t). Now write out what J1D(Z > t) means and note that x/t > 1 whenever x > t.
6. Let Z rv N(O, 1). Find J1D(IZI > t) and plot this as a function of t. From
Markov's inequality, we have the bound J1D(IZI > t) -s: -IEltzk l- k for any
k > O. Plot these bounds for k = 1,2,3,4,5 and compare them to the true value of J1D(IZI > t). Also, plot the bound from Mill's inequality.

4.5 Exercises 69
7. Let Xl"'" Xn rv N(O,l). Bound lP'(IXnl > t) using Mill's inequality,
where Xn = n- l L~=l Xi' Compare to the Chebyshev bound.

5
Convergence of Random Variables
5.1 Introduction
The most important aspect of probability theory concerns the behavior of sequences of random variables. This part of probability is called large sample theory, or limit theory, or asymptotic theory. The basic question is this: what can we say about the limiting behavior of a sequence of random variables X I, X 2 , X 3 , ...? Since statistics and data mining are all about gathering data, we will naturally be interested in what happens as we gather more and more data.
In calculus we say that a sequence of real numbers Xn converges to a limit
x if, for every f > 0, IXn - xl < f for all large n. In probability, convergence is
more subtle. Going back to calculus for a moment, suppose that Xn = x for all n. Then, trivially, limn ---+oo Xn = x. Consider a probabilistic version of this example. Suppose that Xl, X 2 , ... is a sequence of random variables which are independent and suppose each has a N(O, 1) distribution. Since these all have the same distribution, we are tempted to say that Xn "converges" to X rv N(O, 1). But this can't quite be right since IP'(Xn = X) = 0 for all n. (Two continuous random variables are equal with probability zero.)
Here is another example. Consider Xl, X 2 , ... where Xi rv N(O, lin). Intuitively, Xn is very concentrated around 0 for large n so we would like to say that Xn converges to O. But IP'(Xn = 0) = 0 for all n. Clearly, we need to

72

5. Convergence of Random Variables

develop some tools for discussing convergence in a rigorous way. This chapter develops the appropriate methods.
There are two main ideas in this chapter which we state informally here:

1. The law of large numbers says that the sample average X n = n- l L~=l Xi converges in probability to the expectation It = JE(Xi)' This means that Xn is close to It with high probability.

2. The central limit theorem says that fo(Xn - fL) converges in distribution to a Normal distribution. This means that the sample average has approximately a Normal distribution for large n.

5.2 Types of Convergence
The two main types of convergence are defined as follows.

5.1 Definition. Let Xl, X 2 , ... be a sequence of random variables and let X be another random variable. Let Fn denote the CDF of Xn and let F denote the CDF of X.
1. Xn converges to X in probability, written Xn~X, if, for every
E > 0,
(5.1 )
as n -+ 00.

2. Xn converges to X in distribution, written Xn -vo+ X, if

lim Fn (t) = F(t)
n---+oo
at all t for which F is continuous.

(5.2)

When the limiting random variable is a point mass, we change the notation
slightly. If JP'(X = c) = 1 and Xn ~ X then we write Xn ~ c. Similarly, if
Xn X -vo+ we write Xn -vo+ c.
There is another type of convergence which we introduce mainly because it
is useful for proving convergence in probability.

5.2 Types of Convergence 73 F(t)

----~~-----L-------------t

----------~-----------t

FIGURE 5.1. Example 5.3. Xn converges in distribution to X because Fn(t) con-
verges to F(t) at all points except t = o. Convergence is not required at t = 0

because t = 0 is not a point of continuity for F.

5.2 Definition. Xn converges to X in quadratic mean (also called convergence in L 2), written Xn ~ X, if
(5.3)
as 17, -+ 00.
Again, if X is a point mass at c we write Xn ~ c instead of Xn ~ X.
5.3 Example. Let Xn rv N(O, 1/17,). Intuitively, Xn is concentrating at 0 so we would like to say that Xn converges to O. Let's see if this is true. Let F be
the distribution function for a point mass at o. Note that foXn rv N(O, 1). Let Z denote a standard normal random variable. For t < 0, Fn(t) = IP'(Xn < t) = IP'( foXn < fot) = IP'(Z < fot) -+ 0 since fot -+ -00. For t > 0, Fn(t) = IP'(Xn < t) = lP'(foXn < fot) = IP'(Z < fot) -+ 1 since fot -+ 00.
Hence, Fn(t) -+ F(t) for all t cJ 0 and so Xn ~ O. Notice that Fn(O) = 1/2 cJ F(1/2) = 1 so convergence fails at t = o. That doesn't matter because t = 0
is not a continuity point of F and the definition of convergence in distribution only requires convergence at continuity points. See Figure 5.1. Now consider
convergence in probability. For any E > 0, using Markov's inequality,

<
as 17, -+ 00. Hence, Xn --p+ o.·
The next theorem gives the relationship between the types of convergence. The results are summarized in Figure 5.2.
5.4 Theorem. The following relationships hold: (a) Xn~X implies that Xn~X.
(b) Xn ~ X implies that Xn ~ X. (c) If Xn ~ X and iflP'(X = c) = 1 for some real numberc, thenXn~X.

74

5. Convergence of Random Variables

In general, none of the reverse implications hold except the special case in (c).
PROOF. We start by proving (a). Suppose that Xn~X. Fix E > O. Then,
using Markov's inequality,

Proof of (b). This proof is a little more complicated. You may skip it if you
wish. Fix E > 0 and let x be a continuity point of F. Then

Fn(x)

IP'(Xn <::: x) = IP'(Xn <::: x, X <::: x + E) + IP'(Xn <::: x, X> x + E)

< IP'(X <::: x + E) + 1P'(IXn - XI > E)

F(x + E) + 1P'(IXn - XI > E).

Also,

F(x - E)

IP'(X <::: x - E) = IP'(X <::: x - E,Xn <::: x) +IP'(X <::: x - E,Xn > x)

< Fn(x) + 1P'(IXn - XI > E).

Hence,

Take the limit as n -+ 00 to conclude that

F(x - E) <::: liminf Fn(x) <::: lim sup Fn(x) <::: F(x + E).

n--+oo

n--+oo

This holds for all E > O. Take the limit as E -+ 0 and use the fact that F is

continuous at x and conclude that limn Fn(x) = F(x).
Proof of (c). Fix E > O. Then,

1P'(IXn - ci > E)

IP'(Xn < C- E) + IP'(Xn > C+ E)

< IP'(Xn <:::C-E)+IP'(Xn >C+E)

Fn(c - E) + 1 - Fn(c + E)

-+ F(c-E)+l-F(c+E)

0+1 -1 = O.

Let us now show that the reverse implications do not hold.
CONVERGENCE IN PROBABILITY DOES NOT IMPLY CONVERGENCE IN QUADRATIC
MEAN. Let U rv Unif(O, 1) and let Xn = vnI(O,l/n)(U), Then 1P'(IXnl > E) =

5.2 Types of Convergence 75

quadratic mean

-----)~

..p.o.i.n.t.-m..a.s.s.d..istribution

...6... ·

· ··

probability--....,)~ distribution

FIGURE 5.2. Relationship between types of convergence.

IP'(Vri1(O,l/n)(U)

>

e)

=

IP'(O

~

U

<

1/71)

=

1/71

--+

o.

Hence,

P
Xn---+O.

But

lE(X~) = 71 Jolin du = 1 for all 71 so Xn does not converge in quadratic mean.

CONVERGENCE IN DISTRIBUTION DOES NOT IMPLY CONVERGENCE IN PROB-
ABILITY. Let X rv N(O,l). Let Xn = -X for 71 = 1,2,3, ... ; hence Xn rv
N(O,l). Xn has the same distribution function as X for all 71 so, trivially, limn Fn(x) = F(x) for all x. Therefore, Xn ~ X. But 1P'(IXn - XI > e) =
1P'(12XI > e) = IP'(IXI > e/2) # O. So Xn does not converge to X in probability.
· Warning! One might conjecture that if Xn ~ b, then lE(Xn) --+ b. This is not l true. Let Xn be a random variable defined by IP'(Xn = 712) = 1/71 and IP'(Xn = 0) = 1 - (1/71). Now, 1P'(IXnl < to) = IP'(Xn = 0) = 1 - (1/71) --+ 1.
Hence, Xn~ o. However, lE(Xn) = [71 2 x (1/71)] + [0 x (1- (1/71))] = n. Thus,
lE(Xn) --+ 00.
Summary. Stare at Figure 5.2.

Some convergence properties are preserved under transformations.

5.5 Theorem. Let X n , X, Yn , Y be random variables. Let g be a continuous

function.

(a) If Xn--P-+X and Yn--P-+ Y, then Xn + Yn--P-+X + Y.

(b)

qm
If Xn--'--+X

qm
and Yn--'--+ Y,

then Xn

+

qm
Yn--,--+X

+

Y.

(c) If Xn ~ X and Yn ~ c, then Xn + Yn ~ X + c.

(d) If Xn--P-+X and Yn--P-+ Y, then XnYn--P-+XY.

(e) If Xn ~ X and Yn ~ c, then XnYn ~ eX. (f) If Xn~X, then g(Xn)~ g(X).

(g) If Xn ~ X, then g(Xn) ~ g(X).

Parts (c) and (e) are know as Slutzky's theorem. It is worth noting that
Xn ~ X and Yn ~ Y does not in general imply that Xn + Yn ~ X + Y.
lWe can conclude that lE(Xn) --+ b if Xn is uniformly integrable. See the appendix.

76

5. Convergence of Random Variables

5.3 The Law of Large Numbers

Now we come to a crowning achievement in probability, the law of large numbers. This theorem says that the mean of a large sample is close to the mean of the distribution. For example, the proportion of heads of a large number of tosses is expected to be close to 1/2. We now make this more precise.
Let Xl, X 2 , ... be an IID sample, let fL = lE(XI) and 2 (J2 = V(X1)' Recall that the sample mean is defined as Xn = 71,-1 L~=l Xi and that lE(Xn) = fL and V(X n) = (J2/ n .

5.6 Theorem (The Weak Law of Large Numbers (WLLN)). 3

-

p

If Xl"'" Xn are IID, then Xn--+ fL.

Interpretation of the WLLN: The distribution of X n becomes more concentrated around fL as 71, gets large.
PROOF. Assume that (J < 00. This is not necessary but it simplifies the
proof. Using Chebyshev's inequality,

which tends to 0 as 71, --+ 00.·

5.7 Example. Consider flipping a coin for which the probability of heads is p. Let Xi denote the outcome of a single toss (0 or 1). Hence, p = P(Xi = 1) = E(Xi)' The fraction of heads after 71, tosses is X n . According to the law of large numbers, X n converges to p in probability. This does not mean that Xn will numerically equal p. It means that, when 71, is large, the distribution of X n is tightly concentrated around p. Suppose that p = 1/2. How large
should 71 be so that P(.4 ::; Xn ::; .6) 2 .77 First, lE(Xn) = p = 1/2 and V(Xn) = (J2/ n = p(l - p)/n = 1/(471,). From Chebyshev's inequality,

1P'(IXn - fLl ::; .1)

1 -1P'(IXn - fLl > .1)

>

1

25

1-

=1--

471(.1)2

71 .

The last expression will be larger than .7 if n = 84.·

2Note that {! = lE(Xi) is the same for all i so we can define {! = lE(Xi) for any i. By convention, we often write {! = lE( Xl).
3There is a stronger theorem in the appendix called the strong law of large numbers.

5.4 The Central Limit Theorem 77
5.4 The Central Lirnit Them'ern
The law of large numbers says that the distribution of X n piles up near JL. This isn't enough to help us approximate probability statements about X n' For this we need the central limit theorem.
Suppose that Xl, ... ,Xn are lID with mean JL and variance 172. The central limit theorem (CLT) says that Xn = 71.- 1 L:i Xi has a distribution which is
approximately Normal with mean JL and variance 172 /71.. This is remarkable
since nothing is assumed about the distribution of Xi, except the existence of the mean and variance.
5.8 Theorem (The Central Limit Theorem (CLT)). Let Xl, ... ,Xn be lID with mean JL and variance 172 . Let Xn = 71.- 1 L:~=l Xi' Then

where Z rv N(O, 1). In other words,

_=z
lim IP'(Zn =:; z) = <I>(z) = /

1

2

m=e- x /2dx.

n-+=

v21f

Interpretation: Probability statements about Xn can be approximated using a Normal distribution. It's the probability statements that we are approximating, not the random variable itself.
In addition to Zn ~ N(O, 1), there are several forms of notation to denote the fact that the distribution of Zn is converging to a Normal. They all mean the same thing. Here they are:
:::::: N(O,l)
~:) :::::: N (JL'
:2) (0, :::::: N
vn(X n - JL) :::::: N(0,172)
fo(Xn - JL) :::::: N(O,l).
5.9 Example. Suppose that the number of errors per computer program has a Poisson distribution with mean 5. We get 125 programs. Let Xl, . .. , X 125 be

78

5. Convergence of Random Variables

the number of errors in the programs. We want to approximate IP'(Xn < 5.5).
Let fL = IE(Xd = A = 5 and (J"2 = V(Xd = A = 5. Then,

IP'(Xn < 5.5)

TT1l lC

(fo(X:u:

-

fL)

<

fo(5u~ -

fL))

;:::::: IP'(Z < 2.5) = .9938. ·

The central limit theorem tells us that Zn = fo( X n -IL) / (J" is approximately
N(O,l). However, we rarely know (J". Later, we will see that we can estimate (J"2 from Xl, ... , Xn by

This raises the following question: if we replace (J" with Sn, is the central limit theorem still true? The answer is yes.
5.10 Theorem. Assume the same conditions as the CLT. Then,

You might wonder, how accurate the normal approximation is. The answer is given in the Berry-Esseen theorem.

5.11 Theorem

(The Berry-Esseen

Inequality).

Suppose

thatIEIXl

3
1

<

00.

Then

(5.4)

There is also a multivariate version of the central limit theorem.
5.12 Theorem (Multivariate central limit theorem). Let Xl, ... ,Xn be lID random vectors where

with mean

and variance matrix ~. Let

5.5 The Delta Method 79

yIn(X - fL) 'V'7 N(O, ~).
5.5 The Delta Method
If Yn has a limiting Normal distribution then the delta method allows us to find the limiting distribution of g(Yn ) where 9 is any smooth function.
5.13 Theorem (The Delta Method). Suppose that yIn(Yn - fL) 'V'7 N(O, 1) (J"
and that 9 is a differentiable function such that g' (fL) # 0. Then
In other words,
5.14 Example. Let Xl, ... ,Xn be lID with finite mean fL and finite variance (J"2. By the central limit theorem, yIn(Xn - fL)l(J" 'V'7 N(O, 1). Let Wn = eX".
Thus, Wn = g(Xn) where g(s) = eS · Since g'(s) = eS , the delta method
implies that Wn :::::; N(e~, e2~(J"2 In). _ There is also a multivariate version of the delta method.
5.15 Theorem (The Multivariate Delta Method). Suppose thatYn = (Ynl , ... , Ynd is a sequence of random vectors such that

80

5. Convergence of Random Variables

Let 9 : IRk -+ IR and let

\1g(y) = ( :ug" ) om Let \1JL denote \1g(y) evaluated at y = JL and assume that the elements of \1JL
are nonzero. Then

5.16 Example. Let

be IID random vectors with mean IL = (ILl, JL2f and variance ~. Let

_

1n

X 2 = -n L:X2i i=l

and define Yn = X 1X 2. Thus, Yn = g(X 1,X2) where g(81,82) = 8182. By the central limit theorem,

Vii ( XXI -!L1 ) ~ N(O, ~).
2 - !L2

Now

( ) ( ) og

\1g(8) = OoSgI

82

81

OS2

and so

)( ) \1r~\1JL = (!L2 !L1) ( 0"11 0"12

0"12 0"22

IL2

= !L220"11

+

2!L1!L20"12

+

2 !Ll

0"22·

ILl

Therefore,

(0, ~ IL~O"l1 Vii(X IX2 - !Ll/L2) N

+ 2/Ll!L20"12 + !LI0"22). ·

5.6 Bibliographic Remarks
Convergence plays a central role in modern probability theory. For more details, see Grimmett and Stirzaker (1982), Karr (1993), and Billingsley (1979). Advanced convergence theory is explained in great detail in van der Vaart and Wellner (1996) and and van der Vaart (1998).

5.7 Appendix

5.7 Appendix 81

5.7.1 Almost Sure and L1 Convergence
We say that Xn converges almost surely to X, written Xn~X, if

W({s: Xn(s) -+ X(s)}) = 1. We say that Xn converges in Ll to X, written Xn ~ X, if

as n -+ 00.
5.17 Theorem. Let Xn and X be random variables. Then: (aj Xn~X implies that Xn~X, (bj Xn~X implies that Xn~X, (cj Xn~X implies that Xn~X,
The weak law of large numbers says that Xn converges to IE(Xd in probability. The strong law asserts that this is also true almost surely.
5.18 Theorem (The Strong Law of Large Numbers). Let Xl, X 2, ... be lID. If
fL = IEIX11 < 00 then Xn~ fl·
A sequence Xn is asymptotically uniformly integrable if
lim lim sup IE (IXnII(IXnl > M)) = O.
!VI -+ (Xl n -+ (Xl
5.19 Theorem. If Xn --p+ band Xn is asymptotically uniformly integrable, then IE(Xn) -+ b.
5.7.2 Proof of the Central Limit Theorem
Recall that if X is a random variable, its moment generating function (MGF) is VJx(t) = IEetx . Assume in what follows that the MGF is finite in a neighborhood around t = O.
5.20 Lemma. Let Zl, Z2,'" be a sequence of random variables. Let 1/Jn be the
MGF of Zn. Let Z be another random variable and denote its MGF by 1/J. If
I/Jn(t) -+I/J(t) for all t in some open interval around 0, then Zn ~ Z.

82

5. Convergence of Random Variables

PROOF OF THE CENTRAL LIMIT THEOREM. Let Yi = (Xi - IL)/U. Then, Zn = n- l / 2 Li Yi. Let VJ(t) be the MGF of Yi. The MGF of Li Yi is (VJ(t))n and MGF of Zn is [1/!(t/fo)]n == en(t). NowljJ'(O) = lE(yd = 0,1jJ"(0) =
lE(Yl) = V(Yl ) = 1. So,

Now,

VJ(t)

VJ(O) + tv/(O) + ~t 21/!"(0) + ~t 13/!"'(O) + ...

2.

3.

1 + 0 + -t2 + -t13 /!"'(0) + ...
2 3!

1 + -t 2 + -t13 /!"'(0) + ...
2 3!

en(t)

[1/!(Jn)r

r [1

+

~
2n

+

_t3 _1/!"'(0)
3!n3/ 2

+

..

.]n

[1 I ~ I b;:"'(o) I

--+ et2 / 2
which is the MGF of a N(O,l). The result follows from the previous Theorem.
r In the last step we used the fact that if an --+ a then ( 1 + ~~ --+ ea. ·

5.8 Exercises

1. Let Xl, ... ,Xn be IID with finite mean fL = lE(Xd and finite variance u 2 = V(Xl)' Let Xn be the sample mean and let S~ be the sample variance.

(a) Show that lE(S~) = u 2 .

( b) Show that Sn2 --P+ U 2 . Hm. t.. Show that Sn2 -_

cnn -1

",n L...i=l

Xi2

-

dn-X2n

xl where Cn --+ 1 and dn --+ 1. Apply the law oflarge numbers to n- l L~=l

and to X n . Then use part (e) of Theorem 5.5.

2. Let Xl, X 2 , ... be a sequence of random variables. Show that Xn ~ b if and only if

lim lE(Xn) = b and lim V(Xn) = o.

n---+oo

n---+oo

5.8 Exercises 83

3. Let Xl"'" Xn be IID and let fL = lE(XI). Suppose that the variance is finite. Show that X n ~ M.

4. Let Xl, X 2 , ... be a sequence of random variables such that

1

and

JID (Xn =

n) =

2' n

Does Xn converge in probability? Does Xn converge in quadratic mean?

5. Let Xl,"" Xn rv Bernoulli(p). Prove that

1 -

Ln X;~p

n

and

1n

2 qm

-n LXi --=---+ p.

i=l

i=l

6. Suppose that the height of men has mean 68 inches and standard deviation 2.6 inches. We draw 100 men at random. Find (approximately) the probability that the average height of men in our sample will be at least 68 inches.

7. Let An = l/n for n = 1,2, .... Let Xn rv Poisson(An).

p
(a) Show that Xn---+O.

(b)

Let

Yn

=

n Xn .

Show

that

p
Yn---+O.

8. Suppose we have a computer program consisting of n = 100 pages of code. Let Xi be the number of errors on the ith page of code. Suppose
that the X;$ are Poisson with mean 1 and that they are independent. Let Y = 2::~=1 Xi be the total number of errors. Use the central limit
theorem to approximate J1D(Y < 90).

9. Suppose that J1D(X = 1) = J1D(X = -1) = 1/2. Define

X {X =

with probability 1 - ~

n

en with probability ~.

Does Xn converge to X in probability? Does Xn converge to X in distribution? Does lE(X - Xn)2 converge to O?
10. Let Z rv N(O, 1). Let t > O. Show that, for any k > 0,

Compare this to Mill's inequality in Chapter 4.

84

5. Convergence of Random Variables

11. Suppose that Xn rv N(O,I/n) and let X be a random variable with distribution F(x) = 0 if X < 0 and F(x) = 1 if x ~ O. Does Xn converge to X in probability? (Prove or disprove). Does Xn converge to X in distribution? (Prove or disprove).

12. Let X, Xl, X 2 , X 3 , ... be random variables that are positive and integer valued. Show that Xn X 'V') if and only if

lim IP'(Xn = k) = IP'(X = k)
n---+oo
for every integer k.

13. Let Zl, Z2, ... be lID random variables with density f. Suppose that
IP'(Zi > 0) = 1 and that), = limxto f(x) > O. Let

Show that Xn ~ Z where Z has an exponential distribution with mean
1/),.
14. Let Xl"'" Xn rv Uniform(O, 1). Let Yn = X~. Find the limiting distri-
bution of Yn .
15. Let

be IID random vectors with mean IL = (ILl, IL2) and variance ~. Let

_

1n

Xl = -n LXIi,
i=l

=-L _

1n

X2

n i=l X 2i

and define Yn = X IiX 2. Find the limiting distribution of Yn .

16. Construct an example where Xn X 'V') and Yn 'V') Y but Xn + Yn does not converge in distribution to X + Y.

Part II
Statistical Inference

6
Models, Statistical Inference and Learning

6.1 Introduction
Statistical inference, or "learning" as it is called in computer science, is the process of using data to infer the distribution that generated the data. A typical statistical inference question is:
Given a sample Xl, .. . , Xn rv F, how do we infer F?
In some cases, we may want to infer only some feature of F such as its mean.

6.2 Pararnetric and Nonparametric Models

A statistical model ~ is a set of distributions (or densities or regression functions). A parametric model is a set ~ that can be parameterized by a finite number of parameters. For example, if we assume that the data come from a Normal distribution, then the model is

o}. ~ = {f(X;/L,cr) = cr~exp {- 2~2(X _/L)2}, /L E lR, cr >

(6.1)

This is a two-parameter model. We have written the density as f(x; IL, cr) to show that x is a value of the random variable whereas /L and cr are parameters.

88 6. Models, Statistical Inference and Learning
In general, a parametric model takes the form

J = {f(X; e): e E 8 }

(6.2)

e where is an unknown parameter (or vector of parameters) that can take e values in the parameter space 8. If is a vector but we are only interested in
one component of e, we call the remaining parameters nuisance parameters.
A nonparametric model is a set J that cannot be parameterized by a finite
number of parameters. For example, JALL = {all CDF'S} is nonparametric. 1
6.1 Example (One-dimensional Parametric Estimation). Let Xl, ... , Xn be independent Bernoulli(p) observations. The problem is to estimate the parameter p.·
6.2 Example (Two-dimensional Parametric Estimation). Suppose that Xl, ... ,
Xn F rv and we assume that the PDF f E J where J is given in (6.1). In
this case there are two parameters, fL and (J. The goal is to estimate the parameters from the data. If we are only interested in estimating IL, then IL is the parameter of interest and (J is a nuisance parameter.·
6.3 Example (Nonparametric estimation of the CDF). Let Xl, ... , Xn be independent observations from a CDF F. The problem is to estimate F assuming only that F E JALL = {all CDF'S} .·
6.4 Example (Nonparametric density estimation). Let Xl, ... , Xn be indepen-
dent observations from a CDF F and let f = F' be the PDF. Suppose we want to estimate the PDF f. It is not possible to estimate f assuming only that FE JALL. We need to assume some smoothness on f. For example, we might
n assume that f E J = JDENS JSOB where JDENS is the set of all probability
density functions and

The class JSOB is called a Sobolev space; it is the set of functions that are not "too wiggly." ·
6.5 Example (Nonparametric estimation of functionals). Let Xl, ... , Xn rv F.
J Suppose we want to estimate IL = IE(XI) = xdF(x) assuming only that
1 The distinction between parametric and non parametric is more subtle than this but we don't need a rigorous definition for our purposes.

6.2 Parametric and Nonparametric Models 89
It exists. The mean fL may be thought of as a function of F: we can write
f It = T(F) = xdF(x). In general, any function of F is called a statis-
tical functional. Other examples of functionals are the variance T(F)
f x 2dF(x) - (J xdF(x))2 and the median T(F) = F- 1 (1/2) .·

6.6 Example (Regression, prediction, and classification). Suppose we observe pairs
of data (Xl, Yd, ... (Xn' Yn). Perhaps Xi is the blood pressure of subject 'i
and Yi is how long they live. X is called a predictor or regressor or fea-
ture or independent variable. Y is called the outcome or the response variable or the dependent variable. We call r(x) = IE(YIX = x) the re-
gression function. If we assume that r E J where J is finite dimensional -
the set of straight lines for example - then we have a parametric regres-
sion model. If we assume that r E J where J is not finite dimensional then
we have a nonparametric regression model. The goal of predicting Y for a new patient based on their X value is called prediction. If Y is discrete (for example, live or die) then prediction is instead called classification. If our goal is to estimate the function r, then we call this regression or curve estimation. Regression models are sometimes written as

Y = r(X) + f

(6.3)

where IE(f) = O. We can always rewrite a regression model this way. To see
this, define f = Y - r(X) and hence Y = Y + r(X) - r(X) = r(X) + f.
Moreover, IE(f) = IEIE(fIX) = IE(IE(Y - r(X))IX) = IE(IE(YIX) - r(X)) = IE(r(X) - r(X)) = O.·

WHAT'S NEXT? It is traditional in most introductory courses to start with parametric inference. Instead, we will start with nonparametric inference and then we will cover parametric inference. In some respects, nonparametric inference is easier to understand and is more useful than parametric inference.
FREQUENTISTS AND BAYESIANS. There are many approaches to statistical inference. The two dominant approaches are called frequentist inference and Bayesian inference. We'll cover both but we will start with frequentist inference. We'll postpone a discussion of the pros and cons of these two until
later.
SOME NOTATION. If J = {j(x; e) : e E 8} is a parametric model, we write lP'e(X E A) = fA f(x; e)dx and IEe(r(X)) = f r(x)f(x; e)dx. The subscript e
indicates that the probability or expectation is with respect to f(x; e); it does
not mean we are averaging over e. Similarly, we write 'life for the variance.

90

6. Models, Statistical Inference and Learning

6.3 Fundarnental Concepts in Inference

Many inferential problems can be identified as being one of three types: estimation, confidence sets, or hypothesis testing. We will treat all of these problems in detail in the rest of the book. Here, we give a brief introduction to the ideas.

6.3.1 Point Estimation

Point estimation refers to providing a single "best guess" of some quantity
of interest. The quantity of interest could be a parameter in a parametric
model, a CDF F, a probability density function f, a regression function T, or
a prediction for a future value Y of some random variable.

e en. By convention, we denote a point estimate of bye or Remember e e that is a fixed, unknown quantity. The estimate depends on the e data so is a random variable.

Xn More formally, let Xl"'"

be n lID data points from some distribution

F. en e A point estimator of a parameter is some function of Xl"'" Xn:

The bias of an estimator is defined by

bias(en ) = lEe (en) - e.

(6.4)

We say that en is unbiased if lE(en ) = e. Unbiasedness used to receive much
attention but these days is considered less important; many of the estimators we will use are biased. A reasonable requirement for an estimator is that it should converge to the true parameter value as we collect more and more data. This requirement is quantified by the following definition:

en e 6.7 Definition. A point estimatoT of a pammeteT is consistent if

e- n

p
-----+

e.

en The distribution of is called the sampling distribution. The standard en deviation of is called the standard error, denoted by se:

(6.5)
Often, the standard error depends on the unknown F. In those cases, se is an unknown quantity but we usually can estimate it. The estimated standard
error is denoted by se.

6.3 Fundamental Concepts in Inference 91

6.8 Example. Let Xl' ... ' Xn rv Bernoulli(p) and let Pn = n- 1 Li Xi. Then
lE(Pn) = n- 1 Li lE(Xi) = P so Pn is unbiased. The standard error is se =
se jV(Pn) = jp(l - p)/n. The estimated standard error is = jp(l - p)/n.
·

The quality of a point estimate is sometimes assessed by the mean squared

error, or MSE defined by

MSE = lEg (e~n - e) 2 .

(6.6)

Keep in mind that lEg 0 refers to expectation with respect to the distribution
IIn
f(X1, ... , Xn; e) = f(Xi; e)
i=l
that generated the data. It does not mean we are averaging over a distribution
for e.

6.9 Theorem. The MSE can be written as

(6.7)

PROOF. Let en = Eg(en). Then

lEg(en - e)2

lEg(Bn - en + en - e)2

lEg(Bn - en)2 + 2(en - e)lEg(en - en) + lEg (en - e)2 (en - e)2 + lEg(Bn - en)2 bias2 (Bn) + v(en )

where we have used the fact that lEg(Bn - en) = en - en = o.·

6.10 Theorem. If bias -+ 0 and se -+ 0 as n -+ IX) then en is consistent, that

is,

e- n

p
-----+

e.

PROOF. If bias -+ 0 and se -+ 0 then, by Theorem 6.9, MSE -+ O. It
e. follows that en ~ (Recall Definition 5.2.) The result follows from part (b)
of Theorem 5.4.·

6.11 Example. Returning to the coin flipping example, we have that lEp(Pn) =
p so the bias = p - p = 0 and se = jp(l - p)/n -+ o. Hence, Pn~ p, that is,
Pn is a consistent estimator.·

Many of the estimators we will encounter will turn out to have, approximately, a Normal distribution.

92

6. Models, Statistical Inference and Learning

6.12 Definition. An estimator is asymptotically Normal if - 8n --8 ~N(O,I).
se

(6.8)

6.3.2 Confidence Sets

A 1 - Q confidence interval for a parameter 8 is an interval Cn = (a, b)

where a = a(X1 , ... , Xn) and b = b(X1 , ... , Xn) are functions of the data

such that

lP'e(8 E Cn) :;:, 1 - Q, for all 8 E 8.

(6.9)

In words, (0, b) traps 8 with probability 1- Q. We callI - Q the coverage of the confidence interval.
Warning! Cn is random and 8 is fixed. Commonly, people use 95 percent confidence intervals, which corresponds to choosing Q = 0.05. If 8 is a vector then we use a confidence set (such as a sphere or an ellipse) instead of an interval. Warning! There is much confusion about how to interpret a confidence interval. A confidence interval is not a probability statement about 8 since 8 is a fixed quantity, not a random variable. Some texts interpret confidence intervals as follows: if I repeat the experiment over and over, the interval will contain the parameter 95 percent of the time. This is correct but useless since we rarely repeat the same experiment over and over. A better interpretation is this:

On day 1, you collect data and construct a 95 percent confidence interval for a parameter 81 . On day 2, you collect new data and construct a 95 percent confidence interval for an unrelated parameter 82 . On day 3, you collect new data and construct a 95 percent confidence interval for an unrelated parameter 83 . You continue this way constructing confidence intervals for a sequence of unrelated parameters 81 ,82 , ... Then 95 percent of your intervals will trap the true parameter value. There is no need to introduce the idea of repeating the same experiment over and over.

6.13 Example. Every day, newspapers report opinion polls. For example, they might say that "83 percent of the population favor arming pilots with guns." Usually, you will see a statement like "this poll is accurate to within 4 points

6.3 Fundamental Concepts in Inference 93
95 percent of the time." They are saying that 83 ± 4 is a 95 percent confidence
interval for the true but unknown proportion p of people who favor arming pilots with guns. If you form a confidence interval this way every day for the rest of your life, 95 percent of your intervals will contain the true parameter. This is true even though you are estimating a different quantity (a different poll question) every day. _
6.14 Example. The fact that a confidence interval is not a probability state-
e ment about is confusing. Consider this example from Berger and Wolpert e (1984). Let be a fixed, known real number and let Xl, X 2 be independent
random variables such that W(Xi = 1) = W(Xi = -1) = 1/2. Now define
e Yi = + Xi and suppose that you only observe Yl and Y 2 . Define the follow-
ing "confidence interval" which actually only contains one point:
ifYl =Y2
if Yl cJ Y2 ·
You can check that, no matter what e is, we have We(e E C) = 3/4 so this is a 75 percent confidence interval. Suppose we now do the experiment and we get Yl = 15 and Y2 = 17. Then our 75 percent confidence interval is {16}.
e However, we are certain that = 16. If you wanted to make a probability
statement about e you would probably say that W(e E ClYl, Y2 ) = 1. There is nothing wrong with saying that {16} is a 75 percent confidence interval. But
is it not a probability statement about e. _
e In Chapter 11 we will discuss Bayesian methods in which we treat as if it
were a random variable and we do make probability statements about e. In
e particular, we will make statements like "the probability that is in Cn, given
the data, is 95 percent." However, these Bayesian intervals refer to degreeof-belief probabilities. These Bayesian intervals will not, in general, trap the parameter 95 percent of the time.
6.15 Example. In the coin flipping setting, let Cn = (Pn - En, Pn + En) where
E; = log(2/a)/(2n). From Hoeffding's inequality (4.4) it follows that

for every p. Hence, Cn is a 1 - a confidence interval. _

As mentioned earlier, point estimators often have a limiting Normal dis-

en ;::: tribution, meaning that equation (6.8) holds, that is,

N(e, SE?). In this

case we can construct (approximate) confidence intervals as follows.

94

6. Models, Statistical Inference and Learning

se 6.16 Theorem (Normal-based Confidence Interval). Suppose that en:::::: N(e, 2 ).
Let q:, be the CDF of a standard Normal and let ZOi/2 = q:,-1(1 - (0;/2)), that
is, JID(Z > ZOI/2) = 0;/2 and JID( -ZOI/2 < Z < ZOI/2) = 1 - 0; where Z rv N(O, 1).
Let
(6.10)

Then

(6.11)

PROOF. Let Zn = (en - e)/se. By assumption Zn ~ Z where Z rv N(O, 1).
Hence,

se e se) + JID9 (en - ZOI/2 < < en ZOI/2

en~ e < JlDg ( -ZOI/2

< ZOI/2)

--+ JID ( -ZOI/2 < Z < ZOI/2)
1 - 0;. _

For 95 percent confidence intervals, 0; = 0.05 and ZOI/2 = 1.96 :::::: 2 leading
se. to the approximate 95 percent confidence interval en ± 2

6.17 Example. Let Xl"'" Xn rv Bernoulli(p) and let Pn = n- l L~=l Xi'
Then V(Pn) = n- 2 L~=l V(Xi ) = n- 2 L~=l p(l - p) = n- 2np(1 - p) = p(l -
se p)/n. Hence, se = Vp(l - p)/n and = VPn(l - Pn)/n. By the Central se Limit Theorem, Pn :::::: N(p, 2 ). Therefore, an approximate 1 - 0; confidence

interval is

_ _ _ !Pn (1 - Pn)

V Pn ± ZOI/2 se = Pn ± ZOI/2

n.

Compare this with the confidence interval in example 6.15. The Normal-based
interval is shorter but it only has approximately (large sample) correct coverage. _

6.3.3 Hypothesis Testing
In hypothesis testing, we start with some default theory - called a null hypothesis - and we ask if the data provide sufficient evidence to reject the theory. If not we retain the null hypothesis. 2
2The term "retaining the null hypothesis" is due to Chris Genovese. Other terminology is "accepting the null" or "failing to reject the null."

6.4 Bibliographic Remarks 95
6.18 Example (Testing if a Coin is Fair). Let
Xl, ... ,Xn rv Bernoulli(p)
be n independent coin flips. Suppose we want to test if the coin is fair. Let Ho denote the hypothesis that the coin is fair and let HI denote the hypothesis that the coin is not fair. Ho is called the null hypothesis and HI is called the alternative hypothesis. We can write the hypotheses as
Ho : p = 1/2 versus HI: p # 1/2. It seems reasonable to reject Ho if T = IPn - (1/2)1 is large. When we discuss
hypothesis testing in detail, we will be more precise about how large T should be to reject Ho .·
6.4 Bibliographic Remarks
Statistical inference is covered in many texts. Elementary texts include DeGroot and Schervish (2002) and Larsen and Marx (1986). At the intermediate level I recommend Casella and Berger (2002), Bickel and Doksum (2000), and Rice (1995). At the advanced level, Cox and Hinkley (2000), Lehmann and Casella (1998), Lehmann (1986), and van der Vaart (1998).
6.5 Appendix
Our definition of confidence interval requires that lP'e(e E en) ~ 1 - a
e for all E 8. A pointwise asymptotic confidence interval requires that e liminfn--+oolP'e(e E en) ~ I-a for all E 8. A uniform asymptotic con-
fidence interval requires that liminfn--+ooinfeEelP'e(e E en) ~ 1- a. The approximate Normal-based interval is a pointwise asymptotic confidence interval.
6.6 Exercises
1. Let Xl, ... ,Xn rv Poisson(>.) and let ~ = n-lL~=lXi. Find the bias, se, and MSE of this estimator.
e 2. Let Xl' ... ' Xn rv Uniform(O, e) and let = max{Xl , ... , X n }. Find the
bias, se, and MSE of this estimator.

96

6. Models, Statistical Inference and Learning

e 3. Let Xl"'" Xn rv Uniform(O, e) and let = 2Xn . Find the bias, se, and
MSE of this estimator.

7
Estimating the CDF and Statistical Functionals

The first inference problem we will consider is nonparametric estimation of the CDF F. Then we will estimate statistical functionals, which are functions of CDF, such as the mean, the variance, and the correlation. The nonparametric method for estimating functionals is called the plug-in method.

7.1 The Empirical Distribution Function
Let Xl' ... ' Xn rv F be an IID sample where F is a distribution function on the real line. We will estimate F with the empirical distribution function, which is defined as follows.

7.1 Definition. The empirical distribution function Fn is the CDF that puts mass lin at each data point Xi. Formally,

Fn(x) = L~=l J(Xi S x)

(7.1)

n

where

if Xi S x
if Xi > x.

98 7. Estimating the COF and Statistical Functionals
o

L()
o

o

o

0 .0

0 .5

1 .0

1.5

FIGURE 7.1. Nerve data. Each vertical line represents one data point. The solid line is the empirical distribution function. The lines above and below the middle line are a 95 percent confidence band.

7.2 Example (Nerve Data). Cox and Lewis (1966) reported 799 waiting times between successive pulses along a nerve fiber. Figure 7.1 shows the empirical CDF Fn. The data points are shown as small vertical lines at the bottom of the plot. Suppose we want to estimate the fraction of waiting times between
.4 and .6 seconds. The estimate is Fn(.6) - Fn(.4) = .93 - .84 = .09.·

7.3 Theorem. At any fixed value of x,

IE (Fn(x))

F(x),

V (Fn(X))

F(x)(1 - F(x)) n

MSE

F(x)(1 - F(x)) ---+ 0,

n

p
Fn(x) ---+ F(x).

7.4 Theorem (The Glivenko-Cantelli Theorem). Let Xl"'" Xn cv F. Then I

~

p

sup IFn(x) - F(x) 1---+ O.

x

Now we give an inequality that will be used to construct a confidence band.

lMore precisely, sUPx IFn(x) - F(x)1 converges to 0 almost surely.

7.2 Statistical Functionals 99
7.5 Theorem (The Dvoretzky-Kiefer-Wolfowitz (DKW) Inequality). LetX1 , ... ,
Xn rv F. Then, for any E > 0,

(7.2)

From the DKW inequality, we can construct a confidence set as follows:

Define,

A Nonparametric 1 - a Confidence Band for F

L(x) U(X)
where En

max{Fn(x) - En, O}
min{Fn(x) + En, I}

~
2n

log

(~). a

It follows from (7.2) that for any F,

IP'(L(x) ~ F(x) ~ U(x) for all x) ~ 1 - a.

(7.3)

V 7.6 Example. The dashed lines in Figure 7.1 give a 95 percent confidence
band using En = 2~ log (.55) = .048. ·
7.2 Statistical Functionals
A statistical functional T(F) is any function of F. Examples are the mean fJ = J xdF(x), the variance (]"2 = J(x - fJ)2 dF(x) and the median m = F - 1 (1/2).
7.7 Definition. The plug-in estimator of8 = T(F) is defined by

In other words, just plug in Fn for the unknown F.
7.8 Definition. IfT(F) = J r(x)dF(x) for some function r(x) then T is called a linear functional.

100 7. Estimating the COF and Statistical Functionals

The reason T(F) = J r(x)dF(x) is called a linear functional is because T

satisfies

T(aF + bG) = aT(F) + bT(G),

hence T is linear in its arguments. Recall that J r(x)dF(x) is defined to be
J r(x)f(x)dx in the continuous case and L: j r(xj)f(xj) in the discrete. The
empirical cdf Fn(x) is discrete, putting mass lin at each Xi. Hence, ifT(F) = J r(x)dF(x) is a linear functional then we have:

7.9 Theorem. The plug-in estimator for linear functional T(F) = J r(x)dF(x) is:

(7.4)

Sometimes we can find the estimated standard error se of T(Fn) by doing some calculations. However, in other cases it is not obvious how to estimate the standard error. In the next chapter, we will discuss a general method for
se. se. finding For now, let us just assume that somehow we can find
In many cases, it turns out that
(7.5)
By equation (6.11), an approximate 1- ex confidence interval for T(F) is then
(7.6)
We will call this the Normal-based interval. For a 95 percent confidence interval, Za/2 = z.05/2 = 1.96 ;::;0 2 so the interval is
T(Fn) ± 2 se.
7.10 Example (The mean). Let J.L = T(F) = JxdF(x). The plug-in estima-
tor is Ii = J xdFn(x) = X n· The standard error is se = VV(Xn) = (5lfo. If (j denotes an estimate of (5, then the estimated standard error is (j I fo. (In
the next example, we shall see how to estimate (5.) A Normal-based confidence
se.· interval for It is X n ± Za/2
7.11 Example (The Variance). Let (52 = T(F) = V(X) = J x 2 dF(x)-(J xdF(x)( The plug-in estimator is

7.2 Statistical Functionals 101

1n

1n

2

-n L X f - ( -n LXi)

i=l

i=l

Another reasonable estimator of (J2 is the sample variance

In practice, there is little difference between (j2 and S~ and you can use either one. Returning to the last example, we now see that the estimated standard
se error of the estimate of the mean is = (;/ yin.·
7.12 Example (The Skewness). Let fL and (J2 denote the mean and variance of a random variable X. The skewness is defined to be
{J(x - fL)2dF(x)} 3/2·
The skewness measures the lack of symmetry of a distribution. To find the plug-in estimate, first recall that fi = n- 1 Li Xi and (;2 = n- 1 Li(Xi - 11)2. The plug-in estimate of", is
· ~ Li(Xi - fi)3 (;3
7.13 Example (Correlation). Let Z = (X, Y) and let p = T(F) = JE(X fLx )(Y -fLy )/((Jx(Jy) denote the correlation between X and Y, where F(x, y) is bivariate. We can write

where
Tl (F) = Jx dF(z), T2(F) = Jy dF(z), T3(F) = Jxy dF(z), T4(F) = Jx2dF(z), T5(F) = J y2 dF(z),

and

a(tl' . .. , t5) =

t3 V(t4 _

- tlt2 tI)(t5 -

t~)

Replace F with Fn in Tl (F), ... , T5 (F), and take

102

7. Estimating the COF and Statistical Functionals

We get

p

=

2.:i (Xi - X n)(Yi - Y n)
----;:::c===========-'-r=========

V2.:i(Xi - X n)2V2.:i(Yi - Y n)2

which is called the sample correlation. _

7.14 Example (Quantiles). Let F be strictly increasing with density f. For
o < p < 1, the pth quantile is defined by T(F) = F-l(p). The estimate if
T(F) is F;:l(p). We have to be a bit careful since Fn is not invertible. To
avoid ambiguity we define

F;:l(p) = inf{x: Fn(x) ~ pl.

We call T(Fn) = F;:l(p) the pth sample quantile. _

Only in the first example did we compute a standard error or a confidence interval. How shall we handle the other examples? When we discuss parametric methods, we will develop formulas for standard errors and confidence intervals. But in our nonparametric setting we need something else. In the next chapter, we will introduce the bootstrap for getting standard errors and confidence intervals.

7.15 Example (Plasma Cholesterol). Figure 7.2 shows histograms for plasma
cholesterol (in mg/dl) for 371 patients with chest pain (Scott et al. (1978)).
The histograms show the percentage of patients in 10 bins. The first histogram
is for 51 patients who had no evidence of heart disease while the second
histogram is for 320 patients who had narrowing of the arteries. Is the mean
cholesterol different in the two groups? Let us regard these data as samples
from two distributions Fl and F2. Let J.Ll = I xdFl (x) and J.L2 = I xdF2(x)
denote the means of the two populations. The plug-in estimates are iiI =
I xdFn,l(X) = Xn,l = 195.27 and li2 = I xdFn,2(X) = X n,2 = 216.19. Recall
that the standard error of the sample mean Ii = ~ 2.:~=1 Xi is

which we estimate by where

~
se

(J~.L)

=

y(i5n

(5=

7.2 Statistical Functionals 103
For the two groups this yields se(lld = 5.0 and se(1l2) = 2.4. Approximate 95
percent confidence intervals for ILl and IL2 are III ± 2se(lld = (185,205) and 112 ± 2se(1l2) = (211,221).
e Now, consider the functional = T(F2) - T(Fd whose plug-in estimate is
e e = 112 - iiI = 216.19 - 195.27 = 20.92. The standard error of is
and we estimate this by
e An approximate 95 percent confidence interval for is e±2 se(en ) = (9.8,32.0).
This suggests that cholesterol is higher among those with narrowed arteries. We should not jump to the conclusion (from these data) that cholesterol causes heart disease. The leap from statistical evidence to causation is very subtle and is discussed in Chapter 16.·
100 150 200 250 300 350 400 plasma cholesterol for patients without heart disease
100 150 200 250 300 350 400 plasma cholesterol for patients with heart disease
FIGURE 7.2. Plasma cholesterol for 51 patients with no heart disease and 320 patients with narrowing of the arteries.

104 7. Estimating the COF and Statistical Functionals
7.3 Bibliographic Rernarks
The Glivenko-Cantelli theorem is the tip of the iceberg. The theory of distribution functions is a special case of what are called empirical processes which underlie much of modern statistical theory. Some references on empirical processes are Shorack and Wellner (1986) and van der Vaart and Wellner (1996).
7.4 Exercises
1. Prove Theorem 7.3.
2. Let Xl"'" Xn rv Bernoulli(p) and let YI , ... , Ym rv Bernoulli(q). Find the plug-in estimator and estimated standard error for p. Find an approximate 90 percent confidence interval for p. Find the plug-in estimator and estimated standard error for p - q. Find an approximate 90 percent confidence interval for p - q.
3. (Computer Experiment.) Generate 100 observations from a N(O,l) distribution. Compute a 95 percent confidence band for the CDF F (as described in the appendix). Repeat this 1000 times and see how often the confidence band contains the true distribution function. Repeat using data from a Cauchy distribution.
4. Let X I, ... , Xn rv F and let Fn (x) be the empirical distribution function. For a fixed x, use the central limit theorem to find the limiting distribution of Fn(x).
5. Let x and y be two distinct points. Find Cov(Fn(x), Fn(Y)).
6. Let Xl, ... ,Xn rv F and let F be the empirical distribution function.
Let a < b be fixed numbers and define B = T(F) = F(b) - F(a). Let
e e. = T(Fn) = Fn(b) - Fn(a). Find the estimated standard error of
Find an expression for an approximate 1 - a confidence interval for B.
7. Data on the magnitudes of earthquakes near Fiji are available on the website for this book. Estimate the CDF F(x). Compute and plot a 95 percent confidence envelope for F (as described in the appendix). Find an approximate 95 percent confidence interval for F(4.9) - F(4.3).

7.4 Exercises 105
8. Get the data on eruption times and waiting times between eruptions of the Old Faithful geyser from the website. Estimate the mean waiting time and give a standard error for the estimate. Also, give a 90 percent confidence interval for the mean waiting time. Now estimate the median waiting time. In the next chapter we will see how to get the standard error for the median.
9. 100 people are given a standard antibiotic to treat an infection and another 100 are given a new antibiotic. In the first group, 90 people recover; in the second group, 85 people recover. Let PI be the probability of recovery under the standard treatment and let P2 be the probability of
recovery under the new treatment. We are interested in estimating B =
PI - P2· Provide an estimate, standard error, an 80 percent confidence interval, and a 95 percent confidence interval for B.
10. In 1975, an experiment was conducted to see if cloud seeding produced rainfall. 26 clouds were seeded with silver nitrate and 26 were not. The decision to seed or not was made at random. Get the data from
http://lib.stat.cmu.edu/DASL/Stories/CloudSeeding.html
Let B be the difference in the mean precipitation from the two groups. Estimate B. Estimate the standard error of the estimate and produce a 95 percent confidence interval.

8
The Bootstrap

The bootstrap is a method for estimating standard errors and computing confidence intervals. Let Tn = g(Xl' .. . , Xn) be a statistic, that is, Tn is any function of the data. Suppose we want to know V F(Tn ), the variance of Tn. We have written VF to emphasize that the variance usually depends on the unknown distribution function F. For example, if Tn = Xn then VF(Tn) =
(J2 In where (J2 = J(x - p,)2dF(x) and p, = J xdF(x). Thus the variance of Tn
is a function of F. The bootstrap idea has two steps:

Step 2: Approximate V Fn (Tn) using simulation.

For Tn = X n , we have for Step 1 that VF~ (Tn) = 22 In where 22 = n- 1 2.:n=1(Xi -

'/I.

2

Xn). In this case, Step 1 is enough. However, in more complicated cases we

cannot write down a simple formula for V Fn (Tn) which is why we need Step

2. Before proceeding, let us discuss the idea of simulation.

108 8. The Bootstrap
8.1 Simulation
Suppose we draw an lID sample Y1 , ... , YB from a distribution G. By the law of large numbers,
j' Y n = B1 LB Yj~ ydG(y) =lE(Y)
j=l
as B ---+ 00. So if we draw a large sample from G, we can use the sample mean Y n to approximate lE(Y). In a simulation, we can make B as large as we like, in which case, the difference between Y nand lE(Y) is negligible. More generally, if h is any function with finite mean then
J B1 LB h(Yj)~ h(y)dG(y) = lE(h(Y))
j=l
as B ---+ 00. In particular,
B
B1L"..,.,(Yj - -Y2 )
j=l
p
---+
Hence, we can use the sample variance of the simulated values to approximate V(Y).
8.2 Bootstrap Variance Estimation
According to what we just learned, we can approximate VF" (Tn) by simulatio~. Now VF" (Tn) means "the variance of Tn if the distribution of the data is Fn." How can we simulate from the distribution of Tn when the data are
assumed to have distribution Fn? The answer is to simulate Xl, ... ,X~ from
in and then compute T~ = g(XI ,... ,X~). This constitutes one draw from
the distribution of Tn. The idea is illustrated in the following diagram:
Real world F ===} Xl"'" Xn ===} Tn = g(Xl , . .. , Xn)
Bootstrap world Fn ===} Xl,"" X~ ===} T;; = g(XI ,. .. ,X~)
How do we simulate Xl, ... ,X~ from in? Notice that in puts mass l/n at
each data point Xl"'" X n . Therefore,

8.2 Bootstrap Variance Estimation 109
drawing an observation from Fn is equivalent to drawing one point at random from the original data set.
Thus, to simulate Xl, ... ,X~ rv Fn it suffices to draw n observations with
replacement from Xl, ... , X n . Here is a summary:

Bootstrap Variance Estimation

1. Draw Xl,'" ,X~ rv Fn.
2. Compute T~ = g(XI ,... ,X~).

3. Repeat steps 1 and 2, B times, to get T~,l"'" T~,B'

4. Let

L - B ( B )2 1
Vboot = B

T~,b

1 B

LT~,r

(8.1)

b=l

r=l

8.1 Example. The following pseudocode shows how to use the bootstrap to estimate the standard error of the median.
Bootstrap for The Median
Given data X = (X(i), ... , X(n)):

T <- median(X) Tboot <- vector of length B for(i in i :B){
Xstar <- sample of size n from X (with replacement) Tboot[i] <- median(Xstar)
}
se <- sqrt(variance(Tboot))

The following schematic diagram will remind you that we are using two approximations:

not so small

small

r-"-,

r-"-,

::::0

'liFo (Tn) ::::0 Vboot·

8.2 Example. Consider the nerve data. Let () = T(F) = J(x-I1)3dF(x)/a 3 be the skewness. The skewness is a measure of asymmetry. A Normal distribution,

110 8. The Bootstrap for example, has skewness O. The plug-in estimate of the skewness is

To estimate the standard error with the bootstrap we follow the same steps as with the median example except we compute the skewness from each bootstrap sample. When applied to the nerve data, the bootstrap, based on B = 1,000 replications, yields a standard error for the estimated skewness of .16 . ·

8.3 Bootstrap Confidence Intervals

There are several ways to construct bootstrap confidence intervals. Here we discuss three methods.
Method 1: The Normal Interval. The simplest method is the Normal interval

Tn ± Za/2 5eboot

(8.2)

where 5eboot = JVboot is the bootstrap estimate of the standard error. This
interval is not accurate unless the distribution of Tn is close to Normal.
-- e Method 2: Pivotal Intervals. Let = T(F) and Bn = T(Fn) and define the
pivot Rn = e----n - e. Let e---~- ,l' ... ,e~,B denote bootstrap replications of en. ........... Let
H(r) denote the CDF of the pivot:

(8.3)

Define C~ = (a, b) where

a) a = e~n - H -1 ( 1-"2

(8.4)

It follows that

lP'(a:::;e:::;b)

lP'(a - en :::; e - en :::; b - en)

lP'(en - b :::; en - e :::; en - a)

lP'(en - b :::; Rn :::; en - a)

H(Bn - a) - H(en - b)

(1 - - H (H- 1

~)) H (H- 1 (~))

aa 1- - - - = 1- a.
22

8.3 Bootstrap Confidence Intervals 111

e. Hence, C~ is an exact 1 - a confidence interval for Unfortunately, a and b

depend on the unknown distribution H but we can form a bootstrap estimate

of H:

L 1
H(r) = B

B

I(R~,b S r)

(8.5)

b=l

rp where R~,b = e~,b -en. Let denote the f3 sample quantile of (R~,l"'" R~,B) e rp and let p denote the f3 sample quantile of (e~,l"'" e~,B)' Note that = ep- en. It follows that an approximate 1- a confidence interval is Cn = (0:, b)

where

a) e~n - H- - 1 ( 1- '2 = en - r~-a/2 = 2en - e~-a/2

b

(a) e- -H~-1 n

-2

= en - r~/2 = 2en - e~/2'

In summary, the 1 - a bootstrap pivotal confidence interval is

(8.6)

8.3 Theorem. Under weak conditions on T(F),

as n --+ 00, where Cn is given in (8.6).
Method 3: Percentile Intervals. The bootstrap percentile interval is defined by

The justification for this interval is given in the appendix.

8.4 Example. For estimating the skewness of the nerve data, here are the various confidence intervals.

Method Normal Pivotal Percentile

95% Interval
(1.44, 2.09) (1.48,2.11) (1.42, 2.03)

All these confidence intervals are approximate. The probability that T(F) is in the interval is not exactly 1 - a. All three intervals have the same level of accuracy. There are more accurate bootstrap confidence intervals but they are more complicated and we will not discuss them here.

112 8. The Bootstrap
8.5 Example (The Plasma Cholesterol Data). Let us return to the cholesterol data. Suppose we are interested in the difference of the medians. Pseudocode for the bootstrap analysis is as follows:

xl <- first sample

x2 <- second sample

nl <- length(xl)

n2 <- length(x2)

th.hat <- median(x2) - median(xl)

B <- 1000

Tboot <- vector of length B

for(i in l:B){

xxl <- sample of size nl with replacement from xl

xx2 <- sample of size n2 with replacement from x2

Tboot[i] <- median(xx2) - median(xxl)

}

se <- sqrt(variance(Tboot»

Normal

<- (th.hat - 2*se, th.hat + 2*se)

percentile <- (quantile(Tboot,.025), quantile(Tboot,.975»

pivotal <- ( 2*th.hat-quantile(Tboot,.975),

2*th.hat-quantile(Tboot, .025)

The point estimate is 18.5, the bootstrap standard error is 7.42 and the resulting approximate 95 percent confidence intervals are as follows:

Method Normal Pivotal Percentile

95% Interval (3.7, 33.3) (5.0, 34.0) (5.0, 33.3)

Since these intervals exclude 0, it appears that the second group has higher cholesterol although there is considerable uncertainty about how much higher as reflected in the width of the intervals. _

The next two examples are based on small sample sizes. In practice, statistical methods based on very small sample sizes might not be reliable. We include the examples for their pedagogical value but we do want to sound a note of caution about interpreting the results with some skepticism.

8.6 Example. Here is an example that was one of the first used to illustrate the bootstrap by Bradley Efron, the inventor of the bootstrap. The data are LSAT scores (for entrance to law school) and GPA.

8.3 Bootstrap Confidence Intervals 113

LSAT 576 635 558 578 666 580 555 661 651 605 653 575 545 572 594
GPA 3.39 3.30 2.81 3.03 3.44 3.07 3.00 3.43 3.36 3.13 3.12 2.74 2.76 2.88 3.96

Each data point is of the form Xi = (Yi, Zi) where Yi = LSATi and Zi =
GPAi. The law school is interested in the correlation
V B = J J(y - fLY)(Z -ILz)dF(y,z) J(y - fLy)2dF(y) J(z - fLz )2dF(z)
The plug-in estimate is the sample correlation
B = Li(Yi - Y)(Zi - Z) VLi(Yi - y)2 Li(Zi - Z)2
The estimated correlation is B = .776. The bootstrap based on B = 1000 gives se = .137. Figure 8.1 shows the data and a histogram of the bootstrap
replications B~1, ... ,B~B. This histogram is an approximation to the sampling
distribution of B. The Normal-based 95 percent confidence interval is .78 ±
2se = (.51,1.00) while the percentile interval is (.46,.96). In large samples, the
two methods will show closer agreement. _

8.7 Example. This example is from Efron and Tibshirani (1993). When drug

companies introduce new medications, they are sometimes required to show

bioequivalence. This means that the new drug is not substantially different

than the current treatment. Here are data on eight subjects who used medi-

cal patches to infuse a hormone into the blood. Each subject received three

treatments: placebo, old-patch, new-patch.

subject placebo old new old - placebo

1

9243 17649 16449

8406

2

9671 12013 14614

2342

3

11792 19979 17274

8187

4

13357 21816 23798

8459

5

9055 13850 12560

4795

6

6290 9806 10157

3516

7

12412 17208 16570

4796

8

18806 29044 26325

10238

new - old
-1200 2601 -2705 1982 -1290 351 -638 -2719

114 8. The Bootstrap

..,.
M
~ «
0.. (!l
<:> M
00
N

560

580

600

620

640

660

LSAT

<:>

0 .2

0 .4

0 .6

0 .8

1 .0

Bootst rap Samples

FIGURE 8.1. Law school data. The top panel shows the raw data. The bottom panel is a histogram of the correlations computed from each bootstrap sample.
Let Z = old - placebo and Y = new - old. The Food and Drug Adminis-
tration (FDA) requirement for bioequivalence is that 181 ::; .20 where

The plug-in estimate of 8 is

8=

=Y

=

-452.3
-- =

-0.0713.

Z 6342

se The bootstrap standard error is = 0.105. To answer the bioequivalence
question, we compute a confidence interval. From B = 1000 bootstrap replications we get the 95 percent interval (-0.24,0.15). This is not quite contained

8.4 Bibliographic Remarks 115
in (-0.20,0.20) so at the 95 percent level we have not demonstrated bioequivalence. Figure 8.2 shows the histogram of the bootstrap values. _

-0,3

·0.2

-0 .1

0 ,0

0 ,1

0 .2

Bootst rap Samples

FIGURE 8.2. Patch data.

8.4 Bibliographic Remarks
The bootstrap was invented by Efron (1979). There are several books on these topics including Efron and Tibshirani (1993), Davison and Hinkley (1997), Hall (1992) and Shao and Tu (1995). Also, see section 3.6 of van der Vaart and Wellner (1996).
8.5 Appendix
8.5.1 The Jackknife
There is another method for computing standard errors called the jackknife, due to Quenouille (1949). It is less computationally expensive than the boot-

116 8. The Bootstrap

strap but is less general. Let Tn = T(X1' ... ,Xn ) be a statistic and T( -i) denote the statistic with the ith observation removed. Let Tn = n- 1 L~=l T(-i)'
The jackknife estimate of var(Tn) is

n-1~

-2

Vjack = --nL)T(-i) -Tn)

i=l

and the jackknife estimate of the standard error is 5ejack = ylVjack. Under suitable conditions on T, it can be shown that Vjack consistently estimates
var(Tn) in the sense that Vjack/var(Tn)~ 1. However, unlike the bootstrap,
the jackknife does not produce consistent estimates of the standard error of sample quantiles.

8.5.2 Justification For The Percentile Interval
Suppose there exists a monotone transformation U = m(T) such that U rv N(¢, c2 ) where ¢ = m(B). We do not suppose we know the transformation,
U; only that one exists. Let = m( B~,b)' Let u~ be the f3 sample quantile of
the U;'s. Since a monotone transformation preserves quantiles, we have that U~/2 = m( B~/2)' Also, since U rv N(¢, c2), the Q/2 quantile of U is ¢ - Za/2C.
Hence u~/2 = ¢ - Za/2C. Similarly, ui-a/2 = ¢ + Za/2C, Therefore,
lP'(m(B~/2) <::: m(B) <::: m(Bi-a/2)) IP'(U~/2 <::: ¢ <::: Ui-a/2)
IP'(U - CZa/2 <::: ¢ <::: U + czad U-¢
IP'( -Za/2 <::: - - <::: Za/2) C
1- Q.
An exact normalizing transformation will rarely exist but there may exist approximate normalizing transformations.

8.6 Exercises
1. Consider the data in Example 8.6. Find the plug-in estimate of the correlation coefficient. Estimate the standard error using the bootstrap. Find a 95 percent confidence interval using the Normal, pivotal, and percentile methods.

8.6 Exercises 117
2. (Computer Experiment.) Conduct a simulation to compare the various bootstrap confidence interval methods. Let n = 50 and let T(F) = J(x - J.L)3dF(x)/(J"3 be the skewness. Draw YI , ... , Yn rv N(O,l) and set Xi = eY ;, i = 1, ... , n. Construct the three types of bootstrap 95 percent intervals for T(F) from the data Xl"'" X n . Repeat this whole thing many times and estimate the true coverage of the three intervals.
3. Let
where n = 25. Let B = T(F) = (q.75 - q.25)/l.34 where qp denotes the pth quantile. Do a simulation to compare the coverage and length of the following confidence intervals for B: (i) Normal interval with standard error from the bootstrap, (ii) bootstrap percentile interval, and (iii) pivotal bootstrap interval.
4. Let Xl"'" Xn be distinct observations (no ties). Show that there are
distinct bootstrap samples. Hint: Imagine putting n balls into n buckets.
5. Let Xl, ... , Xn be distinct observations (no ties). Let Xl"'" X~ denote a bootstrap sample and let -X*n = n -1 Lin=l X;:' Fm. d: IE(-X*nIXI , ... , X n ), V(X~IXI"'" X n ), IE(X~) and V(X~).
e 6. (Computer Experiment.) Let Xl, "',Xn Normal(/L, 1). Let B = eI' and let = eX. Create a data set (using J.L = 5) consisting of n=100 observations. (a) Use the bootstrap to get the se and 95 percent confidence interval for B. (b) Plot a histogram of the bootstrap replications. This is an estimate of the distribution of B. Compare this to the true sampling distribution of B.
e 7. Let Xl, ... , Xn rv Uniform(O, B). Let = Xmax = max{XI' ... , X n }. Gen-
erate a data set of size 50 with B = l.
e. e (a) Find the distribution of Compare the true distribution of to the
histograms from the bootstrap.

118 8. The Bootstrap

(b) This is a case where the bootstrap does very poorly. In fact, we can

pee e) prove that this is the case. Show that

= = 0 and yet P(B* =

e) ~ .632. Hint: show that, p(e* = e) = 1 - (1 - (l/n))n then take the

limit as n gets large.

I 8. Let Tn = X~, f.L = JE(Xd, OCk = IX-f.LlkdF(x) and ak = n- 1 L:~=l IXi -
Xnl k . Show that

9
Parametric Inference

We now turn our attention to parametric models, that is, models of the form

.;y = {f(x; 8): 8 E 8 }

(9.1)

where the 8 c ~k is the parameter space and 8 = (81, ... , 8k ) is the parameter. The problem of inference then reduces to the problem of estimating the parameter 8.
Students learning statistics often ask: how would we ever know that the distribution that generated the data is in some parametric model? This is an excellent question. Indeed, we would rarely have such knowledge which is why nonparametric methods are preferable. Still, studying methods for parametric models is useful for two reasons. First, there are some cases where background knowledge suggests that a parametric model provides a reasonable approximation. For example, counts of traffic accidents are known from prior experience to follow approximately a Poisson model. Second, the inferential concepts for parametric models provide background for understanding certain nonparametric methods.
We begin with a brief discussion about parameters of interest and nuisance parameters in the next section, then we will discuss two methods for estimating 8, the method of moments and the method of maximum likelihood.

120

9. Parametric Inference

9.1 Pararneter of Interest

Often, we are only interested in some function T(8). For example, if X rv N(IL, 0"2) then the parameter is 8 = (IL,O")' If our goal is to estimate IL then IL = T(8) is called the parameter of interest and 0" is called a nuisance parameter. The parameter of interest might be a complicated function of 8 as in the following example.

9.1 Example. Let Xl"'" Xn rv Normal(IL, 0"2). The parameter is 8 = (IL,O")
and the parameter space is e = {(IL, 0"): IL E Jl{, 0" > O}. Suppose that Xi is
the outcome of a blood test and suppose we are interested in T, the fraction of the population whose test score is larger than 1. Let Z denote a standard
Normal random variable. Then

T

(X; It J1D(X> 1) = 1 _ J1D(X < 1) = 1 _ JID

< 1: IL)

1-JID(Z< l:IL) =l-<I>C:IL).

The parameter of interest is T = T(IL, 0") = 1 - <I> ( (1 - IL) /0"). _ 9.2 Example. Recall that X has a Gamma(a, p) distribution if

where a, p > 0 and
is the Gamma function. The parameter is 8 = (a, p). The Gamma distri-
bution is sometimes used to model lifetimes of people, animals, and electronic equipment. Suppose we want to estimate the mean lifetime. Then
T(a, p) = JEg(Xd = ap. _
9.2 The Method of Moments
The first method for generating parametric estimators that we will study is called the method of moments. We will see that these estimators are not optimal but they are often easy to compute. They are are also useful as starting values for other methods that require iterative numerical routines.

9.2 The Method of Moments 121
Suppose that the parameter () = (()l, ... , ()k) has k components. For 1 <
j ::.; k, define the jth moment

(9.2)

and the jth sample moment

~_
O:j -

1 -n

~ ~Xi'j

i=1

(9.3)

9.3 Definition. The method of moments estimator ()n is defined to be the value of () such that

0:1 (en)

0:1

0:2(en )

0:2

(9.4)

Formula (9.4) defines a system of k equations with k unknowns.
9.4 Example. Let Xl"",Xn rv Bernoulli(p). Then 0:1 = JEp(X) = p and
a1 = n- 1 L~=1 Xi' By equating these we get the estimator

9.5 Example. Let Xl"'" Xn rv Normal(IL, (J2). Then, 0:1 = JEg(XI) = IL
and 0:2 = JEg(Xf) = Vg(Xl ) + (JEg(XI)j2 = (J2 + fL2. We need to solve the
equations1 1n -n L X i
i=1
1n -n LX;.
i=1
This is a system of 2 equations with 2 unknowns. The solution is
1 Recall that VeX) = JE(X2) - (JE(X))2 Hence, JE(X2) = VeX) + (JE(X))2

122

9. Parametric Inference

(j 2

1 n

~ L . ) Xi

-

-X n )2.

·

i=l

9.6 Theorem. Let en denote the method of moments estimator. Under appropriate conditions on the model, the following statements hold:

1. The estimate en exists with probability tending to 1. 2. The estimate is consistent: en ~ e.

3. The estimate is asymptotically Normal:

where

~ = gJEg(yyT)gT,

Y = (X,x2 , ... ,Xk)T, g = (gl,'" ,gk) and gj = 8c£/(e)/8e.

The last statement in the theorem above can be used to find standard errors and confidence intervals. However, there is an easier way: the bootstrap. We defer discussion of this until the end of the chapter.

9.3 Maxirnurn Likelihood

The most common method for estimating parameters in a parametric model is the maximum likelihood method. Let Xl, ..., Xn be IID with PDF f(x; e).

9.7 Definition. The likelihood function is defined by

I In
Ln(e) = f(Xi ; e).

(9.5)

i=l

The log-likelihood function is defined by fl.n (e) = log Ln (e).

The likelihood function is just the joint density of the data, except that we
e. treat it is a function of the parameter Thus, Ln : 8 --+ [0, (0). The
likelihood function is not a density function: in general, it is not true that
Ln (e) integrates to 1 (with respect to e).

9.8 Definition. The maximum likelihood estimator MLE, denoted by en, is the value of e that maximizes Ln(e).

9.3 Maximum Likelihood 123

p

0.0

0.2

0.4

0.6

0.8

1.0

FIGURE 9.1. Likelihood function for Bernoulli with n = 20 and ~~=1 Xi = 12. The
MLE is Pn = 12/20 = 0.6.

The maximum of £n (e) occurs at the same place as the maximum of Ln (e), so maximizing the log-likelihood leads to the same answer as maximizing the likelihood. Often, it is easier to work with the log-likelihood.

9.9 Remark. If we multiply Ln(e) by any positive constant c (not depending on e) then this will not change the MLE. Hence, we shall often drop constants in the likelihood function.

9.10 Example. Suppose that Xl' ... ' Xn rv Bernoulli(p). The probability function is f(x; p) = pX (1- p)l-x for x = 0,1. The unknown parameter is p. Then,

n

n

i=l

i=l

where S = Li Xi. Hence,

£n(P) = Slogp+ (n - S)log(l- p).

Take the derivative of £n(P), set it equal to 0 to find that the MLE is fin = Sjn. See Figure 9.1. ·

e 9.11 Example. Let Xl, ... ,Xn rv N(j1,(}2). The parameter is = (j1,(}) and
the likelihood function (ignoring some constants) is:

124 9. Parametric Inference

where X = n-l2::iXi is the sample mean and S2 = n- l 2::i(Xi - X)2. The
last equality above follows from the fact that 2::i (Xi -It? = nS2+ n(X -It)2 which can be verified by writing 2::i(Xi - fL)2 = 2::i(Xi - X + X - fL)2 and
then expanding the square. The log-likelihood is
nS2 n(X -It? Ji.(fL, a) = -n log a - -2a2- - ----'--::-2-a""'2--'--
Solving the equations

we conclude that Ii = X and (j = S. It can be verified that these are indeed
global maxima of the likelihood. _

9.12 Example (A Hard Example). Here is an example that many people find confusing. Let XI"",Xn rv Uni!(O,B). Recall that

!(x' B) = {l/B 0::'; x ~ B

,

0 otherWIse.

Consider a fixed value of B. Suppose B < Xi for some i. Then, !(Xi ;B) = 0
and hence Ln(B) = IIi !(Xi;B) = O. It follows that Ln(B) = 0 if any Xi > B.
Therefore, Ln(B) = 0 if B < X(n) where X(n) = max{XI"'" X n }. Now
consider any B ~ XCn)' For every Xi we then have that !(Xi ;B) = l/B so that
Ln(B) = IIi !(Xi ;B) = B- n. In conclusion,

See Fig~re 9.2. Now Ln(B) is strictly decreasing over the interval [XCn)' (0). Hence, Bn = XCn)' -
The maximum likelihood estimators for the multivariate Normal and the multinomial can be found in Theorems 14.5 and 14.3.
9.4 Properties of Maxirnurn Likelihood Estirnators
Under certain conditions on the model, the maximum likelihood estimator Bn possesses many properties that make it an appealing choice of estimator. The main properties of the MLE are:

9.4 Properties of Maximum Likelihood Estimators 125

"l

<t;' co
H
'-"" "-,
.o,n;

I I I III " I III
.o,; "

0.0

0.5

1.0

1.5

2.0

ex = .75

""

'"

.0,; "

'"

0.0

0 .5

1.0

1.5

2 .0

e= 1 x

"l

.'",; 'R ?m
""" .0,; "

?m
''""

0.0

0.5

1.0

1.5

x () = 1.25

~0 ~
t..l
on d

.0,;

2.0

0.6

0.8

e 1.0

1.2

I .'

FIGURE 9.2. Likelihood function for Uniform (0, e). The vertical lines show the
° observed data. The first three plots show f(x; e) for three different values of e.
When e < XCn) = max{X1 , ... , X n }, as in the first plot, f(XCn); e) = and hence Ln(e) = rr~=l f(Xi ;e) = 0. Otherwise f(Xi ; e) = lie for each i and hence
Ln(e) = rr~=l f(Xi; e) = (l/e)n. The last plot shows the likelihood function.

126

9. Parametric Inference

en 1. The MLE is consistent: ~ 8* where 8* denotes the true value of the
parameter 8;

en g(en) 2. The MLE is equivariant: if is the MLE of 8 then

is the MLE of

g( 8);

(e - 3. The MLE is asymptotically Normal:

8*)/se ~ N(O, 1); also, the

estimated standard error Se can often be computed analytically;

4. The MLE is asymptotically optimal or efficient: roughly, this means that among all well-behaved estimators, the MLE has the smallest variance, at least for large samples;

5. The MLE is approximately the Bayes estimator. (This point will be explained later.)

We will spend some time explaining what these properties mean and why they are good things. In sufficiently complicated problems, these properties will no longer hold and the MLE will no longer be a good estimator. For now we focus on the simpler situations where the MLE works well. The properties we discuss only hold if the model satisfies certain regularity conditions. These are essentially smoothness conditions on f(x; 8). Unless otherwise stated, we shall tacitly assume that these conditions hold.

9.5 Consistency of Maxirnurn Likelihood Estirnators

Consistency means that the MLE converges in probability to the true value.
To proceed, we need a definition. If f and g are PDF'S, define the KullbackLeibler distance 2 between f and g to be

J D(j,g) = f(x) log (~~:D dx.

(9.6)

It can be shown that D(j, g) ~ 0 and D(j,1) = O. For any 8, VJ E 8 write D(8, 1/;) to mean D(j(x; 8), f( x; 1/;)).
We will say that the model ~ is identifiable if 8 # 1/; implies that D(8, 1/;) >
O. This means that different values of the parameter correspond to different distributions. We will assume from now on the the model is identifiable.

2This is not a distance in the formal sense because D(f, g) is not symmetric.

9.6 Equivariance of the MLE 127
Let e* denote the true value of e. Maximizing t;n(e) is equivalent to maximizing
This follows since Mn(e) = n- 1 (t;n(e) -t;n(e*)) and t;n(e*) is a constant (with respect to e). By the law of large numbers, lvIn (e) converges to
J ( e)) . f(X; log f(x; e*) j(x; e*)dx J (f(X; e*)) - log f(x; e) f(x; e*)dx -D(e*, e).
Hence, Mn(e) ;:::; -D(e*, e) which is maximized at e* since -D(e*, e*) = 0
and - D( e*, e) < 0 for e i=- e*. Therefore, we expect that the maximizer will
tend to e*. To prove this formally, we need more than .l'vln(e)~ - D(e*, e).
We need this convergence to be uniform over e. We also have to make sure
that the function D( e*, e) is well behaved. Here are the formal details.
9.13 Theorem. Let e* denote the true value of e. Define

and M(e) = -D(e*, e). Suppose that (9.7)

and that, for every E > 0,

sup M(e) < M(e*).

(9.8)

II:III-II.I::>E

~p
Let en denote the MLE. Then en ---+ e*.

The proof is in the appendix.

9.6 Equivariance of the MLE
9.14 Theorem. Let T = g(e) be a function of e. Let en be the MLE of e. Then Tn = g(en) is the MLE of T.

128

9. Parametric Inference

PROOF. Let h = g-l denote the inverse of g. Then en = h(Tn). For any T,
£(T) = TId(Xi; h(T)) = TId(Xi; 8) = £(8) where 8 = h(T). Hence, for any T,
s: £n(T) = £(8) £(e) = £n(T) .·

9.15 Example. Let Xl, ... , Xn rv N(8,1). The MLEfor 8 is 8n = X n. Let
e T = ee. Then, t he MLE for T I.S T- = e = eX .·

9.7 Asymptotic Normality
It turns out that the distribution of 8n is approximately Normal and we can compute its approximate variance analytically. To explore this, we first need a few definitions.

9.16 Definition. The score function is defined to be

s(X,, 8) =

8log f(X; 8) a8'

(9.9)

The Fisher information is defined to be

Ln V e(s(Xi;8)).
i=l

(9.10)

For n = 1 we will sometimes write 1(8) instead of h (8). It can be shown that lEe(s(X; 8)) = O. It then follows that Ve(s(X; 8)) = lEe(s2(X; 8)). In fact, a further simplification of In (8) is given in the next result.

9.17 Theorem. In(8) = nI(8). Also,

1(8) = -lEe ( a2lo~;;X; 8) )

-J(a2lo~:2(X; 8) ) f(x; 8)dx.

(9.11)

9.7 Asymptotic Normality 129

VV(e 9.18 Theorem (Asymptotic Normality of the MLE). Let se =

n ).

Under appropriate regularity conditions, the following hold:

(en - 8) ~ N(O, 1).
se
2. Let se = V1/In(en). Then,
(en:: 8) ~ N(O, 1). se

(9.12) (9.13)

en The proof is in the appendix. The first statement says that ~ N (8, se)

en J1/In where the approximate standard error of is se =

(8). The second

statement says that this is still true even if we replace the standard error by

its estimated standard error se = V1/In(en).

Informally, the theorem says that the distribution of the MLE can be ap-

proximated with N(8,se2 ). From this fact we can construct an (asymptotic)

confidence interval.

9.19 Theorem. Let

en = (en - Za/2 se, en + Za/2 se).

en) Then, lP'e(8 E ---+ 1- Q as n ---+ 00.

PROOF. Let Z denote a standard normal random variable. Then,

lP'e(8 E en)

lP'e (en - Za/2 se ::.; 8 ::.; en + Za/2 se)
~ lP'e ( -Za/2 ::.; 8n 8 ::.; Za/2 )

---+ IP'( -Za/2 < Z < Za/2) = 1 - Q. _

For Q = .05, Za/2 = 1.96 ~ 2, so:

is an approximate 95 percent confidence interval.

(9.14)

130

9. Parametric Inference

When you read an opinion poll in the newspaper, you often see a statement
like: the poll is accurate to within one point, 95 percent of the time. They are
se. simply giving a 95 percent confidence interval of the form en ± 2

Li 9.20 Example. Let Xl, ... , Xn rv Bernoulli(p). The lVILE is Pn =

Xdn

and J(x;p) = pX(1- p)l-x, log J(x;p) = x logp + (1 - x) 10g(1 - p),

X I-X 8(X;p) = - - - - ,
p I-p

and

X I-X

-s'(X;p) = p2 + (1- p)2'

Thus,

,

p (1 - p)

1

I(p) = lEp ( -8 (X;p)) = p2 + (1 _ p)2 = p(1 _ p)

Hence,

1
se = ----===

}1/2 1 = {P(1 _ p)

J1n(Pn) JnI(Pn)

n

An approximate 95 percent confidence interval is

)}1/2 - Pn

±

2

{

~
Pn

(1

;:

~
Pn

9.21 Example. Let Xl, ... , Xn rv N(e, cr2 ) where cr2 is known. The score function is 8(X; e) = (X - e)/cr2 and 8'(X; e) = -1/cr2 so that h(e) = l/cr2. The lVILE is en = X n. According to Theorem 9.18, Xn ~ N(e,cr 2/n). In this
case, the Normal approximation is actually exact. _

9.22 Example. Let Xl"'" Xn rv Poisson(A). Then Xn = Xn and some cal-

culations show that h (A) = 1/A, so

fi se =

1

VnI(Xn ) = -;;:.

Therefore, an approximate 1- ex confidence interval for A is Xn ± Za/2VXn/n.
-

9.8 Optirnality
Suppose that Xl"'" Xn rv N(e, cr2). The lVILE is en = X n. Another reasonable estimator of e is the sample median en. The lVILE satisfies

It can be proved that the median satisfies

9.9 The Delta Method 131

This means that the median converges to the right value but has a larger variance than the MLE.
More generally, consider two estimators Tn and Un and suppose that

and that
We define the asymptotic relative efficiency of U to T by ARE(U, T) = t 2/u 2.
In the Normal example, ARE(en, en) = 2/7r = .63. The interpretation is that
if you use the median, you are effectively using only a fraction of the data.
en en 9.23 Theorem. If is the MLE and is any other estimator then 3

Thus, the MLE has the smallest (asymptotic) variance and we say that the MLE is efficient or asymptotically optimal.
This result is predicated upon the assumed model being correct. If the model is wrong, the MLE may no longer be optimal. We will discuss optimality in more generality when we discuss decision theory in Chapter 12.
9.9 The Delta Method
Let T = g( e) where g is a smooth function. The maximum likelihood estimator of T is T = g(e). Now we address the following question: what is the distribution of T?
9.24 Theorem (The Delta Method). If T = g( e) where g is differentiable and g'(e) -=I- 0 then
(9.15)
3The result is actually more subtle than this but the details are too complicated to consider here.

132

9. Parametric Inference

Hence, if

Cn = (Tn - Za/2 seWn), Tn + Za/2 seWn))

then lP'e(T E Cn) --+ 1 - a as n --+ 00.

(9.16) (9.17)

9.25 Example. Let Xl, ... , Xn rv Bernoulli(p) and let 1jJ = g(p) = 10g(p/(I-
p)). The Fisher information function is J(p) = 1/(p(1 - p)) so the estimated
standard error of the !viLE Pn is

The !viLE of 1jJ is :j; = log P/ (1 - p). Since, g' (p) = 1/(p( 1 - p)), according to
the delta method
An approximate 95 percent confidence interval is
9.26 Example. Let Xl"'" Xn rv N(/L, er2). Suppose that fL is known, er is unknown and that we want to estimate '1jJ = loger. The log-likelihood is £(er) =
2!2 -n log er - Li (Xi - fL)2. Differentiate and set equal to 0 and conclude that

To get the standard error we need the Fisher information. First,

log f (X; er) = -

log er -

(X fL)2
-'----2er----=-2-'----

with second derivative

and hence

9.10 Multiparameter Models 133

se Therefore, = &n/J2n. Let .1jJ = g(u) = logu. Then,~n = logan. Since

g' = l/u,

=- ~ ~

1 &n

1

se(~n) =

roL = roL'

Un V 2n V 2n

and an approximate 95 percent confidence interval is ~ ± 2/J2n.·

9.10 Multiparameter Models
These ideas can directly be extended to models with several parameters. Let
e = (e 1 , ... , ek) and let e = (e1 , ... , ek) be the MLE. Let fin = L~=11og f(Xi; e),

Define the Fisher Information Matrix by

lEe(H11)

r lEe(H2d

In(e)=-

...

lEe (Hk1 )

lEe(H12) lEe (H22)
...
lEe (Hk2)

Let In(e) = I;;l(e) be the inverse of In.

1 llEEee((HH2lkk)) .
lEe (Hkk )

9.27 Theorem. Under appropriate regularity conditions,

(9.18)

e e, Also, if j is the jth component of then
(9.19)
se; where = In(j,j) is the /h diagonal element of In- The approximate co-
variance of ej and ek is Cov(ej , ed :::::: I n(j, k).
There is also a multiparameter delta method. Let T = g(e1 , ... , ek ) be a function and let
8g
8e1 "ilg=
8g
8ek be the gradient of g.

134

9. Parametric Inference

e9.28 Theorem (Multiparameter delta method). Suppose that '\1g evaluated at is not O. Let l' = g(1i). Then

(T - T) s~e(~T) ~ N(O, 1)

where

se(1') = V(Vg)T in(Vg),

e in = In(en ) and Vg is '\1g evaluated at = e.

(9.20)

9.29 Example. Let Xl, ... , Xn rv N(fJ, (j2). Let T = g(fJ, (j) = (j / fJ. In Excer-
cise 8 you will show that
2~ ] .
,,2
Hence,

The gradient of 9 is Thus,

'\1g=

(

- 1(,2Y)
~

.

a 1

2

Ji4 + 2Ji2'

·

9.11 The Parametric Bootstrap
For parametric models, standard errors and confidence intervals may also be estimated using the bootstrap. There is only one change. In the nonparametric
bootstrap, we sampled Xr, ... ,X~ from the empirical distribution Fn. In the
parametric bootstrap we sample instead from f(x; en). Here, en could be the MLE or the method of moments estimator.
9.30 Example. Consider example 9.29. To get the bootstrap standard er-
ror, simulate XI""'X~ rv N(Ji,a2), compute Ji* = n-1LiX;* and a2* =
n- l Li (X;* - Ji*)2. Then compute 1'* = g(Ji*, a*) = a* /Ji*. Repeating this B
times yields bootstrap replications

and the estimated standard error is

9.12 Checking Assumptions 135

seboot =

·

The bootstrap is much easier than the delta method. On the other hand, the delta method has the advantage that it gives a closed form expression for the standard error.

9.12 Checking Assurnptions
If we assume the data come from a parametric model, then it is a good idea to check that assumption. One possibility is to check the assumptions informally by inspecting plots of the data. For example, if a histogram of the data looks very bimodal, then the assumption of Normality might be questionable. A formal way to test a parametric model is to use a goodness-of-fit test. See Section 10.S.

9.13 Appendix

9.13.1 Proofs

PROOF OF THEOREM 9.13. Since en maximizes Mn(e), we have Mn(en) ::;, l'vln (e*). Hence,

M(e*) - M(en)

Mn(e*) - M(en) + M(e*) - Mn(e*) < Mn(en) - M(en) + M(e*) - Mn(e*) < sup IMn(e) - M(e)1 + M(e*) - Mn(e*)
e ~o

where the last line follows from (9.7). It follows that, for any 6 > 0,

Pick any E > O. By (9.S), there exists 6 > 0 such that Ie - e*1 ::;, E implies that
M(e) < M(e*) - 6. Hence,
1F'(len - e*1 > E) <::: IF' (M(en ) < M(e*) - 6) --+ O. ·
Next we want to prove Theorem 9.1S. First we need a lemma.

136 9. Parametric Inference

9.31 lemma. The score function satisfies

lEe [s(X; 8)] = O.

I PROOF. Note that 1 = f(x; 8)dx. Differentiate both sides of this equation

to conclude that
o=

:8 J J f(x; 8)dx = :8f(x; 8)dx

J J f8(j(~x~;e8)) f(x; 8)dx =

81 f'( 8) oga8 X; f(x; 8)dx

Js(x; 8)f(x; 8)dx = lEes(X; 8). ·

PROOF OF THEOREM 9.18. Let £.(8) = log£(8). Then,

0= tee) ~ t(8) + (e - 8)£."(8).
e- Rearrange the above equation to get 8 = -£.'(8)/£."(8) or, in other words,

~ vn(8 -

8) =

-.~f£i.J"((88))

=

TOP BOTTOM'

Let Yi = a log f (Xi; 8) / a8. Recall that IE(Yi) = 0 from the previous lemma and also V(Yi) = 1(8). Hence,

-a by the central limit theorem. Let Ai = 2 log f(Xi;8)/a82 . Then IE(Ai) =

1(8) and

BOTTOM = A~1(8)

by the law of large numbers. Apply Theorem 5.5 part (e), to conclude that

1) ~
vn(8 -

8) ~

1W(8)

=d

N

( 0, 1(8)

.

Assuming that 1(8) is a continuous function of 8, it follows that I (en) ~ I (8). Now
8n - 8 se

9.13 Appendix 137
The first term tends in distribution to N(O,l). The second term tends in probability to 1. The result follows from Theorem 5.5 part (e). _
OUTLINE OF PROOF OF THEOREM 9.24. Write

Thus,

and hence

fol(igj(' T(8n)

-

T)

~
~

Cjffl\(8)(e
V n1 \ U) n

_ 8) .

Theorem 9.18 tells us that the right-hand side tends in distribution to a N(O,l).

Hence,

fol(ij(Tn g'(8)

-

T)

~

() !V 0,1

or, in other words,

where

2(~ ) _ (g'(8))2 se Tn - nI(8)

en The result remains true if we substitute for 8 by Theorem 5.5 part (e). _

9.13.2 Sufficiency
A statistic is a function T(xn) of the data. A sufficient statistic is a statistic that contains all the information in the data. To make this more formal, we need some definitions.
9.32 Definition. Write xn ++ yn if f(x n ;8) = cf(yn; 8) for some constant c that might depend on xn and yn but not 8. A statistic T(xn) is sufficient ifT(xn) ++ T(yn) implies that xn ++ yn.
Notice that if xn ++ yn, then the likelihood function based on xn has the same shape as the likelihood function based on yn. Roughly speaking, a statistic is sufficient if we can calculate the likelihood function knowing only T(xn).
9.33 Example. Let Xl, ... , Xn rv Bernoulli(p). Then £(p) = pS (1 _ p)n-S
where S = L:i Xi, so S is sufficient. -

138

9. Parametric Inference

9.34 Example. Let Xl"'" Xn rv N(/L, 0-) and let T = (X, S). Then
f(xn; IL, 0-) = (o-~) n exp { _ ~~:} exp { _ n(~~/)2}

where S2 is the sample variance. The last expression depends on the data only through T and therefore, T = (X, S) is a sufficient statistic. Note that U = (17 X, S) is also a sufficient statistic. If I tell you the value of U then you can easily figure out T and then compute the likelihood. Sufficient statistics are far from unique. Consider the following statistics for the N(/L, 0- 2 ) model:

TI(xn) T2(xn) T3(xn) T4(xn)

(Xl,'" ,Xn ) (X,S) X (X,S,X3).

The first statistic is just the whole data set. This is sufficient. The second is also sufficient as we proved above. The third is not sufficient: you can't compute £(/L, 0-) if I only tell you X. The fourth statistic T4 is sufficient. The statistics TI and T4 are sufficient but they contain redundant information. Intuitively, there is a sense in which T2 is a "more concise" sufficient statistic than either TI or T4. We can express this formally by noting that T2 is a function of TI and similarly, T2 is a function of T4. For example, T2 = g(T4) where g(al' a2, a3) = (aI, a2) .·

9.35 Definition. A statistic T is minimal sufficient if (i) it is sufficient; and (ii) it is a function of every other sufficient statistic.
9.36 Theorem. T is minimal sufficient if the following is true:

A statistic induces a partition on the set of outcomes. We can think of sufficiency in terms of these partitions.
9.37 Example. Let X I ,X2 rv Bernoulli(8). Let V = Xl, T
U = (T, Xd. Here is the set of outcomes and the statistics:
VTU
o 0 o 0 (0,0) o 1 o 1 (1,0)
1 0 1 1 (1,1) 1 1 1 2 (2,1)

9.13 Appendix 139
The partitions induced by these statistics are:
v ---+ {(O,O), (O,ln, {(I,O),(I,ln
T ---+ {(O, On, {(O, 1), (1, on, {(I, In
u ---+ {(O, on, {(O, In, {(I, on, {(I, In.
Then V is not sufficient but T and U are sufficient. T is minimal sufficient; U is not minimal since if xn = (1,0) and yn = (0,1), then xn B yn yet
U(xn) cI u(yn). The statistic W = 17T generates the same partition as T. It
is also minimal sufficient. _
9.38 Example. For a N(/-L, (J2) model, T = (X, S) is a minimal sufficient
statistic. For the Bernoulli model, T = Li Xi is a minimal sufficient statistic.
For the Poisson model, T = Li Xi is a minimal sufficient statistic. Check that T = (Li Xi, Xd is sufficient but not minimal sufficient. Check that T = Xl is not sufficient. _
I did not give the usual definition of sufficiency. The usual definition is this:
T is sufficient if the distribution of xn given T(xn) = t does not depend on
B. In other words, T is sufficient if f(Xl,"" xnlt; B) = h(Xl,"" Xn , t) where h is some function that does not depend on B.
9.39 Example. Two coin flips. Let X = (Xl, X 2 ) rv Bernoulli(p). Then T =
Xl + X 2 is sufficient. To see this, we need the distribution of (Xl, X 2 ) given
T = t. Since T can take 3 possible values, there are 3 conditional distributions to check. They are: (i) the distribution of (Xl, X 2 ) given T = 0:
P(XI = 0, X 2 = 0lt = 0) = 1, P(XI = 0, X 2 = lit = 0) = 0,
P(XI = 1, X 2 = 0lt = 0) = 0, P(XI = 1, X 2 = lit = 0) = 0;
(ii) the distribution of (Xl ,X2 ) given T = 1:
P(XI = 0,X2 = 0lt = 1) = 0, P(XI = 0,X2 = lit = 1) = 21 '
1
P(XI = I,X2 = 0lt = 1) = 2,P(XI = I,X2 = lit = 1) = 0; and
(iii) the distribution of (Xl, X 2 ) given T = 2:
P(XI = 0, X 2 = 0lt = 2) = 0, P(XI = 0, X 2 = lit = 2) = 0,
P(XI = 1, X 2 = 0lt = 2) = 0, P(XI = 1, X 2 = lit = 2) = 1.
None of these depend on the parameter p. Thus, the distribution of Xl, X 2 1T
does not depend on B, so T is sufficient. _

140

9. Parametric Inference

9.40 Theorem (Factorization Theorem). T is sufficient if and only if there are functions g(t, 8) and h(x) such that f(x n;8) = g(t(xn), 8)h(xn).
9.41 Example. Return to the two coin flips. Let t = Xl + X2. Then

f(XI; 8)f(X2; 8) 8X1(1 _ 8)I-X18X2(1 _ 8)I-X2
g(t,8)h(XI,X2)
where g(t,8 ) = 8t (1 - 8) 2-t and h(XI, X2 ) = l. Therefore, T = Xl + X 2 is
sufficient. _

Now we discuss an implication of sufficiency in point estimation. Let 8 be
an estimator of 8. The Rao-Blackwell theorem says that an estimator should
only depend on the sufficient statistic, otherwise it can be improved. Let
e) R( 8, 8) = lEe (8 - 2 denote the !VISE of the estimator.
e 9.42 Theorem (Rao-Blackwell). Let be an estimator and let T be a sufficient
statistic. Define a new estimator by

8 = lE(eIT).
Then, for every 8, R(8,8) :S R(8, B).
9.43 Example. Consider flipping a coin twice. Let 8 = Xl. This is a welldefined (and unbiased) estimator. But it is not a function of the sufficient
statistic T = Xl + X 2 . However, note that (j = lE(XIIT) = (Xl + X 2 )/2. By
the Rao-Blackwell Theorem, 8 has MSE at least as small as 8 = Xl. The
same applies with n coin flips. Again define 8 = Xl and T = Li Xi. Then
(j = lE(XIIT) = n- l LiXi has improved !VISE. _

9.13.3 Exponential Families
Most of the parametric models we have studied so far are special cases of a general class of models called exponential families. We say that {f(x; 8) : 8 E 8} is a one-parameter exponential family if there are functions T/(8), B(8), T(x) and h(x) such that
f(x; 8) = h(x)er)(e)T(x)-B(e).
It is easy to see that T(X) is sufficient. We call T the natural sufficient statistic.

9.13 Appendix 141

9.44 Example. Let X rv Poisson(e). Then

+ex -e 1

f(x; e) =

= ,eX]oge-e

x.

x.

and hence, this is an exponential family with '17 (e) = log e, B( e) = e, T(x) = x,
h(x) = l/x!. _

9.45 Example. Let X rv Binomial(n, e). Then
C f(x; e) = (~)ex(1- e)n-x = (~) exp {x log ~ e) + nlog(l- e)}.

In this case,

C~ 17(e) = log

e) ,B(e) = -nlog(e)

and T(x) = x, h(x) = (nx ).
We can rewrite an exponential family as

f(x; 71) = h(x)eT1T(x)-A(r1)

where 71 = 71(e) is called the natural parameter and
J A(I7) = log h(x)e'7T(xl dx.

For example a Poisson can be written as f(x; 17) = e'7x- e" Ix! where the natural
parameter is '17 = log e.
Let Xl, ... , Xn be IID from an exponential family. Then f(x n;e) is an
exponential family:

where hn(xn) = IIi h(Xi), Tn(xn) = L:i T(Xi) and Bn(e) implies that L:i T(Xi) is sufficient.

nB(e). This

9.46 Example. Let Xl,"" Xn rv Uniform(O, e). Then

.
j(xn; e)

=

1
en J(X(n)

<:::

e)

where J is 1 if the term inside the brackets is true and 0 otherwise, and
x(n) = max{xl, ... ,Xn }. Thus T(xn) = max{Xl, ... ,Xn} is sufficient. But
since T(xn) cJ L:i T(Xi)' this cannot be an exponential family. _

142

9. Parametric Inference

9.47 Theorem. Let X have density in an exponential family. Then,

lE(T(X)) = A'(rl), V(T(X)) = A"(f)).

If () = (()ll"" ()k) is a vector, then we say that f(x; ()) has exponential

family form if

~ {t nt~) f(x; 0) h(x) exp

ryj(B)Tj(x) -

}.

Again, T = (Tl , ... , Tk ) is sufficient. An IID sample of size n also has exponential form with sufficient statistic (Li Tl (Xi)' ... , Li Tk (Xi)).
9.48 Example. Consider the normal family with () = (,L,O) Now,

This is exponential with

Hence, with n lID samples, (Li Xi, Li Xl) is sufficient. As before we can write an exponential family as
I where A(f)) = log h(x)eTTex)r]dx. It can be shown that
lE(T(X)) = A(f)) V(T(X)) = A(rl), where the first expression is the vector of partial derivatives and the second is the matrix of second derivatives.
9.13.4 Computin9 Maximum Likelihood Estimates
In some cases we can find the MLE () analytically. More often, we need to find the MLE by numerical methods. We will briefly discuss two commonly

9.13 Appendix 143
used methods: (i) Newton-Raphson, and (ii) the EM algorithm. Both are
e iterative methods that produce a sequence of values eo, 1 , ... that, under
ideal conditions, converge to the MLE e. In each case, it is helpful to use a good starting value eO. Often, the method of moments estimator is a good
starting value. NEWTON-RAPHSON. To motivate Newton-Raphson, let's expand the deriva-
e tive of the log-likelihood around j :

e Solving for gives

~ . l (ej )
e';:::j eJ - r(e j )"

This suggests the following iterative scheme:

In the multiparameter case, the mle 8 = (8 8 1 , ... , k ) is a vector and the

method becomes

8H1 = ej - H-1g' (ej )

where l (ej ) is the vector of first derivatives and H is the matrix of second
derivatives of the log-likelihood. THE EM ALGORITHM. The letters EM stand for Expectation-Maximization.
The idea is to iterate between taking an expectation then maximizing. Suppose we have data Y whose density f(y; e) leads to a log-likelihood that is hard to maximize. But suppose we can find another random variable Z such
I that f(y; e) = f(y, z; e) dz and such that the likelihood based on f(y, z; e)
is easy to maximize. In other words, the model of interest is the marginal of a model with a simpler likelihood. In this case, we call Y the observed data and Z the hidden (or latent or missing) data. If we could just "fill in" the missing data, we would have an easy problem. Conceptually, the EM algorithm works by filling in the missing data, maximizing the log-likelihood, and iterating.

9.49 Example (Mixture of Normals). Sometimes it is reasonable to assume that the distribution of the data is a mixture of two normals. Think of heights of people being a mixture of men and women's heights. Let ¢(y; IL, (J) denote a normal density with mean IL and standard deviation (J. The density of a mixture of two Normals is

144

9. Parametric Inference

The idea is that an observation is drawn from the first normal with probability p and the second with probability I-p. However, we don't know which Normal it was drawn from. The parameters are 8 = (fLo,uo,fLl,Ul,P). The likelihood function is
I In
£(8) = [(1 - P)¢(Yi; fLo, uo) + P¢(Yi; ILl, udl·
i=l
Maximizing this function over the five parameters is hard. Imaging that we were given extra information telling us which of the two normals every observation came from. These "complete" data are of the form (Y1 , Zd,···, (Yn, Zn), where Zi = 0 represents the first normal and Zi = 1 represents the second. Note that JP'(Zi = 1) = p. We shall soon see that the likelihood for the complete data (Y1 , Zd, ... , (Yn, Zn) is much simpler than the likelihood for the observed data Y1, ... , Yn .·

Now we describe the EM algorithm.

The EM Algorithm (0) Pick a starting value 8°. Now for j = 1,2, ... , repeat steps 1 and 2 below: (1) (The E-step): Calculate

zn The expectation is over the missing data treating 8i and the observed
data yn as fixed. (2) Find 81+1 to maximize J(818j ).
We now show that the EM algorithm always increases the likelihood, that is, £(81+1) ~ £(8j ). Note that

and hence

9.13 Appendix 145

J(eJ+lle j ) _ IE . (log f(znlYn;eJ+l) I yn = yn)

BJ

f(ZnlYn; eJ )

.+1 .
J(eJ leJ )

+

K(iJ,

iJ+d

where fj = f(yn; ej ) and fJ+l = f(yn; eJ+l) and K(j, g) = I f(x) log(j(x)/g(x)) dx
is the Kullback-Leibler distance. Now, eJ+l was chosen to maximize J(ele j ). Hence, J(eJ+llej ) 2: J(ej le j ) = O. Also, by the properties of Kullback-Leibler divergence, K(iJ,iJ+d 2: O. Hence, £(eJ+l) 2: £(e j ) as claimed.

9.50 Example (Continuation of Example 9.49). Consider again the mixture of

two normals but, for simplicity assume that p = 1/2, (}l = (}2 = l. The density

is

f(y; /.Ll, IL2) =

1
2"¢(Y;

/.La,

1)

+

1
2"¢(Y;

ILl,

1).

Directly maximizing the likelihood is hard. Introduce latent variables Zl, ... , Zn where Zi = 0 if Yi is from ¢(y; /.La, 1), and Zi = 1 if Yi is from ¢(y; /.Ll, 1),
IP'(Zi = 1) = P(Zi = 0) = 1/2, f(YilZi = 0) = ¢(y; /.La, 1) and f(YilZi = 1) =
¢(y; /.Ll, 1). So f(y) = 2::;=0 f(y, z) where we have dropped the parameters

from the density to avoid notational overload. We can write

f(z, y) = f(z)f(ylz) = ~¢(y; /.La, l)l-z¢(y; /.Ll, l)z.

Hence, the complete likelihood is
n

i=l
The complete log-likelihood is then

2.:(1 - 2.: ~

1n

£. = -2"

1n
Zi)(Yi - /.La) - 2" Zi(Yi - /.Ld·

i=l

i=l

And so

J(ele j ) = -~ t ( l - IE(Zilyn, ej))(Yi - /.La) - ~ t IE(Zilyn, ej))(Yi - ILd·

i=l

i=l

Since Zi is binary, IE(Zilyn,e j ) = IP'(Zi = 1Iyn ,ej ) and, by Bayes' theorem,

IP'(Zi = llyn, ei) =

f(ynlZi = 1; ej )IP'(Zi = 1)
f(ynlZi = 1; ej )IP'(Zi = 1) + f(ynlZi = 0; ej )IP'(Zi = 0)

¢(Yi; ILL 1)~ ¢(Yi;/.L{,l)~ +¢(Yi;/.Lb,l)~

¢(Yi; /.L{, 1)
¢(Yi; /.L{, 1) + ¢(Yi; /.Lb, 1)
T( i).

146

9. Parametric Inference

Take the derivative of J(elej ) with respect to /Ll and /L2, set them equal to 0
to get

and ~Hl L~=l (1 - Ti)Yi
/Lo = L~=l (1 - Ti)
We then recompute Ti using p,{+l and P,b+ l and iterate. _

9.14 Exercises

1. Let Xl, ... ,Xn '" Gamma(ex, (3). Find the method of moments estimator for ex and (3.
2. Let Xl, ... , Xn '" Uniform(a, b) where a and b are unknown parameters
and a < b.
(a) Find the method of moments estimators for a and b.
a (b) Find the MLE and b.
J (c) Let T = xdF(x). Find the MLE of T.
(d) Let T be the MLE of T. Let T be the nonparametric plug-in estimator
J of T = x dF(x). Suppose that a = 1, b = 3, and n = 10. Find the MSE
of T by simulation. Find the MSE of T analytically. Compare.
3. Let Xl"'" Xn '" N(/L, ()2). Let T be the .95 percentile, i.e. IP'(X < T) =
.95.
(a) Find the MLE of T.
(b) Find an expression for an approximate 1 - ex confidence interval for
T.
(c) Suppose the data are:

3.23 -2.50 1. 88 -0.68 4.43 1.03 -0.07 -0.01 0.76 1. 76 0.33 -0.31 0.30 -0.61 1. 52 1. 54 2.28 0.42 2.33 -1. 03 0.39

0.17 3.18 5.43 4.00

Find the MLE T. Find the standard error using the delta method. Find the standard error using the parametric bootstrap.

9.14 Exercises 147

4. Let Xl"'" Xn rv Uniform(O, e). Show that the !VILE is consistent. Hint:
Let Y = max{XI , ... , X n }. For any c, J1D(Y < c) = J1D(XI < C, X 2 < C, ... , Xn < c) = J1D(XI < C)JID(X2 < c) ...JID(Xn < c).

5. Let Xl, ... , Xn rv Poisson(.\). Find the method of moments estimator, the maximum likelihood estimator and the Fisher information 1(,\).

6. Let Xl, "',Xn rv N(e, 1). Define

Yi= {

1 0

if Xi> 0 if Xi ::.; O.

Let 7/J = J1D(YI = 1).
(a) Find the maximum likelihood estimator :J; of .1jJ.
(b) Find an approximate 95 percent confidence interval for 7/J.
0 (c) Define 7/J = (lin) L:i Yi. Show that is a consistent estimator ofljJ.
(d) Compute the asymptotic relative efficiency of 7/J toJ;. Hint: Use the
delta method to get the standard error of the !VILE. Then compute the
standard error (i.e. the standard deviation) of 7/J.
(e) Suppose that the data are not really normal. Show that 7/J is not
consistent. What, if anything, doesljJ converge to?

7. (Comparing two treatments.) nl people are given treatment 1 and n2 people are given treatment 2. Let Xl be the number of people on treatment 1 who respond favorably to the treatment and let X 2 be the number of people on treatment 2 who respond favorably. Assume that Xl rv Binomial(nl,pI) X 2 rv Binomial(n2,P2)' LetljJ = PI - P2.
(a) Find the !VILE :J; for VJ.
(b) Find the Fisher information matrix I(PI,P2).
(c) Use the multiparameter delta method to find the asymptotic stan-
dard error of 7/J.
(d) Suppose that nl = n2 = 200, Xl = 160 and X 2 = 148. Find:J;. Find
an approximate 90 percent confidence interval for VJ using (i) the delta
method and (ii) the parametric bootstrap.

8. Find the Fisher information matrix for Example 9.29.
e 9. Let Xl, ... , Xn rv Normal(/L, 1). Let = eM and let (j = eX be the !VILE.
Create a data set (using fL = 5) consisting of n=100 observations.

148 9. Parametric Inference
se (a) Use the delta method to get and a 95 percent confidence interval se for B. Use the parametric bootstrap to get and 95 percent confidence se interval for B. Use the nonparametric bootstrap to get and 95 percent
confidence interval for B. Compare your answers.
(b) Plot a histogram of the bootstrap replications for the parametric and nonparametric bootstraps. These are estimates of the distribution of B. The delta method also gives an approximation to this distribution
e namely, Normal(e,se2 ). Compare these to the true sampling distribu-
tion of (which you can get by simulation). Which approximation parametric bootstrap, bootstrap, or delta method - is closer to the true distri bution?
e 10. Let Xl, ... , Xn rv Uniform(O, B). The MLE is = XCn) = max{Xl' ... , X n }.
Generate a dataset of size 50 with B = l.
e (a) Find the distribution of analytically. Compare the true distribu-
tion of B to the histograms from the parametric and nonparametric
bootstraps.
(b) This is a case where the nonparametric bootstrap does very poorly. Show that for the parametric bootstrap lP'(e* = e) = 0, but for the nonparametric bootstrap lP'(e* = e) RO .632. Hint: show that, lP'(e* =
e) = 1 - (1 - (l/n))n then take the limit as n gets large. What is the
implication of this?

10
Hypothesis Testing and p-values

Suppose we want to know if exposure to asbestos is associated with lung disease. We take some rats and randomly divide them into two groups. We expose one group to asbestos and leave the second group unexposed. Then we compare the disease rate in the two groups. Consider the following two hypotheses:

The Null Hypothesis: The disease rate is the same in the two groups.

The Alternative Hypothesis: The disease rate is not the same in the two groups.

If the exposed group has a much higher rate of disease than the unexposed group then we will reject the null hypothesis and conclude that the evidence favors the alternative hypothesis. This is an example of hypothesis testing.
More formally, suppose that we partition the parameter space 8 into two disjoint sets 8 0 and 8 1 and that we wish to test

e e Ho : E 8 0 versus HI: E 8 1.

(10.1 )

We call Ho the null hypothesis and HI the alternative hypothesis. Let X be a random variable and let X be the range of X. We test a hypoth-
esis by finding an appropriate subset of outcomes ReX called the rejection

150 10. Hypothesis Testing and p-values

Retain Null Reject Null

Ho true J

type I error

HI true type II error

TABLE 10.1. Summary of outcomes of hypothesis testing.

region. If X E R we reject the null hypothesis, otherwise, we do not reject the null hypothesis:

X E R ===? reject Ho
X tJ. R ===? retain (do not reject) Ho
Usually, the rejection region R is of the form

R={X: T(X»C}

(10.2)

where T is a test statistic and C is a critical value. The problem in hypothesis testing is to find an appropriate test statistic T and an appropriate critical value c.
Warning! There is a tendency to use hypothesis testing methods even when they are not appropriate. Often, estimation and confidence intervals are better tools. Use hypothesis testing only when you want to test a well-defined hypothesis.

Hypothesis testing is like a legal trial. We assume someone is innocent unless the evidence strongly suggests that he is guilty. Similarly, we retain Ho unless there is strong evidence to reject Ho. There are two types of errors we can make. Rejecting Ho when Ho is true is called a type I error. Retaining Ho when HI is true is called a type II error. The possible outcomes for hypothesis testing are summarized in Tab. 10.1.

10.1 Definition. The power function of a test with rejection region R is

defined by

(3(e) = lP'e(X E R).

(10.3)

The size of a test is defined to be

Q = sup (3(e).
eEeo

(10.4)

A test is said to have level Q if its size is less than or equal to Q.

10. Hypothesis Testing and p-values 151

A hypothesis of the form e = eo is called a simple hypothesis. A hypothesis of the form e > eo or e < eo is called a composite hypothesis. A test

of the form

Ho : e = eo versus H 1 : e i=- eo

is called a two-sided test. A test of the form

Ho : e ~ eo versus H 1 : e > eo

or
Ho : e ~ eo versus H 1 : e < eo
is called a one-sided test. The most common tests are two-sided.

10.2 Example. Let Xl"'" Xn rv N(IL, 0-) where 0- is known. We want to test
Ho : fL ~ 0 versus H1 : fL > O. Hence, 8 0 = (-00,0] and 8 1 = (0, (0).
Consider the test:
reject Ho if T > e
where T = X. The rejection region is
e}. R = {(X1, ... ,Xn ): T(X1, ... ,Xn ) >

Let Z denote a standard Normal random variable. The power function is

{3(fL) lP'fL (X> e)

lP' (foCX-fL»fo(e- fL ))

fL

0-

0-

lP'(z> fo(:-fL))

1 _ <!? ( fo(: - IL)) .

This function is increasing in IL. See Figure 10.1. Hence

size = sup {3(IL) = {3(0) = 1 - <!? ( -foe) .

1,:<::;0

0-

For a size ex test, we set this equal to ex and solve for e to get

0-<!?-1(1- ex)

e=

fo .

We reject when X > 0-<!?-1(1- ex)/fo. Equivalently, we reject when
fo(X - 0) > Za'

where Za = <!?-1(1 - ex). _

152

10. Hypothesis Testing and p-values

Ho
FIGURE 10.1. The power function for Example 10.2. The size of the test is the
largest probability of rejecting Ho when Ho is true. This occurs at Jl = 0 hence the size is ;3(0). We choose the critical value c so that ;3(0) = a.
It would be desirable to find the test with highest power under HI, among all size Q tests. Such a test, if it exists, is called most powerful. Finding most powerful tests is hard and, in many cases, most powerful tests don't even exist. Instead of going into detail about when most powerful tests exist, we'll just consider four widely used tests: the Wald test,l the X2 test, the permutation test, and the likelihood ratio test.
10.1 The Wald Test
e e e Let be a scalar parameter, let be an estimate of and let se be the
estimated standard error of e.
lThe test is named after Abraham Wald (1902-1950), who was a very influential mathematical statistician. Wald died in a plane crash in India in 1950.

10.1 The Wald Test 153

Consider testing

10.3 Definition. The Wald Test
Ho : 8 = 80 versus HI: 8 cJ 80 .

Assume that 8 is asymptotically Normal:

The size ex Wald test is: reject Ho when IWI > Za/2 where
W=-8~--8. 0 se

(10.5)

10.4 Theorem. Asymptotically, the Wald test has size ex, that is,

as n --+ 00.

PROOF. Under 8 = 80, (e - 80 )/se -v--+ N(O,l). Hence, the probability of
rejecting when the null 8 = 80 is true is

lP'en (IWI > Za/2)

~801 lP'en (Ie

> za/2)

--+ IP' (IZI > Za/2)

where Z rv N(O, 1) .·
(e - 10.5 Remark. An alternative version of the Wald test statistic is W =
80 )/seo where seo is the standard error computed at 8 = 80 . Both versions of the test are valid.

Let us consider the power of the Wald test when the null hypothesis is false.

10.6 Theorem. Suppose the true value of8 is 8* cJ 80 , The power (3(8*) - the

probability of correctly rejecting the null hypothesis - is given (approximately)

by

1 - <[> ( 80 s-e 8* + Za/2 ) + <[> (8~ 0 - 8* - Za/2 ) .

(10.6)

154

10. Hypothesis Testing and p-values

Recall that se tends to 0 as the sample size increases. Inspecting (10.6) closely we note that: (i) the power is large if e* is far from eo, and (ii) the
power is large if the sample size is large.

10.7 Example (Comparing Two Prediction Algorithms). We test a prediction algorithm on a test set of size m and we test a second prediction algorithm on a second test set of size n. Let X be the number of incorrect predictions for algorithm 1 and let Y be the number of incorrect predictions for algorithm 2. Then X rv Binomial(m,pd and Y rv Binomial(n,P2)' To test the null hypothesis that PI = P2 write

Ho : r5 = 0 versus HI: r5 -=I- 0
5 where r5 = PI - P2. The MLE is = PI - P2 with estimated standard error

The size a Wald test is to reject Ho when IWI > Za/2 where

The power of this test will be largest when PI is far from P2 and when the sample sizes are large.

What if we used the same test set to test both algorithms? The two samples are no longer independent. Instead we use the following strategy. Let Xi = 1
if algorithm 1 is correct on test case i and Xi = 0 otherwise. Let Yi = 1 if algorithm 2 is correct on test case 'i, and Yi = 0 otherwise. Define Di = Xi - Yi.
A typical dataset will look something like this:

Test Case Xi Yi Di = Xi - Yi

1

10

1

2

11

0

3

11

0

4

01

-1

5

00

0

n

01

-1

Let
r5 = lE(D;) = lE(Xi) -lE(Yi) = IP'(Xi = 1) -1P'(Yi = 1).
The nonparametric plug-in estimate of r5 is 5= D = n- I L~=I Di and se(5) = 5/vn, where 52 = n- I L~=I(Di - D)2. To test Ho : r5 = 0 versus HI: r5 -=I- 0

10.1 The Wald Test 155
we use W = lise and reject Ho if IWI > Za/2' This is called a paired
comparison. _

10.8 Example (Comparing Two Means). Let Xl"'" Xm and Y1, ... , Yn be

two independent samples from populations with means M1 and IL2, respec-

tively. Let's test the null hypothesis that M1 = M2. Write this as Ho : 0 = 0
versus H1 : 0 i= 0 where 0 = ILl - M2. Recall that the nonparametric plug-in estimate of 0 is l = X - Y with estimated standard error

v M i s~e=

- +s-~
m, n

si where and s~ are the sample variances. The size Q Wald test rejects Ho
when IWI > Za/2 where

0-0 X-Y

+ W =

-~- =
se

----r=~===::=

Y/mil.

s~
n

-

10.9 Example (Comparing Two Medians). Consider the previous example again

but let us test whether the medians of the two distributions are the same.
Thus, Ho : 0 = 0 versus H1 : 0 i= 0 where 0 = V1 - V2 where V1 and V2 are the medians. The nonparametric plug-in estimate of 0 is l = V1 - V2 where V1
se and lh are the sample medians. The estimated standard error of l can be obtained from the bootstrap. The Wald test statistic is W = lise. _

There is a relationship between the Wald test and the 1 - Q asymptotic
e se confidence interval ± Za/2'
10.10 Theorem. The size Q Wald test rejects Ho : e = eo versus H1 : e i= eo
if and only if eo ~ C where
C = (e - seza /2' e+ seza /2)'
Thus, testing the hypothesis is equivalent to checking whether the null value is in the confidence interval.

Warning! When we reject Ho we often say that the result is statistically significant. A result might be statistically significant and yet the size of the effect might be small. In such a case we have a result that is statistically significant but not scientifically or practically significant. The difference between statistical significance and scientific significance is easy to understand in light of Theorem 10.10. Any confidence interval that excludes eo corresponds to rejecting Ho. But the values in the interval could be close to eo (not scientifically significant) or far from eo (scientifically significant). See Figure 10.2.

156 10. Hypothesis Testing and p-values

(

··

)e

(

· )e

FIGURE 10.2. Scientific significance versus statistical significance. A level a test rejects Ho : () = ()o if and only if the 1 - a confidence interval does not include ()o. Here are two different confidence intervals. Both exclude ()o so in both cases the test would reject Ho. But in the first case, the estimated value of () is close to ()o so the finding is probably of little scientific or practical value. In the second case, the estimated value of () is far from ()o so the finding is of scientific value. This shows two things. First, statistical significance does not imply that a finding is of scientific importance. Second, confidence intervals are often more informative than tests.

10.2 p-values
Reporting "reject Ha" or "retain Ha" is not very informative. Instead, we could ask, for every a, whether the test rejects at that level. Generally, if the
test rejects at level a it will also reject at level a' > a. Hence, there is a
smallest a at which the test rejects and we call this number the p-value. See Figure 10.3.
10.11 Definition. Suppose that for every a E (0,1) we have a size a test with rejection region Ra. Then,
p-value = inf{a: T(xn) ERa }.
That is, the p-value is the smallest level at which we can reject Ha.
Informally, the p-value is a measure of the evidence against Ha: the smaller the p-value, the stronger the evidence against Ha. Typically, researchers use the following evidence scale:

10.2 p-values 157 Yes

Reject?

No

ot
p-value

1a

FIGURE 10.3. p-values explained. For each a we can ask: does our test reject Ho at level a? The p-value is the smallest a at which we do reject Ho. If the evidence against Ho is strong, the p-value will be small.

p-value
< .01
.01 - .05
.05 - .10
> .1

evidence very strong evidence against Ho strong evidence against Ho weak evidence against Ho little or no evidence against Ho

Warning! A large p-value is not strong evidence in favor of Ho. A large p-value can occur for two reasons: (i) Ho is true or (ii) Ho is false but the test has low power.
Warning! Do not confuse the p-value with lP'(HoIData). 2 The p-value is not the probability that the null hypothesis is true.
The following result explains how to compute the p-value.
2We discuss quantities like lP(HoIData) in the chapter on Bayesian inference.

158

10. Hypothesis Testing and p-values

10.12 Theorem. Suppose that the size Q test is of the form

reject Ho if and only if T(xn) :::: Ca.

Then, p-value = sup lP'e(T(Xn) :::: T(xn))
eEe o
where xn is the observed value of xn. If 8 0 = {eo} then

We can express Theorem 10.12 as follows:
The p-value is the probability (under Ho) of observing a value of the test statistic the same as or more extreme than what was actually observed.

(e - 10.13 Theorem. Let w =

eo) lie denote the observed value of the

Wald statistic W. The p-value is given by

p - value = lP'eo (IWI > Iwl) ~ IP'(IZI > Iwl) = 2<1>( -Iwl)

(10.7)

where Z rv N(O, 1).

To understand this last theorem, look at Figure 10.4. Here is an important property of p-values.

10.14 Theorem. If the test statistic has a continuous distribution, then under Ho : e = eo, the p-value has a Uniform (0,1) distribution. Therefore, if we reject Ho when the p-value is less than Q, the probability of a type I error is
Q.

In other words, if Ho is true, the p-value is like a random draw from a Unif(O,l) distribution. If HI is true, the distribution of the p-value will tend to concentrate closer to 0.

10.15 Example. Recall the cholesterol data from Example 7.15. To test if the means are different we compute

6-0 X-Y

W

=

-~-
se

=

-V.--/-mrs=i::=+==;sn;~=

216.2 - 195.3
+ --)-5-;2~==2:=.4:2=~ = 3.78.

10.3 The X2 Distribution 159

-Iwl

Iwl

FIGURE 10.4. The p-value is the smallest a at which you would reject Ho. To
find the p-value for the Wald test, we find a such that Iwl and -Iwl are just at the

(e - boundary of the rejection region. Here, w is the observed value of the Wald statistic:

w=

Bo)/se. This implies that the p-value is the tail area IP'(IZI > Iwl) where

Z ~ N(O, 1).

To compute the p-value, let Z rv N(O, 1) denote a standard Normal random variable. Then,

p-value = J1D(IZI > 3.78) = 2J1D(Z < -3.78) = .0002

which is very strong evidence against the null hypothesis. To test if the medians are different, let VI and V2 denote the sample medians. Then,

- se - W -

VI - V2 -

212.5 7.7

194

-- .24

where the standard error 7.7 was found using the bootstrap. The p-value is

p-value = J1D(IZI > 2.4) = 2J1D(Z < -2.4) = .02

which is strong evidence against the null hypothesis. _

10.3 The X2 Distribution

Before proceeding we need to discuss the X2 distribution. Let ZI,"" Zk be
independent, standard Normals. Let V = L~=I zf. Then we say that V has

a X2 distribution with k degrees of freedom, written V rv Xk' The probability

density of V is

VCk/2)-le-v/2

f(v) = 2k / 2 f(k/2)

for v > O. It can be shown that lE(V) = k and V(V) = 2k. We define the upper a quantile Xk,a = p- I (l-a) where P is the CDF. That is, J1D(Xk > Xk,a) = a.

160 10. Hypothesis Testing and p-values

t

FIGURE 10.5. The p-value is the smallest a at which we would reject Ho. To find

xLi the p-value for the

test, we find a such that the observed value t of the test

statistic is just at the boundary of the rejection region. This implies that the p-value

is the tail area IP'(X~-i > t).

10.4 Pearson's X2 Test For Multinomial Data

x Pearson's 2 test is used for multinomial data. Recall that if X = (Xl' ... ' X k )
has a multinomial (n,p) distribution, then the !vILE of pis P= (PI, ... ,Pk) =
(Xdn, ... , Xk/n).
Let Po = (Po 1, ... ,POk) be some fixed vector and suppose we want to test

Ho : P = Po versus HI : P # Po·

10.16 Definition. Pearson's X2 statistic is

=" =" T

k ( Xj - npOj )2

k ( Xj - E j )2

~ j=l

npo·
J

~ j=l

E J

where E j = lE(Xj) = npOj is the expected value of Xj under Ho.

10.17 Theorem. Under H o, T ~ xLI. Hence the test: reject Ho if T > XL1.a has asymptotic level Q. The p-value is J1D(xLl > t) where t is the
observed value of the test statistic.
Theorem 10.17 is illustrated in Figure 10.5.

10.5 The Permutation Test 161
10.18 Example (Mendel's peas). Mendel bred peas with round yellow seeds and wrinkled green seeds. There are four types of progeny: round yellow, wrinkled yellow, round green, and wrinkled green. The number of each type is multinomial with probability P = (Pl,P2,P3,P4). His theory of inheritance predicts that P is equal to

Po

==

(

9 16'

3 16'

3 16'

1) 16

.

In n = 556 trials he observed X = (315,101,108,32). We will test Ho : P = Po
versus HI : P # Po. Since, npOl = 312.75, np02 = np03 = 104.25, and np04 =
34.75, the test statistic is

(315 - 312.75)2 (101 - 104.25)2

312.75 + 104.25

+ (108 - 104.25)2
104.25

+

(32

- 34.75)2 34.75

=

0.47.

The ex = .05 value for a x§ is 7.815. Since 0.47 is not larger than 7.815 we do
not reject the null. The p-value is

p-value = W(x§ > .47) = .93

which is not evidence against Ho. Hence, the data do not contradict Mendel's theory.3.

In the previous example, one could argue that hypothesis testing is not the right tool. Hypothesis testing is useful to see if there is evidence to reject Ho. This is appropriate when Ho corresponds to the status quo. It is not useful for proving that Ho is true. Failure to reject Ho might occur because Ho is true, but it might occur just because the test has low power. Perhaps a confidence set for the distance between P and Po might be more useful in this example.

10.5 The Permutation Test
The permutation test is a nonparametric method for testing whether two distributions are the same. This test is "exact," meaning that it is not based on large sample theory approximations. Suppose that Xl, ..., Xm rv Fx and Yl , ... , Yn rv Fy are two independent samples and Ho is the hypothesis that
3There is some controversy about whether Mendel's results are "too good."

162

10. Hypothesis Testing and p-values

the two samples are identically distributed. This is the type of hypothesis we would consider when testing whether a treatment differs from a placebo. More precisely we are testing

Ho : Fx = Fy versus HI: Fx i=- Fy .

Let T(Xl"'" Xm , Yl, ... , Yn) be some test statistic, for example,

Let N = m +n and consider forming all N! permutations of the data Xl, ... ,
X m , Yl , ... , Yn . For each permutation, compute the test statistic T. Denote these values by Tl , ... , TN!. Under the null hypothesis, each of these values is equally likely. 4 The distribution JlDo that puts mass 1/N! on each Tj is called the permutation distribution of T. Let tobs be the observed value of the test statistic. Assuming we reject when T is large, the p-value is

L 1 N!
p-value = JlDo(T > tobs) = -NI. I(Tj > tobs)' j=l

10.19 Example. Here is a toy example to make the idea clear. Suppose the
data are: (Xl, X 2 , Yl ) = (1,9,3). Let T(Xl , X 2 , Yd = IX - YI = 2. The
permutations are:

permutation (1,9,3) (9,1,3) (1,3,9) (3,1,9) (3,9,1) (9,3,1)

value of T 2 2 7 7 5 5

probability
1/6 1/6 1/6 1/6 1/6 1/6

The p-value is JlD(T > 2) = 4/6 .·

Usually, it is not practical to evaluate all N! permutations. We can approximate the p-value by sampling randomly from the set of permutations. The
fraction of times Tj > tobs among these samples approximates the p-value.

4More precisely, under the null hypothesis, given the ordered data values, Xl, ... , X m , Yl, ... , Yn is uniformly distributed over the N! permutations of the data.

10.5 The Permutation Test 163
Algorithm for Permutation Test
1. Compute the observed value of the test statistic tabs = T(X1 , ... , X m , Y1 ,···, Yn).
2. Randomly permute the data. Compute the statistic again using the permuted data.
3. Repeat the previous step B times and let T1 , ... , TB denote the resulting values.
4. The approximate p-value is

10.20 Example. DNA microarrays allow researchers to measure the expression levels of thousands of genes. The data are the levels of messenger RNA (mRNA) of each gene, which is thought to provide a measure of how much protein that gene produces. Roughly, the larger the number, the more active the gene. The table below, reproduced from Efron et al. (2001) shows the expression levels for genes from ten patients with two types of liver cancer cells. There are 2,638 genes in this experiment but here we show just the first two. The data are log-ratios of the intensity levels of two different color dyes used on the arrays.

Type I

Type II

Patient 1

2

3

4

56

7

8 9 10

Gene 1 230 -1,350 -1,580 -400 -760 970 110 -50 -190 -200

Gene 2 470 -850

-.8 -280 120 390 -1730 -1360 -1 -330

Let's test whether the median level of gene 1 is different between the two groups. Let VI denote the median level of gene 1 of Type I and let V2 denote the median level of gene 1 of Type II. The absolute difference of sample medians
is T = IVI - v21 = 710. Now we estimate the permutation distribution by
simulation and we find that the estimated p-value is .045. Thus, if we use a a = .05 level of significance, we would say that there is evidence to reject the null hypothesis of no difference. _

164

10. Hypothesis Testing and p-values

In large samples, the permutation test usually gives similar results to a test that is based on large sample theory. The permutation test is thus most useful for small samples.

10.6 The Likelihood Ratio Test

The Wald test is useful for testing a scalar parameter. The likelihood ratio test is more general and can be used for testing a vector-valued parameter.

10.21 Definition. Consider testing
Ho : 8 E 8 0 versus HI: 8 rt 8 0 .
The likelihood ratio statistic is

A = 2 log ( sUPeE8 £(8) ) = 2 log ( £r!) )

sUPeE8" £(8)

£(80 )

where 8 is the MLE and 80 is the MLE when 8 is restricted to lie in 8 0 .

You might have expected to see the maximum of the likelihood over 88 instead of 8 in the numerator. In practice, replacing 88 with 8 has little effect on the test statistic. Moreover, the theoretical properties of A are much simpler if the test statistic is defined this way.
The likelihood ratio test is most useful when 8 0 consists of all parameter values 8 such that some coordinates of 8 are fixed at particular values.
10.22 Theorem. Suppose that 8 = (81 , ... , 8q , 8q+1 , ... , 8r ). Let

Let A be the likelihood ratio test statistic. Under Ho : 8 E 8 0 !
/\\( X n) -v--+ X2r-q,a
where r - q is the dimension of 8 minus the dimension of 8 0 . The p-value
for the test is IP'(X~_q > A).
For example, if 8 = (81,82,83,84,85) and we want to test the null hypothesis that 84 = 85 = 0 then the limiting distribution has 5 - 3 = 2 degrees of freedom.

10.7 Multiple Testing 165
10.23 Example (Mendel's Peas Revisited). Consider example 10.18 again. The
likelihood ratio test statistic for Ho : P = Po versus HI : P i=- Po is

210g

(

£(p) £(Po)

)

t pj) 2 Xj log (

j=l

Po]

2 ( 31510g ( 35i~1665) + 101 log ( 5110~616 )

+108 log ( ~1~6~ ) + 32 log ( 5~~~6 ) )

0.48.

Under HI there are four parameters. However, the parameters must sum to one so the dimension of the parameter space is three. Under Ho there are no free parameters so the dimension of the restricted parameter space is zero. The difference of these two dimensions is three. Therefore, the limiting distribution
of A under Ho is x§ and the p-value is
p-value = IP'(X32 > .48) = .92.

The conclusion is the same as with the X2 test. _

When the likelihood ratio test and the X2 test are both applicable, as in the last example, they usually lead to similar results as long as the sample size is large.

10.7 Multiple Testing
In some situations we may conduct many hypothesis tests. In example 10.20, there were actually 2,638 genes. If we tested for a difference for each gene, we would be conducting 2,638 separate hypothesis tests. Suppose each test is conducted at level cx. For anyone test, the chance of a false rejection of the null is cx. But the chance of at least one false rejection is much higher. This is the multiple testing problem. The problem comes up in many data mining situations where one may end up testing thousands or even millions of hypotheses. There are many ways to deal with this problem. Here we discuss two methods.

166

10. Hypothesis Testing and p-values

Consider rn hypothesis tests:

HOi versus H 1i , i = 1, ... , rn

and let PI, ... , Pm denote the rn p-values for these tests.

The Bonferroni Method Given p-values PI, .. . , Pm, reject null hypothesis HOi if

10.24 Theorem. Using the Bonferroni method, the probability of falsely rejecting any null hypotheses is less than or equal to ex.

PROOF. Let R be the event that at least one null hypothesis is falsely rejected. Let Ri be the event that the ith null hypothesis is falsely rejected. Recall that if AI, ... ,Ak are events then J1D(U7=1 Ai) ::; 2::7=1 J1D(Ai). Hence,

ild 8 8: m

)

m

m

J1D(R) = JID ( Ri ::; J1D(Ri) =

= ex

from Theorem 10.14. _

10.25 Example. In the gene example, using ex = .05, we have that .05/2,638 = .00001895375. Hence, for any gene with p-value less than .00001895375, we declare that there is a significant difference. _

The Bonferroni method is very conservative because it is trying to make it unlikely that you would make even one false rejection. Sometimes, a more reasonable idea is to control the false discovery rate (FDR) which is defined as the mean of the number of false rejections divided by the number of rejections.
Suppose we reject all null hypotheses whose p-values fall below some threshold. Let rna be the number of null hypotheses that are true and let rnl rn - mo. The tests can be categorized in a 2 x 2 as in Table 10.2.
Define the False Discovery Proportion (FDP)

FDP={ ~/R

if R> 0
if R = o.

The FDP is the proportion of rejections that are incorrect. Next define FDR = lE(FDP).

10.7 Multiple Testing 167

Ho True Ho False Total

Ho Not Rejected U T
m-R

Ho Rejected V S
R

Total m·o
m1
rn

TABLE 10.2. Types of outcomes in multiple testing.

The Benjamini-Hochberg (BH) Method
1. Let p(l) < ... < PCrn) denote the ordered p-values.
2. Define

i = Crinam ' and R = max{ i: PCi} ) < i

(10.8)

where Crn is defined to be 1 if the p-values are independent and
Cm = 2..:7:1 (Iii) otherwise.
3. Let T = PCR); we call T the BH rejection threshold.
4. Reject all null hypotheses HOi for which Pi :.:; T.

10.26 Theorem (Benjamini and Hochberg). If the procedure above is applied, then regardless of how many nulls are true and regardless of the distribution of the p-values when the null hypothesis is false,
FDR = IE(FDP) :.:; -moa :.:; a. m
10.27 Example. Figure 10.6 shows six ordered p-values plotted as vertical lines. If we tested at level a without doing any correction for multiple testing, we would reject all hypotheses whose p-values are less than a. In this case, the four hypotheses corresponding to the four smallest p-values are rejected. The Bonferroni method rejects all hypotheses whose p-values are less than
aim. In this case, this leads to no rejections. The BH threshold corresponds
to the last p-value that falls under the line with slope a. This leads to two hypotheses being rejected in this case. _
10.28 Example. Suppose that 10 independent hypothesis tests are carried leading to the following ordered p-values:
0.00017 0.00448 0.00671 0.00907 0.01220 0.33626 0.39341 0.53882 0.58125 0.98617

168 10. Hypothesis Testing and p-values
·

T
aim I-:to'--:--~--!--~-""""!:

rej ct

don't reject

Threshold
FIGURE 10.6. The Benjamini-Hochberg (BH) procedure. For uncorrected testing
we reject when Pi < a. For Bonferroni testing we reject when Pi < aim. The BH procedure rejects when Pi -s: T. The BH threshold T corresponds to the rightmost
undercrossing of the upward sloping line.

With a = 0.05, the Bonferroni test rejects any hypothesis whose p-value is
less than 0./10 = 0.005. Thus, only the first two hypotheses are rejected. For the BH test, we find the largest i such that P(i) < ia/m, which in this case is
i = 5. Thus we reject the first five hypotheses.·

10.8 Goodness-of-fit Tests
There is another situation where testing arises, namely, when we want to check whether the data come from an assumed parametric model. There are many such tests; here is one.
Let J = {f(x; 8): 8 E 8} be a parametric model. Suppose the data take values on the real line. Divide the line into k disjoint intervals h, ... , I k . For
j = 1, ... , k, let
pj(8) = JI/] f(x; 8) dx
be the probability that an observation falls into interval I j under the assumed
model. Here, 8 = (81 , ... , 8s) are the parameters in the assumed model. Let N j be the number of observations that fall into Ij . The likelihood for 8 based

10.9 Bibliographic Remarks 169 on the counts N 1 , ... , Nk is the multinomial likelihood

k
Q(e) = IIpi(e)Nj ·
j=1

~

~

~

Maximizing Q(e) yields estimates e = (el , ... , es ) of e. Now define the test

statistic

(10.9)

10.29 Theorem. Let Ho be the null hypothesis that the data are lID draws from
the model J = {f(x; e): e E 8}. Under H - 0, the statistic Q defined in
equation (10.9) converges in distribution to a Xk-l-s random variable. Thus,
the (approximate) p-value for the test is lP'(xLI-s > q) where q denotes the
observed value of Q.
e. It is tempting to replace (j in (10.9) with the MLE However, this will not
result in a statistic whose limiting distribution is a Xk-l-s' However, it can be shown - due to a theorem of Herman Chernoff and Erich Lehmann from 1954 - that the p-value is bounded approximately by the p-values obtained
using a xLl-s and a xLI'
Goodness-of-fit testing has some serious limitations. If reject Ho then we conclude we should not use the model. But if we do not reject Ho we cannot conclude that the model is correct. We may have failed to reject simply because the test did not have enough power. This is why it is better to use nonparametric methods whenever possible rather than relying on parametric assumptions.

10.9 Bibliographic Remarks
The most complete book on testing is Lehmann (1986). See also Chapter 8 of Casella and Berger (2002) and Chapter 9 of Rice (1995). The FDR method is due to Benjamini and Hochberg (1995). Some of the exercises are from Rice (1995).

170

10. Hypothesis Testing and p-values

10.10 Appendix

10.10.1 The Neyman-Pearson Lemma

In the special case of a simple null Ho : 8 = 80 and a simple alternative HI : 8 = 81 we can say precisely what the most powerful test is.

10.30 Theorem (Neyman-Pearson). Suppose we test Ho : 8 = 80 versus HI :

8 = 81 . Let

T _ £(8d _ TI~=l f(xi; 81 ) - £(80 ) - TI~=l f(xi; 80 )"

Suppose we reject Ho when T > k. If we choose k so that lP'eo(T > k) = a

then this test is the most powerful, size a test. That is, among all tests with

size a, this test maximizes the power (3(8I).

10.10.2 The t-test

To test Ho : fL = fLo where fL = IE(Xi) is the mean, we can use the Wald test. When the data are assumed to be Normal and the sample size is small, it is common instead to use the t-test. A random variable T has at-distribution with k degrees of freedom if it has density

r (k+l)

f(t) =

-2

Yhr (~) (1 + ~)(k+l)/2'

When the degrees of freedom k -+ 00, this tends to a Normal distribution. When k = 1 it reduces to a Cauchy.
Let Xl"'" Xn rv N(fL, (]"2) where 8 = (fL, (]"2) are both unknown. Suppose
we want to test IL = fLo versus IL of. ILo. Let

T = fo(Xn - fLo)
Sn
where S?;, is the sample variance. For large samples T ~ N(O,l) under Ho. The exact distribution of T under Ho is tn-I. Hence if we reject when ITI >
t n - l ,a/2 then we get a size a test. However, when n is moderately large, the t-test is essentially identical to the Wald test.

10.11 Exercises
1. Prove Theorem 10.6.

10.11 Exercises 171
2. Prove Theorem 10.14.
3. Prove Theorem 10.10.
4. Prove Theorem 10.12.
5. Let XI"",Xn rv Uniform(O,e) and let Y = max{XI"",Xn}' We want to test
Ho : e = 1/2 versus HI : e > 1/2.
The Wald test is not appropriate since Y does not converge to a Normal.
Suppose we decide to test this hypothesis by rejecting Ho when Y > c.
(a) Find the power function. (b) What choice of c will make the size of the test .05? (c) In a sampIe of size n = 20 with Y =0.48 what is the p-value? What conclusion about Ho would you make? (d) In a sample of size n = 20 with Y =0.52 what is the p-value? What conclusion about Ho would you make?
6. There is a theory that people can postpone their death until after an important event. To test the theory, Phillips and King (1988) collected data on deaths around the Jewish holiday Passover. Of 1919 deaths, 922 died the week before the holiday and 997 died the week after. Think of
e this as a binomial and test the null hypothesis that = 1/2. Report and e. interpret the p-value. Also construct a confidence interval for
7. In 1861, 10 essays appeared in the New Orleans Daily Crescent. They were signed "Quintus Curtius Snodgrass" and some people suspected they were actually written by Mark Twain. To investigate this, we will consider the proportion of three letter words found in an author's work. From eight Twain essays we have: .225 .262 .217 .240 .230 .229 .235 .217 From 10 Snodgrass essays we have: .209 .205 .196 .210 .202 .207 .224 .223 .220 .201 (a) Perform a Wald test for equality of the means. Use the nonparametric plug-in estimator. Report the p-value and a 95 per cent confidence interval for the difference of means. What do you conclude? (b) Now use a permutation test to avoid the use oflarge sample methods. What is your conclusion? (Brinegar (1963)).

172

10. Hypothesis Testing and p-values

8. Let Xl, ... ,Xn '" N (e, 1). Consider testing

Ho : e = 0 versus e = 1.

Let the rejection region be R = {xn: T(xn) > c} where T(xn)

n

-

l

,\,n L...i=l

X

i·

(a) Find c so that the test has size Q.

(b) Find the power under HI, that is, find ,6 (1).

(c) Show that ,6(1) --+ 1 as n --+ 00.

se 9. Let abe the MLE of a parameter e and let = {n1(a)}-1/2 where 1(e)
is the Fisher information. Consider testing

Ho : e = eo versus e i=- eo·
Consider the Wald test with rejection region R = {xn: IZI > Za/2}
where Z = (e - eo)/se. Let e1 > eo be some alternative. Show that
,6(e1 ) --+ 1.

10. Here are the number of elderly Jewish and Chinese women who died just before and after the Chinese Harvest Moon Festival.

Week -2 -1 1 2

Chinese 55 33 70 49

Jewish 141 145 139 161

Compare the two mortality patterns. (Phillips and Smith (1990)).
11. A randomized, double-blind experiment was conducted to assess the effectiveness of several drugs for reducing postoperative nausea. The data are as follows.

Placebo Chlorpromazine Dimenhydrinate Pentobarbital (100 mg) Pentobarbital (150 mg)

Number of Patients 80 75 85 67 85

Incidence of Nausea 45 26 52 35 37

10.11 Exercises 173
(a) Test each drug versus the placebo at the 5 per cent level. Also, report the estimated odds-ratios. Summarize your findings. (b) Use the Bonferroni and the FDR method to adjust for multiple testing. (Beecher (1959)).
12. Let Xl, ... , Xn rv Poisson(A).
(a) Let AO > O. Find the size a Wald test for Ho : A = AO versus HI: A i=- AO·
(b) (Computer Experiment.) Let AO = 1, n = 20 and a = .05. Simulate Xl, . .. , Xn rv Poisson(Ao) and perform the Wald test. Repeat many times and count how often you reject the null. How close is the type I error rate to .057 13. Let Xl,"" Xn rv N(,L, (T2). Construct the likelihood ratio test for
Ho : fL = fLo versus HI: fL i=- fLo·
Compare to the Wald test. 14. Let Xl"'" Xn rv N(,L, (T2). Construct the likelihood ratio test for
Ho : (T = (To versus HI: (T i=- (To·
Compare to the Wald test.
15. Let X rv Binomial(n,p). Construct the likelihood ratio test for
Ho : p = Po versus HI: p i=- Po·
Compare to the Wald test.
16. Let 8 be a scalar parameter and suppose we test
Ho : 8 = 80 versus HI: 8 i=- 80 .
Let W be the Wald test statistic and let A be the likelihood ratio test statistic. Show that these tests are equivalent in the sense that
W2 p ---+1
A as n ---+ 00. Hint: Use a Taylor expansion of the log-likelihood £(8) to show that

11
Bayesian Inference
11.1 The Bayesian Philosophy
The statistical methods that we have discussed so far are known as frequentist (or classical) methods. The frequentist point of view is based on the following postulates:
Fl Probability refers to limiting relative frequencies. Probabilities are objective properties of the real world.
F2 Parameters are fixed, unknown constants. Because they are not fluctuating, no useful probability statements can be made about parameters.
F3 Statistical procedures should be designed to have well-defined long run frequency properties. For example, a 95 percent confidence interval should trap the true value of the parameter with limiting frequency at least 95 percent.
There is another approach to inference called Bayesian inference. The Bayesian approach is based on the following postulates:

176

11. Bayesian Inference

B1 Probability describes degree of belief, not limiting frequency. As such, we can make probability statements about lots of things, not just data which are subject to random variation. For example, I might say that "the probability that Albert Einstein drank a cup of tea on August 1, 1948" is .35. This does not refer to any limiting frequency. It reflects my strength of belief that the proposition is true.

B2 We can make probability statements about parameters, even though they are fixed constants.

B3 We make inferences about a parameter B by producing a probability distribution for B. Inferences, such as point estimates and interval esti-
mates, may then be extracted from this distribution.

Bayesian inference is a controversial approach because it inherently embraces a subjective notion of probability. In general, Bayesian methods provide no guarantees on long run performance. The field of statistics puts more emphasis on frequentist methods although Bayesian methods certainly have a presence. Certain data mining and machine learning communities seem to embrace Bayesian methods very strongly. Let's put aside philosophical arguments for now and see how Bayesian inference is done. We'll conclude this chapter with some discussion on the strengths and weaknesses of the Bayesian approach.

11.2 The Bayesian Method
Bayesian inference is usually carried out in the following way.
1. We choose a probability density f( B) - called the prior distribution - that expresses our beliefs about a parameter B before we see any data.
2. We choose a statistical model f(xIB) that reflects our beliefs about x given B. Notice that we now write this as f(xIB) instead of f(x; B).
3. After observing data X1, ... ,Xn , we update our beliefs and calculate the posterior distribution f(BIX1, ... , Xn).
To see how the third step is carried out, first suppose that B is discrete and
that there is a single, discrete observation X. We should use a capital letter

11.2 The Bayesian Method 177

now to denote the parameter since we are treating it like a random variable, so let 8 denote the parameter. Now, in this discrete setting,

J1D(8 = BIX = x)

J1D(X = x, 8 = B)
J1D(X=x)
J1D(X = xl8 = B)JID(8 = B)
L& J1D(X = xl8 = B)JID(8 = B)

which you may recognize from Chapter 1 as Bayes' theorem. The version for continuous variables is obtained by using density functions:

.

f(xIB)f(B)

j(Blx) = I f(xIB)f(B)dB'

(11.1)

If we have n IID observations Xl, ... , X n, we replace f (x IB) with
I In
f(X1,"" xnlB) = f(XiI B) = Ln(B).
i=l
NOTATION. We will write xn to mean (Xl, ... , Xn) and xn to mean (Xl"'" xn). Now,

(11.2)

where

(11.3)

is called the normalizing constant. Note that Cn does not depend on B. We can summarize by writing:

Posterior is proportional to Likelihood times Prior
or, in symbols,

You might wonder, doesn't it cause a problem to throwaway the constant cn ? The answer is that we can always recover the constant later if we need to.
What do we do with the posterior distribution? First, we can get a point estimate by summarizing the center of the posterior. Typically, we use the mean or mode of the posterior. The posterior mean is
(11.4)

178

11. Bayesian Inference

We can also obtain a Bayesian interval estimate. We find a and b such that I~oo f(Blxn)dB = Iboo f(Blxn)dB = a/2. Let C = (a, b). Then
lb IP'(B E Clxn) = f(Blx n ) dB = 1 - a

so C is a 1 - a posterior interval.
11.1 Example. Let Xl' ... ' Xn rv Bernoulli(p). Suppose we take the uniform distribution f(p) = 1 as a prior. By Bayes' theorem, the posterior has the form

where s = L~=l Xi is the number of successes. Recall that a random variable has a Beta distribution with parameters a and (3 if its density is

f

(p,.

a,

) (3

_ -

f(a + (3) a-l(
r(a)f((3)P 1 -

)13- 1 p.

We see that the posterior for p is a Beta distribution with parameters 8 + 1 and n - 8 + 1. That is,

f(plxn) =

f(n + 2)

p(S+I)-l(l _ p)(n-s+1)-I.

f(s+1)f(n-s+1)

We write this as

plxn rv Beta(s + 1, n - s + 1).

Notice that we have figured out the normalizing constant without actually
doing the integral I.L.n(p)f(p)dp. The mean of a Beta(a, (3) distribution is
a/(a + (3) so the Bayes estimator is

8+1
'[5=--.
n+2 It is instructive to rewrite the estimator as

(11.5)

(11.6)
where p = sin is the MLE, is = 1/2 is the prior mean and .An = n/(n + 2) :::::; 1.
J: A 95 percent posterior interval can be obtained by numerically finding a and
b such that f(plxn) dp = .95. Suppose that instead of a uniform prior, we use the prior p rv Beta(a, (3).
If you repeat the calculations above, you will see that plxn rv Beta(a + s, (3 +

11.2 The Bayesian Method 179

n - s). The flat prior is just the special case with a = fJ = 1. The posterior

mean is

)po p= a+s = ( n )p+ ( a+fJ

a+fJ+n a+fJ+n

a+fJ+n

where Po = a / (a + fJ) is the prior mean. _

In the previous example, the prior was a Beta distribution and the posterior was a Beta distribution. When the prior and the posterior are in the same family, we say that the prior is conjugate with respect to the model.

11.2 Example. Let Xl"'" Xn rv N(B, (}2). For simplicity, let us assume that () is known. Suppose we take as a prior B rv N(a, b2 ). In problem 1 in the exercises it is shown that the posterior for B is

(11.7)

where

7J = wX + (1 - w)a,

I

V! = --o-=se,--2--o-

seI 2

+

I
b2

'

and se = () / Vii is the standard error of the MLE X. This is another example

of a conjugate prior. Note that 10 -+ 1 and T /se -+ 1 as n -+ 00. So, for large

NCe, n, the posterior is approximately

se2 ). The same is true if n is fixed but

b -+ 00, which corresponds to letting the prior become very flat. Continuing with this example, let us find C = (c, d) such that IP'(B E
Clxn) = .95. We can do this by choosing c and d such that IP'(B < clxn) = .025 and IP'( B > dlxn) = .025. So, we want to find c such that

~ ~ IP' ( B 7J < c 7J I xn )

IP' ( Z < ~ C - 7J) = .025.
We know that IP'(Z < -1.96) = .025. So,
-c-7-J = -1.96 T
implying that c = 7J-1.96T. By similar arguments, d = 7J+ 1.96. So a 95 percent Bayesian interval is 7J±1.96T. Since 7J ~ Band T ~ se, the 95 percent Bayesian
interval is approximated by B ± 1.96se which is the frequentist confidence
interval. _

180

11. Bayesian Inference

11.3 Functions of Pararneters

How do we make inferences about a function T = g(e)7 Remember in Chapter

3 we solved the following problem: given the density fx for X, find the density

for Y = g(X). We now simply apply the same reasoning. The posterior CDF

for T is

i H(Tlxn) = lP'(g(e) ::; Tlxn) = f(elxn)de

where A = {e: g(e)::; T}. The posterior density is h(Tlxn) = H'(Tlxn).

11.3 Example. Let Xl"'" Xn rv Bernoulli(p) and f(p) = 1 so that plXn rv
Beta(s + 1, n - s + 1) with s = ~~=l Xi' Let 1jJ = 10g(p/(1 - p)). Then

C~ H(1jJlxn) = IP'(W::; 1/)lxn) = IP' (lOg

P ) ::; 1/) I xn)

(p ~ IP' <- 1 + eW I xn)

foe'!"

/

(1+

e

4 ')

f(plxn)

dp

r(n + 2)

l e '!' /(1+e'!') pS(1- p)n-s dp

r(s+l)f(n-s+l) 0

and

for 1jJ E R ·
11.4 Sirnulation
The posterior can often be approximated by simulation. Suppose we draw
e e l , ... , eE rv p(elxn). Then a histogram of l , ... , eE approximates the poste-
rior density p(elxn). An approximation to the posterior mean en = JE(elxn) is

11.5 Large Sample Properties of Bayes' Procedures 181

B- L:=l 1

ej . The posterior I-a interval can be approximated by (ea / 2, e1- a / 2)

where ea/ 2 is the a/2 sample quantile of e1, ... , eE . Once we have a sample e1, ... , eE from J(elxn ), let Ti = g(ei ). Then
T1, ... , TE is a sample from J(Tlxn ). This avoids the need to do any analytical

calculations. Simulation is discussed in more detail in Chapter 24.

11.4 Example. Consider again Example 11.3. We can approximate the posterior for .1jJ without doing any calculus. Here are the steps:
1. Draw P1 , ... , PE rv Beta(s + 1, n - s + 1).

2. Let ~i = log(Pi/(1 - Pi)) for i = 1, ... , B.

Now ~l, ... ,VJE are IID draws from h(vJlxn). A histogram of these values provides an estimate of h(~lxn) . ·

11.5 Large Sample Properties of Bayes' Procedures
In the Bernoulli and Normal examples we saw that the posterior mean was close to the MLE. This is true in greater generality.
11.5 Theorem. LetEin be the MLE and letse = I/VnI(en). Under appropriate regularity conditions, the posterior is approximately Normal with mean en and
standard deviationse. Hence, en:::::: en. Also, iJCn = (en-Za/2se,en+Za/2se)
is the asymptotic Jrequentist 1 - a confidence interval, then C n is also an approximate 1 - a Bayesian posterior interval:

There is also a Bayesian delta method. Let T = g(e). Then
Tlx n :::::: N(T, Se2 )
se where T = g(e) and Se = 19' (e) I.
11.6 Flat Priors, Irnproper Priors, and "Noninforrnative" Priors
An important question in Bayesian inference is: where does one get the prior J(e)7 One school of thought, called subjectivism says that the prior should

182

11. Bayesian Inference

e refiect our subjective opinion about (before the data are collected). This may
be possible in some cases but is impractical in complicated problems especially
if there are many parameters. Moreover, injecting subjective opinion into the analysis is contrary to the goal of making scientific inference as objective as possible. An alternative is to try to define some sort of "noninformative prior." An obvious candidate for a noninformative prior is to use a fiat prior f(e) ex constant.
In the Bernoulli example, taking f(p) = 1 leads to plXn rv Beta(05 + 1, n8 + 1) as we saw earlier, which seemed very reasonable. But unfettered use of
fiat priors raises some questions. IMPROPER PRIORS. Let X rv N(e, (J"2) with (J" known. Suppose we adopt
J a fiat prior f( e) ex c where c > 0 is a constant. Note that f( e)de = 00 so
this is not a probability density in the usual sense. We call such a prior an improper prior. Nonetheless, we can still formally carry out Bayes' theorem and compute the posterior density by multiplying the prior and the likelihood: f(e) ex Ln(e)f(e) ex Ln(e). This gives elxn rv N(X, (J"2 In) and the resulting point and interval estimators agree exactly with their frequentist counterparts. In general, improper priors are not a problem as long as the resulting posterior is a well-defined probability distribution.
FLAT PRIORS ARE NOT INVARIANT. Let X rv Bernoulli(p) and suppose we
use the fiat prior f(p) = 1. This fiat prior presumably represents our lack of
information about p before the experiment. Now let .1jJ = 10g(pI(1 - p)). This
is a transformation of p and we can compute the resulting distribution for VJ,
namely,

which is not fiat. But if we are ignorant about p then we are also ignorant
about 1/J so we should use a fiat prior forljJ. This is a contradiction. In short,
the notion of a fiat prior is not well defined because a fiat prior on a parameter does not imply a fiat prior on a transformed version of the parameter. Flat priors are not transformation invariant.
JEFFREYS' PRIOR. Jeffreys came up with a rule for creating priors. The rule is: take
f(e) ex J(e)1/2
where J( e) is the Fisher information function. This rule turns out to be transformation invariant. There are various reasons for thinking that this prior might be a useful prior but we will not go into details here.

11.7 Multiparameter Problems 183
11.6 Example. Consider the Bernoulli (p) model. Recall that 1
J(p) = p(l _ p) Jeffreys' rule says to use the prior
This is a Beta (1/2,1/2) density. This is very close to a uniform density. _ In a multiparameter problem, the Jeffreys' prior is defined to be f(8) ex
y'[I(B)I where IAI denotes the determinant of a matrix A and J(8) is the
Fisher information matrix.
11.7 Multiparameter Problems
Suppose that 8 = (81 , ... , 8p ). The posterior density is still given by (11.8)
The question now arises of how to extract inferences about one parameter. The key is to find the marginal posterior density for the parameter of interest. Suppose we want to make inferences about 81 . The marginal posterior for 81 is
(11.9) In practice, it might not be feasible to do this integral. Simulation can help. Draw randomly from the posterior:
where the superscripts index the different draws. Each 8j is a vector 8j (8i, ... , 8~). Now collect together the first component of each draw:
These are a sample from f( 81 1xn) and we have avoided doing any integrals. 11.7 Example (Comparing Two Binomials). Suppose we have n1 control patients and n2 treatment patients and that Xl control patients survive while X 2 treatment patients survive. We want to estimate T = g(P1,P2) = P2 - Pl. Then,

184

11. Bayesian Inference

If f (PI, P2) = 1, the posterior is

Notice that (Pl,P2) live on a rectangle (a square, actually) and that

where

which implies that PI and P2 are independent under the posterior. Also,
Pllxl rv Beta(xl + 1,711 - Xl + 1) and P21x2 rv Beta(:c2 + 1,712 - X2 + 1). If we simulate Pl,l,"" Pl,E rv Beta(xl + 1,711 - + Xl 1) and P2,1,"" P2,E rv
Beta(x2 + 1, 712 - X2 +1), then Tb = P2,b - Pl,b, b = 1, ... , B, is a sample from
f(Tl x l,X2) .·
11.8 Bayesian Testing
Hypothesis testing from a Bayesian point of view is a complex topic. We will only give a brief sketch of the main idea here. The Bayesian approach to testing involves putting a prior on Ho and on the parameter 8 and then computing IP'(Holxn). Consider the case where 8 is scalar and we are testing
Ho : 8 = 80 versus HI: 8 -=I- 80 .
It is usually reasonable to use the prior IP'(Ho) = IP'(Hd = 1/2 (although this is not essential in what follows). Under HI we need a prior for 8. Denote this prior density by f( 8). From Bayes' theorem
f(xnIHo)lP'(Ho) + f(xnIHdlP'(Hl)
~f(xn I 80 )
V(x n I 80 ) + V(xn I Hd
f(x n I 80 )
J f(x n I 80 ) + f(x n I 8)f(8)d8
£(80 )
£(80 ) + J£(8)f(8)d8'
We saw that, in estimation problems, the prior was not very influential and that the frequentist and Bayesian methods gave similar answers. This is not

11.9 Strengths and Weaknesses of Bayesian Inference 185
the case in hypothesis testing. Also, one can't use improper priors in testing because this leads to an undefined constant in the denominator of the expression above. Thus, if you use Bayesian testing you must choose the prior j (8) very carefully. It is possible to get a prior-free bound on IP'(HoIXn = xn).
I Notice that 0 <::: £(8)j(8)d8 <::: £(e). Hence,
£(80 ) ~ <::: IP'(Holxn = xn) < l. £(80 ) + £(8)
The upper bound is not very interesting, but the lower bound is non-trivial.
11.9 Strengths and Weaknesses of Bayesian Inference
Bayesian inference is appealing when prior information is available since Bayes' theorem is a natural way to combine prior information with data. Some people find Bayesian inference psychologically appealing because it allows us to make probability statements about parameters. In contrast, frequentist inference provides confidence sets en which trap the parameter 95 percent of the time, but we cannot say that IP'( 8 E en Ixn) is .95. In the frequentist approach we can make probability statements about en, not 8. However, psychological appeal is not a compelling scientific argument for using one type of inference over another.
In parametric models, with large samples, Bayesian and frequentist methods give approximately the same inferences. In general, they need not agree.
Here are three examples that illustrate the strengths and weakness of Bayesian inference. The first example is Example 6.14 revisited. This example shows the psychological appeal of Bayesian inference. The second and third show that Bayesian methods can fail.
11.8 Example (Example 6.14 revisited). We begin by reviewing the example. Let 8 be a fixed, known real number and let Xl, X 2 be independent random
variables such that IP'(Xi = 1) = IP'(Xi = -1) = 1/2. Now define Y; = 8 + Xi
and suppose that you only observe Yl and Y2 . Let
ifYl =Y2
if Yl -I Y2 .
This is a 75 percent confidence set since, no matter what 8 is, lP'e(8 E e) = 3/4. Suppose we observe Yl = 15 and Y2 = 17. Then our 75 percent confidence
interval is {16}. However, we are certain, in this case, that 8 = 16. So calling

186

11. Bayesian Inference

e this a 75 percent confidence set, bothers many people. Nonetheless, is a
valid 75 percent confidence set. It will trap the true value 75 percent of the
time.
The Bayesian solution is more satisfying to many. For simplicity, assume
that e is an integer. Let f (e) be a prior mass function such that f (e) > 0 for every integer e. When Y = (Y1 , Y2 ) = (15,17), the likelihood function is

£(e) = {

~/4

e = 16
otherwise.

Applying Bayes' theorem we see that

J1D(8 = elY = (15,17)) = { ~

e = 16
otherwise.

Hence, J1D(e E elY = (15,17)) = 1. There is nothing wrong with saying that
{16} is a 75 percent confidence interval. But is it not a probability statement
about e.·

11.9 Example. This is a simplified version of the example in Robins and Ritov (1997). The data consist of n IID triples

Let B be a finite but very large number, like B = 100100. Any realistic sample size n will be small compared to B. Let
e be a vector of unknown parameters such that 0 ::.; j ::.; 1 for 1 ::.; j ::.; B. Let

be a vector of known numbers such that
0< 5 ::.; ~j ::.; 1 - 5 < 1, 1::'; j ::.; B,
where 5 is some, small, positive number. Each data point (Xi, R i , Yi) is drawn
in the following way: 1. Draw Xi uniformly from {1, ... , B}. 2. Draw Ri rv Bernoulli(~xJ.
3. If Ri = 1, then draw Yi rv Bernoulli(ex ;). If Ri = 0, do not draw Yi.

11.9 Strengths and Weaknesses of Bayesian Inference 187

The model may seem a little artificial but, in fact, it is caricature of some real missing data problems in which some data points are not observed. In this example, Ri = 0 can be thought of as meaning "missing." Our goal is to estimate
VJ = J1D(li = 1).

Note that
'1jJ

B
J1D(li = 1) = LJID(li = 11X = j)JID(X = j)
j=l

so ?jJ = g(e) is a function of e. Let us consider a Bayesian analysis first. The likelihood of a single obser-
vation is
!(Xi ,Ri ,li) = !(Xi)!(RiIXi)!(liIXi)Ri.
The last term is raised to the power Ri since, if Ri = 0, then li is not observed and hence that term drops out of the likelihood. Since!(Xi) = 1/B and that li and Ri are Bernoulli,

Thus, the likelihood function is
n

i=l

II - e e n 1 B <C,Rxi.i (1 - <c,X,.)l-Ri XYii.Ri (1 - X,..)(l-Yi )Ri

i=l

ei e ex

iRi (1 - x J(1-Yi )Ri .

We have dropped all the terms involving B and the ej'S since these are known
constants, not parameters. The log-likelihood is

n

i=l

L L B

B

+ nj logej

mj 10g(1 - ej )

j=l

j=l

188

11. Bayesian Inference

where

Tlj

#{i: Yi = 1,Ri = 1,Xi = j}

mj

#{i: Yi = O,Ri = 1,Xi = j}.

Now, nj = mj = 0 for most j since B is so much larger than TI. This has
e several implications. First, the MLE for most j is not defined. Second, for e most j , the posterior distribution is equal to the prior distribution, since
those ej do not appear in the likelihood. Hence, f(eIData) :::::: f(e). It follows
that f(1j)IData) :::::: f(1jJ). In other words, the data provide little information
about 1jJ in a Bayesian analysis.
Now we consider a frequentist solution. Define

ex, t~jJ=l_~~_R 2_~'. n i=l

(11.10)

We will now show that this estimator is unbiased and has small mean-squared error. It can be shown (see Exercise 7) that

~

1

and V(1jJ) ~ ---:c2.

Tlu

(11.11)

Therefore, the MSE is of order l/n which goes to 0 fairly quickly as we collect

more data, no matter how large B is. The estimator defined in (11.10) is called

the Horwitz-Thompson estimator. It cannot be derived from a Bayesian or

ex,. likelihood point of view since it involves the terms

These terms drop

out of the log-likelihood and hence will not show up in any likelihood-based

method including Bayesian estimators.

The moral of the story is this. Bayesian methods are tied to the likeli-

hood function. But in high dimensional (and nonparametric) problems, the

likelihood may not yield accurate inferences. _

11.10 Example. Suppose that f is a probability density function and that

f(x) = cg(x)

where g(x) > 0 is a known function and c is unknown. In principle we can
compute c since Jf(x) dx = 1 implies that c = 1/ Jg(x) dx. But in many cases J we can't do the integral g(x) dx since 9 might be a complicated function and
x could be high dimensional. Despite the fact that c is not known, it is often
possible to draw a sample Xl' ... ' Xn from f; see Chapter 24. Can we use the
sample to estimate the normalizing constant c? Here is a frequentist solution:

11.10 Bibliographic Remarks 189

in Let (x) be a consistent estimate of the density f. Chapter 20 explains how to
construct such an estimate. Choose any point x and note that C = f(x)/g(x).
c= Hence, !(x)/g(x) is a consistent estimate of c. Now let us try to solve this
problem from a Bayesian approach. Let 7f(c) be a prior such that 7f(c) > 0 for
all C > O. The likelihood function is

n

n

n

i=l

i=l

i=l

Hence the posterior is proportional to Cn 7f(c). The posterior does not depend

on Xl"'" X n , so we come to the startling conclusion that, from the Bayesian point of view, there is no information in the data about c. Moreover, the

posterior mean is

1000 cn + l 7f(C) dc 1000 Cn 7f(c) dc

which tends to infinity as n increases. _

These last two examples illustrate an important point. Bayesians are slaves to the likelihood function. When the likelihood goes awry, so will Bayesian inference.
What should we conclude from all this? The important thing is to understand that frequentist and Bayesian methods are answering different questions. To combine prior beliefs with data in a principled way, use Bayesian inference. To construct procedures with guaranteed long run performance, such as confidence intervals, use frequentist methods. Generally, Bayesian methods run into problems when the parameter space is high dimensional. In particular, 95 percent posterior intervals need not contain the true value 95 percent of the time (in the frequency sense).

11.10 Bibliographic Rernarks
Some references on Bayesian inference include Carlin and Louis (1996), Gelman et al. (1995), Lee (1997), Robert (1994), and Schervish (1995). See Cox (1993), Diaconis and Freedman (1986), Freedman (1999), Barron et al. (1999), Ghosal et al. (2000), Shen and Wasserman (2001), and Zhao (2000) for discussions of some of the technicalities of nonparametric Bayesian inference. The Robins-Ritov example is discussed in detail in Robins and Ritov (1997) where it is cast more properly as a nonparametric problem. Example 11.10 is due to Edward George (personal communication). See Berger and Delampady (1987)

190

11. Bayesian Inference

and Kass and Raftery (1995) for a discussion of Bayesian testing. See Kass and Wasserman (1996) for a discussion of noninformative priors.

11.11 Appendix
Proof of Theorem 11.5. It can be shown that the effect of the prior diminishes as n increases so
that f(8Ixn) ex: Ln(8)f(8) :::: Ln(8). Hence, logf(8Ixn) :::: £(8). Now, £(8) ::::
£(e) + (8 - 8)£'(e) + [(8 - 8)2/2]£1/(8) = £(8) + [(8 - 8)2/2]£"(8) since £'(8) = O.
Exponentiating, we get approximately that

where ()~ = -1/R"(8n ). So the posterior of 8 is approximately Normal with
mean 8 and variance ()~. Let £i = log f(XiI8), then

1 ()~

L -£"(en ) = -£;'(8n )

i

L n (~) -e;'(8n )::::::: nlEe [-e;'(8n )]

2

and hence (}n ::::::: se(8). -

11.12 Exercises
1. Verify (11.7).
2. Let Xl, ... , Xn rv Normal(,t, 1). (a) Simulate a data set (using fL = 5) consisting of n=lQO observations.
(b) Take f (,t) = 1 and find the posterior density. Plot the density.
(c) Simulate 1,000 draws from the posterior. Plot a histogram of the simulated values and compare the histogram to the answer in (b). (d) Let 8 = elL. Find the posterior density for 8 analytically and by simulation. (e) Find a 95 percent posterior interval for IL. (f) Find a 95 percent confidence interval for 8.

11.12 Exercises 191
3. Let Xl, ... , Xn rv Uniform(O, e). Let 1(e) ex l/e. Find the posterior
density.

4. Suppose that 50 people are given a placebo and 50 are given a new treatment. 30 placebo patients show improvement while 40 treated patients show improvement. Let T = P2 - PI where P2 is the probability of improving under treatment and PI is the probability of improving under placebo.

(a) Find the MLE of T. Find the standard error and 90 percent confidence interval using the delta method.

(b) Find the standard error and 90 percent confidence interval using the parametric bootstrap.
(c) Use the prior 1(PI, P2) = 1. Use simulation to find the posterior
mean and posterior 90 percent interval for T.

(d) Let

1jJ

=

log

((~) 1 - PI

-.'-

(~)) 1 - P2

be the log-odds ratio. Note that VJ = 0 if PI = P2. Find the MLE of 1jJ.
Use the delta method to find a 90 percent confidence interval for 1jJ.

(e) Use simulation to find the posterior mean and posterior 90 percent interval for 1jJ.

5. Consider the Bernoulli(p) observations 0101000000 Plot the posterior for P using these priors: Beta(1/2,1/2), Beta(l,l), Beta(lO,lO), Beta(100,100).

6. Let Xl,"" Xn rv Poisson('\). (a) Let ,\ rv Gamma(a, p) be the prior. Show that the posterior is also a Gamma. Find the posterior mean.
(b) Find the Jeffreys' prior. Find the posterior.

7. In Example 11.9, verify (11.11).

8. Let X rv N(JL, 1). Consider testing

Ho : JL = 0 versus HI: JL cJ O.

192

11. Bayesian Inference

Take P(Ho) = P(HI) = 1/2. Let the prior for /L under HI be It rv
N(O, b2 ). Find an expression for P(HoIX = x). Compare P(HoIX = x) to the p-value of the Wald test. Do the comparison numerically for a variety of values of x and b. Now repeat the problem using a sample of size n. You will see that the posterior probability of Ho can be large even when the p-value is small, especially when n is large. This disagreement between Bayesian and frequentist testing is called the Jeffreys-Lindley paradox.

12
Statistical Decision Theory

12.1 Prelirninaries
We have considered several point estimators such as the maximum likelihood estimator, the method of moments estimator, and the posterior mean. In fact, there are many other ways to generate estimators. How do we choose among them? The answer is found in decision theory which is a formal theory for comparing statistical procedures.
Consider a parameter 8 which lives in a parameter space 8. Let 8 be an estimator of 8. In the language of decision theory, an estimator is sometimes called a decision rule and the possible values of the decision rule are called actions.
We shall measure the discrepancy between 8 and 8 using a loss function L(8,8). Formally, L maps 8 x 8 into R Here are some examples of loss functions:

L(8, 8) = (8 - 8)2

L(8,8)=18-81

L(8, 8) = 18 - 81 P

L(8, 8) = 0 if 8 = 8 or 1 if 8 i- 8

L(8, 8)

=

flog

(f((X;~)))
f X,e

f(x;

8)dx

squared error loss, absolute error loss, Lp loss, zero-one loss, Kullback-Leibler loss.

194

12. Statistical Decision Theory

Bear in mind in what follows that an estimator 8 is a function of the data. To emphasize this point, sometimes we will write B as B(X). To assess an estimator, we evaluate the average loss or risk.

12.1 Definition. The risk of an estimator 8 is

R(8, B) = lEe (L(8, B) ) = / L(8, B(x))f(x; 8)dx.

When the loss function is squared error, the risk is just the MSE (mean squared error):

In the rest of the chapter, if we do not state what loss function we are using, assume the loss function is squared error.

12.2 Comparing Risk Functions

To compare two estimators we can compare their risk functions. However, this does not provide a clear answer as to which estimator is better. Consider the following examples.
- - 12.2 Example. Let X rv N(8,1) and assume we are using squared error
loss. Consider two estimators: 81 = X and 82 = 3. The risk functions are
BI) R(8, = lEe (X - 8)2 = 1 and R(8, ( 2 ) = lEe(3 - 8)2 = (3 - 8)2. If 2 < 8 < 4 then R(8,~) < R(8, ~), otherwise, R(8, BI) < R(8, (2)' Neither estimator
uniformly dominates the other; see Figure 12.1. ·

12.3 Example. Let Xl, ... , Xn rv Bernoulli(p). Consider squared error loss
and let PI = X. Since this has 0 bias, we have that

R(p,pI) = V(X) = p(l - p).
n

Another estimator is

_ Y +a P2 = a + fJ + n

where Y = L~=l Xi and a and fJ are positive constants. This is the posterior mean using a Beta (a, fJ) prior. Now,

12.2 Comparing Risk Functions 195

3

2

1

o o1 2 3 4 5
FIGURE 12.1. Comparing two risk functions. Neither risk function dominates the other at all values of B.

vp (a: ;: n) + (Ep (a: ;: n) _p) 2

2
-,-n---p---('-l----p--'-)-,:- + (np+a - p )
(a+;B+n)2 a+;B+n

foJ4. Let a = ;B =

(In Example 12.12 we will explain this choice.) The

resulting estimator is and the risk function is

~ Y+f0J4
P2 =
n+vn

R(p,fh) = 4(n +nvn)2.

The risk functions are plotted in figure 12.2. As we can see, neither estimator uniformly dominates the other.

These examples highlight the need to be able to compare risk functions. To do so, we need a one-number summary of the risk function. Two such summaries are the maximum risk and the Bayes risk.

12.4 Definition. The maximum risk is
R(B) = sup R( (), B)
()
and the Bayes risk is

(12.1)

r(j, B) = / R((), B)f(())d()

(12.2)

where f (()) is a prior for ().

196 12. Statistical Decision Theory

P
FIGURE 12.2. Risk functions for fh and fh in Example 12.3. The solid curve is
R(fh). The dotted line is R(fh).

12.5 Example. Consider again the two estimators in Example 12.3. We have

R(P~I ) =

p(1- p) max

O<:::p<:::l

n

1
4n

and n
4(n+ fo)2·

Based on maximum risk, P2 is a better estimator since R(P2) < R(Pl). How-

ever, when n is large, R(Pl) has smaller risk except for a small region in the
parameter space near P = 1/2. Thus, many people prefer PI to P2. This il-

lustrates that one-number summaries like maximum risk are imperfect. Now

consider the Bayes risk. For illustration, let us take j(p) = l. Then

( J ( J r- j, P~I) =

R p, P~I) dp =

p(l n

p) dp

=

-1 6n

and

J r-(j,P2) = R(P,P2)dp = 4(n +nfo)2·

For n ~ 20, r-(j,P2) > r-(j,fiI) which suggests that PI is a better estimator.
This might seem intuitively reasonable but this answer depends on the choice of prior. The advantage of using maximum risk, despite its problems, is that it does not require one to choose a prior. _

These two summaries of the risk function suggest two different methods
e for devising estimators: choosing to minimize the maximum risk leads to

12.3 Bayes Estimators 197
e minimax estimators; choosing to minimize the Bayes risk leads to Bayes
estimators.

12.6 Definition. A decision rule that minimizes the Bayes risk is called a Bayes rule. Formally, e is a Bayes rule with respect to the prior f if

e) r(f, e) = i12f r(f, e

(12.3)

where the infimum is over all estimators e. An estimator that minimizes the maximum risk is called a minimax rule. Formally, e is minimax if

sup R(e, e) = i12f sup R(e, e)

e

ee

(12.4)

where the infimum is over all estimators e.

12.3 Bayes Estimators

Let f be a prior. From Bayes' theorem, the posterior density is

f(elx) = f(xle)f(e) = f(xle)f(e)

rn(x)

J f(xle)f(e)de

(12.5)

J J where rn(x) = f(x, e)de = f(xle)f(e)de is the marginal distribution of

e( X. Define the posterior risk of an estimator x) by

1 r(elx) = L(e, e(x))f(elx)de.

(12.6)

12.7 Theorem. The Bayes risk r(f, e) satisfies
1 r(f, e) = r(elx)rn(x) dx.

Let B(x) be the value of e that minimizes r(elx). Then e is the Bayes estimator.

PROOF. We can rewrite the Bayes risk as follows:

1 1(1 r(f, e) = R(e, e)f(e)de =

L(e, e(x))f(X1e)dx) f(e)de

11 11 L(e, e(x))f(x, e)dxde =

L(e, e(x))f(elx)rn(x)dxde

1(1 1 L(e, e(x))f(eIX)de) rn(x) dx = r(elx)rn(x) dx.

198

12. Statistical Decision Theory

If we choose 8(x) to be the value of 8 that minimizes r(8Ix) then we will mini-
mize the integrand at every x and thus minimize the integral J r(8Ix)m(x)dx.
·
Now we can find an explicit formula for the Bayes estimator for some specific
loss functions.

12.8 Theorem. If L(8, 8) = (8 - 8)2 then the Bayes estimator is
J 8(x) = 8f(8Ix)d8 = IE(8IX = x).

(12.7)

If L(8,8) 18 - 81 then the Bayes estimator is the median of the posterior f( 8Ix). If L(8, 8) is zero-one loss, then the Bayes estimator is the mode of the
posterior f(8Ix).
PROOF. We will prove the theorem for squared error loss. The Bayes rule 8(x) minimizes r(8Ix) = J(8 - 8(X))2 f(8Ix)d8. Taking the derivative of r(8Ix) with respect to 8(x) and setting it equal to 0 yields the equation 2 J(8 -
8(x))f(8Ix)d8 = o. Solving for 8(x) we get 12.7.·
12.9 Example. Let Xl, ... , Xn rv N(,l, (}2) where (}2 is known. Suppose we use a N(a, b2 ) prior for Il. The Bayes estimator with respect to squared error loss is the posterior mean, which is

·

12.4 Minimax Rules

Finding minimax rules is complicated and we cannot attempt a complete coverage of that theory here but we will mention a few key results. The main message to take away from this section is: Bayes estimators with a constant risk function are minimax.
12.10 Theorem. Let (jJ be the Bayes rule for some prior f:

r(f,(ff) = illfr(f,8). e

Suppose that

R(8, 8f ) :::; r(j, 8f ) for all 8.

Then 8f is minimax and f is called a least favorable prior.

(12.8) (12.9)

12.4 Minimax Rules 199

PROOF. Suppose that e! is not minimax. Then there is another rule eo such
that sUPe R(e,~) < sUPe R(e, e!). Since the average of a function is always
less than or equal to its maximum, we have that r(j, eo) <::: sUPe R(e, eo).

Hence,

r(j,eo) <::: supR(e,eo) < supR(e,e!) <::: r(j,e!)

e

e

which contradicts (12.8). _

e 12.11 Theorem. Suppose that is the Bayes rule with respect to some
e e)e, prior f. Suppose further that has constant risk: R( = c for some c.
Then e is minimax.
J PROOF. The Bayes risk is r(f, e) = R(e, e)f(e)de = c and hence R(e, e) <::: e) r(j, for all e. Now apply the previous theorem. _

12.12 Example. Consider the Bernoulli model with squared error loss. In example 12.3 we showed that the estimator

has a constant risk function. This estimator is the posterior mean, and hence
the Bayes rule, for the prior Beta(a, p) with a = I' = In/4. Hence, by the
previous theorem, this estimator is minimax. _
12.13 Example. Consider again the Bernoulli but with loss function
L( ~) = (p - p)2
p,p p(l - p)
Let

The risk is

R(p,p) = E ((p - p)2) = 1 (P(l- p)) = .!.

p(l-p) p(1-p)

n

n

which, as a function of p, is constant. It can be shown that, for this loss
function, p(xn) is the Bayes estimator under the prior f(p) = 1. Hence, pis
minimax. _

A natural question to ask is: what is the minimax estimator for a Normal model?

200

12. Statistical Decision Theory

e

-0.5

o

0.5

FIGURE 12.3. Risk function for constrained Normal with m=.S. The two short dashed lines show the least favorable prior which puts its mass at two points.
12.14 Theorem. Let Xl' ... ' Xn '" N(e, 1) and let B= X. Then e is minimax
with respect to any well-behaved loss function. 1 It is the only estimator with this property.
If the parameter space is restricted, then the theorem above does not apply as the next example shows.
12.15 Example. Suppose that X '" N(e, 1) and that e is known to lie in the interval [-m, m] where 0 < m < 1. The unique, minimax estimator under squared error loss is
B(X) = m tanh(mX)
where tanh(z) = (e Z - e-Z)/(eZ+ e- Z). It can be shown that this is the Bayes
rule with respect to the prior that puts mass 1/2 at m and mass 1/2 at -m. Moreover, it can be shown that the risk is not constant but it does satisfy
R(e, B) ~ r(J, B) for all e; see Figure 12.3. Hence, Theorem 12.10 implies that
e is minimax. _

1 "Well-behaved" means that the level sets must be convex and symmetric about the origin.
The result holds up to sets of measure o.

12.5 Maximum Likelihood, Minimax, and Bayes 201
12.5 Maxirnurn Likelihood, Minimax, and Bayes
For parametric models that satisfy weak regularity conditions, the maximum likelihood estimator is approximately minimax. Consider squared error loss which is squared bias plus variance. In parametric models with large samples, it can be shown that the variance term dominates the bias so the risk of the
B MLE roughly equals the variance: 2

As we saw in Chapter 9, the variance of the MLE is approximately

~

1

V(e) R::: nJ(e)

where J(e) is the Fisher information. Hence,

~

1

nR(e, e) R::: J(e)"

(12.10)

For any other estimator e', it can be shown that for large n, R(e, e') ~ R(e, B).

More precisely,

~

1

limlimsup sup nR(e',e) ~ -(e)'

E-+O n-+oo le-e'I<E

J

(12.11)

This says that, in a local, large sample sense, the MLE is minimax. It can also be shown that the MLE is approximately the Bayes rule.
In summary:

In most parametric models, with large samples, the MLE is approximately minimax and Bayes.

There is a caveat: these results break down when the number of parameters is large as the next example shows.
12.16 Example (Many Normal means). Let Yi rv N(ei , (J2/ n ), i = 1, ... ,n.
Let Y = (Yl , ... , Yn) denote the data and let e = (el , ... , en) denote the unknown parameters. Assume that

2Typically, the squared bias is order O(n-2) while the variance is of order O(n- 1 ).

202

12. Statistical Decision Theory

for some c > O. In this model, there are as many parameters as observations. 3
The !VILE is e = Y = (Y1, ... , Yn). Under the loss function L(8, e) = L~=l (ei -
e) 8i )2, the risk of the !VILE is R(8, = (J2. It can be shown that the minimax risk
is approximately (J2 / ((J2 + c2 ) and one can find an estimator (j that achieves + this risk. Since (J2 / ((J2 c2 ) < (J2, we see that (j has smaller risk than the !VILE.
In practice, the difference between the risks can be substantial. This shows
that maximum likelihood is not an optimal estimator in high dimensional
problems. _

12.6 Adrnissibility
Minimax estimators and Bayes estimators are "good estimators" in the sense that they have small risk. It is also useful to characterize bad estimators.

12.17 Definition. An estimator 8 is inadmissible if there exists another rule e f such that
R(8,ef) < R(8,e) for all 8 and R(8, e f) < R(8, e) for at least one 8.
Otherwise, 8 is admissible.

12.18 Example. Let X rv N(8,1) and consider estimating 8 with squared
e error loss. Let e(X) = 3. We will show that e is admissible. Suppose not.
Then there exists a different rule (it with smaller risk. In particular, R(3, f ) ::;
R(3, e) = o. Hence, 0 = R(3, efl = J(ef(x) - 3)~f(x; 3)dx. Thus, ef(x) = 3.
So there is no rule that beats 8. Even though 8 is admissible it is clearly a
bad decision rule. _

12.19 Theorem (Bayes Rules Are Admissible). Suppose that 8 c lR and that

R(8, e) is a continuous function of 8 for every e. Let f be a prior density with
full support, meaning that, for every 8 and every E > 0, J:~EE f(8)d8 > O. Let

ef be the Bayes! rule. If the Bayes risk is finite then ef is admissible.

e e PROOF. Suppose f is inadmissible. Then there exists a better rule such

e) ::; that R(8,

R(8, ef ) for all 8 and R(80 , e) < R(80 , ef ) for some 80. Let

3The many Normal means problem is more general than it looks. Many non parametric estimation problems are mathematically equivalent to this model.

12.6 Admissibility 203
V = R( eo, e f ) - R( eo, e) > O. Since R is continuous, there is an E > 0 such
that R(e,(jf) - R(e,fi) > v/2 for all e E (eo - E,eo + E). Now,

r(j, ef ) - r(j, e)

/ R(e, ef)J(e)de - / R(e, e)J(e)de

/ [R(e,ef ) -R(e,e)] J(e)de
r(}O+E
> }(}O-E [R( e, e f ) - R(e, e)] J( e)de
> ~ l(~~:E J(e)de
> o.
e Hence, r(j, e f ) > r(j, fi). This implies that e f does not minimize r(j, e) which
contradicts the fact that f is the Bayes rule. _
12.20 Theorem. Let Xl,"" Xn rv N(IL, CJ2). Under squared error loss, X is admissible.

The proof of the last theorem is quite technical and is omitted but the idea is as follows: The posterior mean is admissible for any strictly positive prior. Take the prior to be N(a, b2 ). When b2 is very large, the posterior mean is approximately equal to X.
How are minimaxity and admissibility linked? In general, a rule may be one, both, or neither. But here are some facts linking admissibility and minimaxity.

12.21 Theorem. Suppose that e has constant risk and is admissible. Then it

is minimax.

e) PROOF. The risk is R(e, e' there exists a rule such that

e c for some c. If were not minimax then

R(e,e') ~ supR(e,B') < supR(e,e) = c.

()

()

e This would imply that is inadmissible. _
Now we can prove a restricted version of Theorem 12.14 for squared error loss.

12.22 Theorem. Let Xl"'" Xn rv N(e, 1). Then, under squared error loss,
e = X is minimax.
e e PROOF. According to Theorem 12.20, is admissible. The risk of is lin
which is constant. The result follows from Theorem 12.21. _

204

12. Statistical Decision Theory

Although minimax rules are not guaranteed to be admissible they are "close
to admissible." Say that (f is strongly inadmissible if there exists a rule (ft
and an f > 0 such that R(8, (ft) < R(8, 1i) - f for all 8.

12.23 Theorem. If 8 is minimax, then it is not strongly inadmissible.

12.7 Stein's Paradox

Suppose that X c-v N(8, 1) and consider estimating 8 with squared error loss.

From the previous section we know that (f(X) = X is admissible. Now consider

estimating two, unrelated quantities 8 = (81 ,82 ) and suppose that Xl rv

~
N(8 1 , 1) and X 2 c-v N(82, 1) independently, with loss L(8, 8) =

L

2
j=

l

(8

j

-

~
8j

j2.

Not surprisingly, (f(X) = X is again admissible where X = (Xl, X2). Now

consider the generalization to k normal means. Let 8 = (81 , ... , 8k ), X = (Xl, ... , Xk) with Xi c-v N(8i , 1) (independent) and loss L(8, (f) = L~=l (8j -

(fj)2. Stein astounded everyone when he proved that, if k ::;:, 3, then (f(X) = X

is inadmissible. It can be shown that the James-Stein estimator (fs has

sm. aller.nsk,

where 8~s

-_

(8~s 1

,

...

,

8~s
k

),

~s ( k-2)+
8i (X) = 1 - Li X; Xi

(12.12)

and (z)+ = max{z, O}. This estimator shrinks the Xi's towards o. The message
is that, when estimating many parameters, there is great value in shrinking the estimates. This observation plays an important role in modern nonparametric function estimation.

12.8 Bibliographic Remarks
Aspects of decision theory can be found in Casella and Berger (2002), Berger (1985), Ferguson (1967), and Lehmann and Casella (1998).

12.9 Exercises
1. In each of the following models, find the Bayes risk and the Bayes estimator, using squared error loss. (a) X c-v Binomial(n,p), p c-v Beta(a, ,6).

12.9 Exercises 205

(b) X rv Poisson(A), A rv Gamma(o:,p). (c) X rv N(e,(J"2) where (J"2 is known and e rv N(a,b 2).

2. Let Xl"'" Xn rv N(e, (J"2) and suppose we estimate e with loss function L(e, e) = (e - e)2 j(J"2. Show that X is admissible and minimax.

3. Let 8 = {el , ... , ek} be a finite parameter space. Prove that the poste-
rior mode is the Bayes estimator under zero-one loss.

4. (Casella and Berger (2002).) Let Xl, ... ,Xn be a sample from a distribution with variance (J"2. Consider estimators of the form bS2 where S2 is the sample variance. Let the loss function for estimating (J"2 be

2 ~2

~(J"2

(~(J"2)

L((J" ,(J" ) = (J"2 - 1 -log (J"2 .

Find the optimal value of b that minimizes the risk for all (J"2.
5. (Berliner (1983).) Let X rv Binomial(n,p) and suppose the loss function is
L(p,p) = (1-~~) 2
where 0 < p < 1. Consider the estimator p(X) = O. This estimator falls
outside the parameter space (0,1) but we will allow this. Show that p(X) = 0 is the unique, minimax rule.
6. (Computer Experiment.) Compare the risk of the MLE and the JamesStein estimator (12.12) by simulation. Try various values of n and vari-
ous vectors e. Summarize your results.

Part III
Statistical Models and Methods

13
Linear and Logistic Regression

Regression is a method for studying the relationship between a response

variable Y and a covariate X. The covariate is also called a predictor

variable or a feature. lOne way to summarize the relationship between X

and Y is through the regression function
J r(x) = lE(YIX = x) = y f(ylx)dy.

(13.1)

Our goal is to estimate the regression function r( x) from data of the form

In this Chapter, we take a parametric approach and assume that r is linear. In Chapters 20 and 21 we discuss nonparametric regression.
13.1 Simple Linear Regression
The simplest version of regression is when Xi is simple (one-dimensional) and r(x) is assumed to be linear:
r(x) = Po + PIX.
IThe term "regression" is due to Sir Francis Galton (1822-1911) who noticed that tall and short men tend to have sons with heights closer to the mean. He called this "regression towards the mean."

210 13. Linear and Logistic Regression

w -i

E l() -i

... .Q....l
::l
~.... -i
Q.l
P.
..SQ...,l '-"i

Q.l

U
..f..l.

'-"i

::l

Ul

b.o
.Q

-i

·

·

0
-i

4.0

4.5

5.0

5.5

log light int n ity (X)

FIGURE 13.1. Data on nearby stars. The solid line is the least squares line.

This model is called the the simple linear regression model. We will make
the further simplifying assumption that V( fi IX = x) = (52 does not depend
on x. We can thus write the linear regression model as follows.

13.1 Definition. The Simple Linear Regression Model

Yi = (30 + (31 X i + fi
where lE(fiIXi) = 0 and V(fiIXi) = (52.

(13.2)

13.2 Example. Figure 13.1 shows a plot oflog surface temperature (Y) versus log light intensity (X) for some nearby stars. Also on the plot is an estimated linear regression line which will be explained shortly.·

The unknown parameters in the model are the intercept (30 and the slope

~

~

(31 and the variance (52. Let (30 and (31 denote estimates of (30 and (31. The

fitted line is

(13.3)

The predicted values or fitted values are Yi = f(Xi) and the residuals
are defined to be
(13.4)

13.1 Simple Linear Regression 211
The residual sums of squares or RSS, which measures how well the line fits
fl· the data, is defined by RSS = L~=1
13.3 Definition. The least squares estimates are the values Po and PI
f;. that minimize RSS = L~=1

13.4 Theorem. The least squares estimates are given by

L~=I(Xi -Xn)(Y; - Y n)
L~=1 (Xi - Xn)2

Po

Y n - PI Xn·

An unbiased estimate of (J"2 is

(_1 ~2_

)~~2

(J" -

n _ 2 6 Ei ·

i=1

(13.5) (13.6)
(13.7)

13.5 Example. Consider the star data from Example 13.2. The least squares
iJo iJl estimates are = 3.58 and = 0.166. The fitted line r(x) = 3.58 + 0.166x
is shown in Figure 13.1. ·

13.6 Example (The 2001 Presidential Election). Figure 13.2 shows the plot of votes for Buchanan (Y) versus votes for Bush (X) in Florida. The least squares estimates (omitting Palm Beach County) and the standard errors are

Po

66.0991 se(iJo) = 17.2926

PI

0.0035 se(iJl) = 0.0002.

The fitted line is

Buchanan = 66.0991 + 0.0035 Bush.

(We will see later how the standard errors were computed.) Figure 13.2 also shows the residuals. The inferences from linear regression are most accurate when the residuals behave like random normal numbers. Based on the residual plot, this is not the case in this example. If we repeat the analysis replacing votes with log (votes) we get

Po

-2.3298 se(iJo) = 0.3529

PI

0.730300 se(iJl) = 0.0358.

212

13. Linear and Logistic Regression

0,------------------------,
o
~

o~--------~--------~--~
Bush

'i;,~ ~:~ . ',

'.~

---. -' ---.-

-------:-'-

-----------_.

oo
~~--------1-25~OO-O--------250~OO-O~
Bush

".

..... ·

··

I

- - - - ; ..... _ - _,_ - - - - & - - - - - - -r _0,- _ -. ___ ~ _____ _

13

1~---,--,---~10,-~11--~12--~13

Bush

FIGURE 13.2. Voting Data for Election 2000. See example 13.6.

This gives the fit
log(Buchanan) = -2.3298 + 0.7303 log(Bush).
The residuals look much healthier. Later, we shall address the following question: how do we see if Palm Beach County has a statistically plausible outcome? _

13.2 Least Squares and Maxirnurn Likelihood
Suppose we add the assumption that EilXi rv N(O, (J2), that is,

13.2 Least Squares and Maximum Likelihood 213
where fLi = (30 + (31Xi' The likelihood function is

I In f(Xi , li)

n

i=l

i=l

n

n

i=l

i=l

IIn
£2 = iYlx(liIXi). i=l

(13.8)

The term £1 does not involve the parameters (30 and (31. We shall focus on the second term £2 which is called the conditional likelihood, given by

_ II £2

= £((30, (31, (J)

n
= i=l iYlx(liIXi)

ex: (J -n exp {

-

2(1J2

"~.")' li

-

fLi) 2 }

.

The conditional log-likelihood is

~n

2

£((30, (31, (J) = -n log (J - 2!2 (li - ((30 + (31 X ,))

(13.9)

To find the MLE of ((30, (31) we maximize £((30, (31, (J). From (13.9) we see that
maximizing the likelihood is the same as minimizing the RSS L:~=1 (li - ((30 +
2
(31Xi)) . Therefore, we have shown the following:

13.7 Theorem. Under the assumption of Normality, the least squares estimator is also the maximum likelihood estimator.

We can also maximize £((30, (31, (J) over (J, yielding the MLE

(~J 2

-_ -1

L~2
E.

n.'

(13.10)

This estimator is similar to, but not identical to, the unbiased estimator. Common practice is to use the unbiased estimator (13.7).

214

13. Linear and Logistic Regression

13.3 Properties of the Least Squares Estimators

We now record the standard errors and limiting distribution of the least squares estimator. In regression problems, we usually focus on the properties of the estimators conditional on xn = (Xl," ., Xn). Thus, we state the means and variances as conditional means and variances.

13.8 Theorem. Let ~T = (~o, ~l)T denote the least squares estimators. Then,

IE(~lxn) V(~lxn)

( ~~ )

~2 ( ~ L~=lX;

ns~

-Xn

) -Xn 1

(13.11)

where S2x = n -1 "u,in=l(Xi - -Xn )2 .

The estimated standard errors of f30 and f3l are obtained by taking the
square roots of the corresponding diagonal terms of V(~lxn) and inserting
the estimate (; for ~. Thus,

(13.12)

(13.13)

We should really write these as se(~o Ixn) and se(~ Ixn) but we will use the shorter notation se(~o) and se(~d.

13.9 Theorem. Under appropriate conditions we have:

1.

~p
(Consistency): f3o--+ f30

and f-3l--p+ f3l.

2. (Asymptotic Normality):

f30 -~f3o ~ N(O, 1) and
se(f3o)

3. Approximate 1 - Q confidence intervals for f30 and f3l are

(13.14)

13.4 Prediction 215
4. The Wald test 2 for testing Ho : PI = 0 versus HI : PI i= 0 is: reject Ho if IWI > Za/2 where W = ih/se(fjd·
13.10 Example. For the election data, on the log scale, a 95 percent confidence interval is .7303 ± 2(.0358) = (.66, .80). The Wald statistics for testing
Ho : PI = 0 versus HI : PI i= 0 is IWI = 1.7303 - 01/.0358 = 20.40 with a p-value of IP'(IZI > 20.40) :::::; O. This is strong evidence that that the true slope
is not O.·
13.4 Prediction
Suppose we have estimated a regression model r(x) = Po + PIX from data
(Xl, Y1 ), . .. , (Xn' Yn). We observe the value X = x* of the covariate for a new subject and we want to predict their outcome Y*. An estimate of Y* is
(13.15)
Using the formula for the variance of the sum of two random variables,

Theorem 13.8 gives the formulas for all the terms in this equation. The es-
timated standard error seCY*) is the square root of this variance, with (j2 in
place of ()2. However, the confidence interval for Y* is not of the usual form
Y* ± Za/2Se. The reason for this is explained in Exercise 10. The correct form
of the confidence interval is given in the following theorem.

13.11 Theorem (Prediction Interval). Let

(13.16)

An approximate 1 - Q prediction interval for Y* zs

(13.17)

2Recall from equation (10.5) that the Wald statistic for testing Ho : ;3 = ;30 versus HI : ;3 =f.;30 is W = ((3 - ;3o)/se((3).

216

13. Linear and Logistic Regression

13.12 Example (Election Data Revisited). On the log scale, our linear regression gives the following prediction equation:

log(Buchanan) = -2.3298 + 0.7303log(Bush).

In Palm Beach, Bush had 152,954 votes and Buchanan had 3,467 votes. On the log scale this is 11.93789 and 8.151045. How likely is this outcome, assuming our regression model is appropriate? Our prediction for log Buchanan votes
-2.3298 + .7303 (11.93789)=6.388441. Now, 8.151045 is bigger than 6.388441
but is it "significantly" bigger? Let us compute a confidence interval. We find that ~n = .093775 and the approximate 95 percent confidence interval is (6.200,6.578) which clearly excludes 8.151. Indeed, 8.151 is nearly 20 standard errors from Y*. Going back to the vote scale by exponentiating, the confidence interval is (493,717) compared to the actual number of votes which is 3,467.
·

13.5 Multiple Regression
Now suppose that the covariate is a vector of length k. The data are of the form

where

Here, Xi is the vector of k covariate values for the 'ith observation. The linear

regression model is

Lk
Y; = + (3jXij Ei
j=l

(13.18)

for 'i = 1, ... , n, where JE(Ei IX1i , ... , Xki) = O. Usually we want to include an intercept in the model which we can do by setting X i1 = 1 for'i = 1, ... , n. At this point it will be more convenient to express the model in matrix notation. The outcomes will be denoted by

and the covariates will be denoted by

13.5 Multiple Regression 217

Xlk ) X:k .
Xnk Each row is one observation; the columns correspond to the k covariates. Thus, X is a (n x k) matrix. Let

Then we can write (13.18) as (13.19)
The form of the least squares estimate is given in the following theorem.

13.13 Theorem. Assuming that the (k x k) matrix XT X is invertible,

(XTX)-lXTy (J"2(XT X)-l N({3, (J"2(XT X)-l).

(13.20) (13.21 ) (13.22)

The estimate regression function is r(x) = L~=l (3jXj. An unbiased esti-

mate of (J"2 is

~2= (_1 )~~2

(J"

n _ k ~E,

i=l

where E = X(3 - Y is the vector of residuals. An approximate 1- a confidence interval for {3j is
(13.23)

13.14 Example. Crime data on 47 states in 1960 can be obtained from http://lib.stat.cmu.edu/DASL /Stories /USCrime.html.
If we fit a linear regression of crime rate on 10 variables we get the following:

218 13. Linear and Logistic Regression

Covariate
(Intercept) Age Southern State Education Expenditures Labor Number of Males Population Unemployment (14-24) Unemployment (25-39) Wealth

(3j
-589.39 1.04
11.29 1.18 0.96 0.11 0.30 0.09 -0.68 2.15 -0.08

se(j3j)
167.59 0.45
13.24 0.68 0.25 0.15 0.22 0.14 0.48 0.95 0.09

t value
-3.51 2.33 0.85
1.7 3.86 0.69 1.36 0.65 -1.4 2.26 -0.91

p-value
0.001 ** 0.025 *
0.399 0.093
0.000 ***
0.493
0.181
0.518
0.165
0.030 *
0.367

This table is typical of the output of a multiple regression program. The "t-
value" is the Wald test statistic for testing Ho : fJj = 0 versus HI : fJj i=- O. The
asterisks denote "degree of significance" and more asterisks denote smaller p-values. The example raises several important questions: (1) should we eliminate some variables from this model? (2) should we interpret these relationships as causal? For example, should we conclude that low crime prevention expenditures cause high crime rates? We will address question (1) in the next section. We will not address question (2) until Chapter 16.·

13.6 Model Selection
Example 13.14 illustrates a problem that often arises in multiple regression. We may have data on many covariates but we may not want to include all of them in the model. A smaller model with fewer covariates has two advantages: it might give better predictions than a big model and it is more parsimonious (simpler). Generally, as you add more variables to a regression, the bias of the predictions decreases and the variance increases. Too few covariates yields high bias; this called underfitting. Too many covariates yields high variance; this called overfitting. Good predictions result from achieving a good balance between bias and variance.
In model selection there are two problems: (i) assigning a "score" to each model which measures, in some sense, how good the model is, and (ii) searching through all the models to find the model with the best score.
Let us first discuss the problem of scoring models. Let S C {I, ... ,k} and let Xs = {Xj : j E S} denote a subset of the covariates.~Let fJs denote the coefficients of the corresponding set of covariates and let fJs denote the least squares estimate of fJs. Also, let Xs denote the X matrix for this subset of

13.6 Model Selection 219

covariates and define rs(x) to be the estimated regression function. The predicted values from model S are denoted by ~(S) = rS(Xi). The prediction
risk is defined to be

n
R(S) = 2)E(~(S) - Yi*)2
i=l

(13.24)

where Yi* denotes the value of a future observation of Yi at covariate value
Xi. Our goal is to choose S to make R(S) small. The training error is defined to be

n
Rtr(S) = 2)~(S) - Yi)2.
i=l

This estimate is very biased as an estimate of R(S).

13.15 Theorem. The training error is a downward-biased estimate of the prediction risk:
lE(Rtr(S)) < R(S).

In fact,

L bias(Rtr(S)) = lE(Rtr(S)) - R(S) = -2 Cov(~, Yi).
i=l

(13.25)

The reason for the bias is that the data are being used twice: to estimate the parameters and to estimate the risk. When we fit a complex model with
many parameters, the covariance Cov(~, Yi) will be large and the bias of the
training error gets worse. Here are some better estimates of risk. Mallow's Cp statistic is defined by

(13.26)

where lSI denotes the number of terms in Sand &2 is the estimate of (J"2 obtained from the full model (with all covariates in the model). This is simply the training error plus a bias correction. This estimate is named in honor of Colin Mallows who invented it. The first term in (13.26) measures the fit of the model while the second measure the complexity of the model. Think of the Cp statistic as:
lack of fit + complexity penalty.

Thus, finding a good model involves trading off fit and complexity.

220

13. Linear and Logistic Regression

A related method for estimating risk is AIC (Akaike Information Criterion). The idea is to choose S to maximize

is -lSI

(13.27)

where is is the log-likelihood of the model evaluated at the !viLE. 3 This can be thought of "goodness of fit" minus "complexity." In linear regression with

Normal errors (and taking (J" equal to its estimate from the largest model), maximizing AIC is equivalent to minimizing Mallow's Cp ; see Exercise 8. The appendix contains more explanation about AIC.
Yet another method for estimating risk is leave-one-out cross-validation. In this case, the risk estimator is

n
Rev(S) = 2:)Yi - YCi))2
i=l

(13.28)

where Y(i) is the prediction for Yi obtained by fitting the model with Yi omit-

ted. It can be shown that

)2 Rev(S)

=

'~n"

(

Yi - Y~i(S)
1- U(S)

i=l

n

(13.29)

where Uii(S) is the 'ith diagonal element of the matrix

(13.30)

Thus, one need not actually drop each observation and re-fit the model. A

generalization is k-fold cross-validation. Here we divide the data into k

groups; often people take k = 10. We omit one group of data and fit the

models to the remaining data. We use the fitted model to predict the data
in the group that was omitted. We then estimate the risk by Li(Yi _ ~)2

where the sum is over the the data points in the omitted group. This process is

repeated for each of the k groups and the resulting risk estimates are averaged.

For linear regression, Mallows Cp and cross-validation often yield essentially the same results so one might as well use Mallows' method. In some of the

more complex problems we will discuss later, cross-validation will be more

useful.

Another scoring method is BIC (Bayesian information criterion). Here we

choose a model to maximize

BIC(S) = is -

lSI
210gn.

(13.31 )

3Some texts use a slightly difFerent definition of Ale which involves multiplying the definition here by 2 or -2. This has no efFect on which model is selected.

13.6 Model Selection 221

The BIC score has a Bayesian interpretation. Let S = {Sl, ... , Sm} denote
a set of models. Suppose we assign the prior IP'(Sj) = 11m over the models. Also, assume we put a smooth prior on the parameters within each model. It can be shown that the posterior probability for a model is approximately,

eB1C(Sj)

Lr IP'(Sjldata) ;:::

eB1C(Sr)·

Hence, choosing the model with highest BIC is like choosing the model with highest posterior probability. The BIC score also has an information-theoretic interpretation in terms of something called minimum description length. The BIC score is identical to Mallows Cp except that it puts a more severe penalty for complexity. It thus leads one to choose a smaller model than the other methods.
Now let us turn to the problem of model search. If there are k covariates then there are 2k possible models. We need to search through all these models, assign a score to each one, and choose the model with the best score. If k is not too large we can do a complete search over all the models. When k is large, this is infeasible. In that case we need to search over a subset of all the models. Two common methods are forward and backward stepwise regression. In forward stepwise regression, we start with no covariates in the model. We then add the one variable that leads to the best score. We continue adding variables one at a time until the score does not improve. Backwards stepwise regression is the same except that we start with the biggest model and drop one variable at a time. Both are greedy searches; nether is guaranteed to find the model with the best score. Another popular method is to do random searching through the set of all models. However, there is no reason to expect this to be superior to a deterministic search.

13.16 Example. We applied backwards stepwise regression to the crime data using AIC. The following was obtained from the program R. This program uses a slightly different definition of AIC. With their definition, we seek the smallest (not largest) possible AIC. This is the same is minimizing Mallows Cpo
The full model (which includes all covariates) has AIC= 310.37. In ascending order, the AIC scores for deleting one variable are as follows:

variable Pop Labor South Wealth Males Ul Educ. U2 Age Expend

Ale

308 309

309

309

310 310 312 314 315

324

For example, if we dropped Pop from the model and kept the other terms, then the AIC score would be 308. Based on this information we drop "pop-

222

13. Linear and Logistic Regression

ulation" from the model and the current AIC score is 308. Now we consider dropping a variable from the current model. The AIC scores are:

variable South Labor Wealth Males U1 Education U2 Age Expend

Ale

308

308

308

309 309

310

313 313

329

We then drop "Southern" from the model. This process is continued until there is no gain in AIC by dropping any variables. In the end, we are left with the following model:

Crime

1.2 Age + .75 Education + .87 Expenditure + .34 Males - .86 U1 + 2.31 U2.

Warning! This does not yet address the question of which variables are causes of crime. _

There is another method for model selection that avoids having to search through all possible models. This method, which is due to Zheng and Loh (1995), does not seek to minimize prediction errors. Rather, it assumes some subset of the (3j'S are exactly equal to 0 and tries to find the true model, that is, the smallest sub-model consisting of nonzero (3j terms. The method is carried out as follows.

Zheng-Loh Model Selection Method 4
1. Fit the full model with all k covariates and let Wj = fij / {k(/3j) denote
the Wald test statistic for Ho : (3j = 0 versus HI : (3j of. o.
2. Order the test statistics from largest to smallest in absolute value:

J 3. Let be the value of j that minimizes
+ RSS(j) j (;2 log n
where RSS(j) is the residual sums of squares from the model with the j largest Wald statistics.
J 4. Choose, as the final model, the regression with the terms with the
largest absolute Wald statistics.

13.7 Logistic Regression 223

o

x

FIGURE 13.3. The logistic function p = eX /(1 + eX).

Zheng and Loh showed that, under appropriate conditions, this method chooses the true model with probability tending to one as the sample size increases.

13.7 Logistic Regression
So far we have assumed that Yi is real valued. Logistic regression is a parametric method for regression when Yi E {O, I} is binary. For a k-dimensional
covariate X, the model is

(13.32)

or, equivalently,

Lk
10git(Pi) = {3o + (3j X ij

(13.33)

j=l

where

(-p_) . logit(p) = log 1-p

(13.34)

The name "logistic regression" comes from the fact that eX /(1 + eX) is called

the logistic function. A plot of the logistic for a one-dimensional covariate is shown in Figure 13.3.

Because the Yi's are binary, the data are Bernoulli:

IX Yi i = Xi rv Bernoulli(pi).

Hence the (conditional) likelihood function is
IIn
£({3) = Pi ({3) Y; (1 - Pi ({3) )1- Yi ·
i=l

(13.35)

4This is just one version of their method. In particular, the penalty j log n is only one choice from a set of possible penalty functions.

224

13. Linear and Logistic Regression

The MLE ;3 has to be obtained by maximizing £({3) numerically. There is a fast numerical algorithm called reweighted least squares. The steps are as follows:

Reweighted Least Squares Algorithm
p? Choose starting values ;30 = (;38, ... ,;3~) and compute using equation
(13.32), for i = 1, ... ,n. Set s = 0 and iterate the following steps until
convergence.

1. Set

Zi

=

1
Og

·t
l

(PiS)

+ pfl(i1--

pf pf

),

i = 1, ... ,no

2. Let W be a diagonal matrix with (i, i) element equal to pHI - pf).

3. Set

This corresponds to doing a (weighted) linear regression of Z on Y.
4. Set s = s + 1 and go back to the first step.

The Fisher information matrix I can also be obtained numerically. The
estimate standard error of ;3j is the (j, j) element of J = I-I. Model selection is usually done using the AlC score £s - 151.

13.17 Example. The Coronary Risk-Factor Study (CORIS) data involve 462 males between the ages of 15 and 64 from three rural areas in South Africa, (Rousseauwet al. (1983)). The outcome Y is the presence (Y = 1) or absence (Y = 0) of coronary heart disease. There are 9 covariates: systolic blood pressure, cumulative tobacco (kg), ldl (low density lipoprotein cholesterol), adiposity, famhist (family history of heart disease), typea (type-A behavior), obesity, alcohol (current alcohol consumption), and age. A logistic regression yields the following estimates and Wald statistics Wj for the coefficients:

13.8 Bibliographic Remarks 225

Covariate Intercept sbp tobacco Idl adiposity famhist typea obesity alcohol age

{3j -6.145 0.007 0.079 0.174 0.019 0.925 0.040 -0.063 0.000 0.045

se 1.300 0.006 0.027 0.059 0.029 0.227 0.012 0.044 0.004 0.012

Wj -4.738 1.138 2.991 2.925 0.637 4.078 3.233 -1.427 0.027 3.754

p-value 0.000 0.255 0.003 0.003 0.524 0.000 0.001 0.153 0.979 0.000

Are you surprised by the fact that systolic blood pressure is not significant or by the minus sign for the obesity coefficient? If yes, then you are confusing association and causation. This issue is discussed in Chapter 16. The fact that blood pressure is not significant does not mean that blood pressure is not an important cause of heart disease. It means that it is not an important predictor of heart disease relative to the other variables in the model. _

13.8 Bibliographic Rernarks
A succinct book on linear regression is Weisberg (1985). A data-mining view of regression is given in Hastie et al. (2001). The Akaike Information Criterion (AIC) is due to Akaike (1973). The Bayesian Information Criterion (BIC) is due to Schwarz (1978). References on logistic regression include Agresti (1990) and Dobson (2001).

13.9 Appendix
THE AKAIKE INFORMATION CRITERION (AIC). Consider a set of models {Nh, Nh, .. .}. Let h(x) denote the estimated probability function obtained by using the maximum likelihood estimator of model NIj . Thus, h(x) =
f(x; {ij) where {ij is the MLE of the set of parameters (3j for model NIj . We
J) will use the loss function D(f, where
D(f,g) = Lf(x)log (~~:D
x
is the Kullback-Leibler distance between two probability functions. The cor-
J) J). J) responding risk function is R(f, = lE(D(f, Notice that D(f, = c-

226

13. Linear and Logistic Regression

1) 1 AU, where c = Lx f(x) log f(x) does not depend on and

L AU, J) = f(x) log !(x).
x

Thus, minimizing the risk is equivalent to maximizing aU, 1) == lE(AU, 1)).
It is tempting to estimate aU, J) by Lx !(x) log !(x) but, just as the train-
ing error in regression is a highly biased estimate of prediction risk, it is also
the case that Lx 1(x) log !(x) is a highly biased estimate of aU, J). In fact,
the bias is approximately equal to 1M j I. Thus:

13.18 Theorem. AIC(Mj) is an approximately unbiased estimate of aU, 1).

13.10 Exercises
1. Prove Theorem 13.4. 2. Prove the formulas for the standard errors in Theorem 13.8. You should
regard the X/s as fixed constants. 3. Consider the regression through the origin model:

Find the least squares estimate for /3. Find the standard error of the estimate. Find conditions that guarantee that the estimate is consistent.
4. Prove equation (13.25).
5. In the simple linear regression model, construct a Wald test for Ho
/31 = 17/30 versus HI : /31 # 17/30·
6. Get the passenger car mileage data from http://lib.stat.cmu.ed u/DASL /Datafiles/ carmpgdat.html (a) Fit a simple linear regression model to predict MPG (miles per gallon) from HP (horsepower). Summarize your analysis including a plot of the data with the fitted line. (b) Repeat the analysis but use 10g(MPG) as the response. Compare the analyses.

13.10 Exercises 227
7. Get the passenger car mileage data from http://lib.stat.cmu.edu/DASL/Datafiles/carmpgdat.html (a) Fit a multiple linear regression model to predict MPG (miles per gallon) from the other variables. Summarize your analysis. (b) Use Mallow Gp to select a best sub-model. To search through the models try (i) forward stepwise, (ii) backward stepwise. Summarize your findings. (c) Use the Zheng-Loh model selection method and compare to (b). (d) Perform all possible regressions. Compare Gp and BIC. Compare the results.

8. Assume a linear regression model with Normal errors. Take (]" known. Show that the model with highest AIC (equation (13.27)) is the model with the lowest Mallows Gp statistic.

9. In this question we will take a closer look at the AIC method. Let
Xl, ... , Xn be lID observations. Consider two models Mo and MI. Under Mo the data are assumed to be N(O, 1) while under Ml the data
are assumed to be N (e, 1) for some unknown e E Jl{:

Mo: Xl, ... ,Xn Ml: Xl, ... ,Xn

N(O,l) N(e,l), e E Jl{.

This is just another way to view the hypothesis testing problem: Ho :
e = 0 versus HI : e # O. Let jin(e) be the log-likelihood function.
The AIC score for a model is the log-likelihood at the MLE minus the

number of parameters. (Some people multiply this score by 2 but that is irrelevant.) Thus, the AIC score for Mo is AIGo = jin(O) and the AIC score for Ml is AlGI = jin(ii) - 1. Suppose we choose the model with the highest AIC score. Let I n denote the selected model:

{O I n =

if AIGo > AlGI

1 if AlGI> AIGo.

e (a) Suppose that Mo is the true model, i.e. = O. Find

lim IF' (In = 0) .
n--+=
e Now compute limn--+oo IF' (In = 0) when # o.

228

13. Linear and Logistic Regression

e (b) The fact that limn--+oo][l' (In = 0) i= 1 when = 0 is why some people

say that AIC "overfits." But this is not quite true as we shall now see.
e Let cPe(x) denote a Normal density function with mean and variance

1. Define

In(x) = {cPo(x) if I n = 0 cPe(x) if I n = 1.

e~

p

If = 0, show that D(cPo, fn) -'...j 0 as n -+ 00 where

J D(j,g) = f(x) log (~~~D dx

in) is the Kullback-Leibler distance. Show also that D (cPe, '4 0 if e i= o.
Hence, AIC consistently estimates the true density even if it "overshoots" the correct model.

(c) Repeat this analysis for BIC which is the log-likelihood minus (p/2) log n where p is the number of parameters and n is sample size.

e 10. In this question we take a closer look at prediction intervals. Let =

+ -e--- + e e+ Po

PI X* and let

= Po

fhX*. Y* = Y* = ..........

----

..........

Thus,

while

E. Now,

e;:::::: N(e, se2 ) where

2
se

=

~
V(e)

=

~
V(po

+ p~IX*).

Note that V(e) is the same as VCY*). Now, e±2vv(if) is an approximate
e 95 percent confidence interval for = PO+PIX* using the usual argument
for a confidence interval. But, as you shall now show, it is not a valid
confidence interval for Y*.
(a) Let s = VVCY*). Show that

][l'(Y*-2s<Y*<Y*+2s) ;::: ][l'(-2<N(0,1+::) <2)
i= 0.95.
(b) The problem is that the quantity of interest Y* is equal to a param-
e eter plus a random variable. We can fix this by defining

In practice, we substitute & for (]" and we denote the resulting quantity

~

~

~

by ~n. Now consider the interval Y* ± 2 ~n. Show that

13.10 Exercises 229
11. Get the Coronary Risk-Factor Study (CORIS) data from the book web site. Use backward stepwise logistic regression based on AIC to select a model. Summarize your results.

14
Multivariate Models

In this chapter we revisit the Multinomial model and the multivariate Normal. Let us first review some notation from linear algebra. In what follows, x and yare vectors and A is a matrix.

Linear Algebra Notation

xTy
IAI AT
A-I
I tr(A) A 1/ 2

inner product Lj XjYj determinant transpose of A inverse of A the identity matrix trace of a square matrix; sum of its diagonal elements square root matrix

The trace satisfies tr(AB) = tr(BA) and tr(A) + tr(B). Also, tr(a) = a if a
is a scalar. A matrix is positive definite if xT'f;x > 0 for all nonzero vectors
x. If a matrix A is symmetric and positive definite, its square root A 1/2 exists
and has the following properties: (1) Al/2 is symmetric; (2) A = Al/2 Al/2; (3) A 1/ 2A- 1/ 2 = A- 1/ 2 A 1/ 2 = I where A- 1/ 2 = (Al/2)-I.

232

14. Multivariate Models

14.1 Randorn Vectors

Multivariate models involve a random vector X of the form

The mean of a random vector X is defined by

(14.1 )

The covariance matrix ~, also written V(X), is defined to be

V(XI )

Cov(XI , X 2 )

Cov(X2 , Xl) V(X2 )
~=

Cov(XI , X k ) CoV(X2 ,Xk )

(14.2)

This is also called the variance matrix or the variance-covariance matrix. The inverse ~-l is called the precision matrix.
14.1 Theorem. Let a be a vector of length k and let X be a random vector of the same length with mean JL and variance ~. Then IE(aT X) = aTJL and V(aT X) = aT~a. If A is a matrix with k columns, then IE(AX) = AIL and V(AX) = A~AT.
Now suppose we have a random sample of n vectors:

(14.3)

The sample mean X is a vector defined by

14.2 Estimating the Correlation 233
where Xi = n -1 L'.7=1 X ij . The sample variance matrix, also called the co-
variance matrix or the variance-covariance matrix, is

811 812

81k

812 822

82k

5=

(14.4)

where

8lk 82k

8kk

It follows that JE(X) = IL. and JE(5) = ~.

14.2 Estimating the Correlation

Consider n data points from a bivariate distribution:

(

Xu ) , ( X 21

X 12 ) X 22

, ... , (

X 1n ) X 2n

.

Recall that the correlation between Xl and X 2 is

(14.5)

where a} = V(Xjd, j = 1,2. The nonparametric plug-in estimator is the
sample correlation 1

where

(14.6)

We can construct a confidence interval for p by applying the delta method. However, it turns out that we get a more accurate confidence interval by first
e constructing a confidence interval for a function = f(p) and then applying
1 More precisely, the plug-in estimator has n rather than n - 1 in the formula for Sj but this difference is small.

234

14. Multivariate Models

the inverse function J- 1 . The method, due to Fisher, is as follows: Define J
and its inverse by

J(r)

~ (lOg(l + r) -log(l - r))

e2z - 1
e2z + 1·

Approximate Confidence Interval for The Correlation

1. Compute

(j = J(p) = ~ (log(l + p) - log(l - p)).

2. Compute the approximate standard error of 8 which can be shown to

be

~

1

se(8) = ~.

n-3

3. An approximate 1 - a confidence interval for 8 = J(p) is

(a,b)=_

(~ 8-

~Za, /2 8~+ n-3

~ Za/2) n-3

.

4. Apply the inverse transformation J-l(Z) to get a confidence interval

for p:

1 1) e2a -

e 2b -

+ + (
e 2a l' e 2b 1 .

Yet another method for getting a confidence interval for p is to use the bootstrap.

14.3 Multivariate Nonnal
Recall that a vector X has a multivariate Normal distribution, denoted by X rv N(/L, ~), if its density is
(14.7)
where fL is a vector of length k and ~ is a k x k symmetric, positive definite matrix. Then JE(X) = fL and V(X) = ~.

14.4 Multinomial 235 14.2 Theorem. The following properties hold:
1. IfZrvN(O,l) andX=p,+2:,1/2Z, thenXrvN(p,,2:,). 2. If X rv N(p" 2:,), then 2:,-1/2(X -It) rv N(O, 1). 3. If X rv N(/t, 2:,) a is a vector of the same length as X, then aT X rv
N(aT p" aT 2:,a).
4. Let

Then V rv X~.
14.3 Theorem. Given a random sample of size n from a N(p" 2:,), the loglikelihood is (up to a constant not depending on It or 2:,) given by
£(p" 2:,) = -"n2(-X - p,) T 2:, -1 (-X - p,) - "n2tr(2:, -1 S) - "n2 log 12:,1·

The MLE is

(n Ii = X and f; =

~ 1 ) S.

(14.8)

14.4 Multinornial

Let us now review the Multinomial distribution. The data take the form X = (Xl, ... , Xd where each Xj is a count. Think of drawing n balls (with
° replacement) from an urn which has balls with k different colors. In this case,
Xj is the number of balls of the kth color. Let p = (PI, ... ,pd where Pj ~ and L~=l Pj = 1 and suppose that Pj is the probability of drawing a ball of color j.
14.4 Theorem. Let X rv Multinomial(n,p). Then the marginal distribution of Xj is Xj rv Binomial(n,pj). The mean and variance of X are

npl )
JE(X) = (
npk

and

~ V(X)

npl(l - pI)
-nplP2
(

-nplP2 np2(1 - P2)

-nplPk

-np2Pk

-nplPk -np2Pk

)

npk(l - Pk)

236 14. Multivariate Models
PROOF. That Xj rv Binomial(n,pj) follows easily. Hence, JE(Xj) = npj and
V(Xj) = npj(l - Pj). To compute COV(Xi' Xj) we proceed as follows: Notice that Xi+Xj rv Binomial(n,Pi+pj) and so V(Xi+Xj) = n(Pi+pj)(l-Pi-pj). On the other hand,
V(Xi ) + V(Xj) + 2COV(Xi' Xj) npi(l - Pi) + npj(l - Pj) + 2COV(Xi' Xj).
Equating this last expression with n(Pi+pj)(l-Pi-pj) implies that COV(Xi' Xj) = -npiPj· 14.5 Theorem. The maximum likelihood estimator of P is

PROOF. The log-likelihood (ignoring a constant) is

k
R(p) = LXjlogpj.
j=1

When we maximize R we have to be careful since we must enforce the con-

straint that Lj Pj = 1. We use the method of Lagrange multipliers and instead

maximize

1). k
A(p) = L Xj logpj + A(LPj -

)=1

)

Now
8A(p) = Xj + A.
8pj Pj

Setting aaA(p) = 0 yields Pl· = - X)I A. Since L Pl· = 1 we see that A = -n

~

)

and hence Pj = Xj/n as claimed. _

Next we would like to know the variability of the MLE. We can either
compute the variance matrix of p directly or we can approximate the vari-

ability of the MLE by computing the Fisher information matrix. These two

approaches give the same answer in this case. The direct approach is easy:

V(p) = V(X/n) = n- 2V(X), and so

V(p) = .!.~
n

14.5 Bibliographic Remarks 237

where

P1(1_ PI)

~= (

-P1P2
.

-P1Pk

-P1Pk ) -P2Pk
~ Pk(l Pk) .

For large n, p has approximately a multivariate Normal distribution.

14.6 Theorem. As n --+ 00,
Fn(p - p) ~ N(O, ~).

14.5 Bibliographic Remarks
Some references on multivariate analysis are Johnson and Wichern (1982) and Anderson (1984). The method for constructing the confidence interval for the correlation described in this chapter is due to Fisher (1921).

14.6 Appendix

PROOF of Theorem 14.3. Denote the ith random vector by Xi. The loglikelihood is
n

i=l
- k2n 10g(21T) - ~ log I~I - ~ i)xi - 11y~-1(Xi - J.1).
i=l
Now,
n
2)Xi - IL?~-l(Xi - J.1)
i=l n

i=l
n
L [(Xi - X?~-l(Xi - X)] + n(X - J.1?~-l(X - J.1)

i=l

since L~=l (Xi - X)~-l(X - J.1) = O. Also, notice that (Xi - IL)T~-l(Xi - IL)

is a scalar, so

n
L(Xi - J.1?~-l(Xi - J.1)

n
Ltr [(Xi - IL?~-l(Xi - J.1)]

i=l

i=l

238 14. Multivariate Models and the conclusion follows.·

n
i=l
tr [~-l ~(Xi - fL)(Xi - fLf1
n tr [~-lSl

14.7 Exercises
1. Prove Theorem 14.1.
2. Find the Fisher information matrix for the MLE of a Multinomial.
3. (Computer Experiment.) Write a function to generate nsim observations from a Multinomial(n,p) distribution.
4. (Computer Experiment.) Write a function to generate nsim observations from a Multivariate normal with given mean fL and covariance matrix
~.
5. (Computer Experiment.) Generate 100 random vectors from a N(fL,~) distribution where

Plot the simulation as a scatterplot. Estimate the mean and covariance matrix ~. Find the correlation p between Xl and X 2 . Compare this with the sample correlations from your simulation. Find a 95 percent confidence interval for p. Use two methods: the bootstrap and Fisher's method. Compare.
6. (Com puter Experi ment.) Repeat the previous exercise 1000 times. Compare the coverage of the two confidence intervals for p.

15
Inference About Independence

In this chapter we address the following questions:
(1) How do we test if two random variables are independent?
(2) How do we estimate the strength of dependence between two random variables?
When Y and Z are not independent, we say that they are dependent or associated or related. If Y and Z are associated, it does not imply that Y causes Z or that Z causes Y. Causation is discussed in Chapter 16.
Recall that we write Y IT Z to mean that Y and Z are independent and we write Y ro606' Z to mean that Y and Z are dependent.

15.1 Two Binary Variables

Suppose that Y and Z are both binary and consider data (YI , Zl), ... , (Yn , Zn). We can represent the data as a two-by-two table:

Z=Q
Z=l

Y=Q
Xoo XlO Xo

Y=1 X OI X 11 Xl

Xo. Xl. n = X..

240

15. Inference About Independence

where

X ij = number of observations for which Y = i and Z = j.

The dotted subscripts denote sums. Thus,

j

i,j

This is a convention we use throughout the remainder of the book. Denote the corresponding probabilities by:

Y=o Y=1

Z=O POO

POl po·

Z=1 PIO

Pu Pl·

p·O

P·l

1

where Pij = W(Z = i, Y = j). Let X = (Xoo, X Ol , X IO , Xu) denote the vector
of counts. Then X rv Multinomial(n,p) where P = (pOO,POl,PlO,PU). It is now convenient to introduce two new parameters.

15.1 Definition. The odds ratio is defined to be
1jJ = POOPll . POlPlO
The log odds ratio is defined to be

(15.1)

'I = log(IjJ).

(15.2)

15.2 Theorem. The following statements are equivalent:

1. YIIZ. 2. 1jJ = 1.
3. 'I = o.
4. For i, j E {O, I}, Pij = Pi·P-j.
Now consider testing

Ho: Y II Z versus HI: Y IQOOO' Z.

(15.3)

First we consider the likelihood ratio test. Under HI, X rv Multinomial(n,p)
and the MLE is the vector if = X/no Under Ho, we again have that X rv
Multinomial(n, p) but the restricted MLE is computed under the constraint
Pij = Pi·P·j This leads to the following test:

15.1 Two Binary Variables 241 15.3 Theorem. The likelihood ratio test statistic for (15.3) is

(15.4)

xi. Under H o, T ~ Thus, an approximate level ex test is obtained by
xL.. rejecting Ho when T >

Another popular test for independence is Pearson's X2 test.

15.4 Theorem. Pearson's X2 test statistic for independence is

U

=

11 "'""'"'""' ~~

(
X

ij -
E

)2
Eij

i=O j=o

'J

(15.5)

where

E .. _ Xi.X j

'J -

n

xi. Under H o, U ~ Thus, an approximate level ex test is obtained by rejecting Ho when U > xL·.

Here is the intuition for the Pearson test. Under H o, Pij = Pi.P.j, so the maximum likelihood estimator of Pij under Ho is
~ ~ ~ Xi. Xj
Pij = Pi· p. j = ----;;: ----;;:.
Thus, the expected number of observations in the (i,j) cell is ~ Xi.Xj
Eij = npij = ---. n
The statistic U compares the observed and expected counts.
15.5 Example. The following data from Johnson and Johnson (1972) relate tonsillectomy and Hodgkins disease. 1

Hodgkins Disease No Disease

Tonsillectomy

90

165

255

No Tonsillectomy 84

307

391

Total

174

472

646

1 The data are actually from a case-control study; see the appendix for an explanation of case-control studies.

242

15. Inference About Independence

We would like to know if tonsillectomy is related to Hodgkins disease. The
likelihood ratio statistic is T = 14.75 and the p-value is J1D(xi > 14.75) = .0001. The X2 statistic is U = 14.96 and the p-value is J1D(xi > 14.96) = .0001. We re-
ject the null hypothesis of independence and conclude that tonsillectomy is associated with Hodgkins disease. This does not mean that tonsillectomies cause Hodgkins disease. Suppose, for example, that doctors gave tonsillectomies to the most seriously ill patients. Then the association between tonsillectomies and Hodgkins disease may be due to the fact that those with tonsillectomies were the most ill patients and hence more likely to have a serious disease. _

We can also estimate the strength of dependence by estimating the odds ratio ?jJ and the log-odds ratio f.

15.6 Theorem. The MLE's of?jJ and I are

.J; = XOOX11 9 = log~.
X01XlO '

(15.6)

The asymptotic standard errors (computed using the delta method) are

se(9) V - +I - + l-l+I-
Xoo X01 XlO X 11
se(J;) J; se(9)·

(15.7) (15.8)

15.7 Remark. For small sample sizes, .J; and 9 can have a very large variance.
In this case, we often use the modified estimator

~ = (X00 + ~) (X11 + ~) (XOl + ~) (XlO + ~).

(15.9)

Another test for independence is the Wald test for I = 0 given by W =
(9 - 0) / se(9)· A 1 - Q confidence interval for I is 9 ± za/2se(9)·
A 1 - Q confidence interval for¢ can be obtained in two ways. First, we
could use ~ ± Za/2se(~). Second, since ?jJ = e' we could use

(15.10)

This second method is usually more accurate.
15.8 Example. In the previous example,
J; = 90 x 307 = 1.99
165 x 84 and
9 = log(1.99) = .69.

15.2 Two Discrete Variables 243
So tonsillectomy patients were twice as likely to have Hodgkins disease. The standard error of '1 is
11 1 1
90 + 84 + 165 + 307 = .18.
The Wald statistic is W = .69;'18 = 3.84 whose p-value is IP'(IZI > 3.84) = .0001, the same as the other tests. A 95 per cent confidence interval for r is
'1±2(.18) = (.33,1.05). A 95 per cent confidence interval for .1jJ is (e· 33 , e1.05) = (1.39,2.86) . ·

15.2 Two Discrete Variables

Now suppose that Y E {I, ... , I} and Z E {I, ... , J} are two discrete variables. The data can be represented as an J x J table of counts:

Y= 1 Y=2 Z = 1 Xu X 12

Y=j X lj

Y=J Xu Xl.

Z =i XiI X i2

X ij

XiJ Xi.

Z=J X Il

X I2

X lj

XIJ XI.

Xl X 2

Xj

XJ n

where

X ij = number of observations for which Z = i and Y = j.

Consider testing

Ho : Y II Z versus HI: Y '15000' Z.

(15.11)

15.9 Theorem. The likelihood ratio test statistic for (15.11) is

L L I J

T

=

2
i=l

X ij log
j=l

(X,j X.) X,. X J

.

(15.12)

The limiting distribution of T under the null hypothesis of independence is X~ where v = (J - I)(J - 1). Pearson's X2 test statistic is

U=

IJ ""

( X ij

-

)2 Eij

~~

E

i=l j=l

'J

(15.13)

244

15. Inference About Independence

Asymptotically, under H a, U has a X~ distribution where v = (I - 1)(J - 1).

15.10 Example. These data are from Dunsmore et al. (1987). Patients with Hodgkins disease are classified by their response to treatment and by histological type.

Type Positive Response Partial Response No Response

LP 74

18

12

104

NS 68

16

12

96

Me 154

54

58

266

LD 18

10

44

72

The X2 test statistic is 75.89 with 2 x 3 = 6 degrees of freedom. The p-value
is IP'(X~ > 75.89) :::::; o. The likelihood ratio test statistic is 68.30 with 2 x 3 = 6 degrees of freedom. The p-value is IP'(X~ > 68.30) :::::; o. Thus there is strong
evidence that response to treatment and histological type are associated. _

15.3 Two Continuous Variables
Now suppose that Y and Z are both continuous. If we assume that the joint distribution of Y and Z is bivariate Normal, then we measure the dependence between Y and Z by means of the correlation coefficient p. Tests, estimates, and confidence intervals for p in the Normal case are given in the previous chapter in Section 14.2. If we do not assume Normality then we can still use the methods in Section 14.2 to draw inferences about the correlation p. However, if we conclude that p is 0, we cannot conclude that Y and Z are independent, only that they are uncorrelated. Fortunately, the reverse direction is valid: if we conclude that Y and Z are correlated than we can conclude they are dependent.

15.4 One Continuous Variable and One Discrete
Suppose that Y E {I, ... , I} is discrete and Z is continuous. Let Fi(Z)
IP'(Z <::: zlY =i) denote the CDF of Z conditional on Y =i.

15.5 Appendix 245
15.11 Theorem. When Y E {I, ... , I} is discrete and Z is continuous, then Y II Z if and only if FI = ... = F J .
It follows from the previous theorem that to test for independence, we need to test
Ho : FI = ... = F J versus HI: not Ho·
For simplicity, we consider the case where I = 2. To test the null hypothesis that FI = F2 we will use the two sample Kolmogorov-Smirnov test. Let
nl denote the number of observations for which Yi = 1 and let n2 denote the number of observations for which Y; = 2. Let

and

denote the empirical distribution function of Z given Y respectively. Define the test statistic

D = sup IFI(X) - F2 (x)l.
x

15.12 Theorem. Let

00

22) H(t) = 1 -

_IF-Ie-2j2t2.

j=l

Under the null hypothesis that FI = F2 ,

1 and Y 2 (15.14)

lim JID (
n--+oo
It follows from the theorem that an approximate level a test is obtained by rejecting Ho when

15.5 Appendix
INTERPRETING THE ODDS RATIOS. Suppose event A as probability J1D(A). The odds of A are defined as odds(A) = J1D(A)j(l - J1D(A)). It follows that

246

15. Inference About Independence

f'(A) = odds(A)/(l + odds(A)). Let E be the event that someone is exposed
to something (smoking, radiation, etc) and let D be the event that they get a disease. The odds of getting the disease given that you are exposed are:

f'(DIE)
odds(DIE) = 1 _ f'(DIE)

and the odds of getting the disease given that you are not exposed are:

The odds ratio is defined to be

.1jJ = odds(DIE) odds(DIEc) .

If 1jJ = 1 then disease probability is the same for exposed and unexposed. This

implies that these events are independent. Recall that the log-odds ratio is
defined as I = log(1jJ). Independence corresponds to I = o.

Consider this table of probabilities and corresponding table of data:

DC D

DC D

E C POO POI Po·

E C Xoo XOl Xo.

E PlO Pu Pl·

E XlO Xu Xl.

p·O P·l 1

Xo Xl X.

Now

f'(DIE) = Pl1

and f'(DIEC) = POl ,

PlO + Pl1

POO + POI

and so

odds(DIE) = Pl1 and odds(DIEC) = - PO,I

PIO

POO

and therefore,

IjJ = Pl1POO. POlPIO

To estimate the parameters, we have to first consider how the data were collected. There are three methods.
MULTINOMIAL SAMPLING. We draw a sample from the population and, for each person, record their exposure and disease status. In this case, X = (XOO,XOl,XlO,Xl1) rv Multinomial(n,p). We then estimate the probabilities in the table by Pij = X ij / nand

.J; = ~l1~OO = Xl1 X OO.
POIPIO XOIXlO

15.5 Appendix 247

PROSPECTIVE SAMPLING. (COHORT SAMPLING). We get some exposed and unexposed people and count the number with disease in each group. Thus,

X OI

Binomial(Xo., IP'(DIEC))

XU

Binomial(Xl ., IP'(DIE)).

We should really write Xo. and Xl. instead of Xo. and Xl. since in this case, these are fixed not random, but for notational simplicity I'll keep using capital letters. We can estimate IP'(DIE) and IP'(DIEC) but we cannot estimate all the probabilities in the table. Still, we can estimate 1/J since 1/J is a function of IP'(DIE) and IP'(DIEC). Now

and

Thus,

just as before. CASE-CONTROL (RETROSPECTIVE) SAMPLING. Here we get some diseased
and non-diseased people and we observe how many are exposed. This is much more efficient if the disease is rare. Hence,

XlO

Binomial(Xo, IP'(EIDC))

XU

Binomial(Xl,IP'(EID)).

From these data we can estimate IP'(EID) and IP'(EIDC). Surprisingly, we can also still estimate 1/J. To understand why, note that

IP'(EID) = Pu , 1 - IP'(EID) = POI ,odds(EID) = Pl1 .

POI + Pu

+ POI Pl1

POI

By a similar argument, Hence,

odds(EIDC) = PlO .
POO
odds(EID) = PuPOO = 1/J odds(EIDc) POIPIO .

From the data, we form the following estimates:

Therefore,

.j; = XOOXl1 .
XOIXlO

248

15. Inference About Independence

So in all three data collection methods, the estimate of 4) turns out to be the
same. It is tempting to try to estimate IP'(DIE) -IP'(DIEC). In a case-control design,
this quantity is not estimable. To see this, we apply Bayes' theorem to get

Because of the way we obtained the data, IP'( D) is not estimable from the data.
However, we can estimate ~ = IP'(DIE)/IP'(DIEC), which is called the relative risk, under the rare disease assumption.

15.13 Theorem. Let ~ = IP'(DIE)/IP'(DIEC). Then

as IP'(D) --+ O.

! --+ 1
~

Thus, under the rare disease assumption, the relative risk is approximately the same as the odds ratio and, as we have seen, we can estimate the odds ratio.

15.6 Exercises

1. Prove Theorem 15.2. 2. Prove Theorem 15.3. 3. Prove Theorem 15.6. 4. The New York Times (January 8,2003, page A12) reported the following
data on death sentencing and race, from a study in Maryland: 2

Black Victim White Victim

Death Sentence 14 62

No Death Sentence 641 594

Analyze the data using the tools from this chapter. Interpret the results. Explain why, based only on this information, you can't make causal conclusions. (The authors of the study did use much more information in their full report.)

2The data here are an approximate re-creation using the information in the article.

15.6 Exercises 249
5. Analyze the data on the variables Age and Financial Status from: http://lib.stat.cmu.edu/DASL/Datafiles/montanadat.html
6. Estimate the correlation between temperature and latitude using the data from http://lib.stat.cmu.edu/DASL/Datafiles/USTemperatures.html Use the correlation coefficient. Provide estimates, tests, and confidence intervals.
7. Test whether calcium intake and drop in blood pressure are associated. Use the data in http://lib.stat.cmu.edu/DASL/Datafiles/Calcium.html

16
Causal Inference
Roughly speaking, the statement "X causes Y" means that changing the value of X will change the distribution of Y. When X causes Y, X and Y will be associated but the reverse is not, in general, true. Association does not necessarily imply causation. We will consider two frameworks for discussing causation. The first uses counterfactual random variables. The second, presented in the next chapter, uses directed acyclic graphs.
16.1 The Counterfactual Model
Suppose that X is a binary treatment variable where X = 1 means "treated" and X = 0 means "not treated." We are using the word "treatment" in a very broad sense. Treatment might refer to a medication or something like smoking. An alternative to "treated/not treated" is "exposed/not exposed" but we shall use the former.
Let Y be some outcome variable such as presence or absence of disease. To distinguish the statement "X is associated Y" from the statement "X causes Y" we need to enrich our probabilistic vocabulary. Specifically, we will decompose the response Y into a more fine-grained object.
We introduce two new random variables (Co, Cd, called potential out-
comes with the following interpretation: Co is the outcome if the subject is

252 16. Causal Inference

not treated (X = 0) and CI is the outcome if the subject is treated (X = 1).
Hence, if X = 0 if X = 1.
We can express the relationship between Y and (Co, Cd more succinctly by

Y=Cx .

(16.1)

Equation (16.1) is called the consistency relationship. Here is a toy dataset to make the idea clear:

X Y Co CI
044 * 0 77 * 0 22 * 0 88 * 13* 3 1 5* 5 18* 8 19* 9
The asterisks denote unobserved values. When X = 0 we don't observe CI , in which case we say that CI is a counterfactual since it is the outcome you would have had if, counter to the fact, you had been treated (X = 1). Similarly, when X = 1 we don't observe Co, and we say that Co is counterfactual. There are four types of subjects:

Type

Co CI

Survivors

11

Responders

01

Anti-responders 1 0

Doomed

00

Think of the potential outcomes (Co, Cd as hidden variables that contain all the relevant information about the subject.
Define the average causal effect or average treatment effect to be

e = JE(Cd - JE(Co).

(16.2)

e e The parameter has the following interpretation: is the mean if everyone
were treated (X = 1) minus the mean if everyone were not treated (X = 0). There are other ways of measuring the causal effect. For example, if Co and CI are binary, we define the causal odds ratio

W(CI = 1) . W(Co = 1) W( CI = 0) -;- W(Co = 0)

16.1 The Counterfactual Model 253
and the causal relative risk
JP'(C1 = 1) JP'(Co = 1)'
The main ideas will be the same whatever causal effect we use. For simplicity,
e. we shall work with the average causal effect
Define the association to be

00 = lE(YIX = 1) -lE(YIX = 0).

(16.3)

Again, we could use odds ratios or other summaries if we wish.
e 16.1 Theorem (Association Is Not Causation). In general, # 00.

16.2 Example. Suppose the whole population is as follows:
X Y Co C1 0 0 0 0* 0 0 0 0* 0 0 0 0* 0 0 0 0* 1 1 1* 1 1 1 1* 1 1 1 1* 1 1 1 1* 1
Again, the asterisks denote unobserved values. Notice that Co = C 1 for every
subject, thus, this treatment has no effect. Indeed,

e

L L 1 8

18

lE(CI) -lE(Co) = "8 C1i - "8 COi

i=l

i=l

0+0+0+0+1+1+1+1 0+0+0+0+1+1+1+1

8

8

o.

Thus, the average causal effect is O. The observed data are only the X's and Y's, from which we can estimate the association:

00

lE(YIX = 1) -lE(YIX = 0)

1+1+1+1 0+0+0+0

4

--4--=1.

e Hence, # 00.
To add some intuition to this example, imagine that the outcome variable is 1 if "healthy" and 0 if "sick". Suppose that X = 0 means that the subject

254 16. Causal Inference
does not take vitamin C and that X = 1 means that the subject does take
vitamin C. Vitamin C has no causal effect since Co = C 1 for each subject. In
this example there are two types of people: healthy people (Co, Cd = (1,1)
and unhealthy people (Co, C1 ) = (0,0). Healthy people tend to take vitamin C while unhealthy people don't. It is this association between (Co, C1 ) and X that creates an association between X and Y. If we only had data on X and Y we would conclude that X and Yare associated. Suppose we wrongly interpret this causally and conclude that vitamin C prevents illness. Next we might encourage everyone to take vitamin C. If most people comply with our advice, the population will look something like this:
X Y Co C 1 0 0 0 0* 1 0 0 0* 1 0 0 0* 1 0 0 0* 1 1 1* 1 1 1 1* 1 1 1 1* 1 1 1 1* 1
Now a = (4/7) - (0/1) = 4/7. We see that a went down from 1 to 4/7. Of course, the causal effect never changed but the naive observer who does not distinguish association and causation will be confused because his advice seems to have made things worse instead of better.·

In the last example, 8 = 0 and a = 1. It is not hard to create examples in
which a > 0 and yet 8 < o. The fact that the association and causal effects
can have different signs is very confusing to many people. The example makes it clear that, in general, we cannot use the association
to estimate the causal effect 8. The reason that 8 -I- a is that (Co, C1 ) was
not independent of X. That is, treatment assignment was not independent of person type.
Can we ever estimate the causal effect? The answer is: sometimes. In particular, random assignment to treatment makes it possible to estimate 8.

16.3 Theorem. Suppose we randomly assign subjects to treatment and that
JP'(X = 0) > 0 and JP'(X = 1) > o. Then a = 8. Hence, any consistent estima-
tor of a is a consistent estimator of 8. In particular, a consistent estimator
zs

8

E(YIX = 1) - E(YIX = 0)

16.2 Beyond Binary Treatments 255

e, is a consistent estimator of where

_

1n

Yo = - LY'i(I- Xi),
no i=l

PROOF. Since X is randomly assigned, X is independent of (Co, C 1 ). Hence,

e

IE(Cd - IE(Co)

IE(C1 IX = 1) - IE(CoIX = 0) since X II (Co, Cd

IE(YIX = 1) - IE(YIX = 0)

since Y = Cx

ex.

The consistency follows from the law of large numbers. _ If Z is a covariate, we define the conditional causal effect by

For example, if Z denotes gender with values Z = 0 (women) and Z = 1
eo e (men), then is the causal effect among women and 1 is the causal effect e among men. In a randomized experiment, z = IE(YIX = I, Z = z)-IE(YIX =
0, Z = z) and we can estimate the conditional causal effect using appropriate
sample averages.
Summary of the Counterfactual Model Random variables: (Co, C1 , X, Y). Consistency relationship: Y = Cx.
e Causal Effect: = IE(Cd - IE(Co).
Association: ex = IE(YIX = 1) - IE(YIX = 0).
e Random assignment ===} ( Co, C1) II X ===} = ex.

16.2 Beyond Binary Treatrnents
Let us now generalize beyond the binary case. Suppose that X E X. For example, X could be the dose of a drug in which case X E Ji{. The counterfactual vector (Co, Cd now becomes the counterfactual function C(x) where

256

16. Causal Inference

7 6 5 Y = C(X)4

3

2

1

0

x

0 1 2 3 4 5 6 7 8 9 10 11

X

FIGURE 16.1. A counterfactual function C(x). The outcome Y is the value of the curve C(x) evaluated at the observed dose X.

C(x) is the outcome a subject would have if he received dose x. The observed response is given by the consistency relation

Y == C(X).

(16.4)

See Figure 16.1. The causal regression function is

8(x) = lE(C(x)).

(16.5)

The regression function, which measures association, is r(x) = lE(YIX = x).
16.4 Theorem. In general, 8(x) # r(x). However, when X is randomly as-
signed, 8(x) = r(x).

16.5 Example. An example in which 8(x) is constant but r(x) is not constant is shown in Figure 16.2. The figure shows the counterfactual functions for four subjects. The dots represent their X values Xl, X 2 , X 3 , X4. Since Ci(x) is constant over x for all i, there is no causal effect and hence
8(x) = Cl(x) + C2 (x) + C3 (x) + C4 (x)
4

16.3 Observational Studies and Confounding 257
is constant. Changing the dose x will not change anyone's outcome. The four dots in the lower plot represent the observed data points Y1 = C1(Xd, Y2 = C2 (X2 ), Y3 = C3 (X3 ), Y4 = C4 (X4 ). The dotted line represents the regression r(x) = IE(YIX = x). Although there is no causal effect, there is an association since the regression curve r(x) is not constant. _

16.3 Observational Studies and Confounding

A study in which treatment (or exposure) is not randomly assigned is called an

observational study. In these studies, subjects select their own value of the

exposure X. Many of the health studies you read about in the newspaper are

like this. As we saw, association and causation could in general be quite differ-

ent. This discrepancy occurs in non-randomized studies because the potential

outcome C is not independent of treatment X. However, suppose we could

find groupings of subjects such that, within groups, X and {C(x): x E X}

are independent. This would happen if the subjects are very similar within

groups. For example, suppose we find people who are very similar in age, gen-

der, educational background, and ethnic background. Among these people we

might feel it is reasonable to assume that the choice of X is essentially ran-

dom. These other variables are called confounding variables. 1 If we denote

these other variables collectively as Z, then we can express this idea by saying

that

{C(x) : x E X} II XIZ.

(16.6)

Equation (16.6) means that, within groups of Z, the choice of treatment X does not depend on type, as represented by {C(x): x E X}. If (16.6) holds and we observe Z then we say that there is no unmeasured confounding.

16.6 Theorem. Suppose that (16.6) holds. Then,
J 8(x) = IE(YIX = x, Z = z)dFz(z)dz.

(16.7)

If i(x, z) is a consistent estimate of the regression function IE(YIX = x, Z = z), then a consistent estimate of 8(x) is

1 A more precise definition of confounding is given in the next chapter.

258

16. Causal Inference

· C1(x)

3

· C2 (x)

2

·

C3 (x)

1

·

C4 (x)

0

x

0

1

2

3

4

5

3

2

Y3 ·

· Y1
· Y2 e(x)

1

Y4 ·

0

X

0

1

2

3

4

5

FIGURE 16.2. The top plot shows the counterfactual function C(x) for four sub-

jects. The dots represent their X values. Since Ci (x) is constant over x for all i, there

is no causal effect. Changing the dose will not change anyone's outcome. The lower
plot shows the causal regression function e( x) = (C1 (x) + C2 (x) + C 3 (x) + C4 (x)) / 4.

The four dots represent the observed data points Y1 = C 1 (X 1 ), Y2 = C2 (X2 ),

Y3

C3 (X3 ), Y4

C4(X4). The dotted line represents the regression

r(x) = lE(YIX = x). There is no causal effect since Ci(x) is constant for all i.

But there is an association since the regression curve r(x) is not constant.

16.4 Simpson's Paradox 259
In particular, if r(x, z) = Po + PIX + P2Z is linear, then a consistent estimate
ofB(x) is (16.8)
where (/30, /31, /32) are the least squares estimators.
16.7 Remark. It is useful to compare equation (16.7) to IE(YIX = x) which can be written as IE(YIX = x) = JIE(YIX = x, Z = z)dFz1x(zlx).
Epidemiologists call (16.7) the adjusted treatment effect. The process of computing adjusted treatment effects is called adjusting (or controlling) for confounding. The selection of what confounders Z to measure and control for requires scientific insight. Even after adjusting for confounders, we cannot be sure that there are not other confounding variables that we missed. This is why observational studies must be treated with healthy skepticism. Results from observational studies start to become believable when: (i) the results are replicated in many studies, (ii) each of the studies controlled for plausible confounding variables, (iii) there is a plausible scientific explanation for the existence of a causal relationship.
A good example is smoking and cancer. Numerous studies have shown a relationship between smoking and cancer even after adjusting for many confounding variables. Moreover, in laboratory studies, smoking has been shown to damage lung cells. Finally, a causal link between smoking and cancer has been found in randomized animal studies. It is this collection of evidence over many years that makes this a convincing case. One single observational study is not, by itself, strong evidence. Remember that when you read the newspaper.
16.4 Sirnpson's Paradox
Simpson's paradox is a puzzling phenomenon that is discussed in most statistics texts. Unfortunately, most explanations are confusing (and in some cases incorrect). The reason is that it is nearly impossible to explain the paradox without using counterfactuals (or directed acyclic graphs).
Let X be a binary treatment variable, Y a binary outcome, and Z a third binary variable such as gender. Suppose the joint distribution of X, Y, Z is

260 16. Causal Inference

X= 1

Y=l Y=O
.1500 .0375 Z = 1 (men)

Y=l

Y=O

The marginal distribution for (X, Y) is

Y = 1 Y =0

X =1

.25

.25 .50

X=O

.30

.20 .50

.55

.45 1

From these tables we find that,

IP'(Y = 11X = 1) -IP'(Y = 11X = 0) IP'(Y = 11X = 1, Z = 1) -IP'(Y = 11X = 0, Z = 1) IP'(Y = 11X = 1,Z = 0) -IP'(Y = 11X = O,Z = 0)

To summarize, we seem to have the following information:

-0.1 0.1 0.1.

Mathematical Statement
lP'(Y = 11X = 1) < lP'(Y = 11X = 0) lP'(Y = 11X = 1, Z = 1) > lP'(Y = 11X = 0, Z = 1) lP'(Y = 11X = 1, Z = 0) > lP'(Y = 11X = 0, Z = 0)

English Statement? treatment is harmful treatment is beneficial to men treatment is beneficial to women

Clearly, something is amiss. There can't be a treatment which is good for men, good for women, but bad overall. This is nonsense. The problem is with the set of English statements in the table. Our translation from math into English is specious.

The inequality IP'(Y = 11X = 1) < IP'(Y = 11X = 0) does not
mean that treatment is harmful.

The phrase "treatment is harmful" should be written mathematically as
IP'(C1 = 1) < IP'(Co = 1). The phrase "treatment is harmful for men" should be written IP'(C1 = liZ = 1) < IP'(Co = liZ = 1). The three mathematical
statements in the table are not at all contradictory. It is only the translation into English that is wrong.
Let us nOW show that a real Simpson's paradox cannot happen, that is, there cannot be a treatment that is beneficial for men and women but harmful overall. Suppose that treatment is beneficial for both sexes. Then

IP'(C1 = liZ = z) > IP'(Co = liZ = z)

16.5 Bibliographic Remarks 261
for all z. It then follows that
LIP'(C1 = liZ = z)IP'(Z = z)
z
> LIP'(Co = liZ = z)IP'(Z = z)
z
IP'(Co = 1).
Hence, IP'(C1 = 1) > IP'(Co = 1), so treatment is beneficial overall. No paradox.
16.5 Bibliographic Remarks
The use of potential outcomes to clarify causation is due mainly to Jerzy Neyman and Donald Rubin. Later developments are due to Jamie Robins, Paul Rosenbaum, and others. A parallel development took place in econometrics by various people including James Heckman and Charles Manski. Texts on causation include Pearl (2000), Rosenbaum (2002), Spirtes et al. (2000), and van der Laan and Robins (2003).
16.6 Exercises
l. Create an example like Example 16.2 in which Q > 0 and B < O.
2. Prove Theorem 16.4.
3. Suppose you are given data (Xl, Yd, ... , (Xn' Yn ) from an observational
study, where Xi E {O, 1} and Yi E {O, 1}. Although it is not possible
to estimate the causal effect B, it is possible to put bounds on B. Find
upper and lower bounds on B that can be consistently estimated from
the data. Show that the bounds have width l.
Hint: Note that JE(Cd = JE(C1 IX = l)IP'(X = 1) + JE(C1 IX = O)IP'(X =
0).
4. Suppose that X E Jl{ and that, for each subject i, Ci(x) = (31iX. Each subject has their own slope (31i. Construct a joint distribution on ((31, X)
such that 1P'((31 > 0) = 1 but JE(YIX = x) is a decreasing function of x,
where Y = C(X). Interpret.
5. Let X E {O, 1} be a binary treatment variable and let (Co, Cd denote
the corresponding potential outcomes. Let Y = Cx denote the observed

262

16. Causal Inference

response. Let Fo and Fl be the cumulative distribution functions for
Co and C l . Assume that Fo and Fl are both continuous and strictly
e increasing. Let = rnl - rno where rno = FO- l (1/2) is the median of Co
and rnl = F l- l (1/2) is the median of C l . Suppose that the treatment X
e is assigned randomly. Find an expression for involving only the joint
distribution of X and Y.

17
Directed Graphs and Conditional Independence

17.1 Introduction
A directed graph consists of a set of nodes with arrows between some nodes. An example is shown in Figure 17.1.
Graphs are useful for representing independence relations between variables. They can also be used as an alternative to counterfactuals to represent causal relationships. Some people use the phrase Bayesian network to refer to a directed graph endowed with a probability distribution. This is a poor choice of terminology. Statistical inference for directed graphs can be performed using
y

x

z

FIGURE 17.1. A directed graph with vertices V
E = {(Y, X), (Y, Z) }.

{X, Y, Z} and edges

264

17. Directed Graphs and Conditional Independence

frequentist or Bayesian methods, so it is misleading to call them Bayesian networks.
Before getting into details about directed acyclic graphs (DAGs), we need to discuss conditional independence.

17.2 Conditional Independence

17.1 Definition. Let X, Y and Z be random variables. X and Yare conditionally independent given Z, written X II Y I Z, if

(17.1)

for all x, y and z.

Intuitively, this means that, once you know Z, Y provides no extra information about X. An equivalent definition is that

f(xly, z) = f(xlz).

(17.2)

The conditional independence relation satisfies some basic properties. 17.2 Theorem. The following implications hold: 1

XIIYIZ ===? YIIXIZ XIIYIZ and U = h(X) ===? UIIYIZ XIIYIZ and U = h(X) ===? X II Y I (Z, U) X II Y I Z and X II WI (Y, Z) ===? XII (W, Y) I Z X II Y I Z and X II Z I Y ===? X II (Y, Z).

17.3 DAGs
A directed graph 9 consists of a set of vertices V and an edge set E of
ordered pairs of vertices. For our purposes, each vertex will correspond to a random variable. If (X, Y) E E then there is an arrow pointing from X to Y. See Figure 17.1.
1 The last property requires the assumption that all events have positive probability; the first four do not.

17.3 DAGs 265

overweight

smoking

~/~

heart disease

cough

FIGURE 17.2. DAG for Example 17.4.
If an arrow connects two variables X and Y (in either direction) we say that X and Yare adjacent. If there is an arrow from X to Y then X is a parent of Y and Y is a child of X. The set of all parents of X is denoted by Jrx or Jr(X). A directed path between two variables is a set of arrows all pointing in the same direction linking one variable to the other such as:

X

···

A sequence of adjacent vertices staring with X and ending with Y but ignoring the direction of the arrows is called an undirected path. The sequence {X, Y, Z} in Figure 17.1 is an undirected path. X is an ancestor of Y if there is a directed path from X to Y (or X = Y). We also say that Y is a descendant of X.
A configuration of the form:
X ----~~~ Y ~E~----- Z

is called a collider at Y. A configuration not of that form is called a noncollider, for example,
X --~~~ Y

266 17. Directed Graphs and Conditional Independence or
X ...I.I(E---- Y ...I. I(E--- Z

The collider property is path dependent. In Figure 17.7, Y is a collider on the path {X, Y, Z} but it is a non-collider on the path {X, Y, W}. When the variables pointing into the collider are not adjacent, we say that the collider is unshielded. A directed path that starts and ends at the same variable is called a cycle. A directed graph is acyclic if it has no cycles. In this case we say that the graph is a directed acyclic graph or DAG. From now on, we only deal with acyclic graphs.

17.4 Probability and DAGs

Let Q be a DAG with vertices V = (Xl' ... ' Xk).

17.3 Definition. If rl' is a distribution for V with probability function f, we say that rl' is Markov to Q, or that Q represents rl', if

I Ik
f(v) = f(Xi I 'ifi)
i=l

(17.3)

where'ifi are the parents of Xi. The set of distributions represented by Q is denoted by M (Q) .

17.4 Example. Figure 17.2 shows a DAG with four variables. The probability function for this example factors as
f (overweight , smoking, heart disease, cough) f (overweight) x f (smoking)
x f(heart disease Ioverweight, smoking) x f(cough Ismoking). -
17.5 Example. For the DAG in Figure 17.3, rl' E M(Q) if and only if its probability function f has the form
f(x, y, z, w) = f(x)f(y)f(z I x, y)f(w I z). -

17.5 More Independence Relations 267

z

~W

Y

FIGURE 17.3. Another DAG.

The following theorem says that lP' E NI(Q) if and only if the Markov Condition holds. Roughly speaking, the Markov Condition meanS that every variable W is independent of the "past" given its parents.

17.6 Theorem. A distribution lP' E M(Q) if and only if the following Markov Condition holds: for every variable W,

WII W l7rw

(17.4)

where W denotes all the other variables except the parents and descendants ofW.

17.7 Example. In Figure 17.3, the Markov Condition implies that

X II Y and W II {X, Y} I Z. ·

17.8 Example. Consider the DAG in Figure 17.4. In this case probability function must factor like
f(a, b, c, d, e) = f(a)f(bla)f(cla)f(dlb, c)f(eld). The Markov Condition implies the following independence relations:
DIIA I {B,C}, EII{A,B,C} I D and BIIC I A ·

17.5 More Independence Relations
The Markov Condition allows us to list some independence relations implied by a DAG. These relations might imply other independence relations. Con-

268 17. Directed Graphs and Conditional Independence

B
/~

A

D

~E

~/

C

FIGURE 17.4. Yet another DAG.

sider the DAG in Figure 17.5. The Markov Condition implies:

It turns out (but it is not obvious) that these conditions imply that
How do we find these extra independence relations? The answer is "dseparation" which means "directed separation." d-separation can be summarized by three rules. Consider the four DAG's in Figure 17.6 and the DAG in Figure 17.7. The first 3 DAG's in Figure 17.6 have no colliders. The DAG in the lower right of Figure 17.6 has a collider. The DAG in Figure 17.7 has a collider with a descendant.

17.5 More Independence Relations 269

x

x I(

y ...I..(E--- Z

x I(

y

FIGURE 17.6. The first three DAG's have no colliders. The fourth DAG in the lower right corner has a collider at Y.

X ---3~~ Y ...I..(E--- Z
w
FIGURE 17.7. A collider with a descendant.

270

17. Directed Graphs and Conditional Independence

X

~ U I(

V

~ W I(

Y

!!

51

52

FIGURE 17.8. d-separation explained.

The Rules of d-Separation Consider the DAGs in Figures 17.6 and 17.7.
1. When Y is not a collider, X and Z are d-connected, but they are d-separated given Y.
2. If X and Z collide at Y, then X and Z are d-separated, but they are d-connected given Y.
3. Conditioning on the descendant of a collider has the same effect as conditioning on the collider. Thus in Figure 17.7, X and Z are d-separated but they are d-connected given W.

Here is a more formal definition of d-separation. Let X and Y be distinct vertices and let W be a set of vertices not containing X or Y. Then X and Yare d-separated given W if there exists no undirected path U between X and Y such that (i) every collider on U has a descendant in W, and (ii) no other vertex on U is in W. If A, B, and Ware distinct sets of vertices and A and B are not empty, then A and Bare d-separated given W if for every X E A and Y E B, X and Yare d-separated given W. Sets of vertices that are not d-separated are said to be d-connected.
17.9 Example. Consider the DAG in Figure 17.8. From the d-separation rules we conclude that:
X and Yare d-separated (given the empty set); X and Yare d-connected given {51, 52}; X and Yare d-separated given {51, 52, V}.
17 .10 Theorem. 2 Let A, B! and C be disjoint sets of vertices. Then AilB I C if and only if A and Bare d-separated by C.
2We implicitly assume that lP' is faithful to Q which means that lP' has no extra independence relations other than those logically implied by the Markov Condition.

aliens

17.5 More Independence Relations 271
watch

late
FIGURE 17.9. Jordan's alien example (Example 17.11). Was your friend kidnapped by aliens or did you forget to set your watch?
17.11 Example. The fact that conditioning on a collider creates dependence might not seem intuitive. Here is a whimsical example from Jordan (2004) that makes this idea more palatable. Your friend appears to be late for a meeting with you. There are two explanations: she was abducted by aliens or you forgot to set your watch ahead one hour for daylight savings time. (See Figure 17.9.) Aliens and Watch are blocked by a collider which implies they are marginally independent. This seems reasonable since - before we know anything about your friend being late - we would expect these variables to be independent.
We would also expect that IP'(Aliens = yeslLate = yes) > IP'(Aliens = yes);
learning that your friend is late certainly increases the probability that she was abducted. But when we learn that you forgot to set your watch properly,
we would lower the chance that your friend was ahducted. Hence, IP'(Aliens =
yeslLate = yes) cJ IP'(Aliens = yeslLate = yes, Watch = no). Thus, Aliens and
Watch are dependent given Late. _
17.12 Example. Consider the DAG in Figure 17.2. In this example, overweight and smoking are marginally independent but they are dependent given heart disease. _
Graphs that look different may actually imply the same independence relations. If Q is a DAG, we let I(Q) denote all the independence statements implied by Q. Two DAGs Ql and Q2 for the same variables V are Markov equivalent if I(Qd = I(Q2). Given a DAG Q, let skeleton(Q) denote the undirected graph obtained by replacing the arrows with undirected edges.
17.13 Theorem. Two DAGs Ql and Q2 are Markov equivalent if and only if (i) skeleton(Qd = skeleton(Q2) and (ii) Ql and Q2 have the same unshielded colliders.
17.14 Example. The first three DAGs in Figure 17.6 are Markov equivalent. The DAG in the lower right of the Figure is not Markov equivalent to the others. _

272

17. Directed Graphs and Conditional Independence

17.6 Estirnation for DAGs

Two estimation questions arise in the context of DAGs. First, given a DAG
Q and data VI"'" Vn from a distribution f consistent with Q, how do we
estimate f7 Second, given data VI,'" , Vn how do we estimate Q7 The first question is pure estimation while the second involves model selection. These are very involved topics and are beyond the scope of this book. We will just briefly mention the main ideas.
Typically, one uses some parametric model f(xl7Tx; ex) for each conditional density. The likelihood function is then

n

nm

i=1

i=1 j=1

e where X ij is the value of Xj for the ith data point and j are the parameters for
the jth conditional density. We can then estimate the parameters by maximum likelihood.
To estimate the structure of the DAG itself, we could fit every possible DAG using maximum likelihood and use AIC (or some other method) to choose a DAG. However, there are many possible DAGs so you would need much data for such a method to be reliable. Also, searching through all possible DAGs is a serious computational challenge. Producing a valid, accurate confidence set for the DAG structure would require astronomical sample sizes. If prior information is available about part of the DAG structure, the computational and statistical problems are at least partly ameliorated.

17.7 Bibliographic Remarks
There are a number of texts on DAGs including Edwards (1995) and Jordan (2004). The first use of DAGs for representing causal relationships was by Wright (1934). Modern treatments are contained in Spirtes et al. (2000) and Pearl (2000). Robins et al. (2003) discuss the problems with estimating causal structure from data.

17.8 Appendix
CAUSATION REVISITED. We discussed causation in Chapter 16 using the idea of counterfactual random variables. A different approach to causation uses

17.8 Appendix 273

FIGURE 17.10. Conditioning versus intervening.

DAGs. The two approaches are mathematically equivalent though they appear to be quite different. In the DAG approach, the extra element is the idea of intervention. Consider the DAG in Figure 17.10.
The probability function for a distribution consistent with this DAG has the form f(x, y, z) = f(x)f(ylx)f(zlx, y). The following is pseudocode for generating from this distribution.

For i

1, ... ,n:

Xi <- PX(Xi)

Yi <- PYIX(Yilxi) Zi <- PZIX,y(Zilxi, Yi)

Suppose we repeat this code many times, yielding data (Xl, YI, zd, ... , (xn' Yn, zn).
Among all the times that we observe Y = y, how often is Z = z? The answer
to this question is given by the conditional distribution of ZIY. Specifically,

IP'(Z = zlY = y)

IP'(Y = y,Z = z) f(y,z)

IP'(Y = y)

f(y)

~x f(x,y, z) ~x f(x) f(Ylx) f(zlx, y)

f(y)

f(y)

"~ f

(

I'
zX,y

)

f(ylx) f(x) f(y)

=

"~ f

(

I'
zX,y

)

f(x, y) f(y)

L f(zlx, y) f(xly)·
x

Now suppose we intervene by changing the computer code. Specifically, suppose we fix Y at the value y. The code now looks like this:

set Y

y

for i

1, ... ,n

Xi <- PX(Xi)

Zi <- PZIX,Y(Zilxi' y)

274

17. Directed Graphs and Conditional Independence

Having set Y = y, how often was Z = z? To answer, note that the inter-
vention has changed the joint probability to be

j*(x, z) = f(x)f(zlx, y).

The answer to our question is given by the marginal distribution

L L j*(z) = j*(x, z) = f(x)f(zlx, y).

x

x

We shall denote this as IP'(Z = zlY := y) or f(zlY := y). We call1P'(Z zlY = y) conditioning by observation or passive conditioning. We call IP'(Z = zlY := y) conditioning by intervention or active conditioning.
Passive conditioning is used to answer a predictive question like: "Given that Joe smokes, what is the probability he will get lung cancer?"
Active conditioning is used to answer a causal question like: "If Joe quits smoking, what is the probability he will get lung cancer?"
Consider a pair (Q, IP') where 9 is a DAG and IP' is a distribution for the
variables V of the DAG. Let P denote the probability function for IP'. Consider intervening and fixing a variable X to be equal to x. We represent the intervention by doing two things:
(1) Create a new DAG g* by removing all arrows pointing into X; (2) Create a new distribution j*(v) = IP'(V = vlX := x) by removing the term f(xl7TX) from f(v). The new pair (Q*, 1*) represents the intervention "set X = x."

17.15 Example. You may have noticed a correlation between rain and having a wet lawn, that is, the variable "Rain" is not independent of the variable "Wet
Lawn" and hence PR,w(r, w) -I- PR(r)pw(w) where R denotes Rain and W
denotes Wet Lawn. Consider the following two DAGs:

Rain --+ Wet Lawn

Rain +-- Wet Lawn.

The first DAG implies that f(w, r) f(r)f(wlr) while the second implies that f(w, r) = f(w)f(rlw) No matter what the joint distribution f(w, r) is, both graphs are correct. Both imply that Rand Ware not independent. But, intuitively, if we want a graph to indicate causation, the first graph is right and the second is wrong. Throwing water on your lawn doesn't cause rain. The reason we feel the first is correct while the second is wrong is because the interventions implied by the first graph are correct.
Look at the first graph and form the intervention W = 1 where 1 denotes "wet lawn." Following the rules of intervention, we break the arrows into W

to get the modified graph:

17.8 Appendix 275

Rain I set Wet Lawn =1 I
with distribution f*(r) = f(r). Thus IP'(R = r I W := w) = IP'(R = r) tells us that "wet lawn" does not cause rain.
Suppose we (wrongly) assume that the second graph is the correct causal graph and form the intervention W = 1 on the second graph. There are no arrows into W that need to be broken so the intervention graph is the same as the original graph. Thus f*(r) = f(rlw) which would imply that changing "wet" changes "rain." Clearly, this is nonsense.
Both are correct probability graphs but only the first is correct causally. We know the correct causal graph by using background knowledge.

17.16 Remark. We could try to learn the correct causal graph from data but this is dangerous. In fact it is impossible with two variables. With more than two variables there are methods that can find the causal graph under certain assumptions but they are large sample methods and, furthermore, there is no way to ever know if the sample size you have is large enough to make the methods reliable.

We can use DAGs to represent confounding variables. If X is a treatment and Y is an outcome, a confounding variable Z is a variable with arrows into both X and Y; see Figure 17.11. It is easy to check, using the formalism of interventions, that the following facts are true:
In a randomized study, the arrow between Z and X is broken. In this case, even with Z unobserved (represented by enclosing Z in a circle), the causal relationship between X and Y is estimable because it can be shown that lE(YIX := x) = lE(YIX = x) which does not involve the unobserved Z. In an observational study, with all confounders observed, we get lE(YIX := x) = JlE(YIX = x, Z = z)dFz(z) as in formula (16.7). If Z is unobserved then we cannot estimate the causal effect because lE(YIX:= x) = JlE(YIX = x,Z = z)dFz(z) involves the unobserved Z. We can't just use X and Y since in this
case. IP'(Y = ylX = x) Ie IP'(Y = ylX := x) which is just another way of saying
that causation is not association. In fact, we can make a precise connection between DAGs and counterfac-
tuals as follows. Suppose that X and Yare binary. Define the confounding

276 17. Directed Graphs and Conditional Independence

Z

X-------3~

/ \ x -.Y

X-------3~

FIGURE 17.11. Randomized study; Observational study with measured confounders; Observational study with unmeasured confounders. The circled variables are unobserved.

variable Z by

if (Co, C 1 ) = (0,0) if (CO,C1 ) = (0,1) if (Co, C 1 ) = (1,0) if (Co, C 1 ) = (1,1).

From this, you can make the correspondence between the DAG approach and the counterfactual approach explicit. I leave this for the interested reader.

17.9 Exercises

1. Show that (17.1) and (17.2) are equivalent.

2. Prove Theorem 17.2.

3. Let X, Y and Z have the following joint distribution:

X=O X= 1

y=o Y= 1 .405 .045 .045 .005
Z=O

X=O X= 1

y=o Y= 1 .125 .125 .125 .125
Z= 1

(a) Find the conditional distribution of X and Y given Z = 0 and the conditional distribution of X and Y given Z = 1. (b) Show that X II YIZ. (c) Find the marginal distribution of X and Y. (d) Show that X and Yare not marginally independent.

4. Consider the three DAGs in Figure 17.6 without a collider. Prove that XII ZIY.

17.9 Exercises 277

FIGURE 17.12. DAG for exercise 7.

5. Consider the DAG in Figure 17.6 with a collider. Prove that X IT Z and that X and Z are dependent given Y.

6. Let X E {O, I}, Y E {O, I}, Z E {O, 1, 2}. Suppose the distribution of (X, Y, Z) is Markov to: X--+Y--+Z
Create a joint distribution f(x, y, z) that is Markov to this DAG. Generate 1000 random vectors from this distribution. Estimate the distribution from the data using maximum likelihood. Compare the estimated distribution to the true distribution. Let 8 = (8000,8001, ... ,8112) where 8rst = W(X = T, Y = 8, Z = t). Use the bootstrap to get standard errors and 95 percent confidence intervals for these 12 parameters.

7. Consider the DAG in Figure 17.12. (a) Write down the factorization of the joint density. (b) Prove that X IT Zj.

8. Let V = (X, Y, Z) have the following joint distribution

X

Bernoulli (~)

278

17. Directed Graphs and Conditional Independence

YIX=x

2) Bernoulli

(

1

e4X~2 + e x-

Z I X = x,Y = y

e2(x+y)-2 )

Bernoulli

(

1

+

e 2( x

+ y

) -

2

.

(a) Find an expression for IP'(Z = z I Y = y). In particular, find IP'(Z = 1 I Y = 1).
(b) Write a program to simulate the model. Conduct a simulation and compute IP'( Z = 1 I Y = 1) empirically. Plot this as a function of the simulation size N. It should converge to the theoretical value you computed in (a).
(c) (Refers to material in the appendix.) Write down an expression for IP'(Z = 1 I Y := y). In particular, find IP'(Z = 1 I Y := 1).
(d) (Refers to material in the appendix.) Modify your program to simulate the intervention "set Y = I." Conduct a simulation and compute IP'(Z = 1 I Y := 1) empirically. Plot this as a function of the simulation size N. It should converge to the theoretical value you computed in (c).
9. This is a continuous, Gaussian version of the last question. Let V = (X, Y, Z) have the following joint distribution

X Y IX=x Z I X = x,Y = y

Normal (0,1) Normal (ax,l)
Normal ({3y + ,x, 1).

Here, a, (3 and, are fixed parameters. economists refer to models like this as structural equation models.
I (a) Find an explicit expression for J(z I y) and JE(Z I Y = y) = zJ(z I
y)dz.
(b) (Refers to material in the appendix.) Find an explicit expression
I for J(z I Y := y) and then find JE(Z I Y := y) == zJ(z I Y := y)dy.
Compare to (b).
(c) Find the joint distribution of (Y, Z). Find the correlation p between Y and Z.
(d) (Refers to material in the appendix.) Suppose that X is not observed and we try to make causal conclusions from the marginal distribution of (Y, Z). (Think of X as unobserved confounding variables.) In particular,

17.9 Exercises 279

suppose we declare that Y causes Z if P i= 0 and we declare that Y does
not cause Z if P = O. Show that this will lead to erroneous conclusions.
(e) (Refers to material in the appendix.) Suppose we conduct a randomized experiment in which Y is randomly assigned. To be concrete, suppose that

x
Y Z I X = x,Y = y

Normal(O,l) Normal(a, 1)
Normal(iJy + IX, 1).

Show that the method in (d) now yields correct conclusions (i.e., p = 0
if and only if f(z I Y := y) does not depend on y).

18
Undirected Graphs
Undirected graphs are an alternative to directed graphs for representing independence relations. Since both directed and undirected graphs are used in practice, it is a good idea to be facile with both. The main difference between the two is that the rules for reading independence relations from the graph are different.
18.1 Undirected Graphs
An undirected graph Q = (V, E) has a finite set V of vertices (or nodes) and a set E of edges (or arcs) consisting of pairs of vertices. The vertices correspond to random variables X, Y, Z, ... and edges are written as unordered pairs. For example, (X, Y) E E means that X and Yare joined by an edge. An example of a graph is in Figure 18.I.
Two vertices are adjacent, written X rv Y, if there is an edge between them. In Figure 18.1, X and Yare adjacent but X and Z are not adjacent. A sequence X o, ... ,Xn is called a path if X i- 1 rv Xi for each i. In Figure 18.1, X, Y, Z is a path. A graph is complete if there is an edge between every pair
of vertices. A subset U c V of vertices together with their edges is called a
subgraph.

282 18. Undirected Graphs
y

x

z

FIGURE 18.1. A graph with vertices V E = {(X, Y), (Y, Z)}.
w

{X, Y, Z}. The edge set IS
x

y

z

FIGURE 18.2. {Y, W} and {Z} are separated by {X}. Also, Wand Z are separated by {X, Y}.
If A, Band C are three distinct subsets of V, we say that C separates A and B if every path from a variable in A to a variable in B intersects a variable in C. In Figure 18.2 {Y, W} and {Z} are separated by {X}. Also, W and Z are separated by {X, Y}.
18.2 Probability and Graphs
Let V be a set of random variables with distribution IP'. Construct a graph with One vertex for each random variable in V. Omit the edge between a pair of variables if they are independent given the rest of the variables:
nO edge between X and Y ¢=} X Il Y Irest

18.2 Probability and Graphs 283 Y

x

z

FIGURE 18.3. X II ZIY. Y

x

z

FIGURE 18.4. No implied independence relations.
where "rest" refers to all the other variables besides X and Y. The resulting graph is called a pairwise Markov graph. Some examples are shown in Figures 18.3, 18.4, 18.5, and 18.6.
The graph encodes a set of pairwise conditional independence relations. These relations imply other conditional independence relations. How can we figure out what they are? Fortunately, we can read these other conditional independence relations directly from the graph as well, as is explained in the next theorem.
18.1 Theorem. Let 9 = (V, E) be a pairwise Markov graph for a distribution lP'. Let A, Band G be distinct subsets of V such that G separates A and B. Then A II BIG.
18.2 Remark. If A and B are not connected (i.e., there is no path from A to B) then we may regard A and B as being separated by the empty set. Then Theorem 18.1 implies that A II B.

284 18. Undirected Graphs

X

W

Y

Z

FIGURE 18.5. X II ZI{Y, W} and Y II WI{X, Z}.

·

·

·

·

X

Y

Z

W

FIGURE 18.6. Pairwise independence implies that X II ZI{Y, W}. But is X II ZIY?

The independence condition in Theorem 18.1 is called the global Markov property. We thus see that the pairwise and global Markov properties are
equivalent. Let us state this more precisely. Given a graph 0, let 1Vlpair (Q)
be the set of distributions which satisfy the pairwise Markov property: thus IF' E 1Vlpair (Q) if, under IF', X II Ylrest if and only if there is no edge between X and Y. Let Mglobal (9) be the set of distributions which satisfy the global Markov property: thus IF' E Mpair(Q) if, under IF', A II BIG if and only if G separates A and B.
18.3 Theorem. Let 0 be a graph. Then, Mpair(Q) = Mglobal(Q).
Theorem 18.3 allows us to construct graphs using the simpler pairwise property and then we can deduce other independence relations using the global Markov property. Think how hard this would be to do algebraically. Returning to 18.6, we now see that X II ZIY and Y II WIZ.
18.4 Example. Figure 18.7 implies that X II Y, X II Z and X II (Y, Z) .·

18.5 Example. Figure 18.8 implies that X II WI(Y, Z) and X II ZIY .·

18.3 Cliques and Potentials 285
Y
~z
Xe

FIGURE 18.7. X II Y, X II Z and X II (Y, Z).

x

Y

w

Z

FIGURE 18.8. X II WI (Y, Z) and X II ZIY.

18.3 Cliques and Potentials

A clique is a set of variables in a graph that are all adjacent to each other. A
set of variables is a maximal clique if it is a clique and if it is not possible to include another variable and still be a clique. A potential is any positive
function. Under certain conditions, it can be shown that IF' is Markov 9 if and only if its probability function f can be written as

f(x) = ITCEC ?jJc(xc)
Z
where C is the set of maximal cliques and
L Z = III/Jc(xc).
x CEC

(18.1)

18.6 Example. The maximal cliques for the graph in Figure 18.1 are C1
{X, Y} and C2 = {Y, Z}. Hence, if IF' is Markov to the graph, then its proba-
bility function can be written

f(x,y,z) rxI/J1(X,y)1/J2(Y,Z) for some positive functions '1/)1 and ?jJ2' ·

286

18. Undirected Graphs

FIGURE 18.9. The maximumly cliques of this graph are {Xl, X 2}, {Xl, X 3}, {X2, X 4 }, {X3, X 5 }, {X2, X 5 , X6}. 18.7 Example. The maximal cliques for the graph in Figure 18.9 are
Thus we can write the probability function as f(XI, X2, X3, X4, X5, X6) cx:tP12 (Xl, X2)tP13 (Xl, X3)1jJ24 (X2' X4)
X1'35(X3, X5)tP256(X2, X5, X6). ·
18.4 Fitting Graphs to Data
Given a data set, how do we find a graphical model that fits the data? As with directed graphs, this is a big topic that we will not treat here. However, in the discrete case, one way to fit a graph to data is to use a log-linear model, which is the subject of the next chapter.
18.5 Bibliographic Remarks
Thorough treatments of undirected graphs can be found in Whittaker (1990) and Lauritzen (1996). Some of the exercises below are from Whittaker (1990).
18.6 Exercises
1. Consider random variables (Xl, X 2 , X3). In each of the following cases, draw a graph that has the given independence relations.

18.6 Exercises 287

FIGURE 18.10.

X3

·

·

·

·

FIGURE 18.11.
(a) Xl II X3 I X 2 . (b) Xl IIX2 1 X3 and Xl IIX3 1 X 2 . (c) Xl II X 2 I X3 and Xl II X3 I X 2 and X 2 II X3 I Xl.
2. Consider random variables (Xl, X 2 , X 3, X 4 ). In each of the following cases, draw a graph that has the given independence relations. (a) Xl II X3 I X 2 , X 4 and Xl II X 4 I X 2 , X3 and X 2 II X 4 I Xl, X 3· (b) Xl II X 2 I X 3, X 4 and Xl II X3 I X 2 , X 4 and X 2 II X3 I Xl, X 4 . (c) Xl IIX3 1 X 2 ,X4 and X 2 IIX4 1 X I ,X3.
3. A conditional independence between a pair of variables is minimal if it is not possible to use the Separation Theorem to eliminate any variable from the conditioning set, i.e. from the right hand side of the bar Whittaker (1990). Write down the minimal conditional independencies from: (a) Figure 18.10; (b) Figure 18.11; (c) Figure 18.12; (d) Figure 18.13.
4. Let X I ,X2 ,X3 be binary random variables. Construct the likelihood ratio test for

5. Here are breast cancer data from Morrison et al. (1973) on diagnostic center (XI), nuclear grade (X2 ), and survival (X3):

288 18. Undirected Graphs
X3
FIGURE 18.12.
Xl

FIGURE 18.13.

X2 malignant malignant benign benign

X3

died survived died survived

Xl

Boston

35

59

47

112

Glamorgan

42

77

26

76

(a) Treat this as a multinomial and find the maximum likelihood estimator.
(b) If someOne has a tumor classified as benign at the Glamorgan clinic, what is the estimated probability that they will die? Find the standard error for this estimate.

(c) Test the following hypotheses:

18.6 Exercises 289

X l IIX21X3 XIII X 31X2 X 2 II X 31XI

versus versus versus

Xl '0000' X21X3 Xl '0000' X 31X2 X 2 '0000' X 31XI

Use the test from question 4. Based on the results of your tests, draw and interpret the resulting graph.

19
Log-Linear Models
In this chapter we study log-linear models which are useful for modeling multivariate discrete data. There is a strong connection between log-linear models and undirected graphs.
19.1 The Log-Linear Model
Let X = (Xl, .. . , Xm) be a discrete random vector with probability function
where x = (Xl, ... , xm). Let Tj be the number of values that Xj takes. Without loss of generality, we can assume that Xj E {O, 1, ... ,Tj - I}. Suppose now that we have n such random vectors. We can think of the data as a sample from a Multinomial with N = TI X T2 X ... X Tm categories. The data can be represented as counts in a TI x T2 X ... X Tm table. Let P = (PI, ... ,pN) denote the multinomial parameter.
Let S = {I, ... , rn}. Given a vector X = (Xl, ... , xm) and a subset A c S, let XA = (Xj : j E A). For example, if A = {I, 3} then XA = (Xl, X3).

292 19. Log-Linear Models
19.1 Theorem. The joint probability function f(x) of a single random vector X = (Xl' ... ' Xm) can be written as

log f(x) = LI/'A(X)
AcS

(19.1)

where the sum is over all subsets A of S = {I, ... , Tn} and the I/' 's satisfy the
following conditions:

1. 1/J0 (x) is a constant;

2. For every A c S, 1/JA(X) is only a function of XA and not the rest of the
xjI s.

3. Ifi E A and Xi = 0, then 1/JA(X) = 0.
The formula in equation (19.1) is called the log-linear expansion of f.
Eachl/'A(x) may depend on some unknown parameters (3A. Let (3 = ((3A : A c S) be the set of all these parameters. We will write f(x) = f(x; (3) when we want to emphasize the dependence on the unknown parameters (3.
In terms of the multinomial, the parameter space is
N
P={P=(P1, ... ,PN): Pj::::>O, LPj=I}.
J=l
This is an N - 1 dimensional space. In the log-linear representation, the parameter space is

where (3(p) is the set of (3 values associated with p. The set 8 is a N - 1 dimensional surface in Jl{N. We can always go back and forth between the two parameterizations we can write (3 = (3(p) and P = p((3).
° 19.2 Example. Let X rv Bernoulli(p) where < P < 1. We can write the
probability mass function for X as
for x = 0,1, where P1 = P and P2 = 1 - p. Hence,

19.1 The Log-Linear Model 293

where

1/J1(X)

10g(p2)
xlog (~~).

Notice thatljJr!J(x) is a constant (as a function of x) andljJ1 (x) = 0 when x = O.

Thus the three conditions of Theorem 19.1 hold. The log-linear parameters

are

(~~) f30 = 10g(P2), f31 = log

.

The original, multinomial parameter space is P = {(P1,P2) : Pj ~ O,P1 +P2 = I}. The log-linear parameter space is
1.} 8 = { (f30, (31) E JR;.2: ei30 +i31 + ei30 =

Given (P1, P2) we can solve for (f30, f3I). Conversely, given (f30, (31) we can solve for (P1,P2)' ·

19.3 Example. Let X = (Xl, X 2 ) where Xl E {O, I} and X 2 E {O, 1, 2}. The joint distribution of n such random vectors is a multinomial with 6 categories. The multinomial parameters can be written as a 2-by-3 table as follows:

multinomial

X2 0 1 2

Xl 0

POO POl P02

1

P10 P11 P12

The n data vectors can be summarized as counts:

data

X2 0 1 2

Xl 0 1

Coo COl CO2 ClO C11 C12

For x = (Xl, X2), the log-linear expansion takes the form

where

logpoo

Xl log ( P- 10) POO

I(X2 = 1) log ( P- Ol) + I(X2 = 2) log (P- 02)

POO

POO

I(X1 = 1, X2 = 1) log ( - P11P-OO) + I(X1 = 1, X2 = 2) log (P- 12P- OO) .

P01PlO

P02P10

294 19. Log-Linear Models
Convince yourself that the three conditions on the 'I//S of the theorem are satisfied. The six parameters of this model are:

(31 = logpoo

(3 2

=

log

(PIO) Poo

(3 3

=

100" b

(PPColnl )

· (34 = 100" (P02 ) b Pon

(3
5

=

log

(PPlOlPIPOIOO)

(3
6

=

100"
b

(PPI022PPOIOO)

.

The next theorem gives an easy way to check for conditional independence in a log-linear model.

19.4 Theorem. Let (Xa, Xb, Xc) be a partition of a vectors (Xl, ... , Xm). Then Xb II XclXa if and only if all the 1/J-terms in the log-linear expansion that have at least one coordinate in b and one coordinate in care O.

To prove this theorem, we will use the following lemma whose proof follows easily from the definition of conditional independence.
19.5 lemma. A partition (Xa, X b, Xc) satisfies Xb II XclXa if and only if f(x a, Xb, xc) = g(xa, xb)h(xa, xc) for some functions g and h
PROOF. (Theorem 19.4.) Suppose that 1/Jt is 0 whenever t has coordinates
in band c. Hence,l/Jt is 0 if t ~ aUb or t ~ aU c. Therefore

tCaUb

tcaUc

tCa

Exponentiating, we see that the joint density is of the form g(xa, xb)h(xa, xc). By Lemma 19.5, XbllXclXa. The converse follows by reversing the argument .
·

19.2 Graphical Log-Linear Models
A log-linear model is graphical if missing terms correspond only to conditional independence constraints.
19.6 Definition. Let logf(x) = L AcS 1/JA(X) be a log-linear model. Then
f is graphical if all1/J-terms are nonzero except for any pair of coordinates not in the edge set for some graph Q. In other words, 1/JA(X) = 0 if and only if {i,j} c A and (i,j) is not an edge.
Here is a way to think about the definition above:

19.2 Graphical Log-Linear Models 295

FIGURE 19.1. Graph for Example 19.7.

If you can add a term to the model and the graph does not change, then the model is not gra ph ica I.
19.7 Example. Consider the graph in Figure 19.1. The graphical log-linear model that corresponds to this graph is

log f(x)

1/)0 + 1jJl(X) + 1jJ2(X) + 1jJ3(X) + 1/)4(X) + 1/)5(X)

+ 1jJ12(X) + 1jJ23(X) + 1jJ25(X) +tP34(X) +tP35(X) +tP45(X) + 1jJ235 (x) + tP345 (x).

Let's see why this model is graphical. The edge (1,5) is missing in the graph. Hence any term containing that pair of indices is omitted from the model. For example,

are all omitted. Similarly, the edge (2,4) is missing and hence

are all omitted. There are other missing edges as well. You can check that the
model omits all the corresponding 1/) terms. Now consider the model

logf(x)

1jJ0(X) +tPl (x) +tP2(X) + 1jJ3(X) + 1jJ4(X) +tP5(X)

+tP12(X) +tP23(X) + 1jJ25(X) + 1jJ34(X) + 1jJ35(X) +tP45(X).

This is the same model except that the three way interactions were removed. If we draw a graph for this model, we will get the same graph. For example, no 1jJ terms contain (1,5) so we omit the edge between Xl and X 5. But this is not graphical since it has extra terms omitted. The independencies and graphs

296 19. Log-Linear Models

·

·

·

FIGURE 19.2. Graph for Example 19.10.
for the two models are the same but the latter model has other constraints besides conditional independence constraints. This is not a bad thing. It just means that if we are only concerned about presence or absence of conditional independences, then we need not consider such a model. The presence of the
three-way interaction 1/J235 means that the strength of association between X 2
and X3 varies as a function of X 5 . Its absence indicates that this is not so.·
19.3 Hierarchical Log-Linear Models
There is a set of log-linear models that is larger than the set of graphical models and that are used quite a bit. These are the hierarchical log-linear models.
19.8 Definition. A log-linear model is hierarchical if'ljJA = 0 and A c B implies that 'ljJB = o.
19.9 lemma. A graphical model is hierarchical but the reverse need not be true.
19.10 Example. Let
log f (x) = 1/J0 (x) +I/Jl (x) + 1/J2 (x) + 1/J3 (x) +1/J12 (x) + 1/J13 (x).
The model is hierarchical; its graph is given in Figure 19.2. The model is graphical because all terms involving (2,3) are omitted. It is also hierarchical.
·
19.11 Example. Let
log f(x) = 1/J0 (x) + 1/Jl (x) + 1/J2 (x) +1/J3 (x) +1/J12(X) + 1/J13 (x) +1/J23 (x).

19.4 Model Generators 297

FIGURE 19.3. The graph is complete. The model is hierarchical but not graphical.

·

·

FIGURE 19.4. The model for this graph is not hierarchical.
The model is hierarchical. It is not graphical. The graph corresponding to this
model is complete; see Figure 19.3. It is not graphical because tP123 (x) = 0
which does not correspond to any pairwise conditional independence. _
19.12 Example. Let

The graph corresponding is in Figure 19.4. This model is not hierarchical since
tP2 = 0 buttP12 is not. Since it is not hierarchical, it is not graphical either. _

19.4 Model Generators
Hierarchical models can be written succinctly using generators. This is most
easily explained by example. Suppose that X = (Xl, X 2 , X3). Then, lvI =
1.2 + 1.3 stands for

298 19. Log-Linear Models
The formula}\;1 = 1.2+ 1.3 says: "include Vh2 and Vh3'" We have to also include
the lower order terms or it won't be hierarchical. The generator }\;1 = 1.2.3 is the saturated model

The saturated models corresponds to fitting an unconstrained multinomial.
Consider 1\11 = 1 + 2 + 3 which means

This is the mutual independence model. Finally, consider }\;1 = 1.2 which has log-linear expansion
This model makes X3 1X2 = X2,X l = Xl a uniform distribution.

19.5 Fitting Log-Linear Models to Data

Let (3 denote all the parameters in a log-linear model 1\11. The loglikelihood

for (3 is

Ln
£((3) = log !(Xi ; (3)

i=l

where !(Xi ;(3) is the probability function for the ith random vector Xi =
i3 (XiI, ... ,Xim) as give by equation (19.1). The MLE generally has to be

found numerically. The Fisher information matrix is also found numerically

and we can then get the estimated standard errors from the inverse Fisher

information matrix.

When fitting log-linear models, one has to address the following model

selection problem: which 1jJ terms should we include in the model? This is

essentially the same as the model selection problem in linear regression.

One approach is is to use AIC. Let 1\11 denote some log-linear model. Differ-

ent models correspond to setting different¢ terms to O. Now we choose the

model}\;1 which maximizes

AIC(M) = £(M) - IMI

(19.2)

where IMI is the number of parameters in model M and £(M) is the value of the log-likelihood evaluated at the MLE for that model. Usually the model search is restricted to hierarchical models. This reduces the search space. Some

19.5 Fitting Log-Linear Models to Data 299
also claim that we should only search through the hierarchical models because other models are less interpretable.
A different approach is based on hypothesis testing. The model that includes all possible 'lji-terms is called the saturated model and we denote it by ]l;Isat . Now for each lvI we test the hypothesis
Ho : the true model is lvI versus HI: the true model is lvIsat .
The likelihood ratio test for this hypothesis is called the deviance.
19.13 Definition. For any submodel M, define the deviance dev(M) by
dev(M) = 2(lsat -lM)
where i!sat is the log-likelihood of the saturated model evaluated at the MLE
and hI is the log-likelihood of the modellvI evaluated at its MLE.

19.14 Theorem. The deviance is the likelihood ratio test statistic for

Ho : the model is lvI versus HI: the model is ]l;Isat .
Under H o, dev(M) ~ X~ with v degrees of freedom equal to the difference in
the number of parameters between the saturated model and ]l;I.

One way to find a good model is to use the deviance to test every sub-model. Every model that is not rejected by this test is then considered a plausible model. However, this is not a good strategy for two reasons. First, we will end up doing many tests which means that there is ample opportunity for making Type I and Type II errors. Second, we will end up using models where we failed to reject Ho. But we might fail to reject Ho due to low power. The result is that we end up with a bad model just due to low power.
After finding a "best model" this way we can draw the corresponding graph.

19.15 Example. The following breast cancer data are from Morrison et al. (1973). The data are on diagnostic center (XI), nuclear grade (X2 ), and survival (X3 ):

X 2 malignant malignant benign benign

X3

died survived died survived

Xl

Boston

35

59

47

112

Glamorgan

42

77

26

76

The saturated log-linear model is:

300 19. Log-Linear Models

Center

Grade - - - - - - Survival

FIGURE 19.5. The graph for Example 19.15.

Variable (Intercept)

(3j se Wj p-value
3.56 0.17 21.03 0.00 ***

center

0.18 0.22 0.79 0.42

grade survival center x grade

0.29 0.22 1.32 0.18
0.52 0.21 2.44 0.01 * -0.77 0.33 -2.31 0.02 *

center x survival

0.08 0.28 0.29 0.76

grade x survival

0.34 0.27 1.25 0.20

center x grade x survival 0.12 0.40 0.29 0.76

The best sub-model, selected using AIC and backward searching is:

Variable

(3j se Wj p-value

(Intercept)

3.52 0.13 25.62 < 0.00 ***

center

0.23 0.13 1.70 0.08

grade survival center x grade

0.26 0.18 1.43 0.15
0.56 0.14 3.98 6.65e-05 *** -0.67 0.18 -3.62 0.00 ***

grade x survival 0.37 0.19 1.90 0.05

The graph for this model JI.;[ is shown in Figure 19.5. To test the fit of this model, we compute the deviance of JI.;[ which is 0.6. The appropriate X2 has
8 - 6 = 2 degrees of freedom. The p-value is IP'(X~ > .6) = .74. So we have no
evidence to suggest that the model is a poor fit .·

19.6 Bibliographic Rernarks
For this chapter, I drew heavily on Whittaker (1990) which is an excellent text on log-linear models and graphical models. Some ofthe exercises are from Whittaker. A classic reference on log-linear models is Bishop et al. (1975).

19.7 Exercises

19.7 Exercises 301

1. Solve for the P~jS in terms of the j3's in Example 19.3. 2. Prove Lemma 19.5. 3. Prove Lemma 19.9. 4. Consider random variables (Xl, X 2 , X 3 , X 4 ). Suppose the log-density is

(a) Draw the graph G for these variables. (b) Write down all independence and conditional independence relations implied by the graph. (c) Is this model graphical? Is it hierarchical?
5. Suppose that parameters P(Xl' X2, X3) are proportional to the following values:
X2 0 0 1 1 X3 0 1 0 1 Xl 0 2 8 4 16
1 16 128 32 256
Find the 1/J-terms for the log-linear expansion. Comment on the model.
6. Let Xl"'" X 4 be binary. Draw the independence graphs corresponding to the following log-linear models. Also, identify whether each is graphical and/or hierarchical (or neither). (a) logf = 7 + llXl + 2X2 + 1.5x3 + 17x4
(b) log f = 7 + llXl + 2X2 + 1.5x3 + 17x4 + 12x2x3 + 78x2X4 + 3X3X4 +
32x2X3X4
(c) logf = 7+11xl +2X2+1.5x3+17x4+12x2X3+3x3X4+XIX4+2xIX2
(d) log f = 7 + 5055xl X2X3X4

20
Nonparametric Curve Estimation
In this Chapter we discuss nonparametric estimation of probability density functions and regression functions which we refer to as curve estimation or smoothing.
In Chapter 7 we saw that it is possible to consistently estimate a cumulative distribution function F without making any assumptions about F. If we want to estimate a probability density function j(x) or a regression function r-(x) = lE(YIX = x) the situation is different. We cannot estimate these functions consistently without making some smoothness assumptions. Correspondingly, we need to perform some sort of smoothing operation on the data.
An example of a density estimator is a histogram, which we discuss in detail in Section 20.2. To form a histogram estimator of a density j, we divide the real line to disjoint sets called bins. The histogram estimator is a piecewise constant function where the height of the function is proportional to number of observations in each bin; see Figure 20.3. The number of bins is an example of a smoothing parameter. If we smooth too much (large bins) we get a highly biased estimator while if we smooth too little (small bins) we get a highly variable estimator. Much of curve estimation is concerned with trying to optimally balance variance and bias.

304 20. Nonparametric Curve Estimation

This is a function of the data

g(x)
I This is the point at which we are evaluating g(.)

FIGURE 20.1. A curve estimate 9 is random because it is a function of the data. The point x at which we evaluate 9 is not a random variable.
20.1 The Bias-Variance Tradeoff

Let 9 denote an unknown function such as a density function or a regression function. Let gn denote an estimator of g. Bear in mind that gn(x) is a random function evaluated at a point x. The estimator is random because it depends on the data. See Figure 20.l.
As a loss function, we will use the integrated squared error (ISE): 1

(20.1)

The risk or mean integrated squared error (MISE) with respect to squared error loss is
(20.2)
20.1 lemma. The risk can be written as
(20.3)

where

b(x) = IE(gn(X)) - g(x)

is the bias ofgn(x) at a fixed x and

(20.4)

is the variance ofgn(x) at a fixed x.

(20.5)

lWe could use other loss functions. The results are similar but the analysis is much more complicated.

20.2 Histograms 305

Risk ·· Bias squared

..
... ..............-........... ..... ··· Variance

.................

...... Less Smoothing Optimal Smoothing

More Smoothing ·· ~

FIGURE 20.2. The Bias-Variance trade-off. The bias increases and the variance de-
creases with the amount of smoothing. The optimal amount of smoothing, indicated
by the vertical line, minimizes the risk = bias2 + variance.

In summary,

RISK = BIAS2 + VARIANCE.

I (20.6)

When the data are oversmoothed, the bias term is large and the variance is small. When the data are undersmoothed the opposite is true; see Figure 20.2. This is called the bias-variance tradeoff. Minimizing risk corresponds to balancing bias and variance.

20.2 Histograrns
Let Xl, ... ,Xn be lID on [0, 1] with density f. The restriction to [0,1] is not
crucial; we can always rescale the data to be on this interval. Let m be an

306

20. Nonparametric Curve Estimation

integer and define bins

Bl

=

[o,~) rn

,B2

=

[~,~),
m rn

... ,

Bm =

[~,1]. m

(20.7)

Define the binwidth h = 11m, let Vj be the number of observations in B j ,
let Pj = vjln and let Pj = IE f(u)du. J The histogram estimator is defined by

which we can write more succinctly as

(20.8)

To understand the motivation for this estimator, let Pj = IE f(u)du and note J
that, for x E B j and h small,

--t- ~
lE(jn(x))

=

lE(p)

=

P~

=

J~
J

f(u)du h

~

f(x)h f(x)

=

f(x).

20.2 Example. Figure 20.3 shows three different histograms based on n = 1,266 data points from an astronomical sky survey. Each data point represents the distance from us to a galaxy. The galaxies lie on a "pencilbeam" pointing directly from the Earth out into space. Because of the finite speed of light, looking at galaxies farther and farther away corresponds to looking back in time. Choosing the right number of bins involves finding a good tradeoff between bias and variance. We shall see later that the top left histogram has too few bins resulting in oversmoothing and too much bias. The bottom left histogram has too many bins resulting in undersmoothing and too few bins. The top right histogram is just right. The histogram reveals the presence of clusters of galaxies. Seeing how the size and number of galaxy clusters varies with time, helps cosmologists understand the evolution of the universe. _
in The mean and variance of (x) are given in the following Theorem.
20.3 Theorem. Consider fixed x and fixed m, and let B j be the bin containing x. Then,
(20.9)

20.2 Histograms 307

r-

-

o....

- ,---
r-

S r--
o

I--
l o

1

1

1

1

1

0 .00

0.05

0 .10

0 . 15

0.20

Oversmool hed

Just Right

~ "i'
,. .~
~ <>
~ ::l
§
'",

0 .00

0.05

0 .10

0 .15

Undersmoothed

0.20

....
'I
o 200 400 600 600 1000
number of bins

FIGURE 20.3. Three versions of a histogram for the astronomy data. The top left histogram has too few bins. The bottom left histogram has too many bins. The top right histogram is just right. The lower, right plot shows the estimated risk versus the number of bins.

308

20. Nonparametric Curve Estimation

Let's take a closer look at the bias-variance tradeoff using equation (20.9). Consider some x E B j . For any other u E B j ,
f(u) R:O f(x) + (u - x)f'(x)

and so

L L Pj =

f(u)du R:O

(f(X) + (u - x)f'(X))dU

j

j

f(X)h+hf'(X)(h(j-~) -x).

Therefore, the bias b(x) is

b(x)

~
IE(Jn(x)) -

f(x)

=

Pl~

-

f(x)

f(x)h + hf'(x) (h (j - ~) - x) .

R:O

h

- j(x)

f'(x) (h (j -~) -x).

If Xj is the center of the bin, then

L r -~) (J'(X))2 (h (j

- x dx

j

(h r j~j ~) R:O (J'(Xj))2

(j - - x dx

Therefore,

Note that this increases as a function of h. Now consider the variance. For h small, 1 - Pj R:O 1, so
v(x) R:O Pj
nh2
f(x)h + hf'(x) (h (j - ~) - x)
f(x)
R:O
nh

where we have kept only the dominant term. So,

r1
Jo v(x)dx

~

1 nh'

20.2 Histograms 309

Note that this decreases with h. Putting all this together, we get:

20.4 Theorem. Suppose that J(j'(U))2du < 00. Then

The value h* that minimizes (20.10) is

1(

6

) 1/3

h* = n1/3 J(jI(U))2du

With this choice of binwidth,

1/3
where C = (3/4)2/3 ( J(jI(U))2du)

(20.10) (20.11) (20.12)

Theorem 20.4 is quite revealing. We see that with an optimally chosen binwidth, the MISE decreases to 0 at rate n -2/3. By comparison, most parametric estimators converge at rate n -1. The slower rate of convergence is the price we pay for being nonparametric. The formula for the optimal binwidth h* is of theoretical interest but it is not useful in practice since it depends on the
unknown function f.
A practical way to choose the binwidth is to estimate the risk function and minimize over h. Recall that the loss function, which we now write as a function of h, is

L(h)

J(j~(x) - f(X))2dx

J [;(x) dx - 2 J fn(x)f(x)dx + J f2(x) dx.

The last term does not depend on the binwidth h so minimizing the risk is equivalent to minimizing the expected value of

J(h) = J [;(x) dx - 2 J fn(x)f(x)dx.

310

20. Nonparametric Curve Estimation

We shall refer to lE(J(h)) as the risk, although it differs from the true risk by
I P the constant term (x) dx.

20.5 Definition. The cross-validation estimator of risk is

(20.13)

where f( -i) is the histogram estimator obtained after removing the ith observation. We refer to J(h) as the cross-validation score or estimated risk.

20.6 Theorem. The cross-validation estimator is nearly unbiased: lE(J(x)) ~ lE(J(x)).

In principle, we need to recompute the histogram n times to compute 5(h). Moreover, this has to be done for all values of h. Fortunately, there is a shortcut formula.

20.7 Theorem. The following identity holds:

~

2

n + 1 ~~2

J(h) = (n-1 )h - (n-1 ) LPj .

j=l

(20.14)

20.8 Example. We used cross-validation in the astronomy example. The crossvalidation function is quite flat near its minimum. Any m in the range of 73 to 310 is an approximate minimizer but the resulting histogram does not change much over this range. The histogram in the top right plot in Figure 20.3 was constructed using m = 73 bins. The bottom right plot shows the estimated
risk, or more precisely, A, plotted versus the number of bins. _

Next we want a confidence set for f. Suppose fn is a histogram with m bins
and binwidth h = 11m. We cannot realistically make confidence statements
about the fine details of the true density f. Instead, we shall make confidence statements about f at the resolution of the histogram. To this end, define

(20.15)

IE where Pj = f(u)du. Think of ](x) as a "histogramized" version of f· J

20.2 Histograms 311
20.9 Definition. A pair of functions (fn(x), un(x)) is a 1 - a confidence band (or confidence envelope) if
(20.16)

20.10 Theorem. Let rn = rn(n) be the number of bins in the histogram fn. Assume that rn(n) --+ 00 and rn(n) logn/n --+ 0 as n --+ 00. Define

(max{ ~ -c,O}Y

cY un(X) (V!n(x) +

(20.17)

where

c = Zcx/(2m) (in.
2 V-:;;:

Then, (fn(x), un(x)) is an approximate 1 - a confidence band.

(20.18)

PROOF. Here is an outline of the proof. From the central limit theorem, Pj ~ N(pj,pj(1- pj)/n). By the delta method, JPj ~ N(yIPj, 1/(4n)). Moreover,
it can be shown that the JPj's are approximately independent. Therefore,

(20.19)

where Zl, ... , Zm rv N(O, 1). Let

Then,

ViWI V¥I p (m;xl~ -

> c) =p (mrxlV¥ -

> c)

1 511 P ( mrx 2yn yip; -

> Zcx/(2m))

~ ~P(IZjl P (mrxlZjl > Zcx/(2m)) <:::

> Zcx/(2m))

m
L~r=n a. -
j=l

312 20. Nonparametric Curve Estimation

FIGURE 20.4. 95 percent confidence envelope for astronomy data using m = 73 bins.
20.11 Example. Figure 20.4 shows a 95 percent confidence envelope for the astronomy data. We see that even with over 1,000 data points, there is still substantial uncertainty. _

20.3 Kernel Density Estirnation

Histograms are discontinuous. Kernel density estimators are smoother and

they converge faster to the true density than histograms.

Let Xl, ... , Xn denote the observed data, a sample from f. In this chap-

ter, a kernel is defined to be any smooth function K such that K(x) 2 0,
I K(x) dx = 1, I xK(x)dx = 0 and uk == I x 2 K(x)dx > o. Two examples of

kernels are the Epanechnikov kernel

!(1 - K(x) = {

x 2 /5)/vf> Ixl < vf>

other-wise

(20.20)

and the Gaussian (Normal) kernel K(x) = (27f)-1/2e-x2 /2.

20.3 Kernel Density Estimation 313
1. FIGURE 20.5. A kernel density estimator At each point x, f(x) is the average
of the kernels centered over the data points Xi. The data points are indicated by short vertical bars.
20.12 Definition. Given a kernel K and a positive number h, called the bandwidth, the kernel density estimator is defined to be
(20.21 )
An example of a kernel density estimator is show in Figure 20.5. The kernel estimator effectively puts a smoothed-out lump of mass of size lin over each data point Xi. The bandwidth h controls the amount of smoothing. When h
is close to 0, In consists of a set of spikes, one at each data point. The height of the spikes tends to infinity as h -+ O. When h -+ 00, In tends to a uniform
density.

314

20. Nonparametric Curve Estimation

20.13 Example. Figure 20.6 shows kernel density estimators for the astronomy data using three different bandwidths. In each case we used a Gaussian kernel. The properly smoothed kernel density estimator in the top right panel shows similar structure as the histogram. However, it is easier to see the clusters with the kernel estimator. _

To construct a kernel density estimator, we need to choose a kernel K and a bandwidth h. It can be shown theoretically and empirically that the choice of K is not crucial. 2 However, the choice of bandwidth h is very important. As with the histogram, we can make a theoretical statement about how the risk of the estimator depends on the bandwidth.

20.14 Theorem. Under weak assumptions on f and K,
R(j,!n) R:; ~CTkh4 /(ju (X))2 + J K~~)dX

(20.22)

where CTk = J x 2K(x)dx. The optimal bandwidth is

-2/5 1/5 -1/5

1* - c1 c2 c3

I. -

1/5

17.

(20.23)

where C1 = J x 2K(x)dx, C2 = J K(X)2dx and C3 = J(jl/(x)?dx. With this

choice of bandwidth,

for some constant C4 > O.
PROOF. Write Kh(x, X) = h-1K ((x - X)jh) and !n(x) = 17.-1 Li Kh(x, Xi).
Thus, IE[!n(x)] = IE[Kh(X, X)] and V[!n(x)] = n- 1V[Kh(x, X)]. Now,

IE[Kh(X, X)]

/.!.K (x - t) f(t) dt

h

h

/ K(u)f(x - hu) du

/ K(u) [f(x) - hf,(x) + -1;;/U (x) +... ] du
f(x) + ~h2 /' (x) / u2K(u) du···

since J K(x) dx = 1 and J x K(x) dx = O. The bias is IE[Kh(X,X)]- f(x) R:; 21CT2kh2 f U (x).

21t can be shown that the Epanechnikov kernel is optimal in the sense of giving smallest asymptotic mean squared error, but it is really the choice of bandwidth which is crucial.

20.3 Kernel Density Estimation 315

0.0

0 .1

0 .2

0.0

0.1

0.2

0 .002 0 .004 0.006
FIGURE 20.6. Kernel density estimators and estimated risk for the astronomy data. Top left: oversmoothed. Top right: just right (bandwidth chosen by cross-validation). Bottom left: undersmoothed. Bottom right: cross-validation curve as a function of bandwidth h. The bandwidth was chosen to be the value of h where the curve is a minimum.

316

20. Nonparametric Curve Estimation

By a similar calculation,

The result follows from integrating the squared bias plus the variance. _

We see that kernel estimators converge at rate n -4/5 while histograms con-

verge at the slower rate n- 2/ 3 . It can be shown that, under weak assumptions,

there does not exist a nonparametric estimator that converges faster than

n-4/ 5 .

The expression for h* depends on the unknown density f which makes

the result of little practical use. As with the histograms, we shall use cross-

validation to find a bandwidth. Thus, we estimate the risk (up to a constant)

by

J t J(h) =

~ r(x)dz -

1-i(Xi )

(20.24)

i=l

1-i where is the kernel density estimator after omitting the ith observation.

20.15 Theorem. For any h > 0,

IE [J( h)] = IE [J(h) 1.

Also,

(20.25)

I where K*(x) = K(2) (x) - 2K(x) and K(2)(z) = K(z - y)K(y)dy. In par-
ticular, if K is a N(O,l) Gaussian kernel then K(2)(Z) is the N(0,2) density.

We then choose the bandwidth hn that minimizes J(h).3 A justification for this method is given by the following remarkable theorem due to Stone.
1h 20.16 Theorem (Stone's Theorem). Suppose that f is bounded. Let denote
the kernel estimator with bandwidth h and let hn denote the bandwidth chosen by cross-validation. Then,

I (t(x) - j",,(x)f dx p

(t( infh I

~

2 --+l.

x) - !h (x )) dx

(20.26)

i 3For large data sets, and (20.25) can be computed quickly using the fast Fourier transform.

20.3 Kernel Density Estimation 317
20.17 Example. The top right panel of Figure 20.6 is based on cross-validation. These data are rounded which problems for cross-validation. Specifically, it
causes the minimizer to be h = o. To overcome this problem, we added a
small amount of random Normal noise to the data. The result is that J(h) is very smooth with a well defined minimum. _
20.18 Remark. Do not assume that, if the estimator f is wiggly, then cross-
validation has let you down. The eye is not a good judge of risk.
To construct confidence bands, we use something similar to histograms. Again, the confidence band is for the smoothed version,
in = lEC{;, (x)) = / ~K (x ~ u) f(u) du,

of the true density f. 4 Assume the density is on an interval (a, b). The band

is

l'n(x) = h(x) - q se(x), un(x) = h(x) + q se(x)

(20.27)

where

se(x)
Yi(x) q

s(x)
fo'
2: -711,-1 n (Yi(x) - -Y n(x)) 2 , i=l
~K (x ~LXi) ,
C ([>-1 + (1 ; a)l/m) ,

b-a w
where w is the width of the kernel. In case the kernel does not have finite width then we take w to be the effective width, that is, the range over which the kernel is non-negligible. In particular, we take w = 3h for the Normal kernel.

20.19 Example. Figure 20.7 shows approximate 95 percent confidence bands for the astronomy data. _

4This is a modified version of the band described in Chaudhuri and Marron (1999).

318 20. Nonparametric Curve Estimation

FIGURE 20.7. 95 percent confidence bands for kernel density estimate for the astronomy data.

Suppose now that the data Xi = (XiI, ... , X id ) are d-dimensional. The ker-

nel estimator can easily be generalized to d dimensions. Let h = (hI' ... ' hd)

be a vector of bandwidths and define

L _

1n

fn(x) = - Kh(X - Xi)

n

i=l

(20.28)

where

Kh(x-Xi) =

1

{rrd K(Xi-Xij )}

nhl ... hd j=l

hj

(20.29)

where hI, ... , hd are bandwidths. For simplicity, we might take h j = 8 j h where

8j is the standard deviation of the jth variable. There is now only a single

bandwidth h to choose. Using calculations like those in the one-dimensional

case, the risk is given by

~ ~(}k [t J J R(j, in)

L hj fJj(x)dx + h;h% fjjikk dX]

J=l

J#k

+ .U...:..:K:...2.--(-'X---)'--d--x--')--d-nh 1 ··· hd

where fjj is the second partial derivative of f. The optimal bandwidth satisfies hi ~ Cln-1/(4+d), leading to a risk of order n- 4/(4+d). From this fact, we see

20.4 Nonparametric Regression 319

that the risk increases quickly with dimension, a problem usually called the curse of dimensionality. To get a sense of how serious this problem is, consider the following table from Silverman (1986) which shows the sample size required to ensure a relative mean squared error less than 0.1 at 0 when the density is multivariate normal and the optimal bandwidth is selected:

Dimension 1 2 3 4 5 6 7 8 9
10

Sample Size 4
19 67 223 768 2790 10,700 43,700 187,000 842,000

This is bad news indeed. It says that having 842,000 observations in a tendimensional problem is really like having 4 observations in a one-dimensional problem.

20.4 Nonpararnetric Regression

Consider pairs of points (Xl, Yd, ... , (x n , Yn ) related by

(20.30)
where lE( Ei) = o. We have written the xi's in lower case since we will treat
them as fixed. We can do this since, in regression, it is only the mean of Y conditional on X that we are interested in. We want to estimate the regression function r-(x) = lE(YIX = x).
There are many nonparametric regression estimators. Most involve estimating r-(x) by taking some sort of weighted average of the Y/s, giving higher weight to those points near x. A popular version is the Nadaraya-Watson kernel estimator.

20.20 Definition. The Nadaraya-Watson kernel estimator is defined

by

Ln
r(x) = Wi(X)Y;

(20.31 )

i=l

320

20. Nonparametric Curve Estimation

where K is a kernel and the weights Wi(X) are given by

K (X-Xi.)

Wi(X) =
"n

-h-.
K (X-X:j )

L..J=1

h

(20.32)

The form of this estimator comes from first estimating the joint density

f(x, y) using kernel density estimation and then inserting the estimate into

the formula,

J . r(x) = lE(YIX = x) =

J yf(x, y)dy J yj(ylx)dy = f(x, y)dy .

20.21 Theorem. Suppose that V(Ei) = (J"2. The risk of the Nadaraya- Watson

(J rJ r kernel estimator is R(pn, r) ~ ~4

x 2K2(x)dx

j(~} (rll(x) + 2r'(x)

dx

J+

(J"2

J K2((x)dx
nhf x)

dx.

(20.33)

The optimal bandwidth decreases at rate n- I / 5 and with this choice the risk decreases at rate n -4/5.

In practice, to choose the bandwidth h we minimize the cross validation

score

n
J(h) = 2)Yi - r_i(xi))2

(20.34)

i=l

where r-i is the estimator we get by omitting the ith variable. Fortunately, there is a shortcut formula for computing J.

20.22 Theorem. J can be written as

~
J(h)

=

~
L.)Yi

-

_

2

r(xi))

1
2·

i=l

(
1-

~T.'

K(O))
K(:Ti..:Tj)

~'}=1

11

(20.35)

20.23 Example. Figures 20.8 shows cosmic microwave background (CMB) data from BOOMERaNG (Netterfield et al. (2002)), Maxima (Lee et al. (2001)), and DASI (Halverson et al. (2002))). The data consist of n pairs (Xl, YI ), ... , (xn' Yn ) where Xi is called the multipole moment and Y; is the

20.4 Nonparametric Regression 321
estimated power spectrum of the temperature fluctuations. What you are seeing are sound waves in the cosmic microwave background radiation which is the heat, left over from the big bang. If r(x) denotes the true power spectrum, then
where Ei is a random error with mean O. The location and size of peaks in r(x) provides valuable clues about the behavior of the early universe. Figure 20.8 shows the fit based on cross-validation as well as an undersmoothed and oversmoothed fit. The cross-validation fit shows the presence of three welldefined peaks, as predicted by the physics of the big bang. _
The procedure for finding confidence bands is similar to that for density estimation. However, we first need to estimate (52. Suppose that the x;'s are
ordered. Assuming r(x) is smooth, we have r(xHd - r(xi) :=:::: 0 and hence

and hence

We can thus use the average of the n - 1 differences Yi+l - Yi to estimate (52.

Hence, define

L( ~2
(5

=

n-l

2(n1-l )

Yi+l -

Yi )2 .

i=l

(20.36)

As with density estimate, the confidence band is for the smoothed version

rn(x) = lE(rn(x)) of the true regression function r.

322 20. Nonparametric Curve Estimation
· ·· · ·

C>
:5

200

400

600

800 1000

Undersmoothed

C>
:5

··

··

200

400

600

800 1000

Oversmoothed

U')

C> C> C>

·

<0

C+>
21l

C>
:5
U') C> C> C>
'"
:5
C> M C> C> C> N C> C>
~
200 400 600 800 1000 .Just Right (Using cross-valdiation)

U')
C+>
..'."..

U')

C>

~
.<0=0

d;
<0

'0

'*E
~

U')
C+>
'"U')

U')
C+>
''""

~ +
M'"

20

40

60

80

100

120

bandwidth

FIGURE 20.S. Regression analysis of the CMB data. The first fit is undersmoothed, the second is oversmoothed, and the third is based on cross-validation. The last panel shows the estimated risk versus the bandwidth of the smoother. The data are from BOOMERaNG, Maxima, and DASI.

20.4 Nonparametric Regression 323

Confidence Bands for Kernel Regression
An approximate 1 - a confidence band for r n (x) is

(20.37)

where

se(x)

8n

(j \

wf(x),

q

C <1>-1 + (1 ; a)l/m) ,

b-a
m
w
(j is defined in (20.36) and w is the width of the kernel. In case the kernel does not have finite width then we take w to be the effective width, that is, the range over which the kernel is non-negligible. In particular, we take w = 3h for the Normal kernel.

20.24 Example. Figure 20.9 shows a 95 percent confidence envelope for the CMB data. We see that we are highly confident of the existence and position of the first peak. We are more uncertain about the second and third peak. At the time of this writing, more accurate data are becoming available that apparently provide sharper estimates of the second and third peak. _

The extension to multiple regressors X = (Xl' ... ' Xp) is straightforward.

As with kernel density estimation we just replace the kernel with a multivari-

ate kernel. However, the same caveats about the curse of dimensionality apply.

In some cases, we might consider putting some restrictions on the regression

function which will then reduce the curse of dimensionality. For example,

additive regression is based on the model

Lp
Y = + rj(Xj ) f.
j=l

(20.38)

Now we only need to fit p one-dimensional functions. The model can be en-

riched by adding various interactions, for example,

p

L L Y =

rj(Xj ) + rjk(XjXk) + f.

j=l

j<k

(20.39)

Additive models are usually fit by an algorithm called backfitting.

324 20. Nonparametric Curve Estimation
~ ~-----r-------r-------r-------r-------r~
FIGURE 20.9. 95 percent confidence envelope for the CMB data. Backfitti ng
2. For j = 1, ... ,p:
(a) Let fi = Yi - L:s,fj Ts(Xi). (b) Let Tj be the function estimate obtained by regressing the f/S
on the jth covariate. 3. If converged STOP. Else, go back to step 2. Additive models have the advantage that they avoid the curse of dimensionality and they can be fit quickly, but they have one disadvantage: the model is not fully nonparametric. In other words, the true regression function T(X) may not be of the form (20.38).
20.5 Appendix
CONFIDENCE SETS AND BIAS. The confidence bands we computed are not for the density function or regression function but rather for the smoothed

20.6 Bibliographic Remarks 325
function. For example, the confidence band for a kernel density estimate with bandwidth h is a band for the function one gets by smoothing the true function with a kernel with the same bandwidth. Getting a confidence set for the true function is complicated for reasons we now explain.
Let In(x) denote an estimate of the function f(x). Denote the mean and standard deviation of In(x) by fn(x) and sn(x). Then,

Typically, the first term converges to a standard Normal from which one derives confidence bands. The second term is the bias divided by the standard deviation. In parametric inference, the bias is usually smaller than the standard deviation of the estimator so this term goes to 0 as the sample size increases. In nonparametric inference, optimal smoothing leads us to balance the bias and the standard deviation. Thus the second term does not vanish even with large sample sizes. This means that the confidence interval will not
be centered around the true function f.

20.6 Bibliographic Rernarks
Two very good books on density estimation are Scott (1992) and Silverman (1986). The literature on nonparametric regression is very large. Two good starting points are HardIe (1990) and Loader (1999). The latter emphasizes a class of techniques called local likelihood methods.

20.7 Exercises

1. Let Xl, ... ,Xn f rv and let f n be the kernel density estimator using the

boxcar kernel:

K (x ) =

{

I 0

_1 < x < 1
oth2erwise. 2

(a) Show that

11 lE(l(x)) = T

x +(h/2)
f(y)dy

L x- (h/2)

and

[1 (1 )2] ~

1

V(J(x)) = -h2

x+(h/2)
f(y)dy -

x+(h/2)
f(y)dy

n

x-(h/2)

x-(h/2)

326 20. Nonparametric Curve Estimation

~

p

(b) Show that if h -+ 0 and nh -+ 00 as n -+ 00, then fn(x)--+ f(x).

2. Get the data on fragments of glass collected in forensic work from the book website. Estimate the density of the first variable (refractive index) using a histogram and use a kernel density estimator. Use crossvalidation to choose the amount of smoothing. Experiment with different binwidths and bandwidths. Comment on the similarities and differences. Construct 95 percent confidence bands for your estimators.

3. Consider the data from question 2. Let Y be refractive index and let
x be aluminum content (the fourth variable). Perform a nonparametric
regression to fit the model Y = f (x) +E. Use cross-validation to estimate
the bandwidth. Construct 95 percent confidence bands for your estimate.

4. Prove Lemma 20.1.

5. Prove Theorem 20.3.

6. Prove Theorem 20.7.

7. Prove Theorem 20.15.

8. Consider regression data (Xl, Yd, ... , (xn' Yn). Suppose that 0 <::: Xi <::: 1 for all i. Define bins B j as in equation (20.7). For X E B j define

where Y j is the mean of all the Y/s corresponding to those xi's in B j . Find the approximate risk of this estimator. From this expression for the risk, find the optimal bandwidth. At what rate does the risk go to zero?
9. Show that with suitable smoothness assumptions on r(x), &2 in equation
(20.36) is a consistent estimator of (J2.
10. Prove Theorem 20.22.

21
Smoothing Using Orthogonal Functions
In this chapter we will study an approach to nonparametric curve estimation based on orthogonal functions. We begin with a brief introduction to the theory of orthogonal functions, then we turn to density estimation and regression.
21.1 Orthogonal Functions and L2 Spaces
Let v = (VI, V2, V3) denote a three-dimensional vector, that is, a list of three
real numbers. Let V denote the set of all such vectors. If a is a scalar (a number) and v is a vector, we define av = (avl' aV2, aV3). The sum of vectors
v and W is defined by v + W = (VI + WI, V2 +W2, v3 + W3). The inner product
between two vectors v and W is defined by (v, W! = 2:7=1 ViWi' The norm
(or length) of a vector v is defined by
(21.1)
Two vectors are orthogonal (or perpendicular) if (v,W! = o. A set of
vectors are orthogonal if each pair in the set is orthogonal. A vector is normal
if Ilvll = 1.

328 21. Smoothing Using Orthogonal Functions

Let (h = (1,0,0), ¢2 = (0,1,0), ¢3 = (0,0,1). These vectors are said to be
an orthonormal basis for V since they have the following properties: (i) they are orthogonal; (ii) they are normal; (iii) they form a basis for V, which means that any v E V can be written as a linear combination of ¢1, ¢2, ¢3:

3
v=L{3j¢j
j=l

where {3j = (¢j,v;.

(21.2)

For example, if v = (12,3,4) then v = 12¢1 + 3¢2 + 4¢3. There are other

orthonormal bases for V, for example,

You can check that these three vectors also form an orthonormal basis for V. Again, if v is any vector then we can write
3
v = L {3jl/Jj where {3j = (1/Jj, v;.
j=l
For example, if v = (12,3,4) then
v = 10.971/J1 + 6.361/J2 + 2.861/J3'
Now we make the leap from vectors to functions. Basically, we just replace
J: vectors with functions and sums with integrals. Let L2 (a, b) denote all func-
tions defined on the interval [a, b] such that f(x)2dx < 00:

(21.3)

We sometimes write L2 instead of L 2(a, b). The inner product between two
J functions f, g E L2 is defined by f(x)g(x)dx. The norm of f is

J Ilfll = / f(x)2dx.

(21.4)

J Two functions are orthogonal if f(x)g(x)dx = O. A function is normal if
Ilfll = 1.
J A sequence of functions ¢1, ¢2, ¢3,'" is orthonormal if ¢;(x)dx = 1 for each j and J¢i(x)¢j(x)dx = 0 for i i=- j. An orthonormal sequence is com-
plete if the only function that is orthogonal to each ¢j is the zero function.

21.1 Orthogonal Functions and L2 Spaces 329

In this case, the functions eP1, eP2, eP3,'" form in basis, meaning that if f E L2
then f can be written as1

L Ja 00

(b

f(x) = (3jePj(x), where (3j = f(x)ePj(x)dx.

j=l

(21.5)

A useful result is Parseval's relation which says that
J IIfl12 == f2(x) dx = f{3} == 11{311 2 j=l
where {3 = ({31, (32, ...).

(21.6)

21.1 Example. An example of an orthonormal basis for L2(0, 1) is the cosine basis defined as follows. Let ePo(x) = 1 and for j ~ 1 define

(21. 7)

The first six functions are plotted in Figure 21.1. _

21.2 Example. Let

f(x) = Jx(1 - x) sin (( x2+.l7.0r 5))

which is called the "doppler function." Figure 21.2 shows f (top left) and its

approximation

LJ
!J(x) = (3jePj(x) j=l

with J equal to 5 (top right), 20 (bottom left), and 200 (bottom right).
As J increases we see that !J(x) gets closer to f(x). The coefficients {3j Jo1 f(x)ePj(x)dx were computed numerically. _

21.3 Example. The Legendre polynomials on [-1,1] are defined by

1 dj 2 Pj(x)=2-)·J-.'I-xd).(x

-1)1.,

j=0,1,2, ...

(21.8)

It can be shown that these functions are complete and orthogonal and that

11

2

p 2(x)dx = - - .

-1 )

2j+l

(21.9)

IThe equality in the displayed equation means that J(f(x) - fn(X))2dx --+ 0 where fn(x) =
"L.J=l (3j(/Jj(x).

330

21. Smoothing Using Orthogonal Functions

FIGURE 21.1. The first six functions in the cosine basis.
FIGURE 21.2. Approximating the doppler function with its expansion
in the cosine basis. The function f (top left) and its approximation
fJ(x) = "L:=1 (3jrPj(x) with J equal to 5 (top right), 20 (bottom left),
and 200 (bottom right). The coefficients {3j = J~l f(x)rPj(x)dx were computed numerically.

21.2 Density Estimation 331

It follows that the functions epj(x) = J(2j + 1)/2Pj (x), j = 0,1, ... form an

orthonormal basis for L2 (-1, 1). The first few Legendre polynomials are:
1, Po(X)

P1(x)

x,

P2(x)

1), ~ (3X2 -

and

P3 (x)

~ (5X3 - 3X).

These polynomials may be constructed explicitly using the following recursive

relation:

· P (x) = (2j + l)xPj (x) - jPj- 1(x).

]+1

j +1

(21.10)

The coefficients {31, {32, ... are related to the smoothness of the function f. To see why, note that if f is smooth, then its derivatives will be finite. Thus we expect that, for some k, Jo1(f(k)(x))2dx < 00 where f(k) is the kth derivative

of f. Now consider the cosine basis (21.7) and let f(x) = L;:o {3jepj(x). Then,

The only way that L;:l {3J(nj)2k can be finite is if the {3/s get small when j gets large. To summarize:
If the function f is smooth, then the coefficients {3j will be small
when j is large.
For the rest of this chapter, assume we are using the cosine basis unless otherwise specified.

21.2 Density Estirnation

Let Xl, ... ,Xn be IID observations from a distribution on [0,1] with density
f. Assuming f E L2 we can write

L00
f(x) = {3jepj(x)
j=O

where ep1, ep2, ... is an orthonormal basis. Define

L ~ 1 n

{3j = n

epj(Xi ).

i=l

(21.11)

332 21. Smoothing Using Orthogonal Functions
21.4 Theorem. The mean and variance of Pj are
where PROOF. The mean is

(21.12) (21.13)

IE (¢j(X1 ))
J¢j(x)f(x)dx = Pj·

The calculation for the variance is similar.·

Hence, Pj is an unbiased estimate of Pj. It is tempting to estimate f by L~l (3j¢j(x) but this turns out to have a very high variance. Instead, consider

the estimator

LJ
j(x) = (3j¢j(x).
j=l

(21.14)

The number of terms J is a smoothing parameter. Increasing J will decrease

bias while increasing variance. For technical reasons, we restrict J to lie in

the range

l::';J::';p

where p = p(n) = ,[n. To emphasize the dependence of the risk function on
J, we write the risk function as R( J).

21.5 Theorem. The risk of f is

L L J 2

00

R(J) =

+ (Jj

13;'

n

j=l

j=J+1

An estimate of the risk is

-2 -2) L L R(J) = J ~ + P ( (3; - :~

j=l

j=J+1

+

where a+ = max{a, O} and

(21.15) (21.16)

(21.17)

21.2 Density Estimation 333
0'; To motivate this estimator, note that is an unbiased estimate of o-j and (3; - 0'; is an unbiased estimator of fJ;. We take the positive part of the latter
s: s: term since we know that fJ; cannot be negative. We now choose 1 J p to minimize R(!, 1). Here is a summary:

1. Let

Summary of Orthogonal Function Density Estimation

s: s: 2. Choose J to minimize R( J) over 1 J p = fo where R is given in
equation (21.16).

3. Let

J
!(x) = L:(3j<Pj(x). j=l

The estimator fn can be negative. If we are interested in exploring the
shape of f, this is not a problem. However, if we need our estimate to be a

probability density function, we can truncate the estimate and then normalize

10 it. That is, we take 1~* =

~
max{fn(x), O}I

·1

~

max{fn(u) , O}du.

Now let us construct a confidence band for f. Suppose we estimate fusing

J orthogonal functions. We are essentially estimating iJ(x) = 2:,f=l fJj<Pj(x)

not the true density f(x) = 2:,;:1 fJj<pj(x). Thus, the confidence band should be regarded as a band for f J (x).

21.6 Theorem. An approximate 1- a confidence band for iJ is (l'(x),u(x))

where

l'(x) = h(x) - c, u(x) = In(x) + c

(21.18)

where

(21.19)

and K = max max 1<Pj (x) I·
l~J~J x
For the cosine basis, K = .J2.
PROOF. Here is an outline of the proof. Let L = 2:,f=l((3j - fJj)2. By the
central limit theorem, (3j ~ N(fJj,o-jln). Hence, (3j ~ fJj + (JjEjlfo where

334 21. Smoothing Using Orthogonal Functions

Ej rv N(O, 1), and therefore

J

2J

2

L

R

:

;n1-

2

:

:e2J2E JJ

<

:

:K'n:-2

:

:E2 J

'd=K-nX

J2

'

j=l

j=l

Thus we have, approximately, that

Also,

IF' ( L> -Kn X 2 }'a ) <::.: IF' (K-n2X} > -Kn X 2 }'a ) = a.

J

2:: max 11J(x) - h(x)1 < max l¢j(x)1 l;3j - pjl

x

x j=l

J
< K2:: l;3j - pjl
j=l

J
< VJ K 2::(;3j - pj)2
j=l

(21.20)

where the third inequality is from the Cauchy-Schwartz inequality (Theorem

4.8). So,

( /Jif:) {/JK ) ~ IF' m;x Ih(x) - h(x)1 > K2y ---:;=-n-'

<

.II> f{'t~:a

W(JL>f{~)

IF' ( L > K2~},a )
< a. _

21.7 Example. Let

"62:: 5

15

f(x) = "6¢(x; 0, 1) +

¢(x; ILj, .1)

j=l

where ¢(x; IL, eJ) denotes a Normal density with mean IL and standard deviation eJ, and ({L1,"" {L5) = (-1, -1/2, 0, 1/2, 1). Marron and Wand (1992) call this

21.3 Regression 335

0 .0

0 .2

0 .4

0.6

0.8

1.0

FIGURE 21.3. The top plot is the true density for the Bart Simpson distribution (rescaled to have most of its mass between 0 and 1). The bottom plot is the orthogonal function density estimate and 95 percent confidence band.
"the claw" although the "Bart Simpson" might be more appropriate. Figure 21.3 shows the true density as well as the estimated density based on n = 5, 000 observations and a 95 percent confidence band. The density has been
rescaled to have most of its mass between a and 1 using the transformation y = (x + 3)/6.·

21.3 Regression

Consider the regression model

(21.21 )

a where the fi are independent with mean and variance (J"2. We will initially

focus on the special case where Xi = 'iln. We assume that r E L2 (0, 1) and

hence we can write

L 11 CXl
r(x) = Pj<Pj(x) where Pj =

r(x)<pj(x)dx

(21.22)

j=l

where <P1, <P2,'" where is an orthonormal basis for [0,1].

336 21. Smoothing Using Orthogonal Functions
Define

(21.23)

Since fij is an average, the central limit theorem tells us that fij will be approximately Normally distributed.

21.8 Theorem.

(21.24)

PROOF. The mean of fij is

IE(/3y )

where the approximate equality follows from the definition of a Riemann in-
tegral: Li {j.nh(xi) --+ Jo1 h(x)dx where {j.n = lin. The variance is

since JeP;(x)dx = 1. ·
Let

LJ
r(x) = (ijePj(x), j=l

and let

J R(J) = IE (r(x) - r(x))2 dx

be the risk of the estimator.

21.9 Theorem. The risk R(J) of the estimator rn(x) = Lf=l (ijePj(x) is

(21.25)

21.3 Regression 337

To estimate for (J2 = V (Ei) we use

n

~2
(J =

kn

~ ~

i=n-k+l

(21.26)

where k = n I 4. To motivate this estimator, recall that if f is smooth, then
fJj :::::: 0 for large j. So, for j ~ k, {3j :::::: N(O, (J2 In) and thus, {3j :::::: (JZjlfo for

for j ~ k, where Zj rv N(O, 1). Therefore,

~ t (Jj::::::~ t i=n-k+l

i=n-k+l ((fJor/jr

(J 2

k

since a sum of k Normals has a Xk distribution. Now IE(Xk) = k and hence IE(0'2):::::: (J2. Also, V(xk) = 2k and hence V(0'2):::::: ((J4Ik2)(2k) = (2(J4Ik) -+ 0

as n -+ 00. Thus we expect 0'2 to be a consistent estimator of (J2. There is
nothing special about the choice k = n I 4. Any k that increases with n at an

appropriate rate will suffice.

We estimate the risk with

-2) ~
R(J)

=

~(J2 Jn-

+

~ ~n

(

-2
fJ

-

J

(J -n

.

j=J+l

+

(21.27)

21.10 Example. Figure 21.4 shows the doppler function f and n = 2,048

observations generated from the model

Yi = r(xi) + Ei

where Xi = iln, fi rv N(O, (.1)2). The figure shows the data and the estimated
function. The estimate was based on J = 234 terms. _

We are now ready to give a complete description of the method.

1. Let

Orthogonal Series Regression Estimator

2. Let

(21.28)

338 21. Smoothing Using Orthogonal Functions

FIGURE 21.4. Data from the doppler test function and the estimated function. See Example 21.10.

where k RO n/4.

3. For 1 <::: J <::: n, compute the risk estimate

~
R(J) =

~U 2
J -n

+

'~ n"

( ~2 U~2)

fJ J

-

-n

.

j=J+1

+

4. Choose j E {I, ... n} to minimize R(J).

5. Let

LJ
T(x) = ;3j<pj(x).
j=l

Finally, we turn to confidence bands. As before, these bands are not really for the true function r(x) but rather for the smoothed version of the function
r J(x) = 2:.[=1 fJj<pj(X).

21.11 Theorem. Suppose the estimate T is based on J terms and (j is defined
as in equation (21. 28}. Assume that J < n - k + 1. An approximate 1 - a
confidence band for r J is (R, u) where

R(x) = f;,(x) - c, u(x) = Tn(X) + C,

(21.29)

where

C = a(x) f(oj XJ,a ,a(x) =

J
L <p;(x),
j=l

21.3 Regression 339

and (j is given in equation (21.28).
PROOF. Let L = "Lf=l (/3j - pj)2. By the central limit theorem, Pj ~ N(pj,CJ 2In). Hence, /3j ~ Pj +CJEjIVii where Ej rv N(O, 1) and therefore

2J

2

L

~

-Cn

J2: j=l

2E·d=C J

J-nX

J2 .

Thus,

:2 :2 ITD ( L > : X},a) = ITD ( X) > X},a) = Q.

Also,

J
If(x) - rJ(X) I < 2: l¢j(x)ll/3j - pjl j=l

J

J

< 2:¢;(x) 2:(/3j - p;)

j=l

j=l

< a(x) VI

by the Cauchy-Schwartz inequality (Theorem 4.8). So,

lTll Jr

(

max

IJJ(x)

-f(x)1

>a-XJ-,a)

x

a(x)

Vii

and the result follows. _
21.12 Example. Figure 21.5 shows the confidence envelope for the doppler signal. The first plot is based on J = 234 (the value of J that minimizes the
estimated risk). The second is based on J = 45 ~ Vii. Larger J yields a higher resolution estimator at the cost of large confidence bands. Smaller J yields a
lower resolution estimator but has tighter confidence bands. _
So far, we have assumed that the xi's are of the form {lin, 2/n, .. . ,1}. If the xi's are on interval [a, b], then we can rescale them so that are in the interval [0,1]. If the xi's are not equally spaced, the methods we have discussed still apply so long as the Xi'S "fill out" the interval [0,1] in such a way so as to not be too clumped together. If we want to treat the xi's as random instead of fixed, then the method needs significant modifications which we shall not deal with here.

340 21. Smoothing Using Orthogonal Functions

FIGURE 21.5. Estimates and confidence bands for the doppler test function using n = 2,048 observations. First plot: J = 234 terms. Second plot: J = 45 terms.

21.4 Wavelets
Suppose there is a sharp jump in a regression function f at some point x but that f is otherwise very smooth. Such a function f is said to be spa-
tially inhomogeneous. The doppler function is an example of a spatially inhomogeneous function; it is smooth for large x and unsmooth for small x.
It is hard to estimate f using the methods we have discussed so far. If we
use a cosine basis and only keep low order terms, we will miss the peak; if we allow higher order terms we will find the peak but we will make the rest of the curve very wiggly. Similar comments apply to kernel regression. If we use a large bandwidth, then we will smooth out the peak; if we use a small bandwidth, then we will find the peak but we will make the rest of the curve very wiggly.
One way to estimate inhomogeneous functions is to use a more carefully chosen basis that allows us to place a "blip" in some small region without adding wiggles elsewhere. In this section, we describe a special class of bases called wavelets, that are aimed at fixing this problem. Statistical inference using wavelets is a large and active area. We will just discuss a few of the main ideas to get a flavor of this approach.
We start with a particular wavelet called the Haar wavelet. The Haar father wavelet or Haar scaling function is defined by

~ ¢(x) = {

if 0 ~ x < 1
otherwise.

(21.30)

The mother Haar wavelet is defined by

-1 1jJ(x) = { 1

if 0 <- x <- 12-,
if~<x::;1.

For any integers j and k define

21.4 Wavelets 341 (21.31 )

(21.32)

The function 1jJj,k has the same shape as '1jJ but it has been rescaled by a factor of 2j / 2 and shifted by a factor of k.
See Figure 21.6 for some examples of Haar wavelets. Notice that for large j, 1jJj,k is a very localized function. This makes it possible to add a blip to a function in one place without adding wiggles elsewhere. Increasing j is like looking in a microscope at increasing degrees of resolution. In technical terms, we say that wavelets provide a multiresolution analysis of L 2 (0, 1).

2

2

1

1

o

o

-1

-1

-2

-2

FIGURE 21.6. Some Ham wavelets. Left: the mother wavelet 'lj;(x); Right: 'lj;2,2(X).
Let Wj = {1jJjk' k = 0,1, ... ,2j -I}
be the set of rescaled and shifted mother wavelets at resolution j. 21.13 Theorem. The set of functions

is an orthonormal basis for L 2 (0, 1).

342 21. Smoothing Using Orthogonal Functions
It follows from this theorem that we can expand any function j E L 2 (0, 1) in this basis. Because each Wj is itself a set of functions, we write the expansion as a double sum:

where

00 2:j-1

L L j(x) = a¢(x) +

(3j,k1/Jj,k(X)

j=O k=O

11 11 a = j(x)¢(x) dx, (3j,k = j(X)1/Jj,k(X) dx.

(21.33)

We call a the scaling coefficient and the (3j,k'S are called the detail coefficients. We call the finite sum

J-121-1

L L !J(x) = a¢(x) +

(3j,k1/Jj,k(X)

j=O k=O

(21.34)

the resolution J approximation to j. The total number of terms in this sum
is
LJ-l
1 + + 2j = 1 2 J - 1 = 2J.
j=O

21.14 Example. Figure 21. 7 shows the doppler signal, and its reconstruction using J = 3,5 and J = 8.·

Ham wavelets are localized, meaning that they are zero outside an interval. But they are not smooth. This raises the question of whether there exist smooth, localized wavelets that from an orthonormal basis. In 1988, Ingrid Daubechie showed that such wavelets do exist. These smooth wavelets are difficult to describe. They can be constructed numerically but there is no closed form formula for the smoother wavelets. To keep things simple, we will continue to use Haar wavelets.
Consider the regression model Yi = + r-(Xi) (Hi where Ei rv N(O,l) and
Xi = 'i/n. To simplify the discussion we assume that n = 2J for some J. There is one major difference between estimation using wavelets instead of
a cosine (or polynomial) basis. With the cosine basis, we used all the terms 1 <::: j <::: J for some J. The number of terms J acted as a smoothing parameter. With wavelets, we control smoothing using a method called thresholding where we keep a term in the function approximation if its coefficient is large,

2L4 Wavelets 343

C>

"

C>

C>

g C>

~'

"'

"'

"'

FIGURE 2L7. The doppler signal and its reconstruction
fJ(x) = a¢(x) + L:~~ Lk !3j.k7j;j.k(X) based on J = 3, J = 5, and J = 8.

otherwise, we throw out that term. There are many versions of thresholding, The simplest is called hard, universal thresholding. Let J = log2(n) and define

and

(21.35)

for 0 ~ j ~ J - 1.
Haar Wavelet Regression
a 1. Compute and Dj,k as in (21.35), for 0 ~ j ~ J - 1.
2. Estimate cr; see (21.37). 3. Apply universal thresholding:
{D (~3j,k = 0 j,k if IDj,kl > (jJ21~gn } otherwise,

(21.36)

344 21. Smoothing Using Orthogonal Functions

In practice, we do not compute Sk and Dj,k using (21.35). Instead, we use the discrete wavelet transform (DWT) which is very fast. The DWT for Haar wavelets is described in the appendix. The estimate of (J" is

_ c median (IDJ-1,kl: k = 0, ... , 2J- 1 - 1)

(J" = yn x

.

0.6745

(21.37)

The estimate for (J" may look strange. It is similar to the estimate we used for the cosine basis but it is designed to be insensitive to sharp peaks in the function.
To understand the intuition behind universal thresholding, consider what happens when there is no signal, that is, when (3j,k = 0 for all j and k.

21.15 Theorem. Suppose that (3j,k = 0 for all j and k and let (3j,k be the universal threshold estimator. Then

1P'(,6j,k = 0 for all j, k) --+ 1

as n --+ 00.

PROOF. To simplify the proof, assume that (J" is known. Now Dj,k :::::; N(O, (J"2 In). We will need Mill's inequality (Theorem 4.7): if Z ~ N(O,l)
then IP'(IZI > t) -s: (clt)e- t2j2 where c = J2/,rr is a constant. Thus,

lP'(maxIDj,kl > >-) < LIP'(IDj,kl > >-) = LIP' (Fnl~j'kl > v;>-)

j,k

j,k

{I >-yIn <

"~"-- C(Je " xp j,k

-2-n(>J-"-22 }

- C
~--+O.
y 2logn

21.16 Example. Consider Yi = r(xi) + (J"Ei where f is the doppler signal,
(J" = .1 and n = 2,048. Figure 21.8 shows the data and the estimated function

using universal thresholding. Of course, the estimate is not smooth since Haar wavelets are not smooth. Nonetheless, the estimate is quite accurate. _

21.5 Appendix 345

FIGURE 21.8. Estimate of the Doppler function using Ham wavelets and universal thresholding.
21.5 Appendix

THE DWT FOR HAAR WAVELETS. Let y be the vector ofYi's (length n) and let J = log2(n). Create a list D with elements
D[[O]J, ... , D[[J - Ill·

Set: Then do:

temp +- y /,;n.

fOT(j zn (J-1):O){ rn +- 2j I +- (1 : m)
D[[jll +- ~templ2 <11 - templ(h I) - 1]~ / v'2
temp +- temp[2 * I] + temp[(2 * 1) - 1] / h
}

346 21. Smoothing Using Orthogonal Functions
21.6 Bibliographic Rernarks
Efromovich (1999) is a reference for orthogonal function methods. See also Beran (2000) and Beran and Dumbgen (1998). An introduction to wavelets is given in Ogden (1997). A more advanced treatment can be found in HardIe et al. (1998). The theory of statistical estimation using wavelets has been developed by many authors, especially David Donoho and Ian Johnstone. See Donoho and Johnstone (1994), Donoho and Johnstone (1995), Donoho et al. (1995), and Donoho and Johnstone (1998).
21.7 Exercises
1. Prove Theorem 21.5. 2. Prove Theorem 21.9. 3. Let

Show that these vectors have norm 1 and are orthogonal.

4. Prove Parseval's relation equation (21.6).

5. Plot the first five Legendre polynomials. Verify, numerically, that they are orthonormal.

6. Expand the following functions in the cosine basis on [0, 1]. For (a) and (b), find the coefficients (3j analytically. For (c) and (d), find the coefficients {3j numerically, i.e.

r L In (3j =

1

f(x)q;j(x)

~

1
N

N

f (~) q;j (~)

o

r=l

for some large integer N. Then plot the partial sum "L-]=l (3jq;j(x) for
increasing values of n.

(a) f(x) = V2cos(37fx).

(b) f(x) = sin(7fx).
(c) f(x) = "L-~~l hjK(x-tj ) where K(t) = (1+sign(t))/2, sign(x) = -1
if x < 0, sign(x) = 0 if x = 0, sign(x) = 1 if x> 0,

21.7 Exercises 347
(tj) = (.1, .13, .15, .23, .25, .40, .44, .65, .76, .78, .81),
(hj ) = (4, -5,3, -4,5, -4.2,2.1,4.3, -3.1,2.1, -4.2).
(d) f = jx(1 - x) sin Cx2+1~5)) .
7. Consider the glass fragments data from the book's website. Let Y be refractive index and let X be aluminum content (the fourth variable).
(a) Do a nonparametric regression to fit the model Y = f (x) + E using
the cosine basis method. The data are not on a regular grid. Ignore this when estimating the function. (But do sort the data first according to x.) Provide a function estimate, an estimate of the risk, and a confidence band. (b) Use the wavelet method to estimate f.
8. Show that the Haar wavelets are orthonormal.
9. Consider again the doppler signal:
f(x) = jx(1 - x) sin ( x +2.l07.r05 ).
Let 17, = 1,024, (J" = 0.1, and let (Xl' ... ' X n ) = (1/17" ... ,1). Generate data

where Ei rv N(O, 1).
(a) Fit the curve using the cosine basis method. Plot the function estimate and confidence band for J = 10,20, ... ,100.

(b) Use Haar wavelets to fit the curve.

10. (Haar density Estimation.) Let Xl, ... , Xn rv f for some density f on
[0,1]. Let's consider constructing a wavelet histogram. Let ¢ and 1/J be the Haar father and mother wavelet. Write

J-12:1-1

L L f(x) ~ ¢(x) +

pj,k1/Jj,k(X)

j=O k=O

where J ~ log2(n). Let

_

1n

P), k = -n~ "")1' /J k(Xd·

i=l

348 21. Smoothing Using Orthogonal Functions

(a) Show that (ij,k is an unbiased estimate of pj,k. (b) Define the Haar histogram

B 2j-l

L L J(x) = ¢(x) +

(ij,ktPj,k(X)

j=O k=O

for 0 ::.; B ::.; J - 1.

(c) Find an approximate expression for the MSE as a function of B.

(d) Generate n = 1,000 observations from a Beta (15,4) density. Estimate the density using the Haar histogram. Use leave-one-out cross validation to choose B.

11. In this question, we will explore the motivation for equation (21.37). Let Xl, .. . , Xn rv N(O, 0"2). Let
Ci = vIri x median (IXll,···, IXnl) .
0.6745

(a) Show that lE(Ci) = 0".
(b) Simulate n = 100 observations from a N(O,l) distribution. Compute Ci as well as the usual estimate of 0". Repeat 1,000 times and compare the MSE.
(c) Repeat (b) but add some outliers to the data. To do this, simulate each observation from a N(O,l) with probability .95 and simulate each observation from a N(0,10) with probability .95.

12. Repeat question 6 using the Haar basis.

22
Classification

22.1 Introduction

The problem of predicting a discrete random variable Y from another random variable X is called classification, supervised learning, discrimination, or pattern recognition.
Consider lID data (Xl, Yd, ... ,(Xn , Yn ) where

Xi = (XiI, ... , Xid) EX c ]Rd

is a d-dimensional vector and Yi takes values in some finite set y. A classifi-
cation rule is a function h : X --+ y. When we observe a new X, we predict
Y to be h(X).

22.1 Example. Here is a an example with fake data. Figure 22.1 shows 100 data points. The covariate X = (Xl, X 2 ) is 2-dimensional and the outcome
Y E Y = {O, I}. The Y values are indicated on the plot with the triangles
representing Y = 1 and the squares representing Y = O. Also shown is a linear classification rule represented by the solid line. This is a rule of the form

~ h(x) = {

+ + if a blXI b2X2 > 0
otherwise.

Everything above the line is classified as a 0 and everything below the line is classified as a 1. ·

350

22. Classification

...... ......

D

l:,.

......... ...................

D

D D

...... ...... ...... ..................

0

0

FIGURE 22.1. Two covariates and a linear decision boundary. D means Y = 1.
D means Y = O. These two groups are perfectly separated by the linear decision boundary; you probably won't see real data like this.

22.2 Example. Recall the the Coronary Risk-Factor Study (CORIS) data from Example 13.17. There are 462 males between the ages of 15 and 64 from three rural areas in South Africa. The outcome Y is the presence (Y = 1) or absence (Y = 0) of coronary heart disease and there are 9 covariates: systolic blood pressure, cumulative tobacco (kg), ldl (low density lipoprotein cholesterol), adiposity, famhist (family history of heart disease), typea (type-A behavior), obesity, alcohol (current alcohol consumption), and age. I computed a linear decision boundary using the LDA method based on two of the covariates, systolic blood pressure and tobacco consumption. The LDA method will be explained shortly. In this example, the groups are hard to tell apart. In fact, 141 of the 462 subjects are misclassified using this classification rule.
·

At this point, it is worth revisiting the Statistics/Data Mining dictionary:

Statistics classification data covariates classifier estimation

Computer Science supervised learning training sample features hypothesis learning

Meaning
predicting a discrete Y from X
(Xl, Yd,···, (Xn' Yn ) the Xi's
map h: X --+ y
finding a good classifier

22.2 Error Rates and the Bayes Classifier
Our goal is to find a classification rule h that makes accurate predictions. We start with the following definitions:

22.2 Error Rates and the Bayes Classifier 351

22.3 Definition. The true error ratelof a classifier h is

L(h) = J1D( {h(X) cJ Y})

and the empirical error rate or training error rate is

L _

1n

Ln(h) = - I(h(Xd cJ Yi).

n

i=l

(22.1) (22.2)

First we consider the special case where Y = {O, I}. Let

r(x) = lE(YIX = x) = J1D(Y = 11X = x)

denote the regression function. From Bayes' theorem we have that

r(x) where

J1D(Y = 11X = x)
f(xlY = l)JID(Y = 1)
f(xlY = l)JID(Y = 1) + f(xlY = O)JID(Y = 0)
1fh(x)
1fh(x) + (1 -1f)fo(x)

(22.3)

fo(x) h(x)
1f

f(xlY = 0) f(xlY = 1) J1D(Y = 1).

22.4 Definition. The Bayes classification rule h* is

{I ! h*(x) =

o

if r(x).> otherwIse.

(22.4)

The set D(h) = {x: J1D(Y = 11X = x) = J1D(Y = 0IX = x)} is called the decision boundary.

Warning! The Bayes rule has nothing to do with Bayesian inference. We could estimate the Bayes rule using either frequentist or Bayesian methods.
The Bayes rule may be written in several equivalent forms:

lOne can use other loss functions. For simplicity we will use the error rate as our loss function.

352 22. Classification

{I h*(x) =

if W(Y .= ll X = x) > W(Y = 0IX = x)

o otherWIse

(22.5)

and

{I (1 - h*(x) =

if 1fh(~) >

1f)fo(x)

o otherwIse.

(22.6)

22.5 Theorem. The Bayes rule is optimal, that is, if h is any other classification rule then L(h*) ~ L(h).

The Bayes rule depends on unknown quantities so we need to use the data to find some approximation to the Bayes rule. At the risk of oversimplifying, there are three main approaches:

1. Empirical Risk Minimization. Choose a set of classifiers H and find h E H

that minimizes some estimate of L(h).

r 2. Regression. Find an estimate of the regression function r and define

{I h( ) _

if r( x) > ~

. x - 0 otherwise.

3. Density Estimation. Estimate fa from the X/s for which Yi = 0, estimate h from the Xi'S for which Yi = 1 and let 7r = n- 1 L~=l Yi. Define

r~(x) =~W( Y=II X=)x =

+ ~ 7rh(x) ~
7rh(x) (1-7r)fo(x)

and

{I .> h(x) =

o

if r(x) ~
otherwIse.

Now let us generalize to the case where Y takes on more than two values as follows.

22.6 Theorem. Suppose that Y E Y = {I, ... , K}. The optimal rule is

h(x)

argmaxkW(Y = klX = x)

argmaxk1fk fk(X)

(22.7) (22.8)

where

W(Y = klX = x) = fdx) 1fk · LT fT(X)1fT

(22.9)

1fr = P(Y = r), fT(X) = f(xlY = r) and argmaxk means lithe value of k
that maximizes that expression. "

22.3 Gaussian and Linear Classifiers 353
22.3 Gaussian and Linear Classifiers

Perhaps the simplest approach to classification is to use the density estimation strategy and assume a parametric model for the densities. Suppose that
y = {O, I} and that fo(x) = f(xlY = 0) and h(x) = f(xlY = 1) are both
multivariate Gaussians:
fk(X) = (27T)d/;I~kll/2 exp { -~(x - J.Lkf~kl(X - J.Lk)} , k = 0, l.

Thus, XIY = 0 rv N(J.Lo, ~o) and XIY = 1 rv N(J.Ll' ~I).

22.7 Theorem. If XIY = 0 rv N(/LO, ~o) and XIY = 1 rv N(J.Ll' ~I), then the
Bayes rule is

h*(x) = { I

if

r2
1

<

r2
0

+

2 log

(77rrol)

+ 10O" b

(1~L;,1)

o otherwise

(22.10)

where

(22.11)

is the Manalahobis distance. An equivalent way of expressing the Bayes' rule is

where

(22.12)

and IAI denotes the determinant of a matrix A.

The decision boundary of the above classifier is quadratic so this procedure is called quadratic discriminant analysis (QDA). In practice, we use sample estimates of 7T, J.Ll, J.L2, ~o, ~l in place of the true value, namely:

1n

1n

- 2:)1- Ii), 1Tl = - LIi

n

n

i=l

i=l

J.Lo

So

354 22. Classification

A simplification occurs if we assume that ~o = ~o = ~. In that case, the
Bayes rule is (22.13)

where now

5k (x) = xT~-I/Lk - 21/Lr~-1 + 10g7fk.

(22.14)

The parameters are estimated as before, except that the MLE of ~ is

S = noSo + nISI. no + nl

The classification rule is

~ h*(x) = {

if 51 (x) > 50 (x)
otherwise

(22.15)

where

Us: j(X)

TS-l~

=X

IL

j

-21/L~jTS-l~{L

j

+

o1 g

7~f

j

is called the discriminant function. The decision boundary {x: 50 (x) = 51 (x)} is linear so this method is called linear discrimination analysis (LDA).

22.8 Example. Let us return to the South African heart disease data. The decision rule in in Example 22.2 was obtained by linear discrimination. The

outcome was

classified as 0 classified as 1

y=o 277

25

y=l 116

44

The observed misclassification rate is 141/462 = .31. Including all the covariates reduces the error rate to .27. The results from quadratic discrimination

are

classified as 0 classified as 1

y = 0 272

30

y = 1 113

47

which has about the same error rate 143/462 = .31. Including all the covariates reduces the error rate to .26. In this example, there is little advantage to QDA over LDA.·

Now we generalize to the case where Y takes on more than two values.

22.3 Gaussian and Linear Classifiers 355
22.9 Theorem. Suppose that Y E {I, ... , K}. If fk(x) = f(xlY = k) is Gaussian, the Bayes rule is

where If the variances of the Gaussians are equal, then

(22.16) (22.17)

We estimate 5dx) by by inserting estimates of /Lk, 2'.k and Irk. There is
another version of linear discriminant analysis due to Fisher. The idea is to first reduce the dimension of covariates to one dimension by projecting the data onto a line. Algebraically, this means replacing the covariate X = (Xl, ... , Xd) with a linear combination U = wT X = L~=l WjXj . The goal is
to choose the vector w = (WI, ... ,Wd) that "best separates the data." Then we perform classification with the one-dimensional covariate Z instead of X.
We need define what we mean by separation of the groups. We would like the two groups to have means that are far apart relative to their spread. Let ILj denote the mean of X for Yj and let 2'. be the variance matrix of X. Then lE(UIY = j) = lE(wT XIY = j) = WTILj and V(U) = u72'.w. 2 Define the separation by

J(w)

(lE(UIY = 0) -lE(UIY = 1))2
wT 2'.w
(w T /Lo - wT /Ld 2
wT 2'.w
WT(/LO - /Ll)(/LO - /Llfw w T 2'.w

We estimate J as follows. Let nj = L~=l I(Yi = j) be the number of observations in group j, let Xj be the sample mean vector of the X's for group j, and let Sj be the sample covariance matrix in group j. Define

(22.18)

2The quantity J arises in physics, where it is called the Rayleigh coefficient.

356 22. Classification

where

-

-

-

-T

(XO - Xd(Xo - Xl)

(no - l)So + (n1 - l)Sl

Sw

(no - 1) + (n1 - 1)

22.10 Theorem. The vector

-1- -
W = Sw (Xo - Xd

is a minimizer of J(w). We call

U = W T X = (-Xo - -Xd T Sw-1 X

(22.19) (22.20)

the Fisher linear discriminant function. The midpoint m between X 0 and

Xl is

1- -

1-

- T -1 -

-

m="2(Xo+Xd="2(Xo-Xd SE (X O+X1)

(22.21 )

Fisher's classification rule is

~ h(x) = {

if wT X ~ m
if wT X < m.

Fisher's rule is the same as the Bayes linear classifier in equation (22.14) when 1i' = 1/2.

22.4 Linear Regression and Logistic Regression

A more direct approach to classification is to estimate the regression function

r(x) = JE(YIX = x) without bothering to estimate the densities fk. For the rest of this section, we will only consider the case where Y = {O, I}. Thus,

r(x) = JP'(Y = 11X = x) and once we have an estimate P, we will use the

classification rule

{I .> ! h(x) =

o

if P(x) otherwIse.

(22.22)

The simplest regression model is the linear regression model

Ld
Y = r(x) + e = {30 + (3jXj + e
j=l

(22.23)

where JE(e) = O. This model can't be correct since it does not force Y = 0 or 1. Nonetheless, it can sometimes lead to a decent classifier.

22.4 Linear Regression and Logistic Regression 357
Recall that the least squares estimate of 13 = (130,131, ... lf3d)T minimizes
the residual sums of squares
Let X denote the N x (d + 1) matrix of the form
X=

RSS(f3) = (Y - xf3f (Y - Xf3) and the model can be written as

where E = (Ell ... ' En)T. From Theorem 13.13,

The predicted values are

Y = Xf3.

Now we use (22.22) to classify, where r(x) = lio + L:j lijxj.
An alternative is to use logistic regression which was also discussed in Chap-

ter 13. The model is

(22.24)

and the MLE 13 is obtained numerically.

22.11 Example. Let us return to the heart disease data. The MLE is given in Example 13.17. The error rate, using this model for classification, is .27. The error rate from a linear regression is .26.

We can get a better classifier by fitting a richer model. For example, we

could fit

L L logit JP'(Y = 11X = x) = 130 + f3jXj + f3jk Xj Xk.

j

j,k

(22.25)

358 22. Classification
More generally, we could add terms of up to order T for some integer T. Large values of T give a more complicated model which should fit the data better. But there is a bias-variance tradeoff which we'll discuss later.
22.12 Example. If we use model (22.25) for the heart disease data with T = 2, the error rate is reduced to .22.·

22.5 Relationship Between Logistic Regression and LDA

LDA and logistic regression are almost the same thing. If we assume that each

group is Gaussian with the same covariance matrix, then we saw earlier that

x)) loO"
b

( IP'(Y IP'(Y

= =

llX = 0IX =

x)

log ( 7To) - ~(/LO + /Llf2:,-l(/Ll -/Lo)
7T1 2
+ xT 2:,-1 (/L1 - /Lo)
ao + aTx.

On the other hand, the logistic model is, by assumption,

x)) log

(

IP'(Y IP'(Y

= =

llX 0IX

= =

x)

=

/30

+

T
/3

x.

These are the same model since they both lead to classification rules that are

linear in x. The difference is in how we estimate the parameters. The joint density of a single observation is f(x, y) = f(xly)f(y) = f(ylx)f(x).

In LDA we estimated the whole joint distribution by maximizing the likeli-

hood

(22.26)

i

i

'"-v----'''-v--'

Gaussian Bernoulli

ITi In logistic regression we maximized the conditional likelihood f(Yi IXi) but

we ignored the second term f(Xi):

(22.27)

logistic

ignored

Since classification only requires knowing f(ylx), we don't really need to estimate the whole joint distribution. Logistic regression leaves the marginal

22.6 Density Estimation and Naive Bayes 359
distribution f(x) unspecified so it is more nonparametric than LDA. This is an advantage of the logistic regression approach over LDA.
To summarize: LDA and logistic regression both lead to a linear classification rule. In LDA we estimate the entire joint distribution f(x, y) = f(xly)f(y). In logistic regression we only estimate f(ylx) and we don't bother estimating f(x).

22.6 Density Estirnation and Naive Bayes

The Bayes rule is h(x) = argmaxk Irk fk (x). If we can estimate Irk and fk then we can estimate the Bayes classification rule. Estimating Irk is easy but what about fk? We did this previously by assuming fk was Gaussian. Another strategy is to estimate fk with some nonparametric density estimator
h such as a kernel estimator. But if x = (Xl, ... , Xd) is high-dimensional,
nonparametric density estimation is not very reliable. This problem is ameliorated if we assume that Xl, ... ,Xd are independent, for then, ik (Xl, ... ,Xd) =
n;=l fkj (Xj). This reduces the problem to d one-dimensional density estima-
tion problems, within each of the k groups. The resulting classifier is called the naive Bayes classifier. The assumption that the components of X are
independent is usually wrong yet the resulting classifier might still be accurate. Here is a summary of the steps in the naive Bayes classifier:

The Naive Bayes Classifier

1. For each group k, compute an estimate fkj of the density ikj for X j , using the data for which Y; = k.

2. Let

d
Ij=Il h(x) = h(Xl,"" Xd) = hj(xj).

3. Let

where I(Y; = k) = 1 if Y; = k and I(Y; = k) = 0 if Y; cJ k.
4. Let

360

22. Classification

Age

Blood Pressure

1

o

1

FIGURE 22.2. A simple classification tree.
The naive Bayes classifier is popular when x is high-dimensional and discrete. In that case, hj (xj) is especially simple.

22.7 Trees

Trees are classification methods that partition the covariate space X into

disjoint pieces and then classify the observations according to which partition

element they fall in. As the name implies, the classifier can be represented as

a tree.

For illustration, suppose there are two covariates, Xl = age and X 2 = blood

pressure. Figure 22.2 shows a classification tree using these variables.

The tree is used in the following way. If a subject has Age::::' 50 then we
classify him as Y = 1. If a subject has Age < 50 then we check his blood pressure. If systolic blood pressure is < 100 then we classify him as Y = 1,

otherwise we classify him as Y = O. Figure 22.3 shows the same classifier as

a partition of the covariate space.

Here is how a tree is constructed. First, suppose that y E Y = {O, I} and

that there is only a single covariate X. We choose a split point t that divides

the real line into two sets Al = (-00, tj and A2 = (t, (0). Let Ps(j) be the

proportion of observations in As such that Yi = j:

~ ( .) L~=l I(Yi = j, Xi E As) Ps J = L~=l I(Xi E As)

(22.28)

for s = 1,2 and j = 0,1. The impurity of the split t is defined to be

L2
I(t) = /S
8=1

(22.29)

22.7 Trees 361

.(.j.).

;:j ifl

llO

if]

.(.j.).

p...,

"d 0 0
P:i

1
1 0

50 Age
FIGURE 22.3. Partition representation of classification tree.

where

1
IS = 1 - LPs(j)2.
j=O

(22.30)

This particular measure of impurity is known as the Gini index. If a partition
element As contains all O's or all l's, then IS = O. Otherwise, IS > O. We
choose the split point t to minimize the impurity. (Other indices of impurity besides can be used besides the Gini index.)
When there are several covariates, we choose whichever covariate and split that leads to the lowest impurity. This process is continued until some stopping criterion is met. For example, we might stop when every partition element has fewer than no data points, where no is some fixed number. The bottom nodes of the tree are called the leaves. Each leaf is assigned a 0 or 1 depending on whether there are more data points with Y = 0 or Y = 1 in that partition element.
This procedure is easily generalized to the case where Y E {I, ... ,K}. We
simply define the impurity by

k
IS = 1 - LPs(j)2
j=l

(22.31 )

where Pi(j) is the proportion of observations in the partition element for which Y=j.

362

22. Classification

age

< 31.5
I
tobacco

II

< 0.51
I

20.51
I

0

0

231.5
I
age

I

< 50.5

250.5

I

I
tobacco

I 0 I

< 7.47

27.47

II

0

1

FIGURE 22.4. A classification tree for the heart disease data using two covariates.

22.13 Example. A classification tree for the heart disease data yields a misclassification rate of .21. If we build a tree using only tobacco and age, the misclassification rate is then .29. The tree is shown in Figure 22.4.·
Our description of how to build trees is incomplete. If we keep splitting until there are few cases in each leaf of the tree, we are likely to overfit the data. We should choose the complexity of the tree in such a way that the estimated true error rate is low. In the next section, we discuss estimation of the error rate.

22.8 Assessing Error Rates and Choosing a Good Classifier
How do we choose a good classifier? We would like to have a classifier h with a low true error rate L(h). Usually, we can't use the training error rate Ln(h) as an estimate of the true error rate because it is biased downward.
22.14 Example. Consider the heart disease data again. Suppose we fit a sequence of logistic regression models. In the first model we include one covariate. In the second model we include two covariates, and so on. The ninth model includes all the covariates. We can go even further. Let's also fit a tenth model that includes all nine covariates plus the first covariate squared. Then

22.8 Assessing Error Rates and Choosing a Good Classifier 363
we fit an eleventh model that includes all nine covariates plus the first covariate squared and the second covariate squared. Continuing this way we will get a sequence of 18 classifiers of increasing complexity. The solid line in Figure 22.5 shows the observed classification error which steadily decreases as we make the model more complex. If we keep going, we can make a model with zero observed classification error. The dotted line shows the lO-fold crossvalidation estimate of the error rate (to be explained shortly) which is a better estimate of the true error rate than the observed classification error. The estimated error decreases for a while then increases. This is essentially the bias-variance tradeoff phenomenon we have seen in Chapter 20.·

error rate 0.34 0.30 0.26

,,,,,,,,-------

--

-

-,

'

\
\

\

,.

,

.......

-,,'

5 number of terms in model 15
FIGURE 22.5. The solid line is the observed error rate and dashed line IS the cross-validation estimate of true error rate.

There are many ways to estimate the error rate. We'll consider two: crossvalidation and probability inequalities.
CROSS- VALIDATION. The basic idea of cross-validation, which we have already encountered in curve estimation, is to leave out some of the data when fitting a model. The simplest version of cross-validation involves randomly
splitting the data into two pieces: the training set T and the validation
set V. Often, about 10 per cent ofthe data might be set aside as the validation set. The classifier h is constructed from the training set. We then estimate

364 22. Classification

Training Data T

Validation Data V

~'----------------~V~----------------~A,------~V~------~~

h

L

FIGURE 22.6. Cross-validation. The data are divided into two groups: the training data andJ;he valid~tion data. The training data are used to produce an eSEmated classifier h. 'l}len, h is applied to the validation data to obtain an estimate L of the error rate of h.

the error by

~
L(h) =

1 -

" ~ ,

I(h(Xi)

i-

Y1 ).

m

XiEV

(22.32)

where m is the size of the validation set. See Figure 22.6. Another approach to cross-validation is K-fold cross-validation which is
obtained from the following algorithm.

K-fold cross-validation.

1. Randomly divide the data into K chunks of approximately equal size. A common choice is K = 10.

2. For k = 1 to K, do the following:

(a) Delete chunk k from the data.

(b) Compute the classifier hCk) from the rest of the data.

~

~

(c) Use hCk) to the predict the data in chunk k. Let LCk) denote

the observed error rate.

3. Let

(22.33)

22.15 Example. We applied 10-fold cross-validation to the heart disease data. The minimum cross-validation error as a function of the number of leaves occurred at six. Figure 22.7 shows the tree with six leaves. _

22.8 Assessing Error Rates and Choosing a Good Classifier 365

age

I

< 31.5

~ 31.5

I

age

o

< 50.5

~ 50.5

I

I

type A

family history

I1 I I

< 68.5

~ 68.5

no

yes

I
o

I r lI tobacco 1

I
1

< 7.605

~ 7.605

II

o

1

FIGURE 22.7. Smaller classification tree with size chosen by cross-validation.

PROBABILITY INEQUALITIES. Another approach to estimating the error rate
is to find a confidence interval for Ln (h) using probability inequalities. This method is useful in the context of empirical risk minimization.
Let H be a set of classifiers, for example, all linear classifiers. Empirical risk minimization means choosing the classifier h E H to minimize the training error Ln(h), also called the empirical risk. Thus,
h = argminhE1iLn(h) = argminhE1i (~~I(h(Xi) -=l-li)) . (22.34)

Typically, Ln(h) underestimates the true error rate L(h) because hwas chosen
to make Ln (h) small. Our goal is to assess how much underestimation is taking place. Our main tool for this analysis is Hoeffding's inequality (Theorem
4.5). Recall that if Xl"'" Xn rv Bernoulli(p), then, for any E > 0,

wh e

r'

e~p--

n

-

l

,

\, L.

n ..i=l

X

i·

(22.35)

366 22. Classification
First, suppose that 1-l = {hI! ... ' hm } consists of finitely many classifiers. For any fixed h, Ln(h) converges in almost surely to L(h) by the law of large numbers. We will now establish a stronger result.
22.16 Theorem (Uniform Convergence). Assume 1-l is finite and has m elements. Then,

PROOF. We will use Hoeffding's inequality and we will also use the fact
that if AI! ... ' Am is a set of events then JID(U:l Ai) ~ 2..::1 JID(Ai). Now,

f) JID (max ILn(h) - L(h) I > hOi

(U f) JID

ILn(h) - L(h)1 >

hE1i

L f) <

JID (ILn(h) - L(h)1 >

HE1i

2e- 2me- < L

2nE2 =

2nE2 . ·

HE1i

22.17 Theorem. Let

(2m) f= ;2: log -;- .

Then Ln (Ft) ± f is a 1 - a confidence interval for L(h).

PROOF. This follows from the fact that

When 1-l is large the confidence interval for L(h) is large. The more functions
there are in 1-l the more likely it is we have "overfit" which we compensate

for by having a larger confidence interval. In practice we usually use sets 1-l that are infinite, such as the set of linear

classifiers. To extend our analysis to these cases we want to be able to say

something like

f) ~ JID (sup ILn(h) - L(h)1 >

something not too big.

hOi

One way to develop such a generalization is by way of the Vapnik-Chervonenkis or VC dimension.

22.8 Assessing Error Rates and Choosing a Good Classifier 367

Let A be a class of sets. Give a finite set F = {Xl, ... ,xn } let
n A} N A (F) = # {F A: A E

(22.36)

be the number of subsets of F "picked out" by .A. Here #(B) denotes the number of elements of a set B. The shatter coefficient is defined by

(22.37)

where Fn consists of all finite sets of size n. Now let Xl"'" Xn ""' JPl and let
L JPln(A) = -1 I(Xi E A) n. 2 denote the empirical probability measure. The following remarkable theorem bounds the distance between JPl and JPln'

22.18 Theorem (Vapnik and Chervonenkis (1971)). For any JPl, nand E > 0,

E} : .; /32. JPl {sup IJPln(A) - JPl(A) I >

8s(A, n)e- m2

AEA

(22.38)

The proof, though very elegant, is long and we omit it. If 1i is a set of

classifiers, define A to be the class of sets of the form {x: h(x) = I}. We

then define s(1i, n) = s(A, n).

22.19 Theorem.

E} : .; JPl {sup ILn(h) - L(h)1 >

8s(1i, n)e-nE2/32.

hOi

A 1 - Q confidence interval for L(li) is Ln (li) ± En where

E2n

_-

3

2 n

1 og

(8s(1i,n))
Q

.

These theorems are only useful if the shatter coefficients do not grow too quickly with n. This is where VC dimension enters.

22.20 Definition. The VC (Vapnik-Chervonenkis) dimension of a class of sets A is defined as follows. If s(A, n) = 2n for all n, set VC(A) = 00. Otherwise, define VC(A) to be the largest k for which s(A,n) = 2k.

Thus, the VC-dimension is the size of the largest finite set F that can be shattered by A meaning that A picks out each subset of F. If 1i is a set of classifiers we define VC(1i) = VC(A) where A is the class of sets of the form {x: h (x) = I} as h varies in 1i. The following theorem shows that if A has finite VC-dimension, then the shatter coefficients grow as a polynomial in n.

368 22. Classification 22.21 Theorem. If A has finite VC-dimension v, then
s(A, n) -<; nV + 1.

22.22 Example. Let A = {( -00, a]; a E R}. The A shatters every I-point set {x} but it shatters no set of the form {x, y}. Therefore, VC(A) = 1. ·

22.23 Example. Let A be the set of closed intervals on the real line. Then A shatters S = {x, y} but it cannot shatter sets with 3 points. Consider S = {x, y, z} where x < y < z. One cannot find an interval A such that AnS = {x,z}. So, VC(A) = 2.·

22.24 Example. Let A be all linear half-spaces on the plane. Any 3-point
set (not all on a line) can be shattered. No 4 point set can be shattered.
Consider, for example, 4 points forming a diamond. Let T be the left and rightmost points. This can't be picked out. Other configurations can also be seen to be unshatterable. So VC(A) = 3. In general, halfspaces in Rd have
VC dimension d + 1.·

22.25 Example. Let A be all rectangles on the plane with sides parallel to the axes. Any 4 point set can be shattered. Let S be a 5 point set. There is
one point that is not leftmost, rightmost, uppermost, or lowermost. Let T be all points in S except this point. Then T can't be picked out. So VC(A) = 4.
·
22.26 Theorem. Let x have dimension d and let 1{ be th set of linear classi-
fiers. The VC-dimension of 1{ is d + 1. Hence, a 1 - a confidence interval for the true error rate is L(i;,) ± E where

2_ En -

32 log (8(nd+ 1 + 1)) .

n

a

22.9 Support Vector Machines
In this section we consider a class of linear classifiers called support vector machines. Throughout this section, we assume that Y is binary. It will be
convenient to label the outcomes as -1 and +1 instead of 0 and 1. A linear
classifier can then be written as
h(x) = sign ( H(X))

22.9 Support Vector Machines 369

where x = (Xl' ... ' Xd),

Ld
H(x) = ao + aiXi
i=l

and
~ -1 if z < 0
eign(z) { o ifz=O
1 if z > O.

First, suppose that the data are linearly separable, that is, there exists a hyperplane that perfectly separates the two classes.

22.27 Lemma. The data can be separated by some hyperplane if and only if
there exists a hyperplane H(x) = ao + L~=l aixi such that

YiH(Xi) ~ l , i = 1, ... ,n.

(22.39)

PROOF. Suppose the data can be separated by a hyperplane W(x) = bo +
L~=l bixi. It follows that there exists some constant c such that Yi = 1 implies W(X;) ~ c and Yi = -1 implies W(X;) ::.; -c. Therefore, YiW(Xi ) ~ c for all i. Let H(x) = ao + L~=l aixi where aj = bj/c. Then YiH(Xi) ~ 1 for all i. The reverse direction is straightforward.·
In the separable case, there will be many separating hyperplanes. How should we choose one? Intuitively, it seems reasonable to choose the hyperplane "furthest" from the data in the sense that it separates the +ls and -Is
and maximizes the distance to the closest point. This hyperplane is called the
maximum margin hyperplane. The margin is the distance to from the hyperplane to the nearest point. Points on the boundary of the margin are called support vectors. See Figure 22.8.

22.28 Theorem. The hyperplane H(x) = ao + L~=1 aiXi that separates the
data and maximizes the margin is given by minimizing (1/2) L~=1 a; subject
to (22.39).

It turns out that this problem can be recast as a quadratic programming
xT problem. Let (Xi, X k ) = X k denote the inner product of Xi and X k .
22.29 Theorem. Let H(x) = ao + L~=1 aiXi denote the optimal (largest mar-
gin) hyperplane. Then, for j = 1, ... , d,
Ln
aj = aiYiXj(i)
i=1

370

... ..·.... 22. Classification

o o

o

...·.

'.

.......

.... ~

·

· ·
··

·

...··............... · e.

.0. .·......
...

H(X)=ao+aTx=O~

FIGURE 22.8. The hyperplane H(x) has the largest margin of all hyperplanes that
separate the two classes.

a where Xj (i) is the value of the covariate Xj for the ith data point, and =
(a1) ... )an) is the vector that maximizes

(22.40)

subject to

and

ao The points Xi for which a i=- 0 are called support vectors. can be found
by solving

for any support point Xi. H may be written as
Ln
H(x) = ao + aiYi(X, Xi!.
i=l
There are many software packages that will solve this problem quickly. If there is no perfect linear classifier, then one allows overlap between the groups

22.10 Kernelization 371
by replacing the condition (22.39) with
(22.41 )
The variables ~l' ... ' ~n are called slack variables. We now maximize (22.40) subject to
o ~ ~i ~ C, 'i = 1, ... , n
and
n
Lctili = O.
i=l
The constant c is a tuning parameter that controls the amount of overlap.
22.10 Kernelization
There is a trick called kernelization for improving a computationally simple classifier h. The idea is to map the covariate X - which takes values in X into a higher dimensional space Z and apply the classifier in the bigger space Z. This can yield a more flexible classifier while retaining computationally simplicity.
The standard example of this idea is illustrated in Figure 22.9. The covariate x = (Xl, X2). The lis can be separated into two groups using an ellipse. Define a mapping ¢ by
Thus, ¢ maps X = ]R2 into Z = ]R3. In the higher-dimensional space Z, the li's are separable by a linear decision boundary. In other words,
a linear classifier in a higher-dimensional space corresponds to a nonlinear classifier in the original space.
The point is that to get a richer set of classifiers we do not need to give up the convenience of linear classifiers. We simply map the covariates to a higherdimensional space. This is akin to making linear regression more flexible by using polynomials.
There is a potential drawback. If we significantly expand the dimension of the problem, we might increase the computational burden. For example, if X has dimension d = 256 and we wanted to use all fourth-order terms, then z = ¢(x) has dimension 183,181,376. We are spared this computational

372

22. Classification

.T2

-------- ~

+

+

dJ

Z2

+

++ +

+

+
Xl

++

+
+ +
++

+ ++

°

+

06'

Z,

°

;.: Z:l

FIGURE 22.9. Kernelization. Mapping the covariates into a higher-dimensional space can make a complicated decision boundary into a simpler decision boundary.

nightmare by the following two facts. First, many classifiers do not require that we know the values of the individual points but, rather, just the inner product between pairs of points. Second, notice in our example that the inner product in Z can be written

(z, Z;

(¢(x), ¢(x))

xixi + 2XIXIX2X2 + x~x~

((X,X))2 == K(x,x).

z; Thus, we can compute (z, without ever computing Zi = ¢(Xi).
To summarize, kernelization involves finding a mapping ¢ : X -+ Z and a
classifier such that:

1. Z has higher dimension than X and so leads a richer set of classifiers.

2. The classifier only requires computing inner products.

3. There is a function K, called a kernel, such that (¢(x), ¢(x)) = K(x, x).

4. Everywhere the term (x, x) appears in the algorithm, replace it with K(x,x).

22.10 Kernelization 373

In fact, we never need to construct the mapping ¢ at all. We only need to specify a kernel K (x, x) that corresponds to (¢(x), ¢(x)) for some ¢. This raises an interesting question: given a function of two variables K(x, y), does there exist a function ¢(x) such that K(x,y) = (¢(x),¢(y))? The answer is provided by Mercer's theorem which says, roughly, that if K is positive
definite - meaning that
JJK(x, y)f(x)f(y)dxdy ~ 0

for square integrable functions f - then such a ¢ exists. Examples of com-
monly used kernels are:

polynomial sigmoid
Gaussian

K(x, x) K (x, x) K(x, x)

((x, x) +ar
tanh(a(x, x) + b)
exp ( -llx - xl1 2 /(20"2))

Let us now see how we can use this trick in LDA and in support vector machines.
Recall that the Fisher linear discriminant method replaces X with U = w T X where w is chosen to maximize the Rayleigh coefficient

J(w) = u75B w wT5ww'
5B = (-Xo - -X1)(-X o - -XI) T

and

5w = ( (no - 1)50 ) + ( (n1 - 1)51 )

(no - 1) + (nl - 1)

(no - 1) + (nl - 1) .

In the kernelized version, we replace Xi with Zi = ¢(Xi ) and we find w to maximize

(22.42)

where

and

5w=

(

(no

(no-1)So
- 1) + (n1

-

) 1)

( (n1-1)Sl
+ (no - 1) + (n1 -

) 1)

.

Here, 5 j is the sample of covariance of the Z/s for which Y = j. However, to take advantage of kernelization, we need to re-express this in terms of inner products and then replace the inner products with kernels.

374 22. Classification

It can be shown that the maximizing vector w is a linear combination of the Zi'S. Hence we can write

n
W = LaiZi. i=1

Also, Therefore,

_

1n

Zj = -n'~" ¢(Xi)1(Y; = j).
J i=1

-:;; L L 1 n n ai 1(Y8 = j)ZT ¢(Xs)

J i=1 8=1

-:;; L L 1 n

n

ai 1(Y8 = j)¢(Xif ¢(X8)

J i=1 8=1

-:;; L L 1 n

n

ai 1(Y8 = j)K(Xi' Xs)

J i=1 8=1

aTMj

where JI.;[j is a vector whose ith component is

It follows that where M = (Mo - Md(Mo - MdT. By similar calculations, we can write

where

Kif (I - (I - N = Ko

~1) + K1

~1) Ki,

no

n1

I is the identity matrix, 1 is a matrix of all one's, and K j is the n x nj
matrix with entries (Kj ) r8 = K (x r, X 8) with xs varying over the observations
in group j. Hence, we now find a to maximize

1(a) = aTMa. aTNa

22.11 Other Classifiers 375

All the quantities are expressed in terms of the kernel. Formally, the solution
is Q = N- 1 (J'vlo - J'vld. However, N might be non-invertible. In this case one
replaces N by N + bI, for some constant b. Finally, the projection onto the
new subspace can be written as

Ln
u = w T ¢(x) = QiK(Xi' x).
i=1

The support vector machine can similarly be kernelized. We simply replace

(Xi, Xj) with K(Xi' Xj). For example, instead of maximizing (22.40), we now

maximize

"Q - -"" n
~2

1n n 2 ~ ~ QtQkY2;Y;kK(Xt, XJ).

i=1

i=1 k=1

(22.43)

The hyperplane can be written as H(x) = 0,0 + L~=l aiIiK(X, Xi).

22.11 Other Classifiers

There are many other classifiers and space precludes a full discussion of all of

them. Let us briefly mention a few.

The k-nearest-neighbors classifier is very simple. Given a point x, find

the k data points closest to x. Classify x using the majority vote of these k

neighbors. Ties can be broken randomly. The parameter k can be chosen by

cross-validation.

Bagging is a method for reducing the variability of a classifier. It is most

helpful for highly nonlinear classifiers such as trees. We draw B bootstrap

samples from the data. The bth bootstrap sample yields a classifier hb . The

final classifier is

1I ~h(x) = {

01

if L~=1 hb(X) :::> ~
otherwise.

Boosting is a method for starting with a simple classifier and gradually improving it by refitting the data giving higher weight to misclassified samples. Suppose that 1{ is a collection of classifiers, for example, trees with only
one split. Assume that Ii E {-I, I} and that each h is such that h(x) E
{ -1, I}. We usually give equal weight to all data points in the methods we have discussed. But one can incorporate unequal weights quite easily in most algorithms. For example, in constructing a tree, we could replace the impurity measure with a weighted impurity measure. The original version of boosting, called AdaBoost, is as follows.

376 22. Classification
1. Set the weights Wi = lin, 'i = 1, ... ,n.
2. For j = 1, ... , J, do the following steps: (a) Constructing a classifier hj from the data using the weights WI, ... , W n . (b) Compute the weighted error estimate:
(c) Let aj = log( (1 - Lj )/Lj ).
(d) Update the weights:
3. The final classifier is
There is now an enormous literature trying to explain and improve on boosting. Whereas bagging is a variance reduction technique, boosting can be thought of as a bias reduction technique. We starting with a simple and hence highly-biased - classifier, and we gradually reduce the bias. The disadvantage of boosting is that the final classifier is quite complicated.
Neural Networks are regression models of the form 3
Lp
y = Po + pju(ao + aT X)
j=1
where u is a smooth function, often taken to be u(v) = + eV 1(1 eV ). This
is really nothing more than a nonlinear regression model. Neural nets were fashionable for some time but they pose great computational difficulties. In particular, one often encounters multiple minima when trying to find the least squares estimates of the parameters. Also, the number of terms p is essentially a smoothing parameter and there is the usual problem of trying to choose p to find a good balance between bias and variance.
3This is the simplest version of a neural net. There are more complex versions of the model.

22.12 Bibliographic Remarks 377
22.12 Bibliographic Rernarks
The literature on classification is vast and is growing quickly. An excellent reference is Hastie et al. (2001). For more on the theory, see Devroye et al. (1996) and Vapnik (1998). Two recent books on kernels are Scholkopf and Smola (2002) and Herbich (2002).

22.13 Exercises
1. Prove Theorem 22.5. 2. Prove Theorem 22.7. 3. Download the spam data from:

http://www-stat.stanford.edu/ ,,-,tibs/ElemStatLearn/index.html

The data file can also be found on the course web page. The data contain 57 covariates relating to email messages. Each email message was classified as spam (Y=l) or not spam (Y=O). The outcome Y is the last column in the file. The goal is to predict whether an email is spam or not.
(a) Construct classification rules using (i) LDA, (ii) QDA, (iii) logistic regression, and (iv) a classification tree. For each, report the observed misclassification error rate and construct a 2-by-2 table of the form

h(x)=O h(x)=l

Y = O??

??

Y = I??

??

(b) Use 5-fold cross-validation to estimate the prediction accuracy of LDA and logistic regression.
(c) Sometimes it helps to reduce the number of covariates. One strategy is to compare Xi for the spam and email group. For each of the 57 covariates, test whether the mean of the covariate is the same or different between the two groups. Keep the 10 covariates with the smallest pvalues. Try LDA and logistic regression using only these 10 variables.

378 22. Classification
4. Let A be the set of two-dimensional spheres. That is, A E A if A = {(x,y): (x-a)2+(y-b)2::.; c2} for some a,b,c. Find the VC-dimension of A.
5. Classify the spam data using support vector machines. Free software for the support vector machine is at http://svmlight.joachims.org/
6. Use VC theory to get a confidence interval on the true error rate of the LDA classifier for the iris data (from the book web site).
7. Suppose that Xi E lR and that li = 1 whenever IXil ::.; 1 and li = 0 whenever IXil > 1. Show that no linear classifier can perfectly classify
these data. Show that the kernelized data Zi = (Xi, xl) can be linearly
separated.
8. Repeat question 5 using the kernel K(x, ?i) = (1 + xT?i)p. Choose p by
cross-validation.
9. Apply the k nearest neighbors classifier to the "iris data." Choose k by cross-validation.
10. (Curse of Dimensionality.) Suppose that X has a uniform distribution on the d-dimensional cube [-1/2, 1/2]d. Let R be the distance from the origin to the closest neighbor. Show that the median of R is

where

Vd(r-) = r-d r((d~2d)/2+ 1)

is the volume of a sphere of radius r-. For what dimension d does the median of R exceed the edge of the cube when n = 100, n = 1,000, n = 10, OOO? (Hastie et al. (2001), p. 22-27.)

11. Fit a tree to the data in question 3. Now apply bagging and report your results.

12. Fit a tree that uses only one split on one variable to the data in question 3. Now apply boosting.

22.13 Exercises 379

13. Let r(x) = P(Y = 11X = x) and let r(x) be an estimate of r(x). Consider

the classifier

h(x) = {I if r(x) ."21/2
o otherwIse.

Assume that r( x) :::::; N (r( x), (]"2 (x)) for some functions r( x) and (]"2 (x). Show that, for fixed x,

P(Y -I- h(x)) :::::; P(Y -I- h*(x))

Sign(r(X)-(1/2))(r(X)-(1/2)))]

+ I2r(x) - 1I x [ 1 - <I> (

(]"(x )

where <I> is the standard Normal CDF and h* is the Bayes rule. Regard sign ((r(x) - (1/2))(r(x) - (1/2))) as a type of bias term. Explain the implications for the bias-variance tradeoff in classification (Friedman (1997) ). Hint: first show that
P(Y -I- h(x)) = 12r(x) - 1IP(h(x) -I- h*(x)) + P(Y '" h*(x)).

23
Probability Redux: Stochastic Processes
23.1 Introduction
Most of this book has focused on IID sequences of random variables. Now we consider sequences of dependent random variables. For example, daily temperatures will form a sequence of time-ordered random variables and clearly the temperature on one day is not independent of the temperature on the previous day.
A stochastic process {Xt : t E T} is a collection of random variables. We shall sometimes write X(t) instead of Xt. The variables X t take values in some set X called the state space. The set T is called the index set and for our purposes can be thought of as time. The index set can be discrete T = {O, 1, 2, ... } or continuous T = [0, CXJ) depending on the application. 23.1 Example (rID observations). A sequence of rID random variables can be written as {Xt : t E T} where T = {I, 2, 3, ... ,}. Thus, a sequence of IID random variables is an example of a stochastic process. _ 23.2 Example (The Weather). Let X = {sunny, cloudy}. A typical sequence (depending on where you live) might be
sunny, sunny, cloudy, sunny, cloudy, cloudy"" This process has a discrete state space and a discrete index set. _

382 23. Probability Redux: Stochastic Processes

price

time FIGURE 23.1. Stock price over ten week period.
23.3 Example (Stock Prices). Figure 23.1 shows the price of a fictitious stock over time. The price is monitored continuously so the index set T is continuous. Price is discrete but for all practical purposes we can treat it as a continuous variable. _

23.4 Example (Empirical Distribution Function). Let Xl, ... , Xn rv F where F is some CDF on [0,1]. Let

L ~

1n

Fn(t) = - I(Xi ::; t)

n

i=l

be the empirical CDF. For any fixed value t, Fn(t) is a random variable. But the whole empirical CDF

is a stochastic process with a continuous state space and a continuous index set. _
We end this section by recalling a basic fact. If Xl' ... ' Xn are random variables, then we can write the joint density as

I In !(xilpasti)
i=l

(23.1)

23.2 Markov Chains 383

23.2 Markov Chains

A Markov chain is a stochastic process for which the distribution of X t depends only on X t - 1. In this section we assume that the state space is discrete, either X = {I, ... , N} or X = {I, 2, ... ,} and that the index set is
T = {O, 1, 2, ... }. Typically, most authors write Xn instead of X t when dis-
cussing Markov chains and I will do so as well.

23.5 Definition. The process {Xn: nET} is a Markov chain if

IP'(Xn = x I X o,···, Xn-d = IP'(Xn = x I Xn-d for all n and for all x E X.

(23.2)

For a Markov chain, equation (23.1) simplifies to

A Markov chain can be represented by the following DAG:

Xo

--..,)~ X 2 - - - - .

Each variable has a single parent, namely, the previous observation. The theory of Markov chains is a very rich and complex. We have to get through many definitions before we can do anything interesting. Our goal is to answer the following questions:
1. When does a Markov chain "settle down" into some sort of equilibrium?
2. How do we estimate the parameters of a Markov chain?
3. How can we construct Markov chains that converge to a given equilibrium distribution and why would we want to do that?
We will answer questions 1 and 2 in this chapter. We will answer question 3 in the next chapter. To understand question 1, look at the two chains in Figure 23.2. The first chain oscillates all over the place and will continue to do so forever. The second chain eventually settles into an equilibrium. If we constructed a histogram of the first process, it would keep changing as we got

384 23. Probability Redux: Stochastic Processes
more and more observations. But a histogram from the second chain would eventually converge to some fixed distribution.

time

time

FIGURE 23.2. Two Markov chains. The first chain does not settle down into an equilibrium. The second does.

TRANSITION PROBABILITIES. The key quantities of a Markov chain are the probabilities of jumping from one state into another state. A Markov chain is homogeneous if IP'(Xn+l = jlXn = i) does not change with time. Thus, for a homogeneous Markov chain, IP'(Xn+1 = jlXn =i) = IP'(Xl = jlXo = i). We shall only deal with homogeneous Markov chains.

23.6 Definition. We call

Pij == IP'(Xn+ 1 = jlXn = i)

(23.3)

the transition probabilities. The matrix P whose (i, j) element is Pij is called the transition matrix.

We will only consider homogeneous chains. Notice that P has two properties: (i) Pij ~ 0 and (ii) Li Pij = 1. Each row can be regarded as a probability mass function.

23.7 Example (Random Walk With Absorbing Barriers). Let X = {I, ... , N}. Suppose you are standing at one of these points. Flip a coin with IP'(Heads) = P and IP'(Tails) = q = 1 - p. If it is heads, take one step to the right. If it is tails, take one step to the left. If you hit one of the endpoints, stay there. The

23.2 Markov Chains 385

transition matrix is

100 0

00

q0P0

00

p= 0 q 0 P

00

-

000 0 q 0P

0000001

23.8 Example. Suppose the state space is X {sunny, cloudy}. Then Xl, X 2 , ... represents the weather for a sequence of days. The weather today clearly depends on yesterday's weather. It might also depend on the weather two days ago but as a first approximation we might assume that the dependence is only one day back. In that case the weather is a Markov chain and a typical transition matrix might be

Sunny Cloudy

Sunny 0.4

0.6

Cloudy 0.8

0.2

For example, if it is sunny today, there is a 60 per cent chance it will be cloudy tomorrow. _

Let (23.4)
be the probability of of going from state i to state j in n steps. Let P n be the matrix whose ('i,j) element is pij(n). These are called the n-step transition probabilities.

23.9 Theorem (The Chapman-Kolmogorov equations). The n-step probabilities

satisfy

Pij(m + n) = LPik(m)Pkj(n).

(23.5)

k

PROOF. Recall that, in general,

J1D(X = x, Y = y) = J1D(X = x)IP'(Y = ylX = x).

This fact is true in the more general form

J1D(X = x, Y = ylZ = z) = J1D(X = xlZ = z)IP'(Y = ylX = x, Z = z).

Also, recall the law of total probability:

J1D(X = x) = LJID(X = x, Y = y).
y

386 23. Probability Redux: Stochastic Processes

Using these facts and the Markov property we have

Pij(m + 71,)

IP'(Xm+n = jlXo = i)
L IP'(Xm+n = j, Xm = klXo =i)
k
L IP'(Xm+n = jlXm = k, Xo = i)IP'(Xm = klXo =i)
k

k
LPik(m)Pkj(n). -
k
Look closely at equation (23.5). This is nothing more than the equation for matrix multiplication. Hence we have shown that

(23.6)

By definition, PI = P. Using the above theorem, P 2 PP = p2. Continuing this way, we see that

P n = pn ==

PxPx···xp

...

~

v

multiply the matrix n times

Let fLn = (fLn (1), ... , fLn (N)) be a row vector where

(23.7)

(23.8)

is the marginal probability that the chain is in state i at time n. In particular, fLo is called the initial distribution. To simulate a Markov chain, all you need to know is fLo and P. The simulation would look like this:

Step 1: Draw Xo rv ILo. Thus, IP'(Xo = i) = ILo(i). Step 2: Denote the outcome of step 1 by i. Draw Xl rv P. In other words, IP'(XI = jlXo = i) = Pij. Step 3: Suppose the outcome of step 2 is j. Draw X 2 rv P. In other words, IP'(X2 = klXI = j) = Pjk.
And so on.

It might be difficult to understand the meaning of fLn. Imagine simulating the chain many times. Collect all the outcomes at time n from all the chains. This histogram would look approximately like ILn. A consequence of theorem 23.9 is the following:

23.2 Markov Chains 387 23.10 Lemma. The marginal probabilities are given by

PROOF.

IP'(Xn = j)
L IP'(Xn = j IXo =i)P(Xo = i)

Summary of Terminology
1. Transition matrix: P(i,j) = IP'(Xn+1 = jlXn = i) = Pij' 2. n-step matrix: Pn(i,j) = IP'(Xn+m = jlXm = i).
4. Marginal: ILn(i) = IP'(Xn = i).
STATES. The states of a Markov chain can be classified according to various properties.
23.11 Definition. We say that i reaches j (or j is accessible from i) if
Pij (n) > 0 for some n, and we write i --+ j. If i --+ j and j --+ i then we
write i f-+ j and we say that i and j communicate.
23.12 Theorem. The communication relation satisfies the following properties:
1. if-+i. 2. If i f-+ j then j f-+ i. 3. If i f-+ j and j f-+ k then i f-+ k.
4. The set of states X can be written as a disjoint union of classes X =
Xl UX2 U... where two states i and j communicate with each other if
and only if they are in the same class.

388 23. Probability Redux: Stochastic Processes
If all states communicate with each other, then the chain is called irreducible. A set of states is closed if, once you enter that set of states you never leave. A closed set consisting of a single state is called an absorbing state.
23.13 Example. Let X = {1,2,3,4} and
p~ 0~ ~ D

The classes are {I, 2}, {3} and {4}. State 4 is an absorbing state. _ Suppose we start a chain in state i. Will the chain ever return to state i?
If so, that state is called persistent or recurrent.
23.14 Definition. State i is recurrent or persistent if
IP'(Xn = i for some n ~ 1 I Xo = i) = 1.
Otherwise, state i is transient.

23.15 Theorem. A state i is recurrent if and only if

n
A state i is transient if and only if

(23.9)

(23.10)
n

PROOF. Define

if Xn = i
if Xn # i.

The number of times that the chain is in state i is Y = L:~=o In. The mean of Y, given that the chain starts in state i, is

00

00

00

n=O

n=O

n=O

Define ai = IP'(Xn = i for some n ~ 1 I Xo = i). If i is recurrent, ai = 1. Thus,
the chain will eventually return to i. Once it does return to i, we argue again

23.2 Markov Chains 389
that since ai = 1, the chain will return to state i again. By repeating this argument, we conclude that JE(YIXo = i) = 00. If i is transient, then ai < 1. When the chain is in state i, there is a probability 1- ai > 0 that it will never
return to state i. Thus, the probability that the chain is in state i exactly 71 times is a~-l(l - ai). This is a geometric distribution which has finite mean.
-
23.16 Theorem. Facts about recurrence.
1. If state i is recurrent and i ++ j, then j is recurrent.
2. If state i is transient and i ++ j, then j is transient.
3. A finite Markov chain must have at least one recurrent state.
4. The states of a finite, irreducible Markov chain are all recurrent.
23.17 Theorem (Decomposition Theorem). The state space X can be written as the disjoint union

where XT are the transient states and each Xi is a closed, irreducible set of recurrent states.

23.18 Example (Random Walk). Let X = { ... , -2, -1,0,1,2, ... ,} and suppose that Pi,i+1 = p, Pi,i-l = q = 1 - p. All states communicate, hence either all the states are recurrent or all are transient. To see which, suppose we start at Xo = O. Note that

poo(2n) = Cnn)pnqn

(23.11)

since the only way to get back to 0 is to have 71 heads (steps to the right) and 71 tails (steps to the left). We can approximate this expression using Stirling's formula which says that

Inserting this approximation into (23.11) shows that
(4pq)n
vmr poo(2n) rv - - .
It is easy to check that ~n Poo (71) < 00 if and only if ~n POO (271) < 00.
Moreover, ~nPoo(2n) = 00 if and only if P = q = 1/2. By Theorem (23.15), the chain is recurrent if P = 1/2 otherwise it is transient. _

390 23. Probability Redux: Stochastic Processes

CONVERGENCE OF MARKOV CHAINS. To discuss the convergence of chains,

we need a few more definitions. Suppose that Xo = i. Define the recurrence

time

Tij = min{n > 0: Xn = j}

(23.12)

assuming Xn ever returns to state i, otherwise define Tij recurrence time of a recurrent state i is

00. The mean

where

(23.13)
n

A recurrent state is null if 7ni = 00 otherwise it is called non-null or positive.
23.19 Lemma. If a state is null and recurrent, then pjj --+ o.
23.20 Lemma. In a finite state Markov chain, all recurrent states are positive.
Consider a three-state chain with transition matrix 1
o o
Suppose we start the chain in state 1. Then we will be in state 3 at times 3, 6, 9, .... This is an example of a periodic chain. Formally, the period of state i
is d if pii(n) = 0 whenever n is not divisible by d and d is the largest integer with this property. Thus, d = gcd{n: Pii (n) > O} where gcd means "greater common divisor." Statei is periodic if d(i) > 1 and aperiodic if d(i) = l.
A state with period 1 is called aperiodic.
23.21 Lemma. If state i has period d andi B j then j has period d.
23.22 Definition. A state is ergodic if it is recurrent, non-null and aperiodic. A chain is ergodic if all its states are ergodic.
Let Jr = (Jri: i E X) be a vector of non-negative numbers that sum to one. Thus Jr can be thought of as a probability mass function.
23.23 Definition. We say that Jr is a stationary (or invariant) distribution if Jr = JrP .

23.2 Markov Chains 391
Here is the intuition. Draw Xo from distribution 'if and suppose that 'if is a stationary distribution. Now draw Xl according to the transition probability of the chain. The distribution of Xl is then fLl = fLoP = 'ifp = 'if. The distribution of X 2 is 'ifp2 = ('ifP)P = 'ifp = 'if. Continuing this way, we see that the distribution of Xn is 'ifpn = 'if. In other words:
If at any time the chain has distribution 'if, then it will continue to have distribution 'if forever.
23.24 Definition. We say that a chain has limiting distribution if
for some 'if, that is, 'ifj = limn--+= Pi; exists and is independent of i.
Here is the main theorem about convergence. The theorem says that an ergodic chain converges to its stationary distribution. Also, sample averages converge to their theoretical expectations under the stationary distribution.
23.25 Theorem. An irreducible, ergodic Markov chain has a unique stationary distribution 'if. The limiting distribution exists and is equal to 'if. If g is any bounded function, then, with probability 1,
(23.14)
Finally, there is another definition that will be useful later. We say that 'if satisfies detailed balance if
(23.15) Detailed balance guarantees that 'if is a stationary distribution. 23.26 Theorem. If'if satisfies detailed balance, then 'if is a stationary distribution.
PROOF. We need to show that 'ifp = 'if. The jth element of'ifP is Li 'ifiPij = Li'ifjPji = 'ifj LiPji = 'ifj .·

392 23. Probability Redux: Stochastic Processes

The importance of detailed balance will become clear when we discuss

Markov chain Monte Carlo methods in Chapter 24.

Warning! Just because a chain has a stationary distribution does not mean

it converges.

23.27 Example. Let

n p~ [~ ~

Let Jr = (1/3,1/3,1/3). Then Jrp Jr so Jr is a stationary distribution. If the chain is started with the distribution Jr it will stay in that distribution. Imagine simulating many chains and checking the marginal distribution at each time n. It will always be the uniform distribution Jr. But this chain does not have a limit. It continues to cycle around forever. _

EXAMPLES OF MARKOV CHAINS.

23.28 Example. Let X = {I, 2, 3, 4, 5, 6}. Let

p=

1
"2

1
"2

0

0

0

0

1
"4

3
"4

0

0

0

0

1
"4

1
"4

1
"4

1
"4

0

0

1
"4

0

1
"4

1
"4

0

1
"4

0

0

0

0

1
"2

1
"2

0

0

0

0

1
"2

1
"2

Then C1 = {1,2} and C2 = {5,6} are irreducible closed sets. States 3 and 4 are transient because of the path 3 --+ 4 --+ 6 and once you hit state 6
you cannot return to 3 or 4. Since Pii(l) > 0, all the states are aperiodic. In
summary, 3 and 4 are transient while 1, 2, 5, and 6 are ergodic. _

23.29 Example (Hardy-Weinberg). Here is a famous example from genetics. Suppose a gene can be type A or type a. There are three types of people (called
genotypes): AA, Aa, and aa. Let (p, q, T) denote the fraction of people of each
genotype. We assume that everyone contributes one of their two copies of the gene at random to their children. We also assume that mates are selected at random. The latter is not realistic however, it is often reasonable to assume that you do not choose your mate based on whether they are AA, Aa, or aa. (This would be false if the gene was for eye color and if people chose mates based on eye color.) Imagine if we pooled everyone's genes together.
The proportion of A genes is P = p + (q/2) and the proportion of a genes is

23.2 Markov Chains 393
+ Q = r (q/2). A child is AA with probability p2, aA with probability 2PQ,
and aa with probability Q2. Thus, the fraction of A genes in this generation is

However, r = 1 - p - q. Substitute this in the above equation and you get
p 2 + PQ = P. A similar calculation shows that the fraction of "a" genes is

Q. We have shown that the proportion of type A and type a is P and Q and

this remains stable after the first generation. The proportion of people of type AA, Aa, aa is thus (P2, 2PQ, Q2) from the second generation and on. This is

called the Hardy-Weinberg law.

Assume everyone has exactly one child. Now consider a fixed person and

let Xn be the genotype of their nth descendant. This is a Markov chain with

state space X = {AA, Aa, aa}. Some basic calculations will show you that the

transition matrix is

Q P+Q
-2-
P

The stationary distribution is 7r = (P 2, 2PQ, Q2) .·

23.30 Example (Markov chain Monte Carlo). In Chapter 24 we will present a
simulation method called Markov chain Monte Carlo (MCMC). Here is a brief
description of the idea. Let f(x) be a probability density on the real line and
suppose that f (x) = cg( x) where g( x) is a known function and c > 0 is
J unknown. In principle, we can compute c since f(x)dx = 1 implies that J c = 1/ g(x)dx. However, it may not be feasible to perform this integral, nor
is it necessary to know c in the following algorithm. Let X o be an arbitrary
starting value. Given Xo, ... , Xi, draw Xi+l as follows. First, draw W rv
N(Xi' b2 ) where b > 0 is some fixed constant. Let

r = mm. {gg((WXi)) , 1} .
Draw U rv Uniform(O, 1) and set
if U < r
if U 2 r.
We will see in Chapter 24 that, under weak conditions, XO,X1 , ... , is an
ergodic Markov chain with stationary distribution f. Hence, we can regard the draws as a sample from f .·

394 23. Probability Redux: Stochastic Processes

INFERENCE FOR MARKOV CHAINS. Consider a chain with finite state space X = {I, 2, ... , N}. Suppose we observe n observations Xl,"" Xn from this chain. The unknown parameters of a Markov chain are the initial probabilities /10 = (/10(1), /10(2), ... ,) and the elements of the transition matrix P. Each row of P is a multinomial distribution. So we are essentially estimating N distributions (plus the initial probabilities). Let nij be the observed number of transitions from state i to state j. The likelihood function is

II n

NN

£(/10,P) = /1o(xo) IIPx,-l,x, = /1o(xo) IIp~ij.

r=l

i=l j=l

There is only one observation on /10 so we can't estimate that. Rather, we

focus on estimating P. The MLE is obtained by maximizing £(/10, P) subject

to the constraint that the elements are non-negative and the rows sum to l.

The solution is

~ nij Pij = -
ni

where ni = Lf=l nij' Here we are assuming that ni > O. If not, then we set

Pij = 0 by convention.

23.31 Theorem (Consistency and Asymptotic Normality of the MLE). Assume that the chain is ergodic. Let pij(n) denote the MLE after n observations. Then
Pij(n)~ Pij' Also,
[VNi(n)(Pij - Pij)] ~ N(O,~)

where the left-hand side is a matrix, Ni(n) = L~=l J(Xr = i) and

Pij(1 - Pij) (i,j) = (k,R)

~ij,ke = { ~PijPie

i=k,jcjR

otherwise.

23.3 Poisson Processes
The Poisson process arises when we count occurrences of events over time, for example, traffic accidents, radioactive decay, arrival of email messages, etc. As the name suggests, the Poisson process is intimately related to the Poisson distribution. Let's first review the Poisson distribution.
Recall that X has a Poisson distribution with parameter), - written X rv Poisson(),) - if
e-.\),X
JP'(X = x) == p(x; ),) = - - I-, x = 0,1,2, ...
x.

23.3 Poisson Processes 395
Also recall that JE(X) = A and V(X) = A. If X rv Poisson(A), Y rv Poisson(v)
and XIIY, then X+Y rv Poisson(A+v). Finally, if N rv Poisson(A) and YIN = n rv Binomial(n,p), then the marginal distribution of Y is Y rv Poisson(Ap).
Now we describe the Poisson process. Imagine that you are at your computer. Each time a new email message arrives you record the time. Let X t be the number of messages you have received up to and including time t. Then, {Xt : t E [0, oo)} is a stochastic process with state space X = {O, 1,2, ... }. A process of this form is called a counting process. A Poisson process is a counting process that satisfies certain conditions. In what follows, we will sometimes write X(t) instead of X t . Also, we need the following notation.
Write f(h) = o(h) if f(h)/h --+ 0 as h --+ o. This means that f(h) is smaller
than h when h is close to O. For example, h2 = o(h).
23.32 Definition. A Poisson process is a stochastic process {Xt : t E [0, oo)} with state space X = {O, 1,2, ... } such that
1. X(O) = O.
2. For any 0 = to < tl < t2 < ... < tn, the increments

are independent.
3. There is a function A(t) such that
J1D(X(t + h) - X(t) = 1) J1D(X(t + h) - X(t) ~ 2)

A(t)h + o(h)
o(h).

(23.16) (23.17)

We call A(t) the intensity function.
The last condition means that the probability of an event in [t, t + h] is approximately hA(t) while the probability of more than one event is small. 23.33 Theorem. If X t is a Poisson process with intensity function A(t), then
X(s + t) - X(s) rv Poisson(rn(s + t) - rn(s)) where
lot rn(t) = A(S) ds.
In particular, X(t) rv Poisson(rn(t)). Hence, JE(X(t)) = rn(t) and V(X(t)) = rn(t) .

396 23. Probability Redux: Stochastic Processes
23.34 Definition. A Poisson process with intensity function A(t) == A for some A > 0 is called a homogeneous Poisson process with rate A. In
this case, X(t) rv Poisson(At).
Let X(t) be a homogeneous Poisson process with rate A. Let Wn be the
time at which the nth event occurs and set Wo = o. The random variables
W o, WI' ... ' are called waiting times. Let Sn = W n+l - W n . Then So, Sl, ... , are called sojourn times or interarrival times. 23.35 Theorem. The sojourn times So, Sl, ... are lID random variables. Their distribution is exponential with mean I/A, that is, they have density
f(s) = Ae-'\s, s:;:, o.
The waiting time Wn rv Gamma(n, I/A) i.e., it has density
PROOF. First, we have
lP'(Sl > t) = lP'(X(t) = 0) = e-.\t
with shows that the CDF for Sl is 1 - e-.\t. This shows the result for Sl. Now,
lP'(no events in (8,8 + tllSl = s) lP'(no events in (8,8 + t]) (increments are independent)
e-.\t . Hence, S2 has an exponential distribution and is independent of Sl. The result follows by repeating the argument. The result for Wn follows since a sum of exponentials has a Gamma distribution. _ 23.36 Example. Figure 23.3 shows requests to a WWW server in Calgary. 1
Assuming that this is a homogeneous Poisson process, N == X(T) rv Poisson(AT).
The likelihood is
lSee http://ita.ee.lbl.gov/html/contrib/Calgary-HTTP.html for more information.

23.4 Bibliographic Remarks 397

1200
FIGURE 23.3. Hits on a web server. Each vertical line represents one event.

which is maximized at

-A = -NT = 48.0077

in units per minute. Let's now test the assumption that the data follow a homogeneous Poisson process using a goodness-of-fit test. We divide the interval
[0, T] into 4 equal length intervals h, h, 13 , 14 . If the process is a homogeneous
Poisson process then, given the total number of events, the probability that an event falls into any of these intervals must be equal. Let Pi be the probability
of a point being in h The null hypothesis is that PI = P2 = P3 = P4 = 1/4.
We can test this hypothesis using either a likelihood ratio test or a X2 test. The latter is

where Oi is the number of observations in Ii and Ei = n/4 is the expected number under the null. This yields X2 = 252 with a p-value near O. This is strong evidence against the null so we reject the hypothesis that the data are from a homogeneous Poisson process. This is hardly surprising since we would expect the intensity to vary as a function of time. _

23.4 Bibliographic Rernarks
This is standard material and there are many good references including Grimmett and Stirzaker (1982), Taylor and Karlin (1994), Guttorp (1995), and Ross (2002). The following exercises are from those texts.

398 23. Probability Redux: Stochastic Processes
23.5 Exercises
1. Let X o, Xl, ... be a Markov chain with states {O, 1, 2} and transition matrix 0.1 0.2 0.7] P = [ 0.9 0.1 0.0 0.1 0.8 0.1
Assume that flo = (0.3,0.4,0.3). Find IP'(Xo = 0, Xl = 1, X 2 = 2) and IP'(Xo = 0, Xl = 1, X 2 = 1).
2. Let Yl , Y2 , ... be a sequence of iid observations such that IP'(Y = 0) =
0.1, IP'(Y = 1) = 0.3, IP'(Y = 2) = 0.2, IP'(Y = 3) = 0.4. Let Xo = 0 and
let

Show that X o, Xl, ... is a Markov chain and find the transition matrix.

3. Consider a two-state Markov chain with states X = {I, 2} and transition

matrix

p= [ 1 - a
b

a 1-b

where 0 < a < 1 and 0 < b < 1. Prove that

pn at at lim

=[

b

b ]·

n---+oo

a+b a+b

4. Consider the chain from question 3 and set a = .1 and b = .3. Simulate the chain. Let

Pn(2)

1n
- LI(Xi = 1) n
i=l
1n
- LI(Xi = 2) n
i=l

be the proportion of times the chain is in state 1 and state 2. Plot Pn (1) and Pn(2) versus n and verify that they converge to the values predicted from the answer in the previous question.

5. An important Markov chain is the branching process which is used in biology, genetics, nuclear physics, and many other fields. Suppose that an animal has Y children. Let Pk = IP'(Y = k). Hence, Pk ~ 0 for all k and L~=o Pk = 1. Assume each animal has the same lifespan and

23.5 Exercises 399

that they produce offspring according to the distribution Pk. Let Xn be the number of animals in the nth generation. Let yI(n) , ... ,yl:) be the offspring produced in the nth generation. Note that

x _ y(n) + ... + y(n)

n+I - 1

Xn '

Let fL = JE(Y) and (j2 = V(Y). Assume throughout this question that Xo = 1. Let M(n) = JE(Xn) and V(n) = V(Xn).
(a) Show that M(n + 1) = ILM(n) and V(n + 1) = (j2 M(n) + fL 2V(n). (b) Show that M(n) = fLn and that V(n) = (j2fLn- I (1 + fL + ... + fLn-I).
(c) What happens to the variance if fL > 1? What happens to the variance if fL = 1? What happens to the variance if fL < 1?
(d) The population goes extinct if Xn = 0 for some n. Let us thus define the extinction time N by

N = min{n: Xn = O}.

Let F(n) = JPl(N ::; n) be the CDP of the random variable N. Show that

(Xl
F(n) = LPk(F(n - 1))\
k=O

n = 1,2, ...

Hint: Note that the event {N ::; n} is the same as event {Xn = O}. Thus, JPl({N ::; n}) = JPl( {Xn = O}). Let k be the number of offspring of the original parent. The population becomes extinct at time n if and
only if each of the k sub-populations generated from the k offspring goes extinct in n - 1 generations.

(e) Suppose that Po = 1/4, PI = 1/2, P2 = 1/4. Use the formula from
(5d) to compute the CDF F(n).

6. Let

1 0.40
P = [ 0.05

0.50 0.70

0.10 0.25

0.05 0.50 0.45

Find the stationary distribution Jr.

7. Show that if i is a recurrent state and i ++ j, then j is a recurrent state.

400 23. Probability Redux: Stochastic Processes

8. Let

1 1 1

0

1

0

0

1
"3

2

1
"4

4

000

p=

0 0 0 010

1
"4

1
"4

1
"4

00

1
"4

0 0 1 000

0 0 0 001

Which states are transient? Which states are recurrent?

9. Let

]~ p = [ ~

Show that 'if = (1/2,1/2) is a stationary distribution. Does this chain converge? Why/why not?

10. Let 0 < p < 1 and q = 1 - p. Let

~ r: ~ p 0 0

p

1 0 p 0
00p

l i 6 0 0 0 000 J

Find the limiting distribution of the chain.

11. Let X(t) be an inhomogeneous Poisson process with intensity function
A(t) > o. Let A(t) = J~ A(u)du. Define Y(8) = X(t) where 8 = A(t).
Show that Y(8) is a homogeneous Poisson process with intensity A = l.

12. Let X(t) be a Poisson process with intensity A. Find the conditional
distribution of X(t) given that X(t + 8) = r1.

13. Let X(t) be a Poisson process with intensity A. Find the probability that X(t) is odd, i.e. J1D(X(t) = 1,3,5, ... ).

14. Suppose that people logging in to the University computer system is described by a Poisson process X(t) with intensity A. Assume that a person stays logged in for some random time with CDF G. Assume these times are all independent. Let Y(t) be the number of people on the system at time t. Find the distribution of Y(t).

15. Let X(t) be a Poisson process with intensity A. Let WI, W2 , ... , be the
waiting times. Let f be an arbitrary function. Show that

8 10 X(t)

)

.t

IE ( f(Wi ) = A f(w)dw.

23.5 Exercises 401
16. A two-dimensional Poisson point process is a process of random points on the plane such that (i) for any set A, the number of points falling in A is Poisson with mean AIL(A) where IL(A) is the area of A, (ii) the number of events in non-overlapping regions is independent. Consider an arbitrary point Xo in the plane. Let X denote the distance from Xo to the nearest random point. Show that
and 1
JE(X) = /\.
2VA

24
Simulation Methods
In this chapter we will show how simulation can be used to approximate integrals. Our leading example is the problem of computing integrals in Bayesian inference but the techniques are widely applicable. We will look at three integration methods: (i) basic Monte Carlo integration, (ii) importance sampling, and (iii) Markov chain Monte Carlo (MCMC).
24.1 Bayesian Inference Revisited
Simulation methods are especially useful in Bayesian inference so let us briefly review the main ideas in Bayesian inference. See Chapter 11 for more details.
Given a prior 1(8) and data xn = (Xl, ... ,Xn) the posterior density is
where £(8) is the likelihood function and c = / £(8)1(8) d8
is the normalizing constant. The posterior mean is

404

24. Simulation Methods

If 8 = (81 , ... , 8k) is multidimensional, then we might be interested in the
posterior for one of the components, 81 , say. This marginal posterior density is

which involves high-dimensional integration. When 8 is high-dimensional, it may not be feasible to calculate these inte-
grals analytically. Simulation methods will often be helpful.

24.2 Basic Monte Carlo Integration

Suppose we want to evaluate the integral
1= 1b h(x)dx

for some function h. If h is an "easy" function like a polynomial or trigono-

metric function, then we can do the integral in closed form. If h is complicated

there may be no known closed form expression for I. There are many numer-

ical techniques for evaluating I such as Simpson's rule, the trapezoidal rule

and Gaussian quadrature. Monte Carlo integration is another approach for

approximating I which is notable for its simplicity, generality and scalability.

Let us begin by writing

1=1 1 b

b

h(x)dx = w(x)f(x)dx

(24.1 )

where w(x) = h(x)(b-a) and f(x) = l/(b-a). Notice that f is the probability density for a uniform random variable over (a, b). Hence,

where X rv Unif(a, b). If we generate Xl, ... ,XN rv Unif(a, b), then by the law of large numbers

~
1==

N

1
N

,~ , " ,

W

(

X

p
i)--+

lE(W(X

)

)

=

I.

i=l

(24.2)

This is the basic Monte Carlo integration method. We can also compute the standard error of the estimate

~
se=

-S-

VN

24.2 Basic Monte Carlo Integration 405

where

2 (Yi - ~!l J)2 s = ==-'---------'.N -1

where Yi = W(Xi)' A 1- ex confidence interval for I is J± Za/25e. We can take

N as large as we want and hence make the length of the confidence interval

very small.

24.1 Example. Let h(x) = x 3 . Then, I = J~l x 3 dx = 1/4. Based on N =
10,000 observations from a Uniform(O,l) we get J = .248 with a standard
error of .0028.·

A generalization of the basic method is to consider integrals of the form

J 1= h(x)f(x)dx

(24.3)

where f(x) is a probability density function. Taking f to be a Uniform (a,b)
gives us the special case above. Now we draw Xl"'" X N f rv and take

as before.

24.2 Example. Let

f(x) = _1e - x 2 /2, yI27T

be the standard Normal PDF. Suppose we want to compute the CDF at some

point x:

I = L~ f(s)ds = <p(x).

Write

J 1= h(s)f(s)ds

where

~ h(s) = {

s<x
s:;:, x.

Now we generate Xl"'" X N rv N(O, 1) and set

~_ 1-

1 N

~
~h

( X

i

)

_ -

number of observations N

::; x

For example, with x 2, the true answer is <p(2) = .9772 and the Monte Carlo estimate with N = 10,000 yields .9751. Using N = 100,000 we get .9771. ·

406 24. Simulation Methods
24.3 Example (Bayesian Inference for Two Binomials). Let X rv Binomial(n,pd and Y rv Binomial(m,P2)' We would like to estimate 5 = P2 - Pl. The MLE
se is 5' = P2 - PI = (Y/m) - (X/n). We can get the standard error using the
delta method which yields

se. 5' and then construct a 95 percent confidence interval ± 2 Now consider a
Bayesian analysis. Suppose we use the prior f(P1,P2) = f(pdf(p2) = 1, that is, a flat prior on (PI, P2). The posterior is
The posterior mean of 5 is

If we want the posterior density of 5 we can first get the posterior CDF
i F(cIX, Y) = P(5 <::: clX, Y) = f(PI,P2IX, Y)

where A = {(p1,P2): P2 - PI <::: c}. The density can then be obtained by
differentiating F.
To avoid all these integrals, let's use simulation. Note that f(p1,P2IX, Y) =
f(PIIX)f(P21Y) which implies that PI and P2 are independent under the pos-
terior distribution. Also, we see that PI I X rv Beta(X +1, n - X + 1) and P21 Y rv Beta. (Y + 1, m. - Y+)1. Hence, we c. an 'Slmu1ate (pCl1)' p,2(1)) , ... , (p(1N) , p,C2 N))
from the posterior by drawing

p~i)

Beta(X + 1, n - X + 1)

pJi)

Beta(Y + 1, m - Y + 1)

l£or :t -- 1, ... , N . NowIet usCi) -- p,2(i) _ pCli)' Then,

We can also get a 95 percent posterior interval for 5 by sorting the simulated values, and finding the .025 and .975 quantile. The posterior density f( 51X, Y) can be obtained by applying density estimation techniques to 5(1 ), ... ,5CN) or, simply by plotting a histogram. For example, suppose that n = m = 10,

24.2 Basic Monte Carlo Integration 407
FIGURE 24.1. Posterior of <5 from simulation.
x = 8 and Y = 6. From a posterior sample of size 1000 we get a 95 percent
posterior interval of (-0.52,0.20). The posterior density can be estimated from a histogram of the simulated values as shown in Figure 24.1. · 24.4 Example (Bayesian Inference for Dose Response). Suppose we conduct an experiment by giving rats one of ten possible doses of a drug, denoted by
Xl < X2 < ... < XlO. For each dose level Xi we use n rats and we observe Yi, the number that survive. Thus we have ten independent binomials Yi rv
Binomial(n, Pi). Suppose we know from biological considerations that higher doses should have higher probability of death. Thus, PI <::: P2 <::: ... <::: PlO' We want to estimate the dose at which the animals have a 50 percent chance of dying. This is called the LD50. Formally, 6 = Xj where
j = min{i: Pi ~ .50}. Notice that 6 is implicitly a (complicated) function of PI, ... ,PlO so we can write 6 = 9 (PI, ... ,PlO) for some g. This just means that if we know (PI, ... ,PlO) then we can find 6. The posterior mean of 6 is
JJ... i g(PI, ... ,Plo)f(PI,'" ,PIOiYI,"" YlO )dpl dp2 ... dplO'
The integral is over the region
The posterior CDF of 6 is JP'(6 <::: eIYI , ... , YlO )
JJ"'l f(PI,'" ,PlOiYI,"" YlO )dpIdp2 ... dplO

408 24. Simulation Methods

where

B=An{(Pl, ... ,PI0): g(Pl,···,PlO) -s:c}.

We need to do a 10-dimensional integral over a restricted region A. Instead, we will use simulation. Let us take a flat prior truncated over A. Except for
the truncation, each Pi has once again a Beta distribution. To draw from the
posterior we do the following steps:
(1) Draw Pi rv Beta(Yi + 1, n - Yi + 1), i = 1, ... ,10.
(2) If PI -s: P2 -s: ... -s: P lO keep this draw. Otherwise, throw it away and
draw again until you get one you can keep.
(3) Let 5 = Xj where

j = min{i: Pi> .50}.

We repeat this N times to get 5(1), ... ,5(N) and take

5 is a discrete variable. We can estimate its probability mass function by

.IY lTll('
Jr U

_
-

XJ

1,···, Y10 )

rv rv

~N

N
"~ 'I(-(6i)

--

J.) .

i=l

For example, consider the following data:

Dose

1 2 3 4 5 6 7 8 9 10

Number of animals ni 15 15 15 15 15 15 15 15 15 15
Number of survivors Yi 0 0 2 2 8 10 12 14 15 14

The posterior draws for PI, . .. , PI0 are shown in the second panel in the
figure. We find that that "5 = 4.04 with a 95 percent interval of (3,5) .·

24.3 Irnportance Sarnpling
Consider again the integral I = J h(x)f(x)dx where f is a probability density.
The basic Monte Carlo method involves sampling from f. However, there are cases where we may not know how to sample from f. For example, in
Bayesian inference, the posterior density density is is obtained by multiplying the likelihood £(8) times the prior f(8). There is no guarantee that f(8Ix) will be a known distribution like a Normal or Gamma or whatever.

24.3 Importance Sampling 409

Importance sampling is a generalization of basic Monte Carlo which over-

comes this problem. Let 9 be a probability density that we know how to

simulate from. Then
j . j' I = h(x)f(x)dx = h(gx()xf)(x) g(x)dx = IEg(Y)

(24.4)

where Y = h(X)f(X)/g(X) and the expectation IEg(Y) is with respect to g. We can simulate Xl, ... , X N 9 rv and estimate I by

(24.5)

This is called importance sampling. By the law of large numbers, f ~ I.
However, there is a catch. It's possible that I might have an infinite standard error. To see why, recall that I is the mean of w(x) = h(x)f(x)/g(x). The second moment of this quantity is

j' j' IE 9

(w

2

(X))

=

(h(X9 ()xf()X))2 9(x )dx =

h2(9x()xP) ( x ) d x.

(24.6)

If 9 has thinner tails than f, then this integral might be infinite. To avoid this,
a basic rule in importance sampling is to sample from a density 9 with thicker tails than f. Also, suppose that g(x) is small over some set A where f(x) is large. Again, the ratio of fig could be large leading to a large variance. This
implies that we should choose 9 to be similar in shape to f. In summary, a good choice for an importance sampling density 9 should be similar to f but
with thicker tails. In fact, we can say what the optimal choice of 9 is.

24.5 Theorem. The choice of 9 that minimizes the variance of I is

*

Ih(x)lf(x)

I 9 (x) = Ih(s)lf(s)ds'

PROOF. The variance of w = fhlg is

J (J w2(x)g(x)dx -

w(X)9(X)dX) 2

J (J h2(X)P(X) (')d 9 2(x) 9 X X

h(x)f(x) (')d )2 9 (x) 9 x x

J (J h2~1~~(X) g(x)dx - h(X)f(X)dX) 2

410 24. Simulation Methods
The second integral does not depend on g, so we only need to minimize the first integral. From Jensen's inequality (Theorem 4.9) we have

This establishes a lower bound on lEg (W2). However, lEg * (W2) equals this lower bound which proves the claim. _
This theorem is interesting but it is only of theoretical interest. If we did
not know how to sample from f then it is unlikely that we could sample from
Ih(x)lf(x)/ J Ih(s)lf(s)ds. In practice, we simply try to find a thick-tailed
distribution g which is similar to flhl.
24.6 Example (Tail Probability). Let's estimate I = IP'(Z > 3) = .0013 where
J Z rv N(O,l). Write I = h(x)f(x)dx where f(x) is the standard Normal
density and h(x) = 1 if x > 3, and 0 otherwise. The basic Monte Carlo
1 estimator is = N- 1 2:i h(Xi ) where Xl, ... , X N rv N(O, 1). Using N = 100
we find (from simulating many times) that lE(1) = .0015 and V(1) = .0039. Notice that most observations are wasted in the sense that most are not near the right tail. Now we will estimate this with importance sampling taking g to be a Normal(4,1) density. We draw values from g and the estimate is now 1 = N- l 2:i f(Xi)h(Xi)/g(Xi ). In this case we find that lE(1) = .0011 and V(1) = .0002. We have reduced the standard deviation by a factor of 20. _
24.7 Example (Measurement Model With Outliers). Suppose we have measurements Xl, . .. , Xn of some physical quantity B. A reasonable model is

If we assume that Ei rv N (0, 1) then Xi rv N (Bi, 1). However, when taking measurements, it is often the case that we get the occasional wild observation, or outlier. This suggests that a Normal might be a poor model since Normals have thin tails which implies that extreme observations are rare. One way to improve the model is to use a density for Ei with a thicker tail, for example, a t-distribution with v degrees of freedom which has the form

e'!l) X2) +- r

1(

t(x) =

r (~)

-
VIr

1

-(u+1)/2
V

Smaller values of v correspond to thicker tails. For the sake of illustration we
will take v = 3. Suppose we observe n Xi = + B Ei, 'i = 1, ... ,n where Ei has

24.4 MCMC Part I: The Metropolis-Hastings Algorithm 411
a t distribution with v = 3. We will take a flat prior on e. The likelihood is
£(e) = TI~=l t(Xi - e) and the posterior mean of e is
- Ie£(e)de e = I £(e)de .
We can estimate the top and bottom integral using importance sampling. We
e eN draw l , ... , rv 9 and then
1 ",N ej£(ej ) !Ii~j=l~
1 ",N £(ej ) · !Ii ~j=l g(e j )
To illustrate the idea, we drew n = 2 observations. The posterior mean (computed numerically) is -0.54. Using a Normal importance sampler 9 yields an estimate of -0.74. Using a Cauchy (t-distribution with 1 degree of freedom) importance sampler yields an estimate of -0.53.·

24.4 MCMC Part I: The Metropolis-Hastings Algorithrn

I Consider once more the problem of estimating the integral I = h(x)f(x)dx.
Now we introduce Markov chain Monte Carlo (MCMC) methods. The idea is
to construct a Markov chain Xl, X 2 , ... , whose stationary distribution is f.
Under certain conditions it will then follow that

L 1
N

N

h(Xi)~ IEf(h(X)) = I.

i=l

This works because there is a law of large numbers for Markov chains; see Theorem 23.25.
The Metropolis-Hastings algorithm is a specific MCMC method that works as follows. Let q(ylx) be an arbitrary, friendly distribution (i.e., we know how to sample from q(ylx)). The conditional density q(Ylx) is called the proposal distribution. The Metropolis-Hastings algorithm creates a sequence of observations X o, Xl, ... , as follows.

Metropolis-Hastings Algorithm
Choose X o arbitrarily. Suppose we have generated XO,Xl , ... ,Xi. To generate Xi+l do the following: (1) Generate a proposal or candidate value Y rv q(yIXi ).

412

24. Simulation Methods

(2) Evaluate T == T(Xi' Y) where

. {f(Y) q(xIY) } T(X, y) = mm f(x) q(ylx)' 1 .

(3) Set

with probability T with probability 1 - T.

24.8 Remark. A simple way to execute step (3) is to generate U rv (0,1). If
U < T set Xi+1 = Y otherwise set Xi+1 = Xi.
24.9 Remark. A common choice for q(ylx) is N(x, b2 ) for some b > O. This
means that the proposal is draw from a Normal, centered at the current value. In this case, the proposal density q is symmetric, q(Ylx) = q(xly), and T simplifies to
T=mm. {ff((YX)i ) , 1} .
By construction, X o, Xl, . .. is a Markov chain. But why does this Markov
chain have f as its stationary distrihution? Before we explain why, let us first
do an example.

24.10 Example. The Cauchy distribution has density
11
f(x) = ---2·
1fl+x
Our goal is to simulate a Markov chain whose stationary distribution is f.
As suggested in the remark above, we take q(ylx) to be a N(x, b2 ). So in this case,
T(x,y)=min{j~~~, 1}=min{~:~:, I}.

So the algorithm is to draw Y rv N(Xi' b2 ) and set

{Y Y) x _

with probability T(Xi'

,+1 - Xi with probability 1 - T(Xi' Y).

The simulator requires a choice of b. Figure 24.2 shows three chains of length N = 1,000 using b = .1, b = 1 and b = 10. Setting b = .1 forces the chain to take small steps. As a result, the chain doesn't "explore" much of the sample space. The histogram from the sample does not approximate the true density very well. Setting b = 10 causes the proposals to often be far in the

24.4 MCMC Part I: The Metropolis-Hastings Algorithm 413
FIGURE 24.2. Three Metropolis chains corresponding to b = .1, b = 1, b = 10.
tails, making r small and hence we reject the proposal and keep the chain at its current position. The result is that the chain "gets stuck" at the same place quite often. Again, this meanS that the histogram from the sample does not approximate the true density very well. The middle choice avoids these extremes and results in a Markov chain sample that better represents the density SOOner. In summary, there are tuning parameters and the efficiency of the chain depends On these parameters. We'll discuss this in more detail later. _
If the sample from the Markov chain starts to "look like" the target distri-
bution f quickly, then we say that the chain is "mixing well." Constructing a
chain that mixes well is somewhat of an art. WHY IT WORKS. Recall from Chapter 23 that a distribution 7r satisfies
detailed balance for a Markov chain if
We showed that if 7r satisfies detailed balance, then it is a stationary distribution for the chain.
Because we are nOw dealing with continuous state Markov chains, we will change notation a little and write p(x, y) for the probability of making a transition from x to y. Also, let's use f(x) instead of 7r for a distribution. In

414

24. Simulation Methods

this new notation, f is a stationary distribution if f(x) = J f(y)p(y, x)dy and
detailed balance holds for f if

f(x)p(x, y) = f(y)p(y, x).

(24.7)

Detailed balance implies that f is a stationary distribution since, if detailed
balance holds, then

/ f(y)p(y, x)dy = / f(x)p(x, y)dy = f(x) / p(x, y)dy = f(x)
which shows that f(x) = J f(y)p(y, x)dy as required. Our goal is to show that
f satisfies detailed balance which will imply that f is a stationary distribution
for the chain. Consider two points x and y. Either
f(x)q(ylx) < f(y)q(xly) or f(x)q(ylx) > f(y)q(xly)·

We will ignore ties (which occur with probability zero for continuous distribu-
tions). Without loss of generality, assume that f(x)q(ylx) > f(y)q(xly). This
implies that f(y) q(xly)
r(x, y) = f(x) q(ylx)
and that r(y, x) = 1. Now p(x, y) is the probability of jumping from x to y. This requires two things: (i) the proposal distribution must generate y, and (ii) you must accept y. Thus,
f(y) q(xly) f(y) p(x, y) = q(ylx)r(x, y) = q(Ylx) f(x) q(ylx) = f(x) q(xly)·

Therefore,

f(x)p(x, y) = f(y)q(xIY)·

(24.8)

On the other hand, p(y, x) is the probability of jumping from y to x. This requires two things: (i) the proposal distribution must generate x, and (ii) you
must accept x. This occurs with probability p(y, x) = q(xly)r(y, x) = q(xly).
Hence,

f(y)p(y, x) = f(y)q(xly)·

(24.9)

Comparing (24.8) and (24.9), we see that we have shown that detailed balance holds.

24.5 MCMC Part II: Different Flavors 415
24.5 MCMC Part II: Different Flavors
There are different types of MeMe algorithm. Here we will consider a few of the most popular versions.
RANDOM-WALK-METROPOLIS-HASTINGS. In the previous section we considered drawing a proposal Y of the form

where fi comes from some distribution with density g. In other words, q(ylx) = g(y - x). We saw that in this case,

r(x, y) = mm. { 1, ff((xY))} .

This is called a random-walk-Metropolis-Hastings method. The reason

for the name is that, if we did not do the accept-reject step, we would be

simulating a random walk. The most common choice for 9 is a N(O, b2 ). The

hard part is choosing b so that the chain mixes well. A good rule of thumb is:

choose b so that you accept the proposals about 50 percent of the time.

Warning! This method doesn't make sense unless X takes values on the

whole real line. If X is restricted to some interval then it is best to transform

X. For example, if X E (0, (0) then you might take Y = logX and then

simulate the distribution for Y instead of X.

INDEPENDENcE-METRoPoLIs-HASTINGs. This is an importance-sampling

version of MeMe. We draw the proposal from a fixed distribution g. Gen-
erally, 9 is chosen to be an approximation to f. The acceptance probability

becomes

. { f(y) g(x)} r(x, y) = mm 1, f(x) g(y) .

GIBBS SAMPLING. The two previous methods can be easily adapted, in principle, to work in higher dimensions. In practice, tuning the chains to make them mix well is hard. Gibbs sampling is a way to turn a high-dimensional problem into several one-dimensional problems.
Here's how it works for a bivariate problem. Suppose that (X, Y) has density fx,Y(x, y). First, suppose that it is possible to simulate from the conditional distributions fXIY(xly) and jylx(ylx). Let (Xo, Yo) be starting values. Assume we have drawn (Xo, Yo), ... , (Xn' Yn). Then the Gibbs sampling algorithm for getting (Xn+l' Yn+d is:

416

24. Simulation Methods

Gibbs Sampling

X n +1 Yn+l repeat

!XIY(xlYn)
jylx(yIXn+d

This generalizes in the obvious way to higher dimensions.

24.11 Example (Normal Hierarchical Model). Gibbs sampling is very useful for a class of models called hierarchical models. Here is a simple case. Suppose we draw a sample of k cities. From each city we draw ni people and observe how many people Y; have a disease. Thus, Y; rv Binomial(ni, Pi). We are allowing for different disease rates in different cities. We can also think of the p~s as random draws from some distribution F. We can write this model in the following way:

F

Binomial(ni, Pi).

J We are interested in estimating the p~s and the overall disease rate pdF(p).

To proceed, it will simplify matters if we make some transformations that
allow us to use some Normal approximations. Let Pi = Yi/ni. Recall that Pi ~ N(Pi' Si) where Si = VPi(l - Pi)/ni. Let 7/Ji = log(p;j(l - Pi)) and define Zi == ;(j;i = 10g(iJi / (1 - Pi)). By the delta method,

~
7/Ji

~

N(7/Ji,

2
ai)

az where = l/(npi(l- Pi)). Experience shows that the Normal approximation

for 7/J is more accurate than the Normal approximation for P so we shall work

with 7/J. We shall treat ai as known. Furthermore, we shall take the distribution of the 7/J~s to be Normal. The hierarchical model is now

I/Ji

N(JL, T2)

Zil7/Ji

N(7/Ji, aZ)·

As yet another simplification we take T = 1. The unknown parameter are 8 = (JL, 7/Jl, ... ,I/Jk). The likelihood function is
II II £(8) ex !(l/JiIJL) !(Zill/J)

II ex exp { -~(7/Ji - JL)2 } exp { - 2~Z (Zi - ~)i)2 } .
t

24.5 MCMC Part II: Different Flavors 417

If we use the prior f (,1) ex 1 then the posterior is proportional to the likelihood.
To use Gibbs sampling, we need to find the conditional distribution of each parameter conditional on all the others. Let us begin by finding j(fLlrest) where "rest" refers to all the other variables. We can throwaway any terms that don't involve fL. Thus,

II ~ f(fLlrest) ex

exp { - (1/)i - fL)2 }

t

where
Hence we see that 111rest rv N(b, 11k). Next we will find f(1/)lrest). Again, we can throwaway any terms not involving 1/)i leaving us with
f(l/'il rest) ex exp { -~(I/'i - fL)2 } exp { - 2~; (Zi -l/'i)2 } ex exp { - 2~; (1/Ji - ei)2 }
where

and so 1/)ilrest rv N(ei,d;). The Gibbs sampling algorithm then involves iterating the following steps N times:

draw fL draw 1/JI

N(b,V2) N(el' di)

draw 1/Jk
It is understood that at each step, the most recently drawn version of each variable is used.
We generated a numerical example with k = 20 cities and n = 20 people from each city. After running the chain, we can convert each 1/Ji back into Pi
by way of Pi = eWi 1(1 + eWi ). The raw proportions are shown in Figure 24.4.
Figure 24.3 shows "trace plots" of the Markov chain for PI and 11. Figure 24.4 shows the posterior for fL based on the simulated values. The second

418 24. Simulation Methods
panel of Figure 24.4 shows the raw proportions and the Bayes estimates. Note that the Bayes estimates are "shrunk" together. The parameter T controls
the amount of shrinkage. We set T = 1 but, in practice, we should treat T as
another unknown parameter and let the data determine how much shrinkage is needed. _

C>
6o

500

1000

C>
6
U")
9~r-------------~~~------------~~_
FIGURE 24.3. Posterior simulation for Example 24.11. The top panel shows simulated values of Pl. The top panel shows simulated values of 11.

So far we assumed that we know how to draw samples from the conditionals
fXIY(xly) and fYlx(ylx). If we don't know how, we can still use the Gibbs
sampling algorithm by drawing each observation using a Metropolis-Hastings step. Let q be a proposal distribution for x and let qbe a proposal distribution for y. When we do a Metropolis step for X, we treat Y as fixed. Similarly, when we do a Metropolis step for Y, we treat X as fixed. Here are the steps:

24.5 MCMC Part II: Different Flavors 419
Metropolis within Gibbs
(Ia) Draw a proposal Z rv q(zIXn). (Ib) Evaluate

(Ie) Set

with probability T with probability 1 - T.

(2a) Draw a proposal Z rv q(zlYn).

(2b) Evaluate

(2e) Set

with probability T with probability 1 - T.

Again, this generalizes to more than two dimensions.

-0.6
I 1ft II! \\\\\\
FIGURE 24.4. Example 24.11. Top panel: posterior histogram of fJ,. Lower panel: raw proportions and the Bayes posterior estimates. The Bayes estimates have been shrunk closer together than the raw proportions.

420

24. Simulation Methods

24.6 Bibliographic Rernarks

MCMC methods go back to the effort to build the atomic bomb in World War II. They were used in various places after that, especially in spatial statistics. There was a new surge of interest in the 1990s that still continues. My main reference for this chapter was Robert and Casella (1999). See also Gelman et al. (1995) and Gilks et al. (1998).

24.7 Exercises

1. Let

_ J2 2 e- x2 /

I-

r.>= dx.

1 V 27T

(a) Estimate I using the basic Monte Carlo method. Use N = 100,000. Also, find the estimated standard error.

(b) Find an (analytical) expression for the standard error of your estimate in (a). Compare to the estimated standard error.

(c) Estimate I using importance sampling. Take g to be N(1.5,v 2 ) with
v = .1, v = 1 and v = 10. Compute the (true) standard errors in each
case. Also, plot a histogram of the values you are averaging to see if there are any extreme values.

(d) Find the optimal importance sampling function g*. What is the standard error using g*?

2. Here is a way to use importance sampling to estimate a marginal density. Let ix,y(x,y) be a bivariate density and let (X1,X2), ... ,(XN ,YN) rv ix,y.
(a) Let w(x) be an arbitrary probability density function. Let

Show that, for each x,

lx(x) ~ ix(x).

Find an expression for the variance of this estimator.
(b) Let Y rv N(O, 1) and XIY = y rv N(y, 1 + y2). Use the method in
(a) to estimate ix(x).

24.7 Exercises 421

3. Here is a method called accept-reject sampling for drawing observations from a distribution.
(a) Suppose that j is some probability density function. Let 9 be any other density and suppose that j(x) <::: Mg(x) for all x, where M is a known constant. Consider the following algorithm:
(step 1): Draw X rv 9 and U rv Unif(O, 1);
(step 2): If U <::: j(X)/(Mg(X)) set Y = X, otherwise go back to step 1. (Keep repeating until you finally get an observation.)
Show that the distribution of Y is j.
(b) Let j be a standard Normal density and let g(x) = 1/(1 + x 2 ) be
the Cauchy density. Apply the method in (a) to draw 1,000 observations from the Normal distribution. Draw a histogram of the sample to verify that the sample appears to be Normal.

4. A random variable Z has a inverse Gaussian distribution if it has density
j(z) ex z-3/2 exp { -BIZ - B: + 2VB1B2 + log ( ~) }, z > 0

where Bl > 0 and B2 > 0 are parameters. It can be shown that

fl;2 (1) #,1 1 IE(Z) = - and IE - = - + -.

Bl

Z

B2 2B2

(a) Let Bl = 1.5 and B2 = 2. Draw a sample of size 1,000 using the independence-Metropolis-Hastings method. Use a Gamma distribution as the proposal density. To assess the accuracy, compare the mean of Z and I/Z from the sample to the theoretical means Try different Gamma distributions to see if you can get an accurate sample.
(b) Draw a sample of size 1,000 using the random-walk-Metropolis-
Hastings method. Since z > 0 we cannot just use a Normal density.
One strategy is this. Let W = log Z. Find the density of W. Use the random-walk-Metropolis-Hastings method to get a sample WI, ... , WN and let Zi = eWi. Assess the accuracy of the simulation as in part (a).

5. Get the heart disease data from the book web site. Consider a Bayesian analysis of the logistic regression model

422

24. Simulation Methods

Use the flat prior f((3o, ... ,(3k) ex 1. Use the Gibbs-Metropolis algorithm to draw a sample of size 10,000 from the posterior f((3o, (31Idata). Plot histograms of the posteriors for the (3/s. Get the posterior mean and a 95 percent posterior interval for each (3j.
(b) Compare your analysis to a frequentist approach using maximum likelihood.

Bibliography
AGRESTI, A. (1990). Categorical Data Analysis. Wiley. AKAIKE, H. (1973). Information theory and an extension of the maximum
likelihood principle. Second International Symposium on Information Theory 267-281. ANDERSON, T. W. (1984). An Introduction to Multivariate Statistical Analysis (Second Edition). Wiley. BARRON, A., SCHERVISH, M. J. and WASSERMAN, L. (1999). The consistency of posterior distributions in nonparametric problems. The Annals of Statistics 27 536-561. BEECHER, H. (1959). Measurement of Subjective Responses. Oxford University Press. BENJAMINI, Y. and HOCHBERG, Y. (1995). Controlling the false discovery rate: A practical and powerful approach to multiple testing. Journal of the Royal Statistical Society, Series B, Methodological 57 289-300. BERAN, R. (2000). REACT scatterplot smoothers: Superefficiency through basis economy. Journal of the American Statistical Association 95 155-171. BERAN, R. and DUMBGEN, L. (1998). Modulation of estimators and confidence sets. The Annals of Statistics 26 1826-1856.

424 Bibliography
BERGER, J. and WOLPERT, R. (1984). The Likelihood Principle. Institute of Mathematical Statistics.
BERGER, J. O. (1985). Statistical Decision Theory and Bayesian Analysis (Second Edition). Springer-Verlag.
BERGER, J. O. and DELAMPADY, M. (1987). Testing precise hypotheses (c/r: P335-352). Statistical Science 2 317-335.
BERLINER, L. M. (1983). Improving on inadmissible estimators in the control problem. The Annals of Statistics 11 814-826.
BICKEL, P. J. and DOKSUM, K. A. (2000). Mathematical Statistics: Basic Ideas and Selected Topics, Vol. I (Second Edition). Prentice Hall.
BILLINGSLEY, P. (1979). Probability and Measure. Wiley.
BISHOP, Y. M. M., FIENBERG, S. E. and HOLLAND, P. W. (1975). Discrete Multivariate Analyses: Theory and Practice. MIT Press.
BREIMAN, L. (1992). Probability. Society for Industrial and Applied Mathematics.
BRINEGAR, C. S. (1963). Mark Twain and the Quintus Curtius Snodgrass letters: A statistical test of authorship. Journal of the American Statistical Association 58 85-96.
CARLIN, B. P. and LOUIS, T. A. (1996). Bayes and Empirical Bayes Methods for Data Analysis. Chapman & Hall.
CASELLA, G. and BERGER, R. L. (2002). Statistical Inference. Duxbury Press.
CHAUDHURI, P. and MARRON, J. S. (1999). Sizerforexplorationofstructures in curves. Journal of the American Statistical Association 94 807-823.
Cox, D. and LEWIS, P. (1966). The Statistical Analysis of Series of Events. Chapman & Hall.
Cox, D. D. (1993). An analysis of Bayesian inference for nonparametric regression. The Annals of Statistics 21 903-923.
Cox, D. R. and HINKLEY, D. V. (2000). Theoretical statistics. Chapman & Hall.

425
DAVISON, A. C. and HINKLEY, D. V. (1997). Bootstrap Methods and Their Application. Cambridge University Press.
DEGROOT, M. and SCHERVISH, M. (2002). Probability and Statistics (Third Edition). Addison-Wesley.
DEVROYE, L., GYORFI, L. and LUGOSI, G. (1996). A Probabilistic Theory of Pattern Recognition. Springer-Verlag.
DIACONIS, P. and FREEDMAN, D. (1986). On inconsistent Bayes estimates of location. The Annals of Statistics 14 68-87.
DOBSON, A. J. (2001). An introduction to generalized linear models. Chapman & Hall.
DONOHO, D. L. and JOHNSTONE, 1. M. (1994). Ideal spatial adaptation by wavelet shrinkage. Biometrika 81 425-455.
DONOHO, D. L. and JOHNSTONE, I. M. (1995). Adapting to unknown smoothness via wavelet shrinkage. Journal of the American Statistical Association 90 1200-1224.
DONOHO, D. L. and JOHNSTONE, 1. M. (1998). Minimax estimation via wavelet shrinkage. The Annals of Statistics 26 879-921.
DONOHO, D. L., JOHNSTONE, 1. M., KERKYACHARIAN, G. and PICARD, D. (1995). Wavelet shrinkage: Asymptopia? (Disc: p 337-369). Journal of the Royal Statistical Society, Series B, Methodological 57 301-337.
DUNSMORE, 1., DALY, F. ET AL. (1987). M345 Statistical Methods, Unit 9: Categorical Data. The Open University.
EDWARDS, D. (1995). Introduction to graphical modelling. Springer-Verlag.
EFROMOVICH, S. (1999). Nonparametric Curve Estimation: Methods, Theory and Applications. Springer-Verlag.
EFRON, B. (1979). Bootstrap methods: Another look at the jackknife. The Annals of Statistics 7 1-26.
EFRON, B., TIBSHIRANI, R., STOREY, J. D. and TUSHER, V. (2001). Empirical Bayes analysis of a microarray experiment. Journal of the American Statistical Association 96 1151-1160.

426 Bibliography
EFRON, B. and TIBSHIRANI, R. J. (1993). An Introduction to the Bootstrap. Chapman & Hall.
FERGUSON, T. (1967). Mathematical Statistics." a Decision Theoretic Approach. Academic Press.
FISHER, R. (1921). On the probable error of a coefficient of correlation deduced from a small sample. Metron 1 1-32.
FREEDMAN, D. (1999). Wald lecture: On the Bernstein-von Mises theorem with infinite-dimensional parameters. The Annals of Statistics 27 11191141.
FRIEDMAN, J. H. (1997). On bias, variance, 0/1-10ss, and the curse-ofdimensionality. Data Mining and Knowledge Discovery 1 55-77.
GELMAN, A., CARLIN, J. B., STERN, H. S. and RUBIN, D. B. (1995). Bayesian Data Analysis. Chapman & Hall.
GHOSAL, S., GHOSH, J. K. and VAN DER VAART, A. W. (2000). Convergence rates of posterior distributions. The Annals of Statistics 28 500-531.
GILKS, W. R., RICHARDSON, S. and SPIEGELHALTER, D. J. (1998). Markov Chain Monte Carlo in Practice. Chapman & Hall.
GRIMMETT, G. and STIRZAKER, D. (1982). Probability and Random Processes. Oxford University Press.
GUTTORP, P. (1995). Stochastic Modeling of Scientific Data. Chapman & Hall.
HALL, P. (1992). The Bootstrap and Edgeworth Expansion. Springer-Verlag.
HALVERSON, N., LEITCH, E., PRYKE, C., KOVAC, J., CARLSTROM, J., HOLZAPFEL, W., DRAGOVAN, M., CARTWRIGHT, J., MASON, B., PADIN, S., PEARSON, T., SHEPHERD, M. and READHEAD, A. (2002). DASI first results: A measurement of the cosmic microwave background angular power spectrum. Astrophysics Journal 568 38-45.
HARDLE, W. (1990). Applied nonparametric regression. Cambridge University Press.
HARDLE, W., KERKYACHARIAN, G., PICARD, D. and TSYBAKOV, A. (1998). Wavelets, Approximation, and Statistical Applications. Springer-Verlag.

427
HASTIE, T., TIBSHIRANI, R. and FRIEDMAN, J. H. (2001). The Elements of Statistical Learning: Data Mining, Inference, and Prediction. SpringerVerlag.
HERBICH, R. (2002). Learning Kernel Classifiers: Theory and Algorithms. MIT Press.
JOHNSON, R. A. and WICHERN, D. W. (1982). Applied Multivariate Statistical Analysis. Prentice-Hall.
JOHNSON, S. and JOHNSON, R. (1972). New England Journal of Medicine 287 1122-1125.
JORDAN, M. (2004). Graphical models. In Preparation.
KARR, A. (1993). Probability. Springer-Verlag.
KASS, R. E. and RAFTERY, A. E. (1995). Bayes factors. Journal of the American Statistical Association 90 773-795.
KASS, R. E. and WASSERMAN, L. (1996). The selection of prior distributions by formal rules (corr: 1998 v93 p 412). Journal of the American Statistical Association 91 1343-1370.
LARSEN, R. J. and MARX, M. L. (1986). An Introduction to Mathematical Statistics and Its Applications (Second Edition). Prentice Hall.
LAURITZEN, S. L. (1996). Graphical Models. Oxford University Press.
LEE, A. T. ET AL. (2001). A high spatial resolution analysis of the maxima-1 cosmic microwave background anisotropy data. Astrophys. J. 561 L1-L6.
LEE, P. M. (1997). Bayesian Statistics: An Introduction. Edward Arnold.
LEHMANN, E. L. (1986). Testing Statistical Hypotheses (Second Edition). Wiley.
LEHMANN, E. L. and CASELLA, G. (1998). Theory of Point Estimation. Springer-Verlag.
LOADER, C. (1999). Local regression and likelihood. Springer-Verlag.
MARRON, J. S. and WAND, M. P. (1992). Exact mean integrated squared error. The Annals of Statistics 20 712-736.

428 Bibliography
MORRISON, A., BLACK, M., LOWE, C., MACMAHON, B. and YUSA, S. (1973). Some international differences in histology and survival in breast cancer. International Journal of Cancer 11 261-267.
NETTERFIELD, C. B. ET AL. (2002). A measurement by boomerang of multiple peaks in the angular power spectrum of the cosmic microwave background. Astrophys. J. 571 604-614.
OGDEN, R. T. (1997). Essential Wavelets for Statistical Applications and Data Analysis. Birkhiiuser.
PEARL, J. (2000). Casuality: models, reasoning, and inference. Cambridge University Press.
PHILLIPS, D. and KING, E. (1988). Death takes a holiday: Mortality surrounding major social occasions. Lancet 2 728-732.
PHILLIPS, D. and SMITH, D. (1990). Postponement of death until symbolically meaningful occasions. Journal of the American Medical Association 263 1947-1961.
QUENOUILLE, M. (1949). Approximate tests of correlation in time series. Journal of the Royal Statistical Society B 11 18-84.
RICE, J. A. (1995). Mathematical Statistics and Data Analysis (Second Edition). Duxbury Press.
ROBERT, C. P. (1994). The Bayesian Choice: A Decision-theoretic Motivation. Springer-Verlag.
ROBERT, C. P. and CASELLA, G. (1999). Monte Carlo Statistical Methods. Springer-Verlag.
ROBINS, J., SCHEINES, R., SPIRTES, P. and WASSERMAN, L. (2003). Uniform convergence in causal inference. Biometrika (to appear).
ROBINS, J. M. and RITOV, Y. (1997). Toward a curse of dimensionality appropriate (CODA) asymptotic theory for semi-parametric models. Statistics in Medicine 16 285-319.
ROSENBAUM, P. (2002). Observational Studies. Springer-Verlag.
Ross, S. (2002). Probability Models for Computer Science. Academic Press.

429
ROUSSEAUW, J., DU PLESSIS, J., BENADE, A., JORDAAN, P., KOTZE, J., JOOSTE, P. and FERREIRA, J. (1983). Coronary risk factor screening in three rural communities. South African Medical Journal 64 430-436.
SCHERVISH, M. J. (1995). Theory of Statistics. Springer-Verlag.
SCHOLKOPF, B. and SMOLA, A. (2002). Learning with Kernels: Support Vector Machines, Regularization, Optimization, and Beyond. MIT Press.
SCHWARZ, G. (1978). Estimating the dimension of a model. The Annals of Statistics 6 461-464.
SCOTT, D., GOTTO, A., COLE, J. and GORRY, G. (1978). Plasma lipids as collateral risk factors in coronary artery disease: a study of 371 males with chest pain. Journal of Chronic Diseases 31 337-345.
SCOTT, D. W. (1992). Multivariate Density Estimation: Theory, Practice, and Visualization. Wiley.
SHAO, J. and Tu, D. (1995). The Jackknife and Bootstrap (German). Springer-Verlag.
SHEN, X. and WASSERMAN, L. (2001). Rates of convergence of posterior distributions. The Annals of Statistics 29 687-714.
SHORACK, G. R. and WELLNER, J. A. (1986). Empirical Processes With Applications to Statistics. Wiley.
SILVERMAN, B. W. (1986). Density Estimation for Statistics and Data Analysis. Chapman & Hall.
SPIRTES, P., GLYMOUR, C. N. and SCHEINES, R. (2000). Causation, prediction, and search. MIT Press.
TAYLOR, H. M. and KARLIN, S. (1994). An Introduction to Stochastic Modeling. Academic Press.
VAN DER LAAN, M. and ROBINS, J. (2003). Unified Methods for Censored Longitudinal Data and Causality. Springer Verlag.
VAN DER VAART, A. W. (1998). Asymptotic Statistics. Cambridge University Press.
VAN DER VAART, A. W. and WELLNER, J. A. (1996). Weak Convergence and Empirical Processes: With Applications to Statistics. Springer-Verlag.

430 Bibliography
VAPNIK, V. N. (1998). Statistical Learning Theory. Wiley.
WEISBERG, S. (1985). Applied Linear Regression. Wiley.
WHITTAKER, J. (1990). Graphical Models in Applied Multivariate Statistics. Wiley.
WRIGHT, s. (1934). The method of path coefficients. The Annals of Mathe-
matical Statistics 5 161-215.
ZHAO, L. H. (2000). Bayesian aspects of some nonparametric problems. The Annals of Statistics 28 532-552.
ZHENG, X. and LOH, W.-Y. (1995). Consistent variable selection in linear models. Journal of the American Statistical Association 90 151-156.

List of Syrnbols

lR infxEA f(x)
SUPxEA f(x)
71! (~)
f(a) n

General Symbols
real numbers
infimum: the largest number y such that
y S f (x) for all x E A think of this as the minimum of f
supremum: the smallest number y such that
y ~ f (x) for all x E A think of this as the maximum of f
71 X (71 -1) x (71 - 2) x··· x 3 x 2 x 1
n! k!(n-k)!
Gamma function fooo yCX-1 e- Ydy
sample space (set of outcomes)
outcome, element, point event (subset of n) indicator function; 1 if W E A and 0 otherwise number of points in set A

Probability Symbols

IP'(A) AilB A '0060' B Fx
fx
XrvF
f X rv
X~Y
lID
X1"",XnrvF ¢ <I>
Zcx
IE(X) = f xdF(x) IE(r(X)) = f r(x)dF(x)
V(X)
Cov(X, Y) Xl, ... ,Xn n

probability of event A A and B are independent A and B are dependent cumulative distribution function
Fx(x) = IP'(X S x)
probability density (or mass) function X has distribution F
X has density f
X and Y have the same distribution independent and identically distributed IID sample of size n from F standard Normal probability density standard Normal distribution function upper a quantile of N(O, 1): Zcx = <I>-1(1 - a) expected value (mean) of random variable X expected value (mean) of r(X) variance of random variable X covariance between X and Y data sample size

432 List of Symbols

p
---+
~
~ Xn :::::: N (,L, 0-;:,) xn = o(an ) xn = O(an )
Xn = op(an ) Xn = Op(an)

Convergence Symbols
convergence in probability convergence in distribution
convergence in quadratic mean (Xn - IL)/On ~ N(O, 1)
xn/an --+ 0 Ixn / an I is bounded for large n
p
Xn/an---+O IXn/an I is bounded in probability for large n

Statistical Models
statistical model; a set of distribution functions, density functions or regression functions parameter estimate of parameter statistical functional (the mean, for example) likelihood function

Useful Math Facts

+ + + ... ex

=

~CX) xk L-k=O k!

=

1

x

2xT2

L ,L\-,0J0=k r j = l-r for 0 < r < 1
+ limn --+ oo (1 ~) n = ea

Stirling's approximation: n! :::::: nn e-nj27rn

THE GAMMA FUNCTION. The Gamma function is defined by

for 0; ~ O. If 0; > 1 then r(o;) = (0; -l)r(o; -1). If n is a positive integer then
r(n) = (n - I)!. Some special values are: r(l) = 1 and [(1/2) = ft.

Distribution Point mass at a

Table of Distributions

PDF or probability function

mean

I(x = a)

a

variance 0

MGF
eat

Bernoulli(p) Binomial(n, p)

pX(l _ p)I-X (~)px(1- p)n-x

P

p(l - p)

np

np(l - p)

pet +(l-p)
(pet + (1 _ p))n

Geometric (p) Poisson(>.) Uniform(a, b) Normal(IL,0-2) Exponential(;3) Gamma(a,;3) Beta(a, ;3)
tu

p(l - p)x-l I(x ~ 1)
)..;c e -)..
-x!-
I(a < X < b)/(b - a)
_ 1 _ e - ( x - I " ) 2 / ( 2 0 - 2)
o-yI21f e-;P/O
-13-
xu-1e-:r/,a
r(a)f3"

rr((ao)or+(ff33))

x 00-1(1

_, X

)13-1

r(vt")

1

r(!f) ( 1+:1; ") (v+l)/2 .

lip

rI-p

1-(Ip-elp)el (t < -log(l - p) )

>.

>.

e A( e ' - I )

-a+2b-

-(b1--a2)2-

e bt _eat
(b-a)t

IL

0- 2

exp {{Lt + 0-~t2 }

;3

;32

1-~Pt (t < 1/;3)

a;3

a;32

(l~f3tr (t < 1/;3)

s:

a a+f3

(rt- (f)

af3 (a+f3)2(a+f3+ 1)

1 + 2.: 0k=0 1

r=O1 a+oof3++r r ) ktTk

c+
,0....,

«rn

o (if V> 1) ~ u-2 (if v> 2)

does not exist

Sr::r
0
W

X~

1 r(p/2)2

P

/

2

x(p/2)-l

e-x/2

p

2p

( 1~2t y/2 (t < 1/2)

"Ww'"

Index

x2 distribution, 30
accept-reject sampling, 421 accessible, 387 actions, 193 acyclic, 266 additive regression, 323 adjacent, 281 adjusted treatment effect, 259 admissibility
Bayes rules, 202 admissible, 202 AIC (Akaike Information Criterion),
220 Aliens, 271 alternative hypothesis, 95, 149 ancestor, 265 aperiodic, 390 arcs, 281 associated, 239 association, 253

association is not causation, 16.1, 253
assume, 8 asymptotic Normality, 128 asymptotic theory, 71 asymptotically Normal, 92, 126 asymptotically optimal, 126 asymptotically uniformly integrable,
81 average causal effect, 252 average treatment effect, 252 Axiom 1, 5 Axiom 2,5 Axiom 3,5 axioms of probability, 5
backfitting, 324 bagging, 375 bandwidth, 313 Bayes classification rule, 351 Bayes Estimators, 197 Bayes risk, 195

Bayes rules, 197 admissibility, 202
Bayes' Theorem, 12, 1.17, 12 Bayesian inference, 89, 175
strengths and weaknesses, 185 Bayesian network, 263 Bayesian philosophy, 175 Bayesian testing, 184 Benjamini and Hochberg, 10.26, 167 Benjamini-Hochberg (BH) method,
167 Bernoulli distribution, 26, 29 Beta distribution, 30 bias-variance tradeoff, 305 Bibliographic Remarks, 13 Binomial distribution, 26 bins, 303, 306 binwidth, 306 bivariate distribution, 31 Bonferroni method, 166 boosting, 375 bootstrap, 107
parametric, 134 Bootstrap Confidence Intervals, 110 bootstrap percentile interval, 111 bootstrap pivotal confidence, 111 Bootstrap variance estimation, 109 branching process, 398
candidate, 411 Cauchy distribution, 30
Cauchy-Schwartz inequality, 4.8, 66
causal odds ratio, 252 causal regression function, 256 causal relative risk, 253 Central Limit Theorem (CLT), 5.8,
77 Chapman-Kolmogorov equations, 23.9,
385

Index 435
Chebyshev's inequality, 4.2, 64 checking assumptions, 135 child, 265 classes, 387 classification, 349 classification rule, 349 classification trees, 360 classifier
assessing error rate, 362 clique, 285 closed, 388 CLT, 77 collider, 265 comparing risk functions, 194 complete, 281, 328 composite hypothesis, 151 Computer Experiment, 16, 17 concave, 66 conditional causal effect, 255 conditional distribution, 36 conditional expectation, 54 conditional independence, 264
minimal, 287 conditional likelihood, 213 Conditional Probability, 10 conditional probability, 10, 10 conditional probability density func-
tion, 37 conditional probability mass func-
tion, 36 conditioning by intervention, 274 conditioning by observation, 274 confidence band, 99 confidence bands, 323 confidence interval, 65, 92 confidence set, 92 confounding variables, 257 conjugate, 179

436 Index
consistency relationship, 252 consistent, 90, 126 continuity of probabilities, 1.B, 7 continuous, 23 converges in distribution, 72 converges in probability, 72 convex, 66 correlation, 52
confidence interval, 234 cosine basis, 329 counterfactual, 251, 252 counting process, 395 covariance, 52 covariance matrix, 232 covariate, 209 coverage, 92 critical value, 150 cross-validation, 363 cross-validation estimator of risk,
310 cumulative distribution function, 20 curse of dimensionality, 319 curve estimation, 89, 303
d-connected, 270 d-separated, 270 DAG, 266 data mining, vii decision rule, 193 decision theory, 193 decomposition theorem, 23.17, 389 delta method, 5.13, 79, 131 density estimation, 312
kernel approach, 312 orthogonal function approach,
331 dependent, 34, 239 dependent variable, 89 derive, 8

descendant, 265 detail coefficients, 342 detailed balance, 391, 413 deviance, 299 directed acyclic graph, 266 directed graph, 264 directed path, 265 discrete, 22 discrete uniform distribution, 26 discrete wavelet transform (DWT),
344 discriminant function, 354 discrimination, 349 disjoint, 5 distribution
X2 , 30 Bernoulli, 26, 29 Beta, 30 Binomial, 26 Cauchy, 30 conditional, 36 discrete uniform, 26 Gaussian, 28 Geometric, 26 Multinomial, 39 multivariate Normal, 39 Normal, 28 point mass, 26 Poisson, 27
t, 30 Uniform, 27 Dvoretzky-Kiefer-Wolfowitz (DKW)
inequality, 7.5, 98
edges, 281 efficient, 126, 131 elements, 3 EM algorithm, 144 empirical distribution function, 97

empirical error rate, 351 empirical probability measure, 367 empirical risk minimization, 352, 365 Epanechnikov kernel, 312 equal in distribution, 25 equivariant, 126 ergodic, 390 Events, 3 events, 3 evidence, 157 Exercises, 13 expectation, 47
conditional, 54 expected value, 47 exponential families, 140
faithful, 270 false discovery proportion, 166 false discovery rate, 166 FDP, 166 FDR, 166 feature, 89, 209 first moment, 47 first quartile, 25 Fisher information, 128 Fisher information matrix, 133 Fisher linear discriminant function,
356 fitted line, 210 fitted values, 210 frequentist (or classical), 175 frequentist inference, 89
Gamma function, 29 Gaussian classifier, 353 Gaussian distribution, 28 Geometric distribution, 26 Gibbs sampling, 416 Gini index, 361

Index 437
Glivenko-Cantelli theorem, 7.4, 98
goodness-of-fit tests, 168 graphical, 294 graphical log-linear models, 294
Haar father wavelet, 340 Haar scaling function, 340 Haar wavelet regression, 343 hierarchical log-linear model, 296 hierarchical model, 56 hierarchical models, 416 histogram, 303, 305 histogram estimator, 306
Hoeffding's inequality, 4.4, 64, 365
homogeneous, 384 homogeneous Poisson process, 396 Horwitz-Thompson, 188 hypothesis testing, 94
identifiable, 126 importance sampling, 408 impurity, 360 inadmissible, 202 independent, 8, ~, 34 Independent Events, 8 independent random variables, 34 independent variable, 89 index set, 381 indicator function, 5 inequalities, 63 inner product, 327 integrated squared error (ISE), 304 intensity function, 395 interarrival times, 396 intervene, 273 intervention, 273 Introduction, 3 invariant, 390 inverse Gaussian distribution, 421

438 Index
irreducible, 388 iterated expectations, 3.24, 55
jackknife, 115 James-Stein estimator, 204 Jeffreys-Lindley paradox, 192 Jensen's inequality, 4.9, 66 joint mass function, 31
K-fold cross-validation, 364 k-nearest-neighbors, 375 kernel, 312 kernel density estimator, 312,313 kernelization, 371 Kolmogorov-Smirnov test, 245 Kullback-Leibler distance, 126
Laplace transform, 56 large sample theory, 71 law of large numbers, 72 law of total probability, 1.16, 12 lazy, 3.6, 48 least favorable prior, 198 least squares estimates, 211 leave-one-out cross-validation, 220 leaves, 361 Legendre polynomials, 329 length, 327 level, 150 likelihood function, 122 likelihood ratio statistic, 164 likelihood ratio test, 164 limit theory, 71 limiting distribution, 391 linear algebra notation, 231 linear classifier, 353 linearly separable, 369 log odds ratio, 240 log-likelihood function, 122

log-linear expansion, 292 log-linear model, 286 log-linear models, 291 logistic regression, 223 loss function, 193
machine learning, vii Manalahobis distance, 353 marginal Distribution, 33 marginal distribution, 197 Markov chain, 383, 383 Markov condition, 267 Markov equivalent, 271 Markov's inequality, 4.1, 63 maximal clique, 285 maximum likelihood, 122 maximum likelihood estimates
computing, 142 maximum likelihood estimator
consistent, 126 maximum risk, 195 mean, 47 mean integrated squared error (MISE),
304 mean recurrence time, 390 mean squared error, 91 measurable, 13, 43 median, 25
bootstrap, 109 Mercer's theorem, 373 method of moments estimator, 121 Metropolis within Gibbs, 419 Metropolis-Hastings algorithm, 411
Mill's inequality, 4.7, 65
minimal conditional independence, 287
minimal sufficient, 138 minimax rule, 197, 198 missing data, 187

mixture of Normals, 143 model generator, 297 model selection, 218 moment generating function, 56 moments, 49 monotone decreasing, 5 monotone increasing, 5 Monte Carlo integration, 404 Monte Carlo integration method,
404 Monty Hall, 14 most powerful, 152 mother Haar wavelet, 341 MSE, 91 Multinomial, 235 Multinomial distribution, 39 multiparameter models, 133 multiple regression, 216 multiple testing, 165 multiresolution analysis, 341 Multivariate central limit theorem,
5.12,78 Multivariate Delta Method, 5.15,
79 multivariate Normal, 234 multivariate Normal distribution, 39 mutually exclusive, 5
Nadaraya-Watson kernel estimator, 319
naive Bayes classifier, 359 natural parameter, 141 natural sufficient statistic, 140 neural networks, 376 Newton-Raphson, 143 Neyman-Pearson, 10.30, 170 nodes, 281 non-collider, 265 non-null, 390

Index 439
nonparametric model, 88 nonparametric regression, 319
kernel approach, 319 orthogonal function approach,
337 norm, 327 normal, 327 Normal distribution, 28 Normal-based confidence interval,
6.16,94 normalizing constant, 177, 403 not, 10 nuisance parameter, 120 nuisance parameters, 88 null, 390 null hypothesis, 94, 149
observational studies, 257 odds ratio, 240 olive statistics, i one-parameter exponential family,
140 one-sided test, 151 optimality, 130 orthogonal, 327 orthogonal functions, 327 orthonormal, 328 orthonormal basis, 328 outcome, 89 overfitting, 218
p-value, 156, 157 pairwise Markov graph, 283 parameter of interest, 120 parameter space, 88 parameters, 26 parametric bootstrap, 134 parametric model, 87 parent, 265

440 Index
Parseval's relation, 329 partition, 5 path, 281 Pearson's X2 test, 241 period, 390 periodic, 390 permutation distribution, 162 permutation test, 161 permutation test:algorithm, 163 perpendicular, 327 persistent, 388 pivot, 110 plug-in estimator, 99 point estimation, 90 point mass distribution, 26 pointwise asymptotic, 95 Poisson distribution, 27 Poisson process, 394, 395 positive definite, 231 posterior, 176
large sample properties, 181 posterior risk, 197 potential, 285 potential outcomes, 251 power function, 150 precision matrix, 232 predicted values, 210 prediction, 89, 215 prediction interval, 13.11,215 prediction risk, 219 predictor, 89 predictor variable, 209 prior distribution, 176 Probability, 5 probability, 5 probability distribution, 5, .Q. probability function, 22 probability inequalities, 63

probability mass function, 22 probability measure, 5, .Q. Probability on Finite Sample Spaces,
7 proposal, 411
quadratic discriminant analysis (QDA), 353
quantile function, 25 quantiles, 102
random variable, 19 independent, 34
random vector, 38, 232 random walk, 59 random-walk-Metropolis-Hastings,
415 realizations, 3 recurrence time, 390 recurrent, 388 regression, 89, 209, 335
nonparametric, 319 regression function, 89, 209, 351 regression through the origin, 226 regressor, 89 rejection region, 150 relative risk, 248 represents, 266 residual sums of squares, 211 residuals, 210 response variable, 89, 209 reweighted least squares, 224 risk, 194, 304 rule of the lazy statistician, 3.6, 48 Rules of d-separation, 270
sample correlation, 102 sample mean, 51 sample outcomes, 3

sample quantile, 102 sample space, 3 Sample Spaces and Events, 3 sample variance, 51 sampling distribution, 90 saturated model, 298, 299 scaling coefficient, 342 score function, 128 se,90 shatter coefficient, 367 shattered, 367 simple hypothesis, 151 simple linear regression, 210 Simpson's paradox, 259 simulation, 108, 180 size, 150 slack variables, 371 Slutzky's theorem, 75 smoothing, 303 smoothing parameter, 303 Sobolev space, 88 sojourn times, 396 spatially inhomogeneous, 340 standard deviation, 51 standard error, 90 standard Normal distribution, 28 state space, 381 stationary, 390 statistic, 61, 107, 137 statistical functional, 89, 99 statistical model, 87 Stein's paradox, 204 stochastic process, 381 Stone's theorem, 20.16, 316 strong law of large numbers, 5.18,
81 strongly inadmissible, 204 subjectivism, 181

Index 441
sufficiency, 137 sufficient statistic, 137 Summary of Terminology, 4 supervised learning, 349 support vector machines, 368 support vectors, 370
t distribution, 30 t-test, 170 test statistic, 150 third quartile, 25 thresholding, 342 training error, 219 training error rate, 351 training set, 363 transformations of random variables,
41 transient, 388 true error rate, 351 two-sided test, 151 type I error, 150 type II error, 150 types of convergence, 72
unbiased, 90 underfitting, 218 undirected graph, 281 uniform asymptotic, 95 Uniform distribution, 27 unshielded collider, 266
validation set, 363 Vapnik-Chervonenkis, 366 variance, 51
conditional, 55 variance-covariance matrix, 53 vertices, 281
waiting times, 396 Wald test, 153

442 Index
wavelets, 340 weak law of large numbers (WLLN),
5.6,76
Zheng-Loh method, 222

Springer Texts in Statistics (continued from page ii)
Lehmann: Testing Statistical Hypotheses, Second Edition Lehmann and Casella: Theory of Point Estimation, Second Edition Lindman: Analysis of Variance in Experimental Design Lindsey: Applying Generalized Linear Models Madansky: Prescriptions for Working Statisticians McPherson: Applying and Interpreting Statistics: A Comprehensive Guide,
Second Edition Mueller: Basic Principles of Structural Equation Modeling: An Introduction to
LISREL and EQS Nguyen and Rogers: Fundamentals of Mathematical Statistics: Volume I:
Probability for Statistics Nguyen and Rogers: Fundamentals of Mathematical Statistics: Volume II:
Statistical Inference Noether: Introduction to Statistics: The Nonparametric Way Nolan and Speed: Stat Labs: Mathematical Statistics Through Applications Peters: Counting for Something: Statistical Principles and Personalities Pfeiffer: Probability for Applications Pitman: Probability Rawlings, Pantula and Dickey: Applied Regression Analysis Robert: The Bayesian Choice: From Decision-Theoretic Foundations to
Computational Implementation, Second Edition Robert and Casella: Monte Carlo Statistical Methods, Second Edition Rose and Smith: Mathematical Statistics with Mathematica Ruppert: Statistics and Finance: An Introduction Santner and Duffy: The Statistical Analysis of Discrete Data Saville and Wood: Statistical Methods: The Geometric Approach Sen and Srivastava: Regression Analysis: Theory, Methods, and Applications Shao: Mathematical Statistics, Second Edition Shorack: Probability for Statisticians Shumway and Stoffer: Time Series Analysis and Its Applications Simonofl: Analyzing Categorical Data Terrell: Mathematical Statistics: A Unified Introduction Timm: Applied Multivariate Analysis Toutenburg: Statistical Analysis of Designed Experiments, Second Edition Wasserman: All of St(!tistics: A Concise Course in Statistical Inference Whittle: Probability via Expectation, Fourth Edition Zacks: Introduction to Reliability Analysis: Probability Models
and Statistical Methods

ALSO AVAILABLE FROM SPRINGER!

AIIlhony C. Add....... MuaJRIeaI
AMtacm..u
Exploring Multivariate Data
with the Forward Search

Thomas J. SantJIu Brian. J. Williams William I . No..
The Design and Analysis of Computer
Experiments

Design and Analysis of DNA Mlcroarray Investigations

EXPLORING MULTIVARIATE DATA WITH THE FORWARD SEARCH
ANTHONY C. ATKINSON, MARCO RIANI , and ANDREA CERIOU
T his book is about usi ng graphs to explore and model continuous multivariate data. Such data are often modeled usi ng the multi variate normal distTibution an d there is a literature of weighty statistical tomes presenti ng the mathematical theory of th is activity. This book is very di fferen t. It focu es on ways of exploring whether the data do indeed have a normal di stribution. Outlier detection, transformations to normal ity and the detection of clusters and u nsuspected influential subsets are emphasized.
2003/650 PP ./HAROCOVER/ISBN ()'387-40852-5 SPRINGER SERIES IN STATISTICS
THE DESIGN AND ANALYSIS OF COMPUTER EXPERIMENTS
THOMAS J. SANTNER, BRIAN J. WILLIAMS, and WILUAM NOTZ
This book describes methods for designi ng and analyzi ng experiments conducted using computer code in lieu of a physical experiment.lt discusse how to select the val ues of the factors at which t orun the code (the design of the computer experi ment) in light of the research objectives of the experimenter. It also provides techniques for analyzing the res ult ing dala so as to achieve these research goals, and it illustrates these methods with code t hat is avai lable to the reader atthe companion web site for the book.
2003/240 PP./HARDCOVER/ ISBN 0-387-9542()'1 SPRINGER SER IES IN STATISTICS

DESIGN AND ANALYSIS OF DNA MICROARRAY INVESTIGATIONS
RICHARD M. SIMON, EDWARD L. KORN , LISA 1M . MCSHANE, MICHAEL D. RADMACHER , GEORGE W. WRIGHT an d YINGDONG ZHAO
This book is targeted to biologists with limited statistical background and to statisticians and computer scientists interested in being effective collaborators on multi-discipl inary DNA microarray projects. State-of-the-art analysis methods are presented with minimal mathematical notation and a focus on concepts. This book provides a sound preparation fordesig ning microarray studies that have clear objectives, and for selecting analysis tools and strategies that prov ide clear and valid answers. The book offer an in depth understanding of the design and analysis of experiments uti lizin g microarrays and should benefit scientists regardless of what software packages they prefer.
2003/ S04 PP./HAROCOVER/ISBN 0-387-00135-2 STATISTICS FOR BIOLOGY AND HEALTH
To Order or for Infonnation:
In the Americas: CAll.: 1-BOO-SPRINGER or FAX: (201) 348-4505 · WRITE: Springer-Verlag New Yotl< , Inc .. Dept. S5634, PO Box 2485, Secaucus, NJ 07096-2485 · VISIT: Your local technical bookstore · E-MAll: orderS@spri nger·ny.com
Olltside the Americas: CAU.: +49 (0) 6221345-217/B · FAX: + 49 (0) 6221 345-229 · WRITE: Springer Customer Service. Haberstrasse 7, 691.26 Heidelberg , Germany . E-MAIl: orderS@sprlnger.de
PROMOTION: S5634

