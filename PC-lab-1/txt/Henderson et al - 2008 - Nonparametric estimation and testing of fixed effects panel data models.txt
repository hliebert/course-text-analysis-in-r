ARTICLE IN PRESS

Journal of Econometrics 144 (2008) 257–275
www.elsevier.com/locate/jeconom

Nonparametric estimation and testing of ﬁxed effects
panel data models
Daniel J. Hendersona,, Raymond J. Carrollb, Qi Lic,d
a

Department of Economics, State University of New York at Binghamton, Binghamton, NY 13902-6000, USA
b
Department of Statistics, Texas A&M University, College Station, TX 77843-3134, USA
c
Department of Economics, Texas A&M University, College Station, TX 77843-4228, USA
d
Department of Economics, Tsinghua University, Beijing 100084, PR China
Received 11 May 2006; received in revised form 17 January 2008; accepted 31 January 2008
Available online 11 February 2008

Abstract
In this paper we consider the problem of estimating nonparametric panel data models with ﬁxed effects. We introduce an
iterative nonparametric kernel estimator. We also extend the estimation method to the case of a semiparametric partially
linear ﬁxed effects model. To determine whether a parametric, semiparametric or nonparametric model is appropriate, we
propose test statistics to test between the three alternatives in practice. We further propose a test statistic for testing the null
hypothesis of random effects against ﬁxed effects in a nonparametric panel data regression model. Simulations are used to
examine the ﬁnite sample performance of the proposed estimators and the test statistics.
Published by Elsevier B.V.
Keywords: Fixed effects models; Model speciﬁcation tests; Nonparametric kernel method; Panel data; Partially linear model; Proﬁle
method; Random effects models; Semiparametric efﬁciency bound

1. Introduction
Nonparametric and semiparametric kernel methods are increasingly popular tools for statisticians/
econometricians. Researchers have begun to gravitate towards nonparametric and semiparametric methods
when there is little prior knowledge on speciﬁc (regression) functional forms or some known parametric
speciﬁcations are deemed inadequate for the problem at hand. This often occurs when formal rejection of a
parametric model yields no clues as to the direction in which to search for an improved parametric model. This
growing popularity of nonparametric methods stems from their ability to relax functional form assumptions
of an unknown model and let the data determine a function tailored to the data. This capacity to potentially
reveal structure in the data that may be missed by common parametric speciﬁcations has encouraged growth
in a variety of areas of statistics and econometrics.
The estimation of panel data models is no exception. The focus has been on both semiparametric (e.g. see
Ke and Wang, 2001; Li and Stengos, 1996; Ullah and Roy, 1998) and nonparametric estimation of random
Corresponding author. Tel.: +1 607 777 4480; fax: +1 607 777 2681.

E-mail addresses: djhender@binghamton.edu (D.J. Henderson), carroll@stat.tamu.edu (R.J. Carroll), qi@econmail.tamu.edu (Q. Li).
0304-4076/$ - see front matter Published by Elsevier B.V.
doi:10.1016/j.jeconom.2008.01.005

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

258

effects models (e.g. see Henderson and Ullah, 2005; Lin and Carroll, 2000, 2001, 2006; Lin et al., 2004; Lin and
Ying, 2001; Ruckstuhl et al., 2000; Wang, 2003; Wu and Zhang, 2002). Estimation of these types of models is
appropriate when the individual effect is independent of the regressors. This is common in many applications,
where researchers often treat any unobserved individual heterogeneity as being distributed independently of
the regressors. However, random effects estimators are inconsistent if the true model is one with ﬁxed effects,
i.e., individual effects which are correlated with the regressors (e.g. see Wooldridge, 2002). Indeed, economists
often view the assumptions for the random effects model as being unsupported by the data. In light of this we
seek to develop both nonparametric and semiparametric ﬁxed effects estimation procedures. These procedures
will be consistent under either the random or ﬁxed effects assumptions.
We present both nonparametric and semiparametric models which either take or do not take the correlation
structure into account when estimating a ﬁxed effects nonparametric/semiparametric panel data model. Our results
show that for the nonparametric model, incorporating or ignoring the within-subject correlation leads to consistent
estimation results. This is shown with a sketch of the proof similar to that in Lin and Carroll (2006). However,
incorporation of the correlation leads to an improvement in the estimated variance when the number of time
periods is greater than two. For the semiparametric partially linear model, we also ﬁnd that taking into account the
correlation structure leads to efﬁcient estimation of the ﬁnite dimensional (parametric) parameter.
Given that nonparametric estimators suffer from the curse of dimensionality, it is desirable to apply the
consistent estimator with the fastest rate of convergence. Although nonparametric models are consistent under
minimal
assumptions, their rate of convergence is relatively slow. In contrast, semiparametric models allow for
pﬃﬃﬃ
n-convergent estimation of the parametric components, and parametric models allow all parameters to be
estimated at that rate when their respective functional form restrictions are appropriate. To choose between
parametric, semiparametric and nonparametric alternatives we propose in Section 4.1 tests between these three
models, using a simple and practical bootstrap testing approach.
The question of whether to use random or ﬁxed effects naturally arises with panel data. We know that when the
individual effect is correlated with any of the regressors, the random effects estimator becomes biased and
inconsistent. The ﬁxed effect estimator wipes out these individual effects and leads to consistent estimates. On the
other hand, if the individual effects are independent of the regressors, both estimators are consistent. In this case
the random effects estimator is more efﬁcient. This trade-off is common in econometrics and is often resolved using
a testing procedure. In Section 4.2 we develop a Hausman style test for the presence of ﬁxed versus random effects.
We suggest a separate bootstrap procedure for the implementation of this test in practice.
The remainder of the paper is organized as follows: Section 2 gives the nonparametric estimation procedures
when we both account for and ignore the correlation structure. Section 3 generalizes the results to the case of a
semiparametric partially linear model. In Section 4 we propose test statistics for testing between parametric,
semiparametric and nonparametric alternatives as well as a test statistic for testing random effects against
ﬁxed effects in nonparametric panel data regression models. Section 5 examines the ﬁnite sample properties
with a small Monte Carlo study. Finally, Section 6 gives concluding remarks.
2. Fixed effects nonparametric panel data models
Consider the following nonparametric panel data regression model with ﬁxed effects:
Y it ¼ yðZ it Þ þ mi þ nit

ði ¼ 1; . . . ; n; t ¼ 1; . . . ; mÞ,

(1)

where the functional form of yðÞ is not speciﬁed. The covariate Z it ¼ ðZ it;1 ; . . . ; Z it;q Þ is of dimension q, and all
other variables are scalars. The random errors nit are assumed to be i.i.d. with a zero mean, ﬁnite variance and
independent of Zit for all i and t.1 Further, mi has a zero mean and ﬁnite variance. We allow mi to be correlated
with Z it with an unknown correlation structure. Hence, (1) is a ﬁxed effects model. Alternatively, when mi is
assumed to be uncorrelated with Z it , model (1) is a random effects model. Note that we only consider the
balanced data case in this paper for notational simplicity. The results of this paper can be generalized to the
unbalanced data case.
1

The independence between nit and Zit can be relaxed so that nit and Zit are mean independent ðEðvit jZit Þ ¼ 0Þ. Simulations not reported
in the paper were performed to conﬁrm this. These results are available upon request.

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

259

We consider the usual case of large n and ﬁxed m, and assume that the data are independent across the i
index. We take a ﬁrst difference to remove the ﬁxed effects
Ye it  Y it  Y i1 ¼ yðZ it Þ  yðZ i1 Þ þ nit  ni1 .

(2)

Note that the above difference is to subtract observation t ¼ 1 from t. One can also use the alternative
transformation of Y it  Y i;t1 ¼ yðZ it Þ  yðZ i;t1 Þ þ nit  ni;t1 to remove the ﬁxed effects. The asymptotic
analysis is similar under various transformations. In this paper we will focus on the transformation given in
(2). From (1) we know that EfyðZit Þg ¼ EðY it Þ. Under this condition, yðÞ deﬁned in (2) is identiﬁed. We
discuss two nonparametric estimators for yðÞ, one which utilizes the variance structure of the terms Ye it , and
the other which ignores the structure. We will show that the former estimator is asymptotically more efﬁcient
when m42.
2.1. An estimator using the variance structure
Our goal in this section is to derive an estimator which exploits the variance structure. We start by deﬁning
enit ¼ nit  ni1 and eni ¼ ðeni2 ; . . . ; enim ÞT , where the superscript ðÞT denotes the transpose of a matrix ðÞ. The
variance–covariance matrix of eni , deﬁned as S ¼ covðeni jZ i1 ; . . . ; Z im Þ ¼ covðeni Þ, is given by
S ¼ s2n ðI m1 þ em1 eTm1 Þ,
where I m1 is an identity matrix of dimension ðm  1Þ  ðm  1Þ, and em1 is a ðm  1Þ  1 vector of ones. It is
T
easy to check that S1 ¼ s2
n ðI m1  em1 em1 =mÞ. Following Wang (2003) and Lin and Carroll (2006) we use
a proﬁle likelihood approach to estimate yðÞ. The criterion function for individual i is given by ðY i ¼
ðY i1 ; . . . ; Y im ÞÞ
Li ðÞ ¼ LðY i ; yi Þ ¼ 12ðYe i  yi þ yi1 em1 ÞT S1 ðYe i  yi þ yi1 em1 Þ,

(3)

where Ye i ¼ ðYe i2 ; . . . ; Ye im Þ , yit ¼ yðZ it Þ and yi ¼ ðyi2 ; . . . ; yim Þ .
Deﬁning Li;ty ¼ qLi ðÞ=qyit , and Li;tsy ¼ q2 Li ðÞ=ðqyit qyis Þ, from (3) we obtain
T

T

Li;1y ¼ eTm1 S1 ðYe i  yi þ yi1 em1 Þ,
Li;ty ¼ cTt1 S1 ðYe i  yi þ yi1 em1 Þ for tX2,
where ct1 is a vector of dimension ðm  1Þ  1 with the ðt  1Þ element being 1 and all other elements being 0.
Here we will maximize a kernel-weighted objective function. We start by deﬁning the product kernel
K h ðvÞ ¼

q
Y

h1
j kðvj =hj Þ,

j¼1

where kðÞ is a univariate kernel function. Further, deﬁne ðZ it  zÞ=h ¼ fðZit;1  z1 Þ=h1 ; . . . ; ðZ it;q  zq Þ=hq gT
and Git ðz; hÞ ¼ ½1; fðZ it  zÞ=hgT T , where G it is of dimension ðq þ 1Þ  1. Finally, deﬁne yð1Þ ðzÞ ¼ qyðzÞ=qz as
the ﬁrst order derivative of yðÞ with respect to z. We estimate the unknown function yðzÞ by solving the ﬁrst
order condition
0¼

n X
m
X

K h ðZit  zÞG it ðz; hÞLi;ty ½Y i ; b
yðZi1 Þ; . . . ; b
yðzÞ þ fðZ it  zÞ=hgb
yð1Þ ðzÞ; . . . ; b
yðZim Þ,

(4)

i¼1 t¼1
ð1Þ
where the argument Li;ty is b
yðZ is Þ for sat and b
yðzÞ þ fðZ it  zÞ=hgb
y ðzÞ when s ¼ t.

2.1.1. An iterative procedure for nonparametric estimation
Eq. (4) suggests the following iterative procedure. Suppose the current estimate of yðzÞ at the ½‘  1th step is
b
y½‘1 ðzÞ. Then the next step estimate of yðzÞ is b
y½‘ ðzÞ ¼ b
a0 ðzÞ, where ðb
a0 ; b
a1 Þ solve the following equation:
0¼

n X
m
X
i¼1 t¼1

K h ðZit  zÞG it ðz; hÞLi;ty ½Y i ; b
y½‘1 ðZ i1 Þ; . . . ; b
a0 þ fðZ it  zÞ=hgTb
y½‘1 ðZ im Þ.
a1 ; . . . ; b

(5)

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

260

Below we give an algorithm for estimating yðÞ. We note here that we need to use the restriction that
n X
m
X

fY it  b
yðZ it Þg ¼ 0

i¼1 t¼1

in order for yðÞ to be uniquely deﬁned based on (2), since EðY it Þ ¼ EfyðZ it Þg. The algorithm is linear in the
Y it ’s. By deﬁning
0
1
Y i2  b
y½‘1 ðZi2 Þ
B
C
B
C
..
y½‘1 ðZi1 Þgem1 ,
H i;½‘1 ¼ B
C  fY i1  b
.
@
A
Y im  b
y½‘1 ðZim Þ
we get
0¼

n
X

K h ðZ i1  zÞGi1 ½eTm1 S1 H i;½‘1 þ eTm1 S1 em1 fb
y½‘1 ðZ i1 Þ  G Ti1 ða0 ; a1 ÞT g

i¼1

þ

n X
m
X

K h ðZ it  zÞG it ½cTt1 S1 H i;½‘1 þ cTt1 S1 ct1 fb
y½‘1 ðZ it Þ  G Tit ða0 ; a1 ÞT g,

i¼1 t¼2

where G it ¼ G it ðz; hÞ. Further, by deﬁning
(
)
n
m
X
X
1
T
1
T
T
1
T
D1 ¼ n
em1 S em1 K h ðZ i1  zÞGi1 Gi1 þ
ct1 S ct1 K h ðZ it  zÞG it G it ,
i¼1

D2 ¼ n

1

(
n
X

t¼2

eTm1 S1 em1 K h ðZ i1

i¼1

D3 ¼ n1

m
X

cTt1 S1 ct1 K h ðZ it

)
b
 zÞG it y½‘1 ðZ it Þ ,

t¼2

(
n
m
X
X
i¼1

y½‘1 ðZi1 Þ þ
 zÞGi1b

)
K h ðZ it  zÞG it cTt1 S1 H i;½‘1  K h ðZi1  zÞG i1 eTm1 S1 H i;½‘1 ,

t¼2

a0 ðzÞ; b
a1 ðzÞgT ¼ D1
and then solving for a0 and a1 leads to fb
1 ðD2 þ D3 Þ. The next step estimate of yðzÞ is given
by b
y½‘ ðzÞ ¼ b
a0 ðzÞ, while b
a1 ðzÞ gives the next step derivative estimator of yðzÞ.
Wang (2003) considered the random effects case. In her model a consistent initial estimator can be obtained
by replacing S by an identity matrix. The simulations reported in Wang (2003) show that a one-step iteration
is nearly as efﬁcient as the result for full convergence, and that it usually only takes 3–4 iterations to achieve
full convergence. In our case, even when one replaces S by an identity matrix, (2) is an additive model with the
restriction that the two additive functions have the same functional form, and an initial consistent estimator of
yðÞ can be obtained by the standard backﬁtting method, see for example Opsomer and Ruppert (1997).
Alternatively, one can use a nonparametric series method to obtain an initial consistent estimator of yðÞ. The
advantage of using the series method to estimate an additive model is that one can easily impose the additive
structure. This is because the method involves only a least squares estimation procedure. We suggest to use the
series method to obtain an initial estimator for yðÞ.
2.1.2. Asymptotic theory
To study the asymptotic distribution of b
yðzÞ, we ﬁrst give some regularity conditions and deﬁnitions.
Assumption 1. The random variables ðY it ; Z it Þ are independent and identically distributed across the i index
and Y it has ﬁnite fourth moments for all t. Let f t ðÞ denote the density function of Z it ; then both f t ðÞ and yðÞ
are twice continuously differentiable functions. Let St denote the support of Zit ; then f t ðzÞ is bounded from
both below and above by some positive constant for all z 2 St . The initial estimator of yðzÞ that is used to start
the iteration is a consistent estimator of yðÞ.

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

261

Assumption
2. The univariate kernel function kðÞ is a bounded, symmetric probability density function where
def R
k2 ¼ kðvÞv2 dv is ﬁnite. As n ! 1, hr ! 0 for all r ¼ 1; . . . ; q and nh1    hq ! 1.
We ﬁrst make the following general deﬁnitions, the calculations of which will follow after the statement of
the main result. Deﬁne
OðzÞ ¼ 

m
X

f t ðzÞEfLi;tty jZit ¼ zg.

t¼1

Further deﬁne it ¼ Lty fYe i ; Z i ; yðZi1 Þ; . . . ; yðZit Þ; . . . ; yðZim Þg,
Zn ¼

q
X

h2s þ ðnh1    hq Þ1=2 ,

s¼1

and deﬁne br ðzÞ to be a bounded2 and continuous function that is the solution to
br ðzÞ ¼

m X
m
X
k2
yrr ðzÞ 
f t ðzÞEfLi;tsy ðÞbr ðZ is ÞjZit ¼ zg=OðzÞ,
2
t¼1 sat

(6)

where yrr ðzÞ ¼ q2 yðzÞ=qz2r . Note that for our model Ltsy is non-stochastic. Speciﬁcally, Li;1s ¼ 1=ðms2n Þ for
sa1 and Li;tsy ¼ 1=ðms2n Þ for t; sX2 and tas. Hence, (6) can be written as
br ðzÞ ¼

m X
m
k2
1 X
yrr ðzÞ þ
d ts f t ðzÞEfbr ðZ is ÞjZit ¼ zg=OðzÞ,
2
msn t¼1 sat
2

(7)

where d ts ¼ 1 if t ¼ 1 or s ¼ 1, and d ts ¼ 1 otherwise. If Z it and Z is are independent for tas, we obtain a
closed form solution for br ðzÞ. In the general dependence case, br ðÞ does not have a closed form expression.
Here we state our main result. A sketch of the proof is in the appendix and it follows along the lines of the
more detailed arguments in Lin and Carroll (2006).
Main result: The estimator b
yðzÞ has the asymptotic expansion
b
yðzÞ  yðzÞ ¼ ðk2 =2Þ

q
X

h2r br ðzÞ  n1

n X
m
X

K h ðZ it  zÞis =OðzÞ þ op ðZn Þ.

(8)

i¼1 t¼1

r¼1

Thus, the asymptotic bias and variance of b
yðzÞ are
!
q
q
X
X
bias ¼ ðk2 =2Þ
h2r br ðzÞ þ o
h2r ,
r¼1

variance ¼

r¼1

kq
1
þ ofðnh1    hq Þ1 g.
nh1    hq OðzÞ

Remark 1. The particular form of our problem means that many of the terms have simple expressions. In
particular,
Li;11y ¼ eTm1 S1 em1 ¼ ðm  1Þ=ðms2n Þ,
Li;tty ¼ cTt1 S1 ct1 ¼ ðm  1Þ=ðms2n Þ for tX2,
Li;1ty ¼ cTt1 S1 em1 ¼ 
2

1
ms2n

for tX2,

Note that br ðzÞ is bounded because Z is bounded. However, we leave the rigorous proof of the existence and continuity of br ðÞ to future
research.

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

262

Li;tsy ¼ cTt1 S1 cs1 ¼

OðzÞ ¼ 

m
X

1
ms2n

for t; sX2 and tas,

f t ðzÞEfLtty ðÞjZ t ¼ zg ¼

t¼1

m
m 1X
f ðzÞ.
ms2n t¼1 t

Remark 2. If we further assume that f t ðzÞ ¼ f ðzÞ for all t, then the asymptotic variance becomes
avarf

pﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
yðzÞg ¼
nh1    hqb

s2n kq
.
ðm  1Þf ðzÞ

(9)

R
Under the assumption that hr n1=ð4þqÞ , and by deﬁning k ¼ k2 ðvÞ dv, we obtain the following asymptotic
distribution for b
yðzÞ:
(
)
q
X
1=2 b
2
yðzÞ  yðzÞ 
ðnh1    hq Þ
hr br ðzÞ ! Nð0; kq =OðzÞÞ in distribution.
(10)
r¼1

Remark 3. Obviously, OðzÞ can be consistently estimated by
b ¼ ðm  1Þ
OðzÞ

m
X

fbt ðzÞ=ðmb
s2n Þ,

t¼1

where
fbt ðzÞ ¼ n1

n
X

K h ðZit  zÞ

i¼1

and
b
s2n ¼

n X
m
X
1
ðY it  Y i1  fb
yðZ it Þ  b
yðZ i1 ÞgÞ2 .
2nðm  1Þ i¼1 t¼2

s2n , where
If Z it is strictly stationary in t, OðzÞ ¼ ðm  1Þf ðzÞ=s2n , and one can estimate OðzÞ by ðm  1ÞfbðzÞ=b
fbðzÞ ¼ ðnmÞ1

n X
m
X

K h ðZit  zÞ.

i¼1 t¼1

Here we note that b
s2n is only necessary in order to estimate the covariance matrix of the limit distribution. It is
not necessary for the estimates of the unknown function and its derivative because given our speciﬁcation, as
discussed in Remark 1, in the estimation of fb
a0 ðzÞ; b
a1 ðzÞgT ¼ D1
s2n simply drops out.
1 ðD2 þ D3 Þ, b
Remark 4. In the appendix we provide an outline proof for the main result (8). Therefore, one may view (8) as
a conjecture, rather than a rigorous proved result. Our proof follows similar arguments as in Wang (2003) and
Lin and Carroll (2006) who did an iterative construction of their estimators. We leave the rigorous proof of the
main results of the paper to future research. Also, as a referee correctly pointed out, since we did not provide
formal proofs, the imposed assumptions presented in the paper may not be sufﬁcient. It is possible that
additional and potentially restrictive assumptions may have to be added to make the results presented in the
paper rigorously valid.
2.2. An estimator ignoring the correlation structure
In this section we study the asymptotic distribution of a ﬁxed effects estimator that ignores the variance
structure S. Past research in nonparametric panel data estimation has shown that the ‘working independence’
method has the same rate of convergence as methods which incorporate the correlation structure (e.g. see Lin
and Carroll, 2000). Thus, here we examine the estimator ignoring this structure to determine whether our
estimator has an asymptotic improvement. In this case the objective function (3) is modiﬁed by replacing S1

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

263

by I m1 , and thus becomes
Li ðÞ ¼ LðY i ; yi Þ ¼ 12ðYe i  yi þ yi1 em1 ÞT ðYe i  yi þ yi1 em1 Þ.
Then from (3) we obtain Li;ty and Li;tsy as
Li;1y ¼ eTm1 ðYe i  yi þ yi1 em1 Þ,
Li;ty ¼ cTt1 ðYe i  yi þ yi1 em1 Þ for tX2.
The iterative procedure is similar to before. Eq. (5) remains of the same form, and we solve
0¼

n
X

K h ðZ i1  zÞG i1 ½eTm1 H i;½‘1 þ ðm  1Þfb
y½‘1 ðZ i1 Þ  G Ti1 ða0 ; a1 ÞT g

i¼1

þ

n X
m
X

K h ðZit  zÞG it ½cTt1 H i;½‘1 þ fb
y½‘1 ðZ it Þ  GTit ða0 ; a1 ÞT g.

i¼1 t¼2

By replacing S1 with I m1 , and noting that eTm1 em1 ¼ m  1 and cTt1 ct1 ¼ 1, analogous to the deﬁnitions
of D1 , D2 and D3 , we obtain
(
)
n
m
X
X
T
T
1
J1 ¼ n
ðm  1ÞK h ðZi1  zÞG i1 G i1 þ
K h ðZ it  zÞG it G it ,
i¼1

J2 ¼ n

1

n
X

t¼2

(
y½‘1 ðZ i1 Þ þ
ðm  1ÞK h ðZi1  zÞG i1b

i¼1

m
X

)
b
K h ðZ it  zÞGit y½‘1 ðZ it Þ ,

t¼2

(

J3 ¼ n

1

n
m
X
X
i¼1

)
K h ðZit 

zÞG it cTt1 H i;½‘1

 K h ðZi1 

zÞG i1 eTm1 H i;½‘1

.

t¼2

a0 ðzÞ; e
a1 ðzÞg ¼ J 1
Then solving for a0 and a1 leads to fe
1 ðJ 2 þ J 3 Þ. One can use the results of Section 2.1 to
derive the asymptotic distribution of e
a0 ðzÞ by replacing S1 with I m1 . However, direct calculation of the
asymptotic variance is quite simple. Under the assumption that f t ðzÞ ¼ f ðzÞ for all t ¼ 1; . . . ; m, it is easy to see
that J 1 ¼ 2ðm  1Þf ðzÞdiagð1; k2 I m1 Þ þ op ð1Þ. It can be shown that the asymptotic variance of J 2 þ J 3 comes
from J 3 by replacing H i;½‘1 with eni .
We decompose J 3 into J 3 ¼ J 3;1  J 3;2 ,
J 3;1 ¼ n1

n X
m
X

K h ðZ it  zÞG it cTt1 H i;½‘1

i¼1 t¼2

and
J 3;2 ¼ n1

n
X

K h ðZ i1  zÞGi1 eTm1 H i;½‘1 .

i¼1

It is also easy to show that
avarðJ 3;1 Þ ¼
where k22 ¼

R

1
f2ðm  1Þs2n kq1 f ðzÞgdiagðk; k22 I m1 Þ,
nh1    hq

v2 kðvÞ2 dv, and

avarðJ 3;2 Þ ¼

1
fðm  1Þms2n kq1 f ðzÞgdiagðk; k22 I m1 Þ,
nh1    hq

and that covðJ 3;1 ; J 3;2 Þ has an order smaller than Ofðnh1    hq Þ1 g. Hence, we have that


1
ð2 þ mÞ
avarðJ 3 Þ ¼
f4ðm  1Þs2n kq1 f ðzÞg
diagðk; k22 I m1 Þ.
nh1    hq
4

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

264

Thus, we immediately obtain the asymptotic variance of fe
a0 ðzÞ; e
a1 ðzÞgT which is given by





 ð2 þ mÞ
1
1
2 q1
diag k; ðk22 =k22 ÞI m1
4ðm

1Þs
k
f
ðzÞ
n
2
2 nh    h
4
4ðm  1Þ f ðzÞ
1
q
¼

1
kq1 s2n ð2 þ mÞ
diagfk; ðk22 =k22 ÞI m1 g.
nh1    hq ðm  1Þf ðzÞ 4

(11)

Comparing (11) with (9), we see that the relative asymptotic variance of e
a0 ðzÞ and b
a0 ðzÞ is
avarðe
a0 ðzÞÞ 2 þ m
,
¼
avarðb
a0 ðzÞÞ
4
which equals one if m ¼ 2 (as expected) and is greater than one when m42.
Even though the estimator that ignores the variance structure S has a large asymptotic variance (when
m42), it has the advantage that it is robust to possible misspeciﬁcation in S. While the asymptotic distribution
of the estimator that uses S1 requires that the variance structure S is correctly speciﬁed. For example, if nit is
serially correlated but one ignores the serial correlation, then form of S will be misspeciﬁed. Finally, the
estimator that ignores S is computationally simple compared with the estimator that uses S1 .
Here we note that when we replace S1 with I m1 , Li;11y ¼ ðm  1Þ and Li;tty ¼ 1 for tX2, and Li;tsy ¼
1 for t; s ¼ 1; . . . ; m  1 when t is different from s. Thus, OðzÞ ¼ 2ðm  1Þf ðzÞ and the leading bias term
becomes
br ðzÞ ¼
¼

m X
m
X
k2
yrr ðzÞ 
f t ðzÞEfLi;tsy ðÞbr ðZ is ÞjZ it ¼ zg=OðzÞ
2
t¼1 sat
q
m
X
X
k2
1
yrr ðzÞ þ
Efbr ðZ is ÞjZit ¼ zg.
2ðm  1Þ t¼1 s¼1;sat
2

3. A partially linear model with ﬁxed effects
Nonparametric regression suffers from the curse of dimensionality problem when the dimension of the
regressors is high. In this section we consider a semiparametric partially linear model where only a subset of
the regressors enter the regression model nonparametrically. A partially linear panel data regression model
with ﬁxed effects is given by
Y it ¼ X Tit b þ yðZ it Þ þ mi þ nit

ði ¼ 1; . . . ; n; t ¼ 1; . . . ; mÞ,

where X it is of dimension d  1, and the other variables are as deﬁned in Section 2.
Again we take the ﬁrst difference to eliminate the ﬁxed effects:
Ye it ¼ Xe Tit b þ yðZ it Þ  yðZ i1 Þ þ enit

ði ¼ 1; . . . ; n; t ¼ 2; . . . ; mÞ,

(12)

where Xe it  X it  X i1 . The criterion function for individual i is modiﬁed to
Li ðÞ ¼ LðY i ; X i ; b; yi Þ
T
T
¼  12ðYe i  Xe i b  yi þ yi1 em1 ÞT S1 ðYe i  Xe i b  yi þ yi1 em1 Þ,

where Xe i ¼ ðXe i2 ; . . . ; Xe im ÞT . The derivative functions become
Li;1y ¼ em1 S1 ðYe i  Xe i b  yi þ yi1 em1 Þ,
Li;ty ¼ ct1 S1 ðYe i  Xe i b  yi  yi1 em1 Þ for tX2,
and the second derivatives of Li;tsy ðÞ are analogous to those given in Section 2.
Following Wang et al. (2005), we estimate yðÞ and b by a proﬁle-kernel approach. For given values
of b and a current stage estimator b
yðÞ, we estimate yðzÞ by b
a0 , where b
a0 and b
a1 satisfy the following

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

265

ﬁrst order condition:
n X
m
X

0¼

i¼1 t¼1

K h ðZit  zÞG it ðz; hÞLty ½Y i ; X i ; b; b
yðZ i1 ; bÞ; . . . ; b
a0 þ fðZ it  zÞ=hgTb
yðZim ; bÞ.
a1 ; . . . ; b

Compare (12) with (2). Let b
yy ðÞ be the nonparametric estimator in model (2) and let b
yx;r ðÞ be the
nonparametric estimator in model (2) if Y it is replaced by the rth component of X it . Further, let
b
yx ðzÞ ¼ fb
yx;1 ðzÞ; . . . ; b
yx;d ðzÞgT . It is obvious by the linearity of the smoother and from (12) that
b
yðz; bÞ ¼ b
yy ðzÞ  b
yx ðzÞT b.

(13)

This means that ðq=qbÞb
yðz; bÞ ¼ b
yx ðzÞ. Therefore, we estimate b by the minimization of
2

3T
2
3
T
T
Ye i2  Xe i2 b  fb
Ye i2  Xe i2 b  fb
yðZ i2 ; bÞ  b
yðZ i1 ; bÞg
yðZ i2 ; bÞ  b
yðZ i1 ; bÞg
n 6
7
6
7
X
6
7 1 6
7
..
..
S
6
7
6
7.
.
.
4
5
4
5
i¼1
T
T
Ye im  Xe im b  fb
Ye im  Xe im b  fb
yðZ im ; bÞ  b
yðZ i1 ; bÞg
yðZim ; bÞ  b
yðZ i1 ; bÞg
We can now invoke (13) to get an explicit solution for b
b and an explicit covariance matrix for the asymptotic
distribution of n1=2 ðb
b  bÞ. By deﬁning Ye it ¼ Ye it  fb
yy ðZ it Þ  b
yy ðZ i1 Þg, Ye i ¼ ðYe i2 ; . . . ; Ye im ÞT , Xe it ¼ Xe it 
b
b
e
e
e
fyx ðZit Þ  yx ðZ i1 Þg and X i ¼ ðX i2 ; . . . ; X im Þ, the estimate of b is given by
b
b¼

n
X
i¼1

!1
Xe Ti S1 Xe i

n
X

T
Xe i S1 Ye i

!
.

i¼1

Note that since we have a closed form solution for b
b, no iteration is needed. We estimate yðÞ by the same
T
b whenever it occurs. At
method as discussed in Section 2 except now that Ye it is replaced by Ye it  Xe it b
convergence, the resulting b
yðzÞ has the same asymptotic distribution as described in Section 2. Then of course,
we have a nonparametric regression model as covered in Section 2. Next, notice that b
b  b ¼ Op ðn1=2 Þ
b
converges to zero faster than the nonparametric estimator yðzÞ  yðzÞ. Therefore, replacing b by b
b will not
affect the asymptotic distribution of b
yðzÞ.
To derive the asymptotic distribution of b
b, we ﬁrst give some deﬁnitions. Let G denote the space of
bounded, twice continuously differentiable functions. Deﬁne gðÞ ¼ ðg1 ðÞ; g2 ðÞ; . . . ; gd ðÞÞ to be a 1  d vector
function, with gj 2 G. Deﬁne a d  1 vector function fðÞ as the function that minimizes the following
objective function:
20
1T
0
13
Xe i2  fgðZ i2 Þ  gðZ i1 Þg
Xe i2  fgðZ i2 Þ  gðZi1 Þg
6B
C 1 B
C7
6
..
..
C S B
C7
fðÞ ¼ argmin E6B
.
.
.
@
A
@
A7
4
5
fðÞ¼gðÞ2G
Xe im  fgðZ im Þ  gðZ i1 Þg
Xe im  fgðZ im Þ  gðZ i1 Þg
Here we modify Assumption 1 as Assumption 3.
Assumption 3. The random variables ðY it ; X it ; Z it Þ are independent and identically distributed across the i
index and Y it and each component of X it has ﬁnite fourth moments for all t. Let f t ðÞ denote the density
function of Zit ; then both f t ðÞ and yðÞ are twice continuously differentiable functions. Let St denote the
support of Z it ; then f t ðzÞ is bounded from both below and above by some positive constant for all z 2 St . The
initial estimator of yðzÞ that is used to start the iteration is a consistent estimator of yðÞ.
Then, under Assumptions 2 and 3, we obtain the asymptotic distribution for the convergent b
b as
given by
n1=2 ðb
b  bÞ ! Normal ð0; V 1 Þ in distribution,

(14)

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

266

where
20
1T
0
13
Xe i2  ffðZ i2 Þ  fðZ i1 Þg
Xe i2  ffðZ i2 Þ  fðZ i1 Þg
6B
C 1 B
C7
6
..
..
C S B
C7
.
V ¼ E6B
.
.
A
@
A7
4@
5
Xe im  ffðZ im Þ  fðZ i1 Þg
Xe im  ffðZ im Þ  fðZ i1 Þg
Moreover, V can be consistently estimated by
b¼1
V
n

n
X

b 1 Xe i ,
Xe Ti S

i¼1

b 1 is a consistent estimator of S, which relies on a
where Xe i is deﬁned in constructing our estimator b
b, S
2
consistent estimator of sn . It is easy to show that
b
s2n ¼ ½2nðm  1Þ1

n X
m
X

b2
½Ye it  Xe it b

i¼1 t¼2

is a consistent estimator of s2n .
Bickel et al. (1993), Bickel and Kwon (2002), and Chamberlain (1992) provide general treatment on
inferences and efﬁcient bounds analysis for semiparametric models. By following the same arguments as in Lin
and Carroll (2006), one can show that V 1 is the semiparametric efﬁcient lower bound for the asymptotic
variance, among all estimators of b based upon the differences Y it  Y i1 , when the regression errors nit in (1)
have a Gaussian distribution. Su and Ullah (2006) consider an alternative of b in a ﬁxed effects partially linear
panel data model. However, they did not address the problem of semiparametric efﬁcient estimation of b.
4. Speciﬁcation testing
In this section we consider two types of speciﬁcation tests. The ﬁrst type is to test the functional form
assumptions of a regression. Speciﬁcally, we present tests to test a parametric model versus a semiparametric
model, a parametric model versus a nonparametric model, and ﬁnally, a semiparametric model versus a
nonparametric model. The other type is to test a random effects against a ﬁxed effects speciﬁcation.
4.1. Regression functional form specification tests
Our tests consider the following possible speciﬁcations:
Y it ¼ X Tit b þ ZTit g þ uit ,

(15)

Y it ¼ X Tit b þ yðZ it Þ þ uit ,

(16)

Y it ¼ gðX it ; Z it Þ þ uit ,

(17)

and the functional forms of y : Rq ! R; and g : Rdþq ! R are not speciﬁed. We assume that uit ¼ mi þ nit ,
and we allow for the possibility that mi is correlated with X it and/or Zit in an unspeciﬁed manner.
We let e
b and eg denote consistent estimators of b and g based on model (15), and let b
b and b
yðÞ denote the
consistent estimators of b and yðÞ based on model (16). Finally, gbðÞ denotes the consistent estimator of gðÞ
based on (17).
In our ﬁrst test we use Ha0 to denote the null hypothesis of the linear regression model (15), against Ha1 : the
corresponding alternative is the partially linear model (16).
Our test statistic for testing Ha0 is
I an ¼

n X
m
1 X
b þ ZTit eg  X Tit b
bb
yðZ it Þ2 .
½X T e
nm i¼1 t¼1 it

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

267

Under Ha0 , I an converges to 0 in probability, and I an converges to a positive constant under Ha1 . Therefore, I an
can be used to detect whether Ha0 is true or not. We conjecture that I an , after proper normalization and centering,
is asymptotically normally distributed. However, the derivation of such a result is quite complicated due to the
iterative procedure involved in computing b
yðÞ. We leave the study of its asymptotic distribution to future
research. Even if one derives the asymptotic distribution of I an , it is well known that asymptotic theory does not
provide good approximations for nonparametric kernel-based tests in ﬁnite sample applications (e.g. see Härdle
and Mammen, 1993; Lee and Ullah, 2000; Li and Wang, 1998; Whang and Andrews, 1993). Therefore, we
propose the following bootstrap procedure to approximate the ﬁnite sample null distribution of I an .
Let ubi;a ¼ ðb
ui2;a ; . . . ; ubim;a ÞT , where
ubit;a ¼ ueit;a  ðnmÞ1

n X
m
X
j¼1 s¼2

uejs;a

b  ðZ it  Z i1 ÞTeg. We obtain
is the re-centered parametric ﬁxed effects residual, ueit;a ¼ Y it  Y i1  ðX it  X i1 ÞT e
n

uj;a gj¼1 with replacement. Note here that we are resampling the entire set of ﬁxed
ui;a by random draw from fb
effect vector residuals for a particular cross-sectional unit (t ¼ 2; . . . ; m). Then generate
b þ ðZ it  Zi1 ÞTeg þ uit;a . Call fX it ; Zit ; Y it;a g the bootstrap sample. Use the bootstrap
Y it  Y i1 ¼ ðX it  X i1 ÞT e
sample to estimate b and g based on model (15), say e
b and eg , and estimate b and yðÞ based on model (16),
a
a
e g, b
y ðÞ. Then compute I a
b and b
yðÞ replaced by e
b , eg , b
b
say b
b and b
n , where I n is obtained from I n with b, e

a
a
and b
y ðÞ, respectively. We use the empirical distribution of I to approximate the null distribution of I . We
n

n

expect that this bootstrap procedure works because Y it is generated according to the null ﬁxed effects (linear)
3
a
a
model. Hence, I a
n mimics the null behavior of I n , whether the null hypothesis H0 holds true or not.
We use Hb0 to denote the null hypothesis that model (15) is the correct speciﬁcation and we use Hb1 to denote
that (17) is the correct model. For testing Hb0 we use the test statistic
I bn ¼

n X
m
1 X
b þ Z Tit eg  gbðX it ; Z it Þ2 .
½X T e
nm i¼1 t¼1 it

Since Ha0 and Hb0 are identical (both testing a linear null model), we use the same bootstrap sample
b
b
e g, and gbðÞ being replaced by e
fX it ; Z it ; Y it;a g to compute I bn to obtain I b
b ,
n , where I n is obtained from I n with b, e
b
b


eg , and gb ðÞ, respectively. We use the empirical distribution of I n to approximate the null distribution of I n .
Finally, we use Hc0 to denote the null hypothesis that model (16) is the correct speciﬁcation and we use Hc1 to
denote that (17) is the correct model. For testing Hc0 we use the test statistic
I cn ¼

n X
m
1 X
bþb
yðZit Þ  gbðX it ; Zit Þ2 .
½X T b
nm i¼1 t¼1 it

Let ubi;c ¼ ðb
ui2;c ; . . . ; ubim;c ÞT , where
ubit;c ¼ ueit;c  ðnmÞ1

n X
m
X
j¼1 s¼2

uejs;c

b  fb
yðZ it Þ  b
and ueit;c ¼ Y it  Y i1  ðX it  X i1 ÞT b
yðZ i1 Þg. We obtain ui;c from fb
uj;c gnj¼1 with replacement. Again
note that we are resampling the entire set of vector residuals for a particular cross-sectional unit (t ¼ 2; . . . ; m).
bþb
yðZ it Þ  b
yðZ i1 Þ þ uit;c . Call fX it ; Z it ; Y it;c g the bootstrap sample.
Next generate Y it  Y i1 ¼ ðX it  X i1 ÞT b
Use the bootstrap sample to estimate b and yðÞ based on model (16), say b
b and b
y ðÞ, and estimate gðÞ based
b b
b ,
yðÞ and gbðÞ replaced by b
on model (16), say gb ðÞ. Then compute I c , where I c is obtained from I c with b,
n

n

n

b
y ðÞ and gb ðÞ, respectively. As before, we use the empirical distribution of the bootstrapped test statistic I c
n to
approximate the null distribution of I cn .
The ﬁnite sample performance of the above bootstrap procedures is examined via simulations in Section 5.
3

For a similar bootstrap procedure in the context of additive nonparametric models see Fan and Jiang (2005).

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

268

4.2. Testing random versus fixed effects: a nonparametric Hausman test
The efﬁciency/consistency trade off between random and ﬁxed effects models is well known in econometrics.
In this section we discuss how to test for the presence of random effects versus ﬁxed effects in a nonparametric
panel data model. The model remains as (1) with uit ¼ mi þ nit . The random effects speciﬁcation assumes that
mi is uncorrelated with the regressor Z it , while for the ﬁxed effects case, mi is allowed to be correlated with Z it
in an unknown way.
We are interested in testing the null hypothesis that mi is a random effect versus the alternative hypothesis
that mi is a ﬁxed effect. The null hypothesis can be written as
H0 : Eðmi jZi1 ; . . . ; Z im Þ ¼ 0

almost everywhere.

The alternative hypothesis is the negation of the null, i.e., H1 : Eðmi jZ i1 ; . . . ; Z im Þa0 on a set with positive
measure. We maintain the assumption that Eðnit jZ i1 ; . . . ; Z im Þ ¼ 0 under either H0 or H1 . The null and the
alternative hypotheses can then be equivalently written as
H0 : Eðuit jZ i1 ; . . . ; Zim Þ ¼ 0

almost everywhere,

where uit ¼ mi þ nit , and
H1 : Eðuit jZ i1 ; . . . ; Zim Þa0 on a set with positive measure.
Our proposed test is based on the sample analogue of J ¼ Efuit Eðuit jZ it Þf ðZit Þg. Note that J ¼ 0 under H0
and J ¼ E½fEðuit jZit Þg2 f ðZ it Þ40 if the null is false. Hence, J serves as a proper candidate for testing H0 .
For notational simplicity, we impose an additional assumption that f t ðÞ ¼ f ðÞ for all t ¼ 1; . . . ; m. Let b
yðzÞ
denote a consistent estimator of yðzÞ under the ﬁxed effects assumption. Then a consistent estimator of uit is
given by ubit ¼ yit  b
yðzit Þ. Our feasible test statistic is given by
Jb ¼ ðnmÞ1

n X
m
X
i¼1 t¼1

b it ðb
uit jZ it Þfbit ðZit Þ
ubit E

¼ fnmðnm  1Þg1

n X
m X
n
X

m
X

i¼1 t¼1 j¼1 s¼1;fj;sgafi;tg

ubit ubjs K h;it;js ,

where K h;it;js ¼ K h ðZit  Z js Þ,
K h ðvÞ ¼

q
Y

h1
l kðv‘ =h‘ Þ,

‘¼1

kðÞ is a univariate kernel function, and
uit jZ it Þ ¼ fnðm  1Þg1
Eit ðb

n
X

m
X

j¼1 s¼1;fjsgafitg

ubjs K h;it;js =fbit ðZ it Þ

and
fbit ðZ it Þ ¼ fnðm  1Þg1

n
X

m
X

K h:it;js

j¼1 s¼1;js;fjsgafitg

are the leave-one-out estimators of Eðuit jZit Þ and f ðZ it Þ, respectively. Li and Wang (1998) consider a similar
test statistic with cross-sectional data. As in Li and Wang (1998), we use the leave-one-out kernel estimator in
order to remove an asymptotic non-negligible center term.
p
p
It can be shown that Jb is a consistent estimator of J. Hence, Jb ! 0 under the null, and Jb ! C if H0 is false,
where C40 is a positive constant. Therefore, one rejects H0 when Jb takes large positive values.
b after proper normalization and centering, is asymptotically normally
Again, we conjecture that J,
distributed. However, the derivation of this result is also complicated due to the iterative procedure involved
in computing b
yðÞ. We leave the study of its asymptotic distribution to future research. Therefore, we propose
b
the following bootstrap procedure to approximate the ﬁnite sample null distribution of J.

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

269

The bootstrap procedure below will be different from those of Section 4.1 because the null hypothesis is a
random effects model now, and we cannot use the ﬁxed effects residual as the basis for the bootstrap. Instead
we must base it on the random effects residual to carry out the bootstrap procedure so that the null model is
imposed on the bootstrap sample. Let ubi ¼ ðb
ui1 ; . . . ; ubim ÞT , where ubit ¼ Y it  e
yðZ it Þ is the residual from the
e
random effects model,
and
yðzÞ
is
the
random
effects
estimator
of
yðzÞ.
Compute
theptwo-point
wild bootstrap
pﬃﬃﬃ
pﬃﬃﬃ
pﬃﬃﬃ
ﬃﬃﬃ
errors by ui ¼ fð1  5Þ=2gb
ui with probability r ¼ ð1 þ 5Þ=ð2 5Þ and ui ¼ fð1 þ 5Þ=2gb
ui with probability
1  r. Then generate Y it via Y it ¼ e
yðZit Þ þ uit . Call fZ it ; Y it gn;m
Using the bootstrap
i¼1;t¼1 the bootstrap sample.

sample to estimate yðzÞ via the random effects method, denote the estimate by e
y ðzÞ, and then obtain the
bootstrap residual by ubit ¼ Y it  e
y ðZit Þ. The bootstrap test statistic Jb is obtained as in Jb except that ubit (b
ujs ) is


replaced by ubit (b
ujs ) wherever it occurs. This process is repeated a large number (B) of times. The empirical
b
distribution of the B bootstrap statistics is then used to approximate the null distribution of the test statistic J.
The above bootstrap-based testing procedure can be generalized to test random effects against ﬁxed effects in
a semiparametric partially linear model where the modiﬁcations are that one replaces the nonparametric
residual by the residual obtained from estimating the partially linear model, and also generates Y it based on a
partially linear model.
The ﬁnite sample performance of this bootstrap procedure is also examined via simulations in Section 5.
5. Monte Carlo simulations
5.1. Nonparametric regression
This section uses Monte Carlo simulations to examine the ﬁnite sample performance of the nonparametric
panel data estimators. Following a methodology similar to Wang (2003), the following data generating
process is used: Y it ¼ sinð2Z it Þ þ mi þ nit , where Z it is i.i.d. uniform½1; 1, and nit is i.i.d. Normalð0; 1Þ. Let vi
denote an i.i.d. uniform½1; 1 sequence of random variables. We generate mi ¼ vi þ c0 Z i , where
Z i ¼ m1

m
X

Zit .

t¼1

c0 ¼ 0 gives the random effects model, and c0 a0 leads to the ﬁxed effects model. Note that Zit and mi are
correlated for the ﬁxed effects model. The variances of nit and vi are both ﬁxed at unity. We use the Gaussian
kernel function and the bandwidth is selected as h ¼ b
sz ðnmÞ1=5 , where b
sz is the sample standard deviation of
n;m
4
fZ it gi¼1;t¼1 .
In the simulations reported below, for the ﬁxed effects estimator we give results both when the variance
structure S1 is ignored or is used. For the random effects estimator, we ignore the variance structure. Since
m ¼ 3 in this example, we expect slightly better mean squared error efﬁciency for the estimator that accounts
for the correlation. In this case, the random effects estimator is a simple local constant estimator (no iteration
is needed). However, as noted previously, the ﬁxed effects estimation procedure is iterative, even when one
ignores the correlation structure of S1 , and thus requires information on the previous iteration of yðÞ. Thus
we set the initial value of yðÞ as follows: ﬁrst, we use OLS to estimate the model using a fourth order
polynomial. Next, we calculate the expected value of Y given Z for each observation using the OLS estimates
and use these as our starting values for yðÞ. Finally, we use the iterative method discussed in Section 2 to
obtain estimates of the ﬁxed effects estimator using the initial estimate of yðÞ as described above. The
convergence criterion is set to be
n X
m
n X
m
X
X
b
y½‘1 ðZit Þ2 o0:001.
fb
y½‘ ðZ it Þ  b
y½‘1 ðZit Þg2 =
i¼1 t¼1

i¼1 t¼1

Unlike the random effects iterative procedure in Wang (2003) which performs well with a one-step iteration,
the ﬁxed effects estimation generally needs an average of ﬁve to six iterations to obtain convergence.
4

We use this simple bandwidth selector for computational ease. The relative performance of the estimators are not signiﬁcantly affected
by slight changes in the bandwidth values.

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

270

Table 1
Average mean squared errors (AMSE) of the ﬁxed and random effects estimators when the data generation process is a random effects
model and when it is a ﬁxed effects model
Data process

Random
Fixed

Random effects

Fixed effects without S

Fixed effects with S

n ¼ 50

n ¼ 100

n ¼ 200

n ¼ 50

n ¼ 100

n ¼ 200

n ¼ 50

n ¼ 100

n ¼ 200

0.0477
0.4377

0.0274
0.4269

0.0154
0.4266

0.0538
0.1290

0.0302
0.0816

0.0175
0.0475

0.0495
0.1197

0.0283
0.0739

0.0158
0.0436

Fixed effects without S means that the covariance matrix S is assumed to be the identity, while Fixed effects with S uses S in order to
improve efﬁciency. The number of time periods (m) is set equal to three. The number of Monte Carlo replications (M) is set equal to 1000.

We use both ﬁxed effects and random effects methods to estimate yðÞ, and compute the average mean
squared error (AMSE) by
AMSE ¼ M 1

M
n X
m
X
X
ðnmÞ1
fb
yðZit;l Þ  yðZ it;l Þg2 ,
l¼1

i¼1 t¼1

where the subscript l denotes the lth replication. In each experiment we use M ¼ 1000 replications. The
number of time periods (m) is ﬁxed at three, while the number of cross-sections (n) is varied to be 50, 100 and
200. The estimation results are given in Table 1. In summary, we ﬁnd the following:
When the data generating process is that of a random effects model (c0 ¼ 0), we see that the random effects
estimator has a smaller AMSE than the ﬁxed effects estimator. This result is expected because the ﬁxed
effects estimator is not efﬁcient. Also as expected, for both estimators, the AMSE decreases quickly as n
gets larger.
Next, when the data are generated via a ﬁxed effects model (c0 ¼ 0:5), the regressor Z it and the ﬁxed effects
mi are correlated. In this case the random effects estimator is inconsistent. Indeed, Table 1 shows that the
random effects AMSE does not decrease as the sample size increases. In contrast, the ﬁxed effects estimator
that removes the ﬁxed effects leads to consistent estimation results. Its AMSE decreases rapidly as n
increases.
Finally, the ﬁxed effects estimator that accounts for S has an efﬁciency gain over the ﬁxed effects estimator
that ignores S.

5.2. Functional form tests
Next, we present the ﬁnite sample performance of the functional form tests. In construction of the tests we
consider three simple data generating processes5
Y it ¼ X it b þ Z it g þ uit ,

(18)

Y it ¼ X it b þ Z 2it g þ uit ,

(19)

Y it ¼ X 2it b þ Z 2it g þ uit .

(20)

In each model X it and Z it are scalars which are generated as i.i.d. uniform½1; 1 and uniform½2; 4,
respectively. b ¼ 5 and g ¼ 2, and uit is generated as before where c0 ¼ 0:5. We use the Gaussian kernel
function and the bandwidth hz ¼ b
sz ðnmÞ1=ð4þqÞ , where b
sz is the sample standard deviation of fZit gn;m
i¼1;t¼1 . hx is
deﬁned similarly.
In the simulations reported in Table 2, we use the variance structure and account for S. Further, the initial
values of yðÞ and gðÞ are given by the OLS estimates from fourth order polynomial models. The convergence
5

More complicated data generating processes give qualitatively the same results.

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

271

Table 2
Estimated size and power for the Ib tests for the null hypotheses of a parametric model versus a semiparametric model (a), a parametric
model versus a nonparametric model (b), and a semiparametric model versus a nonparametric model (c), respectively
Size and power of the Ib tests
n ¼ 50

Size
Iba
n

b
Ibn
c
Ib
n

Power
a
Ib
n
b
Ibn
c
Ibn

n ¼ 100

n ¼ 200

1%

5%

10%

1%

5%

10%

1%

5%

10%

0.006

0.031

0.065

0.008

0.041

0.087

0.009

0.046

0.089

0.009

0.037

0.092

0.011

0.054

0.108

0.010

0.052

0.093

0.009

0.041

0.085

0.011

0.044

0.090

0.011

0.045

0.090

0.855

0.916

0.947

0.929

0.962

1.000

0.981

1.000

1.000

0.972

0.986

1.000

0.985

1.000

1.000

1.000

1.000

1.000

0.989

1.000

1.000

1.000

1.000

1.000

1.000

1.000

1.000

The number of time periods (m) is set equal to three. The number of Monte Carlo replications (M) is set equal to 1000 and the number of
bootstrap replications (B) is set equal to 400.

Table 3
Estimated size and power for the Jb test for the null hypothesis that the random effects model is true
Size of the Jb test
c0

0
0.25
0.5

n ¼ 50

n ¼ 100

n ¼ 200

1%

5%

10%

1%

5%

10%

1%

5%

10%

0.012
0.176
0.578

0.056
0.404
0.834

0.112
0.518
0.910

0.015
0.376
0.935

0.057
0.626
0.990

0.109
0.734
1.000

0.011
0.672
1.000

0.054
0.872
1.000

0.108
0.922
1.000

The number of time periods (m) is set equal to three. The number of Monte Carlo replications (M) is set equal to 1000 and the number of
bootstrap replications (B) is set equal to 400.

criterion is the same as before where b
yðÞ is replaced by gbðÞ when necessary. The number of iterations needed
for the semiparametric model to converge is typically between 5 and 7 in the second stage. The number of time
periods, cross-sections and replications are the same as before and the number of bootstraps within each
replication is set equal to 400. In Table 2 we can see that the estimated sizes of each of the three tests are close
to the nominal sizes for relatively small samples. The power of the three tests is also impressive and we can see
that they tend towards one as the sample size grows. Again, the limited results show that the tests perform well
for the typical panel data situation of large n and small m.
5.3. Nonparametric Hausman test
Finally, we examine the ﬁnite sample performance of the nonparametric test for detecting a ﬁxed effects
model against a random effects model. The data generating process is the same as in Section 5.1. Again, c0 ¼ 0
gives the random effects model, and c0 a0 leads to the ﬁxed effects model. We consider c0 ¼ 0; 0:25; 0:5. The
number of replications (M) here is set equal to 1000 in each setting, and the number of bootstraps within each
replication is set at 400. From Table 3 we observe that the estimated sizes of the Jb test (the case of c0 ¼ 0) are
close to the nominal sizes. The last two rows ðc0 ¼ 0:25; 0:5Þ give the estimated power of the Jb test. We observe

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

272

that the power increases rapidly as either the sample size increases or as the correlation between the individual
effects and the regressor increases (i.e., as c0 increases). The limited simulation results seem to suggest that the
bootstrap-based Jb test performs well for the typical panel data situation of large n and small m.
6. Conclusion
In this paper we proposed using a kernel-based methodology to estimate a nonparametric panel data model
with ﬁxed effects. We extended the estimation method to the case of a partially linear ﬁxed effects model. To
determine whether a parametric, semiparametric or nonparametric model was appropriate, we proposed
bootstrap procedures to test between the three alternatives in practice. We also suggested using a bootstrap
procedure to test for the presence of random effects versus ﬁxed effects in a nonparametric panel data set.
Monte Carlo simulations were used to examine the ﬁnite sample performance of the proposed estimators and
test statistics.
Acknowledgments
The authors would like to thank three anonymous referees and the editor for useful comments which led to
an improved version of the paper. The paper also beneﬁtted from comments of participants of the Southern
Methodist University Economics Seminar Series, the Virginia Tech University Economics Seminar Series, and
the Binghamton University Statistics Seminar Series, as well as participants of the North American Summer
Meetings of the Econometric Society at Duke University (June, 2007). Carroll’s research was supported by a
grant from the National Cancer Institute (CA-57030, CA104620), and by the Texas A&M Center for
Environmental and Rural Health via a grant from the National Institute of Environmental Health Sciences
(P30-ES09106). Li’s research was partially supported by the Private Enterprise Research Center, Texas A&M
University.
Appendix A. Sketch of technical arguments
In this appendix we provide a sketch of our main result. We conjecture that a rigorous proof may follow
similar arguments as given in Mammen et al. (1999), although the model we consider is more complex than the
additive model considered by them. We leave this as a future research topic.
ð1Þ
Lemma 1. Let b
y½‘ ðzÞ and b
y½‘ ðzÞ be the lth step iteration estimators of yðzÞ and yð1Þ ðzÞ, respectively, then it satisfies
the following equation:
n X
m
k2 X 2
1 X
b
y½‘ ðzÞ  yðzÞ ¼
hr yrr ðzÞ 
K h ðZ it  zÞit
nOðzÞ i¼1 t¼1
2 r¼1
q

n X
m X
m
1 X
K h ðZ it  zÞLi;tsy ðÞfb
y½‘1 ðzÞ  yðzÞg
nOðzÞ i¼1 t¼1 sat
(
)
q
X
2
1=2
þ op
hr þ ðnh1    hq Þ
,



(A.1)

r¼1

where it ¼ Li;ty fYe i ; yðZ i1 Þ; . . . ; yðZ it Þ; . . . ; yðZ im Þg.
ð1Þ
Proof. By Taylor expansion of the ﬁrst order equation (5) with respect to fb
y½‘ ðzÞ; b
y½‘ ðzÞg at fyðzÞ; yð1Þ ðzÞg, we
have that

0 ¼ n1

n X
m
X
i¼1 t¼1

K h ðZ it  zÞG it ðz; hÞLi;ty ðÞ

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

þ n1

n X
m
X
i¼1 t¼1

(
þ op

q
X

0
B
K h ðZ it  zÞG it ðz; hÞG it ðz; hÞT Li;tty ðÞ@

b
y½‘ ðzÞ  yðzÞ
ð1Þ
b
y½‘ ðzÞ  yð1Þ ðzÞ

273

1
C
A

)
h2r

þ ðnh1    hq Þ

1=2

,

(A.2)

r¼1

y½‘1 ðZ i1 Þ; . . . ; yðzÞ þ fðZ it  zÞ=hgT yð1Þ ðzÞ; . . . ; b
y½‘1 ðZ im Þ. Note that (A.2) is a
where the argument ðÞ is at ½Ye i ; b
ðq þ 1Þ  1 vector equation. By noting that
n1

n X
m
X

K h ðZ it  zÞG it G Tit Li;tty ðÞ

i¼1 t¼1

m
X

E½K h ðZ it  zÞG it G Tit Li;tty 

t¼1

which converges to OðzÞdiagð1; k2 Iq Þ, where k2 ¼
equation (A.2) leads to
OðzÞfb
yðzÞ  yðzÞg ¼ n1

n X
m
X

R

kðvÞv2 dv, hence, the ﬁrst component of the vector

K h ðZ it  zÞLi;ty ðÞ þ op ðZn Þ  An þ op ðZn Þ,

(A.3)

i¼1 t¼1

where
Zn ¼

q
X

h2r þ ðnh1    hq Þ1=2 .

r¼1

We decompose An into An ¼ A1n þ A2n , where A1n is obtained from An with b
yðÞ replaced by yðÞ, and
A2n ¼ An  A1n . Thus,
A1n ¼ n1

n X
m
X

K h ðZ it  zÞLi;ty ½Ye i ; yðZi1 Þ; . . . ; yðzÞ þ fðZit  zÞ=hgT yð1Þ ðzÞ; . . . ; yðZ im Þ.

(A.4)

i¼1 t¼1

By adding and subtracting terms in A1n we can further write A1n ¼ A1n1  A1n2 , where
A1n1 ¼ n1

n X
m
X

K h ðZ it  zÞit ,

(A.5)

i¼1 t¼1

A1n2 ¼ n1

n X
m
X

K h ðZ it  zÞðLi;ty fYe i ; yðZ i1 Þ; . . . ; yðZ it Þ; . . . ; yðZ im Þg

i¼1 t¼1

 Li;ty ½Ye i ; yðZ i1 Þ; . . . ; yðzÞ þ fðZ it  zÞ=hgT yð1Þ ðzÞ; . . . ; yðZ im ÞÞ
n X
m
1 X
K h ðZ it  zÞðZ it  zÞyð2Þ ðzÞðZit  zÞT Li;tty ðÞ þ op ðZn Þ
¼
2n i¼1 t¼1
k2 X 2
h yrr ðzÞOðzÞ þ op ðZn Þ,
2 r¼1 r
q

¼
where

OðzÞ ¼ 

m
X

f t ðzÞEðLi;tt jZ it ¼ zÞ ¼ fðm  1Þ=mg=s2n ; yrr ðzÞ ¼ q2 yðzÞ=qz2r ,

t¼1
ð2Þ

y ðzÞ is the q  q second order derivative matrix of yðzÞ, and
Zn ¼

q
X
r¼1

h2r þ ðnh1    hq Þ1=2 .

(A.6)

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

274

In addition,
A2n ¼ An  A1n ¼ n1

n X
m
X

K h ðZ it  zÞ

i¼1 t¼1

Li;jy ½Ye i ; b
y½‘1 ðZ i1 Þ; . . . ; yðzÞ þ fðZit  zÞ=hgT yð1Þ ðzÞ; . . . ; b
y½‘1 ðZ im Þ  A1n
n X
m X
m
X
¼ n1
K h ðZ it  zÞLi;tsy ðÞfb
y½‘1 ðZ is Þ  yðZ is Þg
i¼1 t¼1 sat

þ op

q
X

h2r

!
1=2

þ ðnh1    hq Þ

.

(A.7)

r¼1

Accumulating these results yields (A.1).

&

Here we sketch how one can use (A.1) to show (8). The basic argument is the same as that in Wang (2003),
namely repeated application of (A.1). The idea is to start with a consistent estimator and then apply (A.1) to
get an expansion for the ﬁrst step in the iteration. This new expansion is then substituted into (A.1) to get an
expansion for the second step in the iteration, etc. Under the assumption that the algorithm converges, the
effect of the initial estimator disappears, and (8) emerges. The calculations are merely extremely detailed
rather than difﬁcult, and in the interest of space we do not provide them.
It is interesting to note that conversely, (8) is consistent with (A.1). If an estimator with the expansion (8) is
used, and then updated, using (A.1) results in (8) once again.

References
Bickel, P.J., Kwon, J., 2002. Inference for semiparametric models: some current frontiers (with discussions). Statistica Sinica 11, 863–960.
Bickel, P.J., Klaassen, A.J., Ritov, Y., Wellner, J.A., 1993. Efﬁcient and Adaptive Inference in Semiparametric Models. Johns Hopkins
University Press, Baltimore, MD.
Chamberlain, G., 1992. Efﬁciency bounds for semiparametric regression. Econometrica 60, 567–596.
Fan, J., Jiang, J., 2005. Nonparametric inferences for additive models. Journal of the American Statistical Association 100, 890–907.
Härdle, W., Mammen, E., 1993. Comparing nonparametric versus parametric regression ﬁts. Annals of Statistics 21, 1926–1947.
Henderson, D.J., Ullah, A., 2005. A nonparametric random effects estimator. Economics Letters 88, 403–407.
Ke, C., Wang, Y., 2001. Semiparametric nonlinear mixed-effects models and their applications. Journal of the American Statistical
Association 96, 1272–1281.
Lee, T.-H., Ullah, A., 2000. Nonparametric bootstrap tests for neglected nonlinearity in time series regression models. Journal of
Nonparametric Statistics 13, 425–451.
Li, Q., Stengos, T., 1996. Semiparametric estimation of partially linear regression models. Journal of Econometrics 71, 389–397.
Li, Q., Wang, S., 1998. A simple consistent bootstrap test for a parametric regression function. Journal of Econometrics 87, 145–165.
Lin, D.Y., Ying, Z., 2001. Semiparametric and nonparametric regression analysis of longitudinal data (with discussion). Journal of the
American Statistical Association 96, 103–126.
Lin, X., Carroll, R.J., 2000. Nonparametric function estimation for clustered data when the predictor is measured without/with error.
Journal of the American Statistical Association 95, 520–534.
Lin, X., Carroll, R.J., 2001. Semiparametric regression for clustered data using generalised estimation equations. Journal of the American
Statistical Association 96, 1045–1056.
Lin, X., Carroll, R.J., 2006. Semiparametric estimation in general repeated measures problems. Journal of the Royal Statistical Society,
Series B 68, 68–88.
Lin, X., Wang, N., Welsh, A.H., Carroll, R.J., 2004. Equivalent kernels of smoothing splines in nonparametric regression for longitudinal/
clustered data. Biometrika 91, 177–194.
Mammen, E., Linton, O., Nielsen, J.P., 1999. The existence and asymptotic properties of a backﬁtting projection algorithm under weak
conditions. Annals of Statistics 27, 1443–1490.
Opsomer, J.D., Ruppert, D., 1997. Fitting a bivariate additive model by local polynomial regression. Annals of Statistics 25, 186–212.
Ruckstuhl, A.F., Welsh, A.H., Carroll, R.J., 2000. Nonparametric function estimation of the relationship between two repeatedly
measured variables. Statistica Sinica 10, 51–71.
Su, L., Ullah, A., 2006. Proﬁle likelihood estimation of partially linear panel data models with ﬁxed effects. Economics Letters 92, 75–81.
Ullah, A., Roy, N., 1998. Nonparametric and semiparametric econometrics of panel data. In: Ullah, A., Giles, D.E.A. (Eds.), Handbook
of Applied Economics Statistics. Marcel Dekker, New York, pp. 579–604.
Wang, N., 2003. Marginal nonparametric kernel regression accounting for within-subject correlation. Biometrika 90, 43–52.

ARTICLE IN PRESS
D.J. Henderson et al. / Journal of Econometrics 144 (2008) 257–275

275

Wang, N., Carroll, R.J., Lin, X., 2005. Efﬁcient semiparametric marginal estimation for longitudinal/clustered data. Journal of the
American Statistical Association 100, 147–157.
Whang, Y., Andrews, D.W.K., 1993. Tests of speciﬁcation of parametric and semiparametric models. Journal of Econometrics 57,
277–318.
Wooldridge, J., 2002. Econometric Analysis of Cross Section and Panel data. MIT Press, Cambridge, MA.
Wu, H., Zhang, J.Y., 2002. Local polynomial mixed-effects models for longitudinal data. Journal of the American Statistical Association
97, 883–897.

