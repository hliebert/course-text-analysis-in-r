NBER WORKING PAPER SERIES

MEASURING THE EFFECTS OF SEGREGATION IN THE PRESENCE OF SOCIAL SPILLOVERS:
A NONPARAMETRIC APPROACH
Bryan S. Graham
Guido W. Imbens
Geert Ridder
Working Paper 16499
http://www.nber.org/papers/w16499

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
October 2010

We thank David Ahn, Susan Athey, Alan Auerbach, Alberto Bisin, Raj Chetty, Rajeev Dehejia, Steven
Durlauf, Raquel Fernández, Jack Porter, Jim Powell, Paul Ruud and, especially, Emmanuel Saez for
helpful discussions. We would also like to thank participants in numerous seminars and conferences
for helpful questions and suggestions. Financial support was generously provided by the NSF (SES
#0820361). The views expressed herein are those of the authors and do not necessarily reflect the views
of the National Bureau of Economic Research.
NBER working papers are circulated for discussion and comment purposes. They have not been peerreviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.
© 2010 by Bryan S. Graham, Guido W. Imbens, and Geert Ridder. All rights reserved. Short sections
of text, not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.

Measuring the Effects of Segregation in the Presence of Social Spillovers: A Nonparametric
Approach
Bryan S. Graham, Guido W. Imbens, and Geert Ridder
NBER Working Paper No. 16499
October 2010
JEL No. C14,C31,D62,I21
ABSTRACT
In this paper we nonparametrically analyze the effects of reallocating individuals across social groups
in the presence of social spillovers. Individuals are either 'high' or 'low' types. Own outcomes may
vary with the fraction of high types in one's social group. We characterize the average outcome and
inequality effects of small increases in segregation by type. We also provide a measure of average
spillover strength. We generalize the setup used by Benabou (1996) and others to study sorting in the
presence of social spillovers by incorporating unobserved individual- and group-level heterogeneity.
We relate our reallocation estimands to this theory. For each estimand we provide conditions for nonparametric
identification, propose estimators, and characterize their large sample properties. We also consider
the social planner's problem. We illustrate our approach by studying the effects of sex segregation
in classrooms on mathematics achievement.

Bryan S. Graham
New York University
19 W 4th Street, 6FL
New York, NY 10012
and NBER
bsg1@nyu.edu
Guido W. Imbens
Department of Economics
Littauer Center
Harvard University
1805 Cambridge Street
Cambridge, MA 02138
and NBER
imbens@fas.harvard.edu

Geert Ridder
Department of Economics
University of Southern California
Kaprielian Hall
Los Angeles, CA 90089
ridder@usc.edu

1

Introduction

Debates about the social costs and benefits of segregation by socioeconomic status, ability, race or
gender figure prominently in discussions of education, housing and other areas of social policy. In
the late-1960s Coleman et al. (1966) argued that racial isolation lowered the academic achievement
of minority students. This claim immediately generated controversy, spawning a vast empirical
literature in education, sociology and economics. Forty years later Rivkin and Welch (2006),
surveying the resulting body of work, concluded that “the eﬀect of integration on black students
remains largely unsettled” (p. 1043). Schofield (1995), reviewing the education and sociology
literature, comes to a similarly tentative conclusion, emphasizing the “methodological and other
problems that typify work in this area” (p. 597). After four decades of research, school busing and
other mandated desegregation policies remain controversial. Other unsettled debates touching on
issues of ‘segregation’ include those on school vouchers, single-sex schooling, ability tracking and
public housing policy.1
Each of these debates centers on a common question: would society be better oﬀ if social
groups were configured diﬀerently? Are there welfare-increasing deviations from the status quo
assignment of individuals to classrooms, schools or neighborhoods? How do average outcomes and
inequality respond to ‘reallocations’ of individuals across groups? Durlauf (1996c) has termed such
reallocating policies ‘associational redistribution’.
Despite the long-standing controversy surrounding reallocation-inducing policies, econometric
methods for framing and analyzing their eﬀects are not widely available. Researchers interested
in, for example, segregation in schools typically focus their eﬀorts on identifying and estimating
an average relationship between school racial composition and student achievement (e.g., Angrist
and Lang, 2004; Guryan, 2004; Card and Rothstein, 2007). The optimality of segregation relative
to integration is inferred by reference to this estimated relationship.2 The target estimand of this
literature, the average marginal eﬀect of school racial composition on student achievement, does not
correspond to an implementable policy. It would be impossible, for example, to engineer an increase
1
Disagreements about the magnitude and relevance of ‘cream-skimming’ in response to widespread school choice
figure prominently in the debate on educational vouchers (e.g., Manski, 1992; Hoxby, 2003; Ladd, 2003; Urquiola,
2005).
The evidence on the achievement eﬀects of single-sex instruction is mixed (e.g., Morse 1998, Mael 2005), although
this interpretation is debated by advocates of gender-separation (e.g., Sax 2005). In 2006 the United States Department of Education, in a controversial decision, modified Title IX regulations to allow the formation of single-sex
classrooms in public schools (Paulson and Teicher 2006).
The literature on school tracking is enormous with supporting evidence available for both its advocates and opponents. For recent discussions see Oakes (1992), Epple, Newlon and Romano (2002) and Figlio and Page (2002).
Massey and Denton (1993, p. 231) advocate for increased use of housing vouchers and decreased use of public
housing projects. The eﬀects of housing vouchers are analyzed by Jacob (2004) and Kling, Liebman and Katz (2007).
2
The original Coleman Report provides a particularly thoughtful example of this type of informal inference process:

“If a white pupil from a home that is strongly and eﬀectively supportive of education is put in a
school where most students do not come from such homes, his achievement will be little diﬀerent than if
he were in a school composed of others like himself. But if a minority pupil from a home without much
educational strength is put with schoolmates with strong educational backgrounds, his achievement is
likely to increase” (Coleman et al., 1966, p. 22).

1

in minority enrollment across all schools — the policy eﬀect measured by this estimand — since an
increase in such enrollment in one school necessarily requires a commensurate decrease in another.
While knowledge of the (average) mapping between school racial composition and outcomes may
be an ingredient to an evaluation of a particular race-based allocation of students to schools, it is
not suﬃcient.3
In this paper we provide an initial exploration of the econometrics of reallocating individuals
across groups in the presence of social spillovers. Our analysis emphasizes issues of measurement,
that is, the definition of relevant target estimands. Additionally, we provide conditions for nonparametric identification, propose estimators and characterize their large sample properties. We
implement our procedures using data from the randomized Tennessee class size reduction experiment, Project STAR. Following Whitmore (2005) we use these data to study the eﬀects of classroom
gender mix on student achievement.
Our setup generalizes that of a class of stylized locational sorting models developed by de Bartolome (1990), Benabou (1993, 1996), Becker and Murphy (2000) and others.4 As in those papers,
we consider a setting where individuals are either ‘high’ or ‘low’ types, with outcomes depending
on the type composition of their social group in a fully nonparametric way. We add statistical
content to this framework by introducing unobserved individual heterogeneity. We also allow for
location-specific heterogeneity (both observed and unobserved). These extensions complicate our
analysis but are, of course, essential for empirical relevance.
An example, which we develop empirically below, helps to clarify the various issues involved.
Consider a setting where individuals are students, with high and lows types respectively denoting
girls and boys. Students may diﬀer in unobserved ways, for example in their ability. A social group
is a classroom of students. Classrooms may also be heterogeneous, for example in observed and/or
unobserved dimensions of teacher quality. This set-up is complicated because there are three distinct
levels of heterogeneity: individual-level, peer-level and location-level. Any analysis of peer eﬀects
must keep track of, and impose conditions on, these three types of heterogeneities. Our approach
involves imposing restrictions on the group formation process; both the mechanism whereby specific
individuals sort together into groups, and that whereby such groups place themselves in specific
locations. While we are restrictive regarding the process which generates the status quo allocation
of individuals to groups, we are very flexible elsewhere. An alternative, complementary, approach
would involve imposing more restrictions on, say, the ‘production technology’, in exchange for
imposing fewer restrictions on the status quo assignment process (e.g., Nesheim, 2002, 2009). We
emphasize that our basic setup, in particular our estimands and characterization of the social
planner’s problem, is not linked to any specific approach to identification.
We develop three classes of estimands. The first class measures the average strength of any social
spillovers. The central focus here is on what we call the average spillover eﬀect,  ase . Here our
3

More generally the menu of program evaluation estimands surveyed by Imbens (2004, 2007), Heckman and
Vytlacil (2007a,b), and others is, at best, only indirectly helpful for assessing the eﬀects of reallocations. We justify
this claim further below.
4
Much of this theoretical literature is surveyed by Piketty (2000), Fernández (2003) and Durlauf (2004).

2

contribution is modest; we provide a nonparametric generalization of prior work on the measurement
of spillovers (e.g., Manski, 1993; Brock and Durlauf, 2001; Moﬃtt, 2001; Glaeser and Scheinkman,
2003). In particular our measure of spillover strength can be viewed as a (simple) nonparametric
generalization of Ciccone and Peri’s (2006) ‘constant composition’ externality measure.
We view our second set of estimands as more innovative. This class includes the local segregation
outcome eﬀect,  lsoe , which measures the eﬀect of small increases in segregation (relative to the
status quo) on average outcomes. We also develop a local segregation inequality eﬀect,  lsie , which
measures the eﬀect of a small increase in segregation on the the average outcome gap between high
and low type individuals. These estimands provide a basis for characterizing any equity versus
eﬃciency trade-oﬀs associated with segregation-inducing policies.
Our final estimand allows us to assess the eﬃciency of the status quo allocation relative to
an outcome-maximizing allocation. In our setup the social planner’s problem is a functional optimization (i.e., infinite dimensional) one. Nevertheless we are able to characterize its solution
quite generally. As we leave the (average) mapping from group composition to outcomes a priori
unrestricted (and also allow for a large number of social groups) our result generalizes the social
planner analyses of, for example, de Bartolome (1990), Benabou (1993, 1996) and Becker and
Murphy (2000), in addition to providing them with statistical content.
Our framework oﬀers several advantages over existing methods of characterizing social spillovers.
First, our approach explicitly connects the data with many of the ideas emphasized in theoretical
work on sorting in the presence of social spillovers. In particular, our estimands provide measures of
segregation-induced ineﬃciencies, a key theme of the neighborhood sorting literature. For example,
our local segregation outcome eﬀect (LSOE) estimand has a representation as a weighted average
of own and peer type complementarity and curvature. Benabou (1996), in the context of a stylized
deterministic model, shows how the eﬃciency of segregation vis-a-vis integration depends on these
two objects. Prior empirical work on social externalities generally only loosely connects to the
relevant applied public finance theory. Fernández (2003), in her survey article, notes that “there has
been very little work done to assess the significance of the ineﬃciencies [induced by segregation],”
despite the growing body of empirical work that points to the importance of peer eﬀects in a general
way (p. 14). Piketty (2000) makes a similar point.
Second our focus on reallocations is novel. While we leave the microstructure of any social
interactions processes unmodelled, our set-up allows us to think about reallocation-inducing policies
in a straightforward way. Many controversial policies, such as busing, ‘school choice’ regimes or the
provision of rental vouchers to public housing recipients, are fundamentally allocation mechanisms.
Our estimands provide a partial basis for the evaluation of such policies.
Finally, unlike most work in this area, Brock and Durlauf (2007) being an important recent
exception, our approach to identification and estimation is fully nonparametric.5 We provide nonparametric estimators for our first two classes of estimands and also characterize their large sample
5

Examples of formal identification analyses of parametric social interaction models include those of Manski (1993),
Brock and Durlauf (2001), Moﬃtt (2001) and Graham (2008).

3

properties.6
In recent years economists and other social scientists have made substantial progress on the
identification and estimation of statistical models with social spillovers (e.g., Manski, 1993; Solon,
1999; Brock and Durlauf, 2001, 2007; Moﬃt, 2001; Duncan and Raudenbush, 2001; Sampson,
Morenoﬀ and Gannon-Rowley, 2002; Glaeser and Scheinkman, 2003; Graham 2008, 2009). Our work
builds on this work inasmuch as the production technology is a component of each of our estimands.
However our focus substantially diﬀers from this prior work. Our goal is to develop estimands which
directly characterize the eﬀects of reallocations on the distribution of outcomes. Related work in
this vein includes that of Graham, Imbens and Ridder (2007, 2009) and Bhattacharya (2009) (see
Graham (forthcoming) for a survey). More recently Hudgens and Halloran (2008) and Manski
(2010) develop a notation for the study of treatment response in the presence of spillovers which
shares features with our own setup.
Our work is also related to the mathematical programming and economic literature on resource
allocation problems (e.g., Ginsberg, 1974; Ibaraki and Katoh, 1988; Luenberger, 1969, 2005). As
noted above, in our setting the planner’s problem is one of functional optimization. Our general
characterization of the solution to this problem appears to be new.7
The statistical aspects of this paper are most closely connected to the literature of semiparametric M-estimation as in Newey (1994a,b) and Newey and McFadden (1994). In particular our
estimands share import features with weighted average derivatives as in Powell, Stock and Stoker
(1990), Härdle and Stoker (1989), Newey and Stoker (1993) and others. While straightforward to
compute, our estimators combine multiple first step nonparametrically estimated objects together
in diﬀerent ways. Most of our estimators, for example, require nonparametric estimation of two
conditional expectation functions as well as their derivatives. Consequently characterizing their
asymptotic properties, as we do below, is nontrivial.
Section 2, which follows next, describes our sampling structure and maintained identifying assumptions. The need to carefully keep track of all the sources of individual, peer and locational
heterogeneity requires the development of a relatively elaborate set of notational conventions. For
6

A limitation of our framework is that it is not helpful for assessing the eﬀects of non-reallocating interventions,
such as providing subsidies to low types. Manski (1993), Brock and Durlauf (2001) and Durlauf (2004) discuss this
class of policy interventions. The analysis of such interventions generally requires an explicit model of the social
interaction process. Durlauf (2004) makes a compelling case for greater focus on the microeconomic foundations of
social interaction processes. We are sympathetic to this perspective, but nevertheless have found it useful to leave
such structure unspecified in the present setting. Lazear (2001) and Weinberg (2006) provide nice examples of how
concrete microstructures of social interaction generate specific reduced form mappings from group structure into
outcomes. Since we leave this mapping nonparametric, our approach is arguably consistent with a wide-variety of
interaction microstructures. An important caveat to this claim, however, is that explicit microstructures of strategic
interaction can generate a mapping from group composition into outcomes that exhibits discontinuities (cf., Brock
and Durlauf 2001, 2007). Since we estimate this mapping using kernel smoothing methods, our approach may work
poorly in such situations.
7
The closest work of which we are is aware is that of Arnott and Rowse (1987) which uses parametric estimates of
educational production functions and numerical programming methods to evaluate classroom assignment mechanisms
based on student ability. Their methods are fundamentally parametric in nature and they do not discuss issues of
identification, estimation or inference. Our analysis of the allocation problem is also related to the neighborhood
sorting models of de Bartolome (1990), Benabou (1993, 1996), Durlauf (1996a,b), Epple and Romano (1998) and
Becker and Murphy (2000).

4

our purposes we have found a heavily modified potential outcomes notation to be the most convenient for representing our problem and stating our assumptions (Neyman 1923, Rubin 1974,
Holland 1986a,b). To simplify the exposition we begin with the stylized case where all groups are
(i) equally sized and (ii) there are no covariates beyond type.
Section 3 presents our estimands. We begin by proposing a simple summary measure of the
strength of social spillovers. We then present measures of the outcome and inequality eﬀects of
local reallocations of individuals across groups. Section 4 discusses estimation. Section 5 briefly
considers how observed individual- and location-specific characteristics can be incorporated into
our framework.
In Section 6 we discuss the planner’s problem. By characterizing the solution to this problem we are able to show that the ineﬃciency of the status quo — the diﬀerence between the observed average outcome and that which would occur under an outcome-maximizing allocation —
is identified under certain assumptions. In Section 7 we apply our methods, and compare them
with parametric alternatives, in a study of the eﬀect of classroom gender composition on student
achievement using data collected in conjunction with the Tennessee Project STAR experiment (cf.,
Whitmore, 2005). Section 8 summarizes and suggests areas for future research. The proofs of our
identification and representation results are contained in Appendix B. The pathwise derivative
calculations underlying our large sample results are detailed in a Supplemental Web Appendix
(https://files.nyu.edu/bsg1/public/).
2

Setup and assumptions

In this section we present our statistical model and discuss the identifying assumptions we maintain in subsequent sections. Throughout we use upper case letters to denote random variables.
Lower-case and calligraphic letters respectively denote specific realizations and the support of the
corresponding distributions.
2.1

Population framework

There is a population of individuals (e.g., elementary school students). Individuals are indexed
by  ∈ I = {1      } and are one of two observed types  ∈ {0 1}, for example, boy or girl.
Additional individual level heterogeneity is indexed by the vector  ∈ A. For reasons of exposition
we refer to  as an individual’s ‘ability’. We also refer, without intending to be pejorative, to
those individuals with  = 1 as ‘high’ types and those individuals with  = 0 as ‘low’ types. The
population fraction of high types is given by  . We assume that  is non-manipulable, denoting
a permanent characteristic such as race or sex. The outcome of interest, say, student achievement,
is  ∈ Y and may be discretely- or continuously-valued. For ease of exposition we initially assume
there are no observed individual characteristics beyond type (we introduce observed individual-level
attributes into our analysis in Section 5).
Individuals reside in diﬀerent locations or, alternatively, ‘attend’ diﬀerent ‘schools’. Members

5

of the population of available locations are indexed by  ∈ C = {1      }  Associated with each
location is a vector of unobserved characteristics  ∈ U If locations are, for example, schools, then
 might capture heterogeneity in teacher quality and facilities (we introduce observed location
characteristics into our analysis in Section 5).
At times it will be necessary to compute averages across the population of locations and, at
others, ones across individuals. When we use a  subscript the relevant average is over locations,
whereas an  subscript signals an average over individuals.
Each individual’s location of residence is given by the assignment indicator  ∈ C. If individual
 resides in location  then  =  To avoid double subscripting we use the notation  =   An
allocation is a feasible assignment of individuals to groups and is completely specified by a vector
of group assignment indicators G = (1       )0 
Individuals assigned to a common location are neighbors. For ease of exposition we initially
assume that all neighborhoods have room for exactly  =   residents (we allow for unequally
sized groups in Sections 5 and 6).
Individual 0  peer group includes those individuals also assigned to her location, i.e. the index
set
 () = { :  =    6= } 
These peers’ types and abilities are given by the vectors
¡
¢0
 () = ()1      ()−1 

¡
¢0
() = ()1      ()−1 

where the subscripts ()  with  = 1      −1 indicate the members of ’s peer group in arbitrary
order. Let   = (   0() )0 and  = (  0() )0 denote the vectors of types and abilities in 0 
social group inclusive of herself.
The  individual’s neighborhood quality,  , depends on the type and ability of her peers as
well as the vector of unobserved location characteristics  :
 = ( 0()  0()  0 )0 
2.2

Potential outcomes notation

Our focus is on characterizing diﬀerent (summary) features of the mapping from allocations into
outcomes. We assume that this mapping is individual-specific and given by
 (g)

g ∈ G

(1)

where G denotes the set of all feasible allocations and the relation is individual specific due to its
(implicit) dependence on  and  . The function  (g) gives the potential outcome for individual

6

 associated with allocation g ∈ G8,9
Tractability of our problem requires imposing restrictions on  (g). Our first restriction rules
out cross location spillovers.
e denote two feasible
Assumption 2.1 (No Cross Neighborhood Spillovers) Let g and g
allocations with associated neighborhood qualities for individual  of  and e . If  = e then
g)
 (g) =  (e

Assumption 2.1 means that individual outcomes depend only upon own characteristics and
neighborhood quality; the type-structure, ability distribution, and location characteristics of, for
example, adjacent neighborhoods do not aﬀect outcomes. In the case where locations are spatially
separated schools Assumption 2.1 may be reasonable. If locations represent residential neighborhoods the assumption of no cross location spillovers is considerably stronger. Nevertheless some
restriction on the structure of dependence across locations is required for statistical analysis.
Under Assumption 2.1 we may write
 (G) =  ( ()  ()   ) =  ( )
Our next assumption restricts the structure of peer influences within a neighborhood. Let
¢
P
P−1 ¡

= −1
=1 () and  =
=1 1 − () denote the total number of high and low type
peers for individual . Assume, without loss of generality, that () is ordered such that high
types appear first, followed by low types (i.e., () = (1     1 0     0)0 ). The  − 1 vector of
0
0 0

peer ‘abilities’ is arranged conformably such that () = (
()  () )  where () equals the
 × 1 vector of abilities for each high type peer in individual 0  social group and 
() equals the

corresponding  × 1 vector of low type peer abilities.


e () = (
e0
e0 0
Assumption 2.2 (Within-Type Peer Exchangeability) Let 
()  () ) where


e
e
e

() and () are permutations of () and ()  and let  () be a conformable re-ordering of
 () (note that e() =  () by construction), for all such within-type permutations
e()   ) =  ( ()  ()   )
 (e()  

8
Associated with each assignment is a mechanism by which it came about. For example assignment may be by
lottery, tournament, or determined by a social planner. Implicit in (1) is the assumption that, conditional on the
induced assignment, the mechanism by which it was achieved does not aﬀect outcomes. If a court-ordered mandatory
school busing plan induces the same allocation of students across schools as a lottery, then the associated outcome
distributions will also be identical. This may be a strong assumption in certain settings. Schofield (1995), in her
review of educational research on the impact of desegregation on black achievement, presents evidence suggesting
that the desegregation mechanism matters. Similar (implicit) assumptions underlie the program evaluation literature
(cf., Holland, 1986a).
9
The potential outcomes notation is convenient for our purposes, however, we could also use the ‘production
function’ notation
 =  (  G  ) 

with  playing the role of a (non-separable) disturbance.

7

³
´
The function  ( ()  ()   ) is a continuous function of ()   for all  () .

Assumption 2.2 implies that, among those of the same type, each of individual 0  peers are
equally influential. This restriction follows from standard exchangeability arguments. As such it is
a statement of researcher ignorance: a priori there is no reason to think that 0  ‘first’ high type
neighbor aﬀects her diﬀerently than her ‘ninth’ (Rubin, 1981). Manski (2000) and Durlauf (2001)
have argued for improving data collection in order to avoid such restrictions. For example, if the
researcher knew that 0  ‘ninth’ high type neighbor was across the street, while her ‘first’ was two
blocks away, then Assumption 2.2 might be implausible. However, in most datasets, the structure
of within-group social networks is unavailable and hence Assumption 2.2 is an appropriate, as well
as unavoidable, representation of prior information.10
By Assumption 2.2 and the Weierstrass Theorem we can approximate the function  ( ()  ()   )
by

 ( ()  ()   ) ≈  (−    (
() )   (() )  )


with   (
() ) denoting the vector of the first  symmetric polynomials in () and   (() )
defined similarly (cf., Altonji and Matzkin, 2005, pp. 1062 - 1063).11
We emphasize that Assumption 2.2 allows for individuals to be diﬀerentially aﬀected by the
ability structure of their high- and low-type peers. For example, outcomes may vary freely with the
average ability of low type peers and/or the average ability of high type peers (rather than being
restricted to vary with average ability taken across all peers). Some individuals, for example, may
be particularly sensitive to variation in high-type peer ability, while others to variation in low-type
peer ability.
Our final restriction on  (g) follows from being precise about the meaning of an agent’s type.

Assumption 2.3 (Inclusive Definition of Type)  ⊥ 
10

Calvó-Armengol, Patacchini and Zenou (2009) provide a nice example of how richer network data can be used to
study peer influences.
11
For the case where 
() is scalar the elementary symmetric polynomials are of the form


0 
() = 1




1 
() =
()


2 
() =


3 
() =

1≤≤





() ()

1≤≤






() () ()

1≤≤

..
.







 
() = ()1 ()2 ()3    ()  




 




0


 Weyl (1946) discusses such polynomials for the
so that   
= 0 
()
()  1 ()       ()
multivariate case.

8

Independence of  from  follows by definition of the phenomena we seek to characterize.
We are interested in whether, for example, an individual learns more when surrounded by female
classmates. Not whether he learns more when surrounded by female classmates once we condition on
their ‘disruptiveness’. If, across the population under consideration, girls tend to be less disruptive
than boys then these two questions have diﬀerent answers. For the first question the appropriate
definition of  is precisely all individual heterogeneity that is independent of  . We want our
notion of ‘gender’ to include, not exclude, systematic diﬀerences in behavior across boys and girls.12
Assumption 2.3 can always be imposed by a normalization. Assume that unnormalized ability
is ∗ , then normalized ability is given by  =  ( ∗ |  ). That is our definition of an individual’s

‘ability’ is their rank amongst those of their own type.13 Let  = (    −    (
() )   (() )  ) =

th individual’s potential outcome given assignment
 (−    (
() )   (() )  ) denote the i

to a group with fraction  = − high type peers, peer abilities   (
() ) =   (() ) and

  (
() ) =   (() ) and location attributes  =  . Assuming the distribution of  does not
¯
 )  )¯ 
depend on  does not restrict the conditional distribution of  (−    (
)

(
 ()
 ¯ 
()
so that Assumption 2.3 can be made without loss of generality.

The allocation response function  (−    (
() )   (() )  ) defines an individual-specific
mapping from peer types, ability, and neighborhood characteristics into outcomes. In our framework the ‘treatment’ induced by a given allocation is a specific configuration of peers, as summarized

by their observed type composition, −  and unobserved ability,   (
() ) and   (() ) Residence in a specific location, where specificity is indexed by the vector of unobserved characteristics
 , is also a feature of the ‘treatment’.
The non-observability of () and  generates complications, relative to the standard potential outcomes model of causal inference (Neyman, 1923; Rubin, 1974; Holland, 1986a,b), because
it implies that we do not observe the full ‘treatment’. The observed treatment is an assignment
to a set of peers with a given type composition. However, because peers and locations are heterogeneous, observationally equivalent assignments may be associated with distinct treatments (and
hence potential outcomes). Assumptions 2.1 and 2.2 are not strong enough to ensure that the
observed treatment satisfies the homogenous treatment assumption that is part of Rubin’s StableUnit-Treatment-Value-Assumption (SUTVA) (cf., Holland, 1986a,b; Rubin, 1990).14
To deal with this issue we define an intermediate object: the expected allocation response
12

If  indexes a manipulable ‘treatment’ then this assumption, of course, has more content. Our framework can
be adapted to this case (see Manski (2010) for an elegant development).
13
Many of our results extend straightforwardly to the case where unnormalized ability is a  × 1 vector ∗ =
(∗1      ∗ )0 . In that case Assumption 2.3 is imposed by the one-to-one mapping
1 =  ( ∗1 |  )

2 =  ( ∗2 | ∗1   )
..
.

 =  ( ∗ | ∗1      ∗−1   ) 
14

In related work Sobel (2006a,b) conceptualizes neighborhood eﬀects as violations of SUTVA.

9

function. Individual’s 0  expected allocation response function is given by
⎫
⎧
Z Z
Z
⎬
⎨ Y

 ()d
 (− ) =
    (−    (
)

(
)
)

(
)d


()
()

()
()
⎭ 
⎩

(2)

∈()

Equation (2) gives an individual’s expected outcome when assigned to a group with peer composition − = − when groups are formed in a certain way. The group formation process enters
into the definition of  (− ) because it is meant to measure the expected eﬀect of exogenous
changes in observed peer composition, − . For this eﬀect to have a causal interpretation it should
be unconfounded by the eﬀects of matching and/or sorting of peers.
Matching occurs if individuals choose (or are assigned to) a location on the basis of its unobserved
attribute  and the utility derived from that choice depends on own attributes (   ). Matching
implies that the vector (    ) of individual peer and own attributes at the location of  is related
to the unobserved location characteristic  . Hence there is no matching if
(    ) ⊥  
which implies the density factorization
  | (   | ) =  | ( | ) ( )
Sorting is related to the distribution of  |  . Sorting occurs if, for example, an individual’s
unobserved ability,  , is related to those of her peers, () . Such a dependence would arise if an
individual’s preference for a location (or the assignment rule used) depends on the attributes and
types of its residents and this preference varies systematically with (   ). The absence of sorting
therefore implies that
¯
¯
( ()  () ) ⊥  ¯  
so that, conditional on own type, own ability does not vary with the type or ability composition of
one’s peers. No sorting generates the density factorization (see Appendix B)
 | ( | ) =


Y

=1

 | ( | ) =


Y

 ( )

=1

where the final equality is due to Assumption 2.3 and we use a double subscript notation with 
indexing individuals within a group in arbitrary order. Note that sorting, as defined above, does
not preclude high types seeking out peer groups composed of many other high types (i.e., sorting
on observables is allowed). Consequently the distribution of peer composition across groups is not
restricted by the absence of sorting. There is neither matching nor sorting if, for a group of a given
type composition, high type members are random draws from the subpopulation of high types, low
type members are random draws from the subpopulation of low types, and the group, so formed,

10

is randomly assigned to a specific location.
In the absence of both matching and sorting the joint density of    given   factors into
 | (   | ) =

⎧

⎨Y
⎩

=1

⎫
⎬
 ( )  ( )
⎭

which is the product of marginals being integrated over in (2), which defines  (− ).
Averaging  (− ) over the subpopulations of low and high types gives the type-specific mean
allocation response functions
∗ (− ) = E [  (− )|  = 0] 

∗ (− ) = E [  (− )|  = 1] 

In what follows it is convenient to instead work with the one-to-one mappings
 () =

∗

µ


 −1

¶

 () =



∗

µ

 − 1
 −1

¶

(3)

where  is the overall fraction of high types in a group (inclusive of oneself). That is, we let
P  1( =)
. denote the fraction of high types in location . Henceforth we refer to  as
 = =1

a location ’s group composition.
The type-specific mean allocation response functions  () and  () feature in each of our
estimands. They equal the expected outcome, given exogenous assignment to a group of composition
 = , of a randomly selected member of, respectively, the subpopulation of high and low types if
groups are formed without matching and sorting. Most of our identification results follow directly
from identification of  () and  ().
The overall mean allocation response function is given by the composition weighted average
 () =  () + (1 − )  () 

(4)

which is the expected outcome of a randomly selected member of the population when assigned to a
group of composition  = . This function is related to the average structural function of Blundell
and Powell (2003). A direct application of their definition would replace the average in (2) with
one over the joint distribution of (0    )0  Such an average would not be causal in our setting as
it would be contaminated by sorting (correlation in ability across group members) and matching
(correlation between ability and location quality) (cf., Graham, 2008, 2009, forthcoming). This is
a one example of how the presence of heterogeneity from multiple individuals (as well as locations)
in the production function for each individual complicates analysis and requires extra care when
defining estimands.
Equation (4) can be viewed as a statistical analog of the deterministic production technology
that features prominently in the theoretical public finance literature on multi-community models
(e.g., de Bartolome, 1990; Benabou, 1993, 1996; Durlauf, 1996a,b; Becker and Murphy, 2000).

11

In order to provide a clean characterization of locational equilibrium as well as the solution to
the social planner’s problem, the multi-community literature has generally placed strong a priori
restrictions on  (). A typical set of assumptions is that  ()− ()  0 for all  ∈ S and that
 2  () 2 is either positive or negative for all  ∈ S. Fernández (2003) provides an extensive
discussion of the role of these assumptions in this literature. In contrast, other than smoothness
assumptions, we leave  () completely unrestricted.
Diﬀerentiating  () with respect to  gives the marginal eﬀect of changes in group composition
on group average outcomes:
∇  () =  () +  () 
where
 () =  () −  () 

 () = ∇  () + (1 − ) ∇  () 

The derivative of  () with respect to group composition consists of two parts. The first part,
 (), is the eﬀect of changing group composition on expected outcomes holding spillover strength
constant. It is the compositional eﬀect of changing group composition on expected group average
outcomes. Irrespective of the presence of social spillovers, average outcomes will rise because the
composition of the group has shifted toward high types. This eﬀect is private, in the sense that it
reflects benefits that are entirely confined to the entering high type.
The second component,  (), measures the spillover or external eﬀect associated with increasing
. The introduction of an additional high type individual into the group creates a spillover which
raises outcomes for all individuals in the group. Benabou (1996) and others have emphasized that,
since agents do not internalize the second eﬀect when choosing locations, decentralized equilibria
may be ineﬃcient.
Our final three main assumptions ensure that  ()   () and their derivatives, ∇  ()
and ∇  (), are nonparametrically identified. Nonparametric identification requires imposing
strong assumptions on the group formation process. In particular, while we allow for matching and
sorting on observables, we rule out the presence of these behaviors on unobservables (see Section 5).
This assumption is easiest to justify when the assignment is administratively determined, but under
certain information structures it may also hold when the assignment corresponds to a decentralized
equilibrium.
We emphasize that semiparametric or parametric identification of  () and  () is generally possible under weaker assumptions on the group formation process (e.g., Nesheim, 2002,
2009; Graham, 2009). The trade-oﬀ between the identifying power of a priori restrictions on the
production technology versus the assignment process is explored more fully in Graham (forthcoming). Diﬀerent researchers will find diﬀerent combinations of assumptions appropriate depending
on the application at hand. Our application, being based on a randomized experiment, allows us to
leave  () and  () fully nonparametric. We consequently develop estimation and distribution
theory appropriate to this case, although our estimands apply generally.
First we make an assumption on the status quo assignment mechanism. In particular, we assume

12

the absence of matching and sorting on unobservables, as defined above.
Assumption 2.4 (No Matching and Sorting On Unobservables)
¯
¯
( ()  () ) ⊥  ¯  

(    ) ⊥  

Assumption 2.4 will be satisfied if groups are formed, and locations selected at random, (i.e.
under a double randomization scheme). To describe this scheme assume that the social planner
first chooses a feasible distribution of group compositions
sq () 
where the ‘sq’ superscript denotes ‘status quo’ and the density is across groups (i.e., it describes
composition for the population of locations/groups). Feasibility of the status quo (as well as that
of any other allocation), requires that it satisfies a restriction. Because the fraction high types 
is fixed, and all groups are equally-sized, feasibility requires that
 =

Z

0

1

sq ()d

(5)

where we treat  as a continuously-valued random variable (as would be appropriate if the common
group size,  , is large).
After choosing a feasible joint distribution for group composition the planner fills high and low
type spaces in each group by randomly sampling from the high and low type subpopulations. This
ensures, along with Assumption 2.3, satisfaction of the second part of Assumption 2.4. The social
groups, so formed, are then randomly assigned to a specific location. Random assignment at this
stage ensures that the first part of Assumption 2.4 is satisfied.
As discussed above Assumption 2.4 rules out matching and sorting (on unobservables) (cf.,
Graham, 2008, forthcoming). It does not, however, restrict the degree of status quo segregation or
integration (sq () is unrestricted beyond the requirement of feasibility). Consider the example
where locations are schools and  = 1 for white students and  = 0 for black students. In that case
Assumption 2.4 implies that the ability distribution of blacks is similar across schools regardless of
the degree to which they are segregated. Furthermore it requires that unobserved teacher quality is
independent of the degree to which a school is segregated. Clearly these are rather strong restrictions
outside of explicitly experimental settings. Nevertheless, by initially maintaining Assumption 2.4
in what follows, we are able to develop some results on the eﬀects reallocations in a reasonably
straightforward way. In Section 5 we show how the presence of observable location-level attributes
may be used to weaken Assumption 2.4.
Our next assumption ensures that the gradients, ∇  () and ∇  (), are identified.
Assumption 2.5 (Continuous Variation) If sq ()  0 then sq (0 )  0 for all 0 in a neighborhood of  ⊂ S.
13

Assumption 2.5 only makes sense if it is legitimate to treat group composition,  , ‘as if’ it were
a continuously distributed random variable. Such an approximation requires that the common
group size,  , be relatively large. Thus our estimands and estimators are not appropriate for
situations where groups are small (e.g., college roommates).
Finally we assume the availability of a random sample of locations.
Assumption 2.6 (Random Sampling) {     }
=1 is a random sample of  neighborhoods of
 =  individuals.
These last three assumptions, as well as the restrictions on each individual’s allocation response
function implied by Assumptions 2.1 to 2.3, ensure that  ()   () and their derivatives with
respect to  are asymptotically revealed.
Proposition 2.1 Under Assumptions 2.1 to 2.6 (i)  () and  () are identified for all  such
that sq ()  0 by the conditional expectation functions (CEFs):
E[ | = 0  = ] =  ()

E[ | = 1  = ] =  ()

and (ii) ∇  ( ) and ∇  ( ) are identified by the derivative of these CEFs with respect to
.
Proof See Appendix B.
3

Characterizing the eﬀects of social spillovers

In this section we introduce new estimands which characterize diﬀerent features of the outcome
eﬀects of social spillovers. Prior work on the empirics of social interactions has emphasized testing
for their presence and/or measuring their average strength. We therefore begin by proposing a
simple measure of average spillover strength. The primary goal of this section, however, is to
present summary measures of the eﬀect of local reallocations on the distribution of outcomes. In
particular we consider the outcome and inequality eﬀects of a class of reallocations which increase
segregation marginally.
3.1

Measuring spillover strength

Manski (1993), Brock and Durlauf (2001), Glaeser and Scheinkman (2003) and Graham (2008)
emphasizes the notion of a social multiplier or the ratio of the full eﬀect of marginal changes in
group composition to the private eﬀect:
∇  ()
 ()
=1+

 ()
 ()

for  () 6= 0

The social multiplier is an intuitive measure of spillover strength and has the virtue of being
unitless. Nevertheless, for simplicity, as well as technical reasons, we instead suggest a direct
14

measure of average spillover strength. Conditional on  =  the average external eﬀect is given by
 (). Averaging over individuals gives an overall average spillover eﬀect (ASE) of
 ase = E [ ( )  ( )] = E [ ( ) { ∇  ( ) + (1 −  ) ∇  ( )}] 

(6)

where  () is a fixed trimming function that gives zero weight to values of  () near the boundary
of the support of , specifically,
 () = 1 (   + ) 1 (   − ) 

 ⊂ S = [ ]

The introduction of fixed trimming into the definition of  ase is somewhat awkward, but is required
to ensure that (i) the semiparametric eﬃciency bound for  ase is non-zero and (ii) to avoid boundary
bias problems associated with nonparametric estimation of  () and  () (cf., Newey and
McFadden, 1994; Newey and Stoker, 1993).
Equation (6) equals the mean external eﬀect, or spillover benefit, of an unit increase in the
fraction of high type individuals in each group. Identification of  ase follows directly from Proposition 2.1 and random sampling. While it is easy to construct examples where the outcome eﬀects
of reallocations are nontrivial even if  ase = 0 (and vice versa), it is nevertheless a simple summary
measure of spillover strength; being a nonparametric generalization of the target estimand of a large
empirical literature (e.g., Coleman et al., 1966; Mayer and Jencks, 1989; Solon, 1999; Angrist and
Lang, 2004; Ciccone and Peri, 2006; Graham, 2008). While  ase is arguably of scientific interest it
does not, since the peer structure of all individuals cannot be simultaneously improved, measure
the eﬀects of an implementable policy.
3.2

Measuring the eﬀects of reallocations

The average spillover eﬀect measures the outcome benefit of an infeasible increase in the population
frequency of high types. In contrast reallocations of individuals across groups, since they leave the
population type distribution unchanged, are, at least in principal, implementable policies. Before
considering the eﬀects of a reallocation of individuals across groups, we define the general class of
reallocations under consideration. We assume that the social planner, or allocating agency, observes
each individual’s type,  and initial assignment (i.e., the planner observes sq (), the distribution
of  under the status quo, and  ) The planner also knows the high- and low-type mean allocation
response functions  () and  (). The planner does not observe  or  (or is institutionally
constrained to not act on this knowledge).
We consider reallocations obeying the feasibility constraint
Z

0

1

r () d =  

(7)

Equation (7) says that r () cannot imply an augmentation of resources, in this case the population
frequency of high types. The set of reallocations satisfying condition (7) is very large. In Section
15

6 we characterize average outcome-maximizing reallocations. Here we consider estimands which
characterize the eﬀects of a specific class of local reallocations.
Our local reallocation estimands measure the eﬀects of a particular parameterization of a small,
segregation increasing (relative to the status quo), reallocation. Specifically they give the sign of a
small such increase in segregation on average outcomes and inter-type inequality.
The reallocation density we consider takes the form
r (;  )


=
 sq
1 +  () 

µ

 +  () 
1 +  ()

¶



(8)

where  = E [  |  ( ) = 1] is the trimmed population frequency of high types (i.e., the frequency of high types with status quo assignments to groups with group compositions in the interior
of S) Appendix B demonstrates that (8) is a feasible reallocation.
Implementing the allocation defined by (8) is equivalent to altering the composition of the 
group according to the rule
r =  +  ( ) ( −  ) 
(9)
so that (8) is eﬀectively a mean-preserving spread of sq () when   0 . For   0 (8) increases
segregation across those groups with status quo compositions,  , within the interval from  +  to
− It leaves group composition unchanged across those groups that are initially highly segregated
such that  ≤  +  or    − . Implementing (8) involves moving high type individuals from
groups where the fraction of high types is below their trimmed population frequency (   ), to
groups where it is above that frequency (   ). Such moves are accommodated by switching
each high type with a corresponding low type individual. Highly segregated group compositions
are left unchanged by (8) to (i) ensure feasibility (it is diﬃcult to increase segregation in a group
that is already very segregated) and (ii) for technical reasons. We assume that  is small enough,
or equivalently,  large enough, to ensure that r ∈ [0 1] for all groups.
From (9) average outcomes after an segregation increasing reallocation are given by
E [ (r )] = E [ ( +  ( ) ( −  ))] 
We are interested in the direction of the eﬀect of implementing (8) on average outcomes when
 → 0 This corresponds to a small increase in segregation. Diﬀerentiating the above expression
with respect to  and evaluating at  = 0 gives the desired local segregation outcome eﬀect (LSOE):
 lsoe = E [ ( ) ∇  ( ) ( −  )] =   C ( ∇  ( )   |  ( ) = 1) 

(10)

with   = Pr ( ( ) = 1) 
Equation (10) is an intuitive condition. If groups where the fraction of high type agents exceeds
the trimmed population mean (   ) tend also to be relatively responsive to changes in  (i.e.,
∇  ( ) is larger than average), then reallocations that reinforce any existing segregation across
groups will tend to raise average outcomes. In contrast, if groups with a low fraction of high type
16

agents are very responsive to changes in , then reallocations that reinforce existing segregation
will tend to lower average outcomes.
To highlight the structure of  lsoe , and connect it to theoretical work on neighborhood sorting,
it is helpful to consider the decomposition
 lsoe = lppe + lepe 
where
lppe =   C (  ( )   |  ( ) = 1) 

lepe =   C (  ( )   |  ( ) = 1) 

Under the current setup, local reallocations may alter population average outcomes for two
distinct reasons. First, peer quality changes for those individuals who change groups as part of the
reallocation, called ‘movers’. This is an internalizeable or private peer eﬀect. Second, peer quality
changes for those individuals who do not switch groups as part of the reallocation, called ‘stayers’,
we call this the external peer eﬀect.
First, consider the private peer eﬀect. If the benefits of improved peer quality for high type
movers entering groups with an initially above average fraction of high types exceed the costs for low
type movers leaving such groups, then implementing (8) will tend to raise the average achievement
of movers. Observe that the private peer eﬀect will be zero when outcomes are separable in own
and peer types (as is often assumed in empirical work), positive when they are complementary (as
is typically assumed in theoretical work on sorting) and negative when they are substitutable. The
sign of the private eﬀect on average outcomes is captured by lppe  Positivity of lppe suggests the
presence of private incentives for further, segregating-increasing, sorting.
Second consider the external peer eﬀect. This term captures changes in average outcomes
operating through the reallocation’s eﬀect on average spillover strength. If the marginal benefit
of an additional high type on stayers is greater in groups with a large fraction of high types (i.e.,
lepe  0), then increased segregation will raise average outcomes by raising average spillover
strength. This term is only non-zero in the presence of some form of social spillover. The sign of
lepe determines the direction of the external eﬀect associated with implementing (8). This eﬀect
is not internalized by individuals as they negotiate switches in group membership.
The next theorem makes the above statements more precise and explicitly connects  lsoe to the
theoretical work on segregation and eﬃciency done by de Bartolome (1990), Benabou (1993, 1996),
Becker and Murphy (2000) and others.
Theorem 3.1 Under Assumptions 2.1 to 2.6  lsoe = lppe + lepe with (i)
lppe =   V (  |  ( ) = 1) E [ ( ) {∇  ( ) − ∇  ( )}|  ( ) = 1]
lepe =   V (  |  ( ) = 1)

× E [ ( ) {∇  ( ) − ∇  ( ) +  ∇  ( ) + (1 −  ) ∇  ( )}|  ( ) = 1]] 

17

where E [( )] = 1 with
 () =

1
 | () ( |  ( ) = 1)

¡
¢
E [  −  |     ( ) = 1] 1 −  | () ( |  ( ) = 1)
× R =1
¡
¢ 
E
[

−

|




(
)
=
1]
1
−

(
|

(
)
=
1)
d







|
()

=0

and (ii) the averages lppe and lepe give maximal weight to values at  =  and minimal weight
to those at  =  +  and  =  − 
Proof See Appendix B.
Theorem 3.1 provides a mathematical representation of the private and external eﬀects discussed
above. Theorem 3.1 implies that a small increase in segregation raises average outcomes if
2E [ ( ) {∇  ( ) − ∇  ( )}|  ( ) = 1]

(11)

+ E [ ( ) { ∇  ( ) + (1 −  ) ∇  ( )}|  ( ) = 1]
is greater than zero. The two terms in the above expression, to use the language of Benabou (1996),
are respectively weighted averages of the degree of complementarity and curvature. They are local
statistical analogs of identically named global deterministic objects discussed by Benabou (1996),
Fernández (2003) and others.
Theoretical work has generally assumed that ∇  () − ∇  ()  0 for all  ∈ (0 1) or
that own and peers’ type are global complements. Global complementarity ensures that high type
residents will always benefit more from improvements in peer quality than their low type neighbors.
While the empirical evidence for such a strong form of complementarity is mixed, theoretical work
nevertheless takes it as a primitive since it induces equilibrium stratification.15
Theorem 3.1 indicates that a measure of local average complementarity,
E [  ( ) {∇  ( ) − ∇  ( )}|  ( ) = 1] 
is important for determining whether small increases in segregation raise the average outcome. If,
in the neighborhood of  =  , own and peers’ type tend to be complementary, then the first
term in (11) will be positive. This is a ‘force’ in favor of a local increases in segregation being
outcome-raising. It is also suggestive of the existence of incentives for further segregation relative
to the status quo.
The theory literature also discusses the importance of curvature for determining whether segregation is outcome-maximizing. Curvature, equal to ∇  () + (1 − ) ∇  (), determines
whether there are diminishing returns to peer quality at the neighborhood level. Theoretical
work emphasizes the case where curvature is such that 2 {∇  () − ∇  ()} + ∇  () +
15

If the marginal benefit of an additional high type is greater for high types than it is for low types, then high
types will be willing to pay more to live in high quality neighborhoods in equilibrium

18

(1 − ) ∇  () is negative for all  ∈ S (i.e., global concavity of  () in group composition).
In that case complementarity of own and peer quality induces equilibrium segregation, but such
segregation is ineﬃcient in the sense that it does not maximize average outcomes (cf., Benabou,
1996, Proposition 7). In such a situation within a neighborhood high types always benefit more
from improvements in peer quality than do low types, while across neighborhoods areas with few
high types benefit more from increases in peer quality than do areas with many high types. This
situation, where the private and social incentives for sorting are misaligned has been emphasized
by Benabou (1993, 1996) and others.
Theorem 3.1 indicates that a measure of local average curvature,
E [  ( ) { ∇  ( ) + (1 −  ) ∇  ( )}|  ( ) = 1] 
is important for determining whether segregation is outcome raising in the current context as well.
If, again in the neighborhood of  =   the marginal benefit of an additional high type peer
tends to decline more with  for high relative to low types, then the second term in (11) will be
negative.
To summarize Theorem 3.1 indicates that the average outcome eﬀects of small increases in
segregation depend on the relative magnitudes of local average complementarity and local average curvaturve. These are statistical analogs of well-known deterministic objects from the multicommunity models literature. The novelty here, besides the introduction of statistical content, is
that the interpretation of  lsoe does not depend on a priori restrictions on  (). The cost of such
flexibility is that  lsoe provides only local information about the relative average outcome eﬀects of
segregation versus integration.
The LSOE provides an indication of the likely eﬀects of small increases in segregation on average
outcomes. An abiding concern of the literature on segregation, however, is the potential for an
equity versus eﬃciency trade-oﬀ. Even if increases in segregation raise average outcomes, such
eﬃciency gains may be unacceptable if they increase inequality across groups. On the other hand,
reallocations which both reduce inter-type inequality and raise average outcomes are especially
compelling.
Our next estimand measures the sign of the change in the high-low outcome gap associated with
a segregation-increasing reallocation. This object, the local segregation inequality eﬀect (LSIE),
along with the LSOE defined above, allows one to test for the presence of a local equity-eﬃciency
trade-oﬀ.
The average outcome of a high type individual under the status quo is given by, using iterated
expectations,
¸
∙
∙
¸

  ( )
E [  ( )|  = 1] = E
=E
 ( ) 


with a similar expression holding for low types. Therefore, after reallocation the high-low outcome

19

gap is given by
¸
∙
¸
1 − r
r
r
r
 ( ) − E
 ( ) =
E

1 − 
∙
¸
( +  ( ) ( −  ))
E
 ( +  ( ) ( −  ))

∙
¸
(1 −  −  ( ) ( −  ))
−E
 ( +  ( ) ( −  )) 
1 − 
∙

Diﬀerentiating with respect to  and evaluating at  = 0 gives a local segregation inequality eﬀect
of, or the sign of the reallocation’s eﬀect on the high versus low type average outcome gap equal
to,
¸
 ( )
{ ( ) +  ∇  ( )} ( −  )

¸
∙
 ( )
{− ( ) + (1 −  ) ∇  ( )} ( −  ) 
−E
1 − 

 lsie = E

4

∙

(12)

Estimation

Our approach to estimation of  ase   lsoe and  lsie involves forming sample analogs of the righthand-sides of, respectively, (6), (10) and (12) above. In order to do this we must replace  () 
 () and/or their derivatives with estimates (along with replacing  and, for the case of  lsie ,
 with estimates). We propose to use kernel smoothing methods to estimate each of these objects.
Let K () denote a kernel function that integrates to one and satisfies other conditions. Define
 ( −  ) = −1 K(( −  )). Our estimates of  () and  () are given by

b  () =

where
̂1 () =

b1 ()

b2 ()

1
1 X
 ( −  ) 
1


b  () =
̂1 () =

=1

̂2 () =

1
1 X
 ( −  )
1

b1 ()
b2 ()

(13)


1 X
 ( −  ) 
0
=1 +1

̂2 () =

=1


1 X
 ( −  )
0
=1 +1

We assume that the sample is ordered so that the 1 high types appear first followed by the
0 =  − 1 low types.

20

We estimate the derivatives of  () and  () by the derivatives of their estimates:
b  () =
∇ 

1

b  ()]
[∇ b1 () − ∇ b2 () 
b2 ()
1
b  () =
b  ()] 
[∇ b1 () − ∇ b2 () 
∇ 
b2 ()

(14)

Finally we estimate  and  by
b =

1


P

=1  ( ) 

1 P
=1  ( )




1X
b =
 


(15)

=1

We begin by describing our average spillover eﬀect estimator, which is


X
base = 1

 ( ) { ∇ 
b  ( ) + (1 −  ) ∇ 
b  ( )} 

=1

ase

b 
The next proposition characterizes the large sample properties of 
√
base is  consistent with an asymptotic sampling
Proposition 4.1 Under regularity conditions 
distribution of
³
h
´
i´
√ ³ ase

b −  ase →
e 
e
 
N 0 E 

 

e =
where, 


P

 ( )  and  ( ), the eﬃcient influence function, is given by

∈{: =}

 ( )
 ( ) =


½
∇  ( )
 ( ) −  ase −
( −  ( ))
 ( )
µ∙
¶¾
¸
  (1 −  ) 
−
−

− [ ( ) −  ( )]

1 − 

Proof See the Supplemental Web Appendix.
base is of the ‘clustered’ variety. Independence
Observe that the asymptotic variance formula 
of outcomes holds across groups but not within them due to the presence of unobserved locational
heterogeneity,  .16 The form of the influence function is also instructive. The first term would be
the influence function if  () we known. The second two terms therefore capture the eﬀects of firststep nonparametric estimation of  ()  Of these two terms the first is identical to the correction
term associated with semiparametric average derivative estimation (cf., Härdle and Stoker, 1989;
Powell, Stock and Stoker, 1989; Newey and McFadden, 1994). This follows from re-expressing the
estimand as the diﬀerence
 ase = E [ ( ) ∇  ( )] − E [ ( ) { ( ) −  ( )}] 
16

Newey (1994a, p. 1367) notes that dependence of this type does not aﬀect the form of the eﬃcient influence
function.

21

Thus the first of the two correction terms captures the sampling uncertainty from having to estimate
∇  ( ), while the second is due to sampling error in the estimate of the diﬀerence  ( ) −
 ( ) 
The Supplemental Web Appendix derives the form of  ( ) using the methods described by
√
Newey (1994a). It does not provide primitive conditions for  consistency and asymptotic normality. This can be done along the lines of Newey and McFadden (1994, Section 8). Here we make
only a few comments that are particular to our problem. First, the weight function  ( ) serves
two distinct purposes. First, it ensures that the product  ()  () is zero on the boundary of the
support of . The pathwise derivative calculations in the appendix make clear that such a condition
is required for the semiparametric variance bound to be finite. Analogous weight functions play
a similar role in average derivative estimation as elegantly explained in Newey and Stoker (1993,
p. 1206). A second concern is boundary bias in our first step estimates ∇ 
b  () and ∇ 
b  ().
Eliminating such bias is required for the remainder term from linearization (of our second step
moment) to be small. The  () weight eﬀectively eliminates this problem by requiring us to only
estimate ∇ 
b  () and ∇ 
b  () on the interior of the support of . As is usual in semiparametric
estimation, higher order kernels are required for bias reduction, although the use of such kernels in
practice may be ill-advised.
Estimation of  lsoe parallels that of  ase . Using the first step estimates defined in (13), (14) and
(15) above we form the sample analog of (10):


X
blsoe = 1

 ( ) [
b  () − 
b  ( ) +  ∇ 
b  ( ) + (1 −  ) ∇ 
b  (  )] ( − b ) 

=1

√
blsoe is  consistent with an asymptotic sampling
Proposition 4.2 Under regularity conditions 
distribution of
³
h
´
i´
√ ³ lsoe

b
e
e
 
−  lsoe → N 0 E 

 

e =
where, 

 ( ) =

P

 ( )  and  ( ), the eﬃcient influence function, is given by

∈{: =}

 ( ) n
∇  ( ) ( −  ) −  lsoe

∇  ( )
−
( −  ( )) ( −  ) −  ( ) [ −  ( )]
 ( )
−E [ ∇  ( )|  ( ) = 1] ( −  )} 

Proof See the Supplemental Web Appendix.
As discussed in Section 3 above is interesting to decompose  lsoe into is private (mover), lppe ,

22

and spillover (stayer) components, lepe . These components may be estimated by


lppe


b

1X
=
 ( ) [
b  ( ) − 
b  ( )] ( − b )



b lepe =

1


=1

X
=1

 ( ) [ ∇ 
b  ( ) + (1 −  ) ∇ 
b  ( )] ( − b ) 

The next two propositions characterizes the large sample properties of these estimators.
√
Proposition 4.3 Under regularity conditions 
b lppe is  consistent with an asymptotic sampling
distribution of
³
h
´
i´
√ ³ lppe

e
e
 
b
− lppe → N 0 E 

 

e =
where, 

 ( ) =

P

 ( )  and  ( ), the eﬃcient influence function, is given by

∈{: =}

 ( ) n
 ( ) ( −  ) − lppe

½µ ¶
¾
½µ
¾
¶

1 − 
+
 −  () ( −  ) −
 −  ( ) ( −  )

1 − 

−E [  ( )|  ( ) = 1] ( −  )} 

Proof See the Supplemental Web Appendix.
√
Proposition 4.4 Under regularity conditions 
b lepe is  consistent with an asymptotic sampling
distribution of
´
i´
³
h
√ ³ lepe

e
e

 
b
− lepe → N 0 E 
 

e =
where, 

 ( ) =

P

 ( )  and  ( ), the eﬃcient influence function, is given by

∈{: =}

 ( ) n
 ( ) ( −  ) − lepe

∇  ( )
−
( −  ( )) ( −  ) − [ −  ( )]
 ( )
½µ ¶
¾
½µ
¾
¶

1 − 
−
 −  ( ) ( −  ) +
 −  ( ) ( −  )

1 − 

−E [  ( )|  ( ) = 1] ( −  )} 

Proof See the Supplemental Web Appendix.
blsoe .
Note that the sum of the influence functions for 
b lppe and 
b lepe equal that of 
Finally our estimate of  lise  the eﬀect of a small increase in segregation on the high-low outcome
23

gap, is given by
blise =




1 X  ( )
{
b  ( ) +  ∇ 
b  ( )} ( − b )

b

−

=1

X

1


=1

 ( )
{−
b  ( ) + (1 −  ) ∇ 
b  ( )} ( − b ) 
1 − b

√
blise is  consistent with an asymptotic sampling
Proposition 4.5 Under regularity conditions 
distribution of
³
h
´
i´
√ ³ lise

b −  lise →
e 
e 
 
N 0 E 

e =
where, 

P

 ( )  and  ( ), the eﬃcient influence function, is given by

∈{: =}

½
 ( ) 1
 ( ) =
{ ( ) +  ∇  ( )} ( −  )


1
{− ( ) + (1 −  ) ∇  ( )} ( −  ) −  lise
−
1 − 
1 ∇  ( )
−
(  −   ( )) ( −  )
  ( )
∇  ( )
1
((1 −  )  − (1 −  )  ( )) ( −  )
+
1 −   ( )
1
1
−
(  −   ( )) +
((1 −  )  − (1 −  )  ( ))

1 − 
¯
∙
¸
¯
1

¯
−
E
[ () + ∇  ()]¯  ( ) = 1 ( −  )


¯
∙
¸
¾
¯
1
1−
¯
+
E
[− () + (1 − ) ∇  ()]¯  ( ) = 1 ( −  ) 
1 − 
1 − 

Proof See the Supplemental Web Appendix.
5

Incorporating additional covariates

The identification and estimation results presented so far maintain strong assumptions on the form
of the status quo assignment. In this section we briefly discuss how the availability of individualand location-level covariates may be used to accommodate richer patterns of matching and sorting
in the status quo. Let  and  respectively denote vectors of observed individual- and locationlevel covariates (e.g., student and teacher characteristics or class size). We replace Assumptions
2.3 and 2.4 with the conditional analogs:
Assumption 5.1 (Inclusive Definition of Type)  ⊥  |    

24

Assumption 5.2 (No Matching and Sorting On Unobservables)
(    ) ⊥  |     

¯
¯
( ()   ()  () ) ⊥  ¯      

Assumption 5.1 establishes a diﬀerent normalization for unobserved ability: we now conceptualize ‘ability’ as one’s rank within the subpopulation of individuals homogenous in type ( ), other
observed individual attributes ( ), and observed location characteristics ( ).
Assumption 5.2 substantively weakens the requirements placed on the status quo allocation. The
first part of the assumption implies that location-specific unobservables,  , vary independently of
the type and ability structure of a group (    ). This independence, however, now needs to
hold only conditionally (on group members’ observed characteristics,   , and location-specific
characteristics,  ). This assumption rules out matching on unobservables, whereby groups with
particular type and ability structures are able to systematically secure locations with particular
unobserved characteristics. It does allow observed group member and location attributes (i.e.,
  and  ) to covary with unobserved location quality. That is, it allows agents to match on
observables.
The second part of the assumption implies that conditional on own- and location-specific observables each agent’s ability is independent of the abilities, types and other characteristics of their
peers. Conditional on own observed characteristics, individuals with higher ability, for example,
are not able to sort into groups with peers of above average ability. Importantly, this assumption
does allow for sorting on observables. For example, high type individuals may be more likely to
co-locate with other high types and, similarly,  may covary with  () .
One way to ensure the satisfaction of Assumption 5.2 is to adopt the following assignment
scheme. The planner begins by choosing a feasible joint distribution for (       ). Second, the
planner forms classrooms with specific racial (  ) and socioeconomic configurations (  ). These
classes must obey the constraints imposed by the joint distribution of  and  in the population.
Third, the planner assigns each class configuration to a certain type of teacher, defined in terms
of their value for  (e.g., a measure of teaching experience). Fourth, to fill a  =  and  = 
slot the planner draws a student at random from that subpopulation. To fill an  =  teaching
slot, the planner draws a teacher at random from that subpopulation.17 Assumption 5.2 is also
consistent with endogenous group formation under particular (and strong) informational structures
(cf., Heckman and Vytlacil, 2007a,b).
Assumption 5.2 allows for richer assignment patterns. For example, blacks in predominately
black classrooms may be poorer (i.e., more likely to be eligible for free or reduced price school
lunch), than blacks in predominately white classrooms. Observed measures of teacher quality may
also vary with class composition.
17

This scheme approximates that used by the Berkeley Unified School District for elementary school enrollment.

25

Adapting the argument used in the proof to Proposition 2.1 (see Appendix B) we can show that
Assumptions 5.1 and 5.2 yield the density factorization:
⎧
⎫

⎨Y
⎬
  |   (   |     ) =
 (  |    )  (  |    )
⎩
⎭
=1

so that the regression function

E [  |  = 1  =    =   = ] =  (  ) 

(16)

gives the expected outcome for a high type individual with observed characteristic  = , given
exogenous assignment to a group of composition  =  with observed peer and location characteristics  () = () and  = . The proxy variable regression function for low types,  (  ),
is analogously defined.
The reallocation estimands defined in Section 3 remain valid after replacing  () and  ()
with  (  ) and  (  ). The influence functions given in Section 4 remain valid after
replacing  () and  () with  (  ) and  (  ) and  () with   (  ).
Integrating over (   ) and invoking Assumptions 5.1 and 2.3 yields
Z Z

Z

  |   (   |     )  (   )d1      d d
⎧
⎫
Z Z
Z ⎨Y

⎬
=

 (  |    )  (  |    )  (   )d1      d d
⎩
⎭
=1
⎧
⎫

⎨Y
⎬
=
 ( )  ( )
⎩
⎭


=1

so that we can recover  () directly by the partial mean

 () = E  [E [  |  = 1  =      ]]
under appropriate support conditions and similarly for  () 
6

The social planner’s problem

In this section we characterize the structure of average outcome maximizing assignments of individuals to groups. We allow group size to vary, but only consider reallocations which leave the
marginal distribution of group-size fixed. Let group size  ∈ {1       } with   = Pr ( =  ) ;
the class of reallocations we study is completely characterized by the  = 1      conditional groupcomposition cumulative distribution functions:  | (| ). The social planner’s problem is thus a
functional (i.e., infinite-dimensional) optimization one. Such problems are typically quite diﬃcult
to solve, standard mathematical programming results being inapplicable.
26

In our case we show, by exploiting the special structure of the planner’s problem and the feasibility constraint, that a direct solution is available, easily characterized and computationally feasible.
This result allows us to identify the maximum average outcome level available via reallocation. A
comparison of the maximum average outcome with that observed under the status quo provides a
measure of eﬃciency of the status quo (cf., Bhattacharya, 2009). Consider a school board pondering
open enrollment. If current achievement levels are near the maximum attainable via reallocation,
then a costly change in the assignment mechanism may be less attractive.
Analysis of the planner’s problem also provides insight into the interaction of the production
technology and resource constraint (i.e., the fraction of high types in the population) in determining
the optimal allocation. Below we provide examples where, holding technology fixed, the optimal
allocation is either integrating or segregating depending on the type structure of the population.
This highlights the danger of informally inferring the optimality of segregation versus integration
by inspection of the production technology alone (as is common in practice).
We assume that the planner knows the mean allocation response function,  ( ), the status
sq
quo assignment, 
( )  and the population fraction of high types,  . Her problem is to
choose an allocation which maximizes expected average outcomes:
¸
Z
 ∙
X

max
 (  ) | ( |  ) d  

 | ( ·|1 ) | ( ·| )

(17)

=1

subject to restriction

¸
∙Z

X

| ( |  ) d   =  


(18)

=1

with  = E [ ]  Weighting by   ensures that the planner maximizes average individual
outcomes (and not the average of mean group outcomes).
Our characterization of the solution to (17) involves two steps. First, we solve a simplified
problem. In the simplified problem all groups are of the same size. In this case the only observable
dimension distinguishing groups is their composition. We show that the optimizing planner chooses
the allocation, ∗ (), in a way that implicitly ‘concavifies’ the mean allocation response function,
 () (we suppress the  argument when discussing the simplified problem). One intuition for our
result follows from the observation that an optimizing planner behaves similarly to that of a cost
minimizing producer facing (possibly) nonconvex isoquants (McFadden, 1978).
Second, using our first step result we show that the original problem can be broken into two
simple steps. Let   denote the fraction of high types in the subpopulation of individuals assigned to
groups of size  (as part of a candidate reallocation). Conditional on choosing such an allocation,
the optimal conditional allocations  | (|1 )       | (| ) are determined by our first result.
R
Since  =  | (|1 ) d we can re-write the feasibility constraint (18) as

X

   sq
 =  

=1

27

Figure 1: Optimal allocations for diﬀerent  () and 
NOTES: Each panel plots a diﬀerent expected allocation response function,  () (solid dark line).
The concave envelopes of these expected allocation response functions,  ()  are the given by the
dashed lines at or above  ()  The vertical dashed lines indicate the population frequency of high
types,   For figures with two such lines the second line (i.e., the right-most line) gives the location
of a second population frequency, 0  The point labeled  marks the location of (   ( )). The
points labeled  and  mark the locations of, respectively, (   ( )) and (   ( )) (when
 6=  ) The point labeled 0 , if present, marks the location of (0   (0 )).
and hence show that the original problem is equivalent to a finite-dimensional optimization problem
where the planner chooses the vector  = ( 1       )0 . Furthermore we show that the equivalent
problem is a concave one and hence that the Kuhn-Tucker conditions are both necessary and
suﬃcient. This allows us to provide a fairly complete characterization of the planner’s problem.
Numerical computation of an outcome maximizing allocation is straightforward. We can therefore
estimate the maximum attainable average outcome. A similar argument can be used to characterize
the problem of minimizing expected average outcomes.
The concave envelope of  ( ) plays an important role in our argument. The following
definition, adapted from Horst, Pardalos and Thoai (2000), defines this object.
Definition 6.1 Let  : S → R1 be a continuous function with S = [ ] (a convex set in R1 ), then
the concave envelope of  () taken over S is a function  () such that
28

(i)  () is concave on S, (ii)  () ≥  () for all  ∈ S, (iii) if  () is any concave function defined on S such that  () ≥  () for all  ∈ S, then  () ≥  () for all  ∈ S.
Formally  () is the function whose truncated lower epigraph coincides with the convex hull
of the truncated lower epigraph of  () (cf., Rockafellar, 1970). Intuitively it is the uniformly best
concave overestimator of  () 
We begin by considering the planner’s problem when all groups are equally-sized. Outcome
maximizing allocations in that setting are characterized by the following theorem.
Theorem 6.1 Consider the problem
Z
max
 ()  () d

s.t.

 (·)∈Γ

Z

 () d =  

(19)

where  ∈ S = [ ] with  ≥ 0  ≤ 1 Γ is the space of all probability measures on S, and
 = E [ ]  then, with ∗ (·) denoting a solution to (19),
Z

 () ∗ () d =  ( )

and
∗ () = (1 − ) 1 ( ≥  ) + 1 ( ≥  ) 

=

(20)
(

 −
 −

12

  
 = 

(21)

where
 = max { :  ≥   ≤    () =  ()} 

 = min { :  ≤   ≥    () =  ()} 

Proof See Appendix B.
Theorem 6.1 shows that an outcome maximizing allocation may be constructed by a group
composition density with just two mass points. The location of these mass points coincide with the
s-axis values of the first extreme points to the ‘right’ and left’ of (   ( ))  To see why this is
the case it is helpful to examine some examples in detail.18 Figure 1 plots four diﬀerent forms for
 (). Consider Panel A of the figure. In that panel  () is globally convex. The concave envelope
of  () is equal to the straight line passing through the points B, A and C. The vertical dashed
line in this figure depicts the population frequency of high types,  . If ‘production’ on  ()  the
concave envelope of  (), were feasible, then, by Jensen’s inequality, an optimal allocating would
clearly be integrating: all groups would have a fraction of high types equal to  . While this is
not possible, this same average outcome is achievable by a segregating allocation with groups of all
low or high types. In Panel B of the figure,  () is globally concave. In that case  () and its
concave envelope  () coincide such that the integrated allocation maximizes average outcomes.
These two cases correspond to those emphasized in the multi-community models literature.
18

We thank Emmanuel Saez for providing some of these examples. His intuitive insight was key in being able to
show Theorem 6.1.

29

Panels C and D depict more complicated examples. In Panel C  () has both concave and
convex regions. If  = 02, shown by the left-most vertical dashed line in the figure, then the
social planner will form some groups with no high types (point B in the figure) and some partially
integrated groups (point C in the figure). The proportion of each type of groups is determined by
the feasibility constraint. This example illustrates the key idea of the theorem: because groups can
be formed with diﬀerent proportions of high types, the output level  ( ) is attainable. Since
 () ≥  () for all  ∈ [0 1] and is concave it follows that  ( ) equals the maximal attainable
average outcome level. Mathematically the result follows from that fact that any point on the
convex hull of a set of points can be represented as a linear combination of extreme points on the
hull.
Panel C highlights a second feature of our problem. As discussed above, when  = 02 (leftmost vertical dashed line),  ( ) ≥  ( ) so that the social planner will choose a segregating
allocation. In contrast when  = 08 (right-most vertical dashed line)  ( ) =  ( ) so that
the social planner will choose a perfectly integrated allocation. This provides a simple, albeit
stylized, example of how knowledge of the production technology alone is not suﬃcient for solving
the planners problem. Panel D gives a further example of an average outcome response function
with both convex and concave portions.
The solution to the original social planner’s problem is characterized by the following corollary
to Theorem 6.1.
Corollary 6.1 A solution to the social planner’s problem defined by (17) and (18) is given by
∗
 |
( |  ) = [1 −  (  )] 1 ( ≥  (  )) +  (  ) 1 ( ≥  (  ))

where
 ( ) =

(

  − ( )
 (  )− ( )

 (  )   (  )

12

 (  ) =  (  )

for  = 1      and
 (  ) = max { :  ≥   ≤     (  ) =  (  )}
 (  ) = min { :  ≤   ≥    (  ) =  (  )} 
with  (  ) the concave envelope of  (  ) on  ∈ S and  1       the solution to the concave
programming problem

X

 (    )   
 1 ∈S ∈S


max

=1

s.t.


X

    =  


(22)

=1

Proof See Appendix B.
Corollary 6.1 provides a simple algorithm for calculating the maximum attainable average outcome available via reallocation. First, compute  (  ) for each of the  group sizes. Second,
30

solve the concave program (22). Third, compute the value of
Our final identification result follows directly:

P


=1  

(    )   at the solution.

Proposition 6.1 If (i) Assumptions 2.1 to 2.6 hold and (ii)  sq
| ( |  )  0 for all  ∈ S and
∗
 = 1      then (a)  |
( |  ) is identified and (b) so is the eﬃciency measure


esq

¸
Z
 ∙
X

∗
=
 (  ) | ( |  ) d   − E [ ] 

=1

The eﬃciency of the status quo measure (ESQ),  esq , equals the maximum average outcome
gain, relative to the status quo, available via reallocation.
7

Empirical illustration

Here we apply our methods to an analysis of classroom gender composition on student achievement.
The data were collected as part of a randomized study of the eﬀects of class size on student performance (Project STAR). They have been previously analyzed by, among others, Whitmore (2005),
Krueger and Whitmore (2001), and Graham (2008). The study involved randomized assignment
of both teachers and students to classrooms, a design feature important to our analysis. We focus
on the question of the eﬀect of segregation by sex in classrooms.
We have information on 5,781 kindergarten students in 325 classrooms (on average 18 per class).
We focus on math achievement as the outcome, normalized to have zero mean and unit variance.
The average test score for girls is 0.08 and -0.08 for boys. Girls make up 49% of the sample. Figure
2 presents average achievement scores, averaged over all children in the class, as a function of the
proportion of girls in the class. There is a clear upward slope in the regression function, implying
that, on average, classes with more girls perform better than classes with few girls. This regression
function by itself does not provide any evidence of spillover eﬀects. The second panel in the figure
presents a histogram of the proportion of girls in the 325 classrooms, ranging from 0.28 to almost
0.80.
Figure 3 presents estimates of  () and  () (the regression functions for girls and boys
respectively) separately. The estimation procedure is as described in Section 4 above with the
modifications needed for the presence of additional observables implemented as described in 5.
Other particulars of the estimation procedure are detailed in the notes to the tables and figures.
These nonparametric estimates underly our estimates of the reallocation eﬀects studied above.
In Table 1 we present estimates of our various estimands. In Panel A we present the preferred
nonparametric estimates. In the first row the results for the average spillover eﬀect  ase are reported.
The estimates suggest that, on average (averaged over both girls and boys), kids benefit from having
more girls in the class. This provides strong, nonparametric, evidence of peer spillovers from gender
composition (cf., Whitmore, 2005). The next row of estimates gives the local segregation outcome
eﬀect,  lsoe . It shows that, although on average kids benefit from having more girls as classmates,

31

Figure 2: Average math achievement and classroom gender composition, Project STAR Kindergarten Students
Notes: The left-hand-side of the figure plots kernel partial mean estimates of  () =
E [ (     ) + (1 − )  (     )] where   is empty and  includes total school enrollment, fraction female in the school, and class size. A multivariate standard normal kernel was used
with a bandwidth matrix proportional to the covariance matrix of the regressors. The degree of
proportionality was chosen by leave-own-school-out cross-validation. The dashed lines are pointwise
90 percent confidence intervals calculated using the approach of Newey (1994b) (modified to allow
for within-school dependence across observations). Units attending schools with enrollments below
50 or above 150 and/or those in schools with fraction female below 0.35 or above 0.65 were trimmed
when forming the partial mean (about 9 percent of the students). Valid test scores, standardized
to be mean zero with unit variance, were available for  = 5 871 students in  = 325 classrooms
located across 79 diﬀerent schools. The right-hand-side of the figure plots a histogram of peer
composition at the individual level.

32

Figure 3: Average math achievement by gender and classroom gender composition, Project STAR
Kindergarten Students
Notes: The figure plots kernel partial mean estimates of  () = E [ (     )] and  () =
E [ (     )]. Bandwidths, regressors, trimming and confidence intervals are as described in
the notes to Figure 2. A total of 2,857 students are used to compute the girls’ figure and 3014
students for the boys’ figure.

33

reallocating students to make classes slightly more segregrated by sex would not change average
outcomes much. Girls would benefit from such segregation, but boys would suﬀer to approximately
the same extent. The latter is shown directly by the last estimand, the local segregation inequality
eﬀect,  lsie . Increasing the segregation by a small amount increases the average test score diﬀerence
between girls and (lower performing) boys. Because the average eﬀect of additional segregation on
outcomes is close to zero, it is not surprising that breaking this down into a private and public
component  lppe and  lepe does not show much of an eﬀect either.
The last two columns of the table present estimates based on parametric models. The first of
these is the widely used linear-in-means model. In this model the eﬀect of the class composition is
identical for all children. As a result the reallocation eﬀects,  lsoe ,  lppe and  lepe are constrained
to equal zero. Although consistent with our nonparametric estimates, the linear-in-means estimate
of the average spillover eﬀect is considerably larger. The same holds for the second parametric
model that allows the for heterogeneity in peer eﬀects by type (e.g., Angrist and Lang, 2004).
Taking the partial mean estimates of the conditional means  () and  () as given, we can
informally solve the social planner’s problem discussed in Section 5. Because we have no classrooms
in the sample with very small or large fractions of girls, we restrict the allowable allocations to
those with fractions girls in the range [03 07]. Inspection of Figure 2 suggests that average math
achievement will be maximized when approximately two thirds of classrooms are 40% girls and
60% boys, and the remaining one third of classrooms 70% girls and 30% boys (as segregrated as
allowed).19 This would raise average test scores by about 0.04 standard deviations relative to the
status quo.
8

Summary

In this paper we have developed a unified framework for the analysis of the eﬀects of segregation in
the presence of social spillovers. We provide nonparametric identification and estimation results for
our proposed estimands when match and sorting is on observables alone. We also explore features
of the social planner’s problem and illustrate our methods by studying the eﬀects of sex segregation
in kindergarten classrooms.
Several areas potentially merit further study. The approach taken in this paper has been to
leave  () and  () nonparametric. The price for this flexibility is that our identification
and estimation procedures require strong conditions on the status quo assignment mechanism. It
would be interesting to explore whether the imposition of various a priori restrictions on  ()
and  () might facilitate the development of positive identification results under less stringent
restrictions on the status quo. An exploration of partially identifying assumptions, as in Manski
(2010), might also be fruitful.
Finally, we have not formally developed an estimator for  esq , our measure of the eﬃciency of
the status quo assignment. While showing consistency of the simple plug in estimator (informally)
19

For simplicity we assume that all classes have the average number of students (about 18).

34

used in the application should be straightforward, the characterization of its asymptotic sampling
properties appears more diﬃcult (cf., Graham, forthcoming).

35

Table 1: Nonparametric and parametric estimates of spillover strength and reallocation eﬀects
(math achievement, Project STAR Kindergarten Students)
Panel A: Nonparametric

 ase
 lsoe
lppe
lepe
 lsie
h

Panel B: Parametric

(1)
02273
(01432)
−00104
(00238)
−00003
(00027)
−00101
(00240)
00552
(00250)

(2)
02600
(01352)
−00108
(00236)
00002
(00027)
−00111
(00238)
00521
(00274)

(3)
03065
(01345)
−00075
(00229)
00004
(00027)
−00079
(00230)
00474
(00296)

(4)
03469
(01341)
−00004
(00205)
00009
(00027)
−00012
(00206)
00548
(00266)

CV/RT

5/6 of CV/RT

2/3 of CV/RT

1/2 of CV/RT

Linear-in-Means

Type-Specific
Linear-in-Means

04433
(01995)

04728
(02007)
00006
(00067)
−00003
(00034)
00009
(00036)
00656
(00266)
−

−
−
−
00628
(00264)
−

Notes: The estimates reported in Panel A of the Table were calculated use the kernel procedure outlined
in the main text. Estimated standard errors are in parentheses. A multivariate standard normal kernel
was used with a bandwidth matrix proportional to the covariance matrix of the regressors (fraction female
in the classroom, total school enrollment, fraction female in the entire school and class size). In the first
column of Panel A the degrees of proportionality used for estimating  (  )and  (  ) were
chosen by leave-own-school-out cross validation. The bandwidths for ∇  (  )and ∇  (  ) were
then taken to be rescaled versions of the corresponding cross-validated ones. The chosen rescaling reflects
the diﬀerential MSE-optimal bandwidth for pointwise conditional mean and derivative estimation. The
estimated standard errors are calculated using nonparametric estimates of the relevant influence functions.
The bandwidth used for the joint density of   (  ) which appears in the influence functions, is
a multivariate version of Silverman’s ‘rule-of-thumb’ bandwidth (cf., Wand and Jones, 1995, p. 111). The
bandwidth used for ∇   (  ) is a rescaling of this rule-of-thumb bandwidth. Columns 2 through
4 report undersmoothed estimates based on bandwidth values equal to, respectively, 5/6, 2/3 and 1/2 of
the column one bandwidth values. Panel B of the table reports estimates based on parametric models for
 (  ) and  (  ). Standard errors were calculated taking into account the sequential nature of
the estimation procedure. In both the nonparametric and parametric cases standard errors appropriately
account for arbitrary within-school dependence in outcomes across individuals. See the notes to Figure 2 for
additional details on the estimation sample.

36

Appendices
A

Some preliminary results

Lemma A.1 For  a continuous random variable, with (i) compact support X = [ ]  (ii) cumulative distribution
function  (), and (iii)  (·) a continuously diﬀerentiable function on the support of :
1. The slope coeﬃcient of the (mean squared error minimizing) linear predictor (LP) of  () given  has a
weighted average derivative representation of
B=
where
 () =
and



 ()
C ( ()  )
= E  ()

V ()


E [ −  | ≥ ] (1 −  ())
1


 () = E [ −  | ≥ ] (1 −  ()) d
=

E [ ()] = 1

2. B gives maximum weight to values of ()
for  close to its mean,  = E [], and minimum weight when

 is near the boundaries of its support.
The proof for the first result of the Lemma is similar to that of Lemma 5 of Angrist, Graddy and Imbens (2000).
The second result of the Lemma, i.e., the precise characterization
 = of the weighting process follows from a simple
integration by parts argument. Observe that  () −  () = = ()
 d and that E [ () ( −  )] = 0. Under
weak conditions we therefore have
C ( ()  ) = E [ () ( −  )]

 =
 ()
( −  ) d
=E

=

 =
 ()
( ≥ ) ( −  ) d
=E

=
 =
 ()
E [( ≥ ) ( −  )] d
=

=
 =
 ()
=
E [ −  | ≥ ] (1 −  ()) d

=
The variance of  can be written as


V () = E  ( −  )0

 =
1 ( −  ) d
=E
=



=
=

=

E [ −  | ≥ ] (1 −  ()) d

The first result follows for  () as given in the Lemma. To show the second result, that the weighted average
derivative representation of B gives the most emphasis to values of ()
for  close to its mean, begin by noting

that
  = ()

E [ −  | ≥ ] (1 −  ()) d
 ()


= =
E  ()
 =

E [ −  | ≥ ] (1 −  ()) d
=

Therefore the size of the weight on

()


is proportional to

E [ −  | ≥ ] (1 −  ()) 

37

Integration by parts (with  = 1 −  () and  = ) gives








[1 −  ()] d = [1 −  ()] | +



 () d

(23)



= − [1 −  ()]  +





 () d



We then write


{E [ −  | ≥ ] (1 −  ())} =



=

Using (23) to substitute for

















[1 −  ()] 


  () d −

  () d +   ()



  () d gives


[1 −  ()]  +



{E [ −  | ≥ ] (1 −  ())} =







+   ()

= [1 −  ()] +




− ( −  )  ()




[1 −  ()] d





[1 −  ()] d

= [1 −  ()] − [1 −  ()] − ( −  )  ()
= − ( −  )  () 


This gives 
{E [ −  | ≥ ] (1 −  ())} = 0 at  =   This derivative is negative for    and positive
for    , hence it attains a maximum at  =  and its minimum at the boundaries of the support of 

B

Identification proofs

Proof of Proposition 2.1: First we show that Assumptions 2.3 and 2.4 imply the density factorization
  | (   | ) =








 ( )  ( )

=1

(24)

as claimed in the main text. We begin by considering the implications of the second part of Assumption 2.4. Start
with the case where  = 2 (i.e., groups consist of two individuals). In this case the second part of Assumption 2.4
becomes
1  1 ⊥ 2 | 2 
2  2 ⊥ 1 | 1 
The first of these conditions generates the density factorization
 (1  2  1  2 ) =  ( 1 | 1 )  (2  1  2 ) 
while the second the factorization
 (1  2  1  2 ) =  ( 2 | 2 )  (1  1  2 ) 
These two factorizations give the conditional density factorizations
 | ( 1  2 | 1  2 ) =  ( 1 | 1 )  ( 2 | 1  2 ) =  ( 2 | 2 )  ( 1 | 1  2 ) 
Integrating over 1 we get
 ( 2 | 1  2 ) =  ( 2 | 2 ) 

38

which after substitution yields
 | ( 1  2 | 1  2 ) =  ( 1 | 1 )  ( 2 | 2 ) 
Now consider the  = 3 case. The second part of Assumption 2.4 now implies
 (1  2  3  1  2  3 )

=

 (1  2  3  1  2  3 )

=

 ( 1 | 1 )  (2  3  1  2  3 )

 ( 2 | 2 )  (1  3  1  2  3 ) 

so that after dividing through by  (1  2  3 ) and integrating over 3 we get the equalities
 ( 1  2 | 1  2  3 )

=

 ( 1  2 | 1  2  3 )

=

 ( 1 | 1 )  ( 2 | 1  2  3 )

 ( 2 | 2 )  ( 1 | 1  2  3 ) 

Integrating over 1 then yields the equality
 ( 2 | 1  2  3 ) =  ( 2 | 2 ) 
The same argument also gives the equalities
 ( 1 | 1  2  3 )

=

 ( 3 | 1  2  3 )

=

 ( 1 | 1 )

 ( 3 | 3 ) 

Now observe that, using the results above,
 | ( 1  2  3 | 1  2  3 )

=
=
=

 ( 1 | 1 )  ( 2  3 | 1  2  3 )

 ( 1 | 1 )  ( 2 | 2 )  ( 3 | 1  2  3 )

 ( 1 | 1 )  ( 2 | 2 )  ( 3 | 3 ) 

Finally Assumption 2.3 gives
 | ( 1  2  3 | 1  2  3 ) =  (1 )  (2 )  (3 ) 
The above argument can be generalized to groups of arbitrary size such that under Assumption 2.4 we have
 | ( | ) =




 ( )

=1

Now using the first part of Assumption 2.4 we get
  | (    |  ) =  | ( | ) ( ) 
which along with the factorization of  | ( | ) derived above gives the needed result.
Now using (24) we can write
  | (    |  )

=
=
=
=




  (·)    (·)



  (·)    (·)  



 (·)  ()
 ()
∈(·)

 
  (·)     


(25)

where the second equality follows from that fact that − is a deterministic function of (·)  the third equality from
(24), and the fourth by inspection of the second and third density representations.

Recall that Assumptions 2.1 and 2.2 give  =  (−    (
() )   (() )  ) Writing



 (−    (
() )   (() )  ) = (    −    (() )   (() )  )

39

we therefore have, using (25),





E [  |  = 1  = ] = E (    −    (
() )   (() )  )  = 1  = 
=





 




(1  −    (
(·) )   ((·) ) )








 
 (·)     d 
d(·)  d
∈(·)


(1  −    (
(·) )   ((·) ) )




 



 (·) d(·)  () d  () d
×




=



∈(·)

Let
  (  − ) =








(  −    (
(·) )   ((·) ) )


 


∈(·)





 (·) d(·)  () d


Observe that  (    − ) =  (− )  therefore by Assumption 2.3 we have


 (1  − )  () d

=
=



  (1  − )  | ( |  = 1) d

E [  (− )|  = 1] =  () 

as claimed. The result for  () follows analogously. Identification of the two gradient function then follows directly
from Assumption 2.5.
Feasibility of local reallocation density: Feasibility of (8) follows from the fact that, making the change of
variables  = ( +  )  (1 + ), and decomposing the integral,


0

1




 +  () 
d
1 +  ()
0


 −
 +
 1

 + 
sq () d +
sq () d
=
sq
d +
1+
0
+ 1 + 
−

r  (;  )d =



1


 sq
1 +  () 

= Pr ( ≤  + ) E [  |  ≤  + ]
 −
{(1 + )  −  } sq ()d
+
+

+ Pr ( ≥  − ) E [  |  ≥  − ]
= E [ ( ) {(1 + )  −  }]

+ Pr ( ≥  − ) E [  |  ≥  − ]
=  

as required.
Proof of Theorem 3.1: The result follows directly from Lemma A.1 above.
Proof of Theorem 6.1: Consider the problem
max

 (·)∈Γ



s.t.

 ()  () d



 () d =  

(26)

where  () is the concave envelope of  () on S By concavity of  () and Jensen’s inequality we have


 ()  () d ≤  (E []) 

Feasibility requires that E [] =  , therefore
max

 (·)∈Γ



 ()  () d ≤  ( )

40

(27)

Observe that this upper bound is attained by the degenerate distribution concentrated at  (i.e.,  ∗ =  ( )).
Since  () ≥  () for all  ∈ S we have the inequalities
( ) ≥



 ()  () d ≥



 ()  () d


for all feasible  (·)  Therefore any feasible ∗ () such that  ( ) =  () ∗ () d must be a solution to the
planner’s problem.
By the definition of  ()   and  we have that  () is linear on the interval  ∈ [   ], i.e.,
 ∈ [   ]

 () =  + 
with
 =  ( ) −



 ( ) −  ( )
 − 



 

=

 ( ) −  ( )

 − 

This gives




 ( ) −  ( )
 ( ) −  ( )
 ( ) =  ( ) −
 +

 − 
 − 


 − 
 − 
=  ( ) 1 −
+  ( )
 − 
 − 
= (1 − )  ( ) +  ( )

=  () ∗ () d


Since ∗ () d =   and therefore ∗ () feasible, we have that ∗ () is a solution to the planner’s problem as
claimed.
Proof of Corollary 6.1: Conditional on setting the fraction of high types assigned to groups of size  equal
∗
to  we know, by Theorem 6.1, that  |
( |  ) is an outcome-maximizing allocation. Since, again conditional

∗
on  ,  (  )  | ( |  ) d =  ( ), we may therefore choose 1       by solving (22) which is concave by
inspection.
References
Altonji, Joseph G. and Rosa L. Matzkin (2005). “Cross section and panel data estimators for nonseparable
models with endogenous regressors,” Econometrica 73 (4): 1053 - 1102.
Angrist, Joshua D., Kathryn Graddy and Guido W. Imbens. (2000). “The interpretation of instrumental
variables estimators in simultaneous equations models with an application to the demand for fish,” Review of
Economics Studies 67 (3): 499 - 527.
Angrist, Joshua D. and Kevin Lang. (2004). “Does school integration generate peer eﬀects? Evidence from
Boston’s Metco Program,” American Economic Review 94 (5): 1613 - 1634.
Arnott, Richard and John Rowse. (1987). “Peer group eﬀects and educational attainment,” Journal of Public
Economics 32 (3): 287 - 305.
Becker, Gary S. and Kevin M. Murphy. (2000). Social Economics: Market Behavior in a Social Environment.
Cambridge, MA: Harvard University Press.
Benabou, Roland. (1993). “Workings of a city: location, education, and production,” Quarterly Journal of
Economics 108 (3): 619 - 652.
Benabou, Roland. (1996). “Equity and eﬃciency in human capital investment: the local connection,” Review
of Economic Studies 63 (2): 237 - 264.
Bhattacharya, Debopam. (2009). “Inferring optimal peer assignment from experimental data,” Journal of the
American Statistical Association 104 (486): 486-500

41

Blundell, Richard W. and James L. Powell. (2003). “Endogeneity in nonparametric and semiparametric regression models,” Advances in Economics and Econometrics: Theory and Applications II : 312 - 357. (M.
Dewatripont, L.P. Hansen, S. J. Turnovsky, Eds.). Cambridge: Cambridge University Press.
Brock, William A. and Steven N. Durlauf. (2001). “Interactions-based Models,” Handbook of Econometrics 5:
3297 - 3380 (J. Heckman & E. Leamer, Eds.). Amsterdam: North-Holland.
Brock, William A. and Steven N. Durlauf. (2007). “Identification of binary choice models with social interactions,” Journal of Econometrics 140 (1): 52 - 75.
Calvó-Armengol, Antoni, Eleonora Patacchini and Yves Zenou. (2009). “Peer eﬀects and social networks in
education,” Review of Economic Studies 76 (4): 1239 — 1267.
Card, David and Jesse Rothstein. (2007). “Racial segregation and the black-white test score gap,” Journal of
Public Economics 91 (11-12): 2158 - 2184.
Ciccone, Antonio and Giovanni Peri. (2006). “Identifying human-capital externalities: theory with applications,” Review of Economic Studies 73 (2): 381 - 412.
Coleman, James S. et al. (1966). Equality of Educational Opportunity. Washington: U.S. Department of Health,
Education and Welfare.
de Bartolome, Charles A. M. (1990). “Equilibrium and ineﬃciency in a community model with peer group
eﬀects,” Journal of Political Economy 98 (1): 110 - 133.
Duncan, Greg J. and Stephen Raudenbush. (2001). “Neighborhoods and adolescent development: how can we
determine the links?” Does it Take a Village? Community Eﬀects on Children, Adolescents, and Families:
1005 - 136 (A. Booth and A. C. Crouter, Eds.). State College, PA: Pennsylvania State University Press.
Durlauf, Steven N. (1996a). “Neighborhood feedbacks, endogenous stratification, and income inequality,” Dynamic Disequilibrium Modeling: 505 - 534 (W. A. Barnett et al., Eds.). Cambridge: Cambridge University
Press.
Durlauf, Steven N. (1996b). “A theory of persistent income inequality,” Journal of Economic Growth 1 (1):
75 - 93.
Durlauf, Steven N. (1996c). “Associational redistribution: a defense,” Politics and Society 24 (4): 391 - 410.
Durlauf, Steven N. (2001). “A framework for the study of individual behavior and social interactions,” Social
Methodology 31 (1): 47 - 87.
Durlauf, Steven. N. (2004). “Neighborhood eﬀects,” Handbook of Regional and Urban Economics 4: 2173 2242 (J.V. Henderson & J.F. Thisse). Amsterdam: North Holland.
Epple, Dennis and Richard Romano. (1998). “Competition between private and public schools, vouchers, and
peer-group eﬀects,” American Economic Review 88 (1): 33 - 62.
Epple, Dennis, Elizabeth Newlon and Richard Romano. (2002). “Ability tracking, school competition, and the
distribution of educational benefits,” Journal of Public Economics 83 (1): 1 - 48.
Fernández, Raquel. (2003). “Sorting, education and inequality,” in Advances in Economics and Econometrics:
Theory and Applications, Eighth World Congress 2: 1 - 40 (M. Dewatripont, L. P. Hansen, S.J. Turnovsky,
Eds.). Cambridge: Cambridge University Press.
Figlio, David N. and Marianne E. Page. (2002). “School choice and the distributional eﬀects of ability tracking:
does separation increase inequality?” Journal of Urban Economics 51 (3): 497 - 514.
Ginsberg, William. (1974). “The multiplant firm with increasing returns to scale,” Journal of Economic Theory
9 (3): 283 - 292.
Glaeser, Edward and José A. Scheinkman. (2003). “Nonmarket interactions,” Advances in Economics and
Econometrics: Theory and Applications, Eighth World Congress 1: 339 - 369 (M. Dewatripont, L. P. Hansen,
S.J. Turnovsky, Eds.). Cambridge: Cambridge University Press.

42

Graham, Bryan S. (2008). “Identifying social interactions through conditional variance restrictions,” Econometrica 76 (3): 643 - 660.
Graham, Bryan S. (2009). “On the identification of neighborhood eﬀects in the presence of endogenous neighborhood selection,” Mimeo.
Graham, Bryan S. (forthcoming). “Econometric methods for the analysis of assignment problems in the presence of complementarity and social spillovers,” Handbook of Social Economics (J. Benhabib, A. Bisin & M. O.
Jacksons, Eds.). Amsterdam: North-Holland.
Graham, Bryan S., Geert Ridder and Guido W. Imbens (2007). “The eﬀect of reallocating an indivisible input
with discrete values,” Mimeo.
Graham, Bryan S., Geert Ridder and Guido W. Imbens (2009). “Complementarity and aggregate implications
of assortative matching: a nonparametric analysis,” Mimeo.
Guryan, Jonathan. (2004). “Desegregation and black dropout rates,” American Economic Review 94 (4): 919
- 943.
Härdle,Wolfgang and Thomas M. Stoker. (1989). “Investigating smooth multiple regression by the method of
average derivatives,” Journal of the American Statistical Association 84 (408): 986 - 995.
Heckman, James J. and Edward J. Vytlacil. (2007a). “Econometric evaluation of social programs, part I: causal
models, structural models and econometric policy evaluation,” Handbook of Econometrics 6 (2): 4779 - 4874
(J.J. Heckman & E.E. Leamer, Eds.). North-Holland: Amsterdam.
Heckman, James J. and Edward J. Vytlacil. (2007b). “Econometric evaluation of social programs, part II: using
the marginal treatment eﬀect to organize alternative econometric estimators to evaluate social programs, and
to forecast their eﬀects in new environments,” Handbook of Econometrics 6 (2): 4875 - 5143 (J.J. Heckman &
E.E. Leamer, Eds.). North-Holland: Amsterdam.
Holland, Paul W. (1986a). “Statistics and causal inference,” Journal of the American Statistical Association
81 (396): 945 - 960.
Holland, Paul W. (1986b). “Statistics and causal inference: rejoinder,” Journal of the American Statistical
Association 81 (396): 968 - 970.
Horst, Reiner, Panos M. Pardalos and Nguyen V. Thoai. (2000). Introduction to Global Optimization, 2n d Ed.
Dordrecht: Kluwer Academic Publishers.
Hoxby, Caroline M. (2003). “School choice and school competition: evidence from the United States,” Swedish
Economic Policy Review 10 (1): 9 - 65.
Hudgens, Michael G. and Elizabeth Halloran. (2008). “Toward a causal inference with interference,” Journal
of the American Statistical Association 103 (482): 832 - 842.
Ibaraki, Toshihide and Naoki Katoh. (1988). Resource Allocation Problems: Algorithmic Approaches. Cambridge, MA: The MIT Press.
Imbens, Guido W. (2004). “Nonparametric estimation of average treatment eﬀects under exogeneity: a review,”
Review of Economics and Statistics 86 (1): 4 - 29.
Imbens, Guido W. (2007). “Nonadditive models with endogenous regressors,” Advances in Economics and
Econometrics: Theory and Applications, Ninth World Congress 3: 17 - 46 (R. Blundell, W. Newey & T.
Persson, Eds.). Cambridge: Cambridge University Press.
Jacob, Brian A. (2004). “Public housing, housing vouchers and student achievement: evidence from public
housing demolitions in Chicago,” American Economic Review 94 (1): 233 - 258.
Kling, Jeﬀrey R, Jeﬀrey B. Liebman and Lawrence F. Katz. (2007). “Experimental analysis of neighborhood
eﬀects,” Econometrica 75 (1): 83 - 119.

43

Krueger, Alan B. and Diane M. Whitmore. (2001). “The eﬀect of attending a small class in the early grades on
college-test taking and middle school test results: evidence from Project Star,” Economic Journal 111 (468):
1 - 28.
Ladd, Helen F. (2003). “Comment on Caroline M. Hoxby: School choice and school competition: evidence
from the United States,” Swedish Economic Policy Review 10 (1): 67 - 76.
Lazear, Edward P. (2001). “Educational production,” Quarterly Journal of Economics 116 (3): 777 - 803.
Luenberger, David G. (1969). Optimization by Vector Space Methods. New York: John Wiley & Sons.
Luenberger, David G. (2005). Linear and Nonlinear Programming, 2n d Ed. New York: Springer.
Mael, Fred et al. (2005). Single-sex versus coeducational schooling: a systematic review. Washington, D.C.:
U.S. Department of Education, Oﬃce of Planning, Evaluation and Policy Development.
Manski, Charles F. (1992). “Educational choice (vouchers) and social mobility,” Economics of Education
Review 11 (4): 351 - 369.
Manski, Charles F. (1993). “Identification of endogenous social eﬀects: the reflection problem,” Review of
Economic Studies 60 (3): 531 - 542.
Manski, Charles F. (2000). “Economic analysis of social interactions,” Journal of Economic Perspectives 14
(3): 115 - 136.
Manski, Charles F. (2010). “Identification of treatment response with social interactions,” Mimeo.
Massey, Douglas S. and Nancy A. Denton. (1993). American Apartheid: Segregation and the Making of the
Underclass. Cambridge, MA: Harvard University Press.
Mayer, Susan E. and Christopher Jencks. (1989). “Growing up in poor neighborhoods: how much does it
matter,” Science 243 (4897): 1441 - 1445.
McFadden, Daniel L. (1978). “Cost, revenue, and profit functions,” Production Economics: A Dual Approach
to Theory and Applications, Volume I: The Theory of Production: 3 - 109 (M. Fuss and D. L. McFadden,
Eds.). Amsterdam: North-Holland.
Moﬃtt, Robert A. (2001). “Policy interventions, low-level equilibria and social interactions,” Social Dynamics:
45 - 82 (S. Durlauf & P. Young, Eds.). Cambridge, MA: MIT Press.
Morse, Susan, Ed. (1998). Separated by Sex: A Critical Look at Single Sex Education for Girls. Washington,
D.C.: American Association of University Women Educational Foundation.
Nesheim, Lars. (2002). “Equilibrium sorting of heterogenous consumers across locations: theory and empirical
implications,” CEMMAP Working Paper CWP08/02.
Nesheim, Lars. (2009). “Sorting and interactions in schools: a semi-parametric model,” Paper presented at the
CIRANO-CIREQ Conference on Econometrics of Interactions.
Newey, Whitney K. (1994a). “The asymptotic variance of semiparametric estimators,” Econometrica 62 (6):
1349 - 1382.
Newey, Whitney K. (1994b). “Kernel estimation of partial means and a general variance estimator,” Econometric Theory 10 (2): 233 - 253.
Newey, Whitney K. and Daniel McFadden. (1994). “Large sample estimation and hypothesis testing,” Handbook
of Econometrics 4 : 2111 - 2245 (R.F. Engle & D.L. McFadden). Amsterdam: North Holland.
Newey, Whitney K. and Thomas M. Stoker. (1993). “Eﬃciency of weighted average derivative estimators and
index models,” Econometrica 61 (5): 1199 - 1223.
Neyman, Jerzy. (1923) 1990. “On the application of probability theory to agricultural experiments. Essays on
principles. Section 9,” (D.M. Dabrowska & T.P. Speed, Trans), Statistical Science 5 (4): 465 - 472.

44

Oakes, Jeannie. (1992). “Can tracking research inform practice? Technical, normative, and political considerations,” Educational Researcher 21 (4): 12 - 21.
Paulson, Amanda and Stacy A. Teicher. (2006). “Move to single-sex classes fans debate,” Christian Science
Monitor : October 26.
Piketty, Thomas. (2000). “Theories of persistent inequality and intergenerational mobility," Handbook of Income Distribution 1: 430 - 476 (A. Atkinson & F. Bourguignon). Amsterdam: North Holland.
Powell, James L, James H. Stock and Thomas M. Stoker. (1989). “Semiparametric estimation of index coeﬃcients,” Econometrica 57 (6): 1403 -1430.
Rivkin, Steven and Finis Welch (2006). “Has school desegregation improved academic and economic outcomes for blacks,” Handbook of the Economics of Education 2: 1019 - 1049 (E. Hanushek & F. Welch, Eds.).
Amsterdam: North-Holland.
Rockafellar, R. Tyrrell. (1970). Convex Analysis. Princeton, NJ: Princeton University Press.
Rubin, Donald B. (1974). “Estimating causal eﬀects of treatments in randomized and nonrandomized studies,”
Journal of Educational Psychology 66 (5): 688 - 701.
Rubin, Donald B. (1981). “Estimation in parallel randomized experiments,” Journal of Educational Statistics
6 (4): 377 - 400.
Rubin, Donald B. (1990). “Formal mode of statistical inference for causal eﬀects,” Journal of Statistical Planning and Inference 25 (3): 279 - 292.
Sampson, Robert J., Jeﬀrey Morenoﬀ and Thomas Gannon-Rowley. (2002). “Assessing neighborhood eﬀects:
social processes and new directions in research,” Annual Review of Sociology 28 (1): 443 - 478.
Sax, Leonard. (2005). Why Gender Matters: What Parents and Teachers Need to Know about the Emerging
Science of Sex Diﬀerences. New York: Doubleday.
Schofield, Janet Ward. (1995). “Review of research on school desegregation’s impact on elementary and secondary school students,” Handbook of Research on Multicultural Education: 597 - 616 (J.A. Banks & C.A.M.
Banks). New York: Macmillan Publishing USA.
Sobel, Michael E. (2006a). “Spatial concentration and social stratification: does the clustering of disadvantage
‘beget’ bad outcomes?” Poverty Traps: 204 - 229 (S. Bowles, S. N. & K. Hoﬀ, Eds.). Princeton, NJ: Princeton
University Press.
Sobel, Michael E. (2006b). “What do randomized studies of housing mobility demonstrate?: causal inference
in the face of interference,” Journal of the American Statistical Association 101 (476): 1398 - 1407.
Solon, Gary. (1999). “Intergenerational mobility in the labor market,” Handbook of Labor Economics 3: 1761
- 1800 (O. Ashenfelter & D. Card, Eds.). Amsterdam: North-Holland.
Urquiola, Miguel. (2005). “Does school choice lead to sorting? Evidence from Tiebout variation,” American
Economic Review 95 (4): 1310 - 1326.
Wand, M.P and M.C. Jones. (1995). Kernel Smoothing. Boca Raton: Chapman & Hall/CRC.
Weinberg, Bruce. (2006). “Social interactions and endogenous association,” Mimeo.
Weyl, Hermann. (1946). The Classical Groups: Their Invariants and Representations. Princeton, NJ: Princeton
University Press.
Whitmore, Diane. (2005). “Resource and peer impacts on girls’ academic achievement: evidence from a randomized experiment,” American Economic Review 95 (2): 199 - 203.

45

Measuring the eﬀects of segregation
in the presence of social spillovers: a nonparametric approach,
supplemental material: proofs of Propositions 4.1 to 4.5
This appendix details the derivation of the influence functions associated with the estimators described in Section
4 of the main paper. Equation number continues in sequence with that of the main paper. All notation is as established
in the main paper unless stated otherwise. In this appendix all expectations are with respect to the population of
individuals unless noted otherwise. The  subscripts on random variables are omitted to simplify the notation.
We begin by noting that  ase   lsoe and  lsie are unrestricted parameters in the sense that their definitions do
not place substantive restrictions on the joint distribution of  = (  )0 2 0 Newey (1990, pp. 106 - 107) notes
that the pathwise derivative of such unrestricted parameters will be unique. This implies that any regular estimator
will have an influence function equal to the unique pathwise derivative. Furthermore, as described in Newey (1994),
the semiparametric eﬃciency bound for such parameters can be calculated as the variance of the pathwise derivative
of the parameter with respect to the distribution of the data. The large sample characterization of the two-step Mestimators
√described in the main text follows from these observations. While we do not provide regularity conditions
ensuring  consistency and asymptotic normality of our proposed estimators, our calculations do provide a formula
for their large sample variance.
Note that we do provide conditions that guarantee finiteness of the semiparametric
√
eﬃciency bound, hence  consistency is achievable under suitable regularity conditions. Our approach is similar in
spirit and implementation to that of Newey and Stoker (1993) in their analysis of weighted average derivatives.
To describe our calculations further we let  () denote the true density of  = . A parametric submodel or
path is a parametric family of densities  (; ) containing the ‘truth’ (i.e.,  (; 0 ) =  () for some  0 ) Let  ()
denote the population value of the parameter in question when  is distributed according to  (; ). The pathwise
derivative is the function  () such that


∇  ()|=0 = E  () S ()0

(28)

where S () = ∇  (;  0 )  (; 0 ) denotes the score of  (; ) at  =  0 .2 1 By the delta method the Cramer-Rao
variance bound for  () in the parametric submodel is


−1
 
−1 

∇  ()0 = E  () S ()0 E S () S ()0
E S ()  ()0 
∇  () E S () S ()0

Since S () is unrestricted the supremum of all such Cramer-Rao bounds, or the semiparametric variance bound, is
obviously


E  ()  ()0 

By the arguments of Newey (1994) the asymptotic variance of any regular estimator of  is given by this bound.
The specific structure of each of our estimators can be used to simplify the calculation of  (). In particular
each of our estimators can be formulated as a two-step M-estimator with a nonparametric first step (cf., Newey and
McFadden, 1994). As shown by Newey (1994) such problems have certain features which can be exploited in order
to calculate the pathwise derivative. Let  be a function of , the arguments of which are suppressed in order to
simplify notation; each our estimators can be defined as the solution to

20

1 
 
(  
) = 0
=1


In such models the allowable set of scores can approximate any mean zero function of  (with finite variance).
The form of (28) and a simple argument due to Newey (1990, pp. 106 - 107) shows why  () is unique when
 () denote two pathwise derivatives (centered to be mean zero), by
 is an unrestricted parameter. Let  () and 
(28) we have



 () S ()0 = 0
E  () − 
21

When  is an unrestricted parameter the set of valid scores, or the tangent set, for the model is given by T =
 () belongs to this set orthogonality requires that
{S () : E [S ()] = 0}  Since  () − 

0 

 ()
 () = 0
E  () − 
 () − 
 ()  A simple intuition for this result, also due to Newey (1990), is that when
or, equivalently, the equality  () = 
the model places no restrictions on the distribution of the data  is just identified.

1

where  (  ) is some known function and 
 is a preliminary ‘first step’ nonparametric estimate of .
Let  ( ) =  (  0  ). Application of the chain rule yields

∇  (  ())  () d +  ( 0 ) S ()0  () d


= ∇ E0 [ (  ())] + E0  ( 0 ) S ()0 

∇ E0 [ (  ())] =



where E [·] denotes expectations taken with respect to the density  (; ) (throughout E [·] = E0 [·]). Noting that
E0 [ (  ()   ())]|= = 0 a direct application of the implicit function theorem and the previous result then
0
gives
∇  ()|=0 = − [∇ E0 [ (  0   ( 0 ))]]−1 × ∇ E0 [ (  0   ( 0 ))]

 

= −Γ−1 E  ( 0 ) S ()0 + ∇ E [ (  ( 0 ))]

with Γ = ∇ E [ (  0 )]|= 0 (assumed nonsingular). If we can find at function  () such that


∇ E [ (  ())] = E  () S ()0 

(29)

then the influence function for any regular estimator of , by the results of Newey (1990, 1994) and equation (28)
above, will be
 () = −Γ−1 { ( 0 ) +  ()} 
As explained by Newey (1994) and also Newey and McFadden (1994), the function  () may be viewed a correction
term which accounts for first step estimation of . Below we use the structure of (29) to calculate the appropriate
correction term for each of our estimators. In particular we begin by linearizing  (  ()) around the truth 0 
With  ( ) −  ( 0 ) ' Ψ (  − 0 )  Ψ ( ) linear in , and (29) we then have


∇ E [ (  () − 0 )] = ∇ E [Ψ (  ())] = E  () S ()0 

(30)

Finding the form of  () thus involves finding an ‘integral representation’ for E [Ψ (  ())]. The bulk of our
derivations detailed below are devoted to this step.
Once the form of  () has been calculated, the asymptotic variance formulae given in Section 4 follow directly.
A minor complication involves appropriately accounting for within-group dependence in the data induced by the
presence of unobserved location-specific attributes. As noted by Newey (1994, p. 1367), such dependence does not
 can be equivalently expressed as
aﬀect the form of  () and so can be accounted for relatively easily. Note that 
the solution to


1 
 
(  
) = 0
 =1
∈{: =}

with
 independence across groups so that the second step moment function is the within-group summation  (   ) =
∈{: =} (   ) Let



(   0 ) 

 = ∇ E
∈{: =}

and

 = −−1





∈{: =}

= 0


 (  0 ) +  ( ) 

so that the appropriate asymptotic sampling distribution is



√

 
0 
− )→

(
N
0
E
0
 



 = −1 
In all of the estimators considered here  = −E [ ] = −  so that 


∈{: =}  (  0 ) +  ( ) 

2

lsoe
Influence function derivation for 

B.1

We begin with the local segregation outcome eﬀect (LSOE) defined in Section 3:




10 () + 20 ()
40 ()

−

 lsoe
=
E
[
()
∇

()
(
−

)]
=
E

()
∇





0
30 ()
50 ()
0

where  = ( )0 (such that  = ( 0 ) ) and
10 () =  () E [   |  = ] =  ()  ()

(31)

20 () =  () E [ (1 −  )  |  = ] =  () (1 − )  ()
30 () =  ()

40 () = E [ ()  ]
50 () = E [ ()] 
Let  () = (1 ()  2 ()  3 ()  4 ()  5 ())0  For what follows it is helpful to note that   | ( | ) =  (1 − )1− 
The second step moment restriction defining  lsoe
is
0
 

E    lsoe
= 0
0  0
with


 



1 () + 2 ()
40 ()
× −
−  lsoe 
   lsoe   =  () ∇
3 ()
50 ()



Let    lsoe
0   =  ( )  linearizing  ( ) about 0 gives

 ( ) −  ( 0 ) ' Ψ (  − 0 ) 

where Ψ (  − 0 ) is linear in  − 0  The precise form of Ψ (  − 0 ) is obtained by expanding the two ratios
1 − −1 ( − 0 ) [( − 0 ) − (0 0 ) ( − 0 )]  the linearization
entering  ( ) pointwise. Since  − 0 0 = −1
0
−1
of  around 0 0 is given by 0 [( − 0 ) − (0 0 ) ( − 0 )]  This fact and the product rule allow us to write







 () − 10 () 
1
10 () + 20 ()  1
2 () − 20 () 
1 1 −
Ψ (  − 0 ) =  () ∇
 30 ()

30 ()
3 () − 30 ()


40 ()
× −
50 ()





10 () + 20 ()
40 ()
1
4 () − 40 ()
−  () ∇

×
1 −
5 () − 50 ()
30 ()
50 ()
50 ()

Diﬀerentiating the first term in {·} with respect to , collecting terms, and rearranging yields
Ψ (  ()) = 0 ()0  () + ∇  ()0 0 () + 0 ()0  () 

(32)

where
 − 
(− ()  − ()  −∇  () +  ()  ()  0 0)0
 ()
 − 
0 () =  ()
(1 1 − ()  0 0)0
 ()
 ()
0 () = −
∇  () (0 0 0 1 −E [  |  () = 1])0
E [ ()]

0 () =  ()

with
 () =

∇  ()

 ()

 () =

10 () + 20 ()

30 ()

lsoe will take the form  (   0 ) +  (), where  () is the term
As noted above the influence function for 
0

3

which ‘corrects’ for first stage nonparametric estimation. From (32) and (30) this term solves








∇ E 0 ()0  (; ) + ∇ E ∇  (; )0 0 () + ∇ E 0 ()0  (; ) = E  () S ()0 

To apply this result we begin by evaluating the expectations of on the left-hand-side of the above equation
term-by-term. By iterated expectations we have, for the first term in (32),


E 0 ()0  (; ) =



 − 
(− ()  − ()  −∇  () +  ()  ())
 ()


 (; ) E [  |  = 1  = ]
×   (; ) (1 − ) E [  |  = 0  = ]  0 () d
 (; )

=  () ( −  ) (− ()  − ()  −∇  () +  ()  ())


E [   |  = ]
×  E [ (1 −  )  |  = ]   (; ) d
1


= E 1 ()  () {1    (1 −  )  }0 
 ()

where the second equality follows from the fact that   | ( | ; ) =  (1 − )1− does not depend on  and
1 () = ( −  ) {−∇  () +  ()  ()  0 − ()  − ()}0 
To evaluate the second term of (32) we use integration by parts as in Powell, Stock and Stoker (1989) (with
() = 0 () 0 ()0 and  () =  (; )) to obtain a representation directly in terms of  (; ). Using the fact that
0 () and  (; ) vary in  alone, as well as the density factorization 0 () =  (1 − )1− 0 ()  we have


E ∇  (; )0 0 () =
=





0 () 0 ()0 [∇  (; )] d
=1

=0

=



=1



=01

 (1 − )1− 0 () 0 ()0 [∇  (; )] d

0 () 0 ()0 [∇  (; )] d

=0

1

= 0 () 0 ()0  (; ) 0 −


with

=1



=1

=0



∇ 0 () 0 ()0  (; ) d



∇ 0 () 0 ()0  (; ) d

=0−
 =0

= E 2 ()  () {1    (1 −  )  }0 

2 () = ( −  ) {∇  ()  0 0 0}0 + { ()  0 −1 −1}0 
This follows from the fact that 0 () 0 () = 0 at  = 0 1 since  (0) =  (1) = 0 and also that




∇ 0 () 0 ()0 = ∇  () ( −  ) {1 1 − ()  0 0}0
=  () ( −  ) {0 0 −∇  ()  0 0}0

+  () {1 1 − ()  0 0}0 

4

Finally we take the expectation of the final term in (32):


E 0 ()0  (; ) = −



 ()
∇  () (0 0 0 1 −E [  |  () = 1])0  (; ) 0 () d
E [ ()]

 ()
=−
∇  () (E [ ()  ] − E [ ()] E [  |  () = 1]) 0 () d
E [ ()]


 ()
∇  () 0 () d E [ () ( −  )]
=−
E [ ()]
= −E [ ∇  ()|  () = 1] E [ () ( −  )]


= E 3 ()  () {1    (1 −  )  }0 

where

3 () = E [ ∇  ()|  () = 1] {  −1 0 0}0 
Combining terms gives


E [Ψ ( 0 )] = E  ()  () {1    (1 −  )  }0 

with  () = 1 () + 2 () + 3 () or, equivalently,

 () = { () + ( −  )  ()  () + E [ ∇  ()|  () = 1]  

−E [ ∇  ()|  () = 1]  − ( −  )  () − 1 − ( −  )  () − 1} 

Diﬀerentiating with respect to  gives




∇ E  ()  () {1    (1 −  )  }0 = E  ()  () {1    (1 −  )  }0 S0

and hence a correction term of  () =  ()  () {1    (1 −  )  }0 or
 lsoe () = − ()

∇  ()
( −  ()) ( −  )
 ()

(33)

−  () ( −  ()) − E [ ∇  ()|  () = 1]  () ( −  ) 
as claimed.
B.2

Influence function derivation for 
 lppe

The local private peer eﬀect (LPPE) of Section 3 is given by




20 ()
40 ()
10 ()
−

−

=
E

()
lppe

0
30 ()
(1 − ) 30 ()
50 ()

with  () = (1 ()  2 ()  3 ()  4 ()  5 ())0 as defined in (31) above. Linearizing the implied moment function
gives
(34)
Ψ (  ()) = 0 ()0  () + 0 ()0  () 
where



 − 
 − 
−
 − [ () −  ()] ( −  )  0 0 

1−
 () −  ()
0 () = − ()
{0 0 0 1 − } 
E [ ()]

0 () =

 ()
 ()

5

Taking expectations of 0 ()0  (; ) yields



 − 
 − 
−
 − [ () −  ()] ( −  )

1−


 (; ) E [   |  = ]
×   (; ) E [ (1 −  )  |  = ]   () d
 (; )



 − 
 − 
=  ()
−
 − [ () −  ()] ( −  )

1−


E [   |  = ]
×  E [ (1 −  )  |  = ]   (; ) d
1


= E  1 ()  () {1    (1 −  )  }0 



E 0 ()0  (; ) =

where



 ()
 ()



 − 
 − 
−

 1 () = − [ () −  ()] ( −  )  0

1−

Now taking expectations of 0 ()0  (; ) we get


 () −  ()
E [ ()  ]
 () d
{1 − }
E [ ()]
E [ ()]


 () −  ()
 () d × E [ () ( −  )]
=−
 ()
E [ ()]


 ()
( () −  ()) × E [ () ( −  )]
= −E
E [ ()]



E 0 ()0  (; ) = −



 ()

= −E [  () −  ()|  () = 1] × E [ () ( −  )]


= −E 2 ()  () {1    (1 −  )  }0 

with

2 () = E [  () −  ()|  () = 1] {−  1} 
Using (34) and (30), these calculations suggest a correction term of the form
 lppe () =  ()

 





1−
 −  () ( −  ) −  ()
 −  () ( −  )

1−

(35)

− E [  () −  ()|  () = 1]  () ( −  ) 
as claimed.
B.3

Influence function derivation for 
 lepe

The local external peer eﬀect (LEPE) of Section 3 is given by



 



10 ()
20 ()
40 ()
+
(1
−
)
∇

−
=
E

()
∇
lepe



0
30 ()
(1 − ) 30 ()
50 ()

with  () = (1 ()  2 ()  3 ()  4 ()  5 ())0 as defined in (31) above. Linearizing the implied moment function
gives


1
1 () − 10 ()
( −  )
 − ()
3 () − 30 ()




1
1
2 () − 20 ()
 − ()
( −  )
3 () − 30 ()
 () 1 − 



40 ()
1
4 () − 40 ()

−  () (∇  () + (1 − ) ∇  ())
1 −
5 () − 50 ()
50 ()
50 ()


1
 ()

+  () (1 − ) ∇

Ψ (  ()) =  () ∇



6

By the chain rule we have
 () ∇



1
 ()





1
1 () − 10 ()
( −  )
 − ()
3 () − 30 ()

0 

0
 − 
1 () − 10 ()
=  () ∇
[1 − ()]
3 () − 30 ()
 ()


 
1
 − 
1 () − 10 ()

− −  ()   ()  () − ∇  ()
+  ()
3 () − 30 ()
 ()


where  () = ∇  ()  () as above. Similarly we have


1
2 () − 20 ()
( −  )
 − ()
3 () − 30 ()
1−
0 

0
 − 
2 () − 20 ()
=  () ∇
[1 − (1 − )  ()]
3 () − 30 ()
 ()



 − 
1
2 () − 20 ()
+  ()

−  ()   () (1 − )  () − (1 − ) ∇  ()
3 () − 30 ()
 ()
1−

 () (1 − ) ∇



1
 ()



Collecting terms and reorganizing yields the linearization
Ψ (  ()) = 0 ()0  () + ∇  ()0 0 () + 0 ()0  () 
where


 − 
1
1
− −  () 
−  ()   ()  () −  ()  0 0 
 ()

1−
 − 
{1 1 − ()  0 0} 
0 () =  ()
 ()
 ()
 () {0 0 0 1 − } 
0 () = −
E [ ()]

0 () =  ()

recalling that  () = ∇  () + (1 − ) ∇  () 
Evaluating the expectation of E 0 ()0  (; ) yields



1
1
 − 
− −  () 
−  ()   ()  () −  () 
 ()
 ()

1−


 (; ) E [   |  = ]
×   (; ) E [ (1 −  )  |  = ]   () d
 (; )



1
1
=  () ( −  ) − −  () 
−  ()   ()  () −  ()

1−


E [   |  = ]
×  E [ (1 −  )  |  = ]   (; ) d
1


= E 1 ()  () {1    (1 −  )  }0 



E 0 ()0  (; ) =

where






∇  ()
( −  )
 () −  ()  0
 ()




1
1
∇  ()
∇  ()
 ( −  )
−

( −  ) − −

 ()
1−
 ()

 1 () =

7

(36)

lsoe above we have
From the analysis of 
with





E ∇  (; )0 0 () = E 2 ()  () {1    (1 −  )  }0 
2 () = ( −  ) {∇  ()  0 0 0}0 + { ()  0 −1 −1}0 

Finally we evaluate the expectation of 0 ()0  (; ):


E 0 ()0  (; ) = −



 ()
 () (0 0 0 1 −E [  |  () = 1])0  (; ) 0 () d
E [ ()]

 ()
 () (E [ ()  ] − E [ ()] E [  |  () = 1]) 0 () d
=−
E [ ()]


 ()
 () 0 () d E [ () ( −  )]
=−
E [ ()]

where

= −E [  ()|  () = 1] E [ () ( −  )]


= E 3 ()  () {1    (1 −  )  }0 

3 () = E [  ()|  () = 1] {  −1 0 0}0 
The form of 1 ()  2 () and 3 () together imply a correction term of
 lepe () = − ()

∇  ()
( −  ()) ( −  )
 ()

−  () ( −  ())
 





1−
−  ()
 −  () ( −  ) +  ()
 −  () ( −  )

1−
− E [  ()|  () = 1]  () ( −  ) 

as claimed. Note that  lppe () +  lepe () = lsoe () as would be expected.
B.4

ase
Influence function derivation for 

The average spillover eﬀect is given by

= E [ ()  ()]
 ase
0





10 () + 20 ()
 () 10 ()
20 ()
= E  () ∇
−
−

30 ()
30 ()

1−
where 10 ()  20 () and 30 () are as defined in (31) above. Linearizing the implied moment function gives







1 () − 10 () 
10 () + 20 () 
1
2 () − 20 () 
Ψ (  () − 0 ()) =  () ∇
1 1 −
 30 ()

30 ()
3 () − 30 ()




  1 () − 10 () 
10 ()
1
20 ()
 () 1
2 () − 20 ()
−
−
−

−


30 () 
1−
30 ()
(1 − ) 30 ()
3 () − 30 ()

Diﬀerentiating the first term in {·} with respect to  and collecting terms yields

Ψ (  ()) = 0 ()0  () + ∇  ()0 0 () + 0 ()0  ()

8

(37)

with  () = (1 ()  2 ()  3 ())0 and
 ()
(− ()  − ()  −∇  () +  ()  ())0 
 ()
 ()
0 () =
(1 1 − ())0 
 ()


1
 () 1
−
 − [ () −  ()] 
0 () = −
 () 
1−

0 () =

where
 () =

∇  ()

 ()

 () =

10 () + 20 ()

30 ()

 () =

10 ()

30 ()

 () =

20 ()

(1 − ) 30 ()

Taking expectations of the first term in Ψ (  ()) we have


E 0 ()0  (; ) =



 ()
(− ()  − ()  −∇  () +  ()  ())
 ()


 (; ) E [  |  = 1  = ]
×   (; ) (1 − ) E [  |  = 0  = ]  0 () d
 (; )

=  () (− ()  − ()  −∇  () +  ()  ())


E [   |  = ]
×  E [ (1 −  )  |  = ]   (; ) d
1


= E 1 ()  () {1    (1 −  )  }0 

where the second equality follows from the fact that   | ( | ; ) =  (1 − )1− does not depend on  and
1 () = {−∇  () +  ()  ()  0 − ()  − ()} 
To evaluate the second term of (37) we use integration by parts (with () = 0 () 0 ()0 and  () =  (; )) to
obtain a representation directly in terms of  (; ). As in our analysis of  lsoe above we use the fact that 0 () and
 (; ) vary in  alone, as well as the density factorization 0 () =  (1 − )1− 0 ()  to get

with






E ∇  (; )0 0 () = 0 − ∇ 0 () 0 ()0  (; ) d


= E 2 ()  () {1    (1 −  )  }0 
2 () = {∇  ()  0 0 0}0 

This follows from the fact that




∇ 0 () 0 ()0 = ∇  () (1 1 − ())0
=  () (0 0 −∇  ())0 

9

Evaluating the expectation of the third term in (37) gives



1
1
−
 − [ () −  ()]

1−

 (; )  (; )
×   (; ) (1 − )  (; )   () d
 (; )



1
1
= −  ()
−
 − [ () −  ()]

1−


E [   |  = ]
×  E [ (1 −  )  |  = ]   (; ) d
1


= E 3 ()  () {1    (1 −  )  }0 



E 0 ()0  (; ) = −


with



 ()
 ()



1
1

3 () =  () −  ()  0 − 
 1−

Together these calculations suggest a correction term of the form
∇  ()
 ase () = − ()
( −  ())
 ()
 
 



1−
 −  () −
 −  ()
−  ()

1−
as claimed.
B.5

lsie
Influence function derivation for 

The local segregation inequality eﬀect (LSIE) is given by
lsie
=  lsie
 lsie
0
 − 

where

 ()
{ () + ∇  ()} ( −  )



 



10 ()
10 ()
40 ()
1
+ ∇
−
= E  ()
40 () 50 () 30 ()
30 ()
50 ()

 lsie
 = E



and

 ()
{− () + (1 − ) ∇  ()} ( −  )
1 − 


 


20 ()
20 ()
40 ()
 ()
−
+ (1 − ) ∇
−

=E
1 − 40 () 50 ()
(1 − ) 30 ()
(1 − ) 30 ()
50 ()

 lsie
 = E



with  () = (1 ()  2 ()  3 ()  4 ()  5 ())0 as defined in (31) above.

10

(38)

lsie
We begin by analyzing the first component of the estimand,  lsie
 . Linearizing the moment defining   we get

Ψ (  () − 0 ()) =
 ()



1
1  − 
 − 
−
 () 
 ()  
 () 

1

1







[ () + ∇  ()] 
[ () + ∇  ()]
E [ ()] 2
E [ ()] 


1 () − 10 ()
 3 () − 30 () 

×
 4 () − 40 () 
5 () − 50 ()





1
1
1 () − 10 ()
∇
( −  ) 
 − ()
+  ()
3 () − 30 ()

 () 
−

Diﬀerentiating the second term in {·} with respect to  yields
 ()




∇



1
 ()





1
1 ()
( −  )
 − ()
3 ()

0 


0
  −  1
1 ()
 ()
= ∇
 − ()
3 ()
  () 
0

  − 
1 ()
{−1 −  ()   ()  () − ∇  ()}0 
+
 ()
3 ()
  () 

where  () = ∇  ()  () as above.
Collecting terms allows us to write
Ψ (  ()) = 0 ()0  () + ∇  ()0 0 () + 0 ()0  () 
with


1  − 
1  − 
0 () =  () −
 ()  0
( ()  () − ∇  () −  ())  0 0
  ()
  ()
1  − 
0 () =  ()
{1 0 − ()  0 0}
  ()



 ()
1
[ () + ∇  ()] 0 0 0
 −1 
0 () = −
E [ ()] 

Taking the expectation of the first component of Ψ (  (; )) yields


E 0 ()0  (; )


 
1  − 
1  − 
 () −
=
 () 
( ()  () − ∇  () −  ())
  ()
  ()
=01


 (; ) E [  |  = 1  = ]
 (1 − )1−  () d
×
 (; )



 − 
 − 
 () 
( ()  () − ∇  () −  ())
=  () −




E [  |  = 1  = ]
×
 (; ) d
1
= E [1 ()  () {1    (1 −  )  }] 

where
1 () =




 − 
 − 
[− () +  ()  () − ∇  ()]  0 −
 ()  0 



11

To take the expectation of the second component of Ψ (  ()) we use integration by parts:


E ∇  (; )0 0 () =





0 () 0 ()0 [∇  (; )] d
=1

0 () 0 ()0 [∇  (; )] d




1
= 0 () 0 ()0  (; ) 0 − ∇ 0 () 0 ()0  (; ) d



= 0 − ∇ 0 () 0 ()0  (; ) d


= E 2 ()  () {1    (1 −  )  }0 
=

=0

with
2 () =

1
 ()
( −  ) { () + ∇  ()  0 0 0}0 +
{ ()  0 −1 0}0 



This follows from the fact that



1  − 
0
∇ 0 () 0 () = ∇  ()  ()
{1 0 − ()  0 0}
  ()


 − 
= ∇  ()
{1 0 − ()  0 0}

 ()
=
( −  ) {0 0 − () − ∇  ()  0 0}

 ()
{1 0 − ()  0 0} 
+

Finally the expectation of the third term is given by


E 0 ()0  (; ) = −

=−







E [ ()  ]
0 () d
 −1
E [ ()]



E [ ()  ]
[ () + ∇  ()]
− E [ ()] 0 () d




 ()
[ () + ∇  ()]
E [ ()] 
 ()

E [ ()] 



1

 ()

[ () + ∇  ()] 0 () d E [ () ( −  )]
E [ ()] 2





1
E
[ () + ∇  ()]  () = 1 E [ () ( −  )]
=−




= E 3 ()  () {1    (1 −  )  }0 
=−

with



3 () = −

1


E









[ () + ∇  ()]  () = 1 {−  1 0 0 0} 

lsie
The correction term portion of the eﬃcient influence function will take the form  lsie () =  lsie
 () −   (). The
forms for 1 ()  2 () and 3 () given above suggest that

 () ∇  ()
( −  ()) ( −  )
  ()
 ()
( −  ())
−






 ()
E
[ () + ∇  ()]  () = 1 ( −  ) 
−



 lsie
 () = −

The second part of the correction term,  lsie
 (), can be derived similarly to the first. This derivation, which is

12

omitted, yields
 () ∇  ()
((1 − )  − (1 − )  ()) ( −  )
1 −   ()
 ()
((1 − )  − (1 − )  ())
−
1 − 




 ()
1−
E
[− () + (1 − ) ∇  ()]  () = 1 ( −  ) 
−
1 − 
1 − 

lsie
 () = −

lsie
and hence  lsie () =  lsie
 () −   () equal to
lsie
 lsie () =  lsie
 () −   ()

 () ∇  ()
( −  ()) ( −  )
  ()
 () ∇  ()
((1 − )  − (1 − )  ()) ( −  )
1 −   ()
 ()
 ()
( −  ()) +
((1 − )  − (1 − )  ())

1 − 





 ()

E
[ () + ∇  ()]  () = 1 ( −  )






 ()
1−
E
[− () + (1 − ) ∇  ()]  () = 1 ( −  )
1 − 
1 − 

=−
+
−
−
+
as claimed.
References

Newey, Whitney K. (1990). “Semiparametric eﬃciency bounds,” Journal of Applied Econometrics 5 (2): 99 135.
Newey, Whitney K. (1994). “The asymptotic variance of semiparametric estimators,” Econometrica 62 (6):
1349 - 1382.
Newey, Whitney K. and Daniel McFadden. (1994). “Large sample estimation and hypothesis testing,” Handbook
of Econometrics 4 : 2111 - 2245 (R.F. Engle & D.L. McFadden). Amsterdam: North Holland.
Newey, Whitney K. and Thomas M. Stoker. (1993). “Eﬃciency of weighted average derivative estimators and
index models,” Econometrica 61 (5): 1199 - 1223.

13

