GRAPHICAL DIAGNOSTICS
OF ENDOGENEITY
Xavier de Luna and Per Johansson
ABSTRACT
We show that in sorting cross-sectional data, the endogeneity of a
variable may be successfully detected by graphically examining the
cumulative sum of the recursive residuals. Moreover, the sign of the bias
implied by the endogeneity may be deducible through such graphs. In
general, instrumental variables are needed to implement the graphical
test. However, when a continuous or ordered (e.g. years of schooling)
variable is suspected to be endogenous, a graphical test for misspecification due to endogeneity (e.g. self-selection) can be obtained without
instrumental variables.

1. INTRODUCTION
In regression models for continuous responses, all sorts of model
misspeciﬁcations may be diagnosed by an analysis of ordinary residuals,
i.e. from an ordinary least square (OLS) estimator. Endogeneity of variables
is a notable exception, however; with linear models, this is due to the OLS
estimated parameter being consistent for the reduced form parameter (other
than the structural parameter).

Modelling and Evaluating Treatment Effects in Econometrics
Advances in Econometrics, Volume 21, 147–166
Copyright r 2008 by Elsevier Ltd.
All rights of reproduction in any form reserved
ISSN: 0731-9053/doi:10.1016/S0731-9053(07)00006-0

147

148

XAVIER DE LUNA AND PER JOHANSSON

The purpose of this chapter is to show how recursive residuals associated
with a speciﬁc ordering of the data can be successfully graphically analyzed
in order to diagnose the endogeneity of a variable.1 In particular, we show
that a graphical display of the cumulative sum (CUSUM) of the recursive
residuals obtained by assuming exogeneity is helpful in diagnosing the
presence of endogeneity. Moreover, the sign of the bias implied by this
endogeneity (e.g. the direction of a self-selection bias) is also deducible
through such graphs. The use of recursive residuals was earlier advocated by
Harvey and Collier (1977) to test for functional misspeciﬁcation in
regression analysis.2 In particular, they proposed a t-statistic to test that
the residuals have expectation zero. This test is directly applicable to test
against endogeneity when the data is sorted adequately. Instruments may be
needed to obtain such a sorting.
However, an interesting case arises with a continuous or ordered
(e.g. years of schooling) variable whose endogeneity is due to selectivity.
Sorting the data with respect to this variable and looking at recursive
residuals obtained with a model where exogeneity is assumed allow us to
diagnose the misspeciﬁcation. In this case, endogeneity can thus be diagnosed
without specifying a model for the alternative, in contrast with the Hausman
test (cf. Hausman, 1978) for which certain instruments are needed.
In Section 2, we start by presenting a theoretical framework allowing us to
introduce special ordering of the data that are useful for diagnosing
endogeneity. Section 3 presents the methodology based on the calculation
of recursive residuals associated with relevant ordering of the data. Graphical
displays of these residuals as well as the Harvey–Collier (HC) test statistic are
proposed to diagnose the endogeneity of a variable. Sections 4 and 5 present
different areas of application. Thus, Section 4 looks at a textbook example
of endogeneity due to simultaneity of two variables. Section 5 discusses the
case of endogenous treatments. First, a homogeneous treatment model is
discussed; thereafter this model extended to a heterogeneous treatment
setting; and ﬁnally the heterogeneous treatment model is extended to an
ordered treatment (e.g. years of education). In Section 6, the graphical test is
used to test for endogeneity of education when estimating the return to
education. The chapter is concluded with a discussion in Section 7.

2. SORTING SCORES FOR ENDOGENEITY
We consider an observational study where independent observations are
available for a response y together with a set of exogenous variables x and a

Graphical Diagnostics of Endogeneity

149

possibly endogenous variable z (denoted the treatment in the sequel). The
following linear statistical model is considered:
y ¼ x0 b þ gz þ 
where e is a zero mean error term. The exogeneity of x implies that its
marginal density, pðx; dÞ, d 2 D  Rd , can be ignored without loss
of information about b and g (see, e.g. Gouriéroux & Montfort, 1995,
Chapter 1.5). Similarly, if treatment z is exogenous, its effect can be studied
by the sole speciﬁcation of pðyjz; x; b; gÞ, i.e. the density of the error term.
However, in a typical observational study, the exogeneity of treatment z
must be assessed.
We propose graphical diagnostics of endogeneity by sorting the data with
respect to a sorting score. The sorted data should then not be distinguishable
from any other random ordering, only under the exogeneity of the variable
of interest.
In general, there is no unique sorting score for a given problem, but
certain sorting scores will be more useful than others. In order to present
results, we must give a minimal description of the alternative hypothesis of
endogeneity. Hence, let us consider an unobserved variable u such that
Eðjx; z; uÞ ¼ u

(1)

Let
mðx; z; hÞ ¼ x0 b þ gz
where h ¼ ðb0 ; gÞ0 . Under H0: ‘‘z is exogenous’’, implying within this
framework that Eðujx; zÞ ¼ 0, we have that mðx; z; hÞ ¼ Eðyjz; xÞ, the
unbiased and optimal (with minimum mean squared error of prediction)
predictor of y, given x and z.
Let us deﬁne hc (possibly a function of c) as
hc ¼ arg min E½fy  mðx; z; hÞg2 jz; x; soc
y

where s is a random variable. We call this variable a sorting score when it
is such that, hc ¼ h, a constant, only under H0. Such sorting scores will
allow us to identify endogeneity by ﬁtting mðx; z; hc Þ recursively to data
sorted with respect to s and looking for evidence of a varying parameter hc .
We now deﬁne a class of particularly useful sorting scores.
Deﬁnition 1. A monotone sorting score s for Eðyjx; zÞ is such that 8c 2 Os ,
mðx; z; hc ÞwEðyjz; xÞ for all x, z such that s>c, when H0 does not hold.

150

XAVIER DE LUNA AND PER JOHANSSON

We start by a preliminary result.
Lemma 1. If u ¼ lz, and hence sorting with respect to u or z is identical,
then for s=u, 8c 2 Os , mðx; z; hc Þ ¼ Eð yjz; xÞ for all x, z.
Proof. We have that Eð yjz; xÞ ¼ x0 b þ ðg þ lÞz. Moreover, hc is the
solution of
Eð y  mðx; z; hc Þjz; x; socÞ ¼ 0
8c 2 Os . But here, Eð y  mðx; z; hc Þjz; x; socÞ ¼ Eð y  mðx; z; hc Þjz; xÞ
and hc ¼ ðb0 ; g þ lÞ0 . The lemma is then proved.’
Thus, in the situation of the lemma, s=u is not monotone and will not
help us identify endogeneity. In fact, l and g are not identiﬁable in such a
situation. On the other hand, let u and z be not proportional but linearly
dependent as
u ¼ x1 z þ x2

(2)

where xi ; i ¼ 1; 2 are random variables with Eðxi jx; zÞ ¼ ai , a1 a0 and
V ðxi jx; zÞ  0, for any z. The latter inequality is assumed to be strict for at
least one i, i=1,2. Furthermore, when V ðx1 jx; zÞ40; z is assumed to be
either always non-negative or always non-positive. Then, it can be shown
that u is a monotone sorting score:
Proposition 1. Let u in Eq. (1) be such that under endogeneity of z, u and
z are linearly dependent as described by Eq. (2). Then, u is a monotone
sorting score.
Proof. We assume endogeneity of z. We get
Eð yjx; z; uÞ ¼ b0 x þ gz þ u
and
Eð yjx; zÞ ¼ b0 x þ gz þ Eðujx; zÞ
where Eðujx; zÞa0. Furthermore, for a constant c 2 Ou (the sample space
of u),
Eð yjx; z; uocÞ ¼ b0 x þ gz þ Eðujx; z; uocÞ
By the linearity assumption (2), we get Eðujx; z; uocÞ ¼ ac2 þ ac1 z,
where aci ¼ Eðxi jx; z; uocÞ; i ¼ 1; 2, are constants although functions of c.

Graphical Diagnostics of Endogeneity

151

Hence,
Eðyjx; z; uocÞ ¼ b0 x þ gz þ ac2 þ ac1 z
which is linear and equivalent to mðx; z; hc Þ. Moreover, because aci oai when
V ðxi jx; zÞ40 (this is true for at least one i), Eðujx; z; uocÞoEðujx; zÞ for any
positive z and Eðujx; z; uocÞ4Eðujx; zÞ for any negative z. Thereby the
monotonicity of u as sorting score is implied.’
Even if u is unobserved, this result is of practical use because the ordering
of u can be retrieved by studying z and its relation to certain instruments, see
the example sections below.
A most convenient case arises when z is a monotone sorting score in itself,
since no instrumental variables are then required. This situation can arise
when EðujzÞ is non-linear in z which is, for instance, the case with random
coefﬁcient models (see Section 5.3).

3. GRAPHICAL DIAGNOSTICS
Graphical diagnostics are informal tools for analysis but at the same time, a
very powerful medium for conveying information. A graph may tell more
than the value of a test statistic, although they are obviously complementary. Since ordinary residuals are not really appropriate to identify the
endogeneity misspeciﬁcation, we base our analysis on recursive residuals.

3.1. Recursive Residuals
Let a set of independent observations ðyi ; xi Þ; i ¼ 1; . . . ; n be generated by a
model with corresponding density pðyjx; hÞ. For each k ¼ q; . . . ; n  1, a
consistent estimate b
hk of h, based on ðyi ; xi Þ, i ¼ 1; . . . ; k, is assumed to be
available. Recursive residuals are then obtained by predicting yj with
Eðyj jxj ; b
hj1 Þ, j ¼ q þ 1; . . . ; n. This prediction is an estimate, based on
observations ðyi ; xÞ, i ¼ 1; . . . ; j  1 of the optimal (mean squared error
sense) predictor Eðyj jxj ; hÞ. The recursive residuals are then standardized
prediction errors:
wj ¼

yj  Eðyj jxj ; y^ j1 Þ
;
Varðy  Eðy jxj ; y^ j1 Þjxj Þ
j

j

j ¼ q þ 1; . . . ; n

152

XAVIER DE LUNA AND PER JOHANSSON

Assuming that the involved moments exist and that the model is well
speciﬁed, these recursive residuals are, at least asymptotically, independent
and identically distributed (i.i.d.) with mean zero, variance 1, i.e.
fwj g is i:i:d:;

Eðwj Þ ¼ 0 and Varðwj Þ ¼ 1 j ¼ q þ 1; . . . n

(3)

These properties hold exactly when h is known.
Example 1. The linear Gaussian model, yi ¼ x0i h þ i , with ei independently and normally distributed with mean zero and variance s2, is an
important particular case for which recursive residuals were originally
studied, e.g. by Brown, Durbin, and Evans (1975). For this model, we
have, for j ¼ q þ 1; . . . ; n,
wj ¼

yj  x0j b
hj1
sð1 þ x0j ðX0j1 Xj1 Þ1 xj Þ1=2

where Xj1 ¼ ðx01 ; . . . ; x0j1 Þ0 . Assuming that X0j1 Xj1 are invertible, wj are
homoscedastic, independent, and with standard normal distribution
(Brown et al., 1975). No asymptotic argument is needed here.
Kianifard and Swallow (1996) review the application of recursive
residuals (see also Dawid, 1984; de Luna & Johansson, 2000).

3.2. Cumulative Sum and the Harvey–Collier Test
A graphical diagnostic tool is obtained by graphically displaying recursive
residuals. Their CUSUM is most useful. Asymptotically, the recursive
residuals have mean zero for a well-speciﬁed model. When misspeciﬁcation
arises, in our case when exogeneity of the treatment does not hold, the
recursive residuals will typically have non-zero mean. If we then sort the
data with respect to s, a monotone sorting score, the residuals will have
positive (or negative) mean throughout the recursion.
The results of Section 2 can be used to obtain such sortings. In the time
series context, the aim when inspecting CUSUMs is to detect a change of
the parameter values (see, e.g. Brown et al., 1975). Most often this is
believed to be an abrupt structural change at an unknown point in time. The
endogeneity misspeciﬁcation is instead translated by small but systematic
biases in predictions. Thus, a monotone sorting score should be used for
these biases to accumulate instead of cancelling each other out, thereby

Graphical Diagnostics of Endogeneity

153

guaranteeing the best visual effect when plotting the CUSUM of the
recursive residuals. Examples illustrate these issues in the next section. The
constancy of the bias sign is also relevant for the test presented below to
have power.
Harvey and Collier (1977) proposed a simple test based on the sum of the
recursive residuals to identify functional misspeciﬁcation in a regression
model. In our context
w̄ ¼

n
1 X
wi
n  q i¼qþ1

which is the average of the recursive residuals. Then, under H0,
asymptotically, w̄ is (cf. Eq. (3)) normally distributed with mean zero and
variance 1=ðn  qÞ, and constitutes a test statistic for H0. This test is a
necessary complement to the CUSUM plot. Note that a simulation study
conducted by de Luna and Johansson (2000) showed the good properties of
the HC test in comparison with, e.g. a classic Hausman test.

4. CONSUMPTION AND INCOME APPLICATION
Consider the model for y and z:
y ¼ bx1 þ gz þ 
where variable z is endogenous, such that
z ¼ ax2 þ n
with e and n correlated.3 Denote x ¼ ðx1 ; x2 Þ. Assuming EðjnÞ to be linear in
n (e.g. bivariate normality), we have
Eðyjx; zÞ ¼ bx1 þ gz þ lðz  ax2 Þ

(4)

where l=0 if and only if e and n are uncorrelated. Here, s ¼ ðz  ax2 Þ is
chosen as a sorting score. Note that lsðx2 ; zÞ plays the role of the omitted
variable u in Eq. (1). The assumptions of Proposition 1 are met when, for
instance, x2 and z are jointly normal4 (so that Eðx2 jzÞ is linear in z), in which
case we can say that s is a monotone sorting score. It can be approximated
by ðz  a^ x2 Þ; where a^ is a consistent estimate. Note that x2 ¼ x1 would lead
to the non-identiﬁability of g, and the non-applicability of Proposition 1.

154

XAVIER DE LUNA AND PER JOHANSSON

Example 2. We use data on U.S. consumption expenditures (ct),
disposable income ( yt) and government expenditure (gt), in billions of
dollars in 1982, for year t between 1955 and 1986.5 However, in order to
make the presentation clear, we disregard the observations after the oil
crisis that started in 1976. We assume:
c t ¼ g 0 þ g 1 yt þ  t

(5)

where yt is endogenous such that
yt ¼ a0 þ a1 gt þ v t

(6)

Fig. 1 shows how the endogeneity of yt is revealed by using the residuals
from Eq. (6) as a sorting score. The hold-out sample in estimating the
recursive residuals is set to 5, thus q=5. The graphical diagnostic is, hence,
presented for the 1960–1975 period. In the southeast panel, we can see
the usefulness of the CUSUM to diagnose misspeciﬁcation. The pattern
of a monotonous increasing CUSUM indicates that the effects of income
CUSUM of rec. residuals

rec. residuals

15
10
5
0
-5
-10
-15

-10
-20
-30
-40

20
rec. residuals

1960 1962 1964 1966 1968 1970 1972 1974

CUSUM of rec. residuals

1960 1962 1964 1966 1968 1970 1972 1974

15
10
5

1 2 3 4 5 6 7 8 9 10

12

sorting score ordering

14

16

100
80
60
40
20
0
1 2 3 4 5 6 7 8 9 10

12

14

16

sorting score ordering

Fig. 1. Recursive Residuals and their CUSUM when Regressing the Consumption
Expenditures on Disposable Income (yt), using Time Ordering (Upper Panels)
HC=1.09 and the Ordering using the Sorting Score: Residuals of Regressing yt
on the Government Expenditure Variable (Lower Panels) HC=5.67.

Graphical Diagnostics of Endogeneity

155

of consumption is under-predicted as a result of the endogeneity.
This provides evidence of unobserved variable that is positively correlated
with income and evidence that the OLS estimate of g1 would be upward
biased.

5. TREATMENT-EFFECT MODELS
Consider for the time being a dichotomous treatment: z=1 if an individual
is treated and z=0 if not treated. Let y(0) be the potential outcome (e.g. log
income) if not treated, and let y(1) be the potential outcome if treated.
For a given individual, only one of these potential outcomes is observed
depending on whether she/he is actually treated or not. Let
yð0Þ ¼ a þ ð0Þ and yð1Þ ¼ a þ g þ ð1Þ

(7)

where e(0) and e(0) are stochastic variables with, Eðð0ÞÞ ¼ Eðð1ÞÞ ¼ 0, and
a and g are ﬁxed constants. The causal effect from treatment for a given
individual is equal to
G ¼ yð1Þ  yð0Þ ¼ g þ ð1Þ  ð0Þ
while a and a+g are the mean outcomes from no treatment and treatment,
respectively.
Using the switching regression framework, the observed outcome can be
written as
y ¼ zyð1Þ þ ð1  zÞyð0Þ ¼ a þ Gz þ ð0Þ
¼ a þ gz þ ½ð1Þ  ð0Þz þ ð0Þ

ð8Þ

The econometric problem to identify g consists of the following problems:
(i) z may be correlated with the unobserved e(0); (ii) G may be correlated
with z; and (iii) G may be correlated with e(0). The ﬁrst problem is the
standard sample selection problem (Heckman, 1978) or the standard errors
in variable problem (i.e. that z is measured with an error). The second
problem may occur when individuals select on anticipation of e(1)–e(0)
and is in the literature, denoted as selection on relative advantages or
sorting gains. The last problem occurs when, for instance, the best nontreated (i.e. those with high e(0)) are those with low gains from treatment
(i.e. low e(1)).

156

XAVIER DE LUNA AND PER JOHANSSON

5.1. Homogeneous Treatment Effects
In the standard endogenous treatment-effect model (cf. Heckman, 1978), it
is assumed that e(0)e(1)=e and that the outcome equation is described as
y ¼ x0 b þ gz þ 

(9)

The choice equation can be described as
z ¼ x0 a þ Z
z ¼ Iðz 40Þ

(10)

where z is an unobserved latent variable and x includes the covariates in x
and, at least, one variable not included in x. Endogeneity implies that Z and
e are correlated. If Z and e are bivariate normal and correlated, we have that
e
Eðjx ; zÞ ¼ rs1
where l ¼ fðx0 aÞ=ð1  Fðx0 aÞÞ and
2 ðlz  lð1  zÞÞ,
0
0
e
l ¼ fðx aÞ=Fðx aÞ.
Assuming joint normality of Z and e, and denoting s2Z ¼ 1, s2 , r, their
respective variances and correlation,
~
Eðyjx ; zÞ ¼ x0 b þ gz þ rs1
 ½lz  lð1  zÞ

(11)

The last term in this equation corresponds to the unobserved variable u in
Eq. (1). In this case, the hypotheses of Proposition 1 are fulﬁlled6 and u is
therefore a monotone sorting score. Here, the missing variable is not
observed but can be estimated by using a consistent estimator a^ of a.
Note that sorting with respect to lz  e
lð1  zÞ is equivalent to ﬁrst sorting
the subsample for which z=0 with respect to Fðx0 aÞ  1, or equivalently,
with respect to Prðz ¼ 1jx Þ ¼ Fðx0 aÞ, followed by the subsample with z=1,
which is also sorted with respect to Fðx0 aÞ. Prðz ¼ 1jx Þ is often called the
propensity score.7 More generally, i.e. without the need to specify the
relation between Eqs. (10) and (9), theory often predicts that the propensity
score is a monotone sorting score (in that individuals maximize the expected
return from the treatment; see, e.g. Heckman & Robb, 1986) allowing us to
test this prediction.
When there are more than two possible exclusive treatments, say m, the
outcome can be written as
y ¼ x0 b þ

m
X
k¼1

gk zk þ 

Graphical Diagnostics of Endogeneity

157

where zki ¼ 1 if individual i takes treatment k, k=1,y, m, and zero
otherwise. Then,
sðx ; zk Þ ¼

m
X

zk Prðzk ¼ 1jx Þ

k¼1

is a sorting score under the stringent model assumptions of Lee (1983). More
generally, treatments can be compared in pairs, e.g. against the nontreatment class, by using the data concerning only two such treatments and
then proceeding as in the above binary choice situation.
Finally, when there is a natural order and meaningful numbers can be
assigned to treatments, then the situation is similar to a continuous
treatment z and, for instance, the Garen (1984) model may be used, as
described in Section 5.3. Other models are reviewed in Vella (1998), where a
control function is always provided, often in the form of generalized
residuals. This control function corresponds to the unobserved variable u
and will often provide a useful sorting score.
5.2. Heterogeneous Treatment Effects
Here, we let r ¼ ð1Þ  ð0Þ and ð0Þ ¼ . We assume that the outcome
equation can be described as
y ¼ x0 b þ gz þ zr þ 
and that conditional on x the variables ð1Þ of ð0Þ are independent of the
treatment z.
The selection model is again given by Eq. (10). The reduced form is here
equal to
Eð yjx Þ ¼ x0 b þ gPrðx Þ þ Eðrjx ; z ¼ 1Þ  pðx Þ
¼ x0 b þ gPrðx Þ þ Eðrjpðx ÞÞ  pðx Þ
where, by assumption, Eðjx Þ ¼ 0 and pðx Þ ¼ Prðz ¼ 1jx Þ is the propensity score. The second equality follows from Theorem 3 in Rosenbaum and
Rubin (1983) assuming that 0opðx Þo1.
If there is no selection on relative advantages, then Eðrjpðx ÞÞ ¼ 0. In this
case, Eð yjx Þ is a linear function of the propensity score, which can be
seen as the treatment. The last term in the equation corresponds to the
unobserved variable u in Eq. (1). Here, the missing variable is once again not
observed but can be estimated. Non-linearity in pðx Þ means that there is

158

XAVIER DE LUNA AND PER JOHANSSON

heterogeneity in the returns to training and that individuals select
themselves into training based on their own known returns.
Remark 1. Note that Proposition 1 does not apply here. However, the
theory postulates that individuals maximize their present value of future
returns. Thus, stating further that individuals know their own coefﬁcient
r, and that they select themselves into training based on their own known
return, then not accounting for this in the estimation would lead to an
under-prediction of individual returns to training for increasing pðx Þ.
In other words, the economic theory predicts that pðx Þ is a monotone
sorting score, leading to recursive residuals with a positive mean.
If Eðrjpðx ÞÞ ¼ 0, a conventional two-stage least squares estimator would
estimate the average (for the population with covariates x) treatment
effect. It is, thus, of great interest to test whether individuals select
themselves into training or education based on their expected return.
Cairnero, Heckman, and Vytlacil (2003) suggest a Wald test based on the
inclusion of a third-order polynomial of pðx Þ and with standard errors
estimated using bootstrapping.

5.3. The Correlated Random Coefficient Model
Now we turn to the situation when the treatment is ordered or continuous.
The correlated random coefﬁcient model, proposed by Garen (1984, 1988)
can be written as8,9
y ¼ x0 b þ gz þ zr þ 
z ¼ f ðx Þ þ n

ð12Þ

For simplicity, we here assume no problem with sample selection, thus
Eðjx; zÞ ¼ 0. Here, x contains all the variables in x and possibly others.
For this model,
Eðyjx ; zÞ ¼ x0 b þ gz þ zEðrjnÞ

(13)

Assuming EðrjnÞ to be linear in n (e.g. bivariate normality), we
have EðrjnÞ ¼ lðz  f ðx ÞÞ. Exogeneity of z corresponds to l=0, i.e.
uncorrelated r and v variables. Here, heteroscedasticity is present even if z
is exogenous:
V ðyjx ; zÞ ¼ z2 V ðrjnÞ þ s2

(14)

Graphical Diagnostics of Endogeneity

159

where s2 is the variance of e. In this case, neglecting the endogeneity of z
leads to a misspeciﬁcation of the conditional expectation, by assuming it to
be linear while zEðrjnÞ is non-linear in x and z.
In this example, not accounting for the endogeneity of z corresponds
to omitting the variable10 zðz  f ðx ÞÞ in Eq. (13) that corresponds to u in
Eq. (1). The non-linearity of Eðyjx; zÞ may often be hidden by the
heteroscedastic noise when examining conventional residuals. On the other
hand, recursive residuals can often identify the systematic bias in predictions
obtained with the sorting score sðx ; zÞ ¼ zðz  f ðx ÞÞ11 as illustrated in
Example 3. Because f is unknown, an approximate sorting score must be
used to estimate this function, yielding zðz  fbðx ÞÞ. Note that within this
framework, it is possible to proceed without specifying a parametric form
for f, but instead using a non-parametric estimate.
Remark 2. An important property of the diagnostics (CUSUM plots and
HC test) is that they have the correct size as soon as l=0, even if the
random coefﬁcient r exists. This is to be contrasted with a classical
Hausman-type test (typically a conventional test on the residuals of the
regression of z against instruments, when introduced in the outcome
equation) where the null hypothesis is r  0 and which therefore has
power even against the mere existence of r.
Remark 3. The Garen model is an econometric translation of a
theoretical proposition saying that individuals maximize their present
value of future returns. Thus, stating further that individuals know their
own coefﬁcient r, we should observe a positive correlation between r and
z. If not taken into account, this leads to an under-prediction of individual
returns to training (or schooling) for increasing z’s.12 In other words, the
theory that has inspired the Garen model also predicts that z is a
monotone sorting score, leading to recursive residuals with a positive
mean.
Example 3. The Garen model is considered, and we simulate 100
observations with the following speciﬁcations: for i ¼ 1; . . . ; 100,
yi ¼ 1 þ 2x1i þ gi zi þ i
gi ¼ 1 þ r i
zi ¼ x1i  x2i þ ni

160

XAVIER DE LUNA AND PER JOHANSSON

with x1i  Uð0; 1Þ; x2i  Uð0; 1Þ; i  Nð0; 1Þ and ri and ni bivariate
normal with expectations zero, variances 0.36 and 1 respectively, and
correlation 0.5. Assuming exogeneity Eðyi jx1i ; zi Þ ¼ x1i b þ zi g is estimated with OLS. Here, zi vi corresponds to ui in Eq. (1), and thus from
Proposition 1 we know that ui ¼ zi vi is a monotonous sorting score. Since
Eðui jx1i ; zi Þ ¼ Eðui jni Þ ¼ 0:5ni neglecting ui in the recursive estimation
(using ui as a sorting score) would lead to an over-prediction of the
conditional mean and thus a negative recursive residual. This implies that
the CUSUM of the recursive residual are decreasing with u. Several types
of residual analyses are presented in Figs. 2 and 3.
From the residuals plots of Fig. 2, there seem to be no severe
heteroscedasticity (the conditional variance is given in Eq. (14)). Identifying
the misspeciﬁcation of the conditional mean is not straightforward with these
residual plots, although a trained eye may see some structure in the OLS
residuals when sorted with respect to the omitted variable, graph (b), and in

(b)

2

OLS resid

OLS resid

(a)

0
-2
0

20

40

60

80

2
0
-2

100

0

sorted w.r.t. to variable x

20

2
0
-2
-4
20

40

60

80

100

(d)
recursive residuals

recursive residuals

(c)

0

40

sorted w.r.t. the sorting score

60

random order

80

100

3
2
1
0
-1
-2
-3
0

20

40

60

80

100

sorted w.r.t. the sorting score

Fig. 2. Residuals from the Garen Model of Example 3: (a) OLS Residuals Sorted
w.r.t. the Variable z; (b) OLS Residuals Obtained with the Ordering of the Omitted
Variable (Optimal Sorting Score); (c) Recursive Residuals Obtained with a Random
Ordering; and (d) Recursive Residuals Obtained with the Optimal Sorting Score.

CUSUM of recursive
residuals

15
10
5
0
20

40

60

80

0

20

(d)

-15
-25
40

60

80

80

100

80

100

-25
0

20

40

60

sorted w.r.t. the estimated
sorting score

CUSUM of recursive
residuals

(f)

-30

40

100

-15

100

-10

20

80

-5

(e)

0

60

(c)

sorted w.r.t. the sorting score
CUSUM of recursive residuals

40

random order

-5

20

-2

sorted w.r.t. the sorting score

5

0

8
6
4
2

100

CUSUM of recursive
residuals

0

CUSUM of recursive residuals

(b)

Graphical Diagnostics of Endogeneity

CUSUM of OLS resid

(a)

60

sorted w.r.t. to variable z

80

100

0

-20

-40
0

20

40

60

sorted w.r.t. residuals from regress.
of z against x

161

Fig. 3. CUSUM Plots of various Residuals from the Garen Model of Example 3: (a) OLS Residuals Sorted w.r.t. the Sorting
Score zi ðzi  f ðxi ÞÞ  HCðri  0Þ ¼ 0:00; (b) Recursive Residuals Obtained with a Random Ordering HCðri  0Þ ¼ 0:40; (c)
Recursive Residuals Obtained with the Sorting Score zi ðzi  f ðxi ÞÞ  HCðri  0Þ ¼ 2:53; (d) Ditto but with an Estimate of
the Previous Sorting Score HCðri  0Þ ¼ 2:83; (e) Ditto but with the Sorting Score sðx; zÞ ¼ z  HCðri  0Þ ¼ 3:75; and
(f) Ditto but with the OLS Residuals from the Regression of zi on xi as the Sorting Score HCðri  0Þ ¼ 4:74.

162

XAVIER DE LUNA AND PER JOHANSSON

the recursive residuals obtained with this same sorting score, graph (d). The
CUSUM plots in Fig. 3 are more interesting. We note that the recursive
residuals obtained with well-chosen sorting scores all provide a clear sign of
the misspeciﬁcation of the conditional mean of the model (endogenous
treatment) by displaying a systematic departure from zero for the CUSUM
trajectory. This neat visual effect is due to the monotonic property. Note
that, as in Section 4, the residuals of the selection equation as well as the
endogenous variable itself also seem to provide monotone sorting scores
(see the bottom panel graphs e & f of Fig. 3). The values of the HC test (for
H 0 : ri  0), given in the caption of the ﬁgure, conﬁrm the visual impression.

6. RETURN TO SCHOOLING
In this section, we illustrate the kind of insights a graphical display of
CUSUM recursive residuals can yield. We use a data set13 previously
analyzed in Angrist and Krueger (1991) and the interest is to study
the effects of compulsory school attendance on wage (see also Angrist,
Imbens, & Krueger, 1999).
The linear model of interest in Eq. (12) tries to explain the log weekly
wage by the number of schooling years (z), while controlling for an age
effect (assumed to be exogenous). Schooling systems differ between states
(see Angrist & Krueger, 1991, Appendix 2), and for that reason, we perform
state-speciﬁc analyses. As argued in the previous section, the explanatory
variable describing school attendance can be used as a sorting score to check
its endogeneity, which is predicted by the theory. We discard individuals
with 0–11 years of education, in order to avoid effects due to compulsory
schooling laws.14 In particular, the compulsory schooling period should not
suffer from a selection bias.
Recursive residuals are computed starting from 13 years of education,
1–12-year cases serving as starting values, together with one individual
with 13 years to allow for estimability.15 In a sense, the question of interest
is whether the return to education remains constant after 12 years of
education, which most often corresponds to the completion of a high school
degree. Recursive residuals are not only useful for diagnosing whether years
of schooling are endogenous (selection bias) but also indicate the sign of
the selection bias when present (see Remark 3). This is illustrated by the
comments below.
Fig. 4 displays CUSUM plots of recursive residuals obtained for
California, Kansas, New York and Louisiana. We use the Californian case

Graphical Diagnostics of Endogeneity

163

California

Kansas
log weekly wage

log weekly wage

50
0
-50

40
20
0

-100
0

1000 2000 3000 4000 5000 6000

0

500

1000

1500

2000

individuals with increasing nr of years of education

individuals with increasing nr of years of education

New York

Louisiana
log weekly wage

log weekly wage

60

100
0
-200

10
0
-10
-20
-30
-40

-400
0

5000

10000

15000

individuals with increasing nr of years of education

0

500

1000

1500

2000

individuals with increasing nr of years of education

Fig. 4. Vertical Bars Indicate Years of Education; for instance, Residuals before the
First Bar Correspond to 13 Years, Residuals between the First and the Second Bar
are for Individuals with 14 Years of Education and so on, up to 20 Years. HC Values
are: 2.13 for California, 0.73 for Kansas, 5.23 for New York and 1.34 for
Louisiana.

for our main comments: The CUSUM plot indicates that there is actually no
selection bias up to year 15 of education (in agreement with Angrist &
Krueger’s, 1991 empirical ﬁndings, where they compared OLS and twostage least squares estimates). At year 16 (most often the completion of a
university degree) there seems to be a positive selection bias, however.
Indeed, although the HC value (1.02) is not signiﬁcant at this stage, the clear
upward trend observed for students with 16 years of education is convincing
enough (such a trend is clear in 31 states out of 50; examples include Kansas
and New York in Fig. 4, while Louisiana is a counter example). The nonsigniﬁcance of the test is most surely due to the fact that many of the
recursive residuals are consistent with the zero mean hypothesis (those
corresponding to 13–15 years of education). Finally, years 17–20 (most
often postgraduate studies) do not seem to be rewarded at the same rate as

164

XAVIER DE LUNA AND PER JOHANSSON

previous years in terms of log wages since there are strong negative trends
(over-predictions are observed); here, HC is signiﬁcant (this downward
pattern for postgraduate studies is observed in 39 states out of 50). The ﬁnal
HC value is seldom signiﬁcant unless, as for California and New York, a
large number of individuals are available. This is due to the use of a nonmonotone sorting score. The empirical evidence against its monotonicity is
actually interesting per se, because economic theory predicts monotonicity
(see Remark 3), more precisely positively biased recursive residuals. If we
thus take the theory seriously, then the non-monotonicity suggests a model
misspeciﬁcation (e.g. that return to schooling is increasing at a decreasing
rate). Alternatively, we need to reconsider the theory that states that
individuals are maximizing their present value of future returns based on
their knowledge of their relative advantages for schooling (see Remark 3).

7. DISCUSSION
In this chapter, a graphical analysis of the recursive residuals associated with
a sorting of the data has been advocated as a tool for diagnosing endogeneity.
We expect practitioners to ﬁnd this type of analysis a useful complement
to the existing tests for exogeneity. A major advantage of the graphical
analysis is that, in case of endogeneity, the direction of the bias implied by
the endogenous variable is directly available from the CUSUM plot of the
recursive residuals, as illustrated with the U.S. data on returns to schooling.
When instruments are available, our approach is complementary to
Hausman-type tests by providing an appealing graphical diagnostic tool.
The proposed HC test has, moreover, the advantage of having no power
against the presence of a random coefﬁcient in front of an exogenous
variable (see Remark 2).
Monotone sorting scores have been emphasized because they ensure the
best power when looking at CUSUM plots of recursive residuals. However,
as soon as endogeneity implies non-linearity of the conditional expectation,
e.g. random coefﬁcient models or non-normality of the error term in
the regression equation for the endogenous variable, then any sorting,
even a random sorting, may allow the analyst to diagnose endogeneity
(by identifying the non-linearity). In this case, even OLS residuals may be
sufﬁcient. This is, however, far from certain because this non-linearity is
often weak and the residuals are heteroscedastic. In this chapter, we have
shown how recursive residuals associated with a monotone sorting score
may overcome this difﬁculty.

Graphical Diagnostics of Endogeneity

165

NOTES
1. de Luna and Johansson (2005) also took advantage of such a speciﬁc ordering
of the data to introduce a test of exogeneity.
2. Endogeneity of a variable is often equivalent to a functional misspeciﬁcation.
For instance, if a random coefﬁcient is associated with a continuous endogenous
variable (e.g. Garen’s, 1984 model), the outcome equation is implicitly non-linear in
that variable.
3. Classical examples include: (i) y is a quantity of goods and z its price, and (ii) y
is a consumption measure and z is the disposable income.
4. This assumption might seem restrictive, but is only needed to ensure that
Proposition 1 can be applied. It should be observed, however, that the linearity of
E(s|z) is not a necessary condition for monotonicity.
5. This data is described in Hill et al. (1997) and obtained from http://
www.wiley.com
6. That is, u can be rewritten as Eq. (2).
7. Note that sorting the whole sample with respect to the propensity score does
not yield exactly the same sorting. In the latter case, the two subsamples deﬁned by
z=0 and 1 will generally not be fully separated by the sorting, since a non-treated
individual may in fact have a similar, or even higher, propensity to be treated than
the one who is actually treated.
8. See also Wooldrige (1997, 2003).
9. Garen also considered sample selection, i.e. y ¼ x0 b þ zd þ zr þ Z þ , with
Eðyjx ; zÞ ¼ x0 b þ zd þ zEðrjnÞ þ EðZjvÞ and EðZjvÞ ¼ rv. Here, we omit Z for clarity.
10. The omitted variable is a sorting score since l=0 under exogeneity.
11. Note that Proposition 1 does not apply here since E(s|z) is not linear in z.
However, E(s|z) is quadratic in z, and therefore, ﬁtting a linear model in z leads to a
systematic under-prediction of y; hence, s is a monotone sorting score.
12. Using the full sample OLS estimator on Eq. (12) would, of course, lead to a
positive-biased estimate of the mean return to schooling. Here, we rather discuss the
individual’s return to schooling, when sorting with respect to schooling, recursively
estimating the model with OLS, and thereafter performing out-of-sample predictions
using this previous OLS estimate.
13. The data set is available at: http://qed.econ.queensu.ca/jae/
14. Compulsory schooling laws may, in some instances, push students to complete
a high school degree( see Angrist & Krueger, 1991, pp. 1004–1005).
15. In this application, we have multiple observations for a given number of years
of education. These are left in their original ordering.

ACKNOWLEDGMENTS
We thank Daniel Millimet and an unknown referee for helpful comments.
The ﬁrst author would like to acknowledge the Wikström Foundation for its
ﬁnancial support.

166

XAVIER DE LUNA AND PER JOHANSSON

REFERENCES
Angrist, J. D., Imbens, G. W., & Krueger, A. B. (1999). Jackknife instrumental variables
estimation. Journal of Applied Econometrics, 14, 57–67.
Angrist, J. D., & Krueger, A. B. (1991). Does compulsory school attendance affect schooling
and earnings? Quarterly Journal of Economics, CVI, 979–1014.
Brown, R. L., Durbin, J., & Evans, J. M. (1975). Techniques for testing the constancy of
regression relationships over time (with discussion). Journal of the Royal Statistical
Society Series B, 37, 149–192.
Cairnero, P., Heckman, J., & Vytlacil, E. (2003). Understanding what instrumental variables
estimate-estimating marginal and average returns to education. Mimeo.
Dawid, A. P. (1984). Statistical theory: The prequential approach. Journal of the Royal
Statistical Society Series A, 147, 278–292.
de Luna, X., & Johansson, P. (2000). Testing exogeneity in cross-section regression by sorting
data. IFAU Working Paper no. 2000:2.
de Luna, X., & Johansson, P. (2005). Exogeneity in structural equation models. To appear in
Journal of Econometrics, 132, 527–543.
Garen, J. (1984). The returns to schooling: A selectivity bias approach with a continuous choice
variable. Econometrica, 52, 1199–1218.
Garen, J. (1988). Compensating wage differentials and endogeneity of job riskiness. Review of
Economics and Statistics, 70, 9–16.
Gouriéroux, C., & Montfort, A. (1995). Statistics and econometric models. Cambridge:
Cambridge University Press.
Harvey, A., & Collier, G. (1977). Testing for functional misspeciﬁcation in regression analysis.
Journal of Econometrics, 6, 103–119.
Hausman, J. A. (1978). Speciﬁcation test in econometrics. Econometrica, 46, 1251–1271.
Heckman, J. J. (1978). Dummy endogenous variables in a simultaneous equation system.
Econometrica, 46, 931–959.
Heckman, J. J., & Robb, R. (1986). Alternative identifying assumptions in econometric
models of selection bias. In: H. Wainer (Ed.), Drawing inference from self selected
samples (pp. 63–107). Berlin: Springer-Verlag.
Hill, R. C., Grifﬁths, W. E., & Judge, G. G. (1997). Undergraduate econometrics. New York:
Wiley.
Kianifard, F., & Swallow, W. H. (1996). A review of the development and application of
recursive residuals in linear models. Journal of the American Statistical Association, 91,
391–400.
Lee, L.-F. (1983). Generalized econometric models with selectivity. Econometrica, 51, 507–512.
Rosenbaum, P. R., & Rubin, D. B. (1983). The central role of the propensity score in
observational studies for causal effect. Biometrika, 70, 41–55.
Vella, F. (1998). Estimating models with sample selection bias: A survey. Journal of Human
Resources, 38, 127–169.
Wooldridge, J. M. (1997). On two stage least squares estimation of the average treatment effect
in a random coefﬁcient model. Economics Letters, 56, 129–133.
Wooldrige, J. M. (2003). Instrumental variables estimation of the average treatment effect in the
correlated random coefﬁcient model. Economics Letters, 79, 185–191.

