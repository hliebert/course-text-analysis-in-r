DOI: 10.1111/j.1541-0420.2005.00339.x

Biometrics 61, 816–823
September 2005

Stratified Analysis in Randomized Trials with Noncompliance
Shigeyuki Matsui
Department of Pharmacoepidemiology, School of Public Health, Kyoto University,
Kyoto 606-8501, Japan
email: matsui@pbh.med.kyoto-u.ac.jp
Summary. This article develops methods for stratiﬁed analyses of additive or multiplicative causal eﬀect on
binary outcomes in randomized trials with noncompliance. The methods are based on a weighted estimating
function for an unbiased estimating function under randomization in each stratum. When known weights
are used, the derived estimator is a natural extension of the instrumental variable estimator for stratiﬁed
analyses, and test-based conﬁdence limits are solutions of a quadratic equation in the causal parameter.
Optimal weights that maximize asymptotic eﬃciency incorporate variability in compliance aspects across
strata. An assessment based on asymptotic relative eﬃciency shows that a substantial enhancement in
eﬃciency can be gained by using optimal weights instead of conventional ones, which do not incorporate
the variability in compliance aspects across strata. Application to a ﬁeld trial for coronary heart disease is
provided.
Key words: Causal eﬀect; Eﬃciency; Noncompliance; Randomization; Stratiﬁed analysis.

1. Introduction
In clinical trials involving human beings, ethical considerations for study participants override scientiﬁc requirements.
Noncompliance with the intervention and study procedures
due to ethical reasons is thus inevitable in practice. In randomized trials with stratiﬁcation, the aspects of noncompliance are likely to vary from stratum to stratum, since stratiﬁed factors may aﬀect noncompliance directly or through the
outcome of the trial. A current convention to cope with noncompliance is the intention-to-treat (ITT) analysis in which
participants are analyzed according to the treatment they
were assigned rather than the treatment actually received
(Fisher et al., 1990; Lee et al., 1991). However, an ITT estimate may represent the eﬀectiveness of treatment policy, and
it generally underestimates the treatment eﬀect (Schwartz
and Lellouch, 1967; Sheiner and Rubin, 1995; Piantadosi,
1997). An ITT null test, however, would be a valid α level
test of the sharp causal null hypothesis of treatment eﬀect
of Fisher (1935), although a loss of power can occur due to
noncompliance.
Recently, randomization-based estimation methods that
are essentially to apply a test of a sharp causal nonnull hypothesis of treatment eﬀect have been developed for
nonstratiﬁed cases (Robins and Tsiatis, 1991; Mark and
Robins, 1993; Robins and Greenland, 1994; Sato, 1994, 2000).
For binary outcomes, Sato (1994) derived estimation formulae based on Fisher’s exact test or its approximation for
counterfactual data had all participants been subjected to
the control treatment under a sharp nonnull hypothesis, and
pointed out connections to the instrumental variable method
(Angrist, Imbens, and Rubin, 1996). Sato’s formulae are also
useful for sample size and power calculations that incorporate

compliance information (Sato, 2000). For stratiﬁed cases, Sato
(1994) has also provided a stratiﬁed-adjusted estimator for
risk diﬀerence and risk ratio. However, this estimator does not
incorporate the variability in noncompliance aspects across
strata, which may incur a loss of eﬃciency. In addition, ITTstratiﬁed null tests, which are commonly used for testing the
sharp null hypothesis of treatment eﬀect, ignore this variability. In this article, we extend Sato’s instrumental variable method to stratum-adjusted analyses by incorporating
this variability in noncompliance aspects across strata. An
assessment based on asymptotic relative eﬃciency shows that
substantial eﬃciency loss can occur when this variability is
ignored.

2. Randomization-Based Stratiﬁed Analysis
Consider a randomized trial with K strata. In stratum k (k =
1, . . . , K), nk participants are randomly assigned to the test
treatment and mk participants to the control treatment. From
among the nk test-assigned participants, only nk ,1 participants
compliantly receive the test treatment and, of nk ,1 , xk ,1 develop an event, while the remaining nk ,0 participants receive
the control treatment and, of nk ,0 , xk ,0 develop an event. Similarly, from among the mk control-assigned participants, mk ,1
participants receive the test treatment and, of mk ,1 , yk ,1 develop an event, while the remaining mk ,0 receive the control
treatment and, of mk ,0 , yk ,0 develop an event. Let Nk = nk +
mk be the total number of participants and tk = xk + yk be
the total number of events in stratum k, where xk = xk,1 +
xk,0 and yk = y k,1 + y k,0 . The notations are summarized in
K
Table 1. Let N = k=1 Nk be the total number of participants across strata.

816

Stratiﬁed Analysis in Randomized Trials with Noncompliance

817

Table 1
Notation for stratum k (k = 1, . . . , K )
Stratum
of events

Group

No. of
participants

No. of
events

k

Test

nk

xk

Control

mk

yk

Total

Nk

tk

Our randomization-based analysis needs three assumptions: the stable unit treatment value assumption (SUTVA),
the exclusion restriction assumption (Angrist et al., 1996),
and a causal eﬀect model. Let Z be the N-dimensional vector
of treatment assignment for all N participants with ith element Zi , and let Di be an indicator for whether participant
i receives the test treatment, i.e., it takes 1 if the test treatment is received and 0 otherwise. We deﬁne Yi (Z, D) to be
a random binary outcome of whether participant i develops
an event, given the treatment assignment Z and the vector
of treatment received D. The SUTVA is to assume that the
binary outcome for each participant is unrelated to the treatment status of other participants, i.e., Yi (Z, D) = Yi (Z , D )
if Zi = Z i and Di = Di , which allows us to write Yi (Z, D) as
Yi (Zi , Di ). The exclusion restriction is the assumption that
the binary outcome is not directly aﬀected by the treatment
assignment, but only by the treatment actually received, i.e.,
Yi (Z, D) = Yi (Z , D) for every Z, Z and for every D. Alternatively, for participant i in stratum k, let Yki (dki ) be the
random binary outcome and let P ki,dki = E{Y ki (dki )} be the
potential risk for the treatment actually received Dki . Note
that the potential risk, Pki ,0 , can be regarded as a baseline
risk for participant i in stratum k. For the two potential risks,
Pki ,1 and Pki ,0 , we assume an additive causal eﬀect, P ki,1 −
P ki,0 = δ 0 , or a multiplicative causal eﬀect, P ki,1 /P ki,0 = ρ0 ,
where δ 0 and ρ0 are unknown constants for all participants
(k = 1, . . . , K; i = 1, . . . , Nk ). Subsequently, we provide estimation procedures for both the additive causal eﬀect and the
multiplicative causal eﬀect. We assume a large-stratum limiting model (Hauck, 1979) in which the number of strata K
remains ﬁxed but the individual cell sizes become large.
2.1 Additive Causal Eﬀect
Provided that δ 0 is known, we could estimate the number of
events under a counterfactual situation in which all participants received the control as x∗k (δ 0 ) = xk − δ 0 nk,1 for the
test group and y ∗k (δ 0 ) = yk − δ 0 mk,1 for the control group
in stratum k. Randomization guarantees that treatment assignment is independent of baseline covariates including Pki ,0 ,
and hence, E{x∗k (δ 0 )/nk } = E{y ∗k (δ 0 )/mk } (k = 1, . . . , K).
We can then have an unbiased estimating function under
randomization,
S(δ) =

K

k=1


wk (δ)

x∗k (δ) yk∗ (δ)
−
nk
mk


,

where wk (δ) is a weight function, possibly a function of δ, for
stratum k. We assume that wk (δ 0 ) converges in probability

Treatment
actually received

No. of
participants

No. of
events

Test
Control
Test
Control

nk ,1
nk ,0
mk ,1
mk ,0

xk ,1
xk ,0
yk ,1
yk ,0

to a constant under the large-stratum limiting model (k =
1, . . . , K). A point estimate of δ 0 is the solution of the equation
S(δ) = 0. An estimator of the variance of S(δ 0 ) may be given
by
V (δ0 ) =

K



wk2 (δ0 )



x∗k (δ0 ) + yk∗ (δ0 )

nk mk Nk

k=1



Nk − x∗k (δ0 ) − yk∗ (δ0 )

.

The hypothesis δ = δ  can be tested using the test statistic
Z(δ  ) = S(δ  )/[V (δ  )]1/2 , which follows the standard normal
distribution approximately under δ  = δ 0 . Note that, for the
sharp null hypothesis of treatment eﬀect, δ = 0, this test
reduces to an ITT-stratiﬁed test.
Several speciﬁcations can be considered for the weights,
wk (δ). When comparing speciﬁcations in terms of eﬃciency,
we use an optimal criterion for unbiased estimating functions proposed by Godambe (1960). Under certain general
regularity conditions, this implies maximizing the asymptotic eﬃciency, AE = N −1 E2 [dS (δ)/dδ|δ=δ0 ]/E[S 2 (δ 0 )]. The
Appendix shows that the optimal weight for stratum k may be
given by
wkA (δ0 ) = 

rk nk mk Nk

,
x∗k (δ0 ) + yk∗ (δ0 ) Nk − x∗k (δ0 ) − yk∗ (δ0 )

(1)

where
rk =

nk,1
mk,1
−
nk
mk

reﬂects the noncompliance aspects in stratum k (k =
1, . . . , K). When all participants in stratum k are compliant,
rk = 1. The weights w A
k (δ 0 ) are unknown, since they include
the unknown constant δ 0 . Under the assumption
Nk that the averaged baseline risk in stratum k, P̄k,0 = i=1
Pki,0 /Nk , is
constant for all k, we have
wkB =

rk nk mk
Nk

for stratum k. This weight does not include the unknown constant δ 0 , hence, w Bk is known (k = 1, . . . , K). Because weights
B
wA
k (δ 0 ) and w k include rk , analyses using these weights incorporate the variability in noncompliance aspects across strata.
On the other hand, conventional weights that ignore this
variability or assume that all participants are compliant include those in the null weighted least square (WLS) estimator given by Rothman and Boice (1979) (also see Greenland
and Robins, 1985) and those in the Mantel–Haenszel (MH)

Biometrics, September 2005

818

estimator given by Greenland and Robins (1985). The weight
for stratum k in the null-WLS estimator may be given by
wkC (δ0 ) = 

nk mk Nk

,
x∗k (δ0 ) + yk∗ (δ0 ) Nk − x∗k (δ0 ) − yk∗ (δ0 )

while the weight for stratum k in the MH estimator is given
by
nk m k
.
wkD =
Nk
Note that the weight w Ck (δ 0 ) is unknown, while w D
k is known.
Under the assumption that rk is constant for all k, w A
k (δ 0 ) and
w Bk reduce to w Ck (δ 0 ) and w D
k , respectively (see Appendix). Regarding the test of the sharp null hypothesis of δ = 0, we have
an asymptotically eﬃcient test derived from the additive risk
model given by Radhakrishna (1965) when weights wCk (δ 0 ) are
used, while we have the Cochran and Mantel–Haenszel tests
(Cochran, 1954; Mantel and Haenszel, 1959) when weights w D
k
are used.
For known weights, wk (k = 1, . . . , k), the point estimator
is explicitly given by



δ̂ = 

wk dk

k

,

(2)

wk rk

k

where dk = xk /nk − yk /mk is the ITT risk diﬀerence between
treatment groups (k = 1, . . . , K). If there is no stratiﬁcation
(K = 1), δ̂ reduces to the instrumental variable estimator
(Sato, 1994; Angrist et al., 1996; Greenland, 2000). Approximate 1 − α test-based conﬁdence limits are obtained by solving Z(δ) = ±z α/2 , which yields a quadratic equation in δ with
explicit solutions,
[lower limit, upper limit]



=
where
A=



B+
2C
√
,
2
B + B − 4AC

2
2
+ zα/2

wk rk

k

B=2


k

2
− zα/2

C =


k

wk rk


k

 


k

√



B 2 − 4AC
,
2A

(3)

wk2
(nk,1 + mk,1 )2 ,
nk mk Nk



wk dk

k

wk2
(Nk − 2tk )(nk,1 + mk,1 ),
nk mk Nk

wk dk

2
2
− zα/2


k

wk2
tk (Nk − tk ).
nk mk Nk

Here, zq is the upper q point of the standard normal distribution. Sato (1994) obtained the same formula for point estimate and conﬁdence limits using the MH weights, w D
k . On the
C
other hand, when unknown weights such as w A
k (δ 0 ) or w k (δ 0 )
are used, explicit solutions may not be obtained; hence, a
numerical search procedure or the following simple iterative
procedure may be adopted. Step 1: set an initial value for δ 0 ,
for example, the solution when known weights such as w Bk or

wD
k are used; step 2: calculate the weights as if this value for
δ 0 is the true solution; and step 3: obtain a new solution for
δ 0 , assuming that the calculated weights are known, in order to update the weights. Subsequently, iterate step 2 and
step 3 until the solution converges.
The rk can take a value within [−1, 1] in principle, but
it generally takes only a positive value in most trials. As
Greenland (2000) pointed out, the participants can be classiﬁed into two types: cooperators and noncooperators. Cooperators would always comply with the assigned treatment, while
noncooperators would not. Noncooperators may be composed of
always-takers, never-takers, and deﬁers (Angrist et al., 1996).
Always-takers always take the test treatment, while nevertakers never take the test treatment and always take the control treatment. Deﬁers would always take the opposite of the
assigned treatment. In most trials, there are a few deﬁers because they may dissent from participating in the trial during
the process of the informed consent and actually may not participate in the trial; hence, we exclude deﬁers in the sequel.
This corresponds to the monotonicity assumption in Angrist
et al. (1996). Let q CO
and q AT
be the proportion of cooperak
k
tors and always-takers, respectively, in stratum k in the trial.
AT
Because randomization assures E(nk,1 /nk ) = q CO
k + q k and
AT
CO
E(mk,1 /mk ) = q k , E(rk ) = q k , where the expectation refers
to the average overall possible patterns of random assignment.
Hence, rk would take a positive value.
2.2 Multiplicative Causal Eﬀect
Results paralleling those for the additive causal eﬀect can be
obtained for the multiplicative causal eﬀect. We replace x∗k (δ),
y∗k (δ), and wk (δ) with x∗k (ρ) = xk,1 /ρ + xk,0 , y ∗k (ρ) = y k,1 /ρ +
y k,0 , and wk (ρ), respectively. The Appendix shows that the
optimal weight for stratum k, w A
k (ρ0 ), is given by (1) with
replacement of rk with sk , where sk = xk,1 /nk − y k,1 /mk . Because sk can be expressed as (nk,1 /nk )(xk,1 /nk,1 ) − (mk,1 /
mk )(y k,1 /mk,1 ), sk reﬂects the risk of the event for those who
receive the test treatment as well as the noncompliance aspects in stratum k, unlike rk for the additive causal eﬀect.
Under the assumption that the averaged baseline risk in stratum k, P̄k,0 , is constant for all k, we have w Bk = sk nk mk /Nk
for stratum k. As conventional weights, one may use a nullWLS weight, w Ck (ρ0 ) = nk mk /{Nk − x∗k (ρ0 ) − y ∗k (ρ0 )}, under
the assumption that all participants are compliant or the MH
estimator for risk ratio (Greenland and Robins, 1985), which
is given by w D
k in Section 2.1 for the additive causal eﬀect.
B
C
D
The w A
k (ρ0 ) and w k reduce to w k (ρ0 ) and w k , respectively,
under the assumption that all participants are compliant (see
Appendix). Regarding the test of the sharp null hypothesis
of ρ = 1, we have an asymptotically eﬃcient test derived
from a risk-ratio model proposed by Radhakrishna (1965)
when weights w Ck (ρ0 ) are used, while we have the Cochran and
Mantel–Haenszel tests (Cochran, 1954; Mantel and Haenszel,
1959) when weights w D
k are used.
For known weights, wk (k = 1, . . . , K), the estimator is explicitly given by



ρ̂ = 

wk sk

k

k

,
wk uk

(4)

Stratiﬁed Analysis in Randomized Trials with Noncompliance
where uk = y k,0 /mk − xk,0 /nk (k = 1, . . . , K). If there is no
stratiﬁcation (K = 1), ρ̂ reduces to the instrumental variable
estimator for relative risk (Sato, 1994; Cuzick, Edward, and
Segnan, 1997; Greenland, 2000). Approximate 1 − α testbased conﬁdence limits are given by (3), where
A=



2



B
C

k



wk2
(xk,0 + yk,0 )(Nk − xk,0 − yk,0 ),
nk mk Nk



wk sk

k
2
+ zα/2

C =

wk2
nk mk Nk

2
+ zα/2

k


k

wk2
(xk,1 + yk,1 )2 .
nk mk Nk

CO
and
Arguments that apply to rk apply to sk as well. Let P̄k,0
be the averaged baseline risk for cooperators and alwaystakers, respectively, in stratum k. Because randomization asCO
AT
sures E(xk,1 /nk ) = ρ0 (qkCO P̄0,k
+ qkAT P̄0,k
) and E(y k,1 /mk ) =
AT AT
CO CO
ρ0 qk P̄0,k , E(sk ) = ρ0 qk P̄0,k . Hence, sk would take a positive
value in most trials. Furthermore, we can have a range for
NC
E(sk ). Let P̄k,0
be the averaged baseline risk for noncooperCO
+ (1 −
ators in stratum k. From the equation P̄k,0 = qkCO P̄k,0
CO
NC
CO
qk )P̄k,0 , we have a range for P̄k,0 ,
AT
P̄k,0

max

0,

P̄k,0 − 1 − qkCO
qkCO

Additive
causal eﬀect

Multiplicative
causal eﬀect

θk ηk
4πk (1 − πk )
θk ηk
4
ηk
4πk (1 − πk )
ηk
4

ψk ηk
4πk (1 − πk )
ψk ηk
4
ηk
4(1 − πk )
ηk
4

wk uk

(xk,1 + yk,1 ){Nk − 2(xk,0 + yk,0 )},

2

wk sk

D

k


k



Weight
A

2
−zα/2

B = −2

Table 2
The form of w̃k for each of the four weights for the additive
or multiplicative causal eﬀect

wk uk

k

819


, min

P̄k,0
1, CO
qk

.

(5)

We then have a range for E(sk ). Note that q CO
can be estik
mated by rk (see Section 2.1).
3. Eﬃciency Comparison
We assess how eﬃciency is enhanced by using the optimal
weights that incorporate variability in noncompliance aspects across strata instead of using the conventional weights.
We supposed randomized trials with three strata (K = 3).
The participants were assigned to the test treatment or its
control with equal probability. We assumed a large-stratum
p
p
limiting model in which N −1 Nk → ηk (>0), P̄k,0 → πk (>0),
p
p
rk → θk (>0), and sk → ψk (>0) (k = 1, . . . , K). Under random assignment of two treatments with equal probability, g, N−1 w, and N Σ in the Appendix would converge in
probability to g̃ = (g̃1 , . . . , g̃K ) , w̃ = (w̃1 , . . . , w̃K ) , and Σ̃ =
− πK )
diag( 4π1 (1η1− π1 ) , . . . , 4πK (1
), respectively. Here, g̃k is θk for
ηK
the additive causal eﬀect and g̃k is ψ k for the multiplicative
causal eﬀect. Table 2 summarizes the form of w̃k for each
of the four types of weights for the additive or multiplicative causal eﬀects. Then, AE would converge in probabil = (w̃ g̃)2 /w̃ Σ̃w̃. The asymptotic relative eﬃciency
ity to AE
(ARE) of weight A with respect to weight B is deﬁned as
 w̃=w̃A /AE
 w̃=w̃B , and the ARE of weight A with respect to
AE
the other weights can be similarly deﬁned.

With respect to θk , we set 1.0, 0.7, 0.4, or 0.1; hence, we
had 64 (=43 ) patterns for Θ = (θ1 , θ2 , θ3 ), where the value
1.0 for θk indicates that all participants in stratum k are compliant. We set π k to be 0.1 or 0.3; hence, we had 8 (=23 )
patterns for Π = (π 1 , π 2 , π 3 ) for each Θ. We set η 1 = η 2 =
η 3 (=1/3), for which the estimator using the MH weights, w D
k,
coincides with an unweighted estimator. For each conﬁguration, we calculated the ARE of weight A with respect to the
other weights and performed 1000 simulations to obtain the
empirical variance of the estimate. In the simulations, we assumed 200 participants in each stratum with noncompliance
occurring only in the test group and noncompliers receiving
the control treatment.
3.1 Additive Causal Eﬀect
Table 3 summarizes the ARE of weights, w A
k (δ), with respect
to the other weights, w Bk , w Ck (δ), and w D
k and the ratio of the
variance of the simulated estimate using weights, w Bk , w Ck (δ),
A
and w D
k divided by that using weights, w k (δ), for 10 selected
conﬁgurations. The results of the variance of simulated estimate paralleled those of the ARE. For fully compliant scenarios (conf. 1, 2), as one would expect, the eﬃciency for all
weights under constant π k across strata was the same (conf.
1), but there is some eﬃciency loss for the ﬁxed weights, i.e.,
weights B and D, under nonconstant π k (conf. 2). The same
results were obtained for noncompliant scenarios (θk < 1.0
for some k) with constant θk across strata (conf. 3, 4). The
greater the variability in θk across strata, the greater the enhancement in eﬃciency by using optimal weight A, instead of
conventional weights C or D (compare conf. 5, 6 and conf. 7,
8). For a given variability in θk , there is greater enhancement
for smaller θk (compare conf. 5, 6 and conf. 9, 10). The ARE
with respect to weights C and D can reach 2.76 and 3.97, respectively. For conﬁgurations with low noncompliance rates,
such as θk ≥ 0.7 for all k, as seen in many trials including
those for new drug applications, the eﬃciency when weight A
was used was comparable with those when weight C was used
(the maximum being 1.03 in the ARE). Meanwhile, the eﬃciency could be substantially greater than that when weight
D was used (the maximum being 1.40 in the ARE).
3.2 Multiplicative Causal Eﬀect
As a reminder, the optimal weight w A
k (ρ0 ) includes sk that
reﬂects the baseline risk of the event as well as the noncompliance aspects in stratum k, unlike rk for the additive
causal eﬀect. We ﬁrst suppose a random noncompliance scenario in which the noncompliance behavior of a participant

Biometrics, September 2005

820

Table 3
The ARE of weight A with respect to the other weights (left) and the ratio of the variance of the simulated estimate using weight
B, C, or D divided by that using weight A (right) for each conﬁguration of Θ and Π for the additive causal eﬀect model. The
empirical variance was obtained from 1000 simulations under δ = 0.1.
Conf.
1
2
3
4
5
6
7
8
9
10
a FS:

(θ1 , θ2 , θ3 )
(1.0,
(1.0,
(0.7,
(0.7,
(1.0,
(1.0,
(1.0,
(1.0,
(0.4,
(0.4,

1.0,
1.0,
0.7,
0.7,
0.7,
0.7,
0.1,
0.1,
0.1,
0.1,

1.0)
1.0)
0.7)
0.7)
0.7)
0.7)
0.1)
0.1)
0.1)
0.1)

(π 1 , π 2 , π 3 )
(0.1,
(0.1,
(0.1,
(0.1,
(0.1,
(0.3,
(0.1,
(0.3,
(0.1,
(0.3,

0.1,
0.1,
0.1,
0.1,
0.3,
0.1,
0.3,
0.1,
0.3,
0.1,

0.1)
0.3)
0.1)
0.3)
0.3)
0.1)
0.3)
0.1)
0.3)
0.1)

Weight B ARE FSa
1.00,
1.16,
1.00,
1.16,
1.19,
1.19,
1.01,
1.01,
1.07,
1.07,

1.04
1.07
1.02
1.13
1.10
1.13
1.01
1.01
1.06
1.07

Weight C ARE FS
1.00,
1.00,
1.00,
1.00,
1.03,
1.02,
1.59,
2.76,
1.33,
1.56,

1.00
1.00
1.00
1.00
0.99
1.05
1.50
2.83
1.30
1.50

Weight D ARE FS
1.00,
1.16,
1.00,
1.16,
1.40,
1.06,
3.97,
1.35,
2.65,
1.07,

1.04
1.07
1.01
1.13
1.25
1.05
3.33
1.41
2.33
1.06

ﬁnite sample, 200 participants in each stratum. Standard errors of entries are approximately 6% of entries.

is not aﬀected by the baseline risk of that participant, but
is directly aﬀected by stratiﬁed factors. Under this scenario,
E(sk ) may reduce to ρ0 qkCO P̄k,0 , which converges in probability to ρ0 θk π k . For the same selected conﬁgurations as those
in Table 3 for the additive causal eﬀect, Table 4 summarizes
the ARE of weights, w A
k (ρ), with respect to the other weights,
w Bk , w Ck (ρ), and w D
k and the ratio of the variance of the logtransformed simulated estimate using weights, w Bk , w Ck (ρ), and
A
wD
k divided by that using w k (ρ), which approximates to the
variance ratio under a large sample size. For conﬁgurations
with small θk (conf. 7, 9, 10), some simulated estimates were
negative due to a negative value of uk or were not obtained
due to division by zero in (4), for which the estimate was set
to be a missing value. The number of missing cases decreased
as the sample size increased, e.g., missing cases did not appear when the number of participants in each stratum was
2000, but the results were similar. Overall, under the random
noncompliance scenario, we had similar results as those for
the additive causal eﬀect model.
A substantial enhancement in eﬃciency by using optimal
weight A instead of conventional weights C or D may, however,

be obtained under nonrandom noncompliance scenarios even
when the noncompliance rates are low such as θk ≥ 0.7 for all
k. From range (5) for the averaged baseline risk for cooperators,
CO
, we have a possible conﬁguration Θ = (1.0, 0.7, 0.7), Π
P̄k,0
CO
CO
= (0.5, 0.3, 0.3), and (π CO
1 , π 2 , π 3 ) = (0.50, 0.40, 0.05), for
which the ARE of weight A with respect to weights C and D
were 1.22 and 1.39, respectively.
4. Example
We illustrate the developed methods using the data from the
multiple risk factors intervention trial (MRFIT; MRFIT Research Group, 1982). The MRFIT was a large ﬁeld trial to
test the eﬀect of a multifactor intervention program on mortality from coronary heart disease (CHD) in middle-aged men.
The intervention consisted of dietary advice to reduce blood
cholesterol, smoking cessation counseling, and hypertension
medication. The participants were randomly assigned to the
intervention program or its control, where the members of the
control group were referred to their usual physicians for treatment. With respect to the intervention eﬀects on the reduction of the three risk factors, only the treatment for cigarette

Table 4
The ARE of weight A with respect to the other weights (left) and the ratio of the variance of the log-transformed simulated
estimate using weight B, C, or D divided by that using weight A (right) for each conﬁguration of Θ and Π for the multiplicative
causal eﬀect model. The empirical variance was obtained from 1000 simulations under ρ = 1.5.
Conf.
1
2
3
4
5
6
7b
8
9b
10b
a FS:

(θ1 , θ2 , θ3 )
(1.0,
(1.0,
(0.7,
(0.7,
(1.0,
(1.0,
(1.0,
(1.0,
(0.4,
(0.4,

1.0,
1.0,
0.7,
0.7,
0.7,
0.7,
0.1,
0.1,
0.1,
0.1,

1.0)
1.0)
0.7)
0.7)
0.7)
0.7)
0.1)
0.1)
0.1)
0.1)

(π 1 , π 2 , π 3 )
(0.1,
(0.1,
(0.1,
(0.1,
(0.1,
(0.3,
(0.1,
(0.3,
(0.1,
(0.3,

0.1,
0.1,
0.1,
0.1,
0.3,
0.1,
0.3,
0.1,
0.3,
0.1,

0.1)
0.3)
0.1)
0.3)
0.3)
0.1)
0.3)
0.1)
0.3)
0.1)

Weight B ARE FSa
1.00,
1.11,
1.00,
1.11,
1.06,
1.07,
1.10,
1.00,
1.19,
1.01,

0.98
1.07
0.98
1.07
1.08
1.00
1.17
1.00
1.10
1.03

Weight C ARE FS
1.00,
1.00,
1.00,
1.00,
1.02,
1.03,
2.99,
1.38,
1.51,
1.23,

0.97
0.99
0.95
0.98
1.01
1.05
5.02
1.63
1.75
1.48

Weight D ARE FS
1.00,
1.01,
1.00,
1.01,
1.00,
1.08,
2.38,
1.64,
1.34,
1.41,

0.97
1.01
0.96
1.00
0.99
1.15
4.01
2.01
1.32
1.99

ﬁnite sample, 200 participants in each stratum. Standard errors of entries are approximately 6% of entries.
of 1000 simulations, 11 missing cases for weights A, B, and D, and 19 missing cases were missing for weight C for conf. 7. For weights A,
B, C, and D, 94, 89, 87, and 84 missing cases, respectively, for conf. 9. Eight missing cases for all weights for conf. 10.
b Out

Stratiﬁed Analysis in Randomized Trials with Noncompliance

821

Table 5
The status of cigarette smoking and the incidence of CHD deaths during period of follow-up of 7 years in MRFIT
Stratum
no. of cigarettes
at baseline
<30

≥30

a Proportion

No. of
participants

CHD
death

Test

1260

25

Control

1180

26

Total

2440

51

Test

2573

44

Control

2650

48

Total

5223

92

Group

Smoking status
at 1 year

No. of
participants

CHD
death

Quit
Not quit
Quit
Not quit

454 (36%)a
806
159 (13%)
1021

6
19
3
23

Quit
Not quit
Quit
Not quit

537 (21%)
2036
215 (8%)
2435

5
39
1
47

that quit smoking 1 year after entry in each group.

smoking was eﬀective, compared with those for modifying
blood cholesterol and hypertension; the group diﬀerence in
number of smokers at 12 months was 15.4%, and the diﬀerence in terms of a mean change in the number of cigarettes
smoked per day exceeded the design goal by 45%. In contrast,
the group diﬀerence in diastolic blood pressure averaged over
annual visits was only 4% (75% of the design goal), and the
average diﬀerence in serum cholesterol was only 2% (50% of
the design goal) (MRFIT Research Group, 1982). Here we restrict our attention to the eﬀects of quitting cigarette smoking as in Mark and Robins (1993) and Sato (2000) because
of the paucity of achieved diﬀerences on the other risk factors, although the trial actually investigated the eﬀects of a
mixture of medication and education for heart disease, and
hence, the states of classroom attendance should also be incorporated when deﬁning treatment compliance. We regard
the number of cigarettes per day at baseline (<30 or ≥30 per
day) as a stratiﬁed factor. Table 5 summarizes the incidence
of CHD deaths during the follow-up period of 7 years based
on the treatment assigned and the actual smoking status 1
year after entry for each stratum. The proportions of participants who did not quit smoking in the test group were
extraordinarily high, despite exceeding design expectations.
As expected, the proportions of participants quitting smoking varied over two strata; the proportions in the stratum of
the number of cigarettes ≥30 per day were less than those in
the stratum of the number of cigarettes <30 per day for each
group.
Tables 6 and 7 show a full result of the analysis of MRFIT
for the additive and multiplicative causal eﬀect, respectively,
where the instrumental variable (IV) estimator for stratum k
is given by dk /rk for the additive causal eﬀect and sk /uk for the
multiplicative causal eﬀect (k = 1, . . . , K). The upper limit
was not obtained for the multiplicative causal eﬀect. It was
indicated that quitting smoking had eﬀects that reduced the
risk of CHD death for all strata. Due to high noncompliance
rates across strata, the IV estimates indicated a much greater
eﬀect of quitting smoking than the ITT estimates. The results
of stratiﬁed analysis using four weights, weights A, B, C, and
D, were comparable.

We also calculated the approximate ARE of weight A with
respect to the other weights under the additive causal eﬀect
model. From Table 5, we set (η 1 , η 2 ) = (0.32, 0.68), (θ1 , θ2 ) =
(0.23, 0.13). Based on the stratiﬁed adjusted estimates for
causal parameters when weight A is used in Table 6, we could
estimate (π 1 , π 2 ) as (0.023, 0.019). For this conﬁguration, the
ARE of weight A with respect to weights B, C, and D were
1.01, 1.08, and 1.04, respectively, which indicated a small enhancement in eﬃciency by using weight A instead of the other
weights. However, there would be a possibility of substantial
enhancement in eﬃciency when the stratum with the number
of cigarettes per day at baseline <30 is divided into two strata
as is seen in medical or epidemiological literature. Stratum 1
with the number of cigarettes per day <10 was designated as
light smokers, and stratum 2 with the number of cigarettes
per day ≥10, but <30 was designated as moderate smokers.
Stratum 3 was the stratum with the number of cigarettes
per day at baseline ≥30 and was designated as heavy smokers. The r1 for light smokers is expected to be higher than the
others. Regarding the averaged baseline risk, we assumed that
(π 1 , π 2 , π 3 ) = (0.023, 0.023, 0.019). Conﬁgurations satisfying
η 1 + η 2 = 0.32, η 3 = 0.68, (η 1 θ1 + η 2 θ2 )/(η 1 + η 2 ) = 0.23, and
Table 6
Estimation results for the additive causal eﬀect in MRFIT
Analysis by stratum
No. of cigarettes
per day at baseline

ITT risk
diﬀerence
dk (%)

IV estimate
dk /rk (%)

<30
≥30

−0.22
−0.10

−0.97
−0.79

Stratum-adjusted analysis
Weight
A
B
C
D

Point estimate (%)
−0.89
−0.90
−0.87
−0.87

95% CI (%)
[−5.54,
[−5.61,
[−5.72,
[−5.57,

2.36]
2.36]
2.49]
2.47]

P-value
0.640
0.640
0.662
0.654

Biometrics, September 2005

822

Table 7
Estimation results for the multiplicative causal eﬀect
in MRFIT
Analysis by stratum
No. of cigarettes
per day at baseline

ITT risk ratio
(xk /nk )/(yk /mk )

IV estimate
sk /uk

0.90
0.94

0.50
0.61

<30
≥30
Stratum-adjusted analysis
Weight
A
B
C
D
a The

Point estimate
0.55
0.55
0.54
0.56

95% CI
[0.16,
[0.16,
[0.16,
[0.17,

–a ]
–]
–]
–]

P-value
0.646
0.641
0.639
0.654

upper limit was not obtained.

θ3 = 0.13 may include (i) (η 1 , η 2 , η 3 ) = (0.10, 0.22, 0.68) and
(θ1 , θ2 , θ3 ) = (0.40, 0.15, 0.13) and (ii) (η 1 , η 2 , η 3 ) = (0.05,
0.27, 0.68) and (θ1 , θ2 , θ3 ) = (0.66, 0.15, 0.13). The ARE of
weight A with respect to weights B, C, and D were 1.01, 1.23,
and 1.18, respectively, for the ﬁrst conﬁguration, while 1.01,
1.47, and 1.41, respectively, for the second conﬁguration.

5. Discussion
In this article, we have developed methods of stratiﬁed analyses for the additive or multiplicative causal eﬀect on binary outcomes in randomized trials with noncompliance. The
methods are an extension of the instrumental variable method
proposed by Sato (1994) developed by incorporating optimal weights that reﬂect the variability in noncompliance
aspects across strata. An assessment based on asymptotic relative eﬃciency shows that a substantial enhancement in eﬃciency can be gained by using the optimal weights instead of
the conventional weights, such as those in the weighted least
square or Mantel–Haenszel methods. The results suggest that
the optimal weights rather than the conventional weights be
used, both in estimating the causal eﬀect and in testing the
sharp causal null hypothesis of treatment eﬀect. Particularly,
a stratiﬁed null test with the optimal weights should be distinguished from conventional ITT-stratiﬁed null tests, which
are commonly used for testing the sharp causal null hypothesis of treatment eﬀect. The optimal weights can also improve
sample size and power calculations proposed by Sato (2000).
In our randomization-based methods, rk and sk reﬂect the
noncompliance aspects in stratum k for the additive and multiplicative causal eﬀect model, respectively. As noted previously, they represent quantities concerning cooperators in
stratum k. In the extreme situation where rk = 0, there are
no cooperators in stratum k, and the random assignment no
longer aﬀects intervention for all participants in this stratum.
Therefore, we could not obtain any information regarding the
causal eﬀect from this stratum. In this situation, the optimal weight for this stratum is zero, discarding any information from this stratum, while the conventional weights for this
stratum may not be zero as it collects noise in outcomes from
this stratum. Thus, rk relates to the amount of information
regarding the causal eﬀect gained from stratum k, and it is

rational to take into account the magnitude of rk in stratiﬁed
analyses, which is carried out using the optimal weight.
Although a constant treatment eﬀect over all participants
is assumed in the causal model, the point estimator in (2) or
(4) can be interpreted as the treatment eﬀect on the averaged
risk for cooperators (also see Angrist et al., 1996 for the addiCO
AT
tive causal eﬀect under no stratiﬁcation). Let P̄k,1
, P̄k,1
, and
NT
be the averaged risk for cooperators, always-takers, and
P̄k,1
never-takers, respectively, had all participants in stratum k received the test treatment. For the additive causal eﬀect, since
CO
AT
NT
E(xk /nk ) = qkCO P̄k,1
+ qkAT P̄k,1
+ qkNT P̄k,0
and E(yk /mk ) =
CO CO
AT AT
NT NT
qk P̄k,0 + qk P̄k,1 + qk P̄k,0 , we have the expected value of
CO
CO
− P̄k,0
). Meanthe ITT risk diﬀerence, E(dk ) = qkCO (P̄k,1
CO
while, as indicated in Section 2.1, E(rk ) = q k . Hence, the
point estimator (2) for the constant causal eﬀect δ 0 represents a stratum-adjusted diﬀerence of the averaged risk for
cooperators. With respect to the multiplicative causal eﬀect,
CO
AT
AT
CO
E(sk ) = qkCO P̄k,1
+ qkAT P̄k,1
− qkAT P̄k,1
= qkCO P̄k,1
and E(uk ) =
CO CO
NT NT
NT NT
CO CO
qk P̄k,0 + qk P̄k,0 − qk P̄k,0 = qk P̄k,0 . Hence, the point estimator (4) for the constant causal eﬀect ρ0 represents a
stratum-adjusted ratio of the averaged risk for cooperators.

References
Angrist, J. D., Imbens, G. W., and Rubin, D. B. (1996). Identiﬁcation of causal eﬀects using instrumental variables.
Journal of the American Statistical Association 91, 444–
455.
Cochran, W. G. (1954). Some methods for strengthening the
χ2 test. Biometrics 10, 417–451.
Cuzick, J., Edward, R., and Segnan, N. (1997). Adjusting for
non-compliance and contamination in randomized clinical trials. Statistics in Medicine 16, 1017–1029.
Fisher, L. D., Dixon, D. O., Herson, J., Frankowski, R.,
Hearron, M., and Peace, K. E. (1990). Intention to treat
in clinical trials. In Statistical Issues in Drug Research
and Development, K. E. Peace (ed), 331–350. New York:
Marcel Dekker.
Fisher, R. A. (1935). The Design of Experiments. London:
Oliver and Boyd.
Godambe, V. P. (1960). An optimum property of regular
maximum likelihood estimation. Annals of Mathematical
Statistics 31, 1208–1211.
Greenland, S. (2000). An introduction to instrumental variables for epidemiologists. International Journal of Epidemiology 29, 722–729.
Greenland, S. and Robins, J. M. (1985). Estimation of a common eﬀect parameter from sparse follow-up data. Biometrics 41, 55–68.
Hauck, W. W. (1979). The large-sample variance of the
Mantel-Haenszel estimator of a common odds ratio. Biometrics 35, 817–819.
Lee, Y., Ellenberg, J., Hirtz, D., and Nelson, K. (1991). Analysis of clinical trials by treatment actually received: Is it
really an option? Statistics in Medicine 10, 1595–1605.
Mantel, N. and Haenszel, W. (1959). Statistical aspects of
the analysis of data from retrospective studies of disease.
Journal of the National Cancer Institute 22, 719–748.
Mark, S. D. and Robins, J. M. (1993). A method for the analysis of randomized trials with compliance information:

Stratiﬁed Analysis in Randomized Trials with Noncompliance
An application to the multiple risk factor intervention
trial. Controlled Clinical Trials 14, 79–97.
Multiple Risk Factor Intervention Trial Research Group.
(1982). Multiple risk factor intervention trial: Risk factor
changes and mortality results. Journal of the American
Medical Association 248, 1465–1477.
Piantadosi, S. (1997). Clinical Trials: A Methodologic Perspective. New York: Wiley.
Radhakrishna, S. (1965). Combination of results from several
2 × 2 contingency tables. Biometrics 21, 86–98.
Rao, C. R. (1973). Linear Statistical Inference and Its Application, 2nd edition. New York: Wiley.
Robins, J. M. and Greenland, S. (1994). Adjusting for diﬀerential rates of PCP prophylaxis in high- versus low-dose
AZT treatment arms in an AIDS randomized trial. Journal of the American Statistical Association 89, 737–749.
Robins, J. M. and Tsiatis, A. A. (1991). Correcting for
non-compliance in randomized trials using rank preserving structural failure time models. Communications in
Statistics—Theory and Methods 20, 2609–2631.
Rothman, K. J. and Boice, J. D. (1979). Epidemiologic Analysis with a Programmable Calculator. NIH Publication.
79-1649. Washington, DC: U.S. Government Printing
Oﬃce.
Sato, T. (1994). Randomized intent-to-analyses. Japanese
Journal of Applied Statistics 23, 21–34 (in Japanese).
Sato, T. (2000). Sample size calculations with compliance information. Statistics in Medicine 19, 2689–2697.
Schwartz, D. and Lellouch, J. (1967). Explanatory and pragmatic attitudes in therapeutic trials. Journal of Chronic
Diseases 20, 637–648.
Sheiner, L. and Rubin, D. B. (1995). Intention-to-treat analysis and the goals of clinical trials. Clinical Pharmacology
and Therapeutics 87, 6–15.
Received July 2003. Revised November 2004.
Accepted November 2004.

Appendix
The Optimal Weights
The asymptotic eﬃciency is given by AE = N −1 E2 [dS (φ)/
d φ|φ=φ0 ]/E[S 2 (φ0 )], where φ is a causal parameter with the

823

true value of φ0 (φ is δ for the additive causal eﬀect model,
and φ is ρ for the multiplicative causal eﬀect model). We
use a ﬁxed weight wk for stratum k (k = 1, . . . , K). Under
the assumption that the incidence of an event on a participant does not aﬀect that on the other participants, we
have
E[S 2 (φ0 )] =





wk2 E

k

=


k

x∗k (φ0 ) yk∗ (φ0 )
−
nk
mk


wk2 var

2



x∗k (φ0 ) yk∗ (φ0 )
−
.
nk
mk

The latter expression is derived since E [x∗k (φ0 )/nk − y∗k (φ0 )/
mk ] equals zero. In matrix terms, we have E[S 2 (φ0 )] =
1
K
w Σw, where Σ = diag( nN
P̄0,1 (1 − P̄0,1 ), . . . , nKNm
P̄0,K ×
1 m1
K

(1 − P̄0,K )) and w = (w1 , . . . , wK ) . Furthermore, E2 [dS (φ)/
d φφ=φ0 ] in the numerator of AE is expressed as c (w g)2 ,
where g = (r1 , . . . , rk ) and c = 1 for the additive causal effect model and g = (s1 , . . . , sk ) and c = ρ−4
for the mul0
tiplicative causal eﬀect model. By applying the Cauchy–
Schwartz inequality (e.g., Rao, 1973), the minimum of AE
is given by N−1 c(GΣ−1 G)−1 . The minimum is obtained using
a vector of weights w ∝ Σ−1 G. Therefore, we have optimal
weights, wkopt = rk nk mk /(Nk P̄k,0 (1 − P̄k,0 )), for the additive
causal eﬀect model and wkopt = sk nk mk /(Nk P̄k,0 (1 − P̄k,0 )) for
the multiplicative causal eﬀect model (k = 1, . . . , K). Because
the averaged baseline risk in stratum k, P̄k,0 , can be estimated
by {x∗k (φ0 ) + y∗k (φ0 )}/Nk , we have estimated weights w A
k (δ 0 )
or w A
k (ρ0 ).
For the additive causal eﬀect model, the optimal weight w opt
k
would reduce to rk nk mk /Nk , that is, w Bk , under the assumption
that P̄k,0 is constant for all k. Weight w opt
would reduce to
k
nk mk /(Nk P̄k,0 (1 − P̄k,0 )), which can be estimated as w Ck (δ 0 ),
and weight w Bk would reduce to nk mk /Nk , that is, w D
k , under
the assumption that rk is constant for all k.
For the multiplicative causal eﬀect model, the optimal
weight w opt
reduces to sk nk mk /Nk , that is, w Bk , under the ask
sumption that P̄k,0 is constant for all k. Under the assumption
that all participants are compliant and assignment is random,
sk would converge in probability to ρ0 P̄k,0 , so that the weight
w opt
k would reduce to nk mk /(Nk (1 − P̄k,0 )), which can be estimated as w Ck (ρ0 ), and the weight w Bk would reduce to nk mk /Nk ,
that is, w D
k.

