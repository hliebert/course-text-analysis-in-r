Econometrica, Vol. 76, No. 5 (September, 2008), 1191–1206

IDENTIFICATION OF TREATMENT EFFECTS USING CONTROL
FUNCTIONS IN MODELS WITH CONTINUOUS, ENDOGENOUS
TREATMENT AND HETEROGENEOUS EFFECTS
BY J. P. FLORENS, J. J. HECKMAN, C. MEGHIR, AND E. VYTLACIL1
We use the control function approach to identify the average treatment effect and
the effect of treatment on the treated in models with a continuous endogenous regressor whose impact is heterogeneous. We assume a stochastic polynomial restriction on
the form of the heterogeneity, but unlike alternative nonparametric control function
approaches, our approach does not require large support assumptions.
KEYWORDS: Continuous treatments, endogenous treatments, heterogeneous treatment effects, identification, nonseparable models, control function.

1. INTRODUCTION
THERE IS A LARGE AND GROWING theoretical and empirical literature on models where the impacts of discrete (usually binary) treatments are heterogeneous in the population.2 The objective of this paper is to analyze nonparametric identification of treatment effect models with continuous treatments when
the treatment intensity is not randomly assigned. This generally leads to models that are nonseparable in the unobservables and produces heterogeneous
treatment intensity effects. Imposing a stochastic polynomial assumption on
the heterogeneous effects, we use a control function approach to obtain identification without large support assumptions. Our approach has applications in
a wide variety of problems, including demand analysis, where price elasticities
may differ across individuals; labor supply, where wage effects may be heterogeneous; or production functions, where the technology may vary across firms.
Other recent papers on semiparametric and nonparametric models with
nonseparable error terms and an endogenous, possibly continuous, covariate include papers using quantile instrumental variable methods such as
Chernozhukov and Hansen (2005) and Chernozhukov, Imbens, and Newey
1
We thank two anonymous referees and Whitney Newey for their comments. We also thank
participants at the Berkeley–Stanford (March 2001) workshop on nonparametric models with
endogenous regressors as well as participants at the University College London empirical microeconomics workshop for useful comments. J. Heckman would like to thank the NIH (Grant
R01-HD043411) and the NSF (Grant SES-024158) for research support. C. Meghir would like to
thank the Centre for Economics of Education and the ESRC for funding through the Centre for
Fiscal policy at the IFS and his ESRC Professorial Fellowship. E. Vytlacil would like to thank the
NSF for financial support (Grant SES-05-51089). The views expressed in this paper are those of
the authors and not necessarily those of the funders listed here. All errors are our own.
2
See, for example, Roy (1951), Heckman and Robb (1985, 1986), Björklund and Moffitt (1987),
Imbens and Angrist (1994), Heckman (1997), Heckman, Smith, and Clements (1997), Heckman
and Honoré (1990), Card (1999, 2001), and Heckman and Vytlacil (2001, 2005, 2007a, 2007b),
who discussed heterogeneous response models.

© 2008 The Econometric Society

DOI: 10.3982/ECTA5317

1192

FLORENS, HECKMAN, MEGHIR, AND VYTLACIL

(2007), and papers using a control variate technique such as Altonji and
Matzkin (2005), Blundell and Powell (2004), Chesher (2003), and Imbens and
Newey (2002, 2007). Chesher (2007) surveyed this literature. The analysis of
Imbens and Newey (2002, 2007) is perhaps the most relevant to our analysis, with the key distinction between our approach and their approach being a
trade-off between making a stochastic polynomial assumption on the outcome
equation versus assuming large support. We discuss the differences between
our approach and their approach further in Section 3.2.
2. THE MODEL, PARAMETERS OF INTEREST, AND THE OBSERVABLES
Let Yd denote the potential outcome corresponding to level of treatment intensity d. When the treatments are discrete, this notation represents the two
possible outcomes for a particular individual in the treated and nontreated
state. In this paper, there is a continuum of alternatives as the treatment intensity varies. Define ϕ(d) = E(Yd ) and Ud = Yd − ϕ(d), so that, by construction,
(1)

Yd = ϕ(d) + Ud 

We restrict attention to the case where the stochastic process Ud takes the
polynomial form
(2)

Ud =

K


d j εj 

with

E(εj ) = 0

j = 0     K

j=0

where K < ∞ is known.3
Let D denote the realized treatment, so that the realized outcome Y is given
by Y = YD . We do not explicitly denote observable regressors that directly affect Yd . All of our analysis implicitly conditions on such regressors. We make
the following assumption.
A-1: ϕ(D) is K times differentiable in D (almost surely (a.s.)) and the support
of D does not contain any isolated points (a.s.).
This allows for heterogeneity of a finite set of derivatives of Yd . This specification can be seen as a nonparametric, higher order generalization of the
random coefficient model analyzed by Heckman and Vytlacil (1998) and
Wooldridge (1997, 2003, 2007). The normalization E(εj ) = 0 j = 0     K,
implies that (∂j /∂d j )E(Yj ) = (∂j /∂d j )ϕ(d).4
3
As discussed later, we can test for the order of the polynomial as long as a finite upper bound
on K is known. The question of identification with K infinite is left for future work.
K
4
To see that E(εj ) = 0 j = 0     K, is only a normalization, note that ϕ(d) + j=0 d j εj =

K j

j
j
[ϕ(d) + K
(d) + K
j .
j=0 d E(εj )] +
j=0 d (εj − E(εj )) = ϕ
j=0 d ε

IDENTIFICATION OF TREATMENT EFFECTS

1193

Equations (1) and (2) can be restated as follows to emphasize that we analyze a nonseparable model:
(3)

Y = h(D ) = ϕ(D) +

K


Dj hj ()

j=0

where  need not be a scalar random variable. The notation of equation (3)
can be mapped into the notation of equations (1) and (2) by setting εj = hj ().
Notice that we do not assume that  is a scalar random variable, and h need
not be monotonic in .
One parameter of interest in this paper is the average treatment effect
(ATE),
(4)

ATE (d) = lim

d→0

∂
E(Yd+d − Yd )
∂
≡
E(Yd ) =
ϕ(d)
d
∂d
∂d

which is the average effect of a marginal increase in treatment if individuals
were randomly assigned to base treatment level d. Note that the average treatment effect depends on the base treatment level, and for any of the continuum
of possible base treatment levels we have a different average treatment effect.
The average treatment effect is the derivative of the average structural function of Blundell and Powell (2004).
We also consider the effect of treatment on the treated (TT), given by
E(Yd+d − Yd |D = d)
TT (d) = lim
d→0
d




∂

Yd1 D = d2 
≡E
∂d1
d=d1 =d2

∂
ϕ(d) +
=
jd j−1 E(εj |D = d)
∂d
j=1
K

which is the average effect of treatment for those currently choosing treatment
level d of an incremental increase in the treatment holding their unobservables fixed at baseline values. This parameter corresponds to the local average
response parameter considered by Altonji and Matzkin (2001, 2005).
We denote the choice equation (the assignment mechanism to treatment
intensity) as
(5)

D = g(Z V )

where Z are observed covariates that enter the treatment choice equation but
are excluded from the equation for Yd and V is a scalar unobservable. We make
the following assumption:

1194

FLORENS, HECKMAN, MEGHIR, AND VYTLACIL

A-2: V is absolutely continuous with respect to Lebesgue measure; g is strictly
monotonically increasing in V ; and Z ⊥⊥ (V  ε0      εK ).
As long as D is a continuous random variable (conditional on Z), we can
always represent D as a function of Z and a continuous scalar error term, with
the function increasing in the error term and the error term independent of Z.
−1
(V |Z). Thus, D = g(Z V ),
To see this, set V = FD|Z (D|Z) and g(Z V ) = FD|Z
where g is strictly increasing in the scalar V which is distributed unit uniform
and independent of Z. However, the assumption that g(Z V ) is monotonic in
a scalar unobservable V with Z ⊥⊥ (V  ε0      εK ) is restrictive. The construc−1
(V |Z) = g(Z V ) do not guarantee Z ⊥⊥
tions V = FD|Z (D|Z) and D = FD|Z
(V  ε0      εK ).
Given assignment mechanism (5) and assumption A-2, without loss of generality we can impose the normalization that V is distributed unit uniform.
Given these assumptions and the normalization of V , we can follow Imbens
and Newey (2002, 2007) and recover V from V = FD|Z (D|Z) and the func−1
(V |Z). Assignment mechanism (5) and assumption g from g(Z V ) = FD|Z
tion A-2 will not be directly used to prove identification. However, we use them
to clarify the primitives underlying our identification assumptions.
2.1. Education and Wages: A Simple Illustration
To illustrate the type of problem we analyze in this paper, consider a simple
model of educational choice. Suppose that the agent receives wages Yd at direct cost Cd if schooling choice d is made. We work with discounted annualized
earnings flows. We write wages for schooling level d, Yd , as
Yd = ϕ0 + (ϕ1 + ε1 )d + 12 ϕ2 d 2 + ε0
and the cost function for schooling as
(6)

Cd = C0 (Z) + (C1 (Z) + v1 )d + 12 C2 (Z)d 2 + v0 

where εs and vs (s = 0 1) are, respectively, unobserved heterogeneity in the
wage level and in the cost of schooling. These unobserved heterogeneity terms
are the source of the identification problem considered in this paper. We impose the normalizations that E(εs ) = 0 and E(vs ) = 0 for s = 0 1. We implicitly
condition on variables such as human capital characteristics that affect both
wages and the costs of schooling. The Z are factors that only affect the cost of
schooling, such as the price of education.
Assume that agents choose their level of education to maximize wages minus
costs. Let D denote the resulting optimal choice of education. D solves the first
order condition
(ϕ1 − C1 (Z)) + (ϕ2 − C2 (Z))D + ε1 − v1 = 0

IDENTIFICATION OF TREATMENT EFFECTS

1195

Assuming that ϕ2 − C2 (Z) < 0 for all Z, the second order condition for a maximum will be satisfied. This leads to an education choice equation (assignment
to treatment intensity rule)
D=

ϕ1 − C1 (Z) + ε1 − v1

C2 (Z) − ϕ2

This choice equation is produced as a special case of the model given by equations (1), (2), and (5) with
1
ϕ(d) = ϕ0 + ϕ1 d + ϕ2 d 2 
2
Ud = ε0 + ε1 d
g(z v) =

ϕ1 − C1 (z) + Fε−1
(v)
1 −v1
C2 (z) − ϕ2



where V = Fε1 −v1 (ε1 − v1 ) with Fε1 −v1 the cumulative distribution function of ε1 − v1 . The goal is to identify the average return to education
ATE (d) = ϕ1 + ϕ2 d or TT, which is TT (d) = (ϕ1 + E(ε1 |D = d)) + ϕ2 d.
In this example, the treatment intensity is given by equation (5) with g strictly
increasing in a scalar error term V = Fε1 −v1 (ε1 − v1 ). The structure of the treatment intensity mechanism is sensitive to alternative specifications. Consider
the same example as before, except now the second derivative of Yd is also
stochastic: Yd = ϕ0 + (ϕ1 + ε1 )d + 12 (ϕ2 + ε2 )d 2 + ε0 . The choice equation becomes
D=

ϕ1 − C1 (Z) + ε1 − v1

C2 (Z) − ϕ2 − ε2

In this case, the structural model makes D a function of V = (ε1 − v1  ε2 ),
which satisfies Z ⊥⊥ (V  ε0  ε1  ε2 ), but V is not a scalar error. We can still
−1
define Ṽ = FD|Z (D|Z) and the function g̃ by g̃(Z Ṽ ) = FD|Z
(Ṽ |Z). With this
construction, D is strictly increasing in a scalar error term Ṽ that is independent of Z. However, Z is not independent of (V˜  ε0  ε1  ε2 ). To see why, note
that
Pr(Ṽ ≤ v|Z ε0  ε1  ε2 )


ϕ1 − C1 (Z) + ε1 − v1

−1
≤ FD|Z
(v)Z ε0  ε1  ε2
= Pr v1 :
C2 (Z) − ϕ2 − ε2
= Pr(Ṽ ≤ v|ε0  ε1  ε2 )
This is a case where assumption A-2 does not hold. The fragility of the specification of equation (5), where g is strictly increasing in a scalar error term,

1196

FLORENS, HECKMAN, MEGHIR, AND VYTLACIL

arises in part because, under rational behavior, heterogeneity in response to
treatment (heterogeneity in the Yd model) generates heterogeneity in selection into treatment intensity. This heterogeneity is absent if agents do not know
their own treatment effect heterogeneity, which can happen if agents are uncertain at the time they make participation decisions (see Abbring and Heckman (2007)).
3. IDENTIFICATION ANALYSIS
An instrumental variable estimator (IV) does not identify ATE in the case
of binary treatment with heterogeneous impacts (Heckman (1997), Heckman
and Robb (1986)) unless one imposes covariance restrictions between the errors in the assignment rule and the errors in the structural model. Following
Newey and Powell (2003) and Darolles, Florens, and Renault (2002), consider a nonparametric IV strategy based on the identifying assumption that
E(Y − ϕ(D)|Z) = 0. Suppose K = 0, which is the special case of no treatment
effect heterogeneity. In this case, UD = ε0 so that YD = ϕ(D) + ε0 . We obtain
the standard additive-in-unobservables model considered in the cited papers.
The identification condition is E(ε0 |Z) = 0. However, in the general case of
treatment effect heterogeneity (K > 0), the IV identification restriction implies special covariance restrictions between the error terms. For example,
suppose K = 1 and that D = g(Z) + V . Then E(Y − ϕ(D)|Z) = 0 requires
E(ε0 |Z) = 0 and E(ε1 D|Z) = 0, with the latter restriction generically equivalent to E(ε1 |Z) = 0 and E(ε1 V |Z) = 0. In other words, in addition to the
more standard type of condition that ε0 be mean independent of the instrument, we now have a new restriction in the heterogeneous case that the covariance between the heterogeneous effect and the unobservables in the choice
equation conditional on the instrument does not depend on the instrument.5
Instead of following an instrumental variables approach, we explore identification through a control function.6 We assume the existence of a (known or
identifiable) control function Ṽ that satisfies the following conditions:
A-3 —Control Function Condition: E(εj | D Z) = E(εj |V˜ ) = rj (Ṽ ).7
5

See Heckman and Vytlacil (1998) and Wooldridge (1997, 2003, 2007).
See Newey, Powell, and Vella (1999) for a control function approach for the case of separable
models (K = 0). See Heckman and Vytlacil (2007b) for a discussion of the distinction between
control functions and control variables. Technically “control function” is a more general concept.
We adopt the recent nomenclature even though it is inaccurate. See the Matzkin (2007) paper
for additional discussion.
7
Note that our normalization E(εj ) = 0, j = 0     K, implies the normalization that
E(rj (Ṽ )) = 0, j = 0     K.
6

IDENTIFICATION OF TREATMENT EFFECTS

1197

A-4 —Rank Condition: D and Ṽ are measurably separated, that is, any function of D almost surely equal to a function of Ṽ must be almost surely equal to a
constant.
A necessary condition for assumption A-4 to hold is that the instruments Z
affect D.8 We return later in this section to consider sufficient conditions on
the underlying model that implies the existence of such a control variate Ṽ .
Under these assumptions, ATE and TT are identified.
THEOREM 1: Assume equations (1) and (2) hold with finite K ≥ 1. Under
assumptions A-3 (control function condition), A-4 (rank condition), and the
smoothness and support condition A-1, ATE and TT are identified.
See the Appendix for the proof.
The control function assumption gives the basis for an empirical determination of the relevant degree of the polynomial in (2). If the true model is defined
by a polynomial of degree , we have that for any k > ,
∂k
∂k ϕ(d)
E(Y
|D
=
d
Ṽ
=
v)
=

∂d k
∂d k
which does not depend on v and thus is only a function of d. This property can
be verified by checking whether the following equality holds almost surely:
 k

∂
∂k E(Y |D V˜ ) as
˜ )D  k > 
=
E
E(Y
|D
V
∂Dk
∂Dk
3.1. Primitive Conditions Justifying the Control Function Assumption
In the previous section a control function is assumed to exist and satisfy certain properties. The analysis in the previous section did not use assignment
rule (5) or condition A-2. In this section, we use assignment rule (5) and condition A-2 along with the normalization that V is distributed unit uniform. Under
these conditions, consider using V = FD|Z (D|Z) as the control function. This
leads to the following corollary to Theorem 1:
COROLLARY 3.1: Assume equations (1) and (2) hold with finite K ≥ 1, and
assume smoothness and support condition A-1. If D is generated by assignment
equation (5) and condition A-2 holds, and if V and D are measurably separable A-4, then ATE and TT are identified.
8

Measurable separability, which we maintain in this paper, is just one way to achieve identification. Alternatively, one could restrict the space of functions ϕ(D) not to contain rj (Ṽ ) functions;
this in turn can be achieved, for example, by assuming that ϕ(D) is linear in D and rj is nonlinear as in the Heckman (1979) selection model. See also Heckman and Robb (1985, 1986), who
discussed this condition.

1198

FLORENS, HECKMAN, MEGHIR, AND VYTLACIL

For the conditions of Theorem 1 to be satisfied, it is sufficient to verify that
under the conditions in the corollary the control function assumption A-3 is
satisfied. Given that D satisfies assignment equation (5) and condition A-2,
from Imbens and Newey (2002, 2007) we obtain that V = FD|Z (D|Z) is a control variate satisfying assumption A-3.
Next consider measurable separability condition A-4. Measurable separability is a relatively weak condition, as illustrated by the following theorem.
THEOREM 2: Assume that (D V ) has a density with respect to Lebesgue measure in R2 and denote its support by S, and let S 0 be the interior of the support.
Further, assume that (i) any point in S 0 has a neighborhood such that the density
is strictly positive within it and (ii) any two points within S 0 can be connected by a
continuous curve that lies strictly in S 0 . Then measurable separability between D
and V (A-4) holds.
For the proof, see the Appendix.
Measurable separability is a type of rank condition. To see this, consider the
following heuristic argument. Consider a case where the condition is violated at
some point in the interior of the support of (D V ), that is, h(D) = l(V ). Hence
h(g(Z V )) = l(V ). Differentiating both sides of this expression with respect
∂g
= 0. If measurable separability fails, ∂h
= 0 and hence
to Z, we obtain ∂h
∂g ∂Z
∂g
∂g
= 0, which means that g does not vary with Z. Note that the conditions in
∂Z
Theorem 2 are not very restrictive. For example, the conditional support of D
can depend on V and vice versa.
Assignment rule (5) and condition A-2 do not imply measurable separability (A-4). To show this, we consider two examples where equation (5) and
condition A-2 hold, but D and V are not measurably separable. In the first
example, Z is a discrete random variable. In the second example, g(z v) is a
discontinuous function of v.
First, suppose Z = 0 1 and suppose that D = g(z v) = z + v, with V
Unif[0 1]. Then A-4 fails, that is, D and V are not measurably separable.
To see this, let m1 (t) = t and let m2 (t) = 1[t ≤ 1]t + 1[t > 1](t − 1). Then
m1 (V ) = m2 (D), but m1 and m2 are not a.s. equal to a constant. Now consider a second example. Suppose that D = g1 (z) + g2 (v), where g2 (t) = 1[t ≤
05]t + 1[t > 05](1 + t). Let g1max and g1min denote the maximum and minimum
of the support of the distribution of g1 (Z), and suppose that g1max − g1min < 1.
Then A-4 fails, that is, D and V are not measurably separable. To see this, let
m1 (t) = 1[t ≤ 05], let m2 (t) = 1[t ≤ 05 + g1max ], and note that m1 (V ) = m2 (D)
but that m1 and m2 do not (a.s.) equal a constant.
Assignment rule (5), condition A-2, and regularity conditions that require Z
to contain a continuous element and that g be continuous in v are sufficient to
imply that measurable separability (A-4) holds. We prove the following theorem.

IDENTIFICATION OF TREATMENT EFFECTS

1199

THEOREM 3: Suppose that D is determined by equation (5). Suppose that
g(z v) is a continuous function of v. Suppose that, for any fixed v, the support
of the distribution of g(Z v) contains an open interval. Then, under assumption A-2, D and V are measurably separated (A-4 holds).
For the proof, see the Appendix.
Note that, for any fixed v, for the support of the distribution of g(Z v) to
contain an open interval requires that Z contains a continuous element. A sufficient condition for the support of the distribution of g(Z v) to contain an
open interval is that (a) Z contains an element whose distribution conditional
on the other elements of Z contains an open interval and (b) g is a continuous
monotonic function of that element. Thus, under the conditions of Theorem 3,
V is identified by V = F(D|Z) and both the control function condition A-3
and the rank condition A-4 hold with Ṽ = V .
3.2. Alternative Identification Analyses
A general analysis of identification using the control function assumption
without the polynomial structure is related to the work of Heckman and Vytlacil (2001) on identifying the marginal treatment effect (MTE). That paper considers a binary treatment model, but the analysis may be extended to
the continuous treatment case. Similar approaches for semiparametric models
with a continuous treatment D that is strictly monotonic in V was pursued for
the average structural function (ASF) by Blundell and Powell (2004) and for
the local average response (LAR) by Altonji and Matzkin (2001, 2005). The
derivative of the ASF corresponds to our ATE, and the LAR corresponds to
treatment on the treated.
Most relevant to this note is the analysis of Imbens and Newey (2002, 2007).
They invoked the same structure as we do on the first stage equation for the
endogenous regressor as our assignment mechanism (5) and they also invoked
assumption A-2. The control variate is V , with V identified and with a distribution that can be normalized to be unit uniform. By the same reasoning, we
as
have E(Yd |D = d V = v) = E(Yd |V = v). Furthermore, they assumed that the
support of (D V ) is the product of the support of the two marginal distributions, that is, they assumed rectangular support. Their assumption implies that
the conditional support of D given V does not depend on V (and vice versa).
It is stronger than the measurable separability assumption we previously used
to establish identification. From these assumptions it follows that
E(Y |D = d V = v) = E(Yd |D = d V = v) = E(Yd |V = v)
and
E(Yd ) =

E(Yd |V = v) dF(v)

1200

FLORENS, HECKMAN, MEGHIR, AND VYTLACIL

Then ϕ(d) = E(Y |D = d V = v) dF(v) and is identified. Identification of
ϕ(d) in turn implies identification of ATE = ∂d∂ ϕ(d). The rectangular support
condition is needed to replace E(Yd |V = v) by E(Y |D = d V = v) for all v
in the unconditional support of V in the previous integral. The rectangular
support condition may not be satisfied and, in general, requires a large support
assumption as illustrated by the following example. Suppose D = g1 (Z) + V .
Let G1 denote the support (Supp) of the distribution of g1 (Z). If Z and V are
independent, then
Supp(V |D = d) = Supp(V |g1 (Z) + V = d)
= Supp(V |V = d − g1 (Z)) = {d − g : g ∈ G1 }
where the last equality uses the condition that Z ⊥⊥ V . {d − g : g ∈ G1 } does not
depend on d if and only if G1 = . For example, if G1 = [a b], then {d − g : g ∈
G1 } = {d − g : g ∈ [a b]} = [d − b d − a], which does not depend on d if and
only if a = −∞ and b = ∞, that is, if and only if G1 = .
Instead of imposing E(Yd |D = d V = v) = E(Yd |V = v), one could instead
impose



∂
∂

(7)
E(Y |D = d V = v) = E
Yd D = d V = v
∂d
∂d



∂

=E
Yd V = v 
∂d
E( ∂d∂ Yd |V = v) is the marginal treatment effect of Heckman and Vytlacil
(2001), adapted to the case of a continuous treatment. Instead of integrating
E(Yd |V = v) to obtain ϕ(d), one could instead integrate E( ∂d∂ Yd |V = v) to
obtain ATE or TT:
∂
E(Y |D = d V = v) dF(v)
∂d
∂
=
E(Yd |V = v) dF(v) = ATE (d)
∂d



∂
E Yd1 |D = d2  V = v dF(v|D = d2 )
∂d1
d=d1 =d2




∂

=E
Yd D = d2 
∂d1 1
d=d1 =d2


∂
=
E Yd1 |D = d2 
= TT (d)
∂d1
d=d1 =d2

This is the identification strategy followed in Heckman and Vytlacil (2001),
adapted to the case where D is a continuous treatment. As discussed in

IDENTIFICATION OF TREATMENT EFFECTS

1201

Heckman and Vytlacil (2001), a rectangular support condition is required to
integrate up MTE to obtain ATE. Note that one does not require the rectangular support condition to integrate up ∂d∂ E(Y |D = d V = v) to obtain TT.
For TT, one only needs to evaluate ∂d∂ E(Y |D = d V = v) for v in the support
of V conditional on D = d, not in the unconditional support of V .
While a rectangular support condition is not required to integrate MTE to
recover TT, a support condition is required for equation (7) to hold. That equation requires that E(Y |D = d V = v) can be differentiated with respect to d
while keeping v fixed. This property is closely related to measurable separability between D and V . Assume that there exists a (differentiable) function
of D, h(D) equal (a.s.) to a function of V  m(V ), which is not constant. Then
we obtain
as

E(Y |D = d V = v) = E(Yd |V = v) + h(d) − m(V )
and
∂
∂
as ∂
E(Y |D = d V = v) =
E(Yd |V = v) +
h(d)
∂d
∂d
∂d
which implies that equation (7) is violated. Thus, for TT, we still need measurable separability between D and V for equation (7) to hold.
There are trade-offs between the approach presented in this note versus an
approach that identifies MTE/MTE-like objects and then integrates them to
obtain the object of interest. The approach developed here requires a stochastic polynomial structure on UD of equation (2) and higher order differentiability. These conditions are not required by Imbens and Newey (2002, 2007) or
Heckman and Vytlacil (2001). The approach of this note does not require the
large support assumption required to implement these alternative approaches.
As shown by Theorem 2, measurable separability between D and V is a relatively mild restriction on the support of (D V ). As shown by Theorem 3, measurable separability between D and V follows from assignment mechanism (5)
and assumption A-2 combined with a relatively mild regularity condition.
4. ESTIMATION
Under the control function assumption we have
E(Y |D = d Z = z) = E(Y |D = d V = v)
= ϕ(d) +

K


d j hj (v)

j=0

The method we propose is an extension of Newey, Powell, and Vella (1999)
and may also be viewed as an extension of estimation of additive models in

1202

FLORENS, HECKMAN, MEGHIR, AND VYTLACIL

a nonparametric context. The estimation is carried out in two steps: first estimate the residual vi from the nonparametric regression D = E(D|Z) + V ;
then estimate ϕ and the hj ’s.
Define the estimation criterion
(8)

min E[Y − ϕ − D̃ h(v)]2 

ϕh0 hK

where D̃ = [1 D D2      DK ] and h = [h0  h1      hK ] . The first order conditions for the minimization are
(9)

E(Y |D = d) = ϕ(d) + d̃ E(h(V )|D = d)
E(D̃Y |V = v) = E(D̃ϕ(D)|V = v) + E(D̃D̃ |V = v)h

where d̃ = [1 d     d K ] .
This linear system in ϕ and h can easily be solved if the conditional expectations are replaced by their estimators (by kernels for example). In that case
it is easily seen that (9) generates a linear system with respect to the ϕ(di ) and
the hj (vi ) (i = 1     n; j = 0     K), and this system may be solved by usual
methods of linear equations. The equations in (9) are then used to compute
ϕ(d) and hj (v) at any point of evaluation. If we only wish to focus attention
on ϕ, the vector h may be eliminated from (9) and we obtain


ϕ(d) − d̃ E E(D̃D̃ −1 )E(ϕ(D)|V = v)|D = d


= E(Y |D = d) − d̃ E E(D̃D̃ −1 )E(D̃Y |V = v)|D = d 
This equation has the form (I − T )ϕ = ψ, where T is, under very general conditions, a compact operator and ψ may be estimated. It is a Fredholm equation
of type II which may be analyzed using the methods in Carrasco, Florens, and
Renault (2007, Sec. 7). The original system (9) is also a Fredholm equation of
type II and both systems generate well posed inverse problems. The asymptotic
theory developed in Carrasco, Florens, and Renault (2007) applies with the exception that the vi are now estimated. A precise analysis of this approach and
some applications will be developed in future work.
5. CONCLUSIONS
This paper considers the identification and estimation of models with a continuous endogenous regressor and nonseparable errors when continuous instruments are available. We present an identification result using a control
function technique. Our analysis imposes a stochastic, finite order polynomial
restriction on the outcome model, but does not impose a large support assumption.

IDENTIFICATION OF TREATMENT EFFECTS

1203

APPENDIX: PROOFS OF THEOREMS
PROOF OF THEOREM 1: Suppose that there are two sets of parameters
(ϕ1  rK1      r01 ) and (ϕ2  rK2      r02 ) such that
E(Y |D = d Ṽ = v) = ϕi (d) +

K


d k rki (v)

i = 1 2

k=0

where the conditional expectation on the left-hand side takes this form as a
result of the control function assumption A-3. Then
(10)

[ϕ1 (d) − ϕ2 (d)] +

K


d k [rk1 (v) − rk2 (v)] = 0

k=0

Given smoothness assumption A-1, this implies
∂K 2
∂K 1
ϕ
(d)
−
ϕ (d) + (K!)(rK1 (v) − rK2 (v)) = 0
∂d K
∂d K
Measurable separability assumption A-4 implies that if any function of d is
equal to a function of v (a.s.) then this must be a constant (a.s.). Hence, rK1 (v) −
rK2 (v) is a constant a.s. Hence,
rK1 (v) − rK2 (v) = E[rK1 (Ṽ ) − rK2 (Ṽ )]
This expression equals zero given our normalization that E(εK ) = 0. Hence,
as

rK1 (v) − rK2 (v) = 0
Considering the (K − 1)st derivative of equation (10), we find that
∂K−1 2
∂K−1 1
ϕ
(d)
−
ϕ (d) + (K!)d[rK1 (v) − rK2 (v)]
∂d K−1
∂d K−1
1
2
(v) − rK−1
(v)] = 0
+ ((K − 1)!)[rK−1

We have already shown that rK1 (v) = rK2 (v) and thus
∂(K−1) 1
∂(K−1) ∂ 2
1
2
ϕ (d) + ((K − 1)!)(rK−1
ϕ
(d)
−
(v) − rK−1
(v))
∂d (K−1)
∂d (K−1) ∂d
= 0
as

1
2
Using the logic of the previous analysis, we can show that rK−1
(v)−rK−1
(v) = 0.
as
1
Iterating this procedure for k = K − 2     0, it follows that rk (v) − rk2 (v) =

1204

FLORENS, HECKMAN, MEGHIR, AND VYTLACIL

0 for all k = 0     K. Again appealing to equation (10), it follows that
as
ϕ1 (d) − ϕ2 (d) = 0 and thus ATE is identified. Using the fact that ϕ1 (d) −
as
as
ϕ2 (d) = 0 and rk1 (v) − rk2 (v) = 0 for all k = 0     K, we also have that

K
K
∂
ϕ1 + k=1 kd k−1 E[rk1 (v)|d] = ∂d∂ ϕ2 + k=1 kd k−1 E[rk2 (v)|d] = 0 and thus TT
∂d
is identified.
Q.E.D.
PROOF OF THEOREM 2: Let (d v) be a point of the interior of the support S 0 . Let N d denote a neighborhood of d and let N v denote a neighborhood
of v such that N d × N v is included in S 0 . The distribution of (D V ) restricted
to N d × N v is equivalent to Lebesgue measure (i.e., has the same null sets).
Then using Theorem 5.2.7 of Florens, Mouchart, and Rolin (1990), (D V ) restricted to N d × N v are measurably separated. This implies that if within that
as
neighborhood h(D) = l(V ), then h(D) and l(V ) are a.s. constants. We need
to show that this is true everywhere in the interior of the support. Consider any
two points (d v) and (d  v ) in S 0 . The theorem will be true if h(d) = h(d ).
As S 0 satisfies the property (ii) in the theorem and is open by definition, there
exists a finite number of overlapping open sets with nonempty overlaps, that
is, there exists a finite sequence of neighborhoods Njd × Njv , j = 1     J, such
d
= ∅, and similarly for Njv . The first
that each Njd × Njv ⊂ S 0 and Njd ∩ Nj+1
point (d v) is in N1d × N1v and the second point (d  v ) is in NJd × NJv . Take
d1 ∈ N1d and in the next overlapping neighborhood d2 ∈ N2d . From the previous
result, (D V ) are measurably separated on N1d × N1v and on N2d × N2v . Thus
h(di ), i = 1 2, is constant on each and thus constant on the union, implying
h(d1 ) = h(d2 ). Iterating in this way along the sequence of neighborhoods until
NJd × NJv , it follows that h(d) = h(d ). Hence h(D) is a.s. constant and, because
as
Q.E.D.
h(D) = l(V ), l(v) is a.s. constant.
PROOF OF THEOREM 3: Let Z denote the support of the distribution of Z.
Consider any two functions m1 and m2 such that m1 (D) = m2 (V ) a.s. For (almost every (a.e.) FV ) fixed v0 , using the assumption that Z and V are independent, it follows that m1 (g(z v0 )) = m2 (v0 ) for a.e. z conditional on V = v0
implies that m1 is (a.s. FZ ) constant on {g(z v0 ) : z ∈ Z }. Likewise, for a v1
close to v0 , we have m1 is constant on {g(z v1 ) : z ∈ Z }. Using the fact that
g(z v) is continuous in v and that {g(z v) : z ∈ Z } contains an open interval
for any v, we can pick v1 sufficiently close to v0 so that {g(z v0 ) : z ∈ Z } and
{g(z v1 ) : z ∈ Z } have a nonnegligible intersection, and we thus conclude that
m1 is constant on {g(z v) : z ∈ Z  v = v0  v1 }. Proceeding in this fashion, we
conclude that m1 is (a.s.) constant on {g(z v) : z ∈ Z  v ∈ [0 1]}, and thus that
m1 is a.s. equal to a constant.
Q.E.D.
REFERENCES
ABBRING, J. H., AND J. J. HECKMAN (2007): “Econometric Evaluation of Social Programs,
Part III: Distributional Treatment Effects, Dynamic Treatment Effects, Dynamic Discrete

IDENTIFICATION OF TREATMENT EFFECTS

1205

Choice, and General Equilibrium Policy Evaluation,” in Handbook of Econometrics, Vol. 6B,
ed. by J. Heckman and E. Leamer. Amsterdam: Elsevier, 5145–5303. [1196]
ALTONJI, J. G., AND R. L. MATZKIN (2001): “Panel Data Estimators for Nonseparable Models
With Endogenous Regressors,” Technical Working Paper t0267, NBER. [1193,1199]
(2005): “Cross Section and Panel Data Estimators for Nonseparable Models With Endogenous Regressors,” Econometrica, 73, 1053–1102. [1192,1193,1199]
BJÖRKLUND, A., AND R. MOFFITT (1987): “The Estimation of Wage Gains and Welfare Gains in
Self-Selection,” Review of Economics and Statistics, 69, 42–49. [1191]
BLUNDELL, R., AND J. POWELL (2004): “Endogeneity in Semiparametric Binary Response Models,” Review of Economic Studies, 71, 655–679. [1192,1193,1199]
CARD, D. (1999): “The Causal Effect of Education on Earnings,” in Handbook of Labor Economics, Vol. 5, ed. by O. Ashenfelter and D. Card. New York: North-Holland, 1801–1863.
[1191]
(2001): “Estimating the Return to Schooling: Progress on Some Persistent Econometric
Problems,” Econometrica, 69, 1127–1160. [1191]
CARRASCO, M., J.-P. FLORENS, AND E. RENAULT (2007): “Linear Inverse Problems in Structural
Econometrics Estimation Based on Spectral Decomposition and Regularization,” in Handbook of Econometrics, Vol. 6B, ed. by J. J. Heckman and E. Leamer. Amsterdam: Elsevier,
5633–5751. [1202]
CHERNOZHUKOV, V., AND C. HANSEN (2005): “An IV Model of Quantile Treatment Effects,”
Econometrica, 73, 245–261. [1191]
CHERNOZHUKOV, V., G. W. IMBENS, AND W. K. NEWEY (2007): “Instrumental Variable Estimation of Nonseparable Models,” Journal of Econometrics, 139, 4–14. [1191,1192]
CHESHER, A. (2003): “Identification in Nonseparable Models,” Econometrica, 71, 1405–1441.
[1192]
(2007): “Identification of Non-Additive Structural Functions,” in Advances in Economics and Econometrics: Theory and Applications, Ninth World Congress, Vol. 3, ed. by R. Blundell, W. K. Newey, and T. Persson. New York: Cambridge University Press, Chapter 1. Presented at the Econometric Society Ninth World Congress, 2005, London, England. [1192]
DAROLLES, S., J.-P. FLORENS, AND E. RENAULT (2002): “Nonparametric Instrumental Regression,” Working Paper 05-2002, Centre Interuniversitaire de Recherche en Economie Quantitative (CIREQ). [1196]
FLORENS, J.-P., M. MOUCHART, AND J. ROLIN (1990): Elements of Bayesian Statistics. New York:
Dekker. [1204]
HECKMAN, J. J. (1979): “Sample Selection Bias as a Specification Error,” Econometrica, 47,
153–162. [1197]
(1997): “Instrumental Variables: A Study of Implicit Behavioral Assumptions Used in
Making Program Evaluations,” Journal of Human Resources, 32, 441–462; addendum, 33, 247
(1998). [1191,1196]
HECKMAN, J. J., AND B. E. HONORÉ (1990): “The Empirical Content of the Roy Model,” Econometrica, 58, 1121–1149. [1191]
HECKMAN, J. J., AND R. ROBB (1985): “Alternative Methods for Evaluating the Impact of Interventions,” in Longitudinal Analysis of Labor Market Data, Vol. 10, ed. by J. Heckman and
B. Singer. New York: Cambridge University Press, 156–245. [1191,1197]
(1986): “Alternative Methods for Solving the Problem of Selection Bias in Evaluating
the Impact of Treatments on Outcomes,” in Drawing Inferences From Self-Selected Samples, ed.
by H. Wainer. New York: Springer Verlag, 63–107. Reprinted in 2000, Mahwah, NJ: Lawrence
Erlbaum Associates. [1191,1196,1197]
HECKMAN, J. J., AND E. J. VYTLACIL (1998): “Instrumental Variables Methods for the Correlated
Random Coefficient Model: Estimating the Average Rate of Return to Schooling When the
Return Is Correlated With Schooling,” Journal of Human Resources, 33, 974–987. [1192,1196]
(2001): “Local Instrumental Variables,” in Nonlinear Statistical Modeling, Proceedings of
the Thirteenth International Symposium in Economic Theory and Econometrics: Essays in Honor

1206

FLORENS, HECKMAN, MEGHIR, AND VYTLACIL

of Takeshi Amemiya, ed. by C. Hsiao, K. Morimune, and J. L. Powell. New York: Cambridge
University Press, 1–46. [1191,1199-1201]
(2005): “Structural Equations, Treatment Effects and Econometric Policy Evaluation,”
Econometrica, 73, 669–738. [1191]
(2007a): “Econometric Evaluation of Social Programs, Part I: Causal Models, Structural
Models and Econometric Policy Evaluation,” in Handbook of Econometrics, Vol. 6B, ed. by
J. Heckman and E. Leamer. Amsterdam: Elsevier, 4779–4874. [1191]
(2007b): “Econometric Evaluation of Social Programs, Part II: Using the Marginal
Treatment Effect to Organize Alternative Economic Estimators to Evaluate Social Programs
and to Forecast Their Effects in New Environments,” in Handbook of Econometrics, Vol. 6B,
ed. by J. Heckman and E. Leamer. Amsterdam: Elsevier, 4875–5144. [1191,1196]
HECKMAN, J. J., J. A. SMITH, AND N. CLEMENTS (1997): “Making the Most Out of Programme
Evaluations and Social Experiments: Accounting for Heterogeneity in Programme Impacts,”
Review of Economic Studies, 64, 487–536. [1191]
IMBENS, G. W., AND J. D. ANGRIST (1994): “Identification and Estimation of Local Average
Treatment Effects,” Econometrica, 62, 467–475. [1191]
IMBENS, G. W., AND W. K. NEWEY (2002): “Identification and Estimation of Triangular Simultaneous Equations Models Without Additivity,” Technical Working Paper 285, National Bureau
of Economic Research. [1192,1194,1198,1199,1201]
(2007): “Identification and Estimation of Triangular Simultaneous Equations Models
Without Additivity,” Unpublished Manuscript, Harvard University and MIT. [1192,1194,1198,
1199,1201]
MATZKIN, R. L. (2007): “Nonparametric Identification,” in Handbook of Econometrics, Vol. 6B,
ed. by J. Heckman and E. Leamer. Amsterdam: Elsevier, 5307–5368. [1196]
NEWEY, W. K., AND J. L. POWELL (2003): “Instrumental Variable Estimation of Nonparametric
Models,” Econometrica, 71, 1565–1578. [1196]
NEWEY, W. K., J. L. POWELL, AND F. VELLA (1999): “Nonparametric Estimation of Triangular
Simultaneous Equations Models,” Econometrica, 67, 565–603. [1196,1201]
ROY, A. (1951): “Some Thoughts on the Distribution of Earnings,” Oxford Economic Papers, 3,
135–146. [1191]
WOOLDRIDGE, J. M. (1997): “On Two Stage Least Squares Estimation of the Average Treatment
Effect in a Random Coefficient Model,” Economics Letters, 56, 129–133. [1192,1196]
(2003): “Further Results on Instrumental Variables Estimation of Average Treatment
Effects in the Correlated Random Coefficient Model,” Economics Letters, 79, 185–191. [1192,
1196]
(2007): “Instrumental Variables Estimation of the Average Treatment Effect in Correlated Random Coefficient Models,” in Advances in Econometrics: Modeling and Evaluating
Treatment Effects in Econometrics, Vol. 21, ed. by D. Millimet, J. Smith, and E. Vytlacil. Amsterdam: Elsevier, 93–117. [1192,1196]

Institut d’Economie Industrielle, Université Toulouse 1, 21 Allée de Brienne,
3100 Toulouse, France,
Dept. of Economics, University of Chicago, 1126 E. 59th Street, Chicago, IL
60637, U.S.A and School of Economics, University College Dublin, Belfield,
Dublin, Ireland; jjh@uchicago.edu,
Institute for Fiscal Studies and Dept. of Economics, University College London,
Gower Street, London WC1E 6BT, U.K.; c.meghir@ucl.ac.uk,
and
Dept. of Economics, Yale University, 30 Hillhouse Avenue, New Haven, CT
06511, U.S.A.; edward.vytlacil@yale.edu.
Manuscript received July, 2004; final revision received March, 2008.

