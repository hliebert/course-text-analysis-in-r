Special Issue Paper
Received 30 October 2011,

Accepted 7 September 2012

Published online 22 October 2012 in Wiley Online Library

(wileyonlinelibrary.com) DOI: 10.1002/sim.5643

Doubly robust estimators of causal
exposure effects with missing data in
the outcome, exposure or a confounder‡
E. J. Williamson,a,b * † A. Forbesa and R. Wolfea
We consider the estimation of the causal effect of a binary exposure on a continuous outcome. Confounding
and missing data are both likely to occur in practice when observational data are used to estimate this causal
effect. In dealing with each of these problems, model misspecification is likely to introduce bias. We present augmented inverse probability weighted (AIPW) estimators that account for both confounding and missing data,
with the latter occurring in a single variable only. These estimators have an element of robustness to misspecification of the models used. Our estimators require two models to be specified to deal with confounding and
two to deal with missing data. Only one of each of these models needs to be correctly specified. When either the
outcome or the exposure of interest is missing, we derive explicit expressions for the AIPW estimator. When a
confounder is missing, explicit derivation is complex, so we use a simple algorithm, which can be applied using
standard statistical software, to obtain an approximation to the AIPW estimator. Copyright © 2012 John Wiley
& Sons, Ltd.
Keywords:

double-robustness; inverse probability weighting; G-computation; confounding; missing data;
observational study

1. Introduction
Missing data is a common problem in medical studies. Many analytic approaches have been proposed
for obtaining correct inferences in the presence of missing data. Multiple imputation is an increasingly
popular strategy [1]. Inverse probability weighting is an alternative approach, where fully observed
data is up-weighted to represent the full data. Li et al. [2] and Seaman et al. [3] gave comprehensive
reviews of weighting methods. Other missing data approaches, including full likelihood methods, can
be adopted but have been less frequently used because of the difficulty of extending these methods
to general scenarios. A fairly recent approach to missing data combines the imputation and inverseweighting strategies to form ‘doubly robust’ estimators, so-called because they are consistent if either
the imputation model or the model for missingness, but not both, is misspecified [4].
Motivated by increasing the precision of inversely weighted estimators, Robins, Rotnitzky and
others [5–7] proposed improved inversely weighted estimators for scenarios with missing covariates and outcomes, approaching the problem within the framework of semiparametric theory. These
ideas led to the investigation of the robustness properties of these estimators, and the introduction of
‘doubly robust’ augmented inverse probability weighted (AIPW) estimators [8]. Carpenter et al. [9]
applied ideas within these papers, comparing doubly robust AIPW estimators to estimators obtained
using multiple imputation. Tsiatis [10] further developed the ideas of Robins, Rotnitzky and others and
applied them to a variety of missing data scenarios and study designs. Kang and Schafer [4] discussed
a variety of doubly robust estimators for scenarios with missing outcome data, including some that fall
a Department

of Epidemiology and Preventive Medicine, Monash University, Australia
for Molecular, Environmental, Genetic and Analytic Epidemiology, School of Population Health, University of
Melbourne, Australia
*Correspondence to: E. J. Williamson, Department of Epidemiology and Preventive Medicine, Monash University, The Alfred
Centre, 99 Commercial Road, Melbourne, 3004 Victoria.
† E-mail: ewi@unimelb.edu.au
‡ Supporting information may be found in the online version of this article.
b Centre

4382

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

outside the class of AIPW estimators, focussing particularly on the properties of these estimators under
dual model misspecification. Bang and Robins [11] presented a doubly robust estimator for missing
outcome data, which is attractively simple but does not always have ideal statistical properties.
These doubly robust approaches to missing data can also be useful in fully observed data when a
treatment or exposure effect is of interest. Each subject is viewed as having two (or more) potential
outcomes, one under each possible exposure level; only one of which was actually observed [12]. By
viewing the non-observed potential outcomes as missing values, the missing data approaches discussed
earlier can be applied. To obtain a doubly robust estimator of exposure effect in fully observed data, two
models are required: a model for the outcome conditional on any confounding variables and a model
for the exposure given the confounding variables. The latter model is often termed the propensity score
model [13]. Lunceford and Davidian [14] and Austin [15] demonstrated that these two models can be
combined to give an AIPW estimator that is robust to the misspecification of either the outcome or the
propensity score model. Kang and Schafer [4] discussed a variety of doubly robust estimators for this
scenario, both AIPW and non-AIPW estimators.
In observational studies, because the form of the statistical models used to estimate exposure effects,
missing values or missingness mechanisms are typically uncertain, doubly robust approaches have highly
desirable statistical properties. However, the problems of confounding and missing data typically occur
simultaneously. Few authors have investigated the application of doubly robust estimators to situations
with both confounding and missing data. Davidian et al. [16] presented a doubly robust AIPW estimator
of the causal effect of an exposure in the presence of missing outcome data, in a pre-test–post-test scenario where additional information is available on variables intermediate between exposure and outcome,
framing their calculation of the estimator within semiparametric theory.
The objective of this paper, therefore, is to obtain doubly robust estimators for scenarios where either
the outcome, the exposure or a confounder is partially missing, to examine their robustness properties
and to gain an intuitive understanding of how the robustness properties are achieved. The paper is structured as follows. In Section 2, we review methods for estimating causal effects in the absence of missing
data. In Section 3, we extend these methods to situations with missing data in a single variable and draw
connections between previously proposed estimators and our approach. We apply our new estimators
to a non-randomized comparison by using the data from a randomized trial in anaesthesia in Section 4.
Section 5 presents results from a simulation study. We end by discussing our findings in Section 6.

2. Estimating causal effects in fully observed observational data
We begin by considering the situation in which the data are fully observed. There are various ways in
which causal effects can be estimated in the presence of confounding. We describe three such methods:
G-computation, inverse probability-of-treatment weighting (IPW) and a third approach, which combines
these two methods, doubly robust estimation.
2.1. Assumptions and notation

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

4383

We consider a typical cohort study, with a continuous outcome Y , a binary exposure of interest X taking
values 0 (unexposed) and 1 (exposed) and measured confounders Z D .Z1 ; :::; Zp /. The confounders Z
are assumed to temporally precede the exposure X . In the regression models that follow, Z is additionally assumed to contain a constant. The sample data is f.Yi ; Xi ; Zi /I i D 1; ::; ng. Each subject has two
potential outcomes: Y0 , the outcome that would occur if X were set to 0, and Y1 , the outcome that would
occur if X were set to 1. Only one of these can ever be observed. We assume that when the observed
exposure is X D x  , the observed outcome is equal to the appropriate potential outcome Y D Yx 
(the consistency assumption [17]). Thus, Y D X Y1 C .1  X /Y0 .
We assume that the data are an independent identically distributed sample from an (near) infinite population. The assumption of independence implies the stable unit treatment value assumption [18], which
states that the potential outcomes for one individual are unaffected by the exposure status of another.
We assume that all subjects have a non-zero probability of having either exposure; one of the potential outcomes would otherwise not be defined (the positivity assumption [19]). Finally, we make the
exchangeability or strongly ignorable treatment assignment (SITA) assumption [13], which states that
there are no unmeasured confounding variables. Formally, .Y1 ; Y0 / q X jZ, where we use q to denote
conditional independence [20].

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

For an individual, the causal effect of exposure to X is Y1  Y0 . Averaging this over the population
of interest, the causal estimand is  D EŒY1   EŒY0 . We describe the estimation of the marginal mean
1 D EŒY1 . Similar methods can be applied to the estimation of 0 D EŒY0 , from which an estimate
of  can be derived.
2.2. G-computation
Our first approach to the estimation of 1 , G-computation, can be thought of as a form of standardization
[21, 22], on the basis of the equality EŒY1  D EZ ŒEŒY1 jZ. Under the consistency and SITA assumptions
described earlier, EŒY1 j Z D EŒY j X D 1; Z. Suppose EŒY j X D 1; Z D Z with  D .0 ; :::; p /T .
The parameter  can be estimated using, for example, a linear regression model of observed outcome
Y on the measured confounders Z among exposed subjects (those with X D 1). Then, EŒY1 jZ can be
O using hats to
estimated from this model for each subject, whether exposed or unexposed, by YO1 D Z,
indicate sample estimates. To estimate 1 , we must take the expectation of the estimated EŒY1 jZ over
the distribution of the measured confounders, Z. This can be estimated by taking the sample average of
these estimates,
n
n
1X
1X O
gc
O 1 D
Zi O D
Y1i
n
n
i D1

i D1

where YO1i D Zi O is an estimate of the potential outcome Y1 for subject i.
Alternatively, we could fit the model EŒY j X; Z D Z  C X and then estimate EŒY1 jZ by setting
X D 1. If this regression model was used to estimate both 1 and 0 , then the estimate of , the
population-average exposure effect, would simply be ,
O the estimated regression coefficient for the
exposure variable X . This is commonly used as an estimate of the exposure effect in medical and
epidemiological research. It does, however, make the fairly strong assumptions that (i) the effect of
the exposure, (Y1  Y0 ), is the same for all individuals and (ii) the relationship between Y1 and Z is the
same as that between Y0 and Z. The latter assumption can be lessened by including interaction terms
between the confounders and exposure in the regression model.
2.3. Inverse probability-of-treatment weighting
Inverse probability-of-treatment weighting provides an alternative method for estimating 1 . We denote
the probability of treatment (or exposure) conditional on the measured confounders, also known as the
propensity score [13], by e.Z/ D Pr.X D 1 j Z/. Suppose that the binary exposure X follows a logistic
model parametrized by ˛ D .˛0 ; ˛1 ; : : : ; ˛p /T , so that logfe.Z/=.1e.Z//g D Z˛. The parameter ˛ can
O
be estimated from a standard logistic regression model by using maximum likelihood, giving estimates ˛.
The propensity score is estimated as
O
exp .Z˛/
eO D e.Z/
O
D
O
1 C exp .Z˛/
Inverse probability-of-treatment weighting derives from the equality EŒY1  D EŒYX=e.Z/. To see this,
by conditioning on Z, we have EŒYX=e.Z/ D EŒEŒYX=e.Z/jZ D EŒEŒY1 jZEŒX jZ=e.Z/, where
the latter equality follows from the consistency and SITA assumptions. Because EŒX jZ D e.Z/, the
right-hand side cancels to give EŒEŒY1 jZ D EŒY1 , from which we have EŒYX=e.Z/ D EŒY1  as
desired. This relationship prompts various inversely weighted estimators, including
! n
!1
n
X
X Xi
Yi Xi
ipw
O 1 D
(1)
eOi
eOi
i D1

i D1

ipw

4384

O i / is the estimated propensity score for subject i. It is useful to note that the estimator O 1
where eOi D e.Z
can be obtained as the constant term in a weighted linear regression model for Y including no covariates,
weighting subject i by Xi =eOi . A similar regression model, but weighting by .1  Xi /= .1  eOi /, gives
an estimate of 0 . The IPW estimate of the average causal effect, , can, therefore, be obtained
as the coefficient for X in a weighted linear regression model for Y including only X , weighting
exposed subjects by 1=eOi and unexposed subjects by 1= .1  eOi /. However, such a regression model
will not produce appropriate standard errors because it treats the estimated propensity scores as known
probabilities. Either bootstrapping or a correction to the standard error must be used to obtain valid 95%
confidence intervals [14].
Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

2.4. Doubly robust estimation
ipw

The estimator O 1 is a consistent estimator of 1 [14] but can have large variance if some propensity
scores are close to zero. It also requires the propensity score model (which we will call the ‘e-model’)
gc
to be correctly specified. Similarly, the estimator O 1 requires the outcome model (the y-model) to be
correctly specified. Modified IPW estimators, AIPW estimators, have been proposed. These have the
desirable property of being consistent estimators of 1 if either the y-model or the e-model is correctly
specified [5]. Such estimators are called ‘doubly robust’ because they are robust to the misspecification
of either the outcome or the propensity score model (but not both). One AIPW estimator is given by [14]

n 
1 X Yi Xi .Xi  eOi / O
aipw
O 1 D
(2)
Y1i

n
eOi
eOi
i D1

where YO1i and eOi are defined as in Sections 2.2 and 2.3, respectively. We demonstrate and discuss the
double-robustness property for a more general scenario in Section 3.3. Equation (2) can be re-arranged
to give
aipw
O 1


1X O
1X O
Xi
Y1i 
D
wi Y1i  Yi ; where wi D
n
n
eOi
n

n

i D1

i D1

(3)

gc

The first term in Equation (3) is simply the G-computation estimator, O 1 —the mean predicted potential outcome Y1 (the outcome that would occur under X D 1) taken over the whole sample, those both
exposed and unexposed. The error in estimating a subject’s potential outcome Y1 by YO1 is the difference
YO1  Y1 . For exposed subjects Y D Y1 , thus, the error YO1  Y1 is observed and is equal to YO1  Y . For
unexposed subjects, the error is unobserved (because Y ¤ Y1 if X D 0), so the second term in Equation
(3) takes the observed error among exposed subjects and re-weights the exposed sub-sample (by X=e)
to reflect the confounder distribution in the whole sample, which provides an estimate of the error in the
whole sample. Thus, this second term can be seen as a ‘bias correction’ [4].
2.5. Estimating equations for the doubly robust estimator
To extend the doubly robust estimator to scenarios with missing data, it is useful to note that calculating
aipw
the estimator O 1 is equivalent to solving a set of simultaneous estimating equations, which we now
describe. To obtain this estimator, we begin by estimating the propensity score from a standard logistic
regression model with exposure as the dependent variable, as described in Section 2.3. The maximum
O are obtained by setting the derivative of the
likelihood estimates of the propensity score parameters, ˛,
log-likelihood to zero. This derivative is equal to U3


exp.Z˛/
D Z> .X  e/
U3 D Z> X 
1 C exp.Z˛/
U3 , and all other estimating equations, are written as column vectors
P of the appropriate size. The propensity score parameters ˛O are obtained as the value of ˛ that solves i U3i D 0, where U3i is U3 evaluated
at the X and Z values of subject i, with the summation taken over the whole sample. As described in
Section 2.2, to estimate the potential outcomes Y1 , we fit a linear regression model
Pof Y on Z among the
exposed subjects (X D 1). This is equivalent to solving the estimating equations i U2i D 0, where
U2 D X Z> .Y  Z/
aipw

Then, the AIPW estimator O 1

can be obtained by solving the estimating equation
U1 D

P

i

U1i D 0, where

YX  .X  e/
O ZO
 1
eO

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

4385

leading
to (2). Thus, in fully observed data, estimates of a vector of unknown parameters  > D

P
aipw
1 ;  > ; ˛> can be obtained by simultaneously solving the estimating equations i Ui D 0, where

>
U> D U1 ; U>
2 ; U3 . We note that EŒU D 0 at the true value of . This process can be easily extended
aipw
to additionally estimate 0 and hence the causal exposure effect.

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

3. Estimating causal effects when some variables are partially missing
Typically, one or more of the measured variables will have some missing values. In this section,
we consider scenarios where one variable (the outcome, exposure or one of the confounders) is
partially missing.
3.1. Missing data notation and terminology
In standard missing data terminology, data are described as being ‘missing completely at random’ if the
probability of missingness does not depend on Y; Z or X. Missing at random (MAR) means that the
probability of missingness depends only on the fully observed component of the data, and missing not
at random signifies that the missingness depends on the unobserved component of the data after conditioning on the fully observed component. For all AIPW estimators described in the following, missing
data are assumed to be MAR.
We let W denote the data; in our scenario W D .Y; X; Z/, a subset of which is fully observed .V/
with the remaining variable partially missing .Q/, so W D .V; Q/. Complete cases are defined as subjects who have fully observed data. We define a complete case indicator, R, taking the value 1 if the
subject has fully observed data and 0 otherwise. Assuming that data are MAR, the probability of being
a complete case is defined as  D Pr.R D 1 j V/.
3.2. Complete case analysis
When a variable is partially missing, the simplest approach is to perform a complete case analysis. This
involves discarding any subjects with missing data (subjects with R D 0) and addressing confounding
by analysing the remaining fully observed subset of data by using a method such as G-computation,
IPW or a standard outcome regression model. This approach will typically lead to inefficient estimation of parameters because the data are discarded and often to biassed estimates. Unless the data are
missing completely at random, a complete case analysis will rarely produce unbiassed estimates of a
marginal mean such as EŒY1 . However, in many situations, the regression coefficients from a model
for EŒY jX; Z will be unbiassed. Under the SITA assumption, provided that the functional form of the
regression model is correct, the estimates of the regression coefficients from this model will be unbiassed provided that missingness does not depend on the outcome Y after conditioning on fully observed
components of X and Z. This has been demonstrated for scenarios where covariates are partially missing
using simulation [23], and in general the theory of directed acyclic graphs [24].
Therefore, whenever missingness does not depend on Y (note that this includes some scenarios where
X or Z are missing not at random), unbiassed estimates of EŒY jX; Z, and therefore EŒYx jZ, for
x D 0; 1, can be obtained using complete case analyses. Then, EŒY1  Y0 jZ can be (empirically)
averaged over the distribution of Z to estimate the desired causal effect,  D EŒY1  Y0 , provided that
Z is fully observed. If a variable of Z is partially missing, the causal effect can still be estimated under
an assumption of constant exposure effect across the population.
3.3. Constructing an augmented inverse probability weighted estimator
We briefly outline a method of constructing an AIPW estimator for missing data. Suppose that in the
absence of missing data, a consistent estimator ofa possibly vector-valued
unknown parameter of interest

aipw
>
>
>
—in our example this will be the vector  D 1 ;  ; ˛ as discussed in Section 2.5—could be
obtained by the value O of  that solves the estimating equation
n
X

U.Wi I / D 0

(4)

i D1

4386

where consistency of O is achieved by choosing U such that EŒU D 0 at the true value of 
[10, p. 235]. Pre-multiplying U by the indicator of fully observed data, Ri , within the summation of
Equation (4) would produce the (possible biassed) complete case estimator, and pre-multiplying by
Ri =i would produce an IPW-type estimator. A doubly robust AIPW estimator can be obtained by
solving the estimating equation [10, pp. 226–227]
Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE
n
X

U .Wi I / D 0;

where

i D1

U .Wi I / D

Ri
.Ri  i /
U.Wi I / 
EŒU.WI / j Vi 
i
i

(5)

where the expectation EŒU.WI / j Vi  is taken over the true distribution of the data, at the true value
of . In practice, the probability of fully observed data  and the expectation EŒUjV are estimated
from the data, and Equation (5) is solved after substituting in these estimates [10, pp. 229–230].
Typically,  is estimated using predicted values from a logistic regression model of R on V.
We call the model used to estimate  the ‘-model’. EŒU.WI / j Vi  is usually estimated by
assuming a parametric model for the conditional distribution of the partially missing variable
Q given the fully observed variables V. We give examples of this process in our simulation
study (Section 5).
The estimator O obtained from solving (5) has an interesting property, which we will call the ‘doublerobustness’ property: O is a consistent estimator of  if either the -model is correct or the expectation
EŒU.WI / j V is correct. To demonstrate this double-robustness property, we note that O will be consistent if the expectation of the estimating equation is zero at the true value of the parameters [10, p. 235].
Thus, O will be consistent if EŒU .Wi I / D 0 as defined in (5) with the expectation taken at the
true value of the parameter . We now that demonstrate this is true when either the -model or the
expectation EŒU.WI / j V is correct.
If the -model is correct, conditioning on the fully observed variables V and noting that
E R
jV D 1 gives

ˇ
ˇ
R ˇˇ
.R  / ˇˇ

V E Œ U.WI /j V  EV E
EŒU .WI / D EV E
ˇ V EŒU.WI / j V
ˇ

D EŒU.WI /  0 D 0
where the last equality follows because EŒU.WI / D 0 at the true value of , so if the -model is correct, we have EŒU .Wi I / D 0, which implies that the estimator obtained by solving (5) is consistent.
This is true irrespective of the correct specification of the function EŒU.WI / j V.
Now suppose the expectation EŒU.WI / j V is correct. We have
EŒU .WI / D E

h
i
R
fU.WI /  EŒU.WI / j Vg C E
U.WI / D 0



by conditioning the first term on V, so if EŒU.WI / j V is correct, we have EŒU .Wi I / D 0, which
implies that the estimator obtained by solving (5) is consistent. This remains true even if we replace 
by an incorrect probability.
So, assuming that solving (4) gives a consistent estimator of  in fully observed data, we have shown
that if either the -model or the expectation EŒU.WI / is correct, then solving Equation (5) will
produce a consistent estimator of .
3.4. Augmented inverse probability weighted estimator of 1 when the outcome Y is partially missing
When the outcome Y is partially missing, we can construct an AIPW estimator as outlined in
Section 3.3. The full data are W D .Y; X; Z/, and the fully observed variables are V D .X; Z/. The
missingness indicator R takes the value 1 if Y is observed and 0 otherwise, and  D Pr.R D 1 j X; Z/.
We assume that missingness follows a logistic model parametrized by  D . 0 ; 1 ; :::; pC1 /> , so that
logf=.1  /g D V. Then,  is estimated by
 
exp VO
 
O D .V/
O
D
1 C exp VO

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

4387

P
aipw
In fully observed
data, the estimator O 1 is obtained by solving the estimating equations i Ui D 0,
˚
>
where U> D U1 ; U>
2 ; U3 , as defined in Section 2.5. To calculate the AIPW estimator described in
Section 3.3, it is necessary to calculate EŒUk j X; Z for k D 1; 2; 3. We begin by focusing on U2 and
U3 . We have EŒU2 j X; Z D 0 and EŒU3 j X; Z D U3 . Substituting these equalities into (5), estimating
 by ,
O we have the following estimating equations:

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

R
X Z> .Y  Z/

O


O
R .R  /

U3 D U3
U3 D

O
O

U2 D

Because U3 D U3 , the propensity score parameters ˛ are estimated as they would be in fully observed
data; from a logistic regression model fitted on the whole sample. These estimated parameters are used to
obtain the estimated propensity scores, e.
O U2 determines that the outcome model for Y1 is fitted within
the fully observed sub-sample after inversely weighting for missingness of Y (weighting by R=)
O to
O
obtain estimates of . These estimates give the predicted potential outcomes, YO1 D Z.
We turn finally to U1 . We have
EŒ U1 j X; Z  D

X EŒ Y1 j Z   .X  e/Z
 1 D Z  1
e

Substituting this into (5), plugging in estimates of , e and  as described earlier, we have the following
estimating equation:


.R  /
O
R YX  .X  e/
RX
O ZO

O C ZO  1

U1 D
ZO  1 D
.Y  Z/
O
eO
O
O eO
Solving

P

i

U1i D 0 gives the following estimate of 1 :
aipw_y

O 1

D


1X O
1 X O
Ri Xi
wi Y1i  Yi ; where wi D
Y1i 
n
n
O i eOi
n

n

i D1

i D1

(6)

This estimator is very similar in form to (3). The first term is the mean predicted potential outcome
(under X D 1) taken over
 the whole sample, and the second term estimates the sample mean error in
O
the prediction Y1  Y1 . Now, however, this error is unobserved both for subjects who are unexposed
and for subjects whose outcome is missing, so the weighting, by RX= .O e/,
O re-weights the exposed
fully observed sub-sample to reflect the confounder distribution in the whole sample. By the doubleaipw_y
robustness property discussed in Section 3.3, O 1
will be consistent if (i) the full data estimating
equation U1 provides a consistent estimator of 1 and (ii) either the -model or EŒU1 jX; Z is correct.
aipw
For (i), O 1 is consistent if either the y-model or the e-model is correct (Section 3.3). For (ii), the calaipw_y
culation of EŒU1 jX; Z depended only on the y-model being correct. Thus, O 1
will be a consistent
estimator of 1 if either the y-model or both the e-model and the -model are correctly specified.
aipw_y
Standard errors for O 1
can be estimated as described in the Web Appendix.

4388

3.4.1. Connection between our augmented inverse probability weighted estimator Equation (6) and
other approaches. An alternative approach to this missing outcome data problem would be to view the
missingness of Y and being unexposed both as types of missingness, because both prevent Y1 from
being observed. Then, Y1 is observed if both R D 1 and X D 1. We could define a joint missingness
indicator, R D RX . In the ‘full data’ (where no data are missing and everyone is exposed to X ),
we would estimate 1 by using the estimating equation defined by U D Y1  1 . The probability of
being a complete case, using the new definition of complete case, would be Pr.R D 1jZ/ D Pr.R D
aipw_y
. How1jZ; X /Pr.X D 1jZ/ D e. Substituting these into Equation (5) gives the same estimator, O 1
ever, this ‘joint missingness’ approach cannot be easily generalized to other situations, such as those
with missing exposures or confounders, if the missingness depends on outcome after conditioning on
the other fully observed variables. When this occurs, the outcome model fitted on the complete cases
will be biassed even if correctly specified, so the robustness property is lost.
We noted earlier that Davidian et al. [16] have proposed a doubly robust estimator of a causal exposure effect in the presence of missing outcome data in a pre-test–post-test scenario where additional
information is available on variables intermediate between exposure and outcome. We now consider the
extension of our approach (Section 3.4) to this scenario and demonstrate that our approach produces the
estimator proposed by Davidian et al. Suppose the fully observed component of the data V contains, in
addition to X and Z, post-exposure variables M. In fully observed data, M would not be included in the
Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

model for Y1 because these variables may be at least partly a consequence of the exposure X . Further,
conditioning on M may introduce ‘collider’ bias if unmeasured confounding of the M  Y association
exists [25]. Thus, M would not be added to the predictors in the regression model represented by U2 .
Conversely, when applying Equation (5), we would include the fully observed M as part of the conditioning set when estimating  D Pr.R D 1jV/ and when calculating EŒU1 jV. Applying Equation (5) to
estimating equations involving U2 and U3 gives U2 and U3 , which are equal to U2 and U3 earlier but
with  allowed to depend also on M. However, applying Equation (5) to U1 gives U1 , which is not the
same as U1 . Let Y1 D EŒY jX D 1; Z; M. Then,
EŒU1 jX; Z; M D

Y1 X  .X  e/Z
 1
e

Substituting this into (5) to obtain U1 and solving
aipw_y
O 1

P

i

U1i D 0 give

n 
n
 1 X


1X O
Xi  O

O
Y1i 
D
wi YO1i  Yi ;
Y1i  Y1i 
n
eOi
n
i D1

wi D

i D1

Ri Xi
O i eOi

(7)

which can be re-arranged to give the estimator presented by Davidian et al. [16]. As in Equation (6),
the first term is the mean predicted potential outcome Y1 in the whole sample, and the second term is a
‘bias’ correction. The difference between the two estimators lies in the way the first term is calculated.
Equation (7) incorporates the additionally available data M to improve prediction of Y1 .
To distinguish between the two models for the outcome, we call the new model for Y involving M
aipw_y
the ‘y-imputation model’. The estimator O 1
is consistent for 1 if (i) the y-model or the e-model is
correct (the condition required for U1 to give a consistent estimator of 1 ) and (ii) either the -model
or EŒU1 jX; Z; M is correct. This latter expectation required the y-imputation model to be correct. Thus,
aipw_y
will be a consistent estimator of 1 if (i) either the y-model or the e-model is correct and (ii)
O 1
either the -model or the y-imputation model is correct.
The first two models both deal with the issue of confounding (y-model and e-model). The second two
deal with the issue of missing data (y-imputation model and -model). The y-model and y-imputation
model are both used in an imputation-like manner. The y-imputation model is used to ‘fill in’ missing
outcomes, and the y-model is used to ‘fill in’ potential outcomes Y1 for unexposed subjects (for whom
Y1 is unobserved). The e-model and -model, conversely, are both used as inverse weights, so this estimator combines the imputation and inverse-weighting approaches in such a way that as long as one of
these two approaches to confounding and one of these two approaches to missingness are correct, the
resulting estimator will be consistent.
In the remainder of this paper, we return to the simpler situation where post-exposure variables M are
not available. In this simpler case, the y-model and y-imputation model are identical; thus, the condition
earlier simplifies to the condition that either the y-model or both the e-model and the -model must be
correct, which is the condition we arrived at previously, and estimator (7) reduces to estimator (6).
3.5. Augmented inverse probability weighted estimator when the exposure X is partially missing
With a partially missing exposure, the fully observed subset of data is V D .Z; Y /. We let R D 1 if
X is observed and 0 otherwise, and  D Pr.R D 1 j Z; Y /. As in the previous section, we assume that
logf=.1  /g D V with  D . 0 ; 1 ; :::; pC1 /> . Fitting this logistic regression model gives the estimates .
O Letting X  D Pr.X D 1 j Z; Y /, which can be estimated using a logistic regression of X on Z
and Y , we have
EŒ U1 j Z; Y  D E

ˇ
ˇ
YX  .X  e/Z
 1 ˇˇ Z; Y
e

D

Y X   .X   e/Z
 1
e

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

4389

EŒ U2 j Z; Y  D EŒ X Z> .Y  Z/ j Z; Y 
D X  Z> .Y  Z/
ˇ


ˇ
exp.Z˛/
ˇ Z; Y D Z> .X   e/
EŒ U3 j Z; Y  D E Z> X 
1 C exp.Z˛/ ˇ

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

Substituting these into (5), replacing  and X  by sample estimates O and XO  and re-arranging, we
obtain the following equations:


8
9


< Y XO   XO   e Z =
.R

/
O
R
YX

.X

e/Z

U1 D
 1
:
;
O
e
O
e


R  O


O
U2 D X 
X  X Z> .Y  Z/
O



R  O

>

O
X 
e
U3 D Z
X X
O
P
The propensity score parameters are estimated by solving the modified estimating equation i U
3i D 0.

These are then used to estimate the propensity scores, e.
O The equation U3 is similar to
 a logistic
 score


function but with the partially missing X replaced by an estimate of X , namely XO  XO  X R=.
O
The first term in this estimate is XO  , obtained from a model for X given Z and Y (the x-model). The
second term is a ‘bias’ adjustment, correcting for misspecification of the x-model using the missingness
model. The parameters , used to obtain the predicted potential outcomes YO1 , are estimated by solving
P 
i U2i D 0. This is similar to the score function from a linear regression model, fitted on the exposed
subgroup (X D 1), with X replaced by the estimate described earlier. Although these estimating
equations do not correspond to standard models, they can be solved in many standard statistical packages
P
(e.g. using the gmm command in Stata) [26]. Solving i U1i D 0 gives the doubly robust estimator


O   XO   Xi Ri =O i
n
n


X
X
X
i
i
1
1
aipw_x
O 1
YO1i 
D
wi YO1i  Yi ; where wi D
(8)
n
n
eOi
i D1

i D1

aipw_x

The estimator O 1

is again very similar
 in form
 to (3). As previously, the second term estimates the mean error in the prediction YO1  Y1 . Because this is observed for exposed subjects
only, to estimate the error in the whole sample, we must weight by X=e, but this is not possible
because X is partially missing.
Therefore, the weights are created from the estimate of X , discussed



O
O
O
earlier: X  X  X R=.
aipw_x

Because the expectation EŒU1 jZ; Y  required only the x-model to be correct, the estimator O 1
will be a consistent estimator for 1 if (i) either the y-model or the e-model is correct and (ii) either the
-model or the x-model is correct. The first two models deal with confounding, and the last two deal
with missing data. As before, this estimator combines the imputation and inverse-weighting approaches
in such a way that as long as one of these two approaches to confounding and one of these two approaches
to missingness is correct, the resulting estimator will be consistent.
aipw_x
Standard errors for O 1
can be estimated as described in the Web Appendix.
3.6. Augmented inverse probability weighted estimator when a confounder is partially
missing—algorithm for an approximate estimator
When a confounder is partially missing, the expectations in (5) can be difficult to calculate explicitly,
such as EŒ.exp.Z˛/.1 C exp.Z˛//1 /1 jX; Y , as a function of X , Y , the unknown ˛ and unknown
parameters of the distribution f .ZjX; Y /. We have, therefore, used an approximation to obtain the doubly robust estimator in this situation, which we describe for a general partially missing variable. As
earlier, the full data is W D .V; Q/, with Q denoting the partially missing variable. To obtain an estimate O from Equation (5), we must estimate both  D Pr.R D 1jV/ and EŒ U.WI / j V . The former
can be easily estimated from the data using, for example, a logistic regression model of R on V. We
estimate the latter by

4390

Z
EŒ U.WI / j V  D

Copyright © 2012 John Wiley & Sons, Ltd.

U.Q; VI /dF .Q j V/ 

M
1 X  Q
U Qm ; VI 
M mD1

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

M
˚
where QQ m mD1 are M observations independently drawn from the distribution of Q j V. We have
assumed that the data are MAR, which implies that f .QjV/ D f .QjV; R D 1/. Therefore, we can
estimate the distribution of Q j V by using the complete case subjects only.
The estimating equation of (5) can be re-written using this approximation to give
!
n
M

X
.Ri  i / 1 X  Q
Ri
U.Wi I / 
U Qmi ; Vi I 
0
i
i
M mD1

(9)

i D1

After substituting in estimates of , this estimating
obtain an estimate for the
 equation can
 be solved to

aipw
>
unknown parameter . In our scenario,  > D 1 ;  > ; ˛> , and U> D U1 ; U>
2 ; U3 as defined in
Section 2.5.
We now describe a simple algorithm involving data duplication to solve estimating Equation (9) that
can be applied using any standard statistical software that allows negative weights. The steps involved in
the algorithm are as follows:
(1) Estimate the probability of being a complete case, ,
O for each subject.
(2) Estimate the distribution of Q j V from the complete case data (subjects with R D 1). In practice,
this will typically involve fitting a standard regression model for Q on V. For example, suppose the
partially missing variable was a continuous variable Z1 . We might fit the standard linear regression
model Z1 D V C , with  N.0; 2 /.
(3) Create M duplicates of the dataset. Delete all observed values of the partially missing variable Q
in these duplicated datasets and ‘fill in’ the variable with random draws from the estimated distribution of Q j V, so, for example, with the partially missing Z1 in the previous step, our ‘filled-in’

value of Z1 for subject i in dataset m would be VO C mi , where mi is drawn from the N 0; O 2
distribution.
(4) Stack the M imputed datasets in a ‘long’ format, adding the complete case dataset—the original
dataset after removing subjects with Q missing—to the top. The variable Q now consists of one set
of the observed values (for complete cases) and M sets of imputed values (for the whole sample).
Q
We call the combined dataset—the M duplicated datasets and the complete case dataset—W.
(5) Assign a weight of w0i D 1=O i to the row of data for subject i in the complete case dataset.
(6) Assign a weight of wmi D  .Ri  O i / = .O i M / to the row of data for subject i in duplicated
dataset m, for m D 1; :::; M .
Q as you would analyse the fully observed data but weighting the
(7) Analyse the combined data, W,
analyses by the weights described. Here, this involves fitting two standard (weighted) regression
models: (i) a logistic regression model of X on Z to obtain the estimated propensity scores, e,
O and
(ii) a linear regression model for outcome Y on Z among exposed subjects (those with X D 1) to
predict the potential outcomes, YO1 . Finally, the estimator for 1 is obtained by taking the weighted
sample mean of fYX  .X  eg
O YO1 /=e.
O

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

4391

The software used to fit the two weighted regression models in the last step must allow negative
weights. This can be achieved in the statistical package Stata, for example, using importance weights
[26]. However, we are not aware of equivalent facilities for allowing negative weights in SAS [27] or R
[28]; therefore, some additional programming would be needed to solve the required estimating equations in these packages. We emphasize that these negative weights are used simply as a trick to allow
calculation of the approximate estimating Equation (9) by using standard software, rather than the result
of a complex weighting scheme.
We do not estimate standard errors of estimators using this procedure; we rely on bootstrap confidence
intervals as described in the next section.
This algorithm uses the estimated distribution of Q j V to approximate the expectation in (5). Other
than the error created by approximating the expectation by the summation over the duplicated datasets,
the resulting estimator will be consistent if (i) either the y-model or the e-model is correct (conditions for
consistency for 1 in fully observed data) and (ii) either the -model or the model for Q j V is correct.
As for the previous two scenarios, this AIPW estimator combines the imputation and inverse-weighting
approaches in such a way that as long as one of these two approaches to confounding and one of these
two approaches to missingness is correct, the resulting estimator will be consistent.

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

4. Application: the B-Aware trial
In this section, we apply the methods developed in Section 3 to address a non-randomized comparison
in data taken from a randomized trial in anaesthesia. In this example, a confounder is partially missing;
thus, we use the procedure described in Section 3.6 to approximate the appropriate AIPW estimator.
General anaesthesia can be maintained by inhaled volatile anaesthetics, such as sevoflurane, or by
intravenously administered drugs (total intravenous anaesthetic; TIVA), such as propofol. Previous studies have suggested that TIVA is associated with lower post-operative anxiety and minor post-operative
complications. The B-Aware trial [29] is a multicentre, randomized controlled trial investigating the
effect of bispectral index (BIS) monitoring—a method for measuring of depth of anaesthesia—in preventing awareness during general anaesthesia in patients at high risk of awareness (e.g. high-risk cardiac
surgery, severe end-stage lung disease, past history of awareness and known or suspected heavy alcohol
intake). We use data taken from this trial to estimate the effect of TIVA, a non-randomized exposure, on
post-operative anxiety.
In the original trial, 2463 surgical patients aged 18 years or older, who were at high risk of awareness,
were randomized to BIS monitoring (target range 40–60) or routine care. In all other respects, perioperative care was at the discretion of the anesthesiologist. The anxiety subscale of the Hospital Anxiety
and Depression (HAD) scale [30], an ordinal scale from 0 to 21 with higher values indicating a more
anxious state, was used to measure pre-operative and 30 days post-operative anxiety. Baseline characteristics including ASA status (assessment of patient’s pre-operative physical state), weight, gender and
age were measured. The trial took place between September 2000 and December 2002.
For the current analysis, we have taken a random sample of approximately 80% of the patients
allocated to the BIS arm, leaving n D 942 patients. This analysis is intended to illustrate the methods and should not be used to inform decisions regarding use of TIVA. In our sub-sample of data,
pre-operative anxiety was not measured for 131 patients (14%). All other relevant variables are
fully observed.
4.1. Statistical methods

4392

We first analyse the data using a complete case approach, where only subjects with measured preoperative anxiety are included. We perform four different complete case analyses: (i) linear regression,
(ii) G-computation, (iii) propensity score analysis (IPW) and (iv) complete case AIPW. We then analyse
the data using two approaches to dealing with missing data: multiple imputation followed by methods
(i)–(iii) and applying the approach outlined in this paper—using the AIPW estimator obtained via the
approximation described in Section 3.6.
The outcome of interest is post-operative anxiety, and the binary exposure is TIVA. Age, sex, weight,
ASA status and the partially missing pre-operative anxiety are potential confounding variables (hereafter
called ‘the confounders’).
We first describe the complete case analyses. For (i), we fitted a linear regression model for postoperative anxiety including the confounders and TIVA as independent variables in the model and used
the estimated TIVA regression coefficient as the estimate of TIVA effect. For (ii), the G-computation estimator, we fitted two linear regression models for post-operative anxiety, one within each TIVA group,
including all confounders. We used the two models to predict post-operative anxiety under both exposure conditions (TIVA/no TIVA) for all complete case subjects. We then estimated the effect of TIVA
by the difference between the complete case sample means of these two predicted potential outcomes.
For (iii), the IPW estimator, we estimated the propensity score by fitting a logistic regression model for
TIVA on the confounders, using only the complete cases. This fitted logistic regression model was used
to predict the probability of receiving TIVA—the propensity score—for each complete case subject.
Participants who received TIVA were allocated a weight of the inverse of their estimated propensity
score. Participants who did not receive TIVA were allocated a weight of the inverse of 1 minus their
estimated propensity score. We obtained the IPW estimator by fitting a linear regression model for postoperative anxiety including only TIVA, to the complete case sample, using these weights as probability
weights and taking the estimated regression coefficient for TIVA as the IPW estimate of effect. Finally,
for (iv), the complete case AIPW estimator, the two potential outcomes under TIVA/no TIVA were
predicted for every subject in the complete case sample as described earlier for the G-computation estimator, and the propensity score was estimated as for the IPW estimator. Estimators of the mean outcomes
under TIVA and no TIVA were obtained by calculating the sum given in Equation (3) and an analogous
Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

expression for the sample mean under no TIVA. The AIPW estimate of TIVA effect was obtained as the
difference between these two means.
The conventional standard errors and 95% confidence intervals (CIs) are reported for the linear regression estimate (i). Because standard statistical software does not contain routines to produce correct
standard errors for multi-step estimators, bootstrapping was used to obtain 95% confidence intervals
for estimators (ii)–(iv). Specifically, bootstrap percentile confidence intervals were calculated using 500
bootstrap samples.
We now describe our two approaches to dealing with the missing confounder data. For analyses
using multiple imputation, the imputation model was a linear regression model for pre-operative anxiety
including all confounders and the outcome, post-operative anxiety. Fifty imputed datasets were generated. Each imputed dataset was analysed using methods (i)–(iii) as described earlier, and the resulting
estimates and standard errors were combined across the imputed datasets using Rubin’s rules [1].
Our second approach to the missing data is to obtain an AIPW estimator as described in this paper.
Because the partially missing variable is a confounder, our AIPW estimator has no closed-form solution,
so the procedure described in Section 3.6 was used to obtain an approximation to the estimator. M D 50
data replications were used for this procedure. To obtain the AIPW estimator, four models are required:
(i) a model for missingness of pre-operative anxiety , (ii) a model for pre-operative anxiety, (iii) a propensity score model (model predicting assignment to TIVA) and (iv) a model for post-operative anxiety. For
(i), we fitted a logistic regression model where the dependent variable was an indicator for pre-operative
anxiety being observed and which included, as independent variables, the confounders and TIVA. For
(ii), we fitted a linear regression model for pre-operative anxiety including TIVA, the confounders and
post-operative anxiety. The remaining two models included the same independent variables as described
for the complete case G-computation and IPW estimators. To obtain our AIPW estimator, we follow
the seven steps in the algorithm described in Section 3.6. Step 1 involves predicting the probability of
having observed pre-operative anxiety from model (i). Step 2 fits model (ii). Step 3 uses the fitted model
(ii) to create M sets of imputed pre-operative anxiety values for the whole sample. Steps 4–6 arrange
the data in a format suitable for analysis and create analysis weights. Step 7 involves fitting models
(iii) and (iv) in the weighted dataset. Then, the AIPW estimator is obtained by replacing Equation (3)
by a weighted mean. Bootstrap percentile confidence intervals were calculated for the AIPW estimator
using 500 bootstrap samples.
4.2. Results
Table I shows the baseline characteristics of our sub-sample of data from the B-Aware trial by TIVA
status and by whether or not pre-operative anxiety was measured. A total of 531 (56%) of the sample

Table I. Baseline characteristics of our sub-sample of the B-Aware trial, by TIVA status and by missingness
status of pre-operative anxiety.
Exposure (TIVA) status
Characteristic



No TIVA
(n D 411)

p

Missing
(n D 811)

Observed
(n D 131)

p

218

(41.1)

149

(36.3)

0.13

68
43

(51.9)
(32.8)

463
324

(57.1)
(40.0)

173

(32.6)

53

(12.9)

<0.001

25

(19.1)

201

(24.8) <0.001

239
119
56.0

(45.0)
(22.4)
(17.5)

188
170
61.1

(45.7)
(41.4)
(14.2)

<0.001

43
63
53.8

(32.8)
(48.1)
(17.8)

384
226
59.0

(47.4)
(27.9)
(16.0) <0.001

70

(60, 80)

70

(61, 84) 0.17

70
6.9

(60, 84)
(4.6)

71
6.6

(62, 82)

0.77

(4.6)

0.33

0.27
0.12

4393

TIVA, n (%)
Female, n (%)
ASA status, n (%)
No functional
impairment
Some impairment
Severe disease
Age in years,
mean (SD)
Weight in kg,
median (IQR)
Pre-operative anxiety,
mean (SD)

TIVA
(n D 531)

Pre-operative anxiety (confounder)

p-value from chi-squared test, t -test or Wilcoxon rank sum test, as appropriate.

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

Table II. Estimates of effect of TIVA on post-operative anxiety.
Method
Complete case analyses
Unadjusted difference
Linear regression (LR)
G-computation (G-comp)
IPW
AIPW


Missing data approaches M D 50
Multiple imputation with LR
Multiple imputation with G-comp
Multiple imputation with IPW
AIPW

Estimated mean difference

95% CI

Width of CI

0.974
0.764
0.769
0.774
0.773

(0.408,
(0.284,
(0.273,
(0.248,
(0.402,

1.539)
1.244)
1.221)
1.211)
1.123)

1.131
0.960
0.948
0.963
0.721

0.737
0.738
0.739
0.763

(0.286,
(0.298,
(0.305,
(0.341,

1.188)
1.178)
1.174)
1.182)

0.902
0.880
0.869
0.841

 Post-operative
 The

anxiety (HAD scale: 0–21), with higher values indicating a more anxious state.
number of imputed datasets (multiple imputation) or data replications (AIPW).

received TIVA. Those who received TIVA were in a better physical state (ASA status) prior to the
operation, were younger and a higher proportion were women. Those who are missing pre-operative
anxiety were in a worse physical state prior to the operation, were younger and a higher proportion
were men.
The mean (SD) post-operative anxiety was 3.8 (3.6) in the no TIVA group and 4.7 (4.3) in the TIVA
group. All estimates of effect of TIVA in Table II are in the same direction, indicating an increase of
post-operative anxiety associated with TIVA. However, the magnitudes of the point estimates are all
very small compared with the range of the outcome scale, so none indicate clinically significant effects.
The complete case analyses tended to give estimates of effect further from the null. In both the complete
case analysis and the missing data approaches, standard linear regression gave the estimates closest to
the null, and the AIPW estimates were among the furthest from the null.
Given the design of this trial, it seems likely that missingness depends only on baseline characteristics;
thus, we might expect the complete case estimates to be unbiassed. Interestingly, the AIPW estimator
accounting for the missing data was very close to the complete case estimates, but the estimates obtained
via multiple imputation were less so, perhaps indicating that the imputation model used for the multiple imputation does not fit well. In comparison with the complete case estimates, the AIPW estimate
accounting for the missing data has a narrower confidence interval than all but the complete case AIPW
estimator. In allowing for uncertainty about the missingness mechanism, some precision has been lost in
the AIPW estimator.

5. Simulation study
We conducted a simulation study on the basis of the B-Aware example in the previous section, investigating three separate scenarios. In each scenario, a single variable was partially missing, and all other
variables were fully observed. The partially missing variable in the three scenarios were (i) the outcome,
post-operative anxiety, (ii) the exposure of interest, TIVA, and (iii) one of the confounders, pre-operative
anxiety. We focus on estimation of the average causal effect,  D 1  0 , with 1 estimated as
described in Section 3 and 0 estimated in a similar way.
5.1. The simulation scenario

4394

Our simulation scenario is based on the B-Aware example. The measured baseline characteristics are
Z1 D sex, Z2 D sex-specific obesity indicator, Z3 D age (years), Z4 D disease severity underlying ASA status and Z5 D pre-operative anxiety. The exposure of interest, X , was TIVA, and the
outcome, Y , was post-operative anxiety. The variable Z4 is taken to be the underlying continuous quantity from which the ASA categories are derived. The assumed distributions, given in the following,
give distributions for these variables similar to the real data. However, for simplicity, we simulated
Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

anxiety from a normal distribution, so these variables are not restricted to the same range as the
original variables.
Sex

Z1  Bernoulli.50%/I

ASA status

Z4  Normal.´4 ; 0:52 /

Obesity
Age

Z2  Bernoulli.30%/I
Z3  UniformŒ30; 70I

Pre-op anxiety
TIVA

Z5  Normal.´5 ; 2:6752 /
X  Bernoulli.e/

Post-op anxiety

Y  N.y ; 1:8752 /

´4 D 2:7  0:4Z1  0:25Z2  Z1 Z2  0:005Z3
´5 D 8:415 C 0:535Z1 C 0:535Z2 C 0:02675Z3  0:02675Z4 C 0:002675Z42
 e 
ln
D 3:969  ln.1:75/Z1  ln.2:5/Z2 C ln.1:05/Z3 C ln.2/Z4 C ln.1:16/Z5
1e
y D X  1:225Z1 C 0:0000625Z3 C 1:875Z4 C exp.Z5 =10/
Approximately 65% of the sample are exposed. The propensity score distribution is negatively
skewed. In a typical sample of n D 5000, the median (min, max) of the propensity score was 0.52 (0.04,
0.95) in the unexposed (no TIVA) group and 0.73 (0.08, 0.97) in the exposed (TIVA) group. The true
average causal effect of the treatment, in our simulation study, is  D 1: TIVA increases post-operative
anxiety by one unit.
We have chosen extreme missingness mechanisms to more clearly illustrate the robustness properties
of the AIPW estimators. For the partially missing outcome, Y , and partially missing confounder Z5 , the
complete case .R D 1/ probability is defined by
logit fPr.R D 1 j Z1 ; Z2 /g D ln.5/Z1 C ln.1:05/Z2
and for the partially missing TIVA exposure, X , the complete case probability is given by
logit fPr.R D 1 j Z5 ; Y /g D 2:93 C ln.1:16/Z5 C ln.1:48/Y
In all missing data scenarios, approximately 30% of subjects have missing values in the outcome,
exposure or confounder.
To estimate the causal effect in each scenario, several models must be specified. For each model
required, we compare results using the correct model and a particular incorrect model. The correct model
for X given Y and Z1 ; Z2 ; Z3 ; Z4 ; Z5 (the x-model) can be determined explicitly from the distributions
given earlier, with a small amount of algebraic manipulation. For the scenario where a confounder is partially missing, however, the exact distribution of Z5 conditional on Y , X , Z1 ; Z2 ; Z3 ; Z4 (the z-model)
is required, but this is analytically intractable. The ‘correct’ model was therefore approximated by the
closest fitting linear regression model identified using a large simulated dataset. As for the missing data
mechanisms, we pick fairly extreme model misspecification to clearly illustrate the properties of our
AIPW estimators. For the y-models and e-models, the incorrect model omits the variable ASA status,
Z4 . The incorrect z-model omits both ASA status, Z4 , and post-operative anxiety, Y . The incorrect
x-model omits both ASA status, Z4 , and TIVA, X . When pre-operative or post-operative anxiety are
partially missing, the incorrect -model omits sex, Z1 . When TIVA is partially missing, the incorrect
-model omits post-operative anxiety, Y .
5.2. The analysis

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

4395

For each of the three scenarios (Y , X and Z5 partially missing), 5000 datasets each containing n D 1000
subjects were simulated. The average causal exposure effect, , was estimated by the appropriate AIPW
estimator, either using Equations (6) and (8) with the analogous equation for estimating 0 or, when the
confounder is partially missing, using the procedure of Section 3.6 with M D 50 replications of the data
to approximate the AIPW estimator. The AIPW estimators were obtained under all possible combinations of correct and incorrect specifications of the models required. Asymptotic confidence intervals for
the AIPW estimators defined by Equations (6) and (8) were obtained using the sandwich variance estimates given in the Web Appendix, with coverage estimated as the fraction of these containing the true
value ( D 1). Bootstrap percentile confidence intervals, using 500 bootstrap samples, are presented for

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

estimates obtained using the approximation of Section 3.6, on the basis of 500 simulations only because
of computational considerations.
For comparison,  was also estimated using two complete case estimators. The first was a correctly
specified linear regression model for the outcome including X; Z1 ; Z3 ; Z4 and exp.Z5 =10/ fitted in
the complete case data. The second complete case estimator was an IPW estimator obtained as the X
coefficient from a weighted linear regression model for Y on X , weighting exposed subjects by 1=e,
O
the inverse of the propensity score estimated from a correctly specified model, and weighting unexposed subjects by 1= .1  e/.
O The conventional 95% confidence intervals are presented for the complete
case outcome regression estimator, and the correction to the standard error proposed by Lunceford and
Davidian was used to obtain 95% confidence intervals for the IPW estimator [14].
The mean of the estimates, the empirical standard error (SE, the standard deviation of estimates across
simulations), the bias (the absolute difference between the mean estimate and the true value of 1) as a
percentage of the standard error (100  bias/SE), the mean-squared error (MSE D bias2 C SE2 ) and the
coverage of the 95% confidence intervals are presented.
To assess the accuracy of the approximate procedure of Section 3.6, we estimated  using both
an explicit formula for the estimator and the approximate procedure in the two scenarios where both
approaches are possible (those where the outcome or exposure are partially missing). We considered a
range of number of dataset replications (M ) to investigate the sensitivity of the estimates to the number
of replications used, M D 5; 10; 25; 50. We simulated 500 datasets each containing n D 1000.
5.3. Simulation results
When the outcome Y is partially missing, we expect the two complete case estimators to be consistent.
The AIPW estimator should be consistent if either the y-model is correct or if both the e-model and the
-model are correct. The simulation results, shown in Table III, show that this is indeed the case. Interestingly, although the complete case IPW estimator is consistent if the e-model is correctly specified, this
consistency is lost by the AIPW estimator if the y-model and -model are both incorrectly specified.
The lowest standard error is seen using the complete case outcome regression model, despite the smaller
sample size due to incomplete cases being discarded. Of the consistent estimators, the standard error is
highest when the y-model is incorrectly specified.
When the exposure X is partially missing, the missingness depends on the outcome Y , which creates
bias in the complete case estimators. The AIPW estimators should be consistent if (i) either the y-model
or the e-model is correct and (ii) either the x-model or the -model is correct, which is what we see
in Table IV. The coverages of the 95% confidence intervals are fairly high for scenarios with a consistent estimator where the y-model is incorrect. We conjecture that this is because the sample size is not
sufficient in these cases to attain the asymptotic distribution of the estimator for  because with larger

Table III. Properties of the AIPW estimator of  (the TIVA effect on post-operative anxiety) from
Equation (6) and an analogous expression for 0 using 5000 simulations and n D 1000 when the outcome Y ,
post-operative anxiety, is partially missing.
yX
—
X

X
X


X


Model specification
e—
X
X
X

X

X



—
—
X
X
X

X




Consistent?

Mean

Empirical
SE

% Bias/SE

MSE

% Coverage
of 95% CI

X
X
X
X
X
X


X


1.00
1.00
1.00
1.00
1.00
1.00
1.38
0.93
1.00
1.34

0.12
0.15
0.14
0.16
0.15
0.14
0.16
0.16
0.14
0.16

0.5
1.7
0.6
2.1
1.0
0.3
237.3
43.0
0.8
214.0

0.01
0.02
0.02
0.03
0.02
0.02
0.17
0.03
0.02
0.14

94.6
93.7
93.9
93.9
93.8
94.0
31.7
92.6
93.9
40.7

4396

Ticks and crosses indicate which models were correctly (tick) and incorrectly (cross) specified. A tick in the
‘Consistent?’ column indicates scenarios where the doubly robust property should result in a consistent estimator. For
comparison, the top two lines show two complete case estimators: the estimated regression coefficient from a correctly
specified outcome regression model and an IPW estimator using a correctly specified propensity score model.

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

Table IV. Properties of the AIPW estimator of  (the TIVA effect on post-operative anxiety) from Equation
(8) and an analogous expression for 0 using 5000 simulations and n D 1000 when the exposure X, TIVA, is
partially missing.
yX
—
X

X
X
X



X
X
X



X


Model specification
ex—
X
X
X

X
X

X
X


X


X



—
—
X
X
X

X
X

X

X


X




—
—
X
X
X
X

X
X

X


X





Consistent?

Mean

Empirical
SE

% Bias/SE

MSE

% Coverage
of 95% CI



X
X
X
X
X

X
X
X
X







0.91
0.93
1.00
1.01
1.00
1.02
1.00
1.39
1.03
1.00
1.00
1.00
0.91
1.39
1.39
0.92
0.90
1.24

0.16
0.20
0.20
0.21
0.20
0.35
0.19
0.23
0.37
0.20
0.22
0.19
0.18
0.25
0.21
0.19
0.18
0.20

55.8
33.1
1.8
5.7
0.2
5.1
1.2
170.3
8.5
1.2
0.3
1.5
50.6
153.0
184.1
43.0
56.0
120.0

0.03
0.05
0.04
0.04
0.04
0.12
0.04
0.20
0.14
0.04
0.05
0.04
0.04
0.22
0.19
0.04
0.04
0.10

91.6
93.6
94.6
98.5
94.5
95.0
95.1
58.9
98.9
99.3
94.7
94.8
93.6
67.5
60.2
99.4
92.9
85.1

Ticks and crosses indicate which models were correctly (tick) and incorrectly (cross) specified. A tick in the
‘Consistent?’ column indicates scenarios where the doubly robust property should result in a consistent estimator. For
comparison, the top two lines show two complete case estimators: the estimated regression coefficient from a correctly
specified outcome regression model and an IPW estimator using a correctly specified propensity score model.

Table V. Properties of the AIPW estimator of  (the TIVA effect on post-operative anxiety) using the
approximation of Section 3.6 with M D 50 data duplications, 5000 simulations and n D 1000 when a
confounder, pre-operative anxiety, is partially missing.
yX
—
X

X
X
X



X
X
X



X


Model specification
e´—
X
X
X

X
X

X
X


X


X



—
—
X
X
X

X
X

X

X


X




—
—
X
X
X
X

X
X

X


X





Consistent?

Mean

Empirical
SE

% Bias/SE

MSE

% Coverage
of 95% CI

X
X
X
X
X
X
X

X
X
X
X







1.00
1.03
1.00
1.00
1.00
1.00
1.00
1.38
1.01
1.00
1.00
1.00
1.00
1.38
1.38
1.01
1.00
1.38

0.17
0.20
0.16
0.17
0.17
0.17
0.16
0.18
0.17
0.17
0.17
0.16
0.16
0.18
0.18
0.17
0.16
0.18

0.4
0.8
0.5
2.8
0.3
1.0
1.2
211.8
3.4
1.6
0.8
1.3
0.7
211.5
215.1
3.9
2.2
215.7

0.03
0.04
0.03
0.03
0.03
0.03
0.03
0.18
0.03
0.03
0.03
0.03
0.03
0.18
0.18
0.03
0.03
0.18

95.0
95.8
93.4
96.4
95.2
93.3
94.2
42.5
95.0
94.5
94.2
94.5
94.3
40.4
40.5
94.3
94.2
37.7

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

4397

Ticks and crosses indicate which models were correctly (tick) and incorrectly (cross) specified. A tick in the
‘Consistent?’ column indicates scenarios where the doubly robust property should result in a consistent estimator. For
comparison, the top two lines show two complete case estimators: the estimated regression coefficient from a correctly
specified outcome regression model and an IPW estimator using a correctly specified propensity score model.

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

Table VI. Comparison of AIPW estimates of  (the TIVA effect on post-operative anxiety) for scenarios
with Y or X partially missing, calculated using analytic expressions (Equations (6) and (8) and analogous
expressions for 0 ) and using the approximation of Section 3.6 with a range of data replications (M ).
Combination of models
Partially missing
variable

(i)

(ii)

(iii)

(iv)

Method

M

Mean

SE

Mean

SE

Mean

SE

Mean

SE

Outcome
Y

Exact
Approximate

N/A
5
10
25
50

1.00
1.00
1.00
1.00
1.00

0.20
0.20
0.20
0.20
0.20

1.00
1.00
1.00
1.00
1.00

0.20
0.21
0.21
0.20
0.20

1.00
1.00
1.00
1.00
1.00

0.19
0.20
0.19
0.19
0.19

1.35
1.34
1.35
1.35
1.35

0.21
0.22
0.22
0.22
0.21

Exposure
X

Exact
Approximate

N/A
5
10
25
50

1.01
1.01
1.01
1.01
1.01

0.20
0.21
0.21
0.20
0.20

1.01
1.01
1.01
1.01
1.01

0.22
0.23
0.23
0.22
0.22

0.92
0.92
0.92
0.92
0.92

0.19
0.20
0.19
0.19
0.19

1.24
1.24
1.24
1.24
1.24

0.20
0.20
0.20
0.20
0.20

A total of 500 simulations were performed with n D 1000. Four combinations of models are considered: (i) all models
correct, (ii) y-model and -model correct only, (iii) e-model correct only and (iv) all models incorrect.

sample sizes these coverages reduce to around 95% (results not shown). For moderate sample sizes, such
as this, bootstrapping may be an attractive alternative.
When the confounder Z5 is partially missing, we expect the two complete case estimators to be consistent because the confounder being missing does not depend on the outcome. The AIPW estimators
should be consistent if (i) either the y-model or the e-model is correct and (ii) either the ´-model or the
-model is correct. The results in Table V agree with this in most cases. However, we see no evidence
of inconsistency in some situations where consistency is not guaranteed. This is explained by the fact
that our misspecified ´-model was, unlike the other misspecified models, not badly misspecified and
the confounder Z5 has little confounding effect on the exposure effect. For consistent estimators, the
bootstrap confidence intervals give approximately 95% coverage.
Table VI compares estimates of  obtained using the explicit formulae and the approximation using
data duplication, for scenarios where Y or X are partially missing. For this example, the estimates
are very similar even with five replications of the dataset. With much larger fractions of missing data
(e.g. 70%), the accuracy of the approximation with 5–10 replications was lower for this scenario,
although 50 replications still gave very good approximations (data not shown).

6. Discussion

4398

Confounding and missing data are both likely to occur when observational data are used to estimate the
causal effect of an exposure. In dealing with each of these problems, we face the additional challenge of
not knowing the true mechanisms by which the confounding and missing data arise. Standard statistical
solutions to the problems are therefore likely to create errors because of model misspecification. In this
paper, we have presented estimators that account for both confounding and missing data and that have an
element of robustness to the misspecification of the models required. We have derived an explicit expression for the estimator for scenarios where the outcome is partially missing and discussed the connection
between our estimator and the one proposed by Davidian et al. [16]. We have extended this approach to
scenarios where the exposure of interest is partially missing and have proposed a novel estimator that is
robust to model misspecification for both confounding and missing data. When a confounder is missing,
explicit calculation is complex, but we have proposed a novel but simple data duplication method, which
can provide close approximations to the estimator. We demonstrated that using 5–10 dataset replications
often gives accurate estimators. This parallels standard considerations for multiple imputation, where
5–10 imputed datasets are often used. These parallels could be further explored in future research. Our
approximation, however, is computationally demanding, particularly for the bootstrapped confidence
intervals; thus, this method may be infeasible for very large datasets.
Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

E. J. WILLIAMSON, A. FORBES AND R. WOLFE

Our simulation study demonstrated that our AIPW estimators have the robustness properties expected.
An important feature of these properties is that the addition of a misspecified model may result in a worse
estimate. For example, when the outcome is partially missing, an inverse probability weighted estimate
involving only a model for the propensity score is consistent. Our AIPW estimator, however, can be
inconsistent even if the propensity score model is correct. We therefore arrive at a similar conclusion to
Kang and Schafer: ‘at least in some settings, two wrong models are not better than one’ [4].
We have considered only scenarios where a single variable has missing data. More commonly, many
variables are partially missing. Future research will consider the extent to which these methods can be
extended to arbitrary missing data patterns. It is likely that methods applied for multiple imputation,
such as the use of data augmentation using Markov chain Monte Carlo procedures to approximate the
distribution of the missing data [31], will be useful in extending the ‘imputation’ aspect of our AIPW
estimators to more general missing data patterns.

Acknowledgements
We are grateful to Professor Paul Myles for providing us with the B-Aware data. We thank three anonymous
reviewers, whose comments have greatly improved the manuscript. This work was partly supported by a grant
from the National Health and Medical Research Council of Australia.

References

Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

4399

1. Rubin DB. Multiple Imputation for Nonresponse in Surveys. Wiley: New York, 1987.
2. Li L, Shen C, Li X, Robins J. On weighting approaches for missing data. Statistical Methods in Medical Research 2011.
DOI: 10.1177/0962280211403597. Advance online access.
3. Seaman SR, White I. Review of inverse probability weighting for dealing with missing data. Statistical Methods in Medical
Research 2011. DOI: 10.1177/09622802I0395740. Advance online access.
4. Kang JDY, Schafer JL. Demystifying double robustness: a comparison of alternative strategies for estimating a population
mean from incomplete data. Statistical Science 2007; 22:523–539. DOI: 10.1214/07-STS227.
5. Robins JM, Rotnitzky A, Zhao L. Estimation of regression coefficients when some regressors are not always observed.
Journal of the American Statistical Association 1994; 89:846–866.
6. Robins JM, Rotnitzky A. Semiparametric efficiency in multivariate regression models with missing data. Journal of the
American Statistical Association 1995; 90:122–129.
7. Rotnitzky A, Robins JM. Analysis of semi-parametric regression models with nonignorable non-response. Statistics in
Medicine 1997; 16:81–102.
8. Scharfstein DO, Rotnitzky A, Robins J. Adjusting for nonignorable drop-out using semiparametric nonresponse model
(with discussion). Journal of the American Statistical Association 1999; 94:1096–1146.
9. Carpenter J, Kenward M, Vansteelandt S. A comparison of multiple imputation and doubly robust estimation for analyses
with missing data. Journal of the Royal Statistical Society, Series (A) 2006; 169:571–584.
10. Tsiatis AA. Semiparametric Theory and Missing Data. Springer Series in Statistics. Springer: New York, 2006.
11. Bang H, Robins JM. Doubly robust estimation in missing data and causal inference models. Biometrics 2005; 61:962–972.
DOI: 10.1111/j.1541-0420.2005.00377.x.
12. Holland P. Statistics and causal inference. Journal of the American Statistical Association 1986; 81:945–960.
13. Rosenbaum PR, Rubin DB. The central role of the propensity score in observational studies for causal effects. Biometrika
1983; 70:41–55. DOI: 10.1093/biomet/70.1.41.
14. Lunceford JK, Davidian M. Stratification and weighting via the propensity score in estimation of causal treatment effects:
a comparative study. Statistics in Medicine 2004; 23:2937–2960. DOI: 10.1002/sim.1903.
15. Austin P, Mamdani M. A comparison of propensity score methods: a case-study estimating the effectiveness of post-ami
statin use. Statistics in Medicine 2006; 25:2084–2106. DOI: 10.1002/sim.2328.
16. Davidian M, Tsiatis AA, Leon S. Semiparametric estimation of treatment effect in a pretest-posttest study with missing
data. Statistical Science 2005; 20:261–301. DOI: 10.1214/088342305000000151.
17. Cole SR, Frangakis CE. The consistency statement in causal inference: a definition or an assumption? Epidemiology 2009;
20:3–5. DOI: 10.1097/EDE.0b013e31818ef366.
18. Rubin DB. Comment on ‘Randomization analysis of experimental data in the Fisher randomization test’ by Basu. Journal
of the American Statistical Association 1980; 75:591–593.
19. Westreich D, Cole SR. Invited commentary: positivity in practice. American Journal of Epidemiology 2010; 171:674–677.
DOI: 10.1093/aje/kwp436.
20. Dawid A. Conditional independence in statistical-theory. Journal of the Royal Statistical Society B—Methodological 1979;
41:1–31.
21. Snowden JM, Rose S, Mortimer KM. Implementation of G-Computation on a simulated data set: demonstration of a causal
inference technique. American Journal of Epidemiology 2011; 173:731–738. DOI: 10.1093/aje/kwq472.
22. Vansteelandt S, Keiding N. Invited commentary: G-Computation–lost in translation? American Journal of Epidemiology
2011; 173:739–742. DOI: 10.1093/aje/kwq474.
23. White IR, Carlin JB. Bias and efficiency of multiple imputation compared with complete-case analysis for missing
covariate values. Statistics in Medicine 2010; 29:2920–2931. DOI: 10.1002/sim.3944.

E. J. WILLIAMSON, A. FORBES AND R. WOLFE
24. Daniel RM, Kenward MG, Cousens SN, De Stavola BL. Using causal diagrams to guide analysis in missing data problems.
Statistical Methods in Medical Research 2011. DOI: 10.1177/0962280210394469. Advance online access.
25. Cole SR, Hernan MA. Fallibility in estimating direct effects. International Journal of Epidemiology 2002; 31:163–165.
DOI: 10.1093/ije/31.1.163.
26. Stata Statistical Software: Release 11. StataCorp LP: College Station, TX, USA, 2009.
27. SAS. SAS Institute Inc.: Cary, NC, USA.
28. R: A Language and Environment for Statistical Computing. R Foundation for Statistical Computing: Vienna, Austria,
2006. http://www.R-project.org, ISBN 3-900051-07-0.
29. Myles P, Leslie K, McNeil J, Forbes A, Chan M, for the B-Aware trial group. Bispectral index monitoring to prevent awareness during anaesthesia: the B-Aware randomised controlled trial. Lancet 2004; 363:1757–1763. DOI:
10.1016/S0140-6736(04)16300-9.
30. Zigmond A, Snaith R. The hospital anxiety and depression scale. Acta Psychiatrica Scandinavica 1983; 67:361–370.
31. Schafer JL. Analysis of Incomplete Multivariate Data. Chapman & Hall: London, 1997.

4400
Copyright © 2012 John Wiley & Sons, Ltd.

Statist. Med. 2012, 31 4382–4400

