ESTIMATION OF HETEROGENEOUS INDIVIDUAL TREATMENT EFFECTS
WITH ENDOGENOUS TREATMENTS

arXiv:1610.08899v1 [stat.ME] 27 Oct 2016

QIAN FENG∗ , QUANG VUONG† , AND HAIQING XU‡

A BSTRACT. This paper estimates individual treatment effects in a triangular model with
binary–valued endogenous treatments. Following the identification strategy established
in Vuong and Xu (forthcoming), we propose a two–stage estimation approach. First, we
estimate the counterfactual outcome and hence the individual treatment effect (ITE) for
every observational unit in the sample. Second, we estimate the density of individual
treatment effects in the population. Our estimation method does not suffer from the
ill–posed inverse problem associated with inverting a non–linear functional. Asymptotic
properties of the proposed method are established. We study its finite sample properties
in Monte Carlo experiments. We also illustrate our approach with an empirical application assessing the effects of 401(k) retirement programs on personal savings. Our results
show that there exists a small but statistically significant proportion of individuals who
experience negative effects, although the majority of ITEs is positive.
Keywords: Nonseparable triangular models, binary endogenous variable, counterfactual mapping, individual treatment effects, 401(k) retirement programs

Date: Monday 5th November, 2018.
∗ We thank Jason Abrevaya, Isaiah Andrews, Robert Leili, Leigh Linden, Matt Masten, Andres Santos as
well as seminar participants at NYU, University of Texas at Austin, Texas Econometrics Camp 2015, and
2016 CEME conference at Duke University for their helpful comments.
∗ Department of Economics, University of Texas at Austin, Austin, TX, 78712, qianfeng.qf@utexas.edu.
† (corresponding author) Department of Economics, New York University, 19 W. 4th Street, 6FL, New
York, NY, 10012, qvuong@nyu.edu.
‡ Department of Economics, University of Texas at Austin, h.xu@austin.utexas.edu.
1

1. I NTRODUCTION
Nonseparable triangular models have been studied extensively in the recent econometric literature, thereby allowing researchers to understand the nature of instrumental
variables in the presence of endogeneity. See e.g. Chesher (2003, 2005) and Imbens and
Newey (2009). One appealing feature of nonseparable models is that the non-additive
error in the causal relationship implies that the ceteris paribus effects of covariates on the
outcome variable “vary across individuals that, measured by covariates, are identical,”
Chesher (2003). Such heterogeneous causal effects are referred as “individual treatment
effects”(ITE) in the literature. See e.g. Rubin (1974), Heckman, Smith, and Clements
(1997) and Heckman and Vytlacil (2005).
Estimating ITE and its distribution is crucial for evaluating a social program, especially in view of the political issues associated with it (see Heckman, Smith, and
Clements, 1997). From an individual’s perspective, however, her ITE is more helpful
for evaluating her treatment participation decision than an average effect. While the
“average person” may benefit from a particular treatment, some individuals may experience little benefit or even some loss from participating, in which case alternative
treatment options may be preferred. Indeed, while the individual treatment effects of
401(k) retirement programs on personal savings are mostly positive in our sample, our
empirical analysis indicates that there are individuals who experience negative benefits
from participating to 401(k) retirement programs.
In this paper, we consider a triangular model with a binary endogenous regressor.
Because of the self–selection issue, individuals who are treated are different from those
who choose not to be treated. We address this issue with a binary valued instrumental
variable (see e.g. Imbens and Angrist, 1994). Limited variations of instrumental variables
have been emphasized in the recent treatment effect literature. Moreover, natural
experiments (e.g. Angrist and Evans, 1998; Post, Van den Assem, Baltussen, and Thaler,
2008) and eligibility for treatment participation (e.g. Angrist, 1990; Abadie, 2003) provide
commonly used binary–valued instrumental variables.

2

The distribution of heterogeneous treatment effects has also been studied using quantiles. For instance, Abadie, Angrist, and Imbens (2002) and Froelich and Melly (2013)
estimate the quantile treatment effects (QTE) for the complier group, a subpopulation
defined by Imbens and Angrist (1994) under binary–valued instruments. For the population QTE, Chernozhukov and Hansen (2004) propose a GMM–type approach in a
linear quantile specification. Subsequently, Chernozhukov and Hansen (2006, 2008)
generalize Chernozhukov and Hansen (2004)’s estimation procedure by using quantile
regression methods. In a fully nonparametric setting, Horowitz and Lee (2007) and
Gagliardini and Scaillet (2012) modify Chernozhukov and Hansen (2004)’s moment
conditions using the Tikhonov regularization to deal with the ill–posed inverse problem
for deriving asymptotic properties of their estimators.
Our approach is novel and simple to implement. Instead of solving the moment conditions in Chernozhukov and Hansen (2005), we use the quantile invariance condition to
match the realized outcome with its counterfactual outcome for every observational unit
in the sample through a so-called counterfactual mapping. Specifically, our approach recovers the ITE for every individual in the sample and does not suffer from the ill–posed
inverse problem associated with inverting a non–linear functional. In particular, we
show that the ITEs are estimated uniformly at the parametric rate. Given the recovered
ITEs, we estimate the density by kernel methods and establish its asymptotic properties.
Though it might be possible to obtain a density estimate from QTE estimates, this would
involve a more complicated two–stage procedure and a delicate trimming scheme (see
e.g. Marmer and Shneyerov, 2012).
We apply our approach to study the effects of 401(k) retirement programs on personal
savings. Introduced in the early 1980s, the 401(k) retirement programs aim to increase
savings for retirement. Endogeneity arises as individuals with a higher preference for
savings are more likely to participate and also have higher savings than those with lower
preferences (see, e.g., Poterba, Venti, and Wise, 1996). Following e.g. Abadie (2003) and
Chernozhukov and Hansen (2004), we use 401(k) eligibility as an instrumental variable
for 401(k) participation. We estimate the ITEs for every individual in the sample as
well as its density. Our results show that there exists a small but statistically significant
3

proportion (about 8.77%) of individuals who experience negative effects, although the
majority of ITEs is positive. It has been argued in the literature (see e.g. Engen, Gale, and
Scholz, 1996) that some individuals could suffer from the program due to the Crowding
Out Effect. We offer a complementary explanation as individuals with negative ITEs
are more likely to be younger, single, from smaller and lower income families but with
higher family net financial assets than the rest of the sample.
The structure of the paper is organized as follows. In Section 2, we introduce the
triangular model and discuss its identification and estimation. Section 3 provides Monte
Carlo experiments to illustrate the performance of our proposed estimator. Section 4
derives its asymptotic properties. Section 5 applies our estimation method to assess
the effects of 401(k) retirement programs on personal savings. Proofs of our results are
collected in the Appendix.

2. M ODEL , I DENTIFICATION AND E STIMATION
2.1. The triangular model. Following Chesher (2005), we consider a nonseparable
triangular model with an outcome equation and a selection equation:
Y = h( D, X, e),

(1)

D = 1{ν ≤ m( X, Z )}.

(2)

Here Y ∈ R is the outcome variable, D ∈ {0, 1} is an endogenous dummy that indicates
the treatment status, X ∈ SX ⊆ Rk is a vector of observed covariates (not necessary
exogenous) and Z ∈ {0, 1} is a binary instrumental variable for D, i.e., Z ⊥(e, ν)| X. The
two latent random variables e and ν are scalar valued disturbances. Moreover, the
function h and m are unknown structural relationships. In particular, h is continuous
and strictly increasing in e.
The key feature in the above triangular model is the nonseparability of h in the error
term e. With a nonseparable h, the ceteris paribus effects on the outcome variable from
covariates “vary across individuals that, measured by covariates, are identical,” Chesher
(2003). In the treatment effect literature, such heterogeneous causal effects are referred
4

as “individual treatment effects”(ITE), i.e.,
∆ ≡ h(1, X, e) − h(0, X, e).
See e.g. Rubin (1974) and Heckman, Smith, and Clements (1997). After controlling for X,
the ITE ∆ is still a random object since it depends on the latent variable e. Our interest
is to recover the ITE for each individual from her observables (Y, D, X ), and to estimate
the probability density function of ITE in the population. In particular, a decision-maker
can use the former to evaluate an individual’s participation choice, while the latter
characterizes the distribution of treatment effects, which has been central in the program
evaluation literature (see e.g. Heckman, Smith, and Clements, 1997).
We now provide two examples to illustrate the nonseparability of the structural
relationship h.
Example 2.1 (Additive error with generalized heteroscedasticity): Let
Y = h∗ ( D, X ) + σ∗ ( D, X ) · e,
where h∗ is a real-valued function, σ∗ is a positive function that captures the heteroscedasticity in the disturbance, and e ∈ R has zero mean and unit variance, unconditionally. This model is a generalization of a nonparametric regression model
with heteroskedastic errors studied by e.g. Andrews (1991). The difference is that the
heteroscedasticity term σ∗ depends on the endogenous binary variable D. In particular,
when σ∗ is a constant, the above specification becomes an additive nonparametric
regression with some endogenous regressor as studied by e.g. Newey and Powell (2003)
and Darolles, Fan, Florens, and Renault (2011).
Example 2.2 (Semiparametric transformation model): Consider
Γ(Y ) = X 0 β + γD + e,
where ( β0 , γ)0 ∈ Rk+1 and Γ : R → R is an unknown monotone function. See Horowitz
(1996) when ( X, D ) is exogenous. A parametric example of the monotone function Γ is

5

the Box–Cox transformation when Y is positive:
( y λ −1
λ , if λ 6 = 0;
Γ(y) =
log y, if λ = 0,
where λ ∈ R is a model parameter. Such a transformation is useful when the dependent
variable has a limited support. Indeed, the transformed dependent variable can have
an unlimited support thereby ensuring a linear model specification with its usual
assumptions. Various extensions of the Box–Cox transformation have been developed
in the literature (see e.g. Sakia, 1992), where monotonicity is a common feature in all
these transformations. Recently, Chiappori, Komunjer, and Kristensen (2015) have
studied the case where some variables such as D is endogenous.
2.2. Identification. Vuong and Xu (forthcoming) establish identification of the triangular model (1)-(2) in a constructive way and show that it only requires binary variations
of the instrumental variable Z. Given the monotonicity of h, the ITE can be written as a
function of the observables (Y, D, X ):
∆ = D × (Y − φ0X (Y )) + (1 − D ) × (φ1X (Y ) − Y ),

(3)

where φdX (·) for d = 0, 1 are defined as the counterfactual mappings that depend on
covariates X and the value of d, namely,1
φ0X (y) = h(0, X, h−1 (1, X, y)), ∀ y ∈ Sh(1,X,e)|X ,
φ1X (y) = h(1, X, h−1 (0, X, y)), ∀ y ∈ Sh(0,X,e)|X .
By definition, φdX are monotone functions mapping Sh(d0 ,X,e)|X onto Sh(d,X,e)|X , where
−1
d0 = 1 − d, and we have φ0X = φ1X
.

To obtain the ITE for an individual with (Y, D, X ) = (y, d, x ) ∈ SYDX , it suffices to
identify the counterfactual mapping φd0 x (y), where d0 = 1 − d. Let p( x, z) = P( D =
1| X = x, Z = z) be the propensity score function. For expositional simplicity, suppose
1The function h−1 (d, x, ·) denotes the inverse of h(d, x, ·). Hereafter, for a generic random variable W

o ≡ {w :
with distribution FW , we denote its support by SW , defined as the closure of the open set SW
FW (w) is strictly increasing in a neighborhood of w}.

6

SXZ = SX × {0, 1} and p( x, 0) 6= p( x, 1) for all x ∈ SX . W.l.o.g., throughout we
assume p( x, 0) < p( x, 1). Moreover, for any y ∈ R and d = 0, 1, let
Cdx (y) ≡

P(Y ≤ y; D = d| X = x, Z = 0) − P(Y ≤ y; D = d| X = x, Z = 1)
.
P( D = d| X = x, Z = 0) − P( D = d| X = x, Z = 1)

(4)

Imbens and Rubin (1997) show that Cdx (·) is the conditional distribution function of
h(d, X, e) given the complier group, namely, { X = x, m( x, 0) < ν ≤ m( x, 1)}. Let Cdx
be the support of Cdx (·). It is straightforward to see that Cdx ⊆ Sh(d,X,e)|X = x . Next, we
present the identification of φdx established in Vuong and Xu (forthcoming).
Theorem 1. (Vuong and Xu, forthcoming) In the triangular model (1)-(2), suppose (i) h is
continuous and strictly increasing in e; (ii) Z is conditionally independent of (e, ν) given X, i.e.,
Z ⊥(e, ν)| X with p( x, 0) 6= p( x, 1) for all x ∈ SX ; (iii) conditional on X, the joint c.d.f. Feν|X
is continuous; (iv) Cdx = Sh(d,X,e)|X = x for d = 0, 1 and x ∈ SX . Then, Sh(d,X,e)|X = x =
SY | D=d,X = x , and the counterfactual mapping φdx is identified by

−1
φdx (y) = Cdx
Cd0 x (y) , ∀ y ∈ SY | D=d0 ,X = x
◦ ≡ S◦
where Cdx (·) is continuous on R and strictly increasing on Cdx
for d = 0, 1,
Y | D =d,X = x

and d0 = 1 − d.
In Theorem 1, condition (i) – (iii) are standard in the triangular model literature.
The support condition (iv) requires that, conditional on X = x, the subpopulation
m( x, 0) < ν ≤ m( x, 1), i.e., the complier group introduced in Imbens and Angrist (1994),
contains the same information on individual treatment effects as the whole population.
It is weak as it is satisfied as soon as (e, ν) has a rectangular support given X. See Vuong
and Xu (forthcoming). It is testable since Cdx is identified by (4). When (iv) fails to hold,
the counterfactual mappings are partially identified on intervals. It is worth pointing
our that (iv) is needed for identification of ITE even if one assumes the error term e was
observed in the data.
With φdx identified, we can use (3) to construct the counterfactual outcome for any
individual in the population from her observables (Y, D, X ). Moreover, the probability
distribution of ITE is also identified under the conditions in Theorem 1.
7

2.3. Estimation. We now develop nonparametric estimators of the counterfactual mappings φdx for d = 0, 1 and the probability density function f ∆ of ITE. On one hand, φdx
can be used to construct the ITE for any individual in the population from her observables (Y, D, X ). On the other hand, the probability density function is a convenient way
to characterize the distribution of the ITE when the ITE is continuously distributed.2
Our estimation approach is fully nonparametric. To present the basic ideas, we assume
that the covariates X are discrete random variables with a finite support. Our analysis
can be extended using e.g. the kernel method to the case where X are continuous at the
cost of exposition.
Let {(Yi , Di , Xi0 , Zi )0 : i = 1, · · · , n} be an i.i.d. sample generated from the underlying
structure of the triangular model. Our proposed estimation procedure takes two steps:
First, for a given value of (y, d, x ) ∈ SYDX , we estimate the counterfactual mapping
φd0 x (y) by a simple estimator that minimizes a convex population objective function. In
the second step, we construct a pseudo sample of the counterfactual outcomes for all
individuals in the sample and then nonparametrically estimate the density function f ∆
using the kernel method. We introduce some notation. Fix x ∈ SX . For simplicity, we
suppress the dependence on X = x in the following discussion. For each (y0 , y1 ) ∈ R2
and z ∈ {0, 1}, let




ρ0 (y0 , y1 ; z) = E |Y − y0 |(1 − D ) X = x, Z = z − E sign(Y − y1 ) · D X = x, Z = z · y0 ,




ρ1 (y0 , y1 ; z) = E |Y − y1 | D X = x, Z = z − E sign(Y − y0 ) · (1 − D ) X = x, Z = z · y1 .
where sign(u) ≡ 2 × 1(u > 0) − 1.
For d = 0, 1, let


Qd (y0 , y1 ) = (−1)d × ρd (y0 , y1 ; 0) − ρd (y0 , y1 ; 1)
be the population objective function. Such an objective function is motivated by the
quantile regression method in Koenker and Bassett (1978). To see this, note that the
2Under Condition (i)–(iii), the ITE can have a mass point when φ has slope one in some intervals
dx

contained in its support, i.e., φ1x (y) = g( x ) + y on some [ a, b] ⊆ Sh(0,x,e)| X = x . Then, conditional on
X = x, ITEs take the same value g( x ) for all e ∈ {e : h(0, x, e) ∈ [ a, b]}. Hence, ITE has a mass point at
g( x ). Such a case, however, can be detected given the identification of φx .

8

quantile invariant condition in Chernozhukov and Hansen (2005) implies that for

(y0 , y1 ) ∈ R2 satisfying y1 = φ1x (y0 ) (equivalently, y0 = φ0x (y1 )), we have
P(Y ≤ y1 ; D = 1| X = x, Z = 0) + P(Y ≤ y0 ; D = 0| X = x, Z = 0)

= P(Y ≤ y1 ; D = 1| X = x, Z = 1) + P(Y ≤ y0 ; D = 0| X = x, Z = 1). (5)
In the next lemma, we show that (5) is indeed the first–order condition of the population
objective function Q0 (·, y1 ), which is continuously differentiable and weakly convex
on R. We also show that Q0 (·, y1 ) is strictly convex on SY◦| D=0,X = x and minimized
uniquely on R at y0 = φ0x (y1 ) whenever y1 ∈ SY◦| D=1,X = x . A similar argument also
holds for the population objective function Q1 (y0 , ·).
Lemma 1. Suppose the conditions in Theorem 1 hold. Then, for d = 0, 1 and yd ∈ R, the
function Qd0 (y0 , y1 ) is continuously differentiable and weakly convex in yd0 ∈ R where d0 =
1 − d. Moreover, if yd ∈ SY◦| D=d,X = x , then Qd0 (y0 , y1 ) is strictly convex in yd0 ∈ SY◦| D=d0 ,X = x ,
and uniquely minimized on R at φd0 x (yd ).
Lemma 1 provides a basis for our nonparametric estimation of the counterfactual
mappings φ0x (·) and φ1x (·). It is worth pointing out that each minimization is a one–
dimensional optimization problem.
We are now ready to define our estimator. For expositional simplicity, let SY | D=d,X = x
be a compact interval [y , ydx ]. For d = 0, 1, (y0 , y1 ) ∈ R2 and z ∈ {0, 1}, let d0 = 1 − d
dx

and
∑nj=1 |Yj − yd | × 1( D j = d; X j = x; Zj = z)
ρ̂d (y0 , y1 ; z) =
∑nj=1 1( X j = x; Zj = z)
∑nj=1 sign(Yj − yd0 ) × 1( D j = d0 ; X j = x; Zj = z)
−
× yd .
∑nj=1 1( X j = x; Zj = z)
Moreover, let
φ̂d0 x (yd ) = arg min Q̂d0 (y0 , y1 ), ∀ yd ∈ SY | D=d,X = x .
yd0 ∈[y 0 ,yd0 x ]
d x

9



0
where Q̂d0 (y0 , y1 ) = (−1)d × ρ̂d0 (y0 , y1 ; 1) − ρ̂d0 (y0 , y1 ; 0) . For simplicity, we assume
the support [y

d0 x

, yd0 x ] is known. See e.g. Guerre, Perrigne, and Vuong (2000) for

nonparametric estimation of the support [y

d0 x

, yd0 x ] if it is unknown.

Given the sample {(Yi , Di , Xi0 , Zi )0 : i = 1, · · · , n}, we can construct the counterfactual
outcome for every individual in the sample from her observables (Yi , Di , Xi ). Namely,
(
ĥ(0, Xi , ei ) = φ̂0Xi (Yi ), if Di = 1;
ĥ(1, Xi , ei ) = φ̂1Xi (Yi ),

if Di = 0.

Thus, we can estimate the ITE by (3), i.e., for i = 1, · · · , n,
(
Yi − ĥ(0, Xi , ei ), if Di = 1;
ˆi =
∆
ĥ(1, Xi , ei ) − Yi , if Di = 0.

(6)

ˆ i : i = 1, · · · , n} from the observed
In particular, we can construct a pseudo sample {∆
sample {(Yi , Di , Xi0 , Zi )0 : i = 1, · · · , n}.
It is worth pointing out that the first–stage estimation is computationally simple and
does not suffer from an ill–posed inverse problem (see e.g. Horowitz and Lee, 2007).
In particular, to solve the one–dimensional optimization problem for each individual’s
counterfactual outcome, the practitioner can use a grid search algorithm that is simple
but highly robust. As is shown below, the first–stage estimation bias φ̂dx (·) − φdx (·)
√
uniformly converges to zero at the parametric rate of n, given that all the covariates X
are discrete variables.3
Next, we follow Guerre, Perrigne, and Vuong (2000) to estimate the density function
f ∆ by the kernel method. To clarify ideas, let [δ, δ] be a subinterval of the ITE’s support.
Then, we define the density estimator:
1 n
fˆ∆ (δ) =
K
nh i∑
=1

ˆi −δ
∆
h

!
, ∀δ ∈ [δ + h, δ − h],

3If X contains continuous random variables, then we need to smooth over X as otherwise there may not
i
i

be enough observations for which X j = Xi .

10

where h is a bandwidth and K is a kernel with a compact support. Because the kernel
estimator fˆ∆ suffers from boundary issues, then we restrict the estimation of f ∆ to the
inner subset [δ + h, δ − h].
3. M ONTE C ARLO E XPERIMENTS
To illustrate the finite sample performance of the proposed estimator, we conduct
a Monte Carlo study. For simplicity, we do not include other covariates X in the
specification. Following the conditions in Theorem 1, the data generating process is
given by
D = 1(γ0 + γ1 · Z + ν ≥ 0),

Y = h( D, e),

where h(d, e) = (e + 1)2+d for d = 0, 1,4 and (e, ν) conforms to a joint distribution with
uniform marginal distributions on [0, 1] and Gaussian copula with correlation coefficient
0.3.5 Because h(d, ·) is continuous and strictly increasing in e, Condition (i) in Theorem 1
is satisfied. We set γ0 = −0.7 and γ1 = 0.1, 0.2 and 0.3, respectively. The value of γ1
determines the size of the compliers group, i.e., −γ0 − γ1 ≤ ν < −γ0 . Hence, the larger
γ1 , the more “effective” the instrumental variable Z. In our setting, ∆ = e(e + 1)2 is
distributed on [0, 4] with mean 1.417 and median 1.125 in the population. Moreover,
we set Z = 1{ξ ≥ 0} where ξ ∼ N (0, 1) is independent of (e, ν). Conditions (ii)–(iv) in
Theorem 1 are satisfied. In particular, condition (iv) holds since Feν|X has a rectangular
support as noted in Vuong and Xu (forthcoming).
Table 1 reports the finite sample performance of our ITE estimates in terms of the
Root Mean Squared Error (RMSE). Specifically, for each size n = 1000, 2000, 4000
we draw {(ei , νi , ξ i ) : i = 1, · · · , n} to obtain a sample (Yi , Di , Zi ) of size n. We then
ˆ i by (6) for each individual
compute the true ITE ∆i by h(1, ei ) − h(0, ei ) and its estimate ∆

(Yi , Di , Zi ). To obtain the RMSE for each such individual’s ITE, we draw another 200
4We also consider other functional forms for h(d, ·), e.g., h(0, e) = ln(e + 1) and h(1, e) = (e + 1)2 . The

results are qualitatively similar.
5A copula is a multivariate probability distribution of random variables, each of which is marginally uniformly distributed on [0, 1]. The Gaussian copula is constructed from a multivariate normal distribution.
See e.g. Nelsen (2007).

11

(r )

(r )

(r )

(r )

(r )

(r )

samples {(Yi , Di , Zi ) : i = 1, · · · , n} from {(ei , νi , ξ i ) : i = 1, · · · , n} for
r = 1, · · · , 2000. These are used to repeatedly estimate the ITEs for the individuals in
ˆ (r) = [Yi − φ̂(r) (Yi )] Di + [φ̂(r) (Yi ) − Yi ](1 − Di ) where φ̂(r) is
the original sample by ∆
0

i

1

d

the estimate
of φd using the r–th new drawn sample. Thus, we obtain the RMSE of
q
 (r )

1
ˆ i by
ˆ − ∆i 2 . For comparison, we also provide the RMSE of the LATE
∆
∑200 ∆
200

r =1

i

over the 200 replications/samples within curly brackets as proposed by Imbens and
Angrist (1994).6 By comparing their RMSEs from Table 1, a surprising result is that
estimating treatment effects at individual level (i.e. ITE) is not more difficult than to
estimate treatment effects at aggregated level (e.g. LATE) for every sample size. As
√
sample size increases, both the bias and standard error decrease at the expected n–rate.
The estimation error (i.e. its size and standard deviation) depends on the sample size n
and the compliers group’s proportion γ1 . Specifically in the different designs, the finite
sample performance of the ITE estimator depends on the value of n · γ12 . For example,
the performance of our estimator under (n, γ1 ) = (1000, 0.2) is similar to that under

(n, γ1 ) = (4000, 0.1). This observation is consistent with our asymptotic properties
established in the next section.
TABLE 1. Finite sample performance of ITE
Sample size
1,000

2,000

4,000

Ave. RMSE
Std. RMSE
LATE RMSE
Ave. RMSE
Std. RMSE
LATE RMSE
Ave. RMSE
Std. RMSE
LATE RMSE

γ1 = 0.1
1.2918
(0.5279)
{1.0448}
0.9343
(0.4289)
{0.6639}
0.6059
(0.2839)
{0.5057}

0.2
0.6076
(0.2912)
{0.5159}
0.4381
(0.2122)
{0.3759}
0.3245
(0.1455)
{0.2220}

0.3
0.4071
(0.2231)
{0.3619}
0.2670
(0.1511)
{0.2532}
0.18313
(0.0985)
{0.1790}

6For our Monte Carlo setting, the LATE reduces to [E(Y | Z = 1) − E(Y | Z = 0)] / [ p(1) − p(0)] =

1.5351,
1.4912, 1.4449 for γ1 = 0.1, 0.2, 0.3, respectively. Moreover, the LATE is estimated by

Y (1) − Y (0) / [ p̂(1) − p̂(0)] for a given sample, where Y (z) and p̂(z) are the sample means of Y and D
given Z = z, respectively, for z = 0, 1. In particular, unlike ITE and its estimate, LATE and its estimate do
not vary across individuals by definition.

12

Figures 1 and 2 illustrate the performance of the ITE estimates for the n individuals
with D = 0 and D = 1, respectively. In particular, we plot the ITE estimates versus the
true ITE. The green solid line is the mean and the dotted lines give the 90% confidence
interval computed from the 200 repetitions. The grey solid line is the 45–degree diagonal.
The ITE estimates for the group D = 1 behave better than the estimates for D = 0.
This observation is also consistent with our asymptotic results in the next section: The
ˆ of an individual with D = d depends on the density function of
performance of ∆
h(d0 , x, e), evaluated at her quantile in the distribution, conditional on the compliers
group (and X = x as well). In our setting, the conditional density of h(0, e) given the
compliers group is larger uniformly at all quantiles than that of h(1, e), which leads to a
ˆ for the group D = 1. For comparison, we also plot the true
more accurate estimator ∆
value of LATE with the 90% confidence interval of its estimate in grey color columns.
Overall, estimates of ITE and LATE behave similarly. Note that for any individual in
the group D = 1, our estimator of the ITE behaves better than LATE.
For the density estimator, we choose the bandwidth h = (ln n/n)1/7 and the pdf of
the standard normal as the kernel function. Figure 3 shows the performance of our
density estimator fˆ∆ . The black dotted line is the true density of the ITE and the green
one is the average of our density estimates fˆ∆ over the 200 repetitions. We also provide
the 5% and 95% percentiles of estimated densities using blue dotted lines, which gives
the (pointwise) 90% confidence band. Figure 3 shows again the importance of the size
of the complier group through nγ12 .
4. A SYMPTOTIC P ROPERTIES
We now establish the asymptotic properties of our proposed nonparametric esti√
mators. We first show the uniform n–consistency of the counterfactual mapping
estimator φ̂dx , and we give its limiting distribution. We then establish the asymptotic
properties of our density estimator fˆ∆ taking into account the first-step estimation of ∆.
For estimation, we strengthen Conditions (i) and (iii) in Theorem 1, respectively, to
Condition (i)’: h is continuously differentiable and strictly increasing in e.
13

6

1.8664

2

Estimated ITE

2.2189
2

Estimated ITE

4

6
4

6
4
2

Estimated ITE

3.122

0.9014

0

0

0

0.6873

−0.3475

1

2

3

4

0

1

3

4

0

1

2

3

4

3

4

3

4

6
4
Estimated ITE

4

6

True ITE( n=1000, γ1=0.3,D=0)

2.115
2

Estimated ITE

4

2.4215
2

Estimated ITE

2
True ITE( n=1000, γ1=0.2,D=0)

6

True ITE( n=1000, γ1=0.1,D=0)

1.8344

2

0

1.0668

0.854

1

2

3

4

0

1

3

4

0

1

2

6
4
Estimated ITE

4

6

True ITE( n=2000, γ1=0.3,D=0)

1.8643

2

Estimated ITE

4

2.2256
2

Estimated ITE

2
True ITE( n=2000, γ1=0.2,D=0)

6

True ITE( n=2000, γ1=0.1,D=0)

1.0627

2

0

0

0

0

0.3405

1.6651
1.1883

0

1

2

3

4

True ITE( n=4000, γ1=0.1,D=0)

0

0

0

0.6777

0

1

2

3

4

0

True ITE( n=4000, γ1=0.2,D=0)

1

2
True ITE( n=4000, γ1=0.3,D=0)

F IGURE 1. True and estimated ITE for D = 0
Condition (iii)’: The conditional distribution of (e, ν) given X is absolutely continuous
with respect to Lebesgue measure. Moreover, the conditional density function f e|X (·| x )
is continuous for all x ∈ SX .
Under Conditions (i)’, (ii) and (iii)’, the conditional distribution FY | DXZ is absolutely
continuous with respect to Lebesgue measure and its density f Y | DXZ is also continuous.
Therefore, the complier distribution Cdx (·) defined by (4) is also absolutely continuous
with respect to Lebesgue measure for d = 0, 1. Let cdx (·) be its density.
To simplify the exposition, we introduce the following assumption.
14

6

1.8664

2

Estimated ITE

2.2189
2

Estimated ITE

4

6
4

6
4
2

Estimated ITE

3.122

0.9014

0

0

0

0.6873

−0.3475

1

2

3

4

0

1

3

4

0

1

2

3

4

3

4

3

4

6
4
Estimated ITE

4

6

True ITE( n=1000, γ1=0.3,D=1)

2.115
2

Estimated ITE

4

2.4215
2

Estimated ITE

2
True ITE( n=1000, γ1=0.2,D=1)

6

True ITE( n=1000, γ1=0.1,D=1)

1.8344

2

0

1.0668

0.854

1

2

3

4

0

1

3

4

0

1

2

6
4
Estimated ITE

4

6

True ITE( n=2000, γ1=0.3,D=1)

1.8643

2

Estimated ITE

4

2.2256
2

Estimated ITE

2
True ITE( n=2000, γ1=0.2,D=1)

6

True ITE( n=2000, γ1=0.1,D=1)

1.0627

2

0

0

0

0

0.3405

1.6651
1.1883

0

1

2

3

4

0

0

0

0.6777

0

True ITE( n=4000, γ1=0.1,D=1)

1

2

3

4

0

True ITE( n=4000, γ1=0.2,D=1)

1

2
True ITE( n=4000, γ1=0.3,D=1)

F IGURE 2. True and estimated ITE for D = 1

Assumption 1: For every (d, x ) ∈ SD,X , (i) SY | D=d,X = x = [y , ydx ], where y
dx

dx

and ydx

are finite, and (ii) infy∈Cdx cdx (y) > 0. Moreover, (iii) X is a vector of discrete random
variables with a finite support.
When SY | D=d;X = x has an unbounded support, we can always apply a known strictly
increasing bounded continuous transformation to Y to satisfy Assumption 1-(i). Assumption 1-(ii) requires that the density cdx be bounded away from zero on its support.
It can be relaxed at the cost of technical complications due to e.g. some trimming. As
15

3

4

3

0

2

3

0.4
0.3
0.2

4

0

4

2

3

4

0.3

0.4

0.5

0.2

0.3

0.4

Probability density function

0.5
3

1

Estimated ITE( n=2000, γ1=0.3)

0.0

0.0
2

4

0.5
1

0.1

Probability density function

0.5
0.4
0.3
0.2
0.1

1

3

0.0
0

Estimated ITE( n=2000, γ1=0.2)

Estimated ITE( n=4000, γ1=0.1)

2

0.1

Probability density function

0.4
0.3
0.2

4

1

Estimated ITE( n=1000, γ1=0.3)

0.5
3

0.0
0

0.3

4

0.0
2

0.4

0.5
2

0.1

Probability density function

0.5
0.4
0.3
0.2

Probability density function

0.1

1

Estimated ITE( n=2000, γ1=0.1)

Probability density function

1

Estimated ITE( n=1000, γ1=0.2)

0.0
0

0.2
0.0

0

0.2

2

Estimated ITE( n=1000, γ1=0.1)

0.1

1

0.1

Probability density function

0.5
0.4
0.3
0.2
0.0

0.1

Probability density function

0.5
0.4
0.3
0.2
0.1

Probability density function

0.0
0

0

1

2

3

4

0

Estimated ITE( n=4000, γ1=0.2)

1

2

3

4

Estimated ITE( n=4000, γ1=0.3)

F IGURE 3. Estimated density of ITE
indicated earlier, Assumption 1-(iii) can be relaxed to allowed for continuous variables
in X by introducing some smoothing methods such as kernel ones.
The next theorem establishes the uniform consistency of the counterfactual mapping
√
estimator φ̂dx (·) on its full support. It also gives its n–asymptotic distribution. For
d = 0, 1 and y ∈ Cdx , let c∗dx (y) = cdx (y) · [ p( x, 1) − p( x, 0)] be the scale–adjusted
complier density and Rdx (y) = P(h(d, X, e) ≤ y| X = x ) be the probability rank of
y in the distribution of h(d, x, e) given X = x. Under the monotonicity of h and the
definition of φd0 x , we have
Rdx (y) = P(Y ≤ y; D = d| X = x ) + P(Y ≤ φd0 x (y); D = d0 | X = x )
where d0 = 1 − d.
16

Theorem 2. Suppose the conditions in Theorem 1, Conditions (i)’, (iii)’ and Assumption 1 hold.
Then, for d = 0, 1 and d0 = 1 − d, we have
sup

y∈SY | D=d;X = x

|φ̂d0 x (y) − φd0 x (y)| = o p (1).

Moreover, the empirical process c∗d0 x (φd0 x (·)) ×

√


n φ̂d0 x (·) − φd0 x (·) converges in distribution

to a zero–mean Gaussian process with covariance kernel
Σd0 x (y, y0 ) =

Rdx (min{y, y0 }) − Rdx (y) × Rdx (y0 )
.
P( Z = 0| X = x )P( Z = 1| X = x )

The uniform convergence of φ̂d0 x includes the boundaries, which is due to Assumption
1-(ii). Moreover, letting y = y0 in Σd0 x gives the asymptotic variance of c∗d0 x (φd0 x (y)) ×
√
n φ̂d0 x (y) as follows:
σd20 x (y)

Rdx (y) − R2dx (y)
≡
.
P( Z = 0| X = x )P( Z = 1| X = x )

As y approaches its boundaries, the asymptotic variance decreases to zero. Therefore,
we obtain a more accurate estimate of the counterfactual outcome when it is closer to
the boundary points. We also note that the asymptotic variance of φ̂d0 x (y) is inversely
proportional to c∗d02x (φd0 x (y)) = c2d0 x (φd0 x (y)) × [ p( x, 1) − p( x, 0)]2 , but is independent of
the magnitude of ITE.
Theorem 2 is important for several reasons. First, given an arbitrary triplet (y, d, x ),
√
we can provide a n–consistent estimate φ̂d0 x (y) of the counterfactual outcome φd0 x (y)
whenever y ∈ SY | D=d,X = x and x ∈ SX . Its standard error is given by
s
R̂dx (y) − R̂2dx (y)
1
√
.
n × ĉd0 x (φ̂d0 x (y))[ p̂( x, 1) − p̂( x, 0)] P̂( Z = 0| X = x )P̂( Z = 1| X = x )
where R̂dx (y) and P̂( Z = z| X = x ) are sample frequencies, and
ĉdx (·) × [ p̂( x, 1) − p̂( x, 0)] = (−1)d fˆY | DXZ (·|d, x, z) P̂( D = d| X = x, Z = 0)

− (−1)d fˆY | DXZ (·|d, x, z)P̂( D = d| X = x, Z = 1), (7)
17

in which fˆY | DXZ (y|d, x, z) is a kernel density estimator and P̂( D = d| X = x, Z = z) are
sample frequencies. Equation (7) follows from differentiating (4). Second, given the
√
ˆ i also uniformly converges to ∆i at the
uniform n–consistency of φ̂d0 x , it follows that ∆
√
n–rate.
Next, we turn to the asymptotic properties of our density estimator fˆ∆ .
Assumption 2: (i) On some interval [δ, δ] of S∆ , the density function f ∆ admits up
to P–th continuous bounded derivatives with P ≥ 1. Moreover, infδ∈[δ,δ] f ∆ (δ) > 0.
(ii) The kernel K (·) is a symmetric P-th order kernel with support [−1, +1] and twice
continuously bounded derivatives.7 (iii) The bandwidth h ∝ (ln n/n)1/(2P+2) .
The first part of Assumption 2-(i) is a high level condition requiring that the random
variable h(1, X, e) − h(0, X, e) has a smooth density function conditional on X = x. It
is satisfied if h(d, x, ·) for d = 0, 1 and the density of e given X areP–th continuously
differentiable. The second part of Assumption 2-(i) is standard for kernel estimation.
Assumptions (ii) and (iii) relate to the choice of the kernel function K and bandwidth h,
respectively. In particular, following Guerre, Perrigne, and Vuong (2000), the bandwidth
1

in (iii) leads to oversmoothing relative to the optimal bandwidth, i.e., h∗ ∝ (ln n/n) 2P+1
(see Stone, 1982).
ˆ to ∆ at the
Given Assumption 2 and the uniform convergence of ∆

√

n–rate, we show
in the Appendix that the first–step estimation error is asymptotically negligible in fˆ∆ .
Thus, we obtain the following result.
Theorem 3. Suppose the conditions in Theorem 2 and Assumption 2 hold. Then,
sup

P 
| fˆ∆ (δ) − f ∆ (δ)| = O p (ln n/n) 2P+2 .

δ∈[δ+h,δ−h]

Note that the convergence rate in Theorem 3 is uniform over the expanding interval

[δ + h, δ − h]. It is slower than the optimal convergence rate if the ITEs were observed,
P

which is (ln n/n) 2P+1 (see Stone, 1982).
7A P-th order kernel is a function integrating to one and satisfying R u p K (u)du = 0 if 1 ≤ p ≤ P − 1 and

< ∞ if p = P.

18

5. I NDIVIDUAL E FFECTS OF 401( K ) P ROGRAMS
In this section we apply our estimation method to study the effects of 401(k) retirement
programs on personal savings. The 401(k) retirement programs were introduced in the
early 1980s to increase savings for retirement. Since then, they became increasingly
popular in the US. It has been argued in the literature that participants might self–select
into the programs non-randomly (see, e.g., Poterba, Venti, and Wise, 1996). People with
a higher preference for savings are more likely to participate and have higher savings
than those with lower preferences.
Following e.g. Abadie (2003) and Chernozhukov and Hansen (2004), we use 401(k)
eligibility as an instrumental variable for 401(k) participation. This is because 401 (k)
plans are provided by employers. Hence, only workers in firms that offer such programs
are eligible so that the monotonicity in (2) is satisfied.8
5.1. Data. The dataset consists of 9,275 observations from the Survey of Income and
Program Participation (SIPP) of 1991 as in Abadie (2003). The observational units are
household reference persons aged 25-64 and spouse if present. The included households
are those with at least one member employed, with Family Income in the $10k – $200k
interval. Eligibility for 401(k) outside the interval is rare as noted by Poterba, Venti, and
Wise (1996).
Table 2 presents the summary statistics of the full sample as well as by eligibility and
participation status. The dependent variable is the Family Net Financial Assets (FNFA),
the treatment variable is the participation in 401(k), and the instrumental variable is the
eligibility for 401(k). About 28% in the sample participate in the program and 39% are
eligible for it. Other covariates include family income, age, marital status and family
size. Similar to Chernozhukov and Hansen (2004), age and income are grouped into
categorical variables 0, 1, 2 and 3 by using the 1st, 2nd and 3rd quartiles.
8Imbens and Angrist (1994) define monotonicity as: D (z ) ≤ D (z ) for all i, where D (z) is the potential
i 1
i 2
i

treatment status at Z = z. In our application, Z is 401(k) eligibility and Di (0) = 0. Therefore, Di (0) ≤
Di (1) a.s., i.e., Imbens and Angrist (1994)’s monotonicity condition holds. Moreover, Vytlacil (2002) show
that such a condition is observationally equivalent to the functional monotonicity in (2).

19

TABLE 2. Summary statistics
Entire sample By 401(k) participation
By 401(k) eligibility
Participants Non-participants Eligibles Non-eligibles
Treatment
401(k) Participation
Instrument
401(k) Eligibility
Outcome variable
FNFA
(in thousand $)
Covariates:
Family income
(in thousand $)
Age
Married
Family size

0.2762
(0.4472)

0.7044
(0.4564)

0.0000
(0.0000)

0.3921
(0.4883)

1.0000
(0.0000)

0.1601
(0.3668)

19.0717
(63.9638)

38.4730
(79.2711)

11.6672
(55.2892)

30.5351
(75.0190)

11.6768
(54.4202)

39.2546
(24.0900)
41.0802
(10.2995)
0.6286
(0.4832)
2.8851
(1.5258)

49.8151
(26.814.2)
41.5133
(9.6517)
0.6956
(0.4603)
2.9204
(1.4681)

35.2243
(21.6492)
40.9149
(10.5323)
0.6030
(0.4893)
2.8716
(1.5472)

47.2978
(25.6200)
41.4845
(9.6052)
0.6772
(0.4676)
2.9079
(1.4770)

34.0661
(21.5106)
40.8194
(10.7163)
0.5972
(0.4905)
2.8703
(1.5565)

TABLE 3. Average FNFA (in thousand $) sorted according to covariates
Family income
By percentile <0.25
2.29
(18.83)
0.25–0.5
7.68
(29.16)
0.5–0.75
16.63
(53.15)
>0.75
49.76
(104.87)

Age
4.29 By value
(21.08)
14.49
(62.78)
21.43
(67.33)
36.86
(87.31)

Married Family size
0
12.83
(50.55)
1
22.76
13.59
(70.45)
(47.59)
2
29.11
(82.70)
3
19.17
(66.86)
4
17.53
(56.83)
>4
12.51
(52.46)

Table 3 provides the mean and standard error (in parentheses) of the outcome variable FNFA by percentiles sorted according to covariates. Clearly, FNFA is monotone
increasing in family income and age. According to family size, FNFA is maximized at
20

family size 2 and decreases with family size when it is larger than 2. Moreover, married
households have higher FNFA than unmarried ones on average.
In Table 4, we provide OLS and 2SLS estimates as a benchmark for comparison
with our ITE estimates. Our results replicate the estimates in Abadie (2003). The OLS
estimates in column (1) show a significantly positive association between participation
in 401(k) and net financial assets given covariates. Furthermore, the 2SLS estimates
in column (3) confirms the positive, but attenuated treatment effects after controlling
for endogeneity of participation. It turns out that FNFA increases rapidly with family
income and age, and is lower for married couples and larger families.
TABLE 4. OLS and 2SLS estimates of 401(k) participation
OLS

Participation in 401(k)
Constant
Family income (in thousand $)
Age
Age squared
Married
Family size
Eligibility for 401(k)

2SLS
First stage Second stage
13.5271
9.4188
(1.8103)
(2.1521)
10.0421
0.0567
9.0076
(10.9142) (0.0464)
(10.9559)
0.9769
0.0013
0.9972
(0.0833)
(0.0001)
(0.0838)
-2.3100
-0.0048
-2.2386
(0.6177)
(0.0023)
(0.6201)
0.0387
0.0001
0.0379
(0.0077)
(0.0000)
(0.0077)
-8.3695
-0.0005
-8.3559
(1.8299)
(0.0079)
(1.8290)
-0.7856
0.0006
-0.8190
(0.4108)
(0.0024)
(0.4104)
0.6883
(0.0080)

Note: The dependent variable is family net financial assets (in thousand $). Family
income and age enter into the regression as continuous variables. The sample includes
9,275 observations from the SIPP of 1991. The observational units are household reference
persons aged 25-64, and spouse if present, with Family Income in the $10k-$200k interval.
Heteroscedasticity robust standard errors are given in parentheses.

5.2. ITE Estimates. To begin with, we first check the support condition for identification, i.e. Condition (iv) in Theorem 1. Because those who are not eligible for 401(k) (i.e.
21

Z = 0) cannot participate in the program, then C1x (·) = P(Y ≤ ·| D = 1, X = x, Z = 1)
by (4) and FY | D=1,X = x = FY | D=1,X = x,Z=1 . It follows that C1x = SY | D=1,X = x for all
x ∈ SX . Hence, to check Condition (iv), it suffices to verify the support condition for
d = 0. To do so, we estimate the density function c0x by (7) and the density function
f Y | DX (·|0, x ) directly from the data.
Fix the subgroup of individuals whose income is between the 25% and 50% percentile,
age between 40 and 48 years old, and family size smaller than 3.9 Figure 4 plots the
density estimate ĉ0x using the green solid line, and the density estimate fˆ
(·|0, x )
Y | DX

using the blue dotted line. From Figure 4, the two distributions roughly share the same
support.

0.04
0.02
0.00

Probability density function

0.06

0.08

F IGURE 4. Verifying the support condition

−20

0

20

40

60

FNFA

Moreover, as shown in Vuong and Xu (forthcoming), the main restrictions imposed by
our model require that Cdx (·) defined by (4) should be monotone increasing for d = 0, 1
and all x ∈ SX . We plot estimates of C0x (·) and C1x (·) in Figure 5 for the subgroup of
Figure 4. Both of them are increasing functions globally.
9We repeat this for other values of covariates. The results are qualitatively similar.

22

0.6

C1(y|x)

0.0

0.0

0.2

0.4

0.6
0.4
0.2

C0(y|x)

0.8

0.8

1.0

1.0

F IGURE 5. The model restriction

0

50

100

income: y

0

50

100

income: y

Table 5 reports summary statistics of the ITE estimates in our sample. From Table 5,
the ITE has a mean of $22.45k and median Q2 of $8.83k, indicating a long right tail of
the ITE distribution. The mean of ITE is larger than the average treatment effects (ATE)
of OLS and 2SLS, which are $13.53k and $9.42k, respectively, while the median of ITE
turns out to be smaller than these two ATEs. The differences reflect the distortion due
to the linear specification used in OLS and 2SLS, as well as the selection bias.
TABLE 5. Summary of ITE estimates (in thousand dollars)
Min Max Mean Std.
Q1 Q2
Q3 .
-918 1,533 22.45 102.77 3.10 8.83 20.90
Figure 6 provides the ITE density estimates for the full sample along with 95%
pointwise bootstrap confidence intervals. The participation effects of 401(k) on net
financial assets are distributed on the interval [-$10k, $60k], with a mode around $4k.
As the bootstrap confidence intervals indicate, the ITE density is quite well-estimated.
Figures 7 to 10 plot the ITE density estimates conditional on income, age, family size and
family status, separately. In particular, the ITE density given income shifts to the right
with a slight increase in variance as income increases, revealing that ITEs for individuals
with high income is larger though more heterogeneous than for those whose income are
low. Thus, the benefits from participating to 401(k) retirement programs on personal
23

savings increase as Family Income increases. Though not as pronounced, the same
trend is found when conditioning on age, family size and family status.

0.04
0.03
0.02
0.00

0.01

Probability density function

0.05

F IGURE 6. Estimated densities of ITE for full sample

−10

0

10

20

30

40

50

60

Estimated ITE

A striking feature of Figures 6 to 10 is that there exists a small but statistically significant proportion (about 8.77% in the full sample) of individuals who experience
negative effects, although the majority of ITEs is positive.10 This is especially the case
for young individuals (age percentile below 0.25) where such a proportion is 15.93%.
Such a finding is new. In particular, Table 6 provides the summary statistics of the
subgroup with negative ITEs, compared with the subgroup with positive ITE and the
entire sample. Individuals with negative ITEs are more likely to be younger, single,
and from smaller families with lower family income. A puzzling feature is that the
subgroup with negative ITEs has a larger FNFA than the rest of the sample, though
the large standard error (113.92) indicates a large heterogeneity among this group. Our
10For such an empirical evidence, one could investigate it alternatively by using the (conditional) quantile

treatment effects for the complier group (see e.g. Abadie, Angrist, and Imbens, 2002; Froelich and Melly,
2013) at low quantiles. We thank Isaiah Andrews for this point.

24

0.10
0.00

10

20

30

40

−10

0

10

20

Estimated ITE

Estimated ITE

Income percentile 0.5−0.75

Income percentile >0.75

30

40

0.04
0.00

0.00

0.02

0.02

0.04

0.06

Probability density function

0.06

0.08

0.08

0

0.10

−10

Probability density function

0.05

Probability density function

0.10
0.05
0.00

Probability density function

0.15

Income percentile 0.25−0.5

0.15

Income percentile<0.25

−10

0

10

20

30

40

−10

Estimated ITE

0

10

20

30

40

50

60

Estimated ITE

F IGURE 7. Estimated densities of ITE by income category
conjecture is that the majority of this group use their savings to invest aggressively in
their own businesses or in financial markets.
Figure 11 uses a classification tree to summarize the benefits and losses of participation
decisions for all individuals in the sample: Among those who are eligible, 5.67% of them
participate in 401(k) but have negative ITEs, while 27.52% do not participate but would
benefit from the 401(k) program. There are also 90.55% of non-eligible individuals
who would benefit from the program if they participate. In monetary terms, the 401(k)
program provides an average increase of $29.62k in FNFA to the 2,356 participants with
positive ITEs and an average decrease of $19.42k in FNFA to the 206 participants with
negative ITEs. That is a net increase of $65.7939 million in total in FNFA for the 401(k)
program based on our sample of 9,275 households.
25

0.04
0.03
0.02

Probability density function

0.04

0.00

0.00

0.01

0.02

Probability density function

0.06

0.05

0.06

Age percentile 0.25−0.5

0.08

Age percentile <0.25

0

10

20

30

40

−20

0

10

20

Estimated ITE

Age percentile 0.5−0.75

Age percentile >0.75

30

40

50

0.01

0.02

Probability density function

0.03

0.04
0.03
0.02

0.00

0.00

0.01

Probability density function

−10

Estimated ITE

0.04

−10

0.05

−20

0

20

40

60

−20

0

Estimated ITE

20

40

60

Estimated ITE

F IGURE 8. Estimated densities of ITE by age category
From Figure 11, about 93.12% of those who are eligible but do not participate in
401(k) programs have positive ITEs. How should one interpret this empirical evidence?
Do these eligible nonparticipants have low preference for savings, or low ability for
managing their financial assets? Our ITE estimates show that the average ITE for the
group of eligible nonparticipating households is $40.36k, which is significantly larger
than $25.68k, the average ITE of the participating group. This evidence suggests an
adverse selection issue: Households who benefit more are less likely to participate. To
shed some light on this second puzzling finding, Figure 12 provides density estimates
of the potential outcome φ̂0X (Y ) for not participating to the 401(k) program for the
participating group as well as the group of eligible nonparticipants. An interesting
feature is that the distribution of participants’ counterfactual FNFA (i.e., their savings
26

0.04
0.03
0.00

0.01

0.02

Probability density function

0.03
0.02
0.00

0.01

Probability density function

0.04

0.05

Family size>=3

0.05

Family size <3

−20

−10

0

10

20

30

40

50

−20

−10

0

Estimated ITE

10

20

30

40

50

Estimated ITE

F IGURE 9. Estimated densities of ITE by family size category
Married

0.03
0.00

0.00

0.01

0.02

Probability density function

0.04
0.02

Probability density function

0.06

0.04

0.08

Unmarried

−10

0

10

20

30

40

50

Estimated ITE

−20

0

20

40

60

Estimated ITE

F IGURE 10. Estimated densities of ITE by marital status category
without participating to 401(k) programs) are bimodal: Without participating to 401(k)
programs, those participants would either do quite well or extremely poorly on their
savings. In contrast, for the group of eligible but not participating households, the
FNFA conforms to a unimodal distribution.
Finally, we can consider the following counterfactuals: Given that we recover the
ITE for each individual, we can entertain a situation in which each eligible individual
chooses his/her best option regarding participation. The 401(k) program would lead to
a total increase of $116.4681 million in FNFA coming from the 2,356 eligible households
with positive ITEs and the 1,001 eligible households with positive ITEs who did not
27

TABLE 6. Summary statistics assorted according to ITE
Negative ITE Positive ITE Entire sample
Participation in 401(k)
0.2534
0.2784
0.2762
(0.4352)
(0.4482)
(0.4472)
FNFA (in thousand $)
21.9558
18.7946
19.0717
(113.9247)
(56.9039)
(63.9638)
Family income
30.5890
40.0872
39.2546
(in thousand $)
(16.8846)
(24.5117)
(24.0900)
Age
34.8327
41.6805
41.0802
(9.2949)
(10.1917)
(10.2995)
Married
0.5572
0.6354
0.6286
(0.4970)
(0.4813)
(0.4832)
Family size
2.6421
2.9084
2.8851
(1.4826)
(1.5280)
(1.5258)
Number
813
8,462
9,275

participate. In addition, if the 401(k) program was available to all households, under
the same scenario where each household is perfectly informed and make the correct
decision, the 401(k) program will gain an additional $120.8375 million in FNFA due
to those 5,105 non-eligible households with positive ITEs. This would lead to the
maximum gain of $237.3056 million in FNFA for the 401(k) program from the 9,275
households in our sample.

28

F IGURE 11. Classification Tree for 401(k) Participation Decisions
Whole sample: n = 9, 275

Eligible
3, 637

Not eligible
5, 638
Not Participate
1, 075

Participate
2, 562

Negative
206

Negative
74

Positive
1, 001

Negative
533

Positive
5, 105

0.08

Positive
2, 356

Not Participate
5, 638

Participants

0.04
0.00

0.02

Probability density function

0.06

Eligible nonparticipants

−20

0

20

40

60

FNFA(in thousands) of nonparticipation

F IGURE 12. Densities of potential outcome of nonparticipation

29

R EFERENCES
A BADIE , A. (2003): “Semiparametric instrumental variable estimation of treatment
response models,” The Journal of Econometrics, 113(2), 231–263.
A BADIE , A., J. A NGRIST, AND G. I MBENS (2002): “Instrumental variables estimates of
the effect of subsidized training on the quantiles of trainee earnings,” Econometrica,
70(1), 91–117.
A NDREWS , D. W. (1991): “Asymptotic normality of series estimators for nonparametric
and semiparametric regression models,” Econometrica, pp. 307–345.
A NGRIST, J., V. C HERNOZHUKOV, AND I. F ERNÁNDEZ -VAL (2006): “Quantile regression
under misspecification, with an application to the US wage structure,” Econometrica,
74(2), 539–563.
A NGRIST, J. D. (1990): “Lifetime earnings and the Vietnam era draft lottery: evidence
from social security administrative records,” The American Economic Review, pp. 313–
336.
A NGRIST, J. D., AND W. N. E VANS (1998): “Children and their parents’ labor supply:
evidence from exogenous variation in family size,” The American Economic Review,
88(3), 450–477.
C HERNOZHUKOV, V., AND C. H ANSEN (2004): “The Effects of 401(K) Participation on
the Wealth Distribution: An Instrumental Quantile Regression Analysis,” The Review
of Economics and Statistics, 86(3), 735–751.
(2005): “An IV model of quantile treatment effects,” Econometrica, 73(1), 245–261.
(2006): “Instrumental quantile regression inference for structural and treatment
effect models,” Journal of Econometrics, 132, 491–525.
(2008): “Instrumental variable quantile regression: A robust inference approach,”
Journal of Econometrics, 142(1), 379–398.
C HESHER , A. (2003): “Identification in nonseparable models,” Econometrica, 71(5),
1405–1441.
(2005): “Nonparametric identification under discrete variation,” Econometrica,
73(5), 1525–1550.

30

C HIAPPORI , P.-A., I. K OMUNJER , AND D. K RISTENSEN (2015): “Nonparametric identification and estimation of transformation models,” Journal of Econometrics, 188(1),
22–39.
D AROLLES , S., Y. FAN , J.-P. F LORENS ,

AND

E. R ENAULT (2011): “Nonparametric

instrumental regression,” Econometrica, 79(5), 1541–1565.
E NGEN , E. M., W. G. G ALE , AND J. K. S CHOLZ (1996): “The illusory effects of saving
incentives on saving,” The Journal of Economic Perspectives, 10(4), 113–138.
F ROELICH , M., AND B. M ELLY (2013): “Unconditional quantile treatment effects under
endogeneity,” Journal of Business & Economic Statistics, 31(3), 346–357.
G AGLIARDINI , P.,

AND

O. S CAILLET (2012): “Nonparametric instrumental variable

estimation of structural quantile effects,” Econometrica, 80(4), 1533–1562.
G UERRE , E., I. P ERRIGNE , AND Q. V UONG (2000): “Optimal Nonparametric Estimation
of First-Price Auctions,” Econometrica, 68(3), 525–574.
H ECKMAN , J. J., J. S MITH ,

AND

N. C LEMENTS (1997): “Making the most out of pro-

gramme evaluations and social experiments: Accounting for heterogeneity in programme impacts,” The Review of Economic Studies, 64(4), 487–535.
H ECKMAN , J. J., AND E. V YTLACIL (2005): “Structural equations, treatment effects, and
econometric policy evaluation1,” Econometrica, 73(3), 669–738.
H OROWITZ , J. L. (1996): “Semiparametric estimation of a regression model with an
unknown transformation of the dependent variable,” Econometrica, pp. 103–137.
H OROWITZ , J. L., AND S. L EE (2007): “Nonparametric instrumental variables estimation
of a quantile regression model,” Econometrica, 75(4), 1191–1208.
I MBENS , G. W.,

AND

J. D. A NGRIST (1994): “Identification and estimation of local

average treatment effects,” Econometrica, 62(2), 467–475.
I MBENS , G. W., AND W. K. N EWEY (2009): “Identification and estimation of triangular
simultaneous equations models without additivity,” Econometrica, 77(5), 1481–1512.
I MBENS , G. W., AND D. B. R UBIN (1997): “Estimating outcome distributions for compliers in instrumental variables models,” The Review of Economic Studies, 64(4), 555–574.
K OENKER , R., AND G. B ASSETT (1978): “Regression quantiles,” Econometrica, pp. 33–50.

31

K OENKER , R.,

AND

Z. X IAO (2002): “Inference on the quantile regression process,”

Econometrica, 70(4), 1583–1612.
M ARMER , V., AND A. S HNEYEROV (2012): “Quantile-based nonparametric inference for
first-price auctions,” Journal of Econometrics, 167(2), 345–357.
N ELSEN , R. B. (2007): An introduction to copulas. Springer Science & Business Media.
N EWEY, W. K.,

AND

J. L. P OWELL (2003): “Instrumental Variable Estimation of Non-

parametric Models,” Econometrica, 71(5), 1565–1778.
P OST, T., M. J. VAN

DEN

A SSEM , G. B ALTUSSEN ,

AND

R. H. T HALER (2008): “Deal

or no deal? decision making under risk in a large-payoff game show,” The American
Economic Review, pp. 38–71.
P OTERBA , J. M., S. F. V ENTI ,

AND

D. A. W ISE (1996): “How Retirement Saving Pro-

grams Increase Saving,” The Journal of Economic Perspectives, 10(4), 91–112.
R UBIN , D. B. (1974): “Estimating causal effects of treatments in randomized and
nonrandomized studies.,” Journal of Educational Psychology, 66(5), 688.
S AKIA , R. (1992): “The Box-Cox transformation technique: a review,” The statistician,
pp. 169–178.
S TONE , C. J. (1982): “Optimal global rates of convergence for nonparametric regression,”
The Annals of Statistics, pp. 1040–1053.
VAN D ER VAART, A. W., AND J. A. W ELLNER (1996): Weak Convergence. Springer.
V UONG , Q.,

AND

H. X U (forthcoming): “Counterfactual mapping and individual

treatment effects in nonseparable models with discrete endogeneity,” Quantitative
Economics.
V YTLACIL , E. (2002): “Independence, monotonicity, and latent index models: An
equivalence result,” Econometrica, 70(1), 331–341.

32

A PPENDIX A. P ROOFS
A.1. Proof of Lemma 1.
Proof. First, we differentiate Q0 (y0 , y1 ) with respect to y0 . Noting that ∂E|W − w|/∂w =
2FW (w) − 1 for a continuous distribution FW (·), we obtain

=


∂ 
E |Y − y0 |(1 − D )| X = x, Z = z
∂y0

∂
E |Y − y0 | D = 0, X = x, Z = z × P( D = 0| X = x, Z = z)
∂y0

= 2P(Y ≤ y0 ; D = 0| X = x, Z = z) − P( D = 0| X = x, Z = z).
Moreover, we have
E[sign(Y − y1 ) · D | X = x, Z = z]

= −2P(Y ≤ y1 ; D1 = 1| X = x, Z = z) + P( D = 1| X = x, Z = z).
It follows that
∂
Q0 (y0 , y1 ) = 2[P(Y ≤ y0 ; D = 0| X = x, Z = 0) − P(Y ≤ y0 ; D = 0| X = x, Z = 1)]
∂y0

+ 2[P(Y ≤ y1 ; D = 1| X = x, Z = 0) − P(Y ≤ y1 ; D = 1| X = x, Z = 1)]
= 2[ p( x, 1) − p( x, 0)] × [C0x (y0 ) − C1x (y1 )],
where the last step comes from the definition of Cdx in (4). Fix y1 ∈ R. Note that C0x (·) is weakly
o = S◦
increasing on R and strictly increasing on Cdx
by Theorem 1. Moreover, because
Y | D =0,X = x
o ,
p( x, 0) < p( x, 1),11 then Q0 (·, y1 ) has a weakly and strictly increasing derivative on R and Cdx
o , respectively, for
respectively. Therefore, Q0 (·, y1 ) is weakly and strictly convex on R and Cdx

arbitrary y1 ∈ R. Furthermore, if y1 ∈ SY◦| D=1,X = x , we have C0x (y0 ) = C1x (y1 ) if and only
if y0 = φ0x (y1 ) by Theorem 1. Thus, y0 = φ0x (y1 ) uniquely solves the first–order condition
∂
∂y0 Q0 ( y0 , y1 )

= 0 whenever y1 ∈ SY◦| D=1,X =x . A similar argument also applies to the population

objective function Q1 (y0 , ·).



A.2. Proof of Theorem 2.
11

When such a rank of p( x, z) is unknown, we can modify the objective function by Q̃0 (y0 , y1 ) =
[ p( x, 1) − p( x, 0)] × Q0 (y0 , y1 ). The additional term p( x, 1) − p( x, 0) changes the sign of Q̃0 (·, y1 ) based
on the relative rank of p( x, z) while its scale does not matter for the optimization of Q̃0 (·, y1 ).

33

Proof. Fix X = x. All the following argument is conditional on X = x. For simplicity, we
suppress the dependence on x, e.g., we use φd for φdx , omit the term 1( Xi = x ) in the estimation,
and X = x in the conditional probability P(Y ≤ y; D = d| X = x; Z = z). Moreover, we only
show the results for d = 0. The proof for the case d = 1 can be derived similarly.
First, we show uniform consistency. By Angrist, Chernozhukov, and Fernández-Val (2006), it
suffices to show that sup(y0 ,y1 )∈B k Q̂0 (y0 , y1 ) − Q0 (y0 , y1 )k = o p (1) for any compact set B ⊂ R2 .
By the law of large number, we have pointwise convergence, i.e., k Q̂0 (y0 , y1 ) − Q0 (y0 , y1 )k =
o p (1). Then, it suffices to show the stochastic equicontinuity of the empirical process ρ̂0 (·, ·; z) −
ρ0 (·, ·; z), which directly follows the general argument in Koenker and Xiao (2002). Next, we
establish the limiting distribution of the process.
Taking the directional derivative, we have
2 ∑in=1 1(Yi ≤ y0 ; Di = 0; Zi = 0) 2 ∑in=1 1(Yi ≤ y0 ; Di = 0; Zi = 1)
−
t ↓0
∑in=1 1( Zi = 0)
∑in=1 1( Zi = 1)
2 ∑in=1 1(Yi ≤ y1 ; Di = 1; Zi = 0) 2 ∑in=1 1(Yi ≤ y1 ; Di = 1; Zi = 1)
+
−
+ ξ n ( y0 ).
∑in=1 1( Zi = 0)
∑in=1 1( Zi = 1)

d
Q̂0 (y0 + t, y1 )
dt

=

where the remainder term ξ n (y0 ) is bounded by
n · ∑in=1 1(Yi = y0 )
.
∑in=1 1( Zi = 0) × ∑in=1 1( Zi = 1)
By the computational properties of linear programming in Koenker and Bassett (1978, Theorem
3.3), we have ξ n (y0 ) = O p (n−1 ) uniformly in y0 ∈ R. We can derive a similar expression for
d
dt Q̂0 ( y0

− t, y1 )

t ↓0

. Note that

d
dt Q̂0 ( φ̂0 ( y1 )

+ t, y1 )

t ↓0

≥ 0 and

d
dt Q̂0 ( φ̂0 ( y1 )

− t, y1 )

t ↓0

≥ 0 as

φ̂0 (y1 ) minimizes Q̂0 (·, y1 ). Hence, we have
∑in=1 1(Yi ≤ φ̂0 (y1 ); Di = 0; Zi = 0) ∑in=1 1(Yi ≤ φ̂0 (y1 ); Di = 0; Zi = 1)
−
∑in=1 1( Zi = 0)
∑in=1 1( Zi = 1)
∑nj=1 1(Yi ≤ y1 ; Di = 1; Zi = 0) ∑nj=1 1(Yi ≤ y1 ; Di = 1; Zi = 1)
+
−
= O p ( n −1 )
∑in=1 1( Zi = 0)
∑in=1 1( Zi = 1)
uniformly in y1 .
Following the convention, we introduce some notation from the empirical process literature:
For W = (Y, D, Z )0 and a generic function g, let En [ g(W )] = n−1 ∑in=1 g(Wi ) and Gn [ g(W )] =

34


n−1/2 ∑in=1 g(Wi ) − E[ g(Wi )] . Hence, the above condition can be rewritten as

√


n


En 1(Y ≤ φ̂0 (y1 ); D = 0; Z = 0) En 1(Y ≤ y1 ; D = 1; Z = 0)
+
En 1 ( Z = 0 )
En 1 ( Z = 0 )


√
En 1(Y ≤ φ̂0 (y1 ); D = 0; Z = 1) En 1(Y ≤ y1 ; D = 1; Z = 1)
− n
+
= o p (1)
En 1 ( Z = 1 )
En 1 ( Z = 1 )

uniformly in y1 ∈ R. It follows that

√

n
o
n E 1(Y ≤ φ̂0 (y1 ); D = 0; Z = 0) + 1(Y ≤ y1 ; D = 1; Z = 0)
En 1 ( Z = 0 )

√
−

n

n E 1(Y ≤ φ̂0 (y1 ); D = 0; Z = 1) + 1(Y ≤ y1 ; D = 1; Z = 1)

o

En 1 ( Z = 1 )


Gn 1(Y ≤ φ̂0 (y1 ); D = 0; Z = 0) + 1(Y ≤ y1 ; D = 1; Z = 0)
+
En 1 ( Z = 0 )


Gn 1(Y ≤ φ̂0 (y1 ); D = 0; Z = 1) + 1(Y ≤ y1 ; D = 1; Z = 1)
−
= o p (1).
En 1 ( Z = 1 )


Because En 1( Z = z) = P( Z = z) + O p (n−1/2 ), then by Taylor expansion,
1
1
1
=
− 2
× [En 1( Z = z) − P( Z = z)] + O p (n−1 ).
En 1 ( Z = z )
P( Z = z ) P ( Z = z )
Thus,

√
√

n
o
n E 1(Y ≤ φ̂0 (y1 ); D = 0; Z = z) + 1(Y ≤ y1 ; D = 1; Z = z)
En 1 ( Z = z )

n E 1(Y ≤ φ̂0 (y1 ); D = 0) + 1(Y ≤ y1 ; D = 1) Z = z
n
o G 1( Z = z )
n
− E 1(Y ≤ φ̂0 (y1 ); D = 0) + 1(Y ≤ y1 ; D = 1) Z = z ×
+ o p (1)
P( Z = z )
√

=
n E 1(Y ≤ φ̂0 (y1 ); D = 0) + 1(Y ≤ y1 ; D = 1) Z = z
n
o G 1( Z = z )
n
− E 1(Y ≤ φ0 (y1 ); D = 0) + 1(Y ≤ y1 ; D = 1) Z = z ×
+ o p (1)
P( Z = z )

=



where the last o p (1) term is uniform in y1 due to the uniform convergence of φ̂0 to φ0 .

35

(8)

Let ϕ(·, y1 ) = 1(Y ≤ ·; D = 0) + 1(Y ≤ y1 ; D = 1). Therefore, (8) implies

√


 √


n E ϕ(φ̂0 (y1 ), y1 )| Z = 0 − n E ϕ(φ̂0 (y1 ), y1 )| Z = 1




Gn ϕ(φ̂0 (y1 ), y1 ) × 1( Z = 0)
Gn ϕ(φ̂0 (y1 ), y1 ) × 1( Z = 1)
= −
+
En 1 ( Z = 0 )
En 1 ( Z = 1 )

+

E [ ϕ(φ0 (y1 ), y1 )| Z = 0]
E [ ϕ(φ0 (y1 ), y1 )| Z = 1]
× Gn 1 ( Z = 0 ) −
× Gn 1 ( Z = 1 ) + o p (1 ).
P( Z = 0)
P( Z = 1)

Note that E [ ϕ(φ0 (y1 ), y1 )| Z = z] = R1 (y1 ) which does not depend on z. Hence,

√


 √


n E ϕ(φ̂0 (y1 ), y1 )| Z = 0 − n E ϕ(φ̂0 (y1 ), y1 )| Z = 1




Gn ϕ(φ̂0 (y1 ), y1 ) × 1( Z = 1)
Gn ϕ(φ̂0 (y1 ), y1 ) × 1( Z = 0)
+
=−
En 1 ( Z = 0 )
En 1 ( Z = 1 )

+

R1 ( y1 )
R1 ( y1 )
× Gn 1 ( Z = 0 ) −
× Gn 1 ( Z = 1 ) + o p (1 ).
P( Z = 0)
P( Z = 1)

Moreover, the derivative of E [ ϕ(·, y1 )| Z = z] is the derivative of P(Y ≤ ·; D = 0| Z = z). Thus,
using (4) and the definition of c∗dx (·), a Taylor expansion gives

√

√

 √


n E ϕ(φ̂0 (y1 ), y1 )| Z = 0 − n E ϕ(φ̂0 (y1 ), y1 )| Z = 1 = c0∗ (φ̃0 (y1 )) × n [φ̂0 (y1 ) − φ0 (y1 )]

where φ̃0 (y1 ) is between φ0 (y1 ) and φ̂0 (y1 ). Note that c0∗ (φ̃0 (y1 )) = c0∗ (φ0 (y1 )) + o p (1) uniformly
in y1 . It follows that

√
[c0∗ (φ0 (y1 )) + o p (1)] × n [φ̂0 (y1 ) − φ0 (y1 )]




Gn ϕ(φ̂0 (y1 ), y1 ) × 1( Z = 0)
Gn ϕ(φ̂0 (y1 ), y1 ) × 1( Z = 1)
=−
+
En 1 ( Z = 0 )
En 1 ( Z = 1 )
R1 ( y1 )
R1 ( y1 )
+
× Gn [1( Z = 0)] −
× Gn [1( Z = 1)] + o p (1).
P( Z = 0)
P( Z = 1)
Because ϕ is Donsker, by the empirical process theorem (see e.g. Van Der Vaart and Wellner,
1996), we have the equicontinuity of the function class ϕ(·, ·). Hence, uniformly in y1 ,


Gn ϕ(φ̂0 (y1 ), y1 ) × 1( Z = z) = Gn [ ϕ(φ0 (y1 ), y1 ) × 1( Z = z)] + o p (1),

36

which converges to a zero-mean Gaussian process. Thus, we obtain

[c0∗ (φ0 (y1 )) + o p (1)] ×

√

n [φ̂0 (y1 ) − φ0 (y1 )]



1( Z = 0)
1( Z = 1)
−
+ o p (1)
= −Gn [ ϕ(φ0 (y1 ), y1 ) − R1 (y1 )] ×
P( Z = 0) P( Z = 1)

(9)

where the right–hand side converges to a zero-mean Gaussian process. Therefore, c0∗ (φ0 (·)) ×
√
n[φ̂0 (·) − φ0 (·)] converges in distribution to a zero-mean Gaussian process.
Its covariance kernel Σ0 (y, y0 ) for y ≤ y0 is obtained as
(

2 )


1
(
Z
=
0
)
1
(
Z
=
1
)
Σ0 (y, y0 ) = E [ ϕ(φ0 (y), y) − R1 (y)] × ϕ(φ0 (y0 ), y0 ) − R1 (y0 ) ×
−
P( Z = 0) P( Z = 1)
(

2 )
1( Z = 0)
1( Z = 1)
0
0
= E [ ϕ(φ0 (y), y) − R1 (y)] × ϕ(φ0 (y ), y ) ×
−
P( Z = 0) P( Z = 1)
(

2 )


1
(
Z
=
1
)
1
(
Z
=
0
)
−
= E ϕ(φ0 (y), y) − R1 (y) ϕ(φ0 (y0 ), y0 ) ×
P( Z = 0) P( Z = 1)

2


1( Z = 0)
1( Z = 1)
= R1 ( y ) − R ( y ) R1 ( y 0 ) × E
−
P( Z = 0) P( Z = 1)
where the second and third equalities use the definition of ϕ(φ0 (y1 ), y1 ), and the fourth equality
uses E [ ϕ(φ0 (y1 ), y1 )| Z = z] = R1 (y1 ). The expression for Σ0 (y, y0 ) given in the theorem follows
upon noting that
E

"

1( Z = 0)
1( Z = 1)
−
P( Z = 0) P( Z = 1)

2 #

=

1
. 
P( Z = 0)P( Z = 1)

A.3. Proof of Theorem 3.
Proof. We have fˆ∆ (δ) − f ∆ (δ) = [ fˆ∆ (δ) − f˜∆ (δ)] + f˜∆ (δ) − f ∆ (δ), where
1 n
∆i − δ 
f˜∆ (δ) =
K
, ∀δ ∈ [δ + h, δ − h],
∑
nh i=1
h
is the infeasible kernel estimator of f ∆ (δ). From standard kernel estimation, we have
sup
δ∈[δ+h,δ−h]

37

| f˜∆ (δ) − f ∆ (δ)| = O p h P



1

since h = (ln n/n) 2P+2 leads to oversmoothing. Thus, it suffices to show that the same uniform
convergence rate holds for | fˆ∆ (δ) − f˜∆ (δ)|. We actually show that

| fˆ∆ (δ) − f˜∆ (δ)| = o p h P

sup



δ∈[δ+h,δ−h]

so that the first step estimation error is negligible given our choice of bandwidth.
From a second-order Taylor expansion we have
1
fˆ∆ (δ) − f˜∆ (δ) =
nh2

n

∑ K0

i =1

∆i − δ  ˆ
1
( ∆i − ∆i ) +
h
2nh3

n

∑ K00

i =1

∆i† − δ  ˆ
( ∆ i − ∆ i )2
h

ˆ i and ∆i . Since sup |∆
ˆ i − ∆i | = O p (n−1/2 ) from Theorem 3, we have
where ∆i† is between ∆
i
1
1 n
∆i − δ  ˆ
∆i − δ 
( ∆ i − ∆ i ) ≤ O p ( n − 2 h −1 ) ×
K0
∑
h
nh i=1
h
i =1
R
where the summation is a nonparametric estimator of f ∆ (δ) × |K 0 (u)|du. Therefore,

1
nh2

n

∑ K0

1
1 n 0 ∆i − δ  ˆ
K
(∆i − ∆i ) = O p (n− 2 h−1 ) = O p (h P /(ln n)1/2 )
∑
2
nh i=1
h

which is an o p h P . Furthermore, because K 00 is bounded, we have

1
nh3
which is also an o p h


P

n

∑ K00

i =1

∆i† − δ  ˆ
( ∆ i − ∆ i )2 = O p ( n −1 h −3 )
h

provided P ≥ 1. Therefore, the first-step estimation error is negligible.



38

