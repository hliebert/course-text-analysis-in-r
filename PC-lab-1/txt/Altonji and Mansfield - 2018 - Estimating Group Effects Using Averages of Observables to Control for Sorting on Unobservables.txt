American Economic Review 2018, 108(10): 2902–2946
https://doi.org/10.1257/aer.20141708

Estimating Group Effects Using Averages of Observables
to Control for Sorting on Unobservables: School and
Neighborhood Effects†
By Joseph G. Altonji and Richard K. Mansfield*
We consider the classic problem of estimating group treatment
effects when individuals sort based on observed and unobserved
characteristics. Using a standard choice model, we show that controlling for group averages of observed individual characteristics
potentially absorbs all the ­across-group variation in unobservable
individual characteristics. We use this insight to bound the treatment
effect variance of school systems and associated neighborhoods for
various outcomes. Across multiple datasets, we find that a ninetieth versus tenth percentile school/neighborhood increases the high
school graduation probability and college enrollment probability
by at least 0.04 and 0.11 and permanent wages by 13.7 percent.
(JEL C51, H75, I21, I26, J24, J31, R23)
Society is replete with contexts in which (i) a person’s outcome depends on both
individual and ­group-level inputs, and (ii) the group is endogenously chosen either
by the individuals themselves or by administrators, partly based on the individual’s
own inputs. Examples include health outcomes and hospitals, earnings and workplace characteristics, and test scores and teacher v­ alue-added.1 Generations of social
scientists have studied whether group outcomes differ because the groups influence
individual outcomes or because the groups have attracted individuals who would
* Altonji: Department of Economics, Yale University, PO Box 208264, New Haven, CT 06520 (email: joseph.
altonji@yale.edu); Mansfield: Department of Economics, University of Colorado-Boulder, 04B Economics Building,
Boulder, CO 80309 (email: richard.mansfield@colorado.edu). This paper was accepted to the AER under the guidance
of Luigi Pistaferri, Coeditor. We thank Steven Berry, Gary Chamberlain, Greg Duncan, Phil Haile, Hidehiko Ichimura,
Amanda Kowalski, Costas Meghir, Richard Murnane, Jonah Rockoff, Douglas Staiger, Jonathan Skinner, Shintaro
Yamiguchi, and four anonymous referees as well as seminar participants at CEMFI, Cornell, Dartmouth, Duke,
the Federal Reserve Banks of Chicago and Cleveland, McMaster, the NBER Economics of Education Conference,
Melbourne, Monash, Northwestern, the Paris School of Economics, the Stockholm School of Economics, the London
School of Economics, Stanford, University of Colorado-Boulder, University of Colorado-Denver, University of
Illinois Urbana-Champaign, University of Illinois-Chicago, University of New South Wales, University of Sydney,
UTS, University of Western Ontario, and Yale for helpful comments and discussions. This research uses data from the
National Center for Education Statistics as well as from the North Carolina Education Research Data Center at Duke
University. We acknowledge both the US Department of Education and the North Carolina Department of Public
Instruction for collecting and providing this information. We also thank the Russell Sage Foundation and the Yale
Economics Growth Center for financial support. A portion of this research was conducted while Altonji was a visitor
at the LEAP Center and the Department of Economics, Harvard University.
†
Go to https://doi.org/10.1257/aer.20141708 to visit the article page for additional materials and author
disclosure statement(s).
1
Ash et al. (2012) provide an overview of the issues involved in assessing hospitals. Doyle Jr. et al. (2015) also
discuss the issues and provide a short literature survey. See Chetty, Friedman, and Rockoff (2014) and Rothstein
(2014) for discussions and references related to the estimation of teacher ­value-added.
2902

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2903

have thrived regardless of the group chosen. In some cases, sources of exogenous
variation are available that may be used to assess the consequences of a particular
group treatment. However, assessment of the overall distribution of group treatments is much more difficult, and researchers and governments frequently rely on
­non-experimental estimators of group treatment effects (e.g., school report cards
and teacher ­value-added).
In this paper, we show that in certain circumstances the tactic of controlling for
group averages of observed ­individual-level characteristics, generally thought to
control for “sorting on observables” only, will absorb all of the ­between-group variation in both observable and unobservable individual inputs. We then show how this
insight can be used to estimate a lower bound for the variance in the contributions
of ­group-level treatments to individual outcomes. We also provide conditions under
which causal effects of particular observed group characteristics can be estimated. A
key message of the paper is that in some cases one can address the effects of sorting
on unobservables using multivariate regression, without having to fully specify and
estimate the model of group choice in addition to the model of outcomes.
We apply our methodological insight and demonstrate its empirical value by
addressing a classic question in social science: how much does the school and surrounding community that we choose for our children matter for their ­long-run educational and labor market outcomes?
To illustrate the sorting problem, consider the following simplified production
function relating education outcomes to individuals’ characteristics and the inputs
of the schools/neighborhoods they choose. Let ​​Ys​i​​​denote the outcome (e.g., attendance at a ­four-year college) of student ​i​who attends and lives near school ​s​.2
Suppose that ​​Y​si​​​is determined by
U
(1)	​
​Ys​i​​  = [ ​Xi​ ​​ β + ​x​  U
i​  ​  ] + [ ​Zs​​​  Γ + ​z​  s​  ​  ] .​

The vector ​X
​ ​i​​​is a set of student and family characteristics observed by the econoU
X​  U
metrician (with corresponding productivities ​β​), while ​​x​  U
i​  ​ ≡ ​
i​  ​ ​β​​  ​​is a scalar
index that combines the contributions of unobserved student and family characteristics ​​X​ Ui​  ​​to the outcome. Together, ​[ ​X​i​​, ​X​ Ui​  ​  ]​represent the complete set of student
and family characteristics that have a causal impact on student i​ ​’s educational attainment. Analogously, the row vector ​Z
​ s​​​​is a set of school and neighborhood characteristics observed by the econometrician (with corresponding productivities ​Γ​), while​​
ZU​  s​  ​ ​Γ​​  U​​is a scalar index that combines the effects of unobserved school and
z​  U
s​  ​ ≡ ​
neighborhood characteristics. Together, ​[ ​Zs​ ​​, ​ZU​  s​  ​  ]​capture the complete set of school
and neighborhood-level influences common to students who live in s​ ​ , so that the
school/neighborhood treatment effect is given by ​[ ​Zs​​​  Γ + ​z​  U
s​  ​  ]​.
Sorting leads the school average of ​​X​ Ui​  ​​ , denoted ​​XU​  s​  ​​ , to vary across ​s​. This contaminates estimates of ​Γ​ and fixed effect estimates of the school treatment effect​​
Z​s​​  Γ + ​z​  U
s​  ​​. While various studies have included controls for ­group-level averages of
2
Despite the growing popularity of open enrollment systems, most school choice is still mediated through
choice of community in which to live, and most students still choose schools close to home even when given
the opportunity to attend more distant schools. Thus, we aim instead to measure the importance of the combined
school/neighborhood choice.

2904

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

individual observables (denoted ​​Xs​​​​), the role played by such controls in mitigating
sorting bias has been underappreciated.
Our key insight follows directly from the parent’s school/neighborhood choice
decision: as schools get large, average values of student characteristics differ across
schools only because students/families with different characteristics value school or
neighborhood amenities differently. This means that ­school-averages of individual
characteristics such as parental education, family income, and athletic ability will
be functions of the vector of amenity factors (denoted ​​As​​​​) that parents consider
​ U​  s​  ​​will be
when making their school choices. Thus, the school averages ​X
​ s​​​​and ​X
different v­ ector-valued functions of the same common set of amenities: ​​Xs​​​  = f(​As​​​)​
and ​X
​ U​  s​  ​ = ​f​​  U​  (​As​​​)​. The functions ​f​ and ​f​ ​​  U​​are determined by the sorting equilibrium
and reflect the equilibrium prices of the amenities. If the dimension of the amenity
space is smaller than the number of observed characteristics, then under certain conditions one can invert this v­ ector-valued function to express the amenities in terms
of s­ chool-averages of observed characteristics: ​A
​ ​s​​  = ​f​​  −1​  (​Xs​​​)​. But this implies that
the vector of school averages of unobserved characteristics can also be written as a
​ s​​​​ can
function of observed characteristics: ​X
​ U​  s​  ​  = ​f​​ U​  (​f​​  −1​  (​Xs​​​  ))​. This function of ​X
U
serve as a control function for ​​X​  s​  ​​when estimating group effects.
We formalize this intuition by introducing a multidimensional spatial equilibrium
model of neighborhood/school choice and providing conditions under which the
​ U​  s​  ​​is exact. Under our full set of assumptions (most notably
mapping from ​X
​ s​​​​to ​X
​ U​  s​  ​​ is linear.
an additively separable specification of utility) the mapping from ​X
​ ​s​​​to ​X
When these conditions are satisfied, including ​X
​ ​s​​​in a linear regression of the outcome ​​Y​si​​​fully controls for ​​XU​  s​  ​​.
While this control function approach potentially solves the ­
sorting-onunobservables problem, the observed group averages ​​X​s​​​control for too much. They
will absorb peer effects that depend on ​​X​s​​​ and/or ​​XU​  s​  ​​. They will also absorb a part
of the unobserved school/neighborhood quality component that is both orthogonal
to the observed school characteristics and correlated with the amenities that families
consider when choosing where to live. As a result, without further assumptions, our
estimator will only place a lower bound on the variance of the overall contribution of
schools/neighborhoods to student outcomes. However, the fact that controlling for
the group averages eliminates bias from sorting implies that the causal effects (​Γ)​ of
particular school inputs or policies (in ​​Zs​​​​) can be point identified in situations where
bias from omitted neighborhood/school characteristics in ​z​ ​  U
s​  ​​is not a problem or can
be addressed through a complementary instrumental variables scheme.
The empirical part of the paper applies the control function approach in the school
choice context. Implementation requires rich data on student characteristics for large
samples of students from a large sample of schools, as well as l­onger-run outcomes
for these students. We use four different datasets that generally satisfy these conditions: three ­cohort-specific panel surveys (the National Longitudinal Study of 1972
(NLS72), the National Educational Longitudinal Survey of 1988 (NELS88), and the
Educational Longitudinal Survey of 2002 (ELS2002)), along with administrative
data from North Carolina.
For each dataset, we provide lower bound estimates of the overall contribution of
differences between school systems and associated neighborhoods to the variance
in student outcomes: high school graduation, enrollment in a f­ our-year college, and

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2905

adult wages (NLS72 only). To make our estimates easier to interpret, we also convert each variance estimate into a lower bound estimate of the expected impact on
the chosen outcome of starting at a school system and associated neighborhood at
the tenth quantile in the distribution of school contributions instead of a fiftieth or
ninetieth quantile system.
Even our most conservative North Carolina results suggest that, averaging across
the student population, choosing a ninetieth quantile school and surrounding community instead of a tenth quantile school increases the probability of graduation
by at least 7.9 percentage points. In the NELS88 and ELS2002, the corresponding
estimates are 4.8 and 4.1 percentage points, respectively, although these may be less
reliable due to sampling error in school average characteristics. The North Carolina,
NELS88, and ELS2002 estimates are 15.3, 12.8, and 6.2 percentage points, respectively, when we also consider unobserved differences in quality. We estimate large
average impacts despite the fact that our most conservative estimates only attribute ­1–2 percent of the total variance in the latent index determining graduation
to schools/neighborhoods. However, the average impact of moving to a superior
school on binary outcomes such as high school graduation or college enrollment can
be quite large even if differences in school quality are small, as long as a large pool
of students are near the decision margin.
Estimates of the impact of a shift in school environment on the probability of
enrolling in a f­ our-year college are similarly large: choosing a ninetieth instead of
a tenth quantile school and surrounding community increases the probability of
­four-year college enrollment by at least 1­ 1–14 percentage points across all three survey datasets. It would increase the permanent component of adult wages by at least
13.7 percent (in NLS72). A 1­ standard deviation shift in school/neighborhood quality would raise wages by at least 5.1 percent, or 0.16 standard deviations. Note that
our estimates are derived from a static model of what is in fact a dynamic process.
The most conservative interpretation is that our estimates represent lower bounds
on the cumulative effects of growing up in different school systems/neighborhoods.
The methodological part of the paper draws on and contributes to a number
of literatures. First, the basic idea that observed choices reveal information about
­choice-relevant factors unobserved by the econometrician has been utilized in a number of settings, including the estimation of firm production functions (e.g., Olley and
Pakes 1996; Levinsohn and Petrin 2003; and Ackerberg, Caves, and Frazer 2015,
among others), labor supply functions (e.g., Altonji 1982), distinguishing between
uncertainty and heterogeneity in earnings (e.g., Cunha, Heckman, and Navarro 2005),
and even estimating neighborhood effects (Bayer and Ross 2009).3 Our application
is unusual in that the control function involves group aggregates that reflect individual choices rather than relationships among different choices by the same agent.4
3
Our econometric approach is only loosely related to the large literature on the use of control functions to
estimate triangular systems with continuous or discrete treatment variables. In that literature, model assumptions
relating to how the endogenous treatment variable and outcome of interest are determined imply that a function of
the endogenous variable and an instrument or set of instruments can control for the source of endogeneity in the
equation for Y
​ ​. See Imbens (2007) for a survey. In our case, there is no instrument, but the sorting model implies a
relationship between observable and unobservable group averages.
4
Our estimation strategy is also closely related to the correlated random effects approach (Mundlak 1978;
Chamberlain 1980, 1984). In that literature, a function of the vector of observations on ​X
​ i​​​​from members of group​
s​is used to control for correlation between ​X
​ i​​​​and the group error term. In many applications the mean ​X
​ s​​​​is used.

2906

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

Second, we draw on the rich theoretical and empirical literature on equilibrium
sorting and matching models across several fields, including marriage markets
(Browning, Chiappori, and Weiss 2014 and Chiappori and Salanié 2016), labor markets (Lise, Meghir, and Robin 2013; Melo 2018; and Lindenlaub 2017), and product markets (Rosen 1974; Ekeland, Heckman, and Nesheim 2004; and Heckman,
Matzkin, and Nesheim 2010).
Most directly relevant is the large literature on sorting across neighborhoods and
schools that grew out of Tiebout (1956), particularly Epple and Platt (1998), Epple
and Sieg (1999), and Bayer and Timmins (2005). Epple and Platt’s model features
one dimension of neighborhood quality and two dimensions of heterogeneity across
households: income and tastes for the public good. They show that in equilibrium
the distributions of income and tastes both shift with the level of the public good
in a location. This implies a mapping between income in a location and tastes in a
location: the same type of mapping that we exploit. Bayer and Ross (2009) consider
the implications of Epple and Platt’s analysis for dealing with sorting on unobservables when estimating the effects of school and neighborhood characteristics on
outcomes. They assume neighborhood quality depends on a vector of observed characteristics (​​Zs​​​​in our notation) and a one-dimensional unobservable. They use housing prices to construct a control function for the unobservable. They recognize that
both the control function and ​Z
​ ​s​​​are endogenous in the outcome equation because
of sorting on ​X
​ ​ Ui​  ​​.5 However, the estimation scheme that they propose to address the
issue is invalid in the presence of unobserved heterogeneity in location preferences
and multiple unobserved location amenities.
Third, our formulation of the school/location choice problem is standard in the
consumer choice literature. It assumes that preferences for observed and unobserved
location characteristics depend on both observed and unobserved student/parent
attributes, as in McFadden (1978, 1984) and Berry (1994) and many subsequent
papers. Bayer, Ferreira, and McMillan (2007) use a similar specification to estimate
models of housing demand. We do not estimate preferences. Our contribution is to
show that the sorting on observables and unobservables implied by multinomial
choice models and hedonic demand models implies that group averages of observables can serve as a control for group averages of unobservables in the estimation of
group treatment effects.
The empirical part of the paper adds to a vast literature on school and neighborhood effects that we cannot do justice to here.6 Our analysis of sorting is directly
However, in that literature, much of the focus is on estimating the effects of person-specific ­variables, such as ​β​ in
our application, while accounting for correlation with a common group error. In our application, the focus is on the
group effect, a model of sorting provides the justification for the use of ​X
​ s​​​​as a control, and ​β​ is not identified. Our
analysis is also completely distinct from that of Altonji, Elder, and Taber (2005). They examine the econometric
implications of how observed variables are drawn from the full set of variables that determine the outcome and the
treatment variable of interest.
5
The idea that the choice of a location, an occupation, a firm, or a school may reveal information about individuals provides motivation for the use of fixed effects estimation in a variety of contexts, including Fu and Ross
(2013) in the neighborhood context.
6
Jencks and Mayer (1990) provide a comprehensive review of earlier studies from economics and sociology.
They conclude that there is no strong evidence for neighborhood effects. However, some of the studies they summarize do find effects. More recent reviews include Sampson, Morenoff, and ­Gannon-Rowley (2002); Durlauf (2004);
Harding et al. (2011); and Graham (2018). Duncan and Murnane (2011) contains several recent papers on school
and neighborhood effects. Meghir and Rivkin (2011) discuss alternative approaches to estimating school treatment
effects and the effects of particular school inputs.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2907

relevant to the large number of papers that study group effects using regression
­models with both individual- and g­ roup-level characteristics. A few recent papers
have employed experimental or ­quasi-experimental strategies to isolate the contribution of either schools or neighborhoods to longer-run student outcomes. Oreopoulos
(2003) and Jacob (2004) use q­ uasi-random assignment of neighborhood in the wake
of housing project closings to estimate the magnitude of neighborhood effects on
student outcomes. Similarly, the Moving To Opportunity (MTO) experiment, evaluated in Kling, Liebman, and Katz (2007), randomly assigned housing vouchers
that required movement to a lower poverty neighborhood to estimate neighborhood
effects. None of these studies find much evidence that moving to a ­low-poverty
neighborhood improves economic outcomes. However, Chetty, Hendren, and Katz
(2016) revisit the MTO experiment using Internal Revenue Service data on later
outcomes, including earnings, college attendance, and single parenthood. Their
­treatment-on-the-treated estimates indicate that children who move to a lower poverty neighborhood when they are under age 13 experience large gains in annual
income in their ­mid-twenties, while those who move after age 13 experience no gain
or a loss. Their estimates of treatment effects on adult earnings also increase with
the number of years of exposure to a lower poverty neighborhood. Using a sibling
differences approach that also exploits high quality data from tax records, Chetty
and Hendren (2018) identify ­county-level neighborhood effects on earnings that
are similar to our results. Aaronson (1998) finds substantial effects of the census
­tract-level poverty rate and high school dropout rate on dropout rates and years of
education using a sibling differences design and Panel Study of Income Dynamics
(PSID) data.
Deming et al. (2014), in contrast, exploit randomized lottery outcomes from the
school choice plan in the ­Charlotte-Mecklenburg district to estimate the impact of
winning a lottery to attend a chosen public school on high school graduation, college enrollment, and college completion. They find large effects for students from
low-quality urban schools. Angrist et al. (2016) also use admissions lotteries and
find positive effects of attending a Boston charter high school on test scores and
attendance at f­our-year colleges relative to ­two-year colleges. On the other hand,
Cullen, Jacob, and Levitt (2006) use a similar identification strategy with lotteries in Chicago Public Schools and find little effect on the high school graduation
probability.
In contrast to these papers, we do not exploit any natural experiments. Instead,
we show that rich observational data of the type collected by either panel surveys or
administrative databases can nonetheless yield meaningful insights about the importance of school and neighborhood choices for children’s later educational and labor
market performance.
The rest of the paper proceeds as follows. Section I presents our model of
school choice, while Section II formally derives our key control function result. In
Section III we elaborate on the model for long-run outcomes presented above, and
show that OLS estimates combined with restrictions implied by our model of sorting
are sufficient to place a lower bound on the variance of school and neighborhood

2908

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

effects. Section IV describes how we use this result to estimate lower bounds on
school and neighborhood effects. Section V describes the four datasets we use to
estimate the model of outcomes. Section VI presents our results. Section VII closes
the paper with a brief summary and discussion of other applications of our methodology, including the assessment of teacher value-added.
I. A Multinomial Model of School Choice and Sorting

In this section we present a model of how families choose school systems and
associated neighborhoods. Throughout the paper, matrices, vectors, and matrix- or
­vector-valued functions are in bold. The “prime” symbol denotes matrix or vector
transposes.
We adopt a ­money-metric representation of the expected utility the parents of
student i​​receive from choosing school/neighborhood s​ ​ , so that the utility function​​
V​i​​  (s)​can be interpreted as the family’s consumer surplus from their choice. We
assume ​​V​i​​  (s)​takes the following linear form:
(2)	​
​V​i​​  (s) = ​Wi​​​ ​As​​​  + ​ε​si​​  − ​P​s​​  .​
In the equation above, ​​A​s​​  ≡ [ ​A1​s​​,  … , ​AK​ s​​]​′ represents a vector of ​K​underlying latent
amenities that characterize each location s​ ∈ {1,  .  .  . , S}​. ​​W​i​​  ≡ [​W1​i​​,  … , ​WK​ i​​  ]​ is a​
1 × K​vector of weights that captures the increases in family i​​’s willingness to pay
for a school per unit increase in each of its ​K​amenity factors ​​A​1s​​,  … , ​AK​ s​​​  , respec​ ​si​​​ is
tively. ​P
​ s​​​​is the price of living in the neighborhood surrounding school s​ ​ , and ​ε
an idiosyncratic taste of the parent/student i​​for the particular location s​ ​.
Consider projecting willingness to pay (WTP) for particular amenities across families onto the families’ observable (​​X​i​​​) and unobservable
(​​X​ Ui​  ​​  ) characteristics. In particular, suppose that ​​Xi​​​​has ​L​elements, while ​​X​ Ui​  ​​has ​​L​​  U​​
elements. Then we obtain
(3)	​
​W​i​​  = ​X​i​​  Θ + ​X​ Ui​  ​ ​Θ​​  U​ + ​Qi​​​ ​Θ​​  Q​  ,​
where ​Θ​ (​​Θ​​  U​​) is an ​L × K​ (​​L​​  U​  × K​  ) matrix whose ​ℓk​-th entry captures the extent
to which the willingness to pay for the k​ -​ th element of the amenity vector ​A
​ ​s​​​ varies
with the ​ℓ​-th element of ​​X​i​​​ (​​X​ Ui​  ​​  ). We sometimes refer to the elements of ​Θ​ and​​
​ ​i​​​consists of additional individual
Θ​​ U​​as WTP coefficients. The 1​ × ​L​​  Q​​vector ​Q
characteristics (observed and unobserved) that affect WTP in accordance with the
WTP coefficient matrix ​​Θ​​  Q​​. ​​Qi​​​​is defined to be uncorrelated with [​ ​Xi​​​, ​X​ Ui​  ​  ]​. Since
​[ ​Xi​​​, ​X​ Ui​  ​  ]​is the complete set of student attributes that determine ​​Y​si​​​ , the characteristics that contribute to ​​Q​i​​​influence school choice but have no direct effect on student
outcomes.
Substituting (3) into (2), we obtain
(4)	​
​Vi​​​  (s) = (​Xi​​​  Θ + ​X​ Ui​  ​ ​Θ​​  U​ + ​Qi​​​ ​Θ​​  Q​  ) ​As​​​  + ​ε​si​​  − ​P​s​​​.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2909

In the absence of restrictions on the elements of ​Θ​ and ​​Θ​​  U​​ , this formulation of
utility allows for a very general pattern of relationships between different student
characteristics (observable or unobservable) and tastes for different school/neighborhood amenities, subject to the additive separability assumed in (2).
Expected utility is taken with respect to the information available when ​s​ is
­chosen. The information set includes the price and the amenity vector in each
school/neighborhood as well as student/parent characteristics ​[ ​Xi​​​, ​X​  U
i​  ​, ​Qi​​​  ]​ and
the values of ​​ε​si​​​  , ​s = 1, … , S​. The information set excludes any local shocks that
are determined after the start of secondary school. It also excludes components of
neighborhood and school quality that are not observable to families when a location
is chosen. Some of the elements of ​​As​​​​may depend on school/neighborhood characteristics ​Z
​ s​​​​that influence educational attainment and labor market outcomes. The
amenities may also include or depend on aspects of the demographic composition
of the school/neighborhood. Some determinants of amenities (such as spending per
pupil) may be influenced by demographic composition. Thus, some of the amenities
are influenced by the sorting equilibrium.
The parents of ​i​choose ​s​if net utility ​​Vi​​​  (s)​is the highest among the ​S​ options.
That is,
​ ​ ​V​i​​  (s)​.
	​
s(i ) = ​arg max​
s=1, … , S

Parents behave competitively in the sense that prices and ​A
​ ​s​​​are taken as given, and
choice is unrestricted. In equilibrium the values of some elements of ​A
​ ​s​​​may in
​ ​ Ui​  ​​for the parents who choose s​ ​ , but parents
fact depend on the averages of ​​X​i​​​and ​X
ignore the externalities that they are imposing on others.
II. The Link between Group Observables and Group Unobservables

In Section IIA we state Proposition 1, which concerns the relationship between​​
X​ Us​  ​​and ​​X​s​​​implied by the choice model above. The proof is supplied in Appendix A.
In Section IIB we discuss the proposition and the assumptions that underlie it.
A. Proposition 1: ​​XU​  s​  ​​Is a Linear Function of ​​Xs​​​​
Before stating Proposition 1, we need to define more notation. Decompose ​​X​ Ui​  ​​
​ ̃ ​​ Ui​  ​​,7
into its projection on ​​X​i​​​and the orthogonal component ​​X
(5)	​
​X​ Ui​  ​ = ​Xi​​​ ​Π​X
​ ​​  U​X​​  + ​​X ​​ ̃ Ui​  ​​.

Use (5) to rewrite (3) as ​W
​​i​​  = ​X​i​​ ​Θ̃ ​+ ​​X̃ ​​ Ui​  ​ ​Θ​​  U​ + ​Q​i​​ ​Θ​​  Q​​  , where
U
̃
​​Θ ​ = [Θ + ​Π​​X​​  U​X​​ ​Θ​​  ​  ]​. In the rewritten form, all three components of ​​Wi​​​​ are
­mutually orthogonal. We are now prepared to present the main proposition of the
paper.
7
We use the symbol ​​ΠDV
​ ​​​to denote the vector or matrix of the partial regression coefficients relating a dependent
variable or vector of dependent variables ​D​ to a vector of explanatory variables ​V​ , holding the other variables that
appear in the regression constant. In the case of ​​Π​X
​ ​​  U​X​​​  , ​D = ​X​ Ui​  ​​and ​V = ​Xi​​​​.

2910

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

PROPOSITION 1: Assume the following assumptions hold.
ASSUMPTION A1: Preferences are given by (4).
ASSUMPTION A2: Parents take ​​Ps​​​​and ​​As​​​​as given when choosing location, and
face a common choice set.
ASSUMPTION A3: The idiosyncratic preference components ​ε​ ​si​​​have a mean of 0​ ​
and are independent of ​​X​i​​​, ​​X​  U
i​  ​,​ ​​Q​i​​​​,​and ​​As​​​​ for all ​s​.
​ i​​​​.
ASSUMPTION A4: ​E(​Xi​​​  | ​Wi​​​  )​and ​E( ​X​ Ui​  ​  | ​Wi​​​  )​are linear in ​W
ASSUMPTION A5 (Spanning Assumption): The row space of the WTP coefficient
matrix ​​Θ̃ ​​spans the row space of the WTP coefficient matrix ​Θ
​ ​​  U​​relating tastes for​
U
A​to ​X
​ ​  i​  ​​. That is,
(6)	​
​Θ​​  U​  = R​Θ̃ ​​

for some ​​L​​  U​  × L​ matrix ​R​.
Then the expectation ​​XU​  s​  ​​ is linearly dependent on the expectation ​​Xs​​​​. Specifically,
​ ​​  U​X​​  + Var ​(​Xi​​​  )​​  −1​​R′ ​  Var(​​X̃ ​​ Ui​  ​  )]​.
(7)	​
​XU​  s​  ​ = ​Xs​​​  [ ​Π​X
B. Discussion of Proposition 1
Proposition 1 lays out the conditions under which ​​XU​  s​  ​​ , the between group component of the vector of i­ ndividual-level unobservables, will be an exact linear function
of its observable counterpart ​X
​ s​​​​.8 Remarkably, the dependence between the group
U
averages ​​X​  s​  ​​and ​​X​s​​​arises even when the vector ​​X​ Ui​  ​​is uncorrelated with the vector​​
X​i​​​at the individual level. Note also that if ​​Θ​​  U​  = 0​so that unobservable characteristics do not affect amenity preferences (i.e., individuals do not sort based on
unobservables), then ​R = 0.​ When ​R = 0,​ (7) states that ​​XU​  s​  ​ = ​Xs​​​ ​Π​X​ ​​  U​X​​​  , which
​ ̃ ​​ Ui​  ​​for group s​ ​. As we discuss
implies that ​​​X̃ ​​ Us​  ​​ ​=​ ​0​ , where ​​​X̃ ​​ Us​  ​​is the expectation of ​​X
in Section VIE, this fact means that if sorting is driven by ​​Xi​​​​but not ​​X​ Ui​  ​​ , one can
estimate the variance in group treatment effects ​Var(​Zs​​​  Γ + ​z​  U
s​  ​  )​.
​ ​  U
Note that the effectiveness of ​X
​ ​s​​​as a control function for ​X
s​  ​​stems from the fact
​ ​s​​​to ​​X​  U
that sorting creates a mapping from ​X
​ s​​​​to ​​A​s​​​and from ​A
s​  ​​ , leading to (7). The
U
​ s​​​​ , not that ​X
​ i​​​​affects the outcome​​
key is that both ​​X​i​​​and ​​X​  i​  ​​shift preferences for ​A
Y​i​​​. Because ​​Q​i​​​also shifts preferences for ​​As​​​​ , one may easily extend Proposition 1
so that the control vector, say ​​C​  ∗s​  ​​ , includes both ​​Xs​​​​and school averages of observed
∗
​ ​  U
elements of ​Q
​ ​i​​​. In addition, because ​X
s​  ​​is a function of ​​As​​​​in equilibrium, ​​C​  s​  ​​ might
8
In Altonji and Mansfield (2014), we consider a version of the school choice model in which (i) we ignore the
idiosyncratic ­school-family taste match by setting ​​ε​si​​  = 0 ∀ (s, i)​  , and (ii) we assume that ​S​is large enough to
be well approximated by a continuum of neighborhoods that create a continuous joint distribution of amenities A
​ ​.
Perhaps surprisingly, equation (7) in Proposition 1 holds for the continuous case.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2911

directly include flexible functions of some of the amenities ​​A​s​​​themselves for which
measures are available. The price ​​Ps​​​​depends in part on ​​As​​​​and could be included,
as Bayer and Ross (2009) suggest. In principle ​​C​  ∗s​  ​​could even include functions of
observed school policies or productive inputs (elements of ​Z
​ s​​​​ below) as long as they
​ s​​​​). If observed
were fully determined by ​A
​ s​​​​ (possibly through school composition ​X
school policies or inputs contain a pure school component, then including them in
the control function will lead to even more conservative lower bounds on the variance in treatment effects across schools.9 In our empirical work we only include in
our control function observed student variables that plausibly affect student outcomes. Thus, to conserve notation we continue to refer to the control function as ​X
​ ​s​​​
∗
rather than ​C
​ ​  s​  ​​ , but this is without loss of generality.
Note also that Proposition 1 is a statement about the expectations ​​X​s​​​and ​​X​  U
s​  ​​.
​ ​  U
​ i ​​when the number of individuals is
Thus, it concerns the averages of ​X
​ ​i​​​and ​X
large relative to the number of choices. With a finite number of individuals per
group, random variation will cause group averages at a point in time to deviate
from their expectations. This could weaken the link between group averages of
observable and unobservable characteristics. Monte Carlo simulations in online
Appendix A6 indicate that the control function also works well even when the
ˆ ​​s​​​) based on
expectation ​​X​s​​​is estimated using sample averages (which we denote ​​​X
small samples of group members rather than the full school population. In Section
V and online Appendix A11, we use the North Carolina administrative data to
directly assess the effect of using smaller samples of students to estimate ​X
​ s​​​​ for
some of the outcomes and characteristics we actually consider. Our main results
are relatively insensitive to working with samples from North Carolina schools
that match the distribution of sample sizes in the NLS72, NELS88, and ELS2002
datasets.
The use of ​​Xs​​​​as a control function for ​​XU​  s​  ​​requires the number of groups in the
sample to be larger than the number of elements in ​​Xs​​​​ (and implicitly the number of
factors in ​A
​ s​​​​). Otherwise, one cannot estimate the coefficient vector on ​​Xs​​​​.
The next two subsections discuss the assumptions underlying Proposition 1.
Discussion of Assumptions A
­ 1–A4.—Assumption A1, which relates to the specification of preferences, is fairly general given that both ​​Xi​​​​and ​​X​ Ui​  ​​can include
nonlinear terms.
Assumption A2 says that households take characteristics of neighborhoods as
given. As we mentioned above, this is fully consistent with the possibility that ​​A​s​​​
depends on who chooses ​s​in equilibrium. If some of the neighborhood amenities
are functions of resident characteristics, the distribution of amenities will be endogenous. There might be multiple equilibria. However, Proposition 1 follows entirely
from utility maximization. The linear dependence between ​​Xs​​​​and ​​XU​  s​  ​​will hold in
any equilibrium of the model.

9
However, we strongly suspect that school inputs and policies are not fully determined by student composition.
And we argue below that the spanning Assumption A5 is likely to be a good approximation in our application, so
that ​​X​s​​​fully controls for ​​X​  U
s​  ​​by itself. Consequently, in our empirical work the control function does not contain
any observed school policies and resources.

2912

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

Assumption A2 also imposes that households face a common set of choices. In
online Appendix A6 we present Monte Carlo simulation results that examine the
properties of our control function approach across a number of key dimensions.
The simulations indicate that the control function works well even when different
households face choice sets that are overlapping subsets of the full set of schools.
The common choice set assumption implicitly assumes a static environment. If
different families were making school/neighborhood choices at different points
in time and face substantial moving costs, then school/neighborhood populations
would consist of mixtures of families who made school/neighborhood choices in
different periods.
Extending the analysis to a fully dynamic choice model is beyond the scope of the
paper. However, consider a simple overlapping ­generations-style model where the
joint distribution of amenity factors evolves across periods and school/neighborhood populations combine members of different decision periods (“generations”).
Next, note that the mapping from ​​X​  U
s​  ​​to ​​Xs​​​​ in (7) does not depend on the distribution of amenities ​​As​​​​. Consequently, it can easily be shown that an analogue of
Proposition 1 still holds as long as the taste parameter matrices Θ
​ ​and ​​Θ​​  U​​ and
U
the joint distribution of individual characteristics ​[ ​Xi​​​, ​X​  i​  ​, ​Qi​​​  ]​are fixed across these
“generations.”
The independence Assumption A3 for the idiosyncratic preference components
​​ε​si​​​is strong, but the ​​ε​si​​​can be defined to be uncorrelated with ​​X​i​​  , ​X​ Ui​  ​​, and ​​Q​i​​​ without loss of generality. Furthermore, the presence of ​​Q​i​​​and ​​X​  U
i​  ​​means that we are
allowing for unobserved random variation in preferences for location characteristics​​
A​s​​​separately from ​​εs​i​​​.
Given the linear relationship between ​​Wi​​​​and ​[ ​X​i​​  , ​X​  U
i​  ​, ​Qi​​​  ]​ in Assumption A1,
a sufficient condition for the linearity in expectations Assumption A4 to hold is
that the joint distribution of [​ ​Xi​​​  , ​X​  U
i​  ​, ​Qi​​​  ]​belongs to the continuous elliptical class.
Examples include the multivariate normal, the multivariate t, the Laplace, and the
multivariate exponential power family (Gómez, ­Gómez-Villegas, and Marín 2003).
However, in our application ​X
​ i​​​​contains a number of discrete variables, so this sufficient condition will not be satisfied.
Proposition 1A in the online Appendix establishes that if A4 fails, then an approximation error term appears in equation (7) for ​X
​ ​  U
s​  ​​. The approximation error consists
of the average for s​ ​of a linear function of the differences between E
​ (​X​i​​  | ​Wi​​​  )​ and
U
​E(​X​  i​  ​  | ​Wi​​​)​ (respectively) and the best least square linear predictions of ​​Xi​​​​and ​​X​  U
i​  ​​
given ​​Wi​​​​. As we discuss in Section IVB, the approximation error would primarily
contribute to the school/neighborhood error component ​v​ s​​​​of the outcome model
(12) introduced in the next section. This would lead to upward bias in the less conservative of our two estimators of the variance of school/neighborhood effects.
Note, though, that variation in the differences between E
​ (​X​i​​  | ​Wi​​​)​and ​E(​X​  U
i​  ​  | ​Wi​​​)​
∗
​ i ​  | ​Wi​​​)​will be
(respectively) and the best linear predictors ​E
​ ​​  ​  (​Xi​​​  | ​Wi​​​)​and ​​E​​  ∗​  (​X​  U
small for values of ​​Wi​​​​that are near the population mean ​​W​i​​​. In the data, the
variation across s​ ​in ​​X​i​​​is much smaller than the population variance​.​Presumably
​ ​i​​​. Consequently, variation in the averages
the same is true of ​X
​ ​  U
i​  ​​and thus ​W
∗
∗
U
​ ​​  ​  (​Xi​​​  | ​Wi​​​) | s(i) = s]​and ​
E[E(​X​  U
​E[E(​Xi​​​  | ​Wi​​​) −​ ​E
i​  ​  | ​Wi​​​) − ​E​​  ​(​X​  i​  ​  | ​Wi​​​) | s(i) = s]​
(respectively) are likely to be small. Furthermore, note that because ​X
​ ​  U
s​  ​​appears
U U
in the outcome equation through the index ​X
​ ​  s​  ​ ​β​​  ​​ , any upward bias depends on a

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2913

weighted index of the approximation error terms for each element of ​X
​ ​  U
s​  ​​ , with the
U
elements of ​β
​ ​​  ​​as the weights. This may lead to some cancellation of the approximation errors.
We now turn to the spanning Assumption A5.
When Will the Spanning Assumption A5 Hold?—The key restriction on preferences in Proposition 1 is the spanning Assumption A5. It requires the coefficient
​ ​ Ui​  ​​to be linear combivectors ​​Θ​​  U​​relating tastes for amenities to the elements of ​X
̃
nations of the coefficient vectors ​​Θ​​relating tastes for amenities to the observables​​
​ ​ Ui​  ​​that are correlated with ​X
​ ​i​​  .​Given the importance and
X​i​​​ and/or elements of ​X
subtlety of this spanning condition, we further develop the intuition underlying the
condition and highlight cases in which it fails to hold.
Reconsider the more general function formulation used in the introduction.
Let ​A
​ ​​  X​  ⊆ A​represent the subset of amenities that affect the distribution of observ​ ​​  X​​if WTP for the amenity
able school averages ​X
​ s​​​​. An amenity will be included in ​A
is affected by ​​Xi​​​​ and/or by elements of ​​X​ Ui​  ​​that are correlated with ​​X​i​​​. Likewise,​​
U
A​​  ​X​​  ​​  ⊆ A​represents the subset of amenities that affect the distribution of unobservable school averages ​​XU​  s​  ​​. The ­between-school variation in ​​Xi​​​​will only be
driven by ​​A​​  X​​ , so that ​​Xs​​​  = f(​A​​  X​  )​for some ­vector-valued function ​f​. Similarly,
U
​​XU​  s​  ​ = ​f​​  U​  (​A​​  ​X​​  ​​  )​. We can write ​​XU​  s​  ​  = g(​Xs​​​)​if we can write ​​XU​  s​  ​ = ​f​​  U​  (​f​​  −1​  (​Xs​​​)),​
where ​g(​X​s​​) = ​f​​  U​  (​f​​  −1​  (​Xs​​​))​. Thus, jointly sufficient conditions are as follows.
ASSUMPTION A5.1: ​f​is invertible, so that we can write ​​A​​  X​ = ​f​​  −1​  (​Xs​​​)​.
ASSUMPTION A5.2: ​​A​​  ​X​​  ​​ ⊆ ​A​​  X​​, so that the set of amenities that drive variation
in ​​X​s​​​contains the set of amenities that drive variation in ​​X​  U
s​  ​​ (i.e., the range of
−1
U
​​f​​  ​​must encompass the domain of ​​f​​  ​​   ).
U

While these conditions are not necessary, they suggest two fundamental ways
that the spanning condition ​​Θ​​  U​  = R​Θ̃ ​​can fail.10 The first way, which leads A5.1
to fail, is that the vector ​​X​i​​​may affect tastes for more amenities than the number of
elements in ​X
​ ​i​​​. That is ​dim (​A​​  X​  )   > L​ where ​dim (​A​​  X​  )​is the number of elements in​​
X
A​​  ​​. In this case, the function ​f( ∗ )​is not invertible.11 In the case of the additively
separable utility function from (4), ​dim (​A​​  X​  )​is equal to the row rank of ​​Θ̃ ​​. To see
how A5.1 might fail, suppose that the only observable characteristic were parental
education and that the amenity space consisted of two imperfectly correlated factors: schools’ quality of teachers and quality of athletic facilities. Even if parental
education affected WTP for both amenities, one would not be able to disentangle
10
Invertibility of f​ (​A​​  X​  )​is not a necessary condition. It is possible that the mapping from ​A
​ ​​  X​​to ​​Xs​​​​ is ­one-to-many,
meaning that the same value of ​​A​​  X​​leads to multiple values of ​​Xs​​​​. In this case theU key is that one can still write
​​A​​  X​​ ​= h(​X​s​​  )​ , where ​h( · ) = ​f​​  −1​  ( · )​in the ­one-to-one case.
The mapping from ​A
​ ​​  ​X​​  ​​​to ​​XU​  s​  ​​need not be o­ ne-to-one
U
either. However, there must be a mapping ​X
​ U​  s​  ​  = f( ​A​​  ​X​​  ​​, ​Xs​​​  )   = f(h(​Xs​​​  ), ​Xs​​​  )   = g(​Xs​​​)​that is o­ ne-to-one or
­many-to-one.
11
More specifically, what is relevant for invertibility is not the number of elements of ​​Xi​​​​ (denoted ​L​ ) per se but
the number of independent taste factors that these ​L​observables represent. Suppose, for example, that ­mother’s education and father’s education were both observed, but they affected willingness to pay for each amenity in the same
relative proportions. Then adding father’s education to ​​X​i​​​would not make ​f( ∗ )​invertible if it were not already
when only mother’s education was included in ​​Xi​​​​.

2914

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

the quality of athletic facilities from the quality of teachers based on only neighborhood averages of parental education. We would need to observe a second individual
characteristic, such as parental income, in order to satisfy the spanning condition.
The validity of A5.1 depends on the number and breadth of coverage of variables
​ ​s​​​ , where the
in ​X
​ i​​​​. It is testable. The model implies a factor structure for the vector ​X
number of factors is determined by the row rank of ​​Θ̃ ​​ (see online Appendix A3).
A finding that the number of factors that determine ​​Xs​​​​is smaller than the dimension of ​​Xi​​​​is consistent with the assumption that d​ im (​A​​  X​  ) ≤ L​. A finding that the
number of factors is at least as large as the dimension of ​X
​ ​i​​​is also technically consistent with the assumption, but would strongly suggest that ​dim (​A​​  X​  ) > L​. The
evidence presented in Section VIF and online Appendix A3 is fully consistent with​
dim (​A​​  X​  ) < L​in our application.
What about Assumption A5.2? Partition ​​X​ Ui​  ​​into a subvector ​​X​ U1i ​​​  that is correlated
with ​​X​i​​​and a subvector ​​X​ U2i ​​​  that is not correlated with ​​Xi​​​​. Assumption A5.2 will
​ ​i​​​nor ​X
​ ​ U1i ​​​  affect
fail if ​X
​ ​ U2i ​​​  affects preferences for an amenity for which neither ​X
preferences.
To illustrate how Assumption A5.2 can fail, we modify the example above so
that parental education and immigrant status are the only ​X
​ i​​​​variables. Suppose that
student athleticism is the only unobservable and that it is uncorrelated with both
parental education and immigrant status. And suppose that neither parental education nor immigrant status affect WTP for athletic facilities in the neighborhood,
while student athleticism does. Then student athleticism is an ​X
​ ​ U2i ​​​  variable rather
U
​X​​  U​
​ ​​  ​​but not ​A
​ ​​  X​​  , so that​​
than an ​​X​  1i ​​.​  Athletic facility quality would be an element of ​A
U
A​​  ​X​​  ​​  ⊄ ​A​​  X​​. Assumption A5.2 would fail. Consequently, variation in athletic facility quality would drive b­ etween-neighborhood variation in average student athleticism that average parental education and immigrant status would not capture. Online
Appendix A2 provides additional examples of when the spanning condition will and
will not be satisfied.
Assumption A5.2 is a statement about unobservables and thus is not testable
without more structure than we impose. But one can assess the assumption through
the following thought process. First, draw on the literature to identify the factors,
both observed and unobserved, that are most important for the outcome. Next consider each unobserved variable and ask whether it is likely to be uncorrelated with
all of the observed variables. Also ask whether it is likely to be the only determinant
of WTP for some amenity that influences location choice. If the answer to both
questions is “no” for all of the elements of ​X
​ ​ Ui​  ​​ , then Assumption A5.2 is plausible.
This line of reasoning leads us to believe that A5.2 is plausible in an application
such as ours in which ​X
​ i​​​​contains a rich and diverse set of variables that are likely
to matter for student outcomes. Consider, for example, the priority that a child’s
parents and broader family place on academic learning and educational attainment.
One would expect this unobservable to boost willingness to pay for peer groups
and community and school characteristics that foster achievement, such as enrichment programs. However, parents’ education (observed in all four datasets), parents’ desired years of education, parental school involvement (observed in ELS2002
and NELS88), and grandparents’ education (observed in ELS2002) are likely to
be correlated with the priority parents place on education. They are also likely
to directly affect willingness to pay for a similar set of ­education-related school

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2915

and ­neighborhood characteristics. To take another example, taste for/proficiency
in music may affect academic performance and influence willingness to pay for
schools and communities with good music programs and music venues. But parental
education and parental income are likely to be correlated with a child’s proficiency
in music (through home investments). They also may influence WTP for opportunities in music. One can make similar arguments about other unobservables (e.g.,
wealth (unobserved) versus income (observed)).
We already mentioned that group averages of elements of ​Q
​ ​i​​​should be included
in the control function if they are observed and ​​X​s​​​alone is inadequate for the spanU
ning condition to hold. One could also include an observed element of ​​A​​  ​X​​  ​​​ that
​ i​​​​is limited,
drives sorting on ​​X​ U2i ​​​  in the control function. In applications in which ​X
these additions may be needed for the control function to be adequate.
Online Appendix A5 derives an analytical formula for the component of ​​XU​  s​  ​​ that
cannot be predicted by ​​X​s​​​when the spanning assumption is violated (and thus may
be a source of bias in our lower bound estimates of the variance in school/neighborhood treatment effects). The variance in this component depends on the following
five factors: (i) the joint distribution of amenities; (ii) the joint distribution of the
​ ​​  U​​mapping unobserved individual characterisWTP index ​W
​ ​i​​​; (iii) the matrix ​Θ
tics into willingness to pay for particular amenities; (iv) the joint distribution of
the residual component of unobserved ­outcome-relevant student characteristics ​​​X̃ ​​ Ui​  ​​
and (v) the joint distribution of the unobserved ­outcome-irrelevant (but school
­choice-relevant) student characteristics ​​Q​i​​​.
Given the complicated manner in which each of these five factors enters the
expression for the unexplained component of ​​XU​  s​  ​​ , there does not appear to be any
straightforward way to place a bound on the variance in this error component.
Online Appendix A6 presents Monte Carlo simulations for cases in which the spanning condition (A5) fails. The control function approach is quite robust to violations
of the spanning condition in which just a few o­ utcome-relevant unobservables in ​​X​ Ui​  ​​
affect WTP for just a few additional amenities that are not weighted by any elements
of ​​X​i​​​. This is arguably the most plausible case when rich data on students and parents are available.
III. The Econometric Model of Educational Attainment and Wage Rates

We begin this section by elaborating on the underlying model of student outcomes presented in the introduction. Next, in Section IIIB we show how sorting and
omitted school and neighborhood characteristics affect estimates of neighborhood/
school effects based on ordinary least squares (OLS) estimation of that model. Then
in Section IIIC we show that the OLS estimates of the student outcomes model in
combination with Proposition 1 and Assumption A6 are sufficient to place a lower
bound on the variance of school and neighborhood effects.
A. The Model of Outcomes
In our application the outcomes are high school graduation, attendance at a
­four-year college, a measure of years of postsecondary education, and the p­ ermanent

2916

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

wage rate. The outcome ​Y
​ ​si​​​of student i​ ​whose family has chosen the school and surrounding neighborhood s​ ​is determined according to
U
​ ​​  + ​ξ​si​​  .​
(8)	​
​Y​si​​  = ​X​i​​  β + ​x​  U
i​  ​ + ​Zs​​​  Γ + ​z​  s​  ​ + ​ηsi

For binary outcomes such as college attendance, ​​Ysi​ ​​​is the latent variable that determines attendance. As discussed above, the student’s outcome contribution can be
​ ​  U
X​ Ui​  ​ ​β​​  U​​is a scalar index summarizing the
summarized by ​X
​ ​i​​  β + ​x​  U
i​  ​​ , where ​x
i​  ​ ≡ ​
contributions of unobserved student characteristics ​X
​ ​ Ui​  ​​ , and the row vector ​[ ​Xi​​​  , ​X​ Ui​  ​  ]​
is an exhaustive set of child and family characteristics that have a causal impact
​ ​ Ui​  ​​may include ­nonlinear functions, the
on student i​’​s outcome. Since ​​X​i​​​and ​X
­linear-in-parameters specification for ​Y
​ s​i​​​is without much loss of generality.
Analogously, the average school/neighborhood outcome contribution in school/
U
ZU​  s​  ​ ​Γ​​  U​​is a scalar
neighborhood ​s​is captured by the index ​​Z​s​​  Γ​ + ​​z​  U
s​  ​​where ​​z​  s​  ​ ≡ ​
index summarizing the contributions of unobserved school and neighborhood characteristics. The vector ​​Z​s​​​captures the influence of observed school/­neighborhoodlevel characteristics (which in our empirical work do not vary among students within
a school). The vector ​​ZU​  s​  ​​represents the remaining unobserved school/neighborhood
influences that vary between school attendance areas (e.g., quality of the school
​ U​  s​  ​​may include averages of ​X
​ ​i​​​
principal or the local crime rate). Note that ​​Zs​​​​and ​Z
U
and ​​X​  i​  ​​ , respectively, that capture peer effects.
The unobserved scalar index ​​ηs​ i​​​captures variation in school/neighborhood contributions among students within a school attendance area and within a school itself
(e.g., trustworthiness of immediate neighbors or distinct course tracks at the school).
­ ithin-school components
Some of the factors that determine ​η​ s​ i​​​may represent the w
of ​Z
​ ​s​​​.
The component ​​ξs​ i​​​captures other influences on student ​i​’s outcome that are deterU
mined after secondary school but are not predictable given ​​X​i​​​  , ​​x​  U
i​  ​​  , ​​Zs​​​​  , ​​z​  s​  ​​, and ​​η​si​​​.
These might include the opening of a local college or local labor market shocks that
occur after high school is completed. It will prove useful to write ​​ξ​si​​​as ​​ξs​ ​​  + ​ξ​i​​​  , where​​
ξ​s​​​is common to all students at school s​ ​and ​​ξ​i​​​is idiosyncratic. ​ξ​ ​s​​​is 0 for high school
graduation. More generally, the productivity parameters ​β​ and ​Γ​and the indices ​​x​  U
i​  ​​  ,​​
​ s ​​  , ​​ηs​ i​​​, and ​​ξs​ i​​​depend implicitly upon the specific outcome under consideration as
z​  U
well as the time period in the case of wages.
​ ​s​​​ at
In practice we only have data on observed student and school inputs ​X
​ ​i​​​and ​Z
a single point in time. Thus, some components of ​​Xi​​​​associated with student inputs
such as student aptitude will have been determined in part by parental inputs from
earlier periods such as parent income (Todd and Wolpin 2003 and Cunha et al.
2006). Such links make it difficult to interpret the coefficient associated with a
given component of ​​X​i​​​ , because once we have conditioned on the other components, we have removed many of the avenues through which the component determines ​​Y​i​​​. Consequently, we do not attempt to estimate the productivity parameters​
β​or ​β
​ ​​  U​​ , and thus do not attempt to tease apart the distinct influences of child characteristics, family characteristics, and early childhood schooling inputs, respectively. Similarly, we do not attempt to remove bias in estimates of Γ
​ ​ stemming
from correlations between ​​Z​s​​​and the omitted school/neighborhood factors ​​z​  U
s​  ​​. We

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2917

aim instead to ­separate the effects of schools and associated community influences
on outcomes from student, family, and prior school/community factors.
To be more specific about what we mean by school/neighborhood treatment
effects, note that if a randomly selected student attended school ​​s​​  1​​rather than ​s​ ​​  0​​  ,
U
the expected difference in his/her outcome would be ​(​Z​​s​​  1​​ ​Γ + ​z​  U
​s​​  1​ ​​  )  − ( ​Z​​s​​  0​​ ​Γ + ​z​  ​s​​  0​ ​​  )​.
U
We wish to quantify differences across schools/neighborhoods in ​​Zs​​​  Γ + ​z​  s​  ​​. In the
case of college attendance and permanent wage rates, the difference in expected
outcomes will also reflect the difference between ​ξ​ ​​s​​  1​​​​and ​ξ​ ​s​ ​​  0​​​​ , which are common to
those who attend ​s​ ​​  1​​or ​​s​​  0​​but are determined after high school is completed.12
One could generalize the model above for ​​Y​si​​​to allow the effects of school characteristics to depend on individual attributes by adding interactions of ​​Z​s​​​ and/or ​​z​  U
s​  ​​
with individual attributes ​X
​ ​i​​​ and/or ​​X​ Ui​  ​​. Indeed, the preference weights on amenities
​ ​ Ui​  ​​in the choice model, as
that represent school characteristics depend on ​X
​ ​i​​​and ​X
would be the case if parents choose locations with the match to their child’s needs
in mind. Allowing for ­nonseparability in the outcome model does not break the
linear relationship between ​X
​ s​​​​and ​​XU​  s​  ​​. However, it would imply that the distribution of school treatment effects varies with ​​Xi​​​​and ​​X​ Ui​  ​​. We focus on the homogeneous effects case in this paper. Agrawal, Altonji, and Mansfield (2017) extend the
­analysis to a model of ​Y
​ s​i​​​with interactions.
B. The Bias in OLS Estimates of School Effects
In this section we discuss the slope parameters and error components that OLS
recovers when outcomes are regressed on only the observed ­student-level and
­school-level variables, ​​X​i​​​and ​​Zs​​​​.
​ ​s​​​consists of
To facilitate the analysis, first partition ​​Zs​ ​​​into [​ ​X​s​​, ​Z2​s​​  ]​ , where ​X
­school-averages of observable student characteristics, and ​Z
​ 2​s​​​is a vector of other
observed ­school-level characteristics not mechanically related to student composition (e.g., teacher turnover rate or s­ tudent-teacher ratio). Partition the coefficient
vector ​Γ ≡ [ ​Γ​1​​, ​Γ2​​​  ]​analogously. Section VC provides a discussion of which variables should be included in ​X
​ s​​​​and ​​Z2​s​​​  , respectively.
Recall that ​ξ​ s​ i​​​is defined to be unrelated to [​ ​X​i​​, ​Xs​​​, ​Z2​s​​  ]​. Decompose the other
U
unobserved components in the production function (8), ​​x​  U
i​  ​​  , ​​z​  s​  ​​, and ​​η​si​​  ,​into their
U
projection onto [​ ​X​i​​, ​Xs​​​, ​Z2​s​​  ]​and the orthogonal components ​​​x̃ ​​  i​  ​  ,​ ​​​z̃​​  U
s​  ​,​and ​​​η̃ ​​si​​​:
(9)	​ ​x​  U
Xi​​​ ​Π​x​​  Ui​  ​​Xi​​​ ​​ + ​X​s​​ ​Π​x​​  Ui​  ​​Xs​​​ ​​ + ​Z​2s​​ ​Π​x​​  Ui​  ​​Z2​s​​ ​​ + ​​x ​​ ̃ U
i​  ​ = ​
i​  ​
Xs​​​ ​Π​z​​  Us​  ​​Xs​​​​​  + ​Z​2s​​ ​Π​z​​  Us​  ​​Z2s​ ​​​​  + ​​z̃ ​​  U
(10)	 ​z​  U
s​  ​ = ​
s​  ​
(11)	 ​η​si​​  = ​X​i​​ ​Π​η​si​ ​​​Xi​​​ ​​ + ​​η̃ ​​si​​  .​

12
The outcomes of a specific student i​​will also differ across schools/neighborhoods because the values of the
idiosyncratic terms ​η​ si​ ​​​will differ.

2918

OCTOBER 2018

THE AMERICAN ECONOMIC REVIEW

U
Substituting the projections (9), (10), and (11) for ​​x​  U
​ ​​​ into (8), we obtain
i​  ​​  , ​​z​  s​  ​​ , and ​​ηsi

(12)	​ ​Y​si​​  = ​X​i​​  B + ​Xs​​​ ​G​1​​  + ​Z​2s​​ ​G​2​​  + ​v​s​​  + (​vsi​ ​​  − ​v​s​​),
(13)

where

B ≡ [β + ​Π​​x​  Ui​  ​​Xi​​​ ​​ + ​Π​​ηsi​ ​​​Xi​​​ ​​ ]

(14)	​
G1​​​  ≡ [ ​Π​x​​  Ui​  ​​Xs​​​​​  + ​Γ​1​​  + ​Π​​z​  Us​  ​​Xs​​​​​  ]
(15)	​
G2​​​  ≡ [ ​Π​x​​  Ui​  ​​Z2s​ ​​ ​​ + ​Γ​2​​  + ​Π​​z​  Us​  ​​Z​2s​​ ​​ ]
(16)	​
vs​​​  ≡ ​​xs̃ ​​  U​  ​ + ​​zs̃ ​​  U​  ​ + ​ξs​​​
(17)	 ​v​si​​  − ​v​s​​  ≡ (​​x̃ ​​ iU​  ​− ​​x̃ ​​  U
s​  ​  ) + ​​η̃ ​​si​​  + ​ξ​i​​​.
The expressions for ​​G1​​​, ​G2​​​​, and ​​v​s​​​ in (14), (15), and (16) reveal that the observable
​ ​2s​​ ​G​2​​​and the unobservable residual component ​v​ s​​​​
school components ​X
​ ​s​​ ​G​1​​​and ​Z
all reflect a mixture of school effects and student composition biases. Specifically,​​
X​s​​ ​G1​​​​and ​​Z2​s​​ ​G​2​​​will reflect ​​Xs​​​ ​Π​x​​  Ui​  ​​Xs​​​​​​ and ​​Z2​s​​ ​Π​x​​  Ui​  ​​Z2s​ ​​​ ​​ , respectively, which capture
differences across schools in ​​x​  U
i​  ​​that are predictable by ​​Xs​​​​and ​​Z​2s​​​conditional on
​​Xi​​​​. The unpredicted ­between-school component ​​vs​​​​will reflect ​​​xs̃ ​​  U​  ​​ , which captures the
part of the average unobservable student contribution that is not related to observed
school-level characteristics or average ­
­
student-level characteristics. The terms
U
U
U
​​Xs​​​ ​Π​x​​  i​  ​​Xs​​​​​​  , ​​Z​2s​​ ​Π​x​​  i​  ​​Z2s​ ​​​​​, and ​​​x̃ ​​  s​  ​​capture sorting. They are not school/neighborhood
effects, since a child who was reallocated to a school with a higher value of these
components could not expect an increase in test scores.13 Without further assumptions about how students sort into schools, regression and variance decomposition
techniques cannot be used to identify or even bound the contribution of schools/
neighborhoods to student outcomes. However, in the next section we show that the
assumptions laid out in Proposition 1, plus an additional assumption, are sufficient
to place a lower bound on the variance of school and neighborhood effects given the
production function (8) above.
C. Using Proposition 1 to Bound the Importance of School/Neighborhood Effects
Section II provides conditions under which the s­ chool-average values of student
observables ​​X​s​​​and unobservables ​​XU​  s​  ​​are linearly dependent, as summarized in
Proposition 1. In this subsection we present two additional propositions that illustrate
the value of Proposition 1 for characterizing the distribution of school/neighborhood
treatment effects. In particular, Proposition 2 shows that the relationship between ​X
​ ​s​​​
​ ​2​​​and ​​vs​​​​. Proposition 3 shows that Propositions 1
and ​​XU​  s​  ​​implies restrictions on ​G
and 2, when combined with an additional plausible assumption, allow the recovery
of a lower bound estimate of the contribution of schools (and groups more generally) to individual outcomes. We also present the more ­demanding c­ onditions under

13
Note that peer effects stemming from concentration of particular types of students at a school are captured
by either ​Z
​ s​​​  Γ​or ​​z​  U
s​  ​​.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2919

which unbiased estimates of the causal effects of particular g­ roup-level characteristics can be recovered.
PROPOSITION 2: Assume that Assumptions ­A1–A5 from Proposition 1 hold.
Then equations (15) and (16) simplify to
(18)	​​G​2​​  =  ​Γ​2​​  + ​Π​​z​  Us​  ​​Z2​s​​​​
(19)	​
vs​​​  =  ​​z̃ ​​  U
s​  ​  + ​ξ​s​​​.
An expanded version of Proposition 2 that includes formulae for ​B​ and ​G
​ ​1​​​is stated
and proved in online Appendix A7.
We see that when the conditions of Proposition 1 are satisfied, the inclusion of ​X
​ s​​​​
in ​Z
​ ​s​​​purges both ​​G2​​​​and ​​vs​​​​of biases from student sorting, so that v​ ar(​Z2​s​​ ​G2​​​)​ and​
var(​v​s​​)​only reflect true school/neighborhood contributions and, in the case of ​​vs​​​​  ,
later common shocks. However, the sum v​ ar(​Z​2s​​ ​G​2​​)​ + ​var(​vs​​​)​is likely to understate the full variance in school contributions v​ ar(​Zs​​​  Γ + ​z​  U
s​  ​  )​for three reasons. The
​ s​​​ ​Γ​1​​​ , will confirst and obvious one is that the causal effect of ​X
​ ​s​​​on outcomes, ​X
tribute to ​G
​ 1​​​​and therefore will be excluded from estimates of school/neighborhood
effects. If peer effects are important, this could lead to a substantial underestimation
of the importance of school/neighborhood effects.
Second, if the school mean ​X
​ U​  s​  ​​has external effects, it is part of ​z​​  U
s​  ​​and therefore enters the outcome equation separately from the individual-level variable ​​x​  U
i​  ​​.
Since this component will also be absorbed by ​​X​s​​ ​G​1​​​  , school/neighborhood peer
effects associated with ​X
​ U​  s​  ​​will be excluded from the estimate of school/neighborhood effects.
Third, (14) reveals that ​​X​s​​​will also absorb part of the unobserved school con​​​. To see why, note that ​X
​ ​s​​​spans the space of ​X
​ U​  s​  ​​ because the
tribution ​z​ ​  U
s​  ​​via ​​Π​z​​  U
s​  ​​Xs​​​
U
amenity vector, ​​As​​​​ , is the source of variation in both ​​Xs​​​​and ​​X​  s​  ​​. Given that parents
are likely to value the contributions of schools to student outcomes, many of the
characteristics contributing to ​​z​  U
s​  ​​that affect school quality are likely to be reflected
in ​​As​​​​. Hence, while the inclusion of ​​Xs​​​​in the estimated specification removes sorting
bias, it also absorbs some of the variation in ​​z​  U
s​  ​​associated with underlying amenity
factors for which ​​X​i​​​affects taste. Furthermore, if some elements of the ­school-level
​ s​​​​or perfectly determine them,
observables ​​Z​2s​​​also serve directly as amenities in ​A
then these elements determine ​X
​ ​s​​​. These relationships need not be linear, but if they
are, then we cannot identify the corresponding elements of the vector ​G
​ ​2​​​.14
U
On the other hand, components of ​​Z2s
​ ​​ ​Γ2​​​  + ​z​  s​  ​​that are either not directly valued
or only partially known by parents at the time the school/neighborhood is chosen
​ s​​​​. Parents probwill not be elements of ​A
​ s​​​​ , although they may be correlated with ​A
ably are not perfectly informed about specific school quality determinants such as
student/teacher ratio and in any event care about broader qualities of schools rather
than specific inputs. The broader qualities are the amenities in the model. Parents
14
Nor can we estimate the effect of a school-level variable in the unlikely event that the political process leads
it to be an exact linear function of ​​Xs​​​​.

2920

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

would know some variables, such as whether a school is Catholic, but in many cases
would have chosen locations prior to high school based on education options more
generally. Such specific components of ​Z
​ 2​s​​​will not be collinear with ​​Xs​​​​.
The fact that ​​Z2​s​​ ​G2​​​​and ​​vs​​​​exclude three components of ​​Z​2s​​ ​Γ​2​​  + ​z​  U
s​  ​​is the
reason to expect that v​ar(​Z2​s​​ ​G​2​​)​ and ​var(​Z​2s​​ ​G​2​​  + ​v​s​​  )​will both understate
. However, it is theoretically possible that the covariance of the
​var(​Z​2s​​ ​Γ2​​​  + ​z​  U
s​  ​  )​
excluded components with the rest of ​​Z​2s​​ ​Γ2​​​  + ​z​  U
s​  ​​is sufficiently negative that
​ ​​ ​G2​​​)​ exceeds ​var(​Z2s
​ ​​ ​Γ2​​​  + ​z​  U
​var(​Z2​s​​ ​G​2​​)  + var(​v​s​​)​and even v​ ar(​Z2s
s​  ​  )​. To rule this
out, we assume
​ASSUMPTION A6.1:
var(​Xs​​​  [ ​Γ1​​​  + ​Π​​z​  Us​  ​​Xs​​​ ​​ ]) + 2cov(​X​s​​  [ ​Γ​1​​  + ​Π​​z​  Us​  ​​Xs​​​ ​​ ], ​Z2​s​​  [ ​Γ2​​​  + ​Π​​z​  Us​  ​​Z2s​ ​​ ​​ ]  )  + var(​​z̃ ​​  U
s​  ​  ) ≥ 0,​
or
ASSUMPTION A6.2:
(20) ​var(​Xs​​​[​Γ1​​​  + ​Π​​z​  Us​  ​​Xs​​​​​]) + 2cov(​X​s​​[​Γ1​​​  + ​Π​​z​  Us​  ​​Xs​​​​​], ​Z2​s​​[​Γ2​​​  + ​Π​​z​  Us​  ​​Z2s​ ​​​​]) − var(​ξ​s​​) ≥ 0.​
The following proposition provides formal justification for using ​var(​Z​2s​​ ​G​2​​)​ and
even ​var(​Z2​s​​ ​G2​​​  + ​v​s​​)​as lower bound estimates of the variance in school/neighborhood treatment effects.
PROPOSITION 3: If Assumptions ­A1–A5 from Proposition 1 and A6.1 hold,
then v​ ar(​Z​2s​​ ​G2​​​) ≤ var(​Zs​​​  Γ + ​z​  U
s​  ​  )​. If Assumptions ­A1–A5 and A6.2 hold, then
U
​var(​Z2​s​​ ​G2​​​  + ​v​s​​) ≤ var(​Zs​​​  Γ + ​z​  s​  ​  )​.
The proof is in online Appendix A8. Note that since v​ ar(​​z̃ ​​  U
s​  ​  )​ and ​var(​ξ​s​​)​ are
­nonnegative, Assumption A6.2 is strictly stronger than Assumption A6.1. By the
​ 2​s​​​by construction, v​ar(​Z​2s​​ ​G​2​​)​ will
same token, since ​v​​s​​​is uncorrelated with ​Z
always produce a more conservative lower bound than ​var(​Z2​s​​ ​G​2​​  + ​v​s​​)​.
While A6.1 and A6.2 are technically necessary to interpret v​ar(​Z2​s​​ ​G​2​​  )​ and
​var(​Zs​​​ ​G​2​​  + ​v​s​​)​as lower bound estimators of the school/neighborhood effect variance, in practice we believe that even the stronger Assumption A6.2 is very likely
to hold if the common shocks component v​ ar(​ξ​s​​)​ is ​0​ (as in high school graduation)
or is not too large.15 In particular, when ​var(​ξ​s​​)​is ​0​the stronger Assumption A6.2 is
violated only if the covariance term is sufficiently negative to outweigh the variance
term. That can only happen when the peer and unobserved school inputs that project
onto ​​Xs​​​​are both strongly negatively correlated with those that project onto ​​Z​2s​​​ and
account for a much smaller share of the total school effect variance.
Recall that a large share of the variation in ​X
​ ​s​​  (​Γ1​​​  + ​Π​​z​  Us​  ​​Xs​​​ ​​ )​is likely to represent
observed and unobserved peer inputs. A strong negative correlation between peer
inputs and productive school resources or policies will generally require that the
15
If one regards the common shocks as part of the school/neighborhood treatment, then v​ ar(​ξ​s​​)​becomes part
of ​var(​​z ​​ ̃ U
s​  ​  )​in A6.1 and disappears from A6.2, strengthening both inequalities.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2921

student and parent attributes that contribute to a strong peer environment also predict lower valuation of superior school inputs. This is at odds with both empirical
evidence and casual observation. Online Appendix A8 fleshes out this argument and
provides additional theoretical, statistical, and empirical justifications for A6.1 and
A6.2.
​ ​z​​  Us​  ​​Z2​s​​​​​in the expression for ​G
​ ​2​​​ in (18)
Identification of ​Γ
​ ​2​​​.—The existence of ​Π
reveals that even when the conditions of Proposition 1 are satisfied, ​​G​2​​​still reflects
omitted variables bias driven by correlations between ​​Z​2s​​​and the unobserved school
characteristics index ​z​ ​  U
s​  ​​. Thus, estimating the vector of causal effects ​​Γ​2​​​ associated
with the school characteristics ​​Z​2s​​​will in general still require a vector of instruments, an extension that we discuss in the conclusion.
However, the sorting model in Section I also sheds light on the circumstances in
​ˆ ​​2​​​is an unbiased estimator of ​Γ
​ ​2​​​. In particular, suppose
which ​​Π​​z​  Us​  ​​Z2s​ ​​ ​​ = 0​ , so that ​​G
that every unobserved school characteristic that contributes to the index ​​z​  U
s​  ​​and is
correlated with ​​Z2​s​​​is either an amenity considered by individuals at the time of
choice or is perfectly predicted by the vector of amenities. Furthermore, suppose the
spanning assumption is satisfied so that ​​As​​​​is a function of ​​X​s​​​. This implies that ​​Xs​​​​
​ ​2s​​​. In this case, the
also perfectly determines the part of ​z​ ​  U
s​  ​​that is correlated with ​Z
ˆ
residual variation in ​​z​  U
s​  ​​will be orthogonal to ​​Z​2s​​​. As a result, ​​Π​z​​  U
​ ​​​​  = 0​ , and ​​​G ​​2​​​
s​  ​​Z2s
will be an unbiased estimator of ​Γ
​ ​2​​​.
Because we suspect that there are a large array of o­ utcome-relevant school inputs,
not all of which are directly and accurately valued by parents when choosing schools,
we do not assume that ​Π
​ ​z​​  Us​  ​​Z2s​ ​​​​  = 0​in our empirical work. Thus, we do not attempt
to interpret the individual coefficients estimated by ​​G
​ˆ ​​2​​​.16 However, this analysis
does suggest that controlling for g­ roup-averages of individual characteristics can
potentially remove part of the omitted variable bias from estimated coefficients on
­group-level characteristics.17
IV. Mechanics of Measuring School and Neighborhood Effects

A. Estimating the Model Parameters
Online Appendix A9 describes the process by which the coefficients ​B​  , ​​G​1​​​  , and​​
G​2​​​and the error component variances ​var(​vs​​​)​ and ​var(​vsi​ ​​  − ​v​s​​)​are estimated. In all
cases we use sample school averages of observable characteristics ​​X
​ˆ ​​s​​​in place of the
population averages ​​Xs​​​​ , which are not observed. We have modified our estimation
procedures from previous drafts of this paper to correct for small sample bias in
​ ​  ,​​
estimates of v​ ar(​vs​​​)​associated with the use of degrees of freedom to estimate B
​ 2​​​​. For the continuous outcome years of postsecondary education we treat​​
G​1​​​ , and ​G
v​s​​​as a random effect and estimate the model by restricted maximum l­ikelihood
16
See Meghir and Rivkin (2011) for a recent discussion of some of the issues in estimating the effects of particular school characteristics. They highlight the vector of omitted school characteristics that determines ​z​ ​  U
s​  ​​as a
key source of bias.
17
ˆ ​​2​​​as an estimator of ​​Γ2​​​​
Of course, as with any control variable, controlling for ​​Xs​​​​could make the bias in ​​​G
worse. This could happen if the regression relationship between the components of ​Z
​ 2s
​ ​​​and ​​z​  U
s​  ​​controlling for sorting is stronger than and opposite in sign to the relationship between ​​Z2s
​ ​​​and ​​z​  U
s​  ​​that is unrelated to sorting.

2922

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

(REML). REML accounts for degrees of freedom in estimating ​
var(​vs​​​)​ and
​var(​vsi​ ​​  − ​v​s​​)​ , while maximum likelihood does not. For the log wage outcome we
have panel data on each sample member. We treat both ​​vs​​​​and ​(​v​si​​  − ​v​s​​)​as random
effects and allow for an additional p­ erson-specific transitory component of wages
that may be serially correlated for up to seven years. We estimate by REML. Due to
computational difficulties, we do not incorporate weights into the REML estimation
procedure for either continuous outcome.18
For binary outcomes such as high school graduation, we reinterpret ​Y
​ ​si​​​to be
the latent variable that determines the indicator for whether a student graduates,
. We assume errors are normally distributed and
​HSGRA ​Dsi​ ​​  = 1(​Ysi​ ​​  > 0)​
work with a random effects probit model. The scale of ​Y
​ ​si​​​is chosen by setting
​var(​vsi​ ​​  − ​v​s​​)​to ​1.​The REML estimator does not exist for binary outcomes, so we
use a t­wo-step procedure. In the first step, we use maximum likelihood to estimate
the parameters B
​ ​  , ​​G1​​​​  , ​​G2​​​​, and ​var(​v​s​​)​of the random effects probit model. In the
second step, we correct the maximum likelihood (ML) estimates of ​var(​v​si​​  − ​v​s​​)​ and​
var(​v​s​​)​for downward bias due to lost degrees of freedom in estimating the slope
parameters. The correction is based upon formulas derived for continuous outcomes
for relationships between the unbiased REML estimators and the corresponding ML
estimators of v​ ar(​vs​​​)​ and ​var(​vsi​ ​​  − ​v​s​​)​. We assume that these formulas also approximately hold in the probit case once scale is accounted for. We then use them to
obtain simple formulas to bias adjust the ML estimators. See online Appendix A9.C
for the derivation and formulas.
B. Variance Decomposition
In the empirical work below, we estimate models of the form
(21)	​
​Ysi​ ​​  = ​X​i​​  B + ​Xs​​​ ​G1​​​  + ​Z​2s​​ ​G​2​​  + ​v​si​​  , ​
​ ​2s​​​is a vector
where ​​Xs​​​​is a vector of s­ chool-averages of student characteristics, and ​Z
of observed school characteristics (such as school size or s­tudent-teacher ratio).
We can decompose v​ ar(​Ys​i​​)​into observable and unobservable components of both
within- and between-school variation via
var​(Y
​ si​ ​​) = ​ˆ
var​(​Ysi​ ​​  − ​Y​s​​) + ​ˆ
var​(​Ys​​​)
(22) ​​ˆ
(23)

ˆ(( ​Xi​​​  − ​X​s​​  )B) + ​ˆ
var​(​vsi​ ​​  − ​v​s​​) ]
= [​var​

var​(​Xs​​​  B) + 2​ˆ
cov​(​Xs​​​  B, ​Xs​​​ ​G​1​​) + 2​ˆ
cov​(X
​ s​​​  B, ​Z2s
​ ​​ ​G2​​​  )  
+ [​ˆ

var​(​Xs​​​ ​G​1​​) + 2​ˆ
cov​(​Xs​​​ ​G1​​​, ​Z2s
​ ​​ ​G2​​​) + ​ˆ
var​(​Z2s
​ ​​ ​G​2​​) + ​ˆ
var​(​vs​​​)].​
+ ​ˆ

18
However, to minimize the impact of omitting weights from model estimation, sampling weights are reincorporated when computing each of the observable components of our variance decomposition and also when taking
averages over the population of the impact of ­tenth-to-ninetieth quantile shifts in school quality.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2923

Drawing on the analysis above, particularly Proposition 3, we introduce two alternative lower bound estimators of the contribution of school/neighborhood choice to
student outcomes.
var​(​Z2s
​ ​​ ​G2​​​  + ​v​s​​)​. Due to the presence of ​​X​s​​​ in
The first lower bound estimator is ​​ˆ
(21) it will be purged of any effects of student sorting (observable or unobservable).
Thus, it only captures school/neighborhood factors. The component ​v​ s​​​​ includes ​​​zs̃ ​​  U​  ​​  ,
the unpredicted component of the school/neighborhood contribution. However, for
postsecondary outcomes such as college enrollment and permanent wage rates ​v​ s​​​​ will
also include ​​ξs​ ​​​. Recall that ​​ξs​ ​​​is an index of common ­location-specific shocks (such
as local labor demand shocks) that occur after the chosen cohort has completed high
school. One can argue that such shocks should not be attributed to schools because
they are beyond the control of school or town administrators. This bias is likely
to be second order for permanent wages because the effect on our random effects
estimator of ​​vs​​​​of local shocks that persist for less than the seven years between
sample members’ wage observations will be muted. But we pointed out in Section
IIB that ​v​ s​​​​will also contain an approximation error if the linearity Assumption A4
is violated. This could lead to upward bias in our estimates of variance of school/
neighborhood effects.
Consequently, we also consider a second, more conservative lower bound estivar​(Z
​ 2s
​ ​​ ​G2​​​)​. This estimator only attributes to schools/neighborhoods the part
mator: ​​ˆ
of the residual b­ etween-school variation that could be predicted based on observvar​
​ ​​ ​G​2​​)​
able characteristics of the schools at the time students were attending. ˆ
​​ (​Z2s
excludes true school quality variation that is orthogonal to observed characteristics,
but also excludes any truly idiosyncratic local shocks that occur after graduation.19
The estimators of the variance and covariance terms in (23) account for sampling error in the regression coefficient estimators. For example, our estimator of
​var(​Z​2s​​ ​G​2​​)​ is
1 ​  ​∑​ ​​ ​Z​ ​​​ˆ
ˆ ​​ ​​ ​​G
ˆ ​​  ​ ​​  Z​  ′ ​)​ − ​ _
ˆ ​​2​​) ​Z​  ′s(i)​ ​.​
var​(Z
​ 2s
​ ​​ ​G​2​​) = ​ _
​  1 ​  ​∑​ ​​  (​Z​ ​​ ​​G
var​(​​G
	​​ˆ
[ N i s(i) 2 ′2 s(i) N i s(i)
]

In practice, we incorporate student weights into the sums in the equation above. See
online Appendix A9.D for more detail. Online Appendix A10 discusses how the
empirical variance decomposition is implemented.
C. Interpreting the Lower Bound Estimates
The static sorting model presented in Section I is silent about when in a student’s childhood the school/neighborhood decision is made, although Section IIB
briefly discusses an extension of Proposition 1 to a dynamic model. To illustrate
how different assumptions about timing affect the interpretation of our bounds, consider first the case in which changing schools/communities is costless, so that each
family decides each year where to live and send their children to school. In this
case, if the data are collected in tenth grade (as in ELS2002), then any impact of
prior schools/neighborhoods can be thought of as entering the outcome equation
19
The linear approximation error component might also bias ​G
​ ​2​​​ , but we think this is likely to be minor given
that we are controlling for ​​Xs​​​​.

2924

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

by altering the observable or unobservable student contributions ​​X​i​​​and ​​X​ Ui​  ​​. Thus,
if prior schooling inputs affect WTP for school/neighborhood amenities, our control function argument suggests that tenth grade school averages of ​X
​ i​​​​will absorb
all ­between-school variation in prior school contributions to ​​X​ Ui​  ​​. In this case, the
residual variance contributions v​ ar(​Z​2s​​ ​G​2​​)​ or ​var(​Z​2s​​ ​G2​​​  + ​v​s​​)​that we identify will
represent a lower bound on the contributions of only the high schools and their surrounding neighborhoods to our outcomes.
Now consider the opposite extreme: moving costs are prohibitive, and each family
makes a one-time choice about where to settle down when they begin to have children. Suppose that the observed characteristics ​​X​i​​​are unaffected by early schooling,
as is the case in our baseline specification discussed in Section VC. In this scenario,
​ ​​ ​G2​​​  + ​v​s​​)​that we identify
the residual variance contributions v​ ar(​Z​2s​​ ​G2​​​)​ or ​var(​Z2s
will represent a lower bound on the variation in contributions to our later outcomes
of entire sequences of schools (elementary, middle, and high) and entire childhoods
of neighborhood exposure. In reality, of course, moving costs are substantial but not
prohibitive, so that our estimates probably reflect a mix of elementary school and
high school contributions, with a stronger weight on high school contributions.20
However, note that as long as high school quality in a neighborhood is positively
correlated with elementary and middle school quality, a lower bound estimate of
the variance of high school contributions is itself a (very conservative) lower bound
estimate of the variance of contributions of entire school systems. Thus, since our
goal is to create a lower bound, the safest interpretation is that our estimates represent lower bounds on the variance of the cumulative effects of growing up in different school systems/neighborhoods.
D. Measuring the Effects of Shifts in School/Community Quality
The fraction of outcome variance unambiguously attributable to school/neighborhood factors provides a good indication of the importance of school/community
factors relative to ­student-specific factors. However, the effect of a shift in school/
community quality from the left tail of the distribution to the right tail of the distribution might be socially significant even if most of the outcome variability is
­student-specific. This is particularly true in the case of binary outcomes such as high
school graduation and college enrollment, where many students may be near the
decision margin. Below we report lower bounds on the effect of a shift in school/
neighborhood quality from 1.28 standard deviations below the mean to 1.28 standard deviations above the mean. This would correspond to a shift from the tenth
percentile to the ninetieth percentile if this component has a normal distribution. We
interpret these as lower bound estimates of the average change in outcomes from

20
This interpretation is consistent with the evidence on moving in our data. In the ELS2002 base year survey,
parents report the number of years they have lived in the current neighborhood: 22.5 percent report 3 years or less,
29.9 percent report 4–7 years, 14.3 percent report 8–10 years, and 42.3 percent report more than 10 years. Parents
also report the number of times the student changed schools, not counting natural transitions resulting from grade
advancement (e.g., from the elementary school building to the middle school building). The values are 43.3 percent
for no changes, 24.0 percent for 1 change, 12.5 percent for 2 changes, 9.9 percent for 3 changes, 5.3 percent for 4
changes, and 5.0 percent for 5 changes.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2925

a ­tenth-to-ninetieth quantile shift in the full distribution of school/neighborhood
quality, where the average is taken over the distribution of student contributions.
var​
​ ​​ ​G2​​​  + ​v​s​​)​to calculate the
The more comprehensive estimates use ˆ
​​ (​Z2s
var​(​Z2s
​ ​​ ​G2​​​)​. For
­tenth-ninetieth shifts, while the more conservative estimates use ​​ˆ
binary outcomes, we estimate the effect of the shift in ​​Z2s
​ ​​ ​G2​​​​ via

0.5
ˆ ​​1​​ ​  + ​‾
ˆ ​​2​​ ​  + 1.28​(​ˆ
ˆ ​ + ​‾
ˆ ​​s​​ ​​G
90
10
​​X
​Z2s
​ ​​ ​​G
var​(​Z2s
​ ​​ ​G​2​​))​​  ​]
[​Xi​​​​B
1
_
_________________________________
ˆ
ˆ
 ​
​ 
   
​
(24) ​E[​ ​​Y ​​​  ​  − ​​Y ​​​  ​]​  = ​  I ​ ​∑​ ​​ ​wi​​​  Φ​      
(
)
​(1 + ​ˆ
var​(​vs​​​))​​  0.5​
i

ˆ ​​1​​ ​  + ​‾
ˆ ​​2​​ ​  − 1.28 ​(​ˆ
ˆ ​ + ​‾
ˆ ​​s​​ ​​G
​​X
​Z2s
​ ​​ ​​G
var​(​Z2s
​ ​​ ​G2​​​))​​  0.5​]
[​X​​​​B
1 ​  ​∑​ ​​ ​w​​​  Φ​ _________________________________
 ​
−  ​ _
     
​  i
   
​, ​
i
0.5
I i
(
)
​(1 + ​ˆ
var​(​vs​​​))​​  ​

where ​
I​is the sample size, Φ
​
​is the cumulative distribuˆ ​​1​​ ​​ and
ˆ ​​s​​ ​​G
tion function (CDF) of a standard normal, and ‾
​​​X
​
‾
ˆ ​​2​​ ​​are the means across sampled schools of ​​X
ˆ ​​1​​and ​​Z2​s​​ ​​G
ˆ ​​2​​ , and ​​wi​​​ are
ˆ ​​s​​ ​​G
​​​Z2​s​​ ​​G
­individual-level weights. This average effectively integrates over the distribution of​​
X​i​​  B + ​v​si​​​ , but uses the empirical distribution of ​​Xi​​​  B​since it is observed instead of
imposing normality. Note that the scale of the latent index ​Y
​ ​si​​​is unobserved, so we
have normalized ​var( ​vs​i​​  − ​v​s​​  )​to 1.
We estimate the effect of the shift in ​​Z​2s​​ ​G2​​​  + ​v​s​​​analogously via
(25)

ˆ ​​1​​ ​  + ​‾
ˆ ​​2​​ ​  + 1.28 ​(​ˆ
ˆ ​ + ​‾
ˆ ​​s​​ ​​G
90
10
[​Xi​​​​B
​​X
​Z2s
​ ​​ ​​G
var​(​Z2s
​ ​​ ​G​2​​  + ​v​s​​))​​  0.5​]
1 ​ ​∑​ ​​ ​w​​​  Φ​  ​ ____________________________________
​E​[​​Yˆ ​​​  ​  − ​​Yˆ ​​​  ​]​  = ​ _
     
   
 ​
i
(
)​
I i
(1)

ˆ ​​1​​ ​  + ​‾
ˆ ​​2​​ ​  + 1.28 ​(​var​
ˆ ​ + ​‾
ˆ ​​s​​ ​​G
ˆ(​Z2s
[​Xi​​​​B
​​X
​Z2s
​ ​​ ​​G
​ ​​ ​G​2​​  + ​v​s​​))​​  0.5​]
1 ​ ​∑​ ​​ ​w​​​  Φ​  ​ ____________________________________
− ​ _
     
   
 ​
i
(
)​​.
I i
(1)

We also report lower bound estimates of the impact of a ­tenth-to-fiftieth percentile
shift in school/neighborhood quality (a 1.28 standard deviation shift). Researchers
often use a 1 standard deviation shift in treatment variable when assessing treatment
effect sizes. Another natural benchmark would be based on the distribution of shifts
in school/neighborhood quality resulting from moves that parents make, but we
have not found a way to estimate this with our data.
​ 2s
​ ​​ ​G2​​​  + ​v​s​​  )​ will
For the binary outcomes, the impact of a shift in ​​Z​2s​​ ​G2​​​​or ​(Z
depend on the values of a student’s observable characteristics, ​​Xi​​​  B​. Thus, we report
average impacts for certain subpopulations of interest as well.21
V. Data and Variable Selection

A. Overview of Data Sources
Our analysis uses data from four distinct sources. The first three sources consist of panel surveys conducted by the National Center for Education Statistics:
21
With a nonseparable education production function, the ordering of school/neighborhoods and the size of the
effects depend on ​X
​ i​​​​. See Agrawal, Altonji, and Mansfield (2017).

2926

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

the National Longitudinal Study of 1972 (NLS72), the National Educational
Longitudinal Survey of 1988 (NELS88), and the Educational Longitudinal Survey
of 2002 (ELS2002). These data sources possess a number of common properties
that make them well suited for our analysis. First, each samples an entire cohort of
American students. The cohorts are students who were twelfth graders in 1972 in
the case of NLS72, eighth graders in 1988 for NELS88, and tenth graders in 2002
for ELS2002. Second, each source provides a representative sample of American
high schools or eighth grades and samples of students are selected within each
school. Both public and private schools are represented.22 Enough students are
­sampled from each school to permit construction of estimates of the school means
of a large array of ­student-specific variables and to provide sufficient ­within-school
variation to support the variance decomposition described above. Third, each survey
administered questionnaires to school administrators in addition to sampled individuals at each school. This provides us with a rich set of both ­individual-level
and s­ chool-level variables to examine. Fourth, each survey collects ­follow-up information from each student past high school graduation, facilitating analysis of the
impact of high school environment on two or more of the outcomes economists and
policymakers care most about: the dropout decision, college enrollment, number of
completed years of college, and wage rates.
While these common properties are very helpful, differences in the surveys complicates efforts to compare results across time. In Altonji and Mansfield (2011), we
only used variables that are available and consistently measured across all three
datasets. However, because the efficacy of the control function approach introduced
in this paper depends on the richness and diversity of our s­ tudent-level measures,
for each dataset we include in ​​X​i​​​­student-level measures that may not appear in the
other datasets. Section VC details the process by which we chose what to include in​​
​ ​​​ , and Table 1 provides a list.
X​i​​​  , ​​Xs​​​​ , and ​​Z2s
The one major drawback associated with the three panel surveys is that the number of students sampled per school is only about 18 in NLS72, 24 in NELS88, and
20 in ELS2002. The simulation results presented in online Appendix A6 indicate
that samples of this size may reduce to some degree the ability of sample school
averages of observable characteristics ​​X
​ˆ ​​s​​​to serve as an effective control function for
variation in average unobservable student contributions across schools.
Consequently, we also exploit administrative data from North Carolina on the
universe of public schools and public school students (including charter schools)
in the state. Since the North Carolina data contain information on every student at
each school, they do not suffer from the same small subsample problem as the panel
surveys. Furthermore, we can use the North Carolina data to assess the potential
for bias in our s­urvey-based estimates more directly. Specifically, we draw samples of students from North Carolina schools using either the NLS72, NELS88, or
ELS2002 sampling schemes and ­reestimate the model for high school graduation
using these samples. By comparing the results derived from such samples to the true
results based on the universe of students in North Carolina, we can determine which
22
We include private schools because they are an important part of the education landscape. However, the
connection between characteristics of the school and characteristics of the neighborhood may be weaker for private
school students.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2927

if any of the survey datasets is likely to produce reliable results. Online Appendix
Tables A10 and A11 report the results of this exercise. They show that using school
sample sizes whose distributions match the NLS72, NELS88, or ELS2002 distrivar​
​ ​​ ​G2​​​)​ and
butions produces only relatively minor biases, generally making ˆ
​​ (​Z2s
ˆ
var​
​ 2s
​ ​​ ​G2​​​  + ​v​s​​)​ more conservative by less than ten percent of their full sample
​​ (Z
values.
The North Carolina data are also the most recent: data are collected for all
­2004–2006 public school ninth graders. On the other hand, high school graduation
is the only outcome we observe. And the set of observable characteristics is not as
diverse as in the panel surveys, though it is surprisingly rich for administrative data.
We restrict our samples to those individuals whose school administrator filled
out a school survey, and who have n­ onmissing information on the outcome variable
and the following key characteristics: race, gender, socioeconomic status (SES), test
scores, region, and urban/rural status.23 We then impute values for the other explanatory variables to preserve the sample size, since no other single variable is critical
to our analysis.24 Finally, we use panel weights. The appropriate weights depend on
the analysis. See online Appendix A12 for the details.
B. Outcome Measures
The outcome variables are defined as follows. The measure of college attendance
is an indicator for whether the student is enrolled in a four-year college in the second
year beyond the high school graduation year of his/her cohort.25 It is not available
in the North Carolina data. For NELS88 and ELS2002 the measure of high school
graduation is an indicator for whether a student has a high school diploma (not
including a GED) as of two years after the high school graduation year of his/her
cohort. For the North Carolina data, the measure is an indicator for whether the
student is classified as graduated for the official state reporting requirement. Notice,
though, that since ELS2002 first surveys students in tenth grade, it misses a substantial fraction of the early dropouts. Indeed, in NELS88, about one-third of the 16
percent who eventually drop out do so before the first follow up survey in the middle
of tenth grade. The North Carolina data considers students as eligible for official
dropout statistics if they are enrolled in a North Carolina school at the beginning
of ninth grade, so there is little scope for underestimating the dropout rate. Given
that NLS72 first surveys students in twelfth grade, we cannot properly examine
dropout behavior in this dataset. However, because NLS72 ­resurveys students in
1979 and 1986, when respondents are around 25 and 32 years old, respectively, we
23

SES and urban/rural status are not available in the North Carolina data.
This results in sample sizes (rounded to the nearest 10) for the ­four-year college enrollment analyses of:
12,260 from 900 schools for NLS72, 12,390 from 960 schools for NELS88, and 12,170 from 690 schools for
ELS2002. The sample sizes and number of schools for the high school graduation analyses are 12,310 and 940
for NELS88; 12,100 and 690 for ELS2002; and 284,090 and 340 for North Carolina, respectively. The analysis of
years of postsecondary education uses 12,230 observations from 900 schools from NLS72, and the wage analysis
uses 4,930 individuals with 9,860 wage observations from 900 schools. All individuals present in the base year are
ˆ ​​s​​​. We include mother’s education combined with a missing indicator for mother’s education when
used to compute ​​​X
performing imputation, along with school averages of all the key characteristics above. Online Appendix Tables
A12–A19 report percent imputed for each variable.
25
In NLS72 enrollment status is reported in ­January–March of the second full school year after graduation,
while in NELS88 and ELS2002 it is reported in October.
24

2928

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

can use it to analyze completed years of postsecondary education and wages during
adulthood. We use years of academic education as of 1979, because attrition and
subsampling reduced the 1986 sample by a considerable amount relative to the 1979
­follow-up survey, and most respondents have completed their education as of 1979.
For the permanent wage analysis, our estimation procedure requires that we include
only respondents who report wages in both 1979 and 1986.
C. Selection of Control Function Variables, ​​Z​2s​​​and ​​Xi​​​​
First, we discuss ​X
​ s​​​​. As we pointed out in Section I, the control function variables
∗
(referred to as ​​C​  s​  ​​in that section) should contain means of individual variables that
influence school/neighborhood choice. We do not want to rule out the possibility that
variables that affect ​​Y​i​​​also influence choice. Consequently, ​​C​  ∗s​  ​​includes ​​X​s​​​ , the group
means of all variables in ​​X​i​​​. In our application, we do not have ​​Q​i​​​variables that shift
location preferences but not outcomes. Consequently, ​C
​ ​  ∗s​  ​​is limited to ​​Xs​​​​and does not
contain any ​​Qs​ ​​​variables. Note that school-level averages of student-level variables
that affect choice should be included in the control function even if one does not have
individual-level data. There are no such variables in the datasets we use.
What should be in ​Z
​ 2s
​ ​​​? Observed school and neighborhood characteristics that
could plausibly influence the socioeconomic outcome of interest. School policies,
such as school security policies, belong in ​Z
​ ​2s​​​even if the policies are in part a
response to the characteristics of students. Under Proposition 1, the coefficients on
the school policies are not affected by sorting bias. Any individual student who
switches schools will be subject to the full difference across schools in the policy.
School-level variables that are determined both by school policy/efficacy and the
behavior of the students fall in a gray area. In ELS2002, we include Frequency of
Fights at the school in control function variables in our full specification (described
below) rather than in ​​Z​2s​​​. This variable is determined by both school and neighborhood quality and by observed and unobserved characteristics of students. Consider
the case in which Frequency of Fights is the sum of an unobserved school polU
U
icy variable, say ​​Z​  fight,
s​​ , and some elements of ​​X​s​​​and ​​X​  s​  ​​. Provided the spanning
condition holds, the ​G
​ ​2​​​coefficient corresponding to Frequency of Fights will not
U
be contaminated by sorting bias. It will be identified by variation in ​Z
​ ​  fight,
s​​that is
orthogonal to ​X
​ ​s​​​and the included ​​Z​2s​​​variables. However, because part of the variation across schools in Frequency of Fights is driven by the direct effect of ​X
​ U​  s​  ​​ on
fighting, one would overstate the importance of differences in school policy toward
fighting if one were to treat Frequency of Fights as a ​Z
​ 2s
​ ​​​variable when measuring
U
​ ​  fight,
the variance of school treatment effects.26 The fact that the policy variable ​Z
s​​ is
U
​ ​  s​  ​​is not a problem. To the extent school policy
in part a function of ​​X​s​​​ and/or ​X
and the skill of teachers and the administration have a big effect on fighting, we are
being conservative in our estimates of school effects. The same issues apply to test

26
Let F
​ requency_of_Fight​ss​​​  = ​Z​  fiUght, s​ ​​a​1​​  + ​X​s​​ ​a​2​​  + ​X​ Us​  ​ ​a​3​​​where ​​a1​​​​  , ​​a2​​​​ , and ​​a3​​​​are coefficients or coefficient
U
U
vectors. Let ​G
​ 2FF
​ ​​​be the coefficient on ​Frequency_of_Fight​s​s​​​. The variance ​(​ ​G​2FF​​  )​​  2​  var(​Z​  fight,
s​ ​​a​1​​  + ​X​s​​ ​a​2​​  + ​X​  s​  ​ ​a​3​​)​
U
is likely to overstate ​​(G
​ ​2FF​​  )​​  2​  var(​Z​  fight,
​ ​s​a​1​​)​ , which is the contribution of the policy variation in school policy toward
fighting.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2929

scores measured during high school. Test scores are determined by school quality
and by student characteristics. We never include them in ​​Z2s
​ ​​​. This is conservative.
What should not be in ​​Z​2s​​?​ ​​Z​2s​​​should exclude variables that are simple aggregates of parent/student traits that might also affect willingness to pay for neighborhood characteristics and thus lead to sorting. These are ​X
​ ​s​​​variables regardless
of whether the measures are aggregates of the student microdata, Census data or
ˆ ​​s​​​breaks multiadministrative data from the schools. Even if sampling error in ​​​X
collinearity among the components of ​X
​ ​s​​​that exists when the spanning condition
ˆ ​​s​​​should not be included in ​​Z2s
​ ​​​because they pick up effects of​​
holds, elements of ​​​X
​ s ​​. In contrast, it may be prudent in some applications to treat group characteristics
x​  U
that are strongly related to the amenities that drive sorting as part of the control
function rather than as part of ​​Z2s
​ ​​​if ​​Xs​​​​is too limited to plausibly control for sorting.
The cost is likely to be a more conservative lower bound.
​​Xi​​​​should include variables that directly affect the outcome and/or are correlated
with unobserved s­ tudent-level characteristics that affect the outcome. In our “baseline”
specification, we only use ­student-level characteristics that are unlikely to be affected
by the high school the child attends. However, we also provide results from a “full”
specification which includes in ​​Xi​​​​measures of student behavior (e.g., fighting, hours/
week spent on homework), parental expectations, and student academic ability (standardized test scores) and includes the corresponding school averages in ​​X​s​​.​Such measures may be influenced directly by school inputs, so including them in ​​Xi​​​​could cause
an underestimate of the contribution of ­school-level inputs (our lower bound estimates
will be too conservative). On the other hand, excluding such measures from ​X
​ i​​​​and ​​Xs​​​​
could instead cause an overestimate of the contribution of ­school-level inputs if the
sparser set of student observables no longer satisfies the spanning condition stated in
Proposition 1. In this case there would exist differences in average unobservable student contributions to outcomes across schools that are not predicted by the vector of
school averages of observable characteristics used as the control function.
Table 1 lists the final choices of ­individual-level and ­school-level explanatory
measures used in each dataset. Online Appendix Tables A12–A19 provide the mean,
standard deviation, and percent of observations imputed for each ­individual-level
and ­school-level characteristic for each of our four datasets.
VI. Results

We now turn to the results. Along with the point estimates, we report bootstrap
standard error estimates based on r­esampling schools with replacement, with 500
replications. We bootstrap the entire estimation procedure, including imputation of
missing data, estimation of model parameters, variance decompositions, and treatment effects. To preserve the size distribution of the samples of students from particular schools, we divide the sample into five school sample size classes and resample
schools within class.
A. High School Graduation
The full variance decompositions described in Section IV are provided for each
of our outcomes in online Appendix Tables A20, A21, and A22. Panel A of Table 2

2930

OCTOBER 2018

THE AMERICAN ECONOMIC REVIEW

Table 1—Variables Used in Baseline and Full (in Italics) Specifications, by Dataset
Description of variables
Student characteristics
Race indicators, 1(female)
1(immigrant)
Student ability
Math standardized score, reading standardized score
1(gifted at math), 1(gifted at reading)

NLS72

NELS88

ELS2002

NC

X
X

X
X

X
X

X

X

X

X

X
X

X
X

X
X
X
X

X
X

Student behavior
Hrs./wk. spent on homework
Hrs./wk. spent on leisure reading, hrs./wk. spent watching TV
Hrs./wk. spent on computer
1( physical fight this year), parents often check homework
Family background
Standardized SES, number of siblings
Indicators for presence of biological parents
Father’s years of education, mother’s years of education
Mother’s years education missing
Average of grandparents’ education
log(family income), 1(English spoken at home)
Indicators for parental religion
1(parents are married)
1(immigrant father), 1(immigrant mother)
Indicators for father’s occupation group
Indicators for mother’s occupation group
Home environ. indicators (first prin. comp.)
Parental school involved indicators (first prin. comp.)
1(eligible for free/reduced price lunch)
1(currently limited English proficiency), 1(ever LEP)

X
X
X
X
X

X
X
X
X

X
X

X
X
X
X
X
X
X
X

X

School characteristics (treated as elements of ​Z
​ 2s
​ ​​)
1 (Catholic school), 1 (private ­Non-Catholic school)
Total school enrollment, ­student-teacher ratio
log(min. teacher salary)
Percent teacher turnover, percent of teachers w/master’s degrees or more
Percent of teachers w/certification
School teacher pct. minority
1(minimum competency test exists)
1(gifted program exists), 1(collectively bargained contract)
1(tracking system), age of school building
Distance to f­ our-year college, distance to community college
Teacher evaluation mechanism indicators (first principal component)
Teacher incentives indicators (first principal component)
School security policy indicators (first, second principal components)
School security implementation indicators (first and second principal comps.)
School environ. indicators (first and second principal comps.)
School facilities indicators (admin. survey, first and second principal comps.)
Teacher access to tech. indicators (administrator survey, first principal comp.)
Magnet school, charter school, school technical percent highly qualified
Number of library books per student
Neighborhood characteristics (treated as elements of ​​Z2s
​ ​​)
Urbanicity indicators
Indicators for US census region
Neighborhood crime level category (school administrator survey)

X
X

X
X

Parental expectations
Mother’s desired years of education, father’s desired years of education
School characteristics (treated as elements of ​X
​ s​​​)
School pct. minority
School pct. free/reduced price lunch
School pct. LEP, school pct. special education
School pct. remedial reading, school pct. remedial math
Frequency of fights (administrator’s impression)

X
X
X
X
X
X
X
X
X
X
X
X
X

X

X

X

X
X
X
X
X

X
X
X
X
X

X
X
X

X
X
X
X

X

X

X
X
X
X
X
X
X

X
X

X
X
X

X

X
X
X
X
X
X
X
X
X

X
X

X
X

X
X
X

X

Notes: School characteristics treated as elements of ​X
​ s​​​​are included to reduce measurement error in school sample averages of student characteristics. They do not contribute to the estimated lower bound on contributions of
schools/neighborhoods. School averages of all ­student-level variables are also included in each specification. The
school population average is used where available (see the “School characteristics (treated as elements of ​​Xs​​​​ )” category in this table); otherwise the average among sampled students is used in its place.

VOL. 108 NO. 10

2931

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

Table 2—Lower Bound Estimates of the Contribution of School Systems and Neighborhoods to
High School Graduation Decisions
Lower bound:

NC
Baseline
(1)

NELS88 gr8
Full
(2)

Baseline
(3)

Full
(4)

ELS2002
Baseline
(5)

Full
(6)

Panel A. Fraction of latent index variance determining graduation attributable to school/neighborhood quality
LB no unobs
0.018
0.010
0.011
0.006
0.012
0.009
 ​var( ​Z​2s​​ ​G​2​​ )​
(0.008)
(0.004)
(0.006)
(0.007)
(0.010)
(0.009)
LB w/unobs
 ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.051
(0.017)

0.038
(0.010)

0.050
(0.009)

0.044
(0.010)

0.032
(0.010)

0.021
(0.009)

Panel B. Effect on graduation probability of a school system/neighborhood at the fiftieth or ninetieth percentile of
the quality distribution versus the tenth percentile
LB no unobs: t­enth–ninetieth
based on v​ ar( ​Z​2s​​ ​G​2​​ )​

0.104
(0.019)

0.079
(0.010)

0.064
(0.013)

0.048
(0.022)

0.047
(0.013)

0.041
(0.013)

LB w/unobs: ­tenth–ninetieth
based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.178
(0.023)

0.153
(0.016)

0.135
(0.017)

0.128
(0.019)

0.076
(0.012)

0.062
(0.012)

LB no unobs: ­tenth–fiftieth
based on ​var( ​Z​2s​​ ​G​2​​ )​

0.055
(0.011)

0.042
(0.006)

0.035
(0.008)

0.026
(0.012)

0.026
(0.008)

0.022
(0.008)

LB w/unobs: ­tenth–fiftieth
based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.098
(0.015)

0.084
(0.010)

0.079
(0.010)

0.073
(0.012)

0.044
(0.008)

0.034
(0.007)

0.769

0.769

0.827

0.827

0.897

0.897

Sample mean

Notes: Bootstrap standard errors based on resampling at the school level are in parentheses. Panel A reports lower
bound estimates of the fraction of variance in the latent index that determines high school graduation that can
be directly attributed to school/neighborhood choices for each dataset. The row labeled “LB no unobs” reports
​var( ​Z​2s​​ ​G​2​​ )​and excludes the unobservable ​​v​s​​while the row labeled “LB w/unobs” reports ​var( ​Z2s
​ ​​ ​G2​​​ + ​v​s​​ )​.
Panel B reports estimates of the average effect of moving students from a school/neighborhood at the tenth quantile of the quality distribution to one at the fiftieth or ninetieth quantile. Columns 1 and 2 are based on the North
Carolina data and refer to a decomposition that uses the ninth grade school as the group variable. Columns 3 and 4
are based on the NELS88 sample and refer to a decomposition that uses the eighth grade school as the group variable. Columns 5 and 6 are based on the ELS2002 sample and refer to a decomposition that uses the tenth grade
school as the group variable. For each dataset the variables used in the baseline and full models are specified in 1.
The full variance decompositions underlying these estimates are presented in online Appendix Table A20. Online
Appendices A9 and A10 discuss estimation of model parameters and the variance decompositions. Section IVD discusses estimation of the ­10–50 and ­10–90 differentials.

displays our lower bound estimates of the fraction of variance in the latent index
that determines high school graduation that can be directly attributed to school/
neighborhood choices for each dataset. The first row presents estimates that exclude​
var(​vs​​​)​ (labeled “no unobs”), while the second row presents estimates that include​
var(​vs​​​)​ (labeled “w/unobs”). However, recall that the rationale for excluding ​​v​s​​​ is
that it may reflect common shocks that occur after high school that may not be
responsive to any changes in school or neighborhood policies. Since graduation
is not a p­ ostsecondary outcome, ​​vs​​​​is likely to contain only school and neighborhood contributions that are orthogonal to the observed s­ chool-level measures ​Z
​ ​2s​​​
(or sorting bias if the spanning condition from Proposition 1 fails). Thus, for high
school graduation we focus on the results that contain ​​v​s​​​. The first column displays
the results from the baseline specification using the North Carolina data: our lower
bound estimate is that at least 5.1 percent of the total ­student-level variance in the
latent index can be attributed exclusively to school system and neighborhood contributions. Since the set of observed ­individual-level measures contained in ​​Xi​​​​ is

2932

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

limited in the North Carolina data, it is possible that the WTP coefficient matrix Θ
​ ​
associated with our control function of ­school-averages ​​Xs​​​​does not span ​​Θ​​  U​​ and
thus the full amenity space, so that unobservable sorting bias may contribute to
this estimate. Thus, the second column displays results from the full specification
that augments ​​Xi​​​​by adding past test scores and measures of behavior. Since these
measures could potentially have been altered by the school, including them removes
some true school system contributions, but also makes the spanning condition in
Proposition 1 more plausible. The estimated lower bound falls from 5.1 percent to
3.8 percent of the latent index variance.
NELS88 features a slightly smaller fraction of the variance attributable to schools/
neighborhoods than NC in the baseline specification (5.0 percent versus 5.1 percent)
and a slightly larger fraction in the full specification (4.4 percent versus 3.8 percent).
The values for ELS2002 are smaller in both baseline and full cases (3.2 percent
and 2.1 percent). Aside from sampling error, the fact that the three datasets start
at different points (eighth grade, ninth grade, and tenth grade) and that NELS88
and ELS2002 have richer controls and school-level variables should lead to some
differences across the datasets. The relatively sparse set of ­student-level variables
for North Carolina (even in the full specification) may be a factor. It might lead ​​v​s​​​
to contain some ­between-school variation in student unobservables ​x​ ​  U
s​  ​​that is unabsorbed by the control function (the spanning condition in Proposition 1 fails). By
contrast, ELS2002 has the richest set of both ­student-level and ­school-level observables, so that there is little residual ­school-level variation that cannot be captured by
​ ​​​.
either the control function ​​X​s​​​or the s­ chool-level observables ​​Z2s
The small fractions of variance attributed to schools in panel A are consistent
with the considerable literature emphasizing the importance of student talent, parental inputs, and even luck relative to school and neighborhood inputs in determining
who completes high school. Online Appendix Table A20 provides a full variance
decomposition that shows the critical role that i­ndividual-specific factors play.
However, to get a better sense of the difference that an effective school system and
neighborhood can make, we use the two alternative lower bound variance estimates
with (24) and (25) to form estimates of the average impact on the probability of
graduation across the distribution of student contributions of choosing a school at
the ninetieth percentile of the distribution of school/neighborhood contributions
instead of a school at the tenth percentile. The estimates are in panel B of Table 2.
They correspond to a thought experiment in which two students at each quantile in
the student contribution distribution are placed either in the tenth or the ninetieth
quantile school system, and the difference in the graduation status of these pairs is
summed over all such pairs.
The most striking feature of the results is the large magnitude of the estimated
changes in graduation rates. For North Carolina, the estimate from the baseline specification suggests that, averaged across the student distribution, attending a ninetieth
quantile school increases graduation rates by a whopping 17.8 percentage points
relative to a school at the tenth quantile (from 67.4 percent to 85.2 percent). The corresponding estimates are 13.5 percentage points for NELS88 (78.1 percent to 91.6
percent) and 7.6 percentage points for ELS2002 (86.6 percent to 94.3 percent). Even
the more conservative estimates from the full specification, which likely removes
mostly true school/neighborhood contributions, suggest increases in g­ raduation

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2933

rates from a ­tenth-to-ninetieth quantile shift of 15.3, 12.8, and 6.2 percentage points
in NC, NELS88, and ELS2002, respectively. Notice further that the latter estimates
are quite large despite the fact that the fractions of variance upon which they are
based is small: 3.8, 4.4, and 2.1 percent for NC, NELS88, and ELS2002. One reason
for this seeming disconnect is that squaring of deviations to produce variances will
naturally mute moderate differences in school contributions relative to the standard
deviations on which the 1­ 0–90 shifts are based. A second reason may be related
to our reliance on the probit function and the assumption of normality. If the true
distribution of latent student contributions is normal, and the graduation rate is not
too high, then there is likely to be a large mass of students near the decision margin.
Thus, even a small push from the surrounding school/neighborhood environment
may be enough to induce a significant fraction of students to graduate.
Note that differences in the treatment effect estimates across datasets reflect both
differences in the variances of the school/neighborhood component and differences
in the sample average graduation rates across the datasets. The graduation rate is
77 percent in the North Carolina data, 83 percent in NELS88, and 90 percent in
ELS2002. As a result, a shift of the same magnitude will induce a greater increase
in graduation rate in the North Carolina and NELS88 data than in ELS2002 because
there are fewer students near the decision margin in ELS2002. Intuitively, as the
sample average converges to 100 percent graduation almost the entire population is
well above the decision threshold. Consequently, s­ chool-related shifts in the latent
index that determines graduation become less relevant.
Assuming the conditions of Proposition 1 are satisfied or nearly satisfied, the
large lower bound estimates suggest that school systems and neighborhoods have a
considerable role to play in determining which students graduate from high school.
B. Enrollment in a ­Four-Year College
Panel A of Table 3 presents results for the decomposition of the latent index determining enrollment in a f­our-year college. Comparing the baseline specifications
from NLS72, NELS88, and ELS2002 (columns 1, 3, and 5), we observe consistency in both of the lower bound estimates of the school/neighborhood contribution across datasets and generations. In the baseline case, estimates that exclude the
­between-school residual ​​vs​​​​attribute at least 1.7 to 2.7 percent of the outcome variance to schools/neighborhoods, while estimates that include ​v​ ​s​​​attribute 4.8 to 5.2
percent. Including test scores and behavioral variables reduces these lower bound
estimates in a consistent fashion across the three panel surveys (columns 2, 4, and
6), with the estimates that exclude the residual ​v​ s​​​​dropping to between 1.4 and 1.8
percent, and the estimates that include the residual ​v​ ​s​​​dropping to between 3.7 and
3.8 percent.
Panel B of Table 3 converts these variance fractions into the more easily interpreted average impacts of a t­ enth-to-ninetieth quantile shift in school/neighborhood
environment. Note that the sample average college enrollment rate is 27 percent in
NLS72, 31 percent in NELS88, and 37 percent in ELS2002. Since more of the students are far from the college attendance threshold in 1972, fewer of them reach the
decision margin for a given shift in school/neighborhood environment relative to
the cohorts from later generations. Despite these differences in baseline enrollment

2934

OCTOBER 2018

THE AMERICAN ECONOMIC REVIEW

Table 3—Lower Bound Estimates of the Contribution of School Systems and Neighborhoods to
Four-Year College Enrollment Decisions
Lower bound:

NLS72
Baseline
(1)

NELS88 gr8
Full
(2)

Baseline
(3)

Full
(4)

ELS2002
Baseline
(5)

Full
(6)

Panel A. Fraction of latent index variance determining enrollment attributable to school/neighborhood quality
LB no unobs
0.027
0.018
0.017
0.015
0.019
0.014
 ​var( ​Z​2s​​ ​G2​​​ )​
(0.006)
(0.005)
(0.006)
(0.005)
(0.010)
(0.008)
LB w/unobs
 ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.048
(0.009)

0.038
(0.007)

0.049
(0.009)

0.038
(0.008)

0.052
(0.017)

0.037
(0.011)

Panel B. Effect on enrollment probability of a school system/neighborhood at the fiftieth or ninetieth percentile of
the quality distribution versus the tenth percentile
LB no unobs: t­enth–ninetieth
0.140
0.115
0.123
0.111
0.138
0.116
based on v​ ar( ​Z​2s​​ ​G2​​​ )​
(0.016)
(0.013)
(0.018)
(0.017)
(0.020)
(0.020)
LB w/unobs: ­tenth–ninetieth
based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.189
(0.019)

0.166
(0.017)

0.208
(0.020)

0.180
(0.020)

0.230
(0.021)

0.188
(0.020)

LB no unobs: ­tenth–fiftieth
based on ​var( ​Z​2s​​ ​G​2​​ )​

0.065
(0.007)

0.054
(0.006)

0.059
(0.008)

0.053
(0.008)

0.067
(0.009)

0.057
(0.009)

LB w/unobs: ­tenth–fiftieth
based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.086
(0.008)

0.077
(0.007)

0.096
(0.009)

0.084
(0.009)

0.108
(0.010)

0.090
(0.009)

0.267

0.267

0.310

0.310

0.365

0.365

Sample mean

Notes: Bootstrap standard errors based on resampling at the school level are in parentheses. The notes to Table 2
apply, except that Table 3 reports results for enrollment in a f­ our-year college two years after graduation. The column headed NLS72 refers to a variance decomposition that uses the twelfth grade school as the group variable.

rates, the estimated lower bounds on the increase in the f­our-year enrollment rate
from moving every student (one at a time) from the tenth to the ninetieth quantile
school/neighborhood are fairly consistent across generations. When the residual
component ​v​ s​​​​is excluded and the full specification is considered, the estimates for
each dataset are between 11.1 and 11.6 percentage points (row 1, columns 2, 4, and
6 of panel B). Specifically, a tenth to ninetieth quantile shift in the school/neighborhood component ​​Z2s
​ ​​ ​G2​​​​increases enrollment rates from 21.2 percent to 32.7 percent
in NLS72, from 25.7 percent to 36.8 percent in NELS88, and from 31.0 percent to
42.6 percent in ELS2002. Including the residual ­between-school component boosts
the range of estimates to 16.6 to 18.8 percentage points. For this specification a
­tenth-to-fiftieth quantile shift has an average estimated impact ranging from 7.7 and
9.0 percentage points. Estimates are larger for the baseline set of controls.
As with the estimates for high school graduation, the estimates in Table 3 suggest
that schools and neighborhoods also play an important role in determining who
enrolls in a f­ our-year college.
C. Heterogeneous Effects of Tenth-Ninetieth Percentile Shifts in School Quality
The estimates reported in panel B of Tables 2 and 3 are based on starting the full
distribution of students at a tenth quantile school/neighborhood versus starting them
at a ninetieth quantile school/neighborhood. However, many of the students with
superior background characteristics would be quite unlikely to ever be observed in

VOL. 108 NO. 10

2935

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

Table 4—The Impact of Tenth-Ninetieth Percentile Shifts in School Quality on High School
Graduation Rates for Selected Subpopulations
NC
Subpopulation:
XB: Tenth quantile
LB no unobs
   based on ​var( ​Z​2s​​ ​G​2​​ )​

NELS88 gr8

ELS2002

Baseline
(1)

Full
(2)

Baseline
(3)

Full
(4)

Baseline
(5)

Full
(6)

0.144
(0.023)

0.120
(0.015)

0.109
(0.024)

0.090
(0.041)

0.082
(0.023)

0.086
(0.028)

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.247
(0.027)

0.233
(0.022)

0.233
(0.030)

0.241
(0.037)

0.134
(0.021)

0.128
(0.024)

XB: Ninetieth quantile
LB no unobs
   based on ​var( ​Z​2s​​ ​G​2​​ )​

0.060
(0.013)

0.031
(0.005)

0.019
(0.004)

0.011
(0.005)

0.013
(0.004)

0.006
(0.002)

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.100
(0.017)

0.058
(0.008)

0.039
(0.005)

0.027
(0.005)

0.021
(0.004)

0.009
(0.002)

Black
LB no unobs
   based on ​var( ​Z​2s​​ ​G​2​​ )​

0.105
(0.019)

0.079
(0.010)

0.067
(0.015)

0.052
(0.024)

0.053
(0.016)

0.050
(0.017)

0.153
(0.016)

0.142
(0.018)

0.138
(0.021)

0.086
(0.014)

0.075
(0.015)

White w/single mother who did not attend college
LB no unobs
0.141
0.109
   based on ​var( ​Z​2s​​ ​G​2​​ )​
(0.018)
(0.010)

0.098
(0.022)

0.076
(0.021)

0.066
(0.012)

0.057
(0.011)

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.179
(0.023)

0.210
(0.016)

0.208
(0.028)

0.202
(0.019)

0.108
(0.011)

0.085
(0.010)

White w/both parents, at least one completed college
LB no unobs
0.058
0.041
   based on ​var( ​Z​2s​​ ​G​2​​ )​
(0.013)
(0.006)

0.029
(0.006)

0.020
(0.009)

0.021
(0.007)

0.016
(0.006)

LB w/unobs
  based on ​
Var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.242
(0.023)

0.098
(0.017)

0.079
(0.009)

0.060
(0.008)

0.052
(0.009)

0.034
(0.006)

0.024
(0.005)

Notes: Bootstrap standard errors based on ­resampling at the school level are in parentheses. The table reports the
average effect for the subpopulation indicated by the row heading of moving students from a school/neighborhood
at the tenth quantile of the quality distribution to one at the ninetieth quantile. “XB: tenth quantile” and “XB: ninetieth quantile” refer to students whose values of ​​X​i​​  B​is equal the estimated tenth (ninetieth) quantile value of the​​
X​i​​  B​distribution. See Section VIC. See the notes to Table 2 for row and column definitions.

a tenth quantile environment. A more realistic estimate might place greater weight
on the i­ ndividual-specific estimates associated with the kinds of students most likely
to be observed in tenth quantile schools. While our method does not allow us to
discern the quality of any given school, we can nonetheless explore the extent to
which the estimates in Tables 2 and 3 conceal heterogeneity in the relative impact
of alternative schools across students with varying student backgrounds. Due to the
nonlinearity in the probit function that links ​Y
​ ​si​​​to the binary outcome indicators
for high school graduation and enrollment in a ­four-year college, the sensitivity to
ˆ ​​that place them closer to an
school quality is higher for groups with values of ​X
​ i​​​​B
outcome probability of 0.5. High school graduation is therefore more sensitive to
school quality for disadvantaged groups and less sensitive for advantaged groups.
The opposite tends to be true for enrollment in a f­ our-year college.
Table 4 reports the lower bounds (excluding and including the s­ chool-level residual ​​vs​​​​) for the effect of a tenth to ninetieth percentile shift in school quality on

2936

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

g­ raduation rates for two extreme cases: students whose value of the background index
ˆ ​​places them at the tenth quantile of the ​​Xi​​​​B
ˆ ​​ distribution (rows 1 and 2), and stu​​Xi​​​​B
ˆ
dents at the ninetieth quantile of the ​​Xi​​​​B ​​ distribution (rows 3 and 4). For the North
Carolina sample and the full specification (column 2), the lower bound estimate
that includes the b­ etween-school residual component ​v​ ​s​​​suggests a 23.3 percentage
point increase for students at the tenth quantile (42.8 percent to 66.1 percent). The
increase is only 5.8 percent for students at the ninetieth quantile (91.9 percent to
97.7 percent). For NELS88 grade 8 (column 4), the numbers are very similar at the
tenth quantile but smaller at the ninetieth quantile. The lower bound estimates that
include ​v​ ​s​​​are 24.1 percentage points (54.2 to 78.3) at the tenth quantile and 2.7 percentage points (96.7 percent to 99.4 percent) at the ninetieth quantile. The ELS2002
ˆ ​​and only 0.9 percent at the
estimate is 12.8 percent at the tenth percentile of ​X
​ ​i​​​B
ninetieth, reflecting the lower dropout rate in ELS2002. The results for all three
datasets suggest that advantaged students tend to graduate high school regardless of
the school they attend, while disadvantaged students are strongly affected by school
quality.
Table 4 also reports the average impact of a ­tenth-ninetieth shift on high school
graduation rates for three subpopulations of interest: black students, white students
with single mothers who did not attend college, and white students with both parents present, at least one of whom completed college. For the full specification in
the North Carolina sample, the shift increases the predicted graduation rate among
black students by 15.3 percentage points from 68.3 percent to 83.6 percent. The
corresponding increase for white students with single mothers who did not attend
college is 21.0 percentage points (49.5 percent to 70.5 percent), while the increase
for white students with both parents present, at least one of whom completed college, is 7.9 percentage points (87.8 percent to 95.7 percent). Across all specifications, the estimated increases in graduation rates in the NELS88 and ELS samples
are between 5.0 and 14.2 percentage points for black students and 5.7 and 20.8 for
white students with single mothers who did not attend college.
Table 5 reports a corresponding set of results for enrollment in a f­our-year
­college. The college enrollment rates for students at the tenth percentile of the
ˆ ​​d­ istribution are substantially less sensitive to school quality. This reflects the
​​X​i​​​B
fact that most such students are nowhere near the ­four-year college enrollment margin. For example, the ELS2002 estimate from the full specification suggests that
a ­tenth-ninetieth shift in the school system/neighborhood component ​​Z2s
​ ​​ ​G​2​​  + ​v​s​​​
would increase the college enrollment rates of students at the tenth percentile of
ˆ ​​from 2.0 percent to 9.0 percent. More generally, the lower bound estimates that
​​X​i​​​B
exclude and include ​​v​s​​​are between 2.6 and 9.1 percentage points and between 3.6
and 15.0 percentage points, respectively, depending on the dataset and specification.
ˆ ​​the ELS2002 estimate
In contrast, for students at the ninetieth percentile of ​​X​i​​​B
from the full specification suggests that a ­tenth-ninetieth shift in ​Z
​ 2s
​ ​​ ​G​2​​  + ​v​s​​​ would
increase enrollment rates at f­ our-year colleges by 18.1 percentage points (from 72.3
percent to 90.4 percent). More generally, across datasets the lower bound estimates
ˆ ​​ distri​ i​​​​B
excluding and including ​​vs​​​​for students at the ninetieth percentile of the ​X
bution are between 11.2 and 19.3 percentage points and 18.1 and 26.5 percentage
points, respectively. The values for blacks and for whites with ­non-college-educated
single mothers are about 1 percent and about 3 percent (respectively) below the

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2937

Table 5—The Impact of ­Tenth–Ninetieth Percentile Shifts in School Quality on ­Four-Year College
Enrollment Rates for Selected Subpopulations
Subpopulation:
XB: Tenth quantile
LB no unobs
   based on ​var( ​Z​2s​​ ​G​2​​ )​

NLS72
Baseline
Full
(1)
(2)

NELS88 gr8
Baseline
Full
(3)
(4)

ELS2002
Baseline
Full
(5)
(6)

0.079
(0.010)

0.070
(0.011)

0.091
(0.014)

0.026
(0.004)

0.044
(0.007)

0.044
(0.009)

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.105
(0.012)

0.036
(0.005)

0.118
(0.013)

0.070
(0.009)

0.150
(0.016)

0.070
(0.009)

XB: Ninetieth quantile
LB no unobs
   based on ​var( ​Z​2s​​ ​G​2​​ )​

0.193
(0.022)

0.177
(0.020)

0.155
(0.022)

0.142
(0.021)

0.150
(0.021)

0.112
(0.020)

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.260
(0.026)

0.258
(0.027)

0.265
(0.025)

0.231
(0.026)

0.246
(0.023)

0.181
(0.021)

Black
LB no unobs
   based on ​var( ​Z​2s​​ ​G​2​​ )​

0.132
(0.016)

0.105
(0.013)

0.122
(0.018)

0.111
(0.017)

0.131
(0.019)

0.107
(0.018)

0.153
(0.017)

0.208
(0.020)

0.180
(0.020)

0.217
(0.021)

0.174
(0.019)

White w/single mother who did not attend college
LB no unobs
0.110
0.094
   based on ​var( ​Z​2s​​ ​G2​​​ )​
(0.016)
(0.014)

0.098
(0.018)

0.081
(0.017)

0.126
(0.021)

0.110
(0.021)

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.178
(0.020)

0.137
(0.018)

0.166
(0.021)

0.131
(0.021)

0.210
(0.023)

0.178
(0.022)

White w/both parents, at least one completed college
LB no unobs
0.182
0.154
   based on ​var( ​Z​2s​​ ​G2​​​ )​
(0.020)
(0.018)

0.149
(0.022)

0.138
(0.021)

0.154
(0.022)

0.129
(0.022)

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

LB w/unobs
   based on ​var( ​Z​2s​​ ​G​2​​ + ​v​s​​ )​

0.148
(0.020)

0.246
(0.025)

0.224
(0.023)

0.254
(0.025)

0.225
(0.025)

0.256
(0.024)

0.209
(0.023)

Notes: Bootstrap standard errors based on resampling at the school level are in parentheses. The notes to Table 4
apply, except that Table 5 reports results for enrollment in a ­four-year college two years after graduation, and the
NLS72 is one of the datasets.

results for the full sample. The values for whites with college-educated parents are
ˆ ​​ distribution.
close to those for the ninetieth percentile of the ​X
​ i​​​​B
Overall, it appears that, except for the lowest stratum of student background,
many students are close enough to the decision margin for a major shift in school
quality to be a deciding factor in determining enrollment in a ­four-year college.
D. NLS Results for Years of Postsecondary Education and Permanent log Wages
Table 6 displays the lower bound estimates of the impact of t­enth-to-ninetieth
and ­tenth-to-fiftieth shifts in school/neighborhood quality on years of postsecondary education and permanent log wages for the NLS72 sample. The baseline lower
bound estimate that excludes the ­between-school residual ​v​ s​​​​implies that a ­10–90
shift in school quality increases years of postsecondary education by 0.22 years,
which is about 0.12 standard deviations. Including standardized tests among the
observable characteristics reduces this estimate to 0.02 years, which is not statistically significant. The lower bound is not informative in this case. Note, though, that

2938

OCTOBER 2018

THE AMERICAN ECONOMIC REVIEW

Table 6—Lower Bound Estimates of the Contribution of School Systems and Neighborhoods to
Completed Years of Postsecondary Education and Permanent Wages (NLS72 Data)
Yrs. postsec. ed.
Baseline
(1)

Full
(2)

Perm. wages
no ­postsec. ed.
Baseline
(3)

Panel A. Fraction of variance attributable to school/neighborhood quality
LB no unobs
0.002
0.000
0.025
 ​var( ​Z​2s​​ ​G​2​​ )​
(0.002)
(0.001)
(0.010)
LB w/unobs
 ​var( ​Z2s
​ ​​ ​G​2​​ + ​v​s​​ )​

0.013
(0.004)

0.009
(0.003)

0.070
(0.019)

Perm. wages
w/­postsec. ed.

Full
(4)

Baseline
(5)

Full
(6)

0.028
(0.011)

0.032
(0.012)

0.033
(0.012)

0.070
(0.019)

0.085
(0.023)

0.082
(0.022)

Panel B. Effects on years of postsecondary education and permanent wages of a school system/neighborhood at
the fiftieth or ninetieth percentile of the quality distribution versus the tenth percentile
LB no unobs: t­enth-ninetieth
0.216
0.018
0.121
0.128
0.125
0.128
based on v​ ar( ​Z2s
​ ​​ ​G​2​​ )​
(0.064)
(0.064)
(0.021)
(0.022)
(0.021)
(0.022)
LB w/unobs: ­tenth-ninetieth
based on ​var( ​Z2s
​ ​​ ​G​2​​ + ​v​s​​ )​

0.502
(0.077)

0.407
(0.076)

0.203
(0.031)

0.203
(0.030)

0.203
(0.031)

0.200
(0.031)

LB w/unobs: ­tenth-fiftieth
based on ​var( ​Z2s
​ ​​ ​G​2​​ + ​v​s​​ )​

0.251
(0.039)

0.203
(0.038)

0.102
(0.016)

0.102
(0.015)

0.102
(0.016)

0.100
(0.015)

1.62

1.62

2.88

2.88

2.88

2.88

LB no unobs: ­tenth-fiftieth
based on ​var( ​Z2s
​ ​​ ​G​2​​ )​

Sample mean

0.108
(0.032)

0.009
(0.032)

0.061
(0.011)

0.064
(0.011)

0.063
(0.011)

0.064
(0.011)

Notes: Bootstrap standard errors based on resampling at the school level are in parentheses. Panel A of Table 5
reports lower bound estimates of the fraction of variance of years of postsecondary education and permanent wage
rates (with and without controls for postsecondary education) that can be directly attributed to school/neighborhood choices for each dataset. The sample is NLS72. The row labeled “LB no unobs” reports v​ ar( ​Z​2s​​ ​G2​​​ )​ and
excludes the unobservable ​v​ s​​​while the row labeled “LB w/unobs” reports v​ ar( ​Z2s
​ ​​ ​G2​​​ + ​v​s​​ )​. Panel B reports estimates of the average effect of moving students from a school/neighborhood at the tenth quantile of the quality dis0.5
tribution to one at the fiftieth or ninetieth quantile. It is equal to 2​ × 1.28​times the value of [​
​​ ˆ
var​( ​Z2​s​​ ​G​2​​  + ​v​s​​  ) ]​​  ​​ or​​
0.5
[​ˆ
var​( ​Z2​s​​ ​G2​​​  ) ]​​  ​​ in the corresponding column of the table. See Table 1 for the variables in the baseline model and
the full model. The full variance decompositions are in online Appendix Table A22. Online Appendix Tables A9 and
A10 discuss estimation of model parameters and the variance decompositions.

since the NLS72 data are collected in twelfth grade, the standardized test scores
are particularly likely to reflect high school quality, making the full specification
particularly conservative. Furthermore, adding in the contribution of ​​vs​​​​raises these
estimates to 0.50 and 0.41 years respectively. Collectively, the estimates suggest a
substantive impact of shifts in school quality on years of college education.
Columns ­3–6 contain analogous estimates for the permanent component of log
wages. Columns 3­ –4 reflect specifications in which years of postsecondary education is not included as a control, while columns 5­ –6 include years of postsecondary
education to focus on the effect on log wages that does not occur via postsecondary
education. In practice, the two sets of estimates are quite similar. The estimates that
exclude the residual ​v​ s​​​​imply that a 1­ 0–90 shift in school quality increases wages
by around 13.7 percent (​100 ​e​​  0.128​  − 100)​. The ­10–50 shifts are one-half as large
at around 6.6 percent. Estimates that include ​v​ ​s​​​imply that a 1­ 0–90 shift in school/
neighborhood quality increases wages by 0.20 log points or about 22 percent. For
comparison, standard deviation of the log permanent wage component is 0.305.
Thus, at least for the 1972 cohort, shifts in school/neighborhood quality seem to

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2939

have important impacts on longer-run outcomes of prime importance for worker
welfare.
Chetty and Hendren (2018) find that 20 years in a 1 standard deviation better
neighborhood raises the log of adult earnings by about 0.10 (0.06) for children
whose parents were at the twenty-fifth (seventy-fifth) percentile of parental income.
When we include ​v​ s​​​​we find that a 1 standard deviation shift in school/neighborhood raises log permanent wage rates by 0.078.27
E. Alternative Estimators
In this subsection we compare our lower bound estimates above with two alternative estimators of school and neighborhood effects more commonly observed in
the literature.
In online Appendix Tables A1 and A2, we report estimates of
, or equivalently ​
var(​Ys​​​  − ​X​s​​  B)​
. By including ​
​Xs​​​ ​G1​​​​  ,
​var(​X​s​​ ​G1​​​  + ​Z​2s​​ ​G​2​​  + ​v​s​​  )​ 
these estimates reintroduce peer effects that operate through school averages of
observable or unobservable student characteristics as well as other unobserved
​ ​​​. But ​​Xs​​​ ​G​1​​​also includes
school inputs that are predictable based on ​​Xs​​​​given ​​Z2s
U
the ­component ​X
​ s​​​ ​Π​x​​  i​  ​​Xs​​​​​​ , which reflects student sorting on unobservable charac​ ​ Ui​  ​​does not
teristics. In online Appendix A7, we show that ​X
​ ​s​​ ​Π​x​​  Ui​  ​​Xs​​​​​  = 0​when ​X
affect location preferences and the assumptions of Proposition 1 hold, in which case
. This is the true variance in
​var(​Xs​​​ ​G1​​​  + ​Z​2s​​ ​G​2​​  + ​v​s​​) = var(​Zs​​​  Γ + ​z​  U
s​  ​  + ​ξ​s​​  )​
school/neighborhood treatment effects (including common shocks). When unobservables do contribute to sorting, then ​var(​X​s​​ ​G​1​​  + ​Z​2s​​ ​G2​​​  + ​v​s​​  )​will generally
overstate the variance in school/neighborhood treatment effects.28
Indeed, across all of the specifications and outcomes for the panel surveys these
estimates are noticeably larger than our lower bound estimates. For example, for
the full specification in ELS2002, the s­orting-on-observables estimator attributes
3.2 percent of the variance in the latent index that determines high school graduation to schools/neighborhoods, compared to 2.1 percent for the lower bound estimate of ​var(​Z​2s​​ ​G2​​​  + ​vs​​​)​. The associated effect of a t­enth-to-ninetieth quantile shift
in school/neighborhood quality on graduation is 0.077 (relative to 0.062 for the
lower bound estimate).29 For enrollment in a f­our-year college, the corresponding
school/neighborhood variance fractions for the ELS full specification is 4.3 percent
27
Sources of the difference in estimates include differences in the outcome measure (wage rate versus earnings), school/neighborhood geography (school versus county), birth cohort, period of exposure to a school/neighborhood, and the fact that our estimates are lower bounds.
28
From (14), (18), and (19), ​var(​Xs​​​ ​G​1​​  + ​Z​2s​​ ​G​2​​  + ​v​s​​) = var(​Zs​​​  Γ + ​z​  U
​​ ​β​​  U​  )​. If the covaris​  ​  + ​ξ​s​​  + ​X​s​​ ​Π​​x​  U
i​  ​​Xs​​​
ances between ​X
​ s​​​ ​Π​x​​  Ui​  ​​X​s​​​​​and the components of the school treatment effect ​​Zs​​​  Γ + ​z​  U
s​  ​  + ​ξ​s​​​are sufficiently negative, then one can find v​ ar(​Xs​​​ ​G​1​​  + ​Z​2s​​ ​G2​​​  + ​v​s​​  ) < var(​Zs​​​  Γ + ​z​  U
s​  ​  + ​ξ​s​​  )​. In this case, which we consider unlikely,
even ​var(​X​s​​ ​G​1​​  + ​Z​2s​​ ​G​2​​  + ​v​s​​  )​would understate the true contribution of schools/neighborhoods to the variance in
outcomes.
29
The effects of a ­ten-to-ninetieth shift in ​​Xs​​​ ​G​1​​  + ​Z​2s​​ ​G​2​​  + ​v​s​​​are constructed as

​(26)

ˆ ​​1​​ ​  + ​‾
ˆ ​​2​​  + 1.28 ​(​ˆ
ˆ ​ + ​‾
ˆ ​​s​​ ​​G
90
10
[ ​Xi​​​​B
​​X
​Z2s
​ ​​ ​ ​​G
var​( ​Xs​​​ ​G​1​​  + ​Z​2s​​ ​G​2​​  + ​v​s​​  ))​​  0.5​]
1 ​ ​∑​ ​​ ​w​​​  Φ​  ​ __________________________________________
E ​[ ​​Yˆ ​​​  ​  − ​​Yˆ ​​​  ​]​   = ​ _
      
   
​ ​
)
I i i (
(1)

ˆ ​​1​​ ​  + ​‾
ˆ ​​2​​  − 1.28 ​(​var​
ˆ ​ + ​‾
ˆ ​​s​​ ​​G
ˆ(​Xs​​​ ​G​1​​  + ​Z​2s​​ ​G2​​​  + ​v​s​​  ))​​  0.5​]
[ ​Xi​​​​B
​​X
​Z2s
​ ​​ ​ ​​G
1 ​ ​∑​ ​​ ​w​​​  Φ​  ​ __________________________________________
−  ​ _
      
   
​ ​.​
)
I i i (
(1)

2940

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

(versus 3.7 percent for the lower bound estimate). These variances correspond to
­tenth-to-ninetieth shifts in the probability of enrollment of 0.204 (versus 0.188).
ˆ
ˆ(​Z2s
​ s​​​ ​G1​​​  + ​Z​2s​​ ​G​2​​  + ​v​s​​)​is higher than ​​var​
​ ​​ ​G​2​​  + ​v​s​​  )​in every dataset and spec​​var​(X
ification we consider.
In online Appendix Table A3, we report estimates of v​ar(​Z2s
​ ​​ ​G​2​​)​ and
​var(​Z​2s​​ ​G2​​​  + ​v​s​​)​from a ­four-year college enrollment specification in which the
­school-averages ​​Xs​​​​are omitted. A small fraction of the variance previously absorbed
ˆ ​​2​​​ , while the bulk of it now enters
by the control function is now captured by ​​Z​2s​​ ​​G
var​(​Z2s
​ ​​ ​G​2​​)​increases slightly relative to our
the ­between-school residual ​​​vˆ ​​s​​​. Thus, ​​ˆ
var​
​ ​​ ​G​2​​  + ​v​s​​)​ increases­
main college enrollment estimates in Table 3, while ˆ
​​ (​Z2s
substantially, to the point that they typically exceed the ­sorting-on-observables estivar​
​ s​​​ ​G1​​​  + ​Z​2s​​ ​G2​​​  + ​v​s​​)​reported in the previous paragraph. Online Appendix
mates ˆ
​​ (X
Table A4 reports corresponding estimates for years of postsecondary education, and
again exhibits substantially higher estimates of v​ ar(​Z​2s​​ ​G​2​​  + ​v​s​​)​.
Taken together, the results from these alternative estimators suggest that our
lower bound estimates, while more conservative than other existing estimators, still
seem to capture a substantial portion of the variation in the contributions of schools/
neighborhoods.
F. Empirical Evidence on the Spanning Condition
In online Appendix A3 we explore the factor structure of ​​X​s​​​to test Assumption
A5.1, which is a necessary condition for Assumption A5 and therefore Proposition
1. Recall that Assumption A5.1 is violated if the number of amenity factors driving
sorting on ​​X​i​​​ (​​A​​  X​​  ) exceeds the number of observed characteristics that compose
​​X​i​​​ (​Dim(​Xi​​​  )​). We adopt two separate approaches. First, we use principal compovar​
nents analysis to compute the eigenvalues and eigenvectors of ˆ
​​ (​Xs​​​)​ , the estimated covariance matrix of ​X
​ s​​​​. While ​var(​X​s​​)​must be positive semidefinite,
ˆ
var​
​ s​​​)​need not be positive semidefinite given sampling error and the fact that our
​​ (X
sample is unbalanced. In practice we obtain small negative values for some of the
eigenvalues. We interpret these estimates as corresponding to eigenvalues that are in
fact zero or very close to zero. We find that for each of our three survey datasets the
var​
number of positive eigenvalues is less than ​L​ , indicating that ˆ
​​ (​Xs​​​)​is rank deficient. This means that each element of ​​Xs​​​​can be written as a linear combination of
a smaller number of latent factors (generally between 25 and 30 factors, depending
on the specification and dataset). Since the rank of v​ ar(​Xs​​​)​should reflect the dimension of the amenity vector ​A
​ ​​  X​​ , this supports our assumption that the dimension of​​
X
A​​  ​  ≤ L​. Indeed, we further show that in each dataset an even smaller number of
latent factors (generally around ten) can explain 90 percent of the sum of the variances of the elements of ​​X​s​​​ , suggesting that the variation in student composition
across schools is driven primarily by a small number of amenity factors. Bootstrap
90 percent confidence interval estimates of the number needed to explain 90 percent
of the variances are fairly tight. The number of latent factors required to explain a
given percentage of the sum of the variances of the elements of ​X
​ s​​​​is larger in the
full specification, which contains more variables. This would be expected in the
var​
presence of sampling error in ˆ
​​ (​Xs​​​)​. However, it might also indicate that there are
in fact a few additional amenity factors that play a very small role in driving sorting

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2941

(and thus have very small eigenvalues) and are picked up by the additional elements
of ​​Xs​​​​in the full specification.
Our second approach draws on the literature on testing for the number of factors
or the matrix rank, including Lewbel (1991), Cragg and Donald (1997), Robin and
Smith (2000), Bai and Ng (2002), and Kleibergen and Paap (2006). The test of the
rank of a matrix proposed by Kleibergen and Paap (2006) fits our application well.
var​
The test involves a singular value decomposition of ˆ
​​ (​Xs​​​)​ , and can accommodate
arbitrary forms of heteroskedasticity and correlation at the school level. We perform tests of the null hypothesis of ​rank(var(​Xs​​​)) = j)​against the alternative that
. For all three datasets and specifications, we cannot reject
​rank(var(​X​s​​)) > j​
the null hypothesis for values of j​​well below L
​ ​. See online Appendix Tables
A6 and A7.
VII. Concluding Remarks

In this paper we provide conditions under which the tactic of controlling for group
averages of observed ­individual-level characteristics can control perfectly for group
averages of unobservables. This insight leads to a way to estimate a lower bound on
the contribution of group effects to individual outcomes. We also examine the conditions under which causal effects of particular observed group characteristics can be
estimated. We apply our methodological insight and demonstrate its empirical value
by addressing a classic question in social science: how much does the school and
surrounding community that we choose for our children matter for their long-run
educational and labor market outcomes?
The key takeaway from the empirical analysis is that even conservative estimates
of the contribution of schools and surrounding neighborhoods to later outcomes suggest that improving school and neighborhood environments could have a substantial
impact on high school graduation rates and college enrollment rates. As we noted in
the introduction, prior evidence on this topic is mixed, in part because prior research
showing substantial ­across-school and ­across-neighborhood variation in outcomes is
subject to concerns about sorting on unobservables that we address in this paper.
The control function approach can also be applied to other situations in which
selective sorting into units makes identification of the independent effect of the units
difficult. In online Appendix A13, we consider identification of teacher value-added.
Teacher value-added is one of a set of problems in which sorting into groups (classrooms in this case) is mediated by an administrator rather than the result of individual choices. We show that most of the analysis in Section I can be adapted to the
teacher value-added application, although we have not yet extended Proposition 1 to
the case in which the administrator internalizes the effect that allocating a particular
student to a classroom has on the other students. Nevertheless, our analysis suggests
that the common practice of including classroom averages of student characteristics
(such as in Chetty, Friedman, and Rockoff 2014) may play a potentially powerful
role in purging ­value-added estimates of biases stemming from ­nonrandom student
sorting on unobservables and observables.
Importantly, unlike the school application, where we only bound the variance
of school effects, one can point identify teacher value-added because the treatment
of interest (the teacher) is observed in multiple groups or units (classrooms). The

2942

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

c­ lassrooms feature varying levels of other valued amenities (e.g., time of day) that
cause ­within-teacher variation in group composition. Recent work by Fletcher,
Horwitz, and Bradley (2014) uses patient data matched to physicians to estimate
the effects of physicians on health outcomes. They control for very detailed patient
characteristics but not for the ­physician-specific averages of patient characteristics.
Our analysis suggests that adding p­ hysician-clinic averages of patient characteristics for doctors who work in more than one setting would allay concerns about
sorting on patient unobservables.
Consider also cases in which a particular group input, say spending per pupil, varies experimentally or q­ uasi-experimentally across schools. This solves the problem
that spending per pupil is correlated with other unobserved education inputs, such
as peer quality. But as Caetano (2012) points out, individuals may r­ esort in response
to the change in spending, leading to bias in a ­difference-in-differences design. Our
analysis suggests that one might be able to identify the causal effect of spending by
combining an IV strategy with the use of school averages of individual characteristics to address the sorting problem.30
In principle, one could adapt the model of group choice and the control function
approach to the analysis of the effects of years of schooling, dosage levels, or other
endogenous choice problems that have a natural ordering. We leave an analysis of
this possibility to future research.31
We briefly discussed the possibility of using an outcome model that allows for
interactions between observed and unobserved student characteristics and observed
and unobserved neighborhood characteristics. We are currently pursuing this
in Agrawal, Altonji, and Mansfield (2017). Future research should also examine
whether a variant of Proposition 1 carries over to more general specifications of
preferences than the class that we work with, and to t­wo-sided selection problems,
such as the sorting of students across universities or workers across firms.
Appendix A
PROOF OF PROPOSITION 1:
Equation (2) states that the utility of each location ​s​depends on ​​Xi​​​​  , ​​X​ Ui​  ​​ , and ​​Q​i​​​
only through ​​W​i​​  .​This fact and independence of ​ε​ si​ ​​​from ​​Xi​​​​  , ​​X​ Ui​  ​​ , and ​​Qi​​​​imply that
(27)	​Pr(s(i ) = s | ​Xi​​​, ​X​  U
i​  ​, ​Qi​​​, ​Wi​​​  ) = Pr(s(i) = s | ​Wi​​​  )​

30
We have in mind an IV regression of ​​Yi​t​​​on ​​X​it​​​  , ​​Xs​t​​,​and ​​Z​2st​​​in the post-policy intervention period using the
p­ re-period value ​X
​ s​t−1​​​and the exogenous policy change as the excluded instrumental variables. Similarly, when
­resorting is not considered likely but the policy intervention instrument depends in part on ​​XU​  st−1
 ​
​ ​, using ​​X​st​​​to control for ​X
​ U​  st ​​​  might also lead to a valid IV strategy.
31
Let s​ ​denote number of years of schooling. Each schooling level has an associated set of characteristics ​​As​​​​
governing the pecuniary and ­nonpecuniary return to choosing level ​s​. ​​A​s​​​is weighted by ​​X​i​​​and ​​X​ Ui​  ​​. This leads to a
relationship between ​X
​ ​s​​​and ​​XU​  s​  ​​that could serve as the basis for a control function for ​X
​ U​  s​  ​​. However, as pointed out
at the beginning of Section IIB, there must be at least as many levels of s​ ​as there are elements of ​X
​ ​s​​​. Otherwise ​s​
will not vary conditional on ​X
​ ​s​​​unless restrictions are available that reduce the dimension of the index of ​X
​ ​s​​​ required
U
to control for ​​X​  s​  ​​. Essentially, there are fewer degrees of freedom (the number of levels) than there are parameters
in the coefficient vector on ​​X​s​​​ (​​G​1​​​in our outcome equation).

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2943

where ​Pr ( · )​is the probability function. The fact above and Bayes’ rule imply that32
(28)​	

f (​Xi​​​  | ​Wi​​​, s(i ) = s) = f (​Xi​​​  | ​Wi​​​  )

(29)

f (​X​ Ui​  ​  | ​Wi​​​, s(i) = s) = f (​X​ Ui​  ​  | ​Wi​​​  ).​

These equations then imply that ​
E [ ​X​i​​  | ​Wi​​​, s(i) = s ]   = E [ ​Xi​​​  | ​Wi​​​  ]​ and
. Consequently, using the Law of Iterated
​ [ ​X​ Ui​  ​ | ​Wi​​​, s(i) = s ]   = E [ ​X​ Ui​  ​ | ​Wi​​​  ]​
E
Expectations, we have
(30) ​​XU​  s​  ​  ≡ E[​X​ Ui​  ​  | s(i ) = s] = E[E(​X​ Ui​  ​  | ​Wi​​​, s(i ) = s)  | s(i ) = s ] = E[E(​X​ Ui​  ​  | ​Wi​​​  ) | s(i ) = s]
(31)  ​Xs​​​  ≡ E[​​Xi​​​​​  ​| s(i ) = s] = E[E(​​Xi​​​​​  ​| ​Wi​​​, s(i ) = s) | s(i ) = s] = E[E(​​Xi​​​​​  ​|  ​Wi​​​  ) | s(i ) = s ] .​
Next we find expressions for E
​ [​X​ Ui​  ​ | ​Wi​​​  ]​and E
​ [ ​X​i​​  | ​Wi​​​  ]​ , which appear in the equa​​ ​i​​​is uncortions above. Since by construction ​​​X̃ ​​ Ui​  ​​is uncorrelated with ​​Xi​​​​ , and Q
related with both ​X
​ ​i​​​and ​​​X̃ ​​ Ui​  ​​  ,
(32)	​cov(​W​  ′i​​  , ​​X̃ ​​ Ui​  ​  ) = cov(​Θ​​  ​U′ ​​ ​​X̃ ​​ ​Ui​  ′ ​​  , ​​X̃ ​​ Ui​  ​  ) = ​Θ​​  U′​var( ​​X̃ ​​ Ui​  ​  )

(33)

cov(​W​  ′i​​  , ​Xi​​​  ) = cov(​Θ̃ ​′ ​X​  ′i​​  , ​Xi​​​  ) = ​Θ̃ ​′var( ​Xi​​​  ) .​

Since from Assumption A4 ​E[ ​X​i​​  | ​Wi​​​  ]​and ​E[ ​X​ Ui​  ​ | ​Wi​​​  ]​are linear in ​​Wi​​​​  , ​E[ ​​X̃ ​​ Ui​  ​ | ​Wi​​​  ]​
is also linear in ​W
​ i​​​​. Consequently, Assumption A4, equations (32)–(33), and basic
regression theory imply that
W​i​​  var ​( ​W​i​​  )​​  −1​  cov( ​W​  ′i​​  , ​​X̃ ​​ Ui​  ​  )  = ​
Wi​​​  var ​(​Wi​​​  )​​  −1​ ​Θ​​  ​U′ ​​  var( ​​X̃ ​​ Ui​  ​  )
(34) ​E [ ​​X̃ ​​ Ui​  ​  | ​Wi​​​  ]  = ​

(35)  
E [ ​Xi​​​  | ​Wi​​​  ]  = ​Wi​​​  var ​( ​Wi​​​  )​​  −1​  cov( ​W​  ′i​​  , ​Xi​​​  )  = ​W​i​​  var ​( ​Wi​​​  )​​  −1​ ​Θ̃ ​​′var( ​Xi​​​  ) .​

​ ′​R′ ​​ in (34), and
Next, if we use the spanning Assumption A5 to replace ​​Θ​​  ​U′ ​​​with Θ
then use the expression for ​E [ ​X​i​​  | ​Wi​​​  ]​ from (35), we obtain
(36)	​
E [ ​​X ​​ ̃ Ui​  ​  | ​Wi​​​  ]  = ​Wi​​​  var ​( ​Wi​​​  )​​  −1​ ​Θ̃ ​′ ​R′ ​var( ​​X̃ ​​ Ui​  ​  )

	 = ​W​i​​  var ​( ​Wi​​​  )​​  −1​ ​Θ̃ ​′ var( ​Xi​​​  ) var ​( ​Xi​​​  )​​  −1​R′var( ​​X̃ ​​ Ui​  ​  )
= E [ ​Xi​​​  | ​Wi​​​  ] var ​( ​Xi​​​  )​​  −1​  R′ var( ​​X̃ ​​  U
i​  ​).​

32

One can write the conditional density ​f( ​Xi​​​  | ​W​i​​  , ​si​​​  = s)​ as

Pr (s(i) = s | ​Xi​​​, ​Wi​​​  ) f (​W​i​​  | ​Xi​​​  )
	​
f (​Xi​​​  | ​Wi​​​, ​si​​​  = s) = ​ ______________________
   
   ​   f (​X​i​​)
Pr (s(i) = s | ​Wi​​​  ) f (​Wi​​​  )
 	

Pr (s(i ) = s | ​Wi​​​  ) f (​Wi​​​  | ​Xi​​​  )
= ​ ____________________
   
   ​   f (​Xi​​​  )
Pr (s(i ) = s | ​Wi​​​  ) f (​Wi​​​  )
= f (​Xi​​​  | ​Wi​​​  )​,

where the first equality is Bayes’ rule, the second equality uses (27), and the third follows from cancellation of
terms and Bayes’ rule. The same line of argument establishes that ​f (​X​ Ui​  ​ | ​Wi​​​, s(i) = s) = f (​X​ Ui​  ​ | ​Wi​​​  )​.

2944

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

To find E
​ [ ​X​ Ui​  ​ | ​Wi​​​  ]​first take expectations of both sides of (5) conditional on ​W
​ i​​​​ :
​ U​​  ​X​​  + E [ ​​X̃ ​​ Ui​  ​  | ​Wi​​​  ] .​
(37)	​
E [ ​X​ Ui​  ​  | ​Wi​​​  ]   = E [ ​Xi​​​  | ​Wi​​​  ] ​Π​X
Substitution for E
​ [ ​​X̃ ​​ Ui​  ​ | ​Wi​​​  ]​ using (36) leads to

​ ​​  U​X​​  + var ​( ​X​i​​  )​​  −1​  R′ var( ​​X̃ ​​ Ui​  ​  )).​
(38)	​
E [ ​X​ Ui​  ​  | ​Wi​​​  ]   = E [ ​Xi​​​  | ​Wi​​​  ] ( ​Π​X
The final step is to take expectations of both sides of the equation above conditional
on ​s(i )   = s​and employ equations (30) and (31). Doing so leads to
​ ​​  U​X​​  + var ​( ​X​i​​  )​​  −1​  R′ var( ​​X̃ ​​ Ui​  ​  )  ] .​
	​
​XU​  s​  ​ = ​Xs​​​  [ ​Π​X
This completes the proof. ∎
REFERENCES
Aaronson, Daniel. 1998. “Using Sibling Data to Estimate the Impact of Neighborhoods on Children’s

Educational Outcomes.” Journal of Human Resources 33 (4): 915–46.

Ackerberg, Daniel A., Kevin Caves, and Garth Frazer. 2015. “Identification Properties of Recent Pro-

duction Function Estimators.” Econometrica 83 (6): 2411–51.

Agrawal, Mohit, Joseph Altonji, and Richard Mansfield. 2017. “Quantifying Family, School, and

Location Effects in the Presence of Complementarities and Sorting.” Unpublished.

Altonji, Joseph G. 1982. “The Intertemporal Substitution Model of Labour Market Fluctuations: An

Empirical Analysis.” Review of Economic Studies 49 (5): 783–824.

Altonji, Joseph G., Todd E. Elder, and Christopher R. Taber. 2005. “Selection on Observed and Unob-

served Variables: Assessing the Effectiveness of Catholic Schools.” Journal of Political Economy
113 (1): 151–84.
Altonji, Joseph G., and Richard K. Mansfield. 2011. “The Role of Family, School, and Community
Characteristics in Inequality in Education and Labor Market Outcomes.” In Whither Opportunity?
Rising Inequality, Schools, and Children’s Life Chances, edited by Greg Duncan and Richard Murnane, 339–58. New York: Russell Sage Foundation.
Altonji, Joseph G., and Richard K. Mansfield. 2014. “Group-Average Observables as Controls for
Sorting on Unobservables When Estimating Group Treatment Effects: The Case of School and
Neighborhood Effects.” NBER Working Papers 20781.
Altonji, Joseph G., and Richard K. Mansfield. 2018. “Estimating Group Effects Using Averages of
Observables to Control for Sorting on Unobservables: School and Neighborhood Effects: Dataset.”
American Economic Review. https://doi.org/10.1257/aer.20141708.
Angrist, Joshua D., Sarah R. Cohodes, Susan M. Dynarski, Parag A. Pathak, and Christopher R. Walters. 2016. “Stand and Deliver: Effects of Boston’s Charter High Schools on College Preparation,

Entry, and Choice.” Journal of Labor Economics 34 (2): 275–318.

Ash, Arlene S., Stephen F. Fienberg, Thomas A. Louis, Sharon-Lise T. Normand, Thérèse A. Stukel,
and Jessica Utts. 2012. Statistical Issues in Assessing Hospital Performance. Woodland, MD: The

Committee of Presidents of Statistical Studies–Centers for Medicare and Medicaid Series.

Bai, Jushan, and Serena Ng. 2002. “Determining the Number of Factors in Approximate Factor Mod-

els.” Econometrica 70 (1): 191–221.

Bayer, Patrick, Fernando Ferreira, and Robert McMillan. 2007. “A Unified Framework for Measur-

ing Preferences for Schools and Neighborhoods.” Journal of Political Economy 115 (4): 588–638.

Bayer, Patrick, and Stephen Ross. 2009. “Identifying Individual and Group Effects in the Presence of

Sorting: A Neighborhood Effects Application.” University of Connecticut Department of Economics Working Papers 2006–13.
Bayer, Patrick, and Christopher Timmins. 2005. “On the Equilibrium Properties of Locational Sorting
Models.” Journal of Urban Economics 57 (3): 462–77.
Berry, Steven T. 1994. “Estimating Discrete-Choice Models of Product Differentiation.” RAND Journal of Economics 25 (2): 242–62.

VOL. 108 NO. 10

ALTONJI AND MANSFIELD: ESTIMATING GROUP EFFECTS

2945

Browning, Martin, Pierre-André Chiappori, and Yoram Weiss. 2014. Economics of the Family: Cam-

bridge Surveys of Economic Literature. Cambridge, UK: Cambridge University Press.

Caetano, Gregorio. 2012. “Neighborhood Sorting and the Valuation of Public School Quality.” Unpub-

lished.

Chamberlain, Gary. 1980. “Analysis of Covariance with Qualitative Data.” Review of Economic Stud-

ies 47 (1): 225–38.

Chamberlain, Gary. 1984. “Panel Data.” In Handbook of Econometrics, Vol. 2, edited by Zvi Griliches

and Michael Intriligator, 1247–1318. Amsterdam: Elsevier.

Chetty, Raj, John N. Friedman, and Jonah E. Rockoff. 2014. “Measuring the Impacts of Teachers I:

Evaluating Bias in Teacher Value-Added Estimates.” American Economic Review 104 (9): 2593–632.

Chetty, Raj, and Nathaniel Hendren. 2018. “The Impacts of Neighborhoods on Intergenerational

Mobility II: County-Level Estimates.” Quarterly Journal of Economics 133 (3): 1163–1228.

Chetty, Raj, Nathaniel Hendren, and Lawrence F. Katz. 2016. “The Effects of Exposure to Better

Neighborhoods on Children: New Evidence from the Moving to Opportunity Experiment.” American Economic Review 106 (4): 855–902.
Chiappori, Pierre-André, and Bernard Salanié. 2016. “The Econometrics of Matching Models.” Journal of Economic Literature 54 (3): 832–61.
Cragg, John G., and Stephen G. Donald. 1997. “Inferring the Rank of a Matrix.” Journal of Econometrics 76 (1–2): 223–50.
Cullen, Julie Berry, Brian A. Jacob, and Steven Levitt. 2006. “The Effect of School Choice on Participants: Evidence from Randomized Lotteries.” Econometrica 74 (5): 1191–230.
Cunha, Flavio, James J. Heckman, Lance Lochner, and Dimitriy V. Masterov. 2006. “Interpreting the
Evidence on Life Cycle Skill Formation.” In Handbook of the Economics of Education, Vol. 1,
edited by Erik Hanushek and Finis Welch, 697–812. Amsterdam: Elsevier.
Cunha, Flavio, James Heckman, and Salvador Navarro. 2005. “Separating Uncertainty from Heterogeneity in Life Cycle Earnings.” Oxford Economic Papers 57 (2): 191–261.
Deming, David J., Justine S. Hastings, Thomas J. Kane, and Douglas O. Staiger. 2014. “School Choice,
School Quality, and Postsecondary Attainment.” American Economic Review 104 (3): 991–1013.
Doyle, Joseph J., Jr., John A. Graves, Jonathan Gruber, and Samuel A. Kleiner. 2015. “Measuring
Returns to Hospital Care: Evidence from Ambulance Referral Patterns.” Journal of Political Economy 123 (1): 170–214.
Duncan, G. J., and Richard J. Murnane. 2011. Whither Opportunity? Rising Inequality, Schools, and
Children’s Life Chances. New York: Russell Sage Foundation.
Durlauf, Steven N. 2004. “Neighborhood Effects.” In Handbook of Regional and Urban Economics,
Vol. 4, edited by Vernon Henderson and Jacques François Thisse, 2173–242. Amsterdam: Elsevier.
Ekeland, Ivar, James J. Heckman, and Lars Nesheim. 2004. “Identification and Estimation of Hedonic
Models.” Journal of Political Economy 112 (1): S60–109.
Epple, Dennis, and Glenn J. Platt. 1998. “Equilibrium and Local Redistribution in an Urban Economy
When Households Differ in Both Preferences and Incomes.” Journal of Urban Economics 43 (1):
23–51.
Epple, Dennis, and Holger Sieg. 1999. “Estimating Equilibrium Models of Local Jurisdictions.” Journal of Political Economy 107 (4): 645–81.
Fletcher, Jason M., Leora I. Horwitz, and Elizabeth Bradley. 2014. “Estimating the Value Added of
Attending Physicians on Patient Outcomes.” NBER Working Papers 22575.
Fu, Shihe, and Stephen L. Ross. 2013. “Wage Premia in Employment Clusters: How Important Is
Worker Heterogeneity?” Journal of Labor Economics 31 (2): 271–304.
Gómez, Eusebio, Miguel A. Gómez-Villegas, and J. Miguel Marín. 2003. “A Survey on Continuous
Elliptical Vector Distributions.” Revista Matemática Complutense 16 (1): 345–61.
Graham, Bryan S. 2018. “Identifying and Estimating Neighborhood Effects.” Journal of Economic
Literature 56 (2): 450–500.
Harding, David, Lisa Gennetian, Christopher Winship, Lisa Sanbonmatsu, and Jeffrey King. 2011.
“Unpacking Neighborhood Influences on Education Outcomes: Setting the Stage for Future
Research.” In Whither Opportunity? Rising Inequality, Schools, and Children’s Life Chances,
edited by Greg Duncan and Richard Murname, 277–96. New York: Russell Sage Foundation.
Heckman, James J., Rosa L. Matzkin, and Lars Nesheim. 2010. “Nonparametric Identification and
Estimation of Nonadditive Hedonic Models.” Econometrica 78 (5): 1569–91.
Imbens, Guido W. 2007. “Nonadditive Models with Endogenous Regressors.” In Advances in Economics and Econometrics, Ninth World Congress of the Econometric Society, Vol. 3, edited by Richard
Blundell, Whitney Newey, and Torsten Persson, 17–46. Cambridge UK: Cambridge University Press.
Jacob, Brian A. 2004. “Public Housing, Housing Vouchers, and Student Achievement: Evidence from
Public Housing Demolitions in Chicago.” American Economic Review 94 (1): 233–58.

2946

THE AMERICAN ECONOMIC REVIEW

OCTOBER 2018

Jencks, Christopher, and Susan E. Mayer. 1990. “The Social Consequences of Growing Up in a Poor

Neighborhood.” In Inner-City Poverty in the United States, Vol. 3, edited by Laurence E. Lynn and
Michael G. H. McGeary, 111–86. Washington, DC: National Academy Press.
Kleibergen, Frank, and Richard Paap. 2006. “Generalized Reduced Rank Tests Using the Singular
Value Decomposition.” Journal of Econometrics 133 (1): 97–126.
Kling, Jeffrey R., Jeffrey B. Liebman, and Lawrence F. Katz. 2007. “Experimental Analysis of Neighborhood Effects.” Econometrica 75 (1): 83–119.
Levinsohn, James, and Amil Petrin. 2003. “Estimating Production Functions Using Inputs to Control
for Unobservables.” Review of Economic Studies 70 (2): 317–41.
Lewbel, Arthur. 1991. “The Rank of Demand Systems: Theory and Nonparametric Estimation.”
Econometrica 59 (3): 711–30.
Lindenlaub, Ilse. 2017. “Sorting Multidimensional Types: Theory and Application.” Review of Economic Studies 84 (2): 718–89.
Lise, Jeremy, Costas Meghir, and Jean-Marc Robin. 2013. “Mismatch, Sorting and Wage Dynamics.”
NBER Working Papers 18719.
McFadden, Daniel. 1978. “Modeling the Choice of Residential Location.” Yale University Cowles
Foundation for Research in Economics Discussion Paper 477.
McFadden, Daniel L. 1984. “Econometric Analysis of Qualitative Response Models.” In Handbook
of Econometrics, Vol. 2, edited by Zvi Griliches and Michael Intriligator, 1395–1457. Amsterdam:
Elsevier.
Meghir, Costas, and Steven Rivkin. 2011. “Econometric Models for Research in Education.” In Handbook of Economics for Education, Vol. 3, edited by Eric A. Hanushek, Stephen Machin, and Ludger
Woessman, 1–87. Amsterdam: Elsevier.
Melo, Rafael Lopez de. 2018. “Firm Wage Differentials and Labor Market Sorting: Reconciling Theory
and Evidence.” Journal of Political Economy 126 (1): 313–46.
Mundlak, Yair. 1978. “On the Pooling of Time Series and Cross Section Data.” Econometrica 46 (1):
69–85.
Olley, G. Steven, and Ariel Pakes. 1996. “The Dynamics of Productivity in the Telecommunications
Equipment Industry.” Econometrica 64 (6): 1263–97.
Oreopoulos, Philip. 2003. “The Long-Run Consequences of Living in a Poor Neighborhood.” Quarterly Journal of Economics 118 (4): 1533–75.
Robin, Jean-Marc, and Richard J. Smith. 2000. “Tests of Rank.” Econometric Theory 16 (2): 151–75.
Rosen, Sherwin. 1974. “Hedonic Prices and Implicit Markets: Product Differentiation in Pure Competition.” Journal of Political Economy 82 (1): 34–55.
Rothstein, Jesse. 2014. “Revisiting the Impacts of Teachers.” http://eml.berkeley.edu/_jrothst/workingpapers/rothstein_crf.pdf.
Sampson, Robert J., Jeffrey D. Morenoff, and Thomas Gannon-Rowley. 2002. “Assessing ‘Neighborhood Effects’: Social Processes and New Direction in Research.” Annual Review of Sociology 28:
443–78.
Tiebout, C. M. 1956. “A Pure Theory of Local Expenditures.” Journal of Political Economy 64: 416–24.
Todd, Petra E., and Kenneth I. Wolpin. 2003. “On the Specification and Estimation of the Production
Function for Cognitive Achievement.” Economic Journal 113 (485): F3–33.

