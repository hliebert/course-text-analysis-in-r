arXiv:1808.04281v1 [cs.LG] 13 Aug 2018

Estimating Heterogeneous Causal Effects in the
Presence of Irregular Assignment Mechanisms
Falco J. Bargagli Stoffi

Giorgio Gnecco

IMT School for Advanced Studies, Lucca, Italy
falco.bargaglistoffi@imtlucca.it

IMT School for Advanced Studies, Lucca, Italy
giorgio.gnecco@imtlucca.it

new machine learning technique presented in this paper, the
subsets are selected by the algorithm itself in a data-driven
way. Classical approaches to the analysis of heterogeneous
effects are non-parametric methods, such as nearest neighbour matching method, kernel method, and series estimation
[18]. These techniques usually offer good results in terms of
estimation abilities. The drawback is that they perform well
as far as the number of covariates is low. Machine learning
techniques outperform other non-parametric methods when the
number of covariates is relatively high. This can be seen as
the reason that led recently to the application of machine
learning techniques to causal discovery and inference. A good
example of the use of machine learning techniques in these
fields, and a very important inspiration for the present work,
is the recently published paper [3], where an adaptation to
causal inference of CART in its regression version, named
Causal Tree (henceforth, CT), was developed to estimate
causal effects with instrumental variables. While the goal of
the method proposed in [3] is very similar to the one of
the algorithm we develop in this paper (namely, to draw
proper causal inference in the presence of irregular assignment
mechanisms), the CT algorithm can identify the heterogeneity
of causal effects with respect to a particular subset of selected
covariates, where the selection needs to be done by the
researcher herself. Conversely, our algorithm, named Causal
Tree with Instrumental Variable (henceforth, CT-IV), provides
a data-driven way to shed light on the heterogeneity of the
treatment effects. The paper is structured as follows. Section
II provides a background on the causal inference framework,
its link with machine learning as it is modeled via the CT
algorithm, and basic concepts about instrumental variables.
In Section III, we describe our proposed CT-IV algorithm.
In Section IV, we provide a comparison on synthetic data
between the CT and CT-IV algorithms in the presence of an
irregular assignment mechanism, showing numerically advantages of the latter. Section V concludes the paper with a case
study on firm level data where the proposed algorithm is used
to assess the heterogeneity of the effects of an employment
policy implemented by the Tuscan Regional Administration
(Italy).

Abstract—This paper provides a link between causal inference
and machine learning techniques - specifically, Classification and
Regression Trees (CART) - in observational studies where the
receipt of the treatment is not randomized, but the assignment to
the treatment can be assumed to be randomized (irregular assignment mechanism). The paper contributes to the growing applied
machine learning literature on causal inference, by proposing
a modified version of the Causal Tree (CT) algorithm to draw
causal inference from an irregular assignment mechanism. The
proposed method is developed by merging the CT approach
with the instrumental variable framework to causal inference,
hence the name Causal Tree with Instrumental Variable (CTIV). As compared to CT, the main strength of CT-IV is that
it can deal more efficiently with the heterogeneity of causal
effects, as demonstrated by a series of numerical results obtained
on synthetic data. Then, the proposed algorithm is used to
evaluate a public policy implemented by the Tuscan Regional
Administration (Italy), which aimed at easing the access to credit
for small firms. In this context, CT-IV breaks fresh ground for
target-based policies, identifying interesting heterogeneous causal
effects.
Index Terms—Machine learning; Causal inference; Causal
trees; Instrumental variable; Application to social science; Policy
evaluation.

I. I NTRODUCTION
Modern statistics is experiencing the growth of machine
learning techniques, such as Classification and Regression
Trees (CART) [5], and Random Forests [4], which can be
applied to a wide range of statistical problems. In order to
use these techniques to answer relevant statistical questions,
it is appropriate to highlight some important features of many
machine learning methods. These methods are largely about
making good predictions and finding the model that fits the
data best. Furthermore, their importance lies in the ability to
deal with complex datasets, where the number of units is large,
as well as the number of features connected with a single
unit. In this framework, causality is often de-emphasized.
However, in the last decades, the availability of increasingly
larger datasets has brought to the attention a new important
problem for causal inference, which machine learning techniques can “easily” solve. As a matter of fact, the necessity
to deal with problems connected with the heterogeneity of the
treatment effects is stronger than in the past: the availability
of large datasets makes it possible to customize causal effect
estimates for population’s subsets and even for individuals. In
the past, the analysis subsets for causal inference problems
were specified in advance by trials’ protocols, while with the

II. BACKGROUND
A. Rubin’s Causal Model. In order to set up the method
presented in this paper, it is important to remind some notions

1

and notations of Rubin’s potential outcome framework [15,
16]. Rubin’s framework is the milestone of causal inference.
Together with the Pearl’s causality approach [13], it is the
most widely used model in the scientific literature about causal
inference.
Given a set of N units, indexed by i = 1, ..., N , let Wi be
the binary indicator of the receipt of the treatment:
Wi ∈ {0, 1}.

4) it has a functional form that is known (and, to some
extent, controlled) by the researcher.
Suppose that one is interested in the population average
treatment effect:
τ p = E[Yi (1) − Yi (0)] = µ(1) − µ(0),

where µ(1) is the expected value of Yi (1), and µ(0) is the
expected value of Yi (0). In the case of a classical randomized
experiment, an unbiased estimator of τ p is:

(1)

In order to develop a proper causal inference framework, one
needs to assume that the potential outcomes for any unit do
not vary with the treatments assigned to other units, and that,
for each unit, there are no different forms or versions of
each treatment level, which may lead to different potential
outcomes [15, 16]. This assumption is referred in the literature
as the Stable Unit Treatment Value Assumption (henceforth,
SUTVA). Given SUTVA, one can postulate the existence of a
pair of potential outcomes for each unit:
Yiobs

(
Yi (0)
= Yi (Wi ) =
Yi (1)

if
if

Wi = 0,
Wi = 1.

τ̂ = µ̂(1) − µ̂(0).

(5)

In the equation above, µ̂(1) = N11 i:Wi =1 Yiobs , where N1 is
the P
number of units assigned to the treated group, and µ̂(0) =
1
obs
, where N0 P
is the number of units assigned
i:Wi =0 Yi
N0
to the control group. Finally, i∈{0,1} Ni = N .
By relaxing the fourth property of a known assignment
mechanism, one ends up in a scenario that [8] defines as a Regular Assignment Mechanism. Is it possible in such a scenario to
still draw causal inference? The central property that needs to
be invoked in order to do so is the unconfoundedness property
3) defined above. Unconfoundedness can be formalized as the
conditional independence of the assignment variable Wi to
the potential outcomes given (conditioning on) the covariates
vector:
P

(2)

Starting from the notion of potential outcomes, one can define
a unit-level causal effect as the difference between the potential
outcome under treatment and the one under control:
τi = Yi (1) − Yi (0).

(4)

Wi ⊥
⊥ (Yi (0), Yi (1)) |Xi .

(3)

(6)

The importance of this assumption is that, conditional on
covariates, one can treat observations as they were coming
from a randomized experiment. Let the Conditional Average
Treatment Effect (CATE) be defined as:

The problem of this approach to causal inference is that one
can observe just one potential outcome for every unit. It is
impossible to observe both potential outcomes for the same
unit at the same time. Therefore, from this perspective, causal
inference is a missing data problem [8].
Is it then impossible to estimate any causal effect? No,
it is not but, in orded to draw proper causal inference, one
needs to introduce the central concepts of the Rubin’s Causal
Model [8]. Let Xi be the vector of features (usually called
also covariates or pre-treatment variables) associated with the
i-th unit, and known not to be affected by the treatment. Let
X be the N × K matrix of covariates values (where N is
the number of units, and K the number of covariates per
unit), W the N -dimensional vector of binary assignments
to the treatment, and Y (0) and Y (1) the N -dimensional
vectors of potential outcomes. Imbens and Rubin [8] define
the assignment mechanism P (W |X, Y (0), Y (1)), the unit level
assignment probability pi (X, Y (0), Y (1)) and the propensity
score e(x) = P (Wi = 1|Xi = x), which is the probability for
a unit to be treated, conditional on its covariates [14].
Following [8], one defines a classical randomized experiment as an assignment mechanism that has the following 4
properties:
1) it is individualistic, meaning that the treatment assignment for any unit is a function only of its own covariates
and potential outcomes;
2) it is probabilistic, meaning that the unit level assignment
probability belongs to the open interval (0, 1);
3) it is unconfounded, meaning that it does not depend on
the potential outcomes;

τ (x) = E[Yi (1) − Yi (0)|Xi = x] = µ(1, x) − µ(0, x),

(7)

where µ(w, x) is the expected value of Yi (Wi = w) given
Xi = x. Then it can be proven, by the law of iterated
expectations, that:
τ p = E[Yi (1) − Yi (0)] = E[τ (Xi )] = E[µ(1, x) − µ(0, x)].

(8)

It follows that τ p is identified if µ(1, x) and µ(0, x) are
identified over the support of X. Under unconfoundedness,
it can be proven that µ(1, x) and µ(0, x) are identified [3].
This gives the possibility to the researcher, if all the important
confounding covariates are present in the data, to draw causal
inference even when the assignment mechanism is not randomized but is regular. This is the typical case of observational
studies, where the researcher does not know beforehand the
assignment mechanism (i.e., property 4) above does not hold).
Moreover, in observational studies, the assignment to the
treatment may be different from the receipt of the treatment. In
this scenario, where one allows for non-compliance between
the treatment assigned and the treatment received, one can
assume that the assignment is itself unconfounded, while
the receipt is confounded. Following [8], this assignment
mechanism is named Irregular Assignment Mechanism. How
to draw inference in the presence of an irregular assignment
mechanism will be the focus of Subsection II.C, and also the
focus of our applied machine learning algorithm in Section
III.

2

re-trained using the full dataset, for the resulting value of α.
Finally, a different sample, called test sample (or test set),
with cardinality N te , is used to assess the performance of the
resulting model.
In the following, we describe the Causal Tree (CT) method
[3], which is a modification of the original CART method in
its regression version, tailored to causal inference. The CT
method differs from CART from the following features:
a. the CATE transformation of the outcome;
b. a rework of the in-sample goodness of fit;
c. a rework of the out-of-sample goodness of fit.
1) The CATE Transformation: First of all, one needs to
address the big issue of constructing an algorithm that leads to
an accurate estimate τ̂ (x) of the conditional average treatment
effect. In an ideal world, one would measure the quality of the
estimator by looking at the value of the following goodness
of fit measure, defined in terms of the mean squared error:

Going back to the CATE, there is a variety of reasons for
researchers to conduct estimation of τ (x) (see formula (7)).
One is strictly related to the magnitude of the benefits of the
treatment which can vary with the features of the individuals.
For instance, one can imagine the extreme case where the
average treatment effect of a drug is positive on the overall
population (in terms of curing a specific disease), but for
a sub-population of patients, with certain characteristics, the
average treatment effect is ineffective, or even negative. For
these reasons, it is important to find a proper way to estimate
causal effects not only on the entire population, but also on
specific subsets of the population.
B. Regression Trees for Causal Inference. Machine learning offers new ways to investigate heterogeneous effects (i.e.,
ones that depend on the covariates vector Xi , see (7)), as
suggested in [3, 18]. Machine learning techniques developed
so far in the literature can provide a useful tool to achieve
this goal, in scenarios where the assignment mechanism is
randomized or is regular.
A machine learning technique that was applied to this task
is the CART method [5]. CART is suitable for this goal
because, on one side, it is a fully supervised machine learning
technique but, on the other side, it is a pretty flexible method
that can be adapted to various learning tasks. Here, due to
page constraints, we limit to provide an overview of the basic
ideas behind such method, referring the reader to [5] for other
details about it. The primary goal of CART is to estimate the
conditional expectation of an observed outcome on the basis
of the information on features and outcomes for units in the
training sample, and to compare the resulting estimates on
a test sample. Practically, one can estimate these values by
building a suitable tree (a classification or a regression tree,
depending on the specific problem). The different admissible
tree models one can construct entail alternative splits of the
tree, based on the values of the features in the data. A
possible way to choose the best among various admissible
trees is provided by the following procedure, whose initial step
consists in dividing the dataset into two different samples:
a) a first sample, called training sample (or training set), which
is used to construct a maximal depth tree, performing the splits
using an in-sample goodness-of-fit measure Qis . The size of
this training sample is indicated by N tr . Then, the maximal
depth tree is pruned, with the aim of maximizing another
criterion function Qcrit , for various choices of a suitable
penalty parameter α > 0 on which Qcrit depends;
b) a second sample, called validation sample (or validation
set), which is used, for each choice of α, to validate the
associated pruned tree, through the use of an out-of-sample
goodness of fit Qoos . This second sample size is indicated by
N va .
Here, we consider the case in which a single training set
and a single validation set are used. In the machine learning
literature, this procedure is called the holdout method, and is
particular form of cross-validation. In this case, α is chosen
by maximizing Qoos with respect to it, and the tree itself is

Qinf eas (τ̂ ) = −E[(τi − τ̂ (Xi ))2 ],

(9)

However, it is infeasible to estimate the value of Qinf eas ,
because one does not know the values of both potential
outcomes for each unit, as τi is unobservable. To address
this issue, one can transform the observed outcome using
the treatment indicator variable Wi and the propensity score
e(Xi ), as proposed by Athey and Imbens [3]:
Yi∗ = Yiobs ·

Wi − e(Xi )
.
(1 − e(Xi )) · e(Xi )

(10)

Since Yiobs is equivalent to Yi (Wi ) then, using (1), one can
express (10) as:
Yi∗ = Yi (1) ·

(1 − Wi )
Wi
− Yi (0) ·
.
e(Xi )
(1 − e(Xi ))

(11)

What is the strength of this transformation? Athey and Imbens
prove that, if the unconfoundedness assumption holds, then:
E[Yi∗ |Xi = x] = τ (x),

(12)

Yi∗

where
in (11) is computed replacing the propensity score
e(Xi ) with its suitable estimate ê(Xi ) (obtained, e.g., via
logistic regression). However, there are some issues in building
a tree using a straightforward transformation of the outcome
like Yi∗ . In fact, Athey and Imbens argue that the within a
leaf sample average of the transformed outcome Yi∗ is not the
most efficient estimator of the treatment effect and, moreover,
that the proportion of treated and control units within a leaf
can be quite different from the overall sample proportion. An
easy way to solve this issue, proposed in [3], is to weight the
CATE transformation in a matter similar to the one developed
in [6]. Every partition of the covariates space is identified by a
set of leaves, and the treatment effect for the covariates vector
Xi belonging to a generic leaf Xj is estimated as1 :
P
W tr
obs,tr
· ê(Xltr )
l:Xltr ∈Xj Yl
CT
l
τ̂ (Xi ) =
P
Wltr
l:Xltr ∈Xj ê(Xltr )

1 Likewise next formulas (30) and (39), (13) can be applied also to
the validation sample and to the entire (training and validation) sample Ω,
replacing the superscript “tr”, respectively, with “va” and “Ω”.

3

P
−

l:Xltr ∈Xj

Ylobs,tr ·

(1−Wltr )
(1−ê(Xltr ))

(1−Wltr )
l:Xltr ∈Xj (1−ê(Xltr ))

P

which can be estimated as follows, by subtracting the average
obs,te
obs,te
on the control units from the
outcome Y Xj (0) = Y c

. (13)

obs,te

2) In-Sample Goodness of Fit: The second component
of the algorithm, which also differs from the corresponding
component in the original CART algorithm, is the in-sample
goodness of fit. The big issue for defining a proper criterion
function for the in-sample goodness of fit is that, in the
causal inference framework, the trcriterion (9), and even its
PN
sample approximation − N1tr i=1 (τi − τ̂ (Xitr ))2 , which is
what would be implemented by a direct application of the
original CART algorithm, are infeasible. Hence, [3] proposes
to approximate (9) by:

obs,te

τ̂T,Xj = Y Xj

Qis

eyman
=
V̂N
T,Xj

(14)

(15)

where α > 0 is a penalty parameter, and κ is the number of
leaves in the tree.
3) Out-of-Sample Goodness of Fit: For cross-validation,
there is no big need for any significant additional computational effort, given the fact that one has already obtained
an estimate τ̂ CT of the causal effect defined in terms of the
training sample (see (13)), and one just needs to compare it
with the causal effect drawn from the validation sample used
for the cross-validation. One could easily rework the mean
squared error with the transformed outcome Yi∗ to get the
Transform-The-Outcome (TOT) loss function:
N
1 X va,∗
(Yi
− τ̂ (Xiva ))2 .
va
N
i=1

(16)

The in-sample goodness of fit can be reworked in different
ways, following [3]. It looks to us that the TOT-based outof-sample goodness-of-fit in (16) fits in a better way in those
frameworks in which the number of covariates would lead to
very computationally demanding alternative estimators.
4) Causal Inference with Causal Tree: Due to the specific
construction of the Causal Tree, the learning problem reduces
to that of estimating the treatment effect in each member
of a partition of the covariate space. For the problem of
estimating the treatment effect in each leaf of the partition,
standard methods are valid. Once one has constructed the tree
T, one can consider the leaf that corresponds to the subset Xj
(henceforth, identified with Xj itself). The tree is defined as a
partition of the feature space X, and one can write:
#(T)

T = {X1 , ..., X#(T) }, with

[

Xj = X,

.

(19)

ste,2
t,Xj
te
Nt,X
j

+

ste,2
c,Xj
te
Nc,X
j

,

(20)

1) Compliers (Gi = C): Wi (Zi = 0) = 0 and Wi (Zi = 1) = 1;
2) Defiers (Gi = D): Wi (Zi = 0) = 1 and Wi (Zi = 1) = 0;
3) Always-takers (Gi = AT ): Wi (Zi = 0) = 1, Wi (Zi = 1) =
1;
4) Never-takers (Gi = N T ): Wi (Zi = 0) = 0, Wi (Zi = 1) = 0.

(17)

j=1

where #(T) indicates the number of leaves in the tree. Within
the leaf Xj , the average treatment effect is:
τT,Xj = E[Yi (1) − Yi (0)|Xi ∈ Xj ],

obs,te

−Yc

C. General Instrumental Variable Framework. In observational studies, the assignment mechanism may be irregular.
For example, dependence on the assignment of the potential
outcomes may be not ruled out even after conditioning on
a rich set of covariates. These are the cases where the
unconfoundedness assumption is violated. In these settings,
instrumental variable methods [8] can still help to estimate
causal effects. To briefly make the context clear, one can
consider the following example of an irregular assignment
mechanism, for which, in a study population of N units, a
certain number of individuals are randomized to receive a
treatment (read a drug), but not all the units that are assigned
to receive it are actually treated.
Let us denote by Wi the receipt of the treatment, and by
Zi the assignment to the treatment (instrumental variable).
Throughout this paper, we will assume both the Wi and Zi to
be binary, even if one could get similar results by relaxing this
assumption. In the following, Wi (Zi ) represents the treatment
received as a function of the treatment assigned. This leads one
to distinguish four different sub-populations Gi of units: those
that always comply with the assignment (compliers), those
who never comply with the assignment (defiers), those that
even if not assigned to the treatment take it (always-takers),
and those who do not take the treatment even if assigned
to it (never-takers). Formally, one can highlight these subpopulations as follows:

va

Qoos,tot = −

obs,te

(0) = Y t

where ste,2
t,Xj represents the sample variance of the treated group
te
in the test set, Nt,X
its size, ste,2
c,Xj the sample variance of
j
te
the control group in the test set, and Nc,X
its size. This
j
estimator of the variance is unbiased, with respect to the finitesample distribution of the test sample, if the treatment effect
can be assumed to be additive and constant within a leaf [8].
However, it can be used to construct confidence intervals only
under the normal approximation, which is typically reliable
when the number of units inside a leaf is large enough.

and to use the corresponding criterion function
Qcrit = Qis − α · κ,

obs,te

(1) − Y Xj

One can also estimate, for each leaf Xj , the variance of this
estimator using the following Neyman estimator [12]:

tr

N
1 X 2 tr
τ̂ (Xi ),
= − tr
N i=1

obs,te

average outcome Y Xj (1) = Y t
on the treated units,
both evaluated over the test sample, which is different from the
training and validation sample used for the cross-validation:

How can one conduct causal inference in such a setting,
if one decides to use the CART method? The first thing

(18)

4

to do is to assume the classical Instrumental Variable (IV)
assumptions to hold [8]: monotonicity, existence of compliers,
unconfoundedness of the instrument, and exclusion restriction.
These four assumptions can be written in detail as follows:
1) monotonicity: Wi (1) ≥ Wi (0);
2) existence of compliers: P (Wi (0) < Wi (1)) > 0;
3) unconfoundedness of the instrument (expressed in
terms of conditional independence notation): Zi ⊥
⊥
(Yi (0, 0), Yi (0, 1), Yi (1, 0), Yi (1, 1), Wi (0), Wi (1));
4) exclusion restriction: Yi (0) = Yi (1),
for Gi ∈
{AT, N T } where, for each sub-population and z ∈
{0, 1}, the shortened notation Yi (z) is used to denote
Yi (z, Wi (z)).
The monotonicity assumption leads us to exclude the existence of units that do exactly the opposite of what they are
assigned to (read defiers). In the case of one-sided noncompliance, when units that are not assigned to take the drug
cannot take it, this assumption is automatically satisfied as
Wi (0) = 0 for each unit, excluding the presence of defiers and
always-takers. In the case of two-sided noncompliance, when
treated and control units can access the opposite treatment
status, the monotonicity assumption is very plausible but
not directly verifiable. The second assumption is the socalled “existence of compliers” assumption. This assumption
states that the sub-population of compliers exists with positive
probability. The third assumption states that the instrument
is unconfounded. As we saw in Section II, the importance
of unconfoundedness is that, conditional on covariates, the
assignment to the treatment is as good as if the assignment
mechanism was randomized. The last but not least assumption
is the exclusion restriction, which rules out any direct effect
of Zi on Yi . According to this assumpton, there is no effect
of the assignment on the outcome, in the absence of an effect
of the assignment of the treatment on the treatment received,
being the treatment of primary interest.
1) Complier Average Causal Effect: In the setting above,
what “one can get from the data” (without invoking any of
the previous assumptions) is the Intention To Treat IT TY ,
which is defined as the effect of the intention to treat a unit
on the outcome of the same unit (effect of the assignment):
IT TY = E[Yi |Zi = 1] − E[Yi |Zi = 0].

since, for both always-takers and never-takers, one has
Yi (1) − Yi (0) = 0.

If for an individual the assignment has no effect on the
treatment received, then it has also no effect on the outcome.
This is a substantial assumption, and is not implied by the
design. It is generally stated as the assignment not affecting the
outcome other than through the treatment received, as we saw
above. Such an assumption can be used to attribute the effect
of assignment to the treatment received as follows, taking into
account only compliers and defiers:
IT TY = πC IT TY,C + πD IT TY,D .

(25)

Under monotonicity, we rule out the existence of defiers:
πD = 0. If we add the unconfoundedness assumption, we
can estimate the distribution of compliance types as follows:
a. πAT = P (Wi (0) = Wi (1) = 1)P= E[Wi |Zi = 0] =
N
E[Wi (0)], estimated as π̂AT = N10 i=1 (1 − Zi )Wi ;
b. πN T = P (Wi (0) = Wi (1) = 0) = 1 −
i |Zi = 1] =
PE[W
N
1
1 − E[Wi (1)], estimated as π̂N T = N1 i=1 Zi (1 − Wi );
c. πC = P (Wi (0) = 0, Wi (1) = 1) =PE[Wi |Zi =
N
1] − E[Wi |Zi = 0], estimated as π̂C = N11 i=1 Zi Wi −
P
N
1
i=1 (1 − Zi )Wi ,
N0
where N1 is the number of units assigned to the treatment
and N0 is the number of units assigned to the control. Once
one has estimated the distribution of compliers, when one adds
also the “existence of compliers” assumption, one finally gets:
IT TY = πC IT TY,C .

(26)

From this formula, as being πC 6= 0, it comes out that IT TY,C ,
the so-called Complier Average Causal Effect (CACE), is [9]:
IT TY,C = IT TY /πC =

E[Yi |Zi = 1] − E[Yi |Zi = 0]
.
E[Wi |Zi = 1] − E[Wi |Zi = 0]

(27)

In general, the global IT TY may be viewed as a lower bound
on the treatment effect on the compliers: with the assumptions
πD = 0, πC > 0, and that both IT TY,N T and IT TY,AT are
strictly less than IT TY,C , one gets IT TY < IT TY,C . The
complier average treatment effect, IT TY,C , is a local effect,
since it makes reference just to the population of compliers,
hence it can also be referred as a Local Average Treatment
Effect (LATE). It can be estimated as the coefficient associated
with the instrumental variable regression [7] as we will see
in detail in Subsection III.B. Invoking unconfoundedness,
exclusion restriction and monotonicity, one can also infer the
outcome distribution for compliers, E[Yi (0)|Gi = C], and
E[Yi (1)|Gi = C]. Under the same assumptions, one can
estimate the entire marginal distribution of Yi (0) and Yi (1)
for compliers.

(21)

If one does not assume any of the classical IV assumptions
above to hold, then the global IT TY may be written as the
weighted average of the IT TY effects across the four subpopulations of compliers, defiers, always-takers and nevertakers:
IT TY = πC IT TY,C +πD IT TY,D +πN T IT TY,N T +πAT IT TY,AT ,
(22)

where IT TY,G (G = C, D, N T, AT ) is the effect of the
treatment assignment on units of type G and πG is the
proportion of units of type G.
We can then proceed by adding step by step the four
assumptions. The first assumption that we impose is the
exclusion restriction. If it holds, then we get
IT TY,AT = IT TY,N T = 0,

(24)

III. C AUSAL T REE WITH I NSTRUMENTAL VARIABLE
A. Causal Tree with Randomized Instrumental Variable.
In the following, we extend the CT algorithm to the case of
an irregular assignment mechanism where the assignment-tothe-treatment variable is itself randomized, but its receipt is
not. If we assume the instrumental variable to be randomized,

(23)

5

where IT T Y,Xj is estimated following (30), and πC,Xj can be
estimated as:

we can draw causal inference from a Causal Tree by making
some changes in the structure of the tree. The first difference
is that we need to rework the outcome variable, substituting in
(10) the indicator variable Wi with the instrumental variable
Zi , as follows:
Yi∗,IV = Yiobs ·

Zi − e(Xi )
,
(1 − e(Xi )) · e(Xi )

π̂C,Xj =

Yi (1) · Zi
Yi (0) · (1 − Zi )
−
.
p
(1 − p)

(29)

V

P
IT T Y (Xi ) =

l:Xltr ∈Xj

P

Ylobs,tr ·

Zltr
p̂

Zltr
l:Xltr ∈Xj p̂

P
−

l:Xltr ∈Xj

Ylobs,tr ·

(1−Zltr )
(1−p̂)

(1−Zltr )
l:Xltr ∈Xj (1−p̂)

Q

X

N0,Xj

i=1

(1 − Zi )Wi ,

(35)

i=1

(36)

Due to the propensity score properties, this assumption holds
even conditioning on the propensity score:

(30)

Zi ⊥
⊥ (Yi (0), Yi (1))|e(Xi ).

(37)

When the assumption (37) holds, one can rework the transformed outcome variable in a similar way as in the previous
subsection, obtaining

tr

N
2
1 X
IT T Y (Xitr );
= − tr
N i=1

Z i Wi −

Zi ⊥
⊥ (Yi (0), Yi (1))|Xi .

,

P

where p̂ is the estimated value of p. Again, following [6], (30)
is an unbiased and efficient estimator of (21) within every leaf.
We also need to rework the in-sample and out-of-sample
goodness-of-fit measures:
a. In-sample goodness of fit:
is,IV

N1,Xj

NXj

1

B. Causal Tree with Unconfounded Instrumental Variable. Now, we extend the analysis above to the case of an
irregular assignment mechanism, where both the assignment
and receipt of the treatment are not randomized, but the assignment can be assumed to be unconfounded when conditioning
on important covariates. When the instrumental variable is not
randomized a priori, the property of unconfoundedness of the
instrument does not necessarily hold. If we think of Zi as
our assignment mechanism, then the unconfoundedness of the
instrument holds when:

Likewise in (13), one can also use a weighted version of
the transformation of the outcome to provide an estimate
IT T Y (Xi ) of the intention to treat IT TY , for Xi belonging
to a generic leaf Xj , as follows:

V

X

where N1,Xj and N0,Xj are the numbers of units assigned
respectively to the treated and control group within a certain
leaf Xj , and NXj is the number of units within the leaf.

(28)

where the propensity score is now reworked as e(x) =
P (Zi = 1|Xi = x). In this case, when the assignment
mechanism corresponds to a classical randomized experiment,
the propensity score is a constant (i.e., e(x) = p for all x),
and the transformation above simplifies to:
Yi∗,IV =

NXj

1

Yi∗ = Yi (1) ·

V

(31)

(1 − Zi )
Zi
− Yi (0) ·
.
e(Xi )
(1 − e(Xi ))

(38)

Assuming that the exclusion restriction and the monotonicity assumptions hold, it is possible to provide an estimate
IT T Y (Xi ) of the intention to treat IT TY for Xi belonging
to a generic leaf Xj , as follows:
P
Z tr
obs,tr
· ê(Xl tr )
l:Xltr ∈Xj Yl
l
IT T Y (Xi ) =
P
Zltr

b. Out-of-sample goodness of fit:

V

va

Qoos,IV

N
1 X va,∗
= −M SE = − va
(Yi
− IT T Y (Xiva ))2 .
N
i=1
(32)
V

For the sake of clarity, here (and in the following subsection), to fit the instrumental variable framework, we have
reworked the out-of-sample goodness-of-fit based on TOT (see
(16)). This rework could easily be adapted to other out-ofsample goodness-of-fit measures.
The last part of our algorithm based on the instrumental
variable focuses on the estimation of the complier average
treatment effects. As we highlighted before, by using the
instrumental variable Zi , we are substantially assuming four
different types in our population: compliers, always-takers,
never-takers, and defiers. As before, our interest lies on the
effect on the compliers. Within every leaf, the complier
average causal effect is:

V

l:Xltr ∈Xj ê(Xltr )

P
−

l:Xltr ∈Xj

Ylobs,tr ·

(1−Zltr )
(1−ê(Xltr ))

(1−Zltr )
l:Xltr ∈Xj (1−ê(Xltr ))

P

, (39)

where ê(Xltr ) is the estimated value of e(Xltr ). The difference
between (30) and (39) is that, given the complete randomization of the instrument, in (30) the probability ê(Xltr ) was fixed
to p̂ for any given unit, while in (39) the assignment-to-thetreatment probability is modelled by the estimated propensity
score ê(Xltr ). Finally, the complier average treatment effect
in each leaf is still estimated using (34), replacing (30) with
(39) to determine the estimate IT T Y,Xj .
1) Overall CACE: Starting from all the leaves, one can
reconstruct the overall effect over all of them as a weighted
average of the estimates τ̂Xcace
over every leaf Xj . One can
j
represent this weighted average as
V

τXcace
j

IT TY,Xj
E[Yi |Zi = 1, Xi ∈ Xj ] − E[Yi |Zi = 0, Xi ∈ Xj ]
=
.
=
P (Gi = C|Xi ∈ Xj )
πC,Xj
(33)

This formula is analogous to (27), and can be estimated in
every leaf assuming the existence of compliers. Then, τXcace
j
can be estimated as:

l

V

τ̂Xcace
j

IT T Y,Xj
=
,
π̂C,Xj

cace
τ̂overall
=

(34)

N
X
τ̂Xcace
· NXcoj
j
j=1

6

N co

,

(40)

where N l represents the number of leaves, NXcoj the number
of compliers for every leaf Xj , and N co the overall number
of compliers in all the leaves. One can also compute the
proportion of compliers in every leaf Xj simply as:
πXcoj =

NXcoj
N co

.

1) First Step of the Algorithm (Building the Tree)
• Draw a random subsample from Ω without replacement and divide
tr
it into two disjoint
P sets: a training set (Ω ) and a validation set
(Ωva ) of size k Ωk = Ω with k ∈ {tr, va}.
• Grow a Causal Tree, following the next procedure to take into
account the presence of the instrumental variable Zi :
i) estimate the propensity e(x) = P (Zi = 1|Xi = x) of
getting assigned to the treatment;
ii) drop units with an estimated propensity score below 0.1 or
above 0.9 (in order not to weight too much units with extreme
values of the estimated propensity score);
iii) grow a tree by maximizing the following in-sample goodnessof-fit criterion, for several values of α > 0:

(41)

2) Estimating CACE in Every Leaf with Two Stage Least
Squares Regressions: A suitable possibility to estimate the
treatment effect in every leaf is to use, within every leaf
Xj of the tree T, the Two Stage Least Squares (henceforth,
TSLS) method for the estimation of the effect on the complier
population, as it is presented in [9]. If one assumes the receipt
of the treatment variable Wi and the instrumental variable Zi
to be binary variables, our problem can be expressed in terms
of 2 simultaneous regressions:
Yiobs = α + γ · Wi + i ,
Wi = π0 + π1 · Zi + ηi .

tr

Qcrit,IV = −
V

(42)
(43)

va

Qoos,IV = −M SE = −

τ̂

= τ̂

IT T Y
γ̂
=
,
=
π̂1
π̂C

V

V

(44)

where τ̂ IV is an unbiased estimator of the average causal effect
on the population of compliers. If one runs a TSLS regression
within every leaf Xj of the tree T, then one is able to obtain
an estimate τ̂Xcace
for every such leaf.
j
A possible extension of (43) would be to include in the
first stage regression all the possible confounding variables
available in the dataset (in this case, π2 · Xi denotes a scalar
product):
Wi = π0 + π1 · Zi + π2 · Xi + ηi .

N
1 X va,∗
(Yi
−IT T Y (Xiva ))2
va
N
i=1

where IT T Y (Xiva ) is estimated on the validation sample as
in (30) in the case of randomization of the instrument or as
in (39) if the instrument is not randomized.
2) Second Step of the Algorithm (Estimating the Complier Average Causal
Effects)
• The complier average causal effect within a leaf Xj can be
estimated on the entire sample Ω in two alternative ways:
(a) if Zi is randomized (Subsection III.A) then one can directly
estimate the complier average causal effect within every leaf
as:
IT T Y,Xj
τ̂Xcace
=
j
π̂C,Xj

V

IV

V

where IT T Y (Xitr ) is estimated on the training sample as
in (30) in the case of randomization of the instrument or as
in (39) if the instrument is not randomized, α is the penalty
parameter, and κ is the number of leaves, which measures the
complexity of the model;
iv) cross-validate the tree, using the following out-of-sample
goodness of fit:

In the econometric terminology, the explanatory variable Wi
is endogenous, while the IV variable Zi is exogenous.
The logic of IV regression is that one can estimate the
above two reduced form regressions in the case of a single
instrument by least squares. In particular, one can estimate
τ CACE through TSLS, as the following ratio [8, 9]:
CACE

N
2
1 X
IT T Y (Xitr ) − α · κ,
tr
N i=1

V

V

where IT T Y,Xj is estimated as in (30) and π̂C,Xj is estimated following (35);
(b) if Zi is not randomized but can be assumed to be unconfounded (Subsection III.B) then run a TSLS conditioning on
the confounding covariates in the first stage regression.

(45)

The idea is that, if the instrument is unconfounded only
conditional on confounding variables, then one could include
these covariates in the estimation of the treatment effect on
the complier population within each leaf.
In every leaf, using the TSLS method, we can also obtain
an estimate of the variance of our τ̂Xcace
estimator, which
j
eyman
corresponds to the Neyman estimated variance V̂N
for
T,Xj
the leaf Xj of the tree T (see (20)).

IV. C OMPARISON OF THE CT AND CT-IV A LGORITHMS
ON S YNTHETIC DATA
In this section, we conduct simulations on synthetic data,
to compare the performance of the proposed CT-IV algorithm
with that of CT. As goodness-of-fit measure, we use the
opposite of the Mean Squared Error of prediction (MSE) on
the test set, and to assess the relative performance of the two
algorithms, we consider the following relative gap measure
based on such MSE [19]:

C. The CT-IV Algorithm. Our proposed CT-IV algorithm
is summarized as follows.

Relative Gap =

Causal Tree with Instrumental Variable (CT-IV)

M SECT − M SECT -IV
× 100.
M SECT

(46)

Moreover, we run some robustness checks. In this section,
our focus will be also on what happens in presence of a
weak instrument, namely when the instrument Zi is weakly
correlated with the treatment variable, and when the instrument
directly affects the outcome. While the presence of weak

Inputs: N units i (Xi , Zi , Wi , Yiobs ), where Xi is the feature vector, Zi
is treatment assignment (instrumental variable), Wi is the treatment receipt,
and Yiobs is the observed response.
Outputs: 1) a Causal Tree (determined by the use of the instrumental
variable), and 2) estimates of the Complier Average Causal Effects on its
leaves.

7

Table I: Simulation models
Design
1
2
3
4
5

Table II: Simulation results

Form of the Model
Yiobs
Yiobs
Yiobs
Yiobs
Yiobs

=
=
=
=
=

Error

1 + Xi1 + Wi + Wi · Xi1 + ηi + i
P
P
1+ 10
Xik +Wi +Wi · 10
X +ηi +i
Pk=1
Pk=9 ik
10
1+ k=1 Xik +Wi +Wi · 10
Xik +ηi +i
P10
Pk=9
10
1+ k=1 Xik +Wi +Wi · k=9 Xik +ηi +i
P10
Q10
1+ k=1 Xik +Wi +Wi · k=9 Xik +ηi +i

N (0, 1)
N (0, 1)
Exp(10)
U (0, 1)
N (0, 1)

instruments is directly testable (typically, with an F-test on
the first stage regression), what is not testable and could be
potentially harmful is a violation of the exclusion restriction at
the leaf level. Alternative algorithms, such as the one in [19],
take into account the exclusion restriction just at a general
level while, in this paper, we take into account that assumption
at the leaf level. In a non-synthetic scenario, this assumption
is not directly testable, but our algorithm seems to be more
“transparent” than other algorithms by taking into account
possible violations of this assumption.

=

Wi =

1 + f (Xiout ) + Wi +
Zi + f (Xiout ) + ηi ,

Wi ·

g(Xitre )

+ ηi + i ,

50,000

0.369
0.857
57%

0.038
0.727
94%

0.067
1.073
94%

0.066
0.973
93%

MSE (CT-IV)
MSE (Causal Tree)
Relative Gap

0.239
0.778
69%

0.058
0.787
93%

0.058
1.028
94%

0.052
0.994
95%

3

MSE (CT-IV)
MSE (Causal Tree)
Relative Gap

0.058
0.872
93%

0.041
1.186
97%

0.037
1.044
96%

0.062
1.004
94%

4

MSE (CT-IV)
MSE (Causal Tree)
Relative Gap

0.072
0.851
92%

0.053
1.052
95%

0.051
1.098
95%

0.050
1.004
95%

5

MSE (CT-IV)
MSE (Causal Tree)
Relative Gap

0.122
0.893
86%

0.030
0.866
96%

0.070
0.720
90%

0.058
1.014
94%

Approach

1

MSE (CT-IV)
MSE (Causal Tree)
Relative Gap

2

500

B. Simulation Results. The results of the simulations are
evaluated in Table II, in terms of the mean squared error of
prediction on the test set. As one can see from the relative gaps
reported in Table II, the IV-CT algorithm outperforms the CT
one in all the different designs. Comparing the various models
by column, one observes that with respect to the baseline
case (design 1), the relative gap between the IV-CT and CT
algorithms widens as we add covariates (design 2), change the
errors distribution (designs 3 and 4), or change the functional
form (design 5). Moreover, it is important to notice that, as the
sample size increases, the relative gap widens as well. From
the values of the MSE it seems that, while the CT performance
is quite stable, CT-IV performance increases as the sample size
grows larger. This is especially true in designs 1 and 5.

A. Synthetic Data Construction. To compare our CT-IV
algorithm with the CT one, we first consider some scenarios
where the assignment mechanism is irregular. As we saw
in Subsection II.C, this means that the assignment to the
treatment is randomized, but the receipt of the treatment is
not. The general model that we use for our data simulation
is built by considering the following variation of the typical
IV setting reported in (42) and (43). The major differences are
that we introduce in the main equation (47) a nuisance term ηi
and an interaction term between regressors and the treatment
indicator, in order to heterogenise the treatment effects. The
nuisance term ηi can be thought as a not-observable feature
that affects both the treatment assignment and the outcome.
The general setting looks as follows:
Yiobs

Sample Size
1,000
5,000

Design

C. Robustness Checks. Once we have checked that the
CT-IV algorithm outperforms the CT algorithm on synthetic
data, it is worth asking what happens when some of the
assumptions on which the consistency of the CT-IV is built
are partially violated. The main problem that can arise when
applying the CT-IV method is a well-known issue in the
econometric literature, known as the weak instrument problem
[17]. This problem, in our framework, deals with the fact that
the number of compliers within every leaf can be particularly
small. In an econometric framework, the goal that one would
like to achieve is to ensure that Cor(Wi , Zi ) is bounded
away from zero. In the following, we test what happens
when the instrument is weak on the overall population, and
what happens when the exclusion restriction is violated in a
specific sub-population. We test these violations on the second
model design in Table I. In particular, we assume 2 different
scenarios. In the first scenario, we let the instrument be weak
on the overall population, by setting Cor(Wi , Zi ) ' 0.5.
In the second scenario, we impose a partial violation of the
exclusion restriction, by letting the instrumental variable Zi
directly affect the outcome Yi when the feature Xi10 satisfies
the condition Xi10 ≥ 0.
In this case, the results from the simulations, reported in
Table III, show that the IV-CT algorithm outperforms the CT
even in the presence of weak instruments. It is important to

(47)
(48)

where Xi = (xi1 , ..., xiK ) is a K-dimensional vector of
covariates, Xiout highlights those covariates that have an effect
on the outcome, and Xitre (with {Xitre } ⊆ {Xiout }) those
covariates that affect the treatment effect. We consider various
functional forms for f and g and for the error distribution
in the main equation (47), as well as for f in the first stage
equation (48). The designs investigated (with K = 1 for design
1, and K = 10 for the other cases) are reported in Table I.
We train all the five models using incrementally bigger
samples, with cardinality ranging from 500 to 50000 (i.e.,
500, 1000, 5000, 50000). We implement a holdout crossvalidation, assigning half of the observations to the training
set (and validation set) and the other half to the test set.
We let Xik ∼ N (0, 0.1) (considering independent features),
Wi ∼ Bern(0.5), Zi ∼ Bern(0.5), and the nuisance parameter ηi be a white noise. Moreover, we set the correlations between Wi and Zi and Wi and ηi to be respectively
Cor(Wi , Zi ) ' 0.65 and Cor(Wi , ηi ) ' 0.50. To make the
trees comparable, we set the maximal depth of the tree to be
2, and the minimal leaf size to be one tenth of the sample
size.

8

Table III: Robustness checks for violations of IV assumptions
Scenario

Approach

1

MSE (CT-IV)
MSE (Causal Tree)
Relative Gap

2

MSE (CT-IV)
MSE (Causal Tree)
Relative Gap

Sample Size
1,000
5,000

50,000

0.439
0.881
50%

0.157
0.898
82%

0.120
1.270
90%

0.194
1.252
85%

0.198
0.244
19%

0.040
0.329
87%

0.118
0.452
74%

0.143
0.311
54%

500

such as location of the firm, year of start-up, legal status,
and main distribution channel. The location of each firm is
recorded at the provincial level. A central variable for our
analysis is the amount of firm’s sales in 2002 (pre-treatment
year). We created 6 different sales’ groups (up to 50,000;
50,000 to 100,000; 100,000 to 250,000; 250,000 to 500,000;
500,000 to 1,000,000; greater than 1,000,000). The dependent
variable is a categorical variable that takes the values 1, −1,
0, respectively, if the number of employees in the firm in
the year immediately subsequent to the treatment increased,
decreased, or remained the same. The covariate that catches
the assignment to the treatment is a dummy variable, which is
recorded as 1 if the firm received the financial aid during the
two years 2003/2005, and 0 otherwise. However, the treatment
variable is not randomized. To draw proper causal inference
in this scenario (irregular assignment mechanism), one needs
to use an instrumental variable. Luckily, we have data on
firms’ applications for the funding. This is a good instrument,
since those firms that applied for the funding were very likely
to get it, and it seems that the application itself should not
have affected the outcome (exclusion restriction). Moreover,
we know that the population of compliers exists (existence
of compliers) and, since this is a case of one-sided noncompliance, defiers are ruled out by the design of the policy
(monotonicity). However, the instrument is not randomized
and, in order to draw proper causal inference in this scenario,
one needs to build a propensity score for the instrument itself,
in order for the unconfoundedness assumption to hold. This
is a very central point and a main novelty of the approach
proposed in this paper. Finally, we discard firms with missing
values on relevant variables. The selection procedure leads to
a sample of 98 assisted firms and 662 non-assisted firms.

notice that, within every leaf, the weak-instrument test leads
to the rejection of the null hypothesis of weak instrument:
our algorithm is able to identify those leaves where there
is no weak-instrument problem. Moreover, our algorithm is
robust even when the exclusion restriction is partially violated
(second scenario). In this case, while the CT algorithm shows
a better performance compared with the other scenario, by
partially reducing the relative gap, the CT-IV still performs
better in terms of the mean squared error of prediction. Since
the estimation of the causal effects is performed in a second
stage with respect to the building of the tree, our algorithm
seems to handle in a good way possible problems due to the
violation of exclusion restriction within every leaf. This could
not hold true if the exclusion restriction is taken into account
just at a general level, as in [19].
V. C ASE S TUDY
A. Programs for the Development of Crafts in Tuscany
(Italy). During the years 2003-2005, the Tuscan Regional
Administration (Italy) introduced the “Programs for the Development of Crafts” (henceforth, PDC). These programs were
aimed at Tuscan small-sized handicraft firms, with the goal
of promoting innovation and regional development [1, 11].
The firms could access PDC by a voluntary application and
eligibility criteria. The objective of PDC was to ease access
to credit for small-sized firms to boost investments, sales and
employment levels. The PCD call guaranteed soft-loans to
the firms that were considered eligible for the grant. The
eligibility was evaluated on the basis of an investment project.
The minimal admissible investment cost was 25 000 Euros,
and the grant covered 60% of the financed investment [10].
Among firms participating in the PDC, the large majority of
the projects were funded, and the percentage of insolvencies
was lower than 3%. Data are available for firms that received
the PDC, firms that applied for the founding but were not
eligible, and firms that did not apply for the PDC. For our
analysis, we use an integrated dataset including information
collected by the “Artigian Credito Toscano” and information
coming from the archives of the Chamber of Commerce
(2001 − 2004). The data are available for 266 assisted firms
(participating in 2003/05 PDC) and 721 non-assisted firms.
The firms in the dataset are operating in 4 economic sectors that comprise the majority of the Tuscan artisan firms:
construction; manufacturing activities; wholesale and retail
trade; real estate business, rental services, computer, research,
business services. The covariates are time-varying covariates,
such as sales and employees, and time-invarying covariates,

B. Application of the CT-IV Algorithm to Assess Heterogeneous Causal Effects. In Figure 1, results are shown for the
CT-IV algorithm applied on our data. Within every node, the
estimated value of the intention to treat and the percentage of
observations associated with each node are shown. The name
of the variable used for splitting the tree is shown just below
each node. The nodes are numbered according to their level
in the tree (with the same numbering that one would use for a
full binary tree with the same number of levels). The different
effects are recorded with different colours: the pinker the node,
the closer the effect to zero, while the greener the node, the
stronger the effect. No weak-instrument problems occur in the
construction of the tree. Table IV reports the estimated values
of the ITT and of the CACE, for each leaf of the constructed
tree. For the latter, we report also its standard error, estimated
using the TSLS method within every leaf. As one can see,
there is a large variation in the CACE among the different
leaves. For instance, the observations in the node 2 (those
firms with sales lower than 100,000 Euros) provide a null and
non-significant effect according to a t-test. On the opposite
side, those firms within the node 15 (firms with more than
11 employees, and with sales between 100,000 and 1,000,000
Euros) show a 0.61 causal effect in the chance of increasing

9

possible applications are in fields such as management, health
sciences, economics, sociology, and political science.
Concluding, CT-IV has the following peculiar strengths:
1) it can be applied directly, even when the instrument is
not randomized (confounded instrumental variable);
2) it does not directly need a theoretical derivation of the
consistency of its estimators because it is based on robust
estimators (ITT & TSLS estimators);
3) it provides robust causal effect estimators within every
leaf, even when the exclusion restriction is partially
violated;
4) it is also robust in settings where the instrument is weak.
ACKNOWLEDGMENT
The authors declare no conflicts of interest.
R EFERENCES
[1] Arpino, B., and Mattei, A. (2016). Assessing the Causal Effects of
Financial Aids to Firms in Tuscany Allowing for Interference. The
Annals of Applied Statistics 10(3), 1170-1194.
[2] Athey, S., and Imbens, G.W. (2016). Recursive Partitioning for Heterogeneous Causal Effects. Proceedings of the National Academy of Sciences
113(27), 7353-7360.
[3] Athey, S., and Imbens, G.W. (2015). Machine Learning Methods for
Estimating Heterogeneous Causal Effects. Stat 1050(5).
[4] Breiman, L. (2001). Random Forests. Machine Learning 45(1), 5-32.
[5] Breiman, L., Olshen, J.H., Stone, C.J. (1984). Classification and Regression Trees. CRC Press.
[6] Hirano, K., Imbens, G.W., and Ridder, G. (2003). Efficient Estimation
of Average Treatment Effects using the Estimated Propensity Score.
Econometrica 71(4), 1161-1189.
[7] Imbens, G.W., and Angrist, J.D. (1994). Identification and Estimation
of Local Average Treatment Effects. Econometrica 62(2), 467-475.
[8] Imbens, G.W., Rubin, D.B. (2015). Causal Inference for Statistics,
Social, and Biomedical Sciences. An Introduction. Cambridge University
Press.
[9] Imbens, G.W., and Rubin, D.B., (1997). Estimating Outcome Distributions for Compliers in Instrumental Variables Models. The Review of
Economic Studies 64(4), 555-574.
[10] Mattei, A., and Mauro, V. (2007). Valutazione di Politiche per le Imprese
Artigiane. Research Report. IRPET - Istituto Regionale Programmazione
Economica della Toscana.
[11] Mariani, M., and Mealli, F. (2018). The Effects of R&D Subsidies
to Small and Medium-Sized Enterprises. Evidence from a Regional
Program. Italian Economic Journal, 4(2), 249-281.
[12] Neyman, J. (1934). On the Two Different Aspects of the Representative
Method: The Method of Stratified Sampling and the Method of Purposive Selection. Journal of the Royal Statistical Society 97(4), 558-625.
doi:10.2307/2342192
[13] Pearl, J. (2009). Causality. Cambridge University Press.
[14] Rosenbaum, P., and Rubin, D.B. (1983). Assessing the Sensitivity to
an Unobserved Binary Covariate in an Observational Study with Binary
Outcome. Journal of the Royal Statistical Society, Ser. B 45(2), 212-218.
[15] Rubin, D.B. (1974). Estimating Causal Effects of Treatments in Randomized and Nonrandomized Studies. Journal of Educational Psychology 66(5), 688-701.
[16] Rubin, D.B. (1980). Randomization analysis of experimental data: The
Fisher randomization test comment. Journal of the American Statistical
Association 75(371), 591-593.
[17] Stock, J.H., and Yogo, M. (2002). Testing for Weak instruments in Linear
IV Regression. In Andrews, D.W.K., Identification and Inference for
Econometric Models. New York: Cambridge University Press, 80-108.
[18] Wager, S., and Athey, S. (2017). Estimation and Inference of Heterogeneous Treatment Effects using Random Forests. Journal of the American
Statistical Association, to appear.
[19] Wang, G., Li, J. and Hopp, W.J., (2017). An Instrumental Variable
Tree Approach for Detecting Heterogeneous Treatment Effects in Observational Studies. Technical Report: https://papers.ssrn.com/sol3/papers.
cfm?abstract id=3045327.

Figure 1: CT-IV built on the PDC data
Table IV: Estimated Intention to Treat and Complier Average
Causal Effect on the final nodes (leaves)
Node #j

#2

#48

#49 #25 #13 #28 #58 #59 #15

V

IT T Y,Xj 0.003 -0.14 0.072 0.12 0.19 0.16 0.23 0.44 0.55
τ̂Xcace 0.003 -0.15 0.083 0.14 0.21 0.18 0.30 0.47 0.61
j

S.E. τ̂Xcace 0.060 0.08 0.101 0.09 0.10 0.10 0.14 0.10 0.10
j

the number of employees when they get the fundings. In our
case study, the difference between IT T Y,Xj and τ̂Xcace
is quite
j
small, because the percentage of compliers within every leaf
is around 90% (with the exception of node 58, where the
percentage of compliers is smaller than 80%), and the overall
percentage of compliers is exactly 90%. The overall CACE is
positive (0.17) and significant.
V

VI. C ONCLUSIONS
The main aim of this paper is to strengthen the link between
machine learning techniques and causal inference, as well
as to provide, in this regard, an innovative approach. From
this point of view, the CT-IV algorithm developed in this
paper has shown to fit in a good way our causal inference
goals in the presence of an irregular assignment mechanism.
The results obtained from the simulations show that, on one
side, CT-IV provides a robust estimation of the overall causal
effect on the population under study. On the other side, it
outperforms the Causal Tree, providing a very good insight
into the heterogeneity of the effects. As a possible extension,
which will the subject of a future investigation, the CT-IV
algorithm could be combined with the Honest Causal Tree
framework [2], to improve the quality of its estimates.
Studying the heterogeneity of causal effects is growing
in importance as the size of the dataset, and thus of the
population under study, grows; indeed, as shown in the case
study, taking into account heterogeneous effects on different
subgroups of the study population can help optimizing public
interventions and making them more cost-effective. Other

10

