Stat
The ISI’s Journal for the Rapid
Dissemination of Statistics Research

(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

Estimating optimal treatment regimes from a
classiﬁcation perspective
Baqun Zhanga, , Anastasios A. Tsiatisb , Marie Davidianb , Min Zhangc and
Eric Laberb
Received 8 October 2012; Accepted 29 October 2012
A treatment regime maps observed patient characteristics to a recommended treatment. Recent technological
advances have increased the quality, accessibility, and volume of patient-level data; consequently, there is a growing
need for powerful and ﬂexible estimators of an optimal treatment regime that can be used with either observational
or randomized clinical trial data. We propose a novel and general framework that transforms the problem of estimating an optimal treatment regime into a classiﬁcation problem wherein the optimal classiﬁer corresponds to the
optimal treatment regime. We show that commonly employed parametric and semi-parametric regression estimators, as well as recently proposed robust estimators of an optimal treatment regime can be represented as special
cases within our framework. Furthermore, our approach allows any classiﬁcation procedure that can accommodate
case weights to be used without modiﬁcation to estimate an optimal treatment regime. This introduces a wealth
of new and powerful learning algorithms for use in estimating treatment regimes. We illustrate our approach using
data from a breast cancer clinical trial. Copyright © 2012 John Wiley & Sons, Ltd.
Keywords: classiﬁcation; doubly robust estimator; inverse probability weighting; personalized medicine; potential
outcomes; propensity score

1

Introduction

The goal of personalized medicine is to inform clinical interventions using individual patient characteristics. These
characteristics may include patient demographics, genetic or genomic information, treatment and outcome history,
ability to cope with side-effect burden, and so on. Personalized medicine has the potential to increase the quality
of patient care while reducing cost by reducing over-treatment and making efﬁcient use of all existing information. There is currently a great deal of interest among clinical and intervention scientists in the development of
evidence-based personalized treatment strategies, also known as treatment regimes. With the increasing volume,
accessibility, and quality of patient level data, statistics has an important role to play in the estimation and evaluation of
treatment regimes.
Formally, a treatment regime is a rule that assigns a treatment, from among a set of possible treatments, to a patient
based on his/her observed characteristics. Deducing optimal treatment regimes using data from a clinical trial or
observational study can be informed, for example, in traditional regression-based methods, by identifying patient
a

Department of Preventive Medicine, Northwestern University, Chicago, IL 60611, USA
Department of Statistics, North Carolina State University, Raleigh, NC, 27695-8203, USA
c
Department of Biotatistics, University of Michigan, Ann Arbor, MI 48109-2029, USA
b

∗ Email:

baqun.zhang@northwestern.edu

Stat 2012; 1: 103–114

Copyright © 2012 John Wiley & Sons Ltd

Stat

B. Zhang et al.
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

covariates that exhibit a qualitative interaction with treatment assignment; i.e., an interaction in which the treatment
effect changes direction depending on the covariates (Gunter et al., 2011).
Recently, there has been vigorous research on estimating optimal treatment regimes involving a single decision
or a series of decisions based on data from clinical trials or observational studies (Murphy, 2003; Robins, 2004;
Moodie et al., 2007; Robins et al., 2008; Brinkley et al., 2009; Zhao et al., 2009; Henderson et al., 2010; Orellana
et al., 2010; Gunter et al., 2011). Much of this work involves postulating a model for the regression of outcome on
treatment assignment and covariates, and then inferring from the model the best treatment assignment given patient
covariates. Zhang et al. (2012a,b) proposed a robust method that maximizes across all regimes in a prespeciﬁed
class a doubly robust augmented inverse probability weighted estimator (AIPWE) of the population mean outcome.
This method achieves comparable performance to methods based on direct outcome regression modeling and is more
robust to misspeciﬁcation of regression models. With this method, as well as the recent inverse probability weighted
estimator of Zhao et al. (2012) and methods based on outcome regression, the parametric form of regimes has to be
pre-speciﬁed, either by practical considerations or through ad hoc preliminary data analysis.
In this article, we present a novel and general framework that facilitates ﬂexible estimation of optimal treatment
regimes in the single decision point setting. Speciﬁcally, we recast the original problem of ﬁnding the optimal treatment regime as a weighted classiﬁcation problem and estimate the optimal treatment regime by estimating the Bayes
classiﬁer, i.e., the one that minimizes the expected weighted misclassiﬁcation error. This framework allows the estimation of mean outcomes under a regime using any existing methods, e.g., regression estimator, inverse probability
weighted estimator (IPWE) or AIPWE, and is separated from the subsequent optimization for identifying the form of
treatment regimes, giving rise to its ﬂexibility. Within this framework, the class of treatment regimes does not need
to prespeciﬁed and can instead be identiﬁed in a data-driven way by minimizing an expected weighted misclassiﬁcation error. Importantly, our approach allows for existing classiﬁcation algorithms to be used without modiﬁcation to
estimate an optimal treatment regime. This introduces a wealth of new and powerful learning algorithms for use in
estimating optimal treatment regimes.
The remainder of this paper is organized as follows. In Section 2, we formalize the problem of estimating the optimal
treatment regime using potential outcomes and review existing methods. In Section 3, we present a general classiﬁcation framework for identiﬁcation of the optimal treatment regime. We conduct a small empirical study of the proposed
method in Section 4. We illustrate the proposed method using data from the National Adjuvant Breast and Bowel
Project (NSABP) in Section 5. Concluding remarks are made in Section 6.

2

Framework and methods

Consider a clinical trial or observational study where n subjects from a population of interest received one of two
treatment options, denoted by A D 0 or 1. Let Y denote the observed outcome of interest and, without loss of
generality, assume that larger values of Y are preferred. Let X denote the vector of patient characteristics collected
prior to treatment. The observed data are then .Xi , Ai , Yi /, i D 1, : : : , n, which are assumed to be independent and
identically distributed (i.i.d.) across i.
A treatment regime, g, is a map from the domain of X to the domain of A. The goal is to use the data to estimate
the optimal treatment regime, deﬁned as the one that maximizes the expected outcome if used to assign treatments
to all patients in the population of interest. To precisely deﬁne and identify the optimal treatment regime, we adopt
the potential outcome framework (Rubin, 1978). Let Y  .0/ and Y  .1/ denote the potential outcomes for a subject
that would be observed had the subject received treatment 0 or 1, respectively. We assume that the actual observed
outcome is connected to the potential outcomes through Y D Y  .1/A C Y  .0/.1  A/; this is usually referred to as

Copyright © 2012 John Wiley & Sons Ltd

104

Stat 2012; 1: 103–114

Stat

Treatment regimes and classiﬁcation
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

the consistency assumption and states that the observed outcome is the same as the potential outcome under the
treatment actually received. We assume that there is no interference among units, also known as the stable unit
treatment assumption (SUTVA). We further assume ¹Y  .0/, Y  .1/º ?
? AjX, where ?
? denotes statistical independence;
this states that there are no unmeasured confounders, and that treatment A, conditional on X, can be viewed as
being randomly assigned. In a randomized clinical trial, this assumption is trivially true. Under these assumptions, it
is straightforward to show that the overall population mean were all patients in the population to receive treatment a,
E¹Y  .a/º, is equal to EX [ E¹YjA D a, Xº], where EX ./ denotes expectation with respect to the marginal distribution of X.
Thus, for an arbitrary treatment regime g, the potential outcome for a subject randomly chosen from the population,
if he/she were to receive treatment according to g, can be deﬁned as
Y  .g/ D Y  .1/g.X/ C Y  .0/¹1  g.X/º.
The optimal regime, gopt , is deﬁned as the one yielding the largest value of E¹Y  .g/º among the class of all potential
regimes, G ; i.e., gopt D arg maxg2G E¹Y  .g/º. Writing .a, X/ D E.YjA D a, X/, it is straightforward to show that
E¹Y  .g/º D EX [ .1, X/g.X/ C .0, X/¹1  g.X/º] ,
and hence the optimal treatment regime is given by
gopt .X/ D I¹.1, X/ > .0, X/º.
An intuitive approach to estimating the optimal treatment regime, which we refer to as the regression method, is to
posit a parametric regression model for .A, X/ D E.YjA, X/, say .A, X; ˇ/. If the model is correctly speciﬁed, then
.A, X/ D .A, X; ˇ0 / for some ˇ0 , and the optimal regime is therefore g.X, ˇ0 /, where g.X, ˇ/ D I¹.1, X, ˇ/ >
opt
O > .0, X, ˇ/º,
O where
.0, X, ˇ/º. Hence, it is natural to estimate the optimal treatment regime by gO reg .X/ D I¹.1, X, ˇ/
opt
ˇO is an estimator of ˇ. Clearly, if the model for .A, X/ is incorrectly speciﬁed, gO reg .X/ may not be a good estimator of
gopt .X/.
Alternatively, a semiparametric version of the regression method, G-estimation (Robins, 2004), considers a semiparametric model for .A, X/, exploiting the fact that the optimal treatment regime gopt .X/ only depends on the contrast
function C.X/ D .1, X/  .0, X/ through gopt .X/ D I¹C.X/ > 0º. Speciﬁcally, G-estimation posits a semiparametric
model .A, X/ D h1 .X/ C ACG .X; /, where
is a ﬁnite dimensional vector and h1 .X/ is unspeciﬁed. The estimator O for
can be found by solving appropriate estimating equations involving a known or estimated propensity
score .X/ D pr.A D 1jX/ (Robins, 2004; see also Schulte et al., 2012). The optimal treatment regime is estimated
opt
opt
opt
by gO G .X/ D I¹CG .X; O / > 0º. Like gO reg .X/, the quality of the G-estimation estimator gO G .X/ depends on how close
CG .X; / is to the true contrast function.
Recognizing that the posited regression model may be misspeciﬁed, Zhang et al. (2012a) instead considered such
a posited regression model as a mechanism for deﬁning a class of induced treatment regimes. They estimated the
optimal regime within a pre-speciﬁed class by directly maximizing a doubly robust AIPWE of the population mean
outcome across all regimes in the class. The class of regimes G , indexed by parameter , can be derived from a
regression model .A, X; ˇ/, in which case  is a many-to-one function of ˇ (see Zhang et al., 2012a, for details)
or directly speciﬁed as depending on a key subset of elements of X based on practical considerations. The value
opt
opt D arg max E¹Y  .g /º, g 2 G , deﬁnes the optimal regime in G , i.e., g .X/ D g.X, opt /, which equals gopt .X/ if
G contains gopt .X/ and, although not the same as gopt .X/ if gopt .X/ is not in G , is still of considerable interest when
we focus our attention on the feasible class G . For ﬁxed , the AIPWE for E¹Y  .g /º is given by

Stat 2012; 1: 103–114

105

Copyright © 2012 John Wiley & Sons Ltd

Stat

B. Zhang et al.
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

AIPWE./ D n1

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

n ²
X
iD1

³
C,i Yi
C,i  c .Xi ; , O /
O ,

m.Xi ; , ˇ/
c .Xi ; , O /
c .Xi ; , O /

(1)

where C D Ag.X, / C .1  A/¹1  g.X, /º, .X;  / is a posited model for the propensity score .X/; O is the
maximum likelihood (ML) estimator for  ; c .X; , O / D .X; O /g.X, / C ¹1  .X; O /º¹1  g.X, /º; m.X; , ˇ/ D
.1, X, ˇ/g.X, / C .0, X, ˇ/¹1  g.X, /º is a model for E¹Y  .g /jXº D .1, X/g.X, / C .0, X/¹1  g.X, /º; .A, X; ˇ/
opt
is a model for E.YjA, X/; and ˇO is an estimator for ˇ. Denoting the value that maximizes AIPWE./ by O AIPWE , which
opt
opt
opt
estimates opt , one can then estimate g .X/ by gO ,AIPWE .X/ D g.X, O AIPWE /.
As an alternative to the AIPWE estimator, Zhang et al. (2012a) also discussed the inverse probability weighted
estimator (IPWE) for E¹Y  .g /º, given by
IPWE./ D n1

n
X
iD1

opt

C,i Yi
.
c .Xi ; , O /

opt

The deﬁnitions of the estimators O IPWE and gO ,IPWE .X/ based on IPWE./ follow immediately. The method of Zhao et
al. (2012) estimates the optimal treatment regime by maximizing a concave relaxation of the above IPWE estimator.
This relaxation is analogous to the use of surrogate or proxy loss functions in classiﬁcation (see, for example, Hastie
et al., 2009); this relaxation provides numerical stability and facilitates efﬁcient computation of the maximum.

3

Treatment regimes and classiﬁcation

In this section, we describe a general framework for transforming the problem of estimating an optimal treatment
regime into weighted classiﬁcation problem. Using the previous notation, we see that
E ¹Y  .g/º D EX [ .1, X/g.X/ C .0, X/¹1  g.X/º]
D EX [ g.X/¹.1, X/  .0, X/º C .0, X/]
D E¹g.X/C.X/º C E¹.0, X/º,
so that gopt D arg maxg2G E¹Y  .g/º D arg maxg2G E¹g.X/C.X/º. A natural strategy for estimating the optimal treatment regime is to ﬁrst construct an estimator CO for C using the observed data, and estimate gopt by gO opt D
P
arg maxg2G n1 niD1 g.Xi /CO i .Xi /. Next we will see that all of the estimators discussed in the preceding section can be
seen as following this approach.
The regression method posits a model E.YjA, X/ D .A, X; ˇ/, that deﬁnes the class of treatment regimes, Gˇ ,
indexed by ˇ, with elements of the form g.X, ˇ/ D I¹.1, X, ˇ/ > .0, X, ˇ/º. It then estimates gopt .x/ by
P
opt
O > .0, x, ˇ/º,
O
gO reg .x/ D I¹.1, x, ˇ/
which is equivalent to arg maxg2Gˇ n1 niD1 g.Xi /CO reg .Xi /, where CO reg .x/ D
O  .0, x, ˇ/
O is a regression estimator of C.x/.
.1, x, ˇ/
G-estimation directly models the contrast function, which subsequently deﬁnes the class of treatment regimes, G ,
opt
indexed by , with elements of the form g.X, / D I¹CG .X, / > 0º. The resulting estimator gO G .x/ D I¹CG .x, O / > 0º
P
is thus equal to arg maxg2G n1 niD1 g.Xi /CO G .Xi /, where CO G .x/ D CG .x, O /.
The robust method in Zhang et al. (2012a) considers the a priori speciﬁed class of regimes G . The AIPWE for
E¹Y  .g /º with a ﬁxed  can be rewritten as

Copyright © 2012 John Wiley & Sons Ltd

106

Stat 2012; 1: 103–114

Stat

Treatment regimes and classiﬁcation
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

AIPWE./ D n1

n ²
X
iD1

³
C,i Yi
C,i  c .Xi ; , O /
O

m.Xi ; , ˇ/
c .Xi ; , O /
c .Xi ; , O /

n ²
X

i
C,i
C,i  c .Xi ; , O / h
O
O
Yi 
.1, Xi , ˇ/g.X,
/ C .0, Xi , ˇ/¹1
 g.Xi , /º
c .Xi ; , O /
c .Xi ; , O /
iD1
³
n °
n ²
±
X
X
1  Ai
Ai  .Xi , O /
1
1
O
O
Dn
g.Xi , /CAIPWE .Xi / C n
Yi 
.0, Xi , ˇ/ ,
1  .Xi , O /
1  .Xi , O /
D n1

iD1

³

iD1

where
CO AIPWE .Xi / D

Ai
1  Ai
Ai  .Xi , O /
O  Ai  .Xi , O / .0, Xi , ˇ/.
O
Yi 
Yi 
.1, Xi , ˇ/
.Xi , O /
1  .Xi , O /
.Xi , O /
1  .Xi , O /

(2)

opt
opt
The method of Zhang et al. (2012a) estimates g by gO ,AIPWE D arg maxg2G AIPWE./, which is equal to
P
arg maxg2G n1 niD1 g.Xi /CO AIPWE .Xi /. Note that the AIPWE estimator of the contrast function borrows information
from, but is not completely determined by, the speciﬁed parametric regression model for the outcome. In contrast to
this, estimators of the contrast function using regression or G-estimation methods are completely determined by the
speciﬁed regression models, and the IPWE estimator given below makes no use of a regression model for the outcome
given covariates. The AIPWE contrast estimates strike a balance between the foregoing two extremes and this balance
partly explains the improved empirical performance in Section 4.

The inverse probability weighted estimator (IPWE) for E¹Y  .g /º, is equivalent to estimating the contrast function at
each of the observed data points by
CO IPWE .Xi / D

Ai
1  Ai
Yi 
Yi .
.Xi , O /
1  .Xi , O /

(3)

Unlike other methods for estimating the contrast function, which either are completely determined by or incorporates
information from a semiparametric or parametric outcome regression model, the IPWE estimator of C.Xi / for each
i is completely determined by the observed outcome, weighted by an estimated propensity. The IPWE estimates of
the contrast values may be too noisy to successfully inform the class of treatment regimes, as demonstrated by our
simulations.
From the above discussion, we see that estimating the optimal treatment regime in the class G or the restricted class
O i / of the contrast function C.Xi / for i D 1, : : : , n, and
G can be separated into two steps: constructing an estimator C.X
Pn
opt
opt
1
O
subsequently estimating g by gO D arg max n
iD1 g.Xi /C.Xi /, where the maximization is across all regimes in
the class considered. Note that in the regression and G-estimation methods, the class of regimes is dictated by either
.A, X; ˇ/ or CG .X; /; and the estimation of the contrast function and the maximization of the objective function are
carried out simultaneously by ﬁtting the corresponding regression models. As a result, if the posited regression model,
.A, X; ˇ/ or CG .X; /, is correctly speciﬁed, the corresponding estimator of the contrast function is consistent; in such
a case the estimator of the optimal treatment regime is a consistent estimator of gopt , as Gˇ or G contains gopt . If
opt
opt
the posited model is misspeciﬁed, however, gO reg or gO G may be far from the optimal treatment regime in G or even
the optimal regime in the corresponding restricted class Gˇ or G , and thus, may perform poorly. In contrast, in the
robust AIPWE-based method of Zhang et al. (2012), the estimation of the contrast function and the maximization of
the objective function across G are separated. An advantage of this separation is that even if G does not contain
gopt , the resulting estimator may still be the optimal one in G . In the method of Zhang et al. (2012a), the class of
treatment regimes under consideration, G , indexed by a ﬁnite-dimensional parameter, is either entirely determined
by the model for the outcomes Y or is pre-speciﬁed based on practical considerations. In practice, one can inform
the class of treatment regimes by using standard model building techniques for the regression model of outcome on

Stat 2012; 1: 103–114

107

Copyright © 2012 John Wiley & Sons Ltd

Stat

B. Zhang et al.
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

treatment and patient characteristics. However, these model building techniques target identifying a good model for
the outcome, but not necessarily a high-quality treatment regime.
We now introduce a general framework that can address the issues discussed above. Speciﬁcally, the problem of
estimating the optimal treatment regime is reformulated as a weighted classiﬁcation problem, where the optimal
treatment regime minimizes a weighted misclassiﬁcation error.
Because C.X/ D I¹C.X/ > 0ºjC.X/j  I¹C.X/ 6 0ºjC.X/j, we can rewrite g.X/C.X/ as
g.X/C.X/ D g.X/I¹C.X/ > 0ºjC.X/j  g.X/I¹C.X/ 6 0ºjC.X/j
D I¹C.X/ > 0ºjC.X/j  jC.X/j[ ¹1  g.X/ºI¹C.X/ > 0º C g.X/I¹C.X/ 6 0º] .
As g.X/ takes values ¹0, 1º, it is easy to check that
¹1  g.X/ºI¹C.X/ > 0º C g.X/I¹C.X/ 6 0º D[ I¹C.X/ > 0º  g.X/]2 .
Combining these results, g.X/C.X/ can be rewritten as
g.X/C.X/ D I¹C.X/ > 0ºjC.X/j  jC.X/j[ I¹C.X/ > 0º  g.X/]2 .
Therefore, we can deﬁne the optimal treatment regime as
gopt D arg max[ E¹g.X/C.X/º]
g2G

®
¯
D arg max E[ I¹C.X/ > 0ºjC.X/j] E jC.X/j[ I¹C.X/ > 0º  g.X/]2
g2G
 ®
¯
D arg min E jC.X/j[ I¹C.X/ > 0º  g.X/]2 .
g2G

That is, the optimal treatment regime, gopt , is the one that minimizes E.jC.X/j[ I¹C.X/ > 0º  g.X/]2 /. This identity is
what allows us to recast the problem of estimating an optimal treatment regime as a weighted classiﬁcation problem.
We view each subject as belonging to one of the two classes deﬁned by Z D I¹C.X/ > 0º. That is, the class Z D 1
is composed of those subjects who would beneﬁt more from treatment 1 compared to treatment 0; i.e., those who
have .1, X/ > .0, X/, and should therefore be treated with treatment option 1. Each subject is also given a weight
W D jC.X/j, which represents the loss that would be incurred if the subject were misclassiﬁed. In this way, we separate
the information contained in C.X/ into two parts: the class label Z, containing the information about the sign of C.X/;
and the weight W, containing the information about the magnitude of C.X/. Hence, E.jC.X/j[ I¹C.X/ > 0º  g.X/]2 /
can be regarded as the expected weighted misclassiﬁcation error under the classiﬁcation rule g.X/.
In practice, the contrast function C.X/ and hence the class label Z and weight W for each subject are not available in
the observed data. As discussed previously, the contrast values C.Xi / for each i can be estimated from the data, for
O i /, i D 1, : : : , n, are obtained, we can construct a
example, using CO reg , CO G , CO IPWE , or CO AIPWE . Once the estimates C.X
O
O
O
O
class label Zi D I¹C.Xi / > 0º, and a weight Wi D jC.Xi /j for each subject, and gopt can be estimated subsequently by
P
O i ¹ZO i  g.Xi /º2 ]. The minimization of Pn [ W
O i ¹ZO i  g.Xi /º2 ] can then be viewed as a typical classiarg ming2G niD1 [ W
iD1
O
O i as the “weight,” and g is the “classiﬁcation
ﬁcation problem with Zi as the binary “response,” Xi as the “predictor,” W
rule.” By reformulating the problem of estimating the optimal treatment regime as a classiﬁcation problem, existing
classiﬁcation techniques can be used, for example, classiﬁcation and regression trees (CART, Breiman et al., 1984)

Copyright © 2012 John Wiley & Sons Ltd

108

Stat 2012; 1: 103–114

Stat

Treatment regimes and classiﬁcation
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

or support vector machines (SVM, Cortes and Vapnik, 1995), to minimize the classiﬁcation error across a broad class
of regimes. Therefore, the parametric form of treatment regimes does not need to be pre-speciﬁed and instead can be
selected using classiﬁcation techniques.
We comment that the method of Zhao et al. (2012) can be viewed as a special case within our framework, with
the contrast function at each of the observed data points estimated by the IPWE estimator CO IPWE .Xi /. To see this,
it is straightforward to show that, corresponding to the IPWE estimator of the contrast function, the class label
ZO i D I¹CO IPWE .Xi / > 0º is equal to Ai as Y is assumed to be positive in Zhao et al. (2012), and that the weight is equal to
ˇ
ˇ
ˇ Ai
ˇ
Yi
1  Ai
O
ˇ
Wi D ˇ
Yi 
Yi ˇˇ D
.
.Xi , O /
1  .Xi , O /
Ai .Xi , O / C .1  Ai /¹1  .Xi , O /º
Thus, within our framework, the weighted misclassiﬁcation error rate under treatment rule g is
n1

n
X

O i ¹ZO i  g.Xi /º2 D n1
W

iD1

n
X
iD1

Yi
I¹Ai ¤ g.Xi /º,
Ai .Xi , O / C .1  Ai /¹1  .Xi , O /º

which is exactly the approximated weighted classiﬁcation error used by Zhao et al. (2012). Zhao et al. (2012)
minimize the above weighted classiﬁcation error using support vector machines. The method of Zhao et al. (2012) is
predicated on an IPWE estimator of the expected outcome. However, the classiﬁcation framework we propose is more
general and allows estimation of the contrast function by any method, e.g., the AIPWE, as well as the data-driven
selection of the class of treatment regimes using the estimated class labels and observation weights.
In the proposed classiﬁcation framework, we disentangle two critical steps: (i) constructing a suitable estimator of
the contrast function, and (ii) ﬁnding estimated optimal treatment rules with an interpretable form using classiﬁcation
techniques. This allows both greater ﬂexibility in modeling the outcome or contrast functions and the ability to use any
classiﬁcation technique to inform the class of treatment regimes. We comment that, in our framework, for each subject
there is a corresponding “weight” and “label,” which do not depend on a treatment regime. Therefore, exploratory
analysis and model diagnostics can be used in the classiﬁcation step by a skilled data-analyst to build high-quality
scientiﬁcally defensible models. This added beneﬁt, however, is not available in the classiﬁcation method of Zhao et
al. (2012) or the previous work on robust estimation by Zhang et al. (2012a). Also, notice that with the classiﬁcation
approach the interpretability of the ﬁnal decision rule does not require a parsimonious estimator of the contrast
function. Consequently, we can use ﬂexible models for the contrast function, e.g. support vector regression (Vapnik et
al., 1997), boosting (Freund & Schapire, 1997), etc., and still produce an interpretable decision rule. In addition, the
selection of the form of treatment regimes by classiﬁcation techniques in the proposed framework is directly targeting
the problem of ﬁnding the optimal treatment regime by minimizing weighted misclassiﬁcation error. In the next section,
for illustration of the proposed methods, we use classiﬁcation and regression trees (CART) to produce interpretable
decision rules.

4

Simulation studies

To evaluate the performance of the proposed methods, we have carried out two simulation studies, each involving
1000 Monte Carlo data sets. For deﬁniteness, we use CART to minimize the expected weighted misclassiﬁcation;
other methods developed in the area of classiﬁcation could also be used.
In the ﬁrst scenario, for each data set, we generated n D 200, 500, and 1000 observations .Yi , Ai , Xi /, i D 1, : : : , n,
where Xi D .Xi1 , : : : , Xi5 /T and Xi1 , : : : , Xi5 were independent standard normal; given Xi , Ai was Bernoulli with success
probability satisfying logit¹pr.A D 1jX/º D 0.1 C 0.5X1 C 0.5X2 , logit.u/ D log¹u=.1  u/º; and outcomes were

Stat 2012; 1: 103–114

109

Copyright © 2012 John Wiley & Sons Ltd

Stat

B. Zhang et al.
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

generated as Yi D .Ai , Xi / C i for i standard normal and .A, X/ D exp¹2.0 C 0.25X1 C 0.25X2  0.25X5  0.5.a 
gopt .X//2 º, where gopt .X/ D I.X1 > 0.545/I.X2 < 0.545/.
For the proposed methods, to estimate the contrast function C.X/, we considered the regression estimator CO reg , the
AIPWE estimator CO AIPWE , and the IPWE estimator CO IPWE . We considered a working regression model .A, X; ˇ/ D
ˇ0 C ˇ1 X1 C ˇ2 X2 C ˇ3 X3 C ˇ4 X4 C ˇ5 X5 C A.ˇ6 C ˇ7 X1 C ˇ8 X2 C ˇ9 X3 C ˇ10 X4 C ˇ11 X5 /, which is misspeciﬁed, and
estimated ˇ D .ˇ1 , : : : , ˇ11 / in the model using least squares. We considered both a correctly speciﬁed propensity
model .X;  / D expit.0 C 1 X1 C 2 X2 /, and an incorrectly speciﬁed model .X;  / D  ; these models were ﬁt using
ML. Note that when the propensity model is constant, CO reg and CO G are equivalent, thus we omit CO G .
O we deﬁned the binary
Once we obtained the estimated contrast function for each subject, e.g., CO AIPWE .Xi , Ai , Yi ; O , ˇ/,
O
O
O
O
O
O for each
responses, e.g., Zi D I¹CAIPWE .Xi , Ai , Yi ; O , ˇ/ > 0º, and the case weights, e.g., Wi D jCAIPWE .Xi , Ai , Yi ; O , ˇ/j
O
O
subject, so that the classiﬁcation dataset becomes ¹Zi , Xi , Wi º. We input this new data set into the CART algorithm to
ﬁnd the estimated optimal treatment regime. We used the R function rpart with default settings, except that we set
O
the weights as the estimated weight W.
For the second scenario, the data generation was the same as in the ﬁrst scenario except that gopt .X/ D I.X1 > X2 /.
Note that here, in contrast to the ﬁrst scenario, the class of treatment regimes with simple tree form does not contain
gopt . Thus, this scenario examines whether or not CART can ﬁnd a regime close to the optimal treatment regime gopt .
We also estimated the optimal treatment regime using the usual regression (RG) method which models .A, X; ˇ/ and
the robust AIPWE-based method of Zhang et al. (2012a) which involves modeling both .A, X; ˇ/ and propensities;
models for .A, X; ˇ/ and propensities are as those used in the proposed methods. In the method of Zhang et al.
(2012a), we consider optimizing over the class of treatment regimes deﬁned by the outcome regression model, i.e.,
G D ¹I.ˇ6 C ˇ7 X1 C ˇ8 X2 C ˇ9 X3 C ˇ10 X4 C ˇ11 X5 > 0/º.

Table I. Results for the ﬁrst simulation scenario using 1000 Monte Carlo data sets. E¹Y  .gopt /º D
O gO opt / shows the Monte Carlo average and standard deviation of estimated values of the true
8.12. E.
opt
E.gO / using (1). E.gO opt / shows the Monte Carlo average and standard deviation of values E¹Y  .gO opt /º
obtained using 106 Monte Carlo simulations for each data set. PS correct and PS incorrect indicate
whether the speciﬁed propensity score model is correct or not.
n=200
Estimator

O gO opt /
E.

n=500
O opt

E.g

/

O gO opt /
E.

O opt

E.g

/

n=1000
OE.gO opt /
E.gO opt /

RG
Zhang et al.
CO AIPWE
CO IPWE
CO reg

7.56
7.83
8.08
7.18
7.51

(0.35)
(0.37)
(0.37)
(0.53)
(0.36)

7.49
7.53
8.07
7.02
7.43

(0.08)
(0.08)
(0.06)
(0.42)
(0.18)

7.56
7.76
8.10
7.66
7.52

PS correct
(0.21) 7.53
(0.22) 7.59
(0.22) 8.11
(0.40) 7.57
(0.23) 7.49

(0.05)
(0.06)
(0.02)
(0.38)
(0.10)

7.55
7.73
8.11
7.93
7.52

(0.16)
(0.17)
(0.16)
(0.26)
(0.17)

7.54
7.62
8.12
7.90
7.50

(0.04)
(0.04)
(0.01)
(0.22)
(0.08)

RG
Zhang et al.
CO AIPWE
CO IPWE
CO reg

7.50
7.68
7.95
6.98
7.44

(0.30)
(0.30)
(0.31)
(0.34)
(0.31)

7.49
7.52
8.08
6.93
7.43

(0.08)
(0.09)
(0.04)
(0.25)
(0.18)

7.50
7.62
7.98
7.08
7.45

PS incorrect
(0.18) 7.53
(0.19) 7.57
(0.19) 8.11
(0.22) 7.04
(0.20) 7.49

(0.05)
(0.06)
(0.02)
(0.16)
(0.10)

7.50
7.59
7.99
7.12
7.44

(0.13)
(0.14)
(0.14)
(0.16)
(0.14)

7.54
7.59
8.12
7.08
7.50

(0.04)
(0.05)
(0.01)
(0.12)
(0.08)

Copyright © 2012 John Wiley & Sons Ltd

110

Stat 2012; 1: 103–114

Stat

Treatment regimes and classiﬁcation
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

Table II. Results for the second simulation scenario using 1000 Monte Carlo data sets. E¹Y  .gopt /º D
8.12. Entries as Table I.
n=200
Estimator
RG
Zhang et al.
CO AIPWE
CO IPWE
CO reg
RG
Zhang et al.
CO AIPWE
CO IPWE
CO reg

O gO opt /
E.
7.82
8.09
7.96
7.11
7.67
7.79
8.01
7.87
7.11
7.63

(0.32)
(0.32)
(0.33)
(0.41)
(0.34)
(0.30)
(0.30)
(0.30)
(0.37)
(0.31)

n=500
E.gO opt /

7.78
8.01
7.68
6.96
7.57
7.78
8.02
7.70
7.09
7.57

(0.13)
(0.08)
(0.13)
(0.31)
(0.17)
(0.13)
(0.06)
(0.11)
(0.26)
(0.17)

O gO opt /
E.

E.gO opt /

n=1000
O gO opt /
E.
E.gO opt /

7.84
8.11
8.03
7.39
7.73

PS correct
(0.21) 7.83
(0.20) 8.07
(0.20) 7.83
(0.28) 7.28
(0.21) 7.68

(0.10)
(0.03)
(0.06)
(0.23)
(0.11)

7.85
8.11
8.04
7.55
7.73

(0.16)
(0.15)
(0.15)
(0.22)
(0.16)

7.84
8.09
7.89
7.47
7.70

(0.08)
(0.02)
(0.04)
(0.17)
(0.08)

7.82
8.03
7.95
7.22
7.70

PS incorrect
(0.19) 7.83
(0.18) 8.07
(0.18) 7.85
(0.24) 7.19
(0.20) 7.68

(0.10)
(0.03)
(0.05)
(0.16)
(0.11)

7.82
8.03
7.96
7.25
7.70

(0.14)
(0.14)
(0.13)
(0.18)
(0.15)

7.84
8.09
7.89
7.22
7.70

(0.08)
(0.02)
(0.04)
(0.12)
(0.08)

Results for the two scenarios are shown in Tables I and II, respectively. Under scenario 1 (Table I) where the true
gopt is in the form of a tree, it is clear that the proposed method using the AIPWE estimator of the contrast function,
i.e., CO AIPWE , achieves the best performance overall, with expected outcomes under the chosen regimes very close to
the expectation under the true optimal regime. This good performance, we believe, is for two reasons. First, CO AIPWE
estimates the contrast function using the AIPWE, which, as discussed previously, is robust and efﬁcient relative to
competing methods. Second, it exploits a ﬂexible classiﬁcation method for optimization, without having to prespecify
the parametric form of the class of regimes under consideration. All other methods lack either one or both of these two
features. We note that CO IPWE has the worst performance of the considered methods across all scenarios, which may be
due to instability of the IPWE. Under scenario 2 (shown in Table II) the true gopt is linear and not well-approximated
by a tree with splits along the coordinate axes; the method of Zhang et al. (2012a) has the best performance, which
is expected since the speciﬁed class G contains the true optimal regime. Nevertheless, the proposed method using
CO AIPWE estimates regimes with near optimal performance.

5

Application to the NSABP trial

As an illustration, consider data from a trial conducted by the National Surgical Adjuvant Breast and Bowel Project
(NSABP) comparing L-phenylalanine mustard and 5-ﬂuorouracil (PF) to PF plus tamoxifen (PFT) in patients with primary operable breast cancer and positive nodes (Fisher et al., 1983). The study investigators found that heterogeneity
in response to PFT exists and the response depends on age (years) and progesterone receptor level (PR, fmol). Gail
& Simon (1985) analyzed these data using a test for qualitative interaction between treatment and covariates. Their
results support the regime proposed by Fisher et al. (1983), which recommends that subjects with age < 50 and PR
< 10 fmol should receive PF, with all others receiving PFT.
We analyzed data from n D 1276 patients with complete information on age and PR. Because the distribution of PR
is very skewed, following Zhang et al. (2012a), we make the log transformation, i.e., LPR D log.PR C 1/. We denote
age and LPR by X1 and X2 , respectively. The outcome of interest is binary with Y D 1 if a subject survived disease-free

Stat 2012; 1: 103–114

111

Copyright © 2012 John Wiley & Sons Ltd

Stat

B. Zhang et al.
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

to three years from baseline, and Y D 0 otherwise. Indicator variable A denotes treatment with A D 1 if a subject was
randomized to PFT and 0 if PF.
We implemented the proposed method using the AIPWE estimator of the contrast function and CART for the classiﬁcation step. The simple form of a decision tree yielded from CART allow us to make direct comparison with
O one needs to
the regime of Fisher et al. (1983) and Gail & Simon (1985). To calculate CO AIPWE .X, A, Y; O , ˇ/,
build both outcome regression and propensity score models. For the outcome regression, we postulated the logistic
regression model
.A, X; ˇ/ D expit¹ˇ0 C ˇ1 X1 C ˇ2 X2 C A.ˇ3 C ˇ4 X1 C ˇ5 X2 /º

(4)

for E.YjA, X/ D pr.Y D 1jA, X/, where expit.u/ D eu =.1 C eu /. The propensity score .X/ was estimated directly
P
by the sample proportion i.e., niD1 Ai =n for all X, as this was a randomized study. Constructing weights and labels
opt
based on the estimated contrasts, the estimated optimal treatment regime given by CART is gO C,AIPWE .X/ D 1  I.age <
59.5 and PR < 16.5/, under which a patient should receive PF if she is younger than 59.5 and has PR less than 16.5
and should receive PFT otherwise. Note that the estimated regime has the same form as that of Fisher et al. (1983)
and Gail & Simon (1985) but differs a bit in the cutoff values. The estimated mean outcomes using (1) under the
estimated regime is 0.681 .95%CI : 0.646, 0.717/.
Considering a restricted class of regimes with a form 1  I.age < 1 and PR < 2 /, the robust AIPWE-based method
of Zhang et al. (2012a) yields an estimated regime given by 1  I.age < 60 and PR < 9/, with estimated mean
outcomes under the regime 0.686 .0.651, 0.722/. The results are virtually identical as in our methods. However, in
the method of Zhang et al. (2012a), the form of regime has to be determined a priori, which can be challenging
in practice.

6

Discussion

We proposed a novel framework within which the optimal treatment regime at a single decision point can be estimated
using off-the-shelf classiﬁcation methods. This framework allows the separation of two critical steps. In the ﬁrst step,
estimated contrast functions are constructed for each subject independently without the need to specify a class of
treatment regimes. Based on the estimated contrasts, a “weight” and a binary “response” are created for each subject
which are then used as input to a classiﬁcation algorithm to identify the optimal treatment regime by minimizing a
weighted misclassﬁcation error. This separation creates ﬂexibility and allows the use of existing classiﬁcation algorithms
on this new class of problems. As in Zhang et al. (2012a), the class of treatment regimes does not have to be dictated
by a regression model for the outcome and can therefore be more robust and ﬂexible.
The proposed framework is general enough to include both the work of Zhao et al. (2012), and Zhang et al. (2012a)
as special cases. Nonetheless, there are a number of interesting directions for future research; we mention two that are
of particular interest. The ﬁrst is the incorporation of variable selection methods both in the modeling of the contrast
function (say, through the outcome regression model) and the subsequent classiﬁcation algorithm. One approach
would be to perform model selection separately for the estimation of the contrast function and the estimation of the
optimal treatment regime. However, in high dimensions, the selected outcome regression model may have a signiﬁcant
impact on the quality of the estimated optimal treatment regime, and it is preferable that the two model selection
steps be done in concert. A second direction is to extend this framework to include the multiple decision setting. In
this setting, personalized treatment is operationalized as sequence of treatment regimes, one for each stage of clinical
intervention, that adapt to the patients evolving health status. Zhang et al. (2012b) derive an AIPWE method for
estimating an optimal sequence of treatment regimes but a general framework is lacking.

Copyright © 2012 John Wiley & Sons Ltd

112

Stat 2012; 1: 103–114

Stat

Treatment regimes and classiﬁcation
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

Acknowledgement
This research was partially supported by NIH grants P01CA142538, R01CA085848, and R37AI031789.

References
Breiman, L, Freidman, JH, Olshen, RA & Stone, CJ (1984), Classiﬁcation and Regression Trees, Wadsworth, Belmont,
CA.
Brinkley, J, Tsiatis, AA & Anstrom, KJ (2009), ‘A generalized estimator of the attributable beneﬁt of an optimal
treatment regime’, Biometrics, 21, 512–522.
Cortes, C & Vapnik, V (1995), ‘Support-vector networks’, Machine Learning, 20, 273–297.
Fisher, B, Redmond, C, Brown, A, Wickerham, DL, Wolmark, N, Allegra, J, Escher, G, Lippman, M, Savlov, E &
Wittliff, J (1983), ‘Inﬂuence of tumor estrogen and progesterone receptor levels on the response to Tamoxifen and
chemotherapy in primary breast cancer’, Journal of Clinical Oncology, 1, 227–241.
Freund, Y & Schapire, RE (1997), ‘A decision-theoretic generalization of on-line learning and an application to
boosting’, Journal of Computer and System Sciences, 55, 119–139.
Gail, M & Simon, R (1985), ‘Testing for qualitative interactions between treatment effects and patient subsets’,
Biometrics, 41, 361–372.
Gunter, L, Zhu, J & Murphy, SA (2011), ‘Variable selection for qualitative interactions’, Statistical Methodology, 8
(1), 42–55.
Hastie, T, Tibshirani, R & Friedman, J (2009), The Elements of Statistical Learning, Springer-Verlag, New York, NY.
Henderson, R, Ansell, P & Alshibani, D (2010), ‘Regret-regression for optimal dynamic treatment regimes’, Biometrics,
66, 1192–1201.
Moodie, EEM, Richardson, TS & Stephens, DA (2007), ‘Demystifying optimal dynamic treatment regimes’, Biometrics,
63, 447–455.
Murphy, SA (2003), ‘Optimal dynamic treatment regimes (with discussion)’, Journal of the Royal Statistical Society,
Series B, 58, 331–366.
Orellana, L, Rotnitzky, A & Robins, J (2010), ‘Dynamic regime marginal structural mean models for estimation of
optimal dynamic treatment regimes, Part I: main content’, International Journal of Biostatistics, 6 (2), Article 8,
DOI 10.2202/1557-4679.1200.
Robins, JM. (2004). ‘Optimal structured nested models for optimal sequential decisions’, in Lin, DY & Heagerty,
PJ (eds.), Proceedings of the Second Seattle Symposium on Biostatistics, Springer, New York, pp. 189–326.
Robins, J, Orellana, L & Rotnitzky, A (2008), ‘Estimation and extrapolation of optimal treatment and testing strategies’,
Statistics in Medicine, 27, 4678–4721.
Rubin, DB (1978), ‘Bayesian inference for causal effects: the role of randomization’, Annals of Statistics, 6, 34–58.
Schulte, PJ, Tsiatis, AA, Laber, EB & Davidian, M (2012), ‘Q- and A-learning methods for estimating optimal dynamic
treatment regimes’, Statistical Science. in revision, http://arxiv.org/abs/1202.4177.

Stat 2012; 1: 103–114

113

Copyright © 2012 John Wiley & Sons Ltd

Stat

B. Zhang et al.
(wileyonlinelibrary.com) DOI: 10.1002/sta4.11

The ISI’s Journal for the Rapid
Dissemination of Statistics Research

Vapnik, V, Golowich, S & Smola, A (1997), ‘Support vector method for function approximation, regression estimation,
and signal processing’, Advances in Neural Information Processing Systems, 9, 281–287.
Zhang, B, Tsiatis, AA, Laber, EB & Davidian, M (2012a), ‘A robust method for estimating optimal treatment regimes’,
Biometrics, in press. DOI: 10.1111/j.1541-0420.2012.01763.x.
Zhang, B, Tsiatis, AA, Laber, EB & Davidian, M (2012b), ‘Robust estimation of optimal dynamic treatment regimes
for sequential treatment decisions’, Biometrika, in revision.
Zhao, Y, Kosorok, MR & Zeng, D (2009), ‘Reinforcement learning design for cancer clinical trials’, Statistics in
Medicine, 28, 3294–3315.
Zhao, Y, Zeng, D, Rush, AJ & Kosorok, MR (2012), ‘Estimating individualized treatment rules using outcome weighted
learning’, Journal of the American Statistical Association, 107, 1106–1118.

Copyright © 2012 John Wiley & Sons Ltd

114

Stat 2012; 1: 103–114

