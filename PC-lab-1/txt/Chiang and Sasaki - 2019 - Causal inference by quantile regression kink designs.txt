Journal of Econometrics 210 (2019) 405–433

Contents lists available at ScienceDirect

Journal of Econometrics
journal homepage: www.elsevier.com/locate/jeconom

Causal inference by quantile regression kink designs✩
Harold D. Chiang, Yuya Sasaki

∗

Department of Economics, Vanderbilt University, VU Station B #351819, 2301 Vanderbilt Place, Nashville, TN 37235-1819, USA

article

info

a b s t r a c t
The quantile regression kink design (QRKD) is proposed by empirical researchers, but its
causal interpretation remains unknown. We show that the QRKD estimand measures a
weighted average of heterogeneous marginal effects at respective conditional quantiles
of outcome given a designed kink point. We also derive limit processes for the QRKD
estimator to conduct statistical inference on heterogeneous treatment effects using
the QRKD. Applying our methods to the Continuous Wage and Benefit History Project
(CWBH) data, we find heterogeneous positive causal effects of unemployment insurance
benefits on unemployment durations. These effects are larger for individuals with longer
unemployment durations.
© 2019 Elsevier B.V. All rights reserved.

Article history:
Received 31 August 2016
Received in revised form 21 December 2018
Accepted 24 February 2019
Available online 5 March 2019
JEL classification:
C14
C21
Keywords:
Causal inference
Heterogeneous treatment effects
Identification
Regression kink design
Quantile regression
Unemployment duration

1. Introduction
Some recent empirical research papers, including Nielsen et al. (2010), Landais (2015), Simonsen et al. (2016), Card
et al. (2016), and Dong (2016), conduct causal inference via the regression kink design (RKD). A natural extension of the
RKD with a flavor of unobserved heterogeneity is the quantile RKD (QRKD), which is the object that we explore in this
paper. Specifically, consider the quantile derivative Wald ratio of the form
QRKD(τ ) =

limx↓x0

∂
Q (τ
∂ x Y |X

| x) − limx↑x0

d
limx↓x0 dx
b(x)

− limx↑x0

∂
Q (τ
∂ x Y |X

| x)

(1.1)

d
b(x)
dx

at a design point x0 of a running variable x, where QY |X (τ |x) := inf{y : F (y|x) ≥ τ } denotes the τ -th conditional quantile
function of Y given X = x, and b is a policy function. Note that it is analogous to the RKD estimand of Card et al. (2016):
RKD =

limx↓x0

∂
∂x

E[Y | X = x] − limx↑x0

d
limx↓x0 dx
b(x)

− limx↑x0

∂
∂x

E[Y | X = x]

d
b(x)
dx

,

(1.2)

✩ We would like to thank Patty Anderson and Bruce Meyer for kindly agreeing to our use of the CWBH data. We benefited from very useful
comments by Han Hong (the editor), the associate editor, anonymous referees, Matias Cattaneo, Andrew Chesher, Antonio Galvao, Emmanuel Guerre,
Blaise Melly, Chris Taber, Jungmo Yoon, seminar participants at Academia Sinica, National Chengchi University, National University of Singapore,
Otaru University of Commerce, Penn State University, Queen Mary University of London, Temple University, University of Pittsburgh, University of
Surrey, University of Wisconsin-Madison and Vanderbilt University, and conference participants at AMES 2016, CeMMAP-SNU-Tokyo Conference on
Advances in Microeconometrics, ESEM 2016, New York Camp Econometrics XI. All remaining errors are ours.
∗ Corresponding author.
E-mail addresses: harold.d.chiang@vanderbilt.edu (H.D. Chiang), yuya.sasaki@vanderbilt.edu (Y. Sasaki).
https://doi.org/10.1016/j.jeconom.2019.02.005
0304-4076/© 2019 Elsevier B.V. All rights reserved.

406

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

except that the conditional expectations in the numerator are replaced by the corresponding conditional quantiles. While
the QRKD estimand (1.1) is of potential interest in the empirical literature for assessment of heterogeneous treatment
effects, little seems known about its econometric theories. Specifically, Landais (2011) considers (1.1), but no formal
theories of identification, estimation, and inference are provided. This paper develops causal interpretation (identification)
and estimation theories for the QRKD estimand (1.1). In addition, we also present a practical guideline of robust inference
by pivotal simulations, a procedure for bandwidth selection, and statistical testing of heterogeneous treatment effects
based on the QRKD.
To understand our objective, consider a structural relation y = g(b, x, ϵ ), where the outcome y is determined by
observed factors (b, x) and unobserved factors ϵ . The marginal causal effect of b on y for individual i with (bi , xi , ϵi ) is
quantified by g1 (bi , xi , ϵi ), where g1 denotes the partial derivative of g with respect to the first argument. An estimand θ
has a causal interpretation at (b, x) if it admits

θ=

∫

g1 (b, x, ϵ )dµ(ϵ )

(1.3)

for some probability measure µ whose support is contained in that of ϵ . The literature has proposed this way of causal
interpretations for major statistical estimands. Examples include the OLS slope (Yitzhaki, 1996), the two stage least squares
estimand under multivalued discrete treatments (Angrist and Imbens, 1995), an IV estimand under partial equilibrium
(Angrist et al., 2000), a list of most common treatment effects (Heckman and Vytlacil, 2005), and the slope of the quantile
regression (Kato and Sasaki, 2017). In a similar spirit, we argue in the present paper that the QRKD estimand (1.1) can be
reconciled with the causal interpretation of the form (1.3).
Making causal interpretations of the QRKD estimand (1.1) in the form (1.3) is perhaps more challenging than the
d
and the conditional quantile do not ‘swap.’ For the
mean RKD estimand (1.2) because the differentiation operator dx
mean RKD estimand (1.2), the interchangeability of the differentiation operator and the expectation (integration) operator
allows each term of the numerator in (1.2) to be additively decomposed into two parts, namely the causal effects and the
endogeneity effects. Taking the difference of two terms in the numerator then cancels out the endogeneity effects, leaving
only the causal effects. This trick allows the mean RKD estimand (1.2) to have causal interpretations in the presence of
endogeneity. Due to the lack of such interchangeability for the case of quantiles, this trick is not straightforwardly inherited
by the quantile counterpart (1.1). Having said this, we show in Section 2 that a similar decomposition is possible for the
QRKD estimand (1.1), and therefore argue that its causal interpretations are possible even under the lack of monotonicity.
Specifically, we show that the QRKD estimand corresponds to the quantile marginal effect under monotonicity and to a
weighted average of marginal effects under non-monotonicity.
For estimation of the causal effects, we propose a sample-counterpart estimator for the QRKD estimand (1.1) in Section 3. To derive its asymptotic properties, we take advantage of the existing literature on uniform Bahadur representations
for quantile-type loss functions, including Kong et al. (2010), Guerre and Sabbah (2012), Sabbah (2014), and Qu and Yoon
(2015a). Qu and Yoon (2015b) apply the results of Qu and Yoon (2015a) to develop methods of statistical inference with
quantile regression discontinuity designs (QRDD), which are closely related to our QRKD framework. We take a similar
approach with suitable modifications to derive asymptotic properties of our QRKD estimator. Weak convergence results for
the estimator as quantile processes are derived. Applying the weak convergence results, we propose procedures for testing
treatment significance and treatment heterogeneity following Koenker and Xiao (2002), Chernozhukov and Fernández-Val
(2005) and Qu and Yoon (2015b). Simulation studies presented in Section 4 support the theoretical properties.
Literature: The method studied in this paper falls in the broad framework of design-based causal inference, including
RDD and RKD. There is an extensive body of literature on RDD by now — see a historical review by Cook (2008) and
surveys in the special issue of Journal of Econometrics edited by Imbens and Lemieux (2008), Imbens and Wooldridge
(2009, Section 6.4), Lee and Lemieux (2010), and Volume 38 of Advances in Econometrics edited by Cattaneo and Escanciano
(2017), as well as the references cited therein. The first extension to quantile treatment effects in the RDD framework
was made by Frandsen et al. (2012). More recently, Qu and Yoon (2015b) develop uniform inference methods with QRDD
that empirical researchers can use to test a variety of important empirical questions on heterogeneous treatment effects.
While the RDD has a rich set of empirical and theoretical results including the quantile extensions, the RKD method which
developed more recently does not have a quantile counterpart in the literature yet, despite potential demands for it by
empirical researchers (e.g., (Landais, 2011). Our paper can be seen as a quantile extension to Card et al. (2016) and a RKD
counterpart of Qu and Yoon (2015b).
2. Causal interpretation of the QRKD estimand
In this section, we develop some causal interpretations of the QRKD estimand (1.1). For the purpose of illustration, we
first present a simple case with rank invariance in Section 2.1. It is followed by a formal argument for general cases in
Section 2.2.

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

407

2.1. Illustration: Causal interpretation under rank invariance
The causal relation of interest is represented by the structural equation
y = g(b, x, ϵ ).
The outcome y is determined through the structural function g by two observed factors, b ∈ R and x ∈ R, and a scalar
unobserved factor, ϵ ∈ R. We assume that g is monotone increasing in ϵ , effectively imposing the rank invariance; causal
interpretations in a more general setup with non-monotone g and/or multivariate ϵ is established in Section 2.2. The
factor b is a treatment input, and is in turn determined by the running variable x through the structural equation
b = b(x)
+
for a known policy function b. We say that b has a kink at x0 if b′ (x+
0 ) := limx→x
0

db(x)
dx

̸= limx→x−
0

db(x)
dx

=: b′ (x−
0 ) is true,

−
where x → x+
0 and x → x0 mean x ↓ x0 and x ↑ x0 , respectively. Throughout this paper, we assume that the location, x0 ,
of the kink is known from a policy-based research design, as is the case with Card et al. (2016).

Assumption 1.

′ −
b′ (x+
0 ) ̸ = b (x0 ) holds, and b is continuous on R and differentiable on R \ {x0 }.

∂
g(b, x, ϵ ). In
The structural partial effects are g1 (b, x, ϵ ) := ∂∂b g(b, x, ϵ ), g2 (b, x, ϵ ) := ∂∂x g(b, x, ϵ ) and g3 (b, x, ϵ ) := ∂ϵ
particular, a researcher is interested in g1 which measures heterogeneous partial effects of the treatment intensity b on
an outcome y. While the structural partial effect g1 is of interest, it is not clear if the QRKD estimand (1.1) provides any
information about g1 . In this section, we argue that (1.1) does have a causal interpretation in the sense that it measures
the structural causal effect g1 (b(x0 ), x0 , ϵ ) at the τ -th conditional quantile of ε given X = x0 .
Under regularity conditions (to be discussed in Section 2.2 in detail), some calculations yield the decomposition

∂
QY |X (τ | x) = g1 (b(x), x, ϵ ) · b′ (x) + g2 (b(x), x, ϵ ) −
∂x

∫ϵ

∂
f (e
−∞ ∂ x ε|X

| x)de

fε|X (ϵ | x)

· g3 (b(x), x, ϵ ),

(2.1)

where τ = Fε|X (ϵ | x). The first term on the right-hand side is the partial effect of the running variable x on the outcome
y through the policy function b. The second term is the direct partial effect of the running variable on the outcome y. The
third term measures the effect of endogeneity in the running variable x. We can see that this third term is zero under
exogeneity, ∂∂x fε|X = 0. In order to get the causal effect g1 (b(x), x, ϵ ) of interest through the QRKD estimand (1.1), therefore,
we want to remove the last two terms in (2.1).
Suppose that the designed kink condition of Assumption 1 is true, but all the other functions, g1 , g2 , g3 , 1/fε|X and
∂
f
, on the right-hand side of (2.1) are continuous in (b, x) at (b(x0 ), x0 ). Then, (2.1) yields
ε|
∂x X
∂
Q (τ
∂ x Y |X

| x+
0)−

b′ (x+
0)−

∂
Q (τ
∂ x Y |X
′
b (x− )

| x−
0)

= g1 (b(x0 ), x0 , ϵ ),

(2.2)

0

showing that the QRKD estimand (1.1) measures the structural causal effect g1 (b(x0 ), x0 , ϵ ) of b on y for the subpopulation
of individuals at the τ -th conditional quantile of ε given X = x0 . This section provides only an informal argument for ease
of exposition, but Section 2.2 provides a formal mathematical argument under a general setup without the rank invariance
assumption.
2.2. General result: causal interpretation without rank invariance
In this section, we continue to use the basic settings from Section 2.1 except that the unobserved factors ϵ are now
allowed to be M-dimensional, as opposed to being a scalar, and that g is now allowed to be non-monotone with respect to
any coordinate of ϵ . As such, we can consider general structural functions g without the rank invariance. In this case, there
can exist multiple values of ϵ corresponding to a single conditional quantile τ of Y given X = x0 , and therefore the simple
identifying equality (2.2) for the case of rank invariance cannot be established in general. Furthermore, QRKD(τ ) even
fails to equal the average of the structural derivatives g1 (b(x0 ), x0 , ϵ ) for those ϵ that coincide with the τ -th conditional
quantile of Y given X = x0 . Nonetheless, we argue that QRKD(τ ) represents a weighted average of the structural derivatives
g1 (b(x0 ), x0 , ϵ ) for those ϵ that coincide with the τ -th conditional quantile of Y given X = x0 .
Define the lower contour set of ϵ evaluated by g(b(x), x, ·) below a given level of y as follows:
V (y, x) = {ϵ ∈ RM |g(b(x), x, ϵ ) ≤ y}.
Its boundary is denoted by ∂ V (y, x). Note that ∂ V (y, x) represents the boundary in the space of unobserved latent variable
ϵ of those individuals residing at the FY |X (y|x)-th conditional quantile function QY |X at (X , Y ) = (x, y). Furthermore, the
velocities of the boundary ∂ V (y, x) at ϵ with respect to a change in y and a change in x are denoted by ∂υ (y, x; ϵ )/∂ y
and ∂υ (y, x; ϵ )/∂ x, respectively. The velocity ∂υ (y, x; ϵ )/∂ y measures the direction and the magnitude of change in the
boundary ∂ V (y, x) in response a change in the outcome y while the running variable x is fixed. For instance, as the outcome
y infinitesimally increases while x is fixed, individuals with infinitesimally higher abilities ϵ may be included in the lower

408

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

contour set V (y, x), and hence the velocity ∂υ (y, x; ϵ )/∂ y is supposedly a positive vector if the outcome tends to be
increasing in the abilities ϵ . Likewise, the velocity ∂υ (y, x; ϵ )/∂ x measures the direction and the magnitude of change
in the boundary ∂ V (y, x) in response a change in the running variable x while the outcome y is fixed. Since the concept
of quantile regressions is to measure the response of y to x while fixing the probability of the event V (y, x), balancing the
inflows of ϵ measured by the velocity ∂υ (y, x; ϵ )/∂ y and the outflows of ϵ measured by the velocity ∂υ (y, x; ϵ )/∂ x is the
key to controlling for the unobservables ϵ to make a causal interpretation of the quantile regression derivative. For a short
∂ h(x,ϵ )
hand notation, we write h(x, ϵ ) = g(b(x), x, ϵ ) and hx (x, ϵ ) = ∂ x . Under regularity conditions to be stated below, the
implicit function theorem allows the velocities defined above to be explicitly written as ∂υ (y, x; ϵ )/∂ y = 1/∥∇ϵ h(x, ϵ )∥
and ∂υ (y, x; ϵ )/∂ x = −hx (x, ϵ )/∥∇ϵ h(x, ϵ )∥ for all ϵ ∈ V (y, x). Let Σ denote an (M − 1)-dimensional rectangle, and we
parameterize the manifold ∂ V (y, x) by Πy,x : Σ → ∂ V (y, x) for all (y, x). We refer to Padula (2011) for further details
of these objects and notations. Let mM and H M −1 denote the Lebesgue measure on RM and the Hausdorff measure1 on
∂ V (y, x), respectively. Letting X = supp(X ), we make the following assumptions.
Assumption 2. (i) h(·, ϵ ) is continuously differentiable on X \ {x0 } for all ϵ ∈ E and h(x, ·) is continuously differentiable for
all x ∈ X . (ii) ∥∇ϵ h(x, ·)∥ ̸ = 0 on ∂ V (y, x) for all (x, y) ∈ X × Y . (iii) The conditional distribution of ε given X is absolutely
continuous
with respect to mM , fε|X is continuously differentiable, and X ∋ x ↦ → fε|X (·|x) ∈ L1 (RM , mM ) is continuous.2
∫
(iv) ∂ V (y,x) fε|X (ϵ | x)dH M −1 (ϵ ) > 0 for all (x, y) ∈ X × Y .
Assumption 3. (i) For M = 1: ∂ V (y, x) is a finite set, and h(x, ·) is locally invertible with a continuously differentiable local
inverse function in a neighborhood of each point in ∂ V (y, x). (ii) For M > 1: Σ × X ∋ (s, x) ↦ → Πy,x (s) ∈ RM is continuous
for all y ∈ Y , and Σ × Y ∋ (s, y) ↦ → Πy,x (s) ∈ RM is continuous for all x ∈ X . X ∋ x ↦ → ∂υ (y, x; Πy,x (·))/∂ x ∈ L1 (Σ , mM −1 )
is continuous for all y ∈ Y .3 Y ∋ y ↦ → ∂υ (y, x; Πy,x (·))/∂ y ∈ L1 (Σ , mM −1 ) is continuous for all x ∈ X .4
Assumption 4. Let γ (x, ϵ ) := ∥∇ϵ h(x, ϵ )∥−1 . There exist p ⩾ 1 and q ⩾ 1 satisfying p−1 + q−1 = 1 such that
∥γ (x, · )∥Lp (∂ V (y,x),H M −1 ) < ∞ and ∥fε ∥Lq (∂ V (y,x),H M −1 ) < ∞ hold for all (x, y) ∈ X × Y .
Assumption 5. (i) There exists wy,x ∈ L1 (∂ V (y, x), H M −1 ) such that |γ (x, ϵ )hx (x, ϵ )fε|X (ϵ|x)|≤ wy,x (ϵ ) and |γ (x, ϵ )fε|X (ϵ|x)|≤
wy,x (ϵ ) for all ϵ ∈ ∂ V (y, x) for all (y, x) ∈ Y × X . (ii) There exists wy,x ∈ L1 (V (y, x), mM −1 ) such that |∂ fε|X (ϵ|x)/∂ x|≤ wy,x (ϵ )
for all ϵ ∈ V (y, x) for all (y, x) ∈ Y × X .
Assumption 2, 3 and 4 are used to derive a structural decomposition of the quantile partial derivative — see Sasaki
(2015) for detailed discussions of these assumptions. Assumption 3 branches into two cases, depending on (i) M = 1 or
(ii) M > 1. We note that case (i) accommodates a non-monotone structure g in a scalar unobservable ε , whereas case
(ii) generally concerns about non-monotonicity due to multi-dimensional unobservables ε . These two cases are stated
separately because the restriction in case (ii) among others entails that ∂ V (y, x) is a connected set, which is too strong
for case (i) with non-monotonicity. In Assumption 2 (iv) and 4, statements concern about integration of fε|X =x on ∂ V (y, x).
This manifold ∂ V (y, x) has a Lebesgue measure zero, i.e., mM (∂ V (y, x)) = 0. On the other hand, the Hausdorff measure
evaluates this Lebesgue null set positively, i.e., H M −1 (∂ V (y, x)) > 0. Hence these assumptions are nontrivial statements.
The regularity conditions in Assumption 5 facilitate the dominated convergence theorem to make a structural sense
of the QRKD estimand (1.1). Specifically, by the dominated convergence theorem, Assumption 5(i) and (ii) together
with Assumption 2(iv) and 4 are sufficient for the existence of the reduced-form expressions limx→x+ ∂∂x QY |X (τ |x) and
0

−1
limx→x− ∂∂x QY |X (τ |x). With B(y, x) denoting the collection of Borel subsets of ∂ V (y, x), we define the function µM
:
y,x
0
B(y, x) → R by

ϵ|

µ

ϵ

1
f ( x)dH M −1 ( )
s ∥∇ϵ h(x,ϵ )∥ ε|X
1
f ( x)dH M −1 (
∂ V (y,x) ∥∇ϵ h(x,ϵ )∥ ε|X

∫

M −1
y,x (S)

:= ∫

ϵ|

ϵ)

for all S ∈ B(y, x).

Because the zero-dimensional Hausdorff measure H 0 is a counting measure, the case of M = 1 yields
∥∇ϵ h(x,ϵ )∥ fε|X (ϵ|x)
1

µ

0
y,x (

1 The

{ϵ}) := ∑

ϵ∈∂ V (y,x) ∥∇ϵ h(x,ϵ )∥ fε|X (ϵ|x)
1

for all ϵ ∈ ∂ V (y, x).

(2.3)

M

is defined as follows. Define a function HpM −1
:
2R
→
R by HpM −1 (S)
=
⏐ ∞
}
M −1
M −1
⏐
supδ>0 inf
∪i=1 Si ⊃ S , diamSi < δ . We then define a restriction H
: B(V ) → R of Hp
to the Borel sigma algebra
i=1 (diamSi )
B(V ) of a metric space V ⊂ RM is a measure, and we call it the (M − 1)-dimensional Hausdorff measure. Intuitively, H M −1 measures a scaled area
of Borel subsets of the (M − 1)-dimensional manifold V ⊂ RM .
⏐
⏐
⏐
∫⏐
2 That is, for all δ > 0 there exists δ > 0 such that ⏐x′ − x⏐ < δ implies ⏐f (ϵ|x′ ) − f (ϵ|x)⏐ dmM (ϵ ) < δ .
1
2
2
ε|X
ε|X
1
⏐
⏐
⏐
⏐
∫
3 That is, ∀δ > 0 ∃δ > 0 such that ⏐x′ − x⏐ < δ implies ⏐∂υ (y, x; Π ′ (s))/∂ x − ∂υ (y, x; Π (s))/∂ x⏐ ds < δ .
1
2
2
y,x
1
y,x
⏐
⏐
⏐
∫⏐
4 That is, ∀δ > 0 ∃δ > 0 such that ⏐y′ − y⏐ < δ implies ⏐∂υ (y, x; Π ′ (s))/∂ y − ∂υ (y, x; Π (s))/∂ y⏐ ds < δ .
1
2
2
y,x
1
y ,x
Hausdorff

{∑∞

measure
M −1

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

409

The next theorem claims that this is a probability measure and gives weights with respect to which the QRKD estimand
(1.1) measures the average structural causal effect of the treatment intensity b on an outcome y for those individuals at
the τ -th conditional quantile of Y given X = x0 .
−1
Theorem 1. Suppose that Assumption 1, 2, 3, 4 and 5 hold. Let τ ∈ (0, 1) and y = QY |X (τ |x0 ). Then, µM
y,x0 is a probability
measure on ∂ V (y, x0 ), and

QRKD(τ ) =

∫

−1
g1 (b(x0 ), x0 , ϵ )dµM
y,x0 (ϵ ) = EµM −1 [g1 (b(x0 ), x0 , ε )] .
y,x0

∂ V (y,x0 )

(2.4)

As is often the case in the treatment literature (e.g., (Angrist and Imbens, 1995), this theorem shows a causal
interpretation in terms of a weighted average. Specifically, (2.4) shows that the QRKD estimand (1.1) measures a weighted
average of the heterogeneous causal effects g1 (b(x0 ), x0 , ϵ ) displayed on the right-hand side of (2.4). Since the weights are
positive on the support of the conditional distribution of ε given X = x0 , the QRKD estimand is a strict convex combination
of the ceteris paribus causal effects of b on y for those individuals at the τ -th conditional quantile of Y given X = x0 .
−1
The weights given in the definition of µM
y,x0 are proportional to fε|X (ϵ|x0 )/∥∇ϵ h(x0 , ϵ )∥. Since fε|X (ϵ|x0 ) is the conditional
density of the unobservables ε given X = x0 , the discrepancy between the weighted and unweighted averages is imputed
to the denominator, ∥∇ϵ h(x0 , ϵ )∥. For example, larger weights are assigned to those locations of ϵ ∈ ∂ V (y, x0 ) at which
∥∇ϵ h(x0 , ϵ )∥ is smaller. In other words, the QRKD emphasizes those locations of ϵ ∈ ∂ V (y, x0 ) at which the effects of
unobservables ε on the structure g are smaller in magnitude. On the other hand, the QRKD de-emphasizes those locations
of ϵ ∈ ∂ V (y, x0 ) at which the effects of unobservables ε on the structure g are larger in magnitude.
One may worry about the obscurity of the causal interpretations under the ‘weighted’ averages. Note that the weighted
average becomes an unweighted average when ∥∇ϵ h(x0 , ϵ )∥ is constant in ϵ . There are some cases where the weight is
constant. As an example which is often relevant to empirical practices, the polynomial random coefficient models of the
form
g(b, x, ϵ ) = ϵ00 +

pb
∑

ϵν 0 bν +

ν=1

px
∑

ϵ0ν xν +

ν=1

pb
px
∑
∑

ϵνb νx bνb xνx

(2.5)

νb =1 νx =1

satisfies that ∥∇ϵ h(x0 , ϵ )∥ is constant in ϵ = (ϵ00 , ϵ10 , . . . , ϵpb 0 , ϵ01 , . . . , ϵ0px , ϵ11 , . . . , ϵpb px ). Therefore, Theorem 1 entails
an unweighted average causal interpretation for the QRKD estimand under this model with

∫
−1
∫
µM
y,x (S) :=

f (
s ε|X

ϵ|x)dH M −1 (ϵ )

f (ϵ|x)dH
∂ V (y,x) ε|X

M −1 (

for all S ∈ B(y, x).

ϵ)

When the unobservable ε is a scalar random variable (i.e., M = 1), the Hausdorff measure H M −1 becomes a counting
measure H 0 on the zero-dimensional manifold ∂ V (y, x0 ) ⊂ R. In that case, (2.4) may be rewritten as
QRKD(τ ) =

∑
ϵ∈∂ V (y,x0 )

−1
g1 (b(x0 ), x0 , ϵ ) · µM
y,x0 ({ϵ}) = EµM −1 [g1 (b(x0 ), x0 , ε )] .
y,x0

(2.6)

In particular, the case where ∂ V (y, x0 ) is a singleton allows for the following straightforward causal interpretation for the
QRKD estimand.
Corollary 1. Suppose that the assumptions for Theorem 1 hold. Let τ ∈ (0, 1) and y = QY |X (τ |x0 ). If ε is a scalar random
variable (i.e., M = 1) and ∂ V (y, x0 ) is a singleton, then
QRKD(τ ) = g1 (b(x0 ), x0 , ϵ (y, x0 )),
where ϵ (y, x0 ) is the sole element of ∂ V (y, x0 ).
Note that this corollary is a generalization of (2.2), and admits the straightforward causal interpretation QRKD(τ ) =
g1 (b(x0 ), x0 , ϵ (y, x0 )) without requiring the ‘global’ monotonicity of g in ϵ . To see the point in case, consider the structural
function given by
g(b, x, ϵ ) = −9bϵ +

1
3

bϵ 3 − 9xϵ +

1
3

xϵ 3 .

If b(x0 ) + x0 ̸ = 0, then this structure is not globally monotone in ϵ at x = x0 . However, ∂ V (y, x0 ) is a singleton
(i.e., g(b(x0 ), x0 , ·) is locally monotone) for each value of y ̸ ∈ [−18, 18], and hence the causal interpretation QRKD(τ ) =
g1 (b(x0 ), x0 , ϵ (y, x0 )) of Corollary 1 applies. On the other hand, for each value of y ∈ [−18, 18], we can interpret the QRKD
at most in terms of the weighted sum of the form (2.6).
In either of these cases, heterogeneity in values of the QRKD estimand across quantiles τ can be used as evidence
for heterogeneity in treatment effects. Therefore, we can still conduct statistical inference for heterogeneous treatment
effects based on the weak convergence results presented below in Section 3.

410

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

3. Estimation and inference
3.1. The estimator and its asymptotic distribution
We propose to estimate the QRKD estimand (1.1) by its sample counterpart

ˆ τ) =
QRKD(

β̂1+ (τ ) − β̂1− (τ )
,
′ −
b′ (x+
0 ) − b (x0 )

(3.1)

where the two terms in the numerator are given by the pth order local polynomial quantile smoothers

β̂1+ (τ ) =ι′2

p
n
(x − x ) (
v)
∑
∑
i
0
− − (xi − x0 )
K
d
)
+
β
ρτ yi − α −
(βv+ d+
v i
i
hn,τ
v!
(α,β + ,β − ,...,βp+ ,βp− )∈R2p+1

argmin

1

v=1

i=1

1

p
n
(x − x ) (
v)
∑
∑
i
0
− − (xi − x0 )
argmin
K
β̂1− (τ ) =ι′3
ρτ yi − α −
(βv+ d+
i + βv d i )
hn,τ
v!
(α,β + ,β − ,...,βp+ ,βp− )∈R2p+1
1

v=1

i=1

1

for τ ∈ T , where T ⊂ (0, 1) is a closed interval, K is a kernel function, ρτ (u) = u(τ − 1{u < 0}) for u ∈ R, d+
i = 1{xi > x0 },
′
′
2p+1
d−
for a fixed integer p ≥ 1 of polynomial
i = 1{xi < x0 }, and ι2 = [0, 1, 0, 0, . . . , 0] , ι3 = [0, 0, 1, 0, . . . , 0] ∈ R
order. Following Landais (2011), we have the level parameter α common between the left (xi < x0 ) and the right (xi > x0 ),
while higher-order coefficients are allowed to be different between the left and the right.
In the remainder of this section, we present weak convergence results for the quantile processes τ ↦ → (β̂1+ (τ ), β̂1− (τ )),
which in turn yield a weak convergence result for the quantile process of the QRKD estimator of treatment effects. Using
these results, we then propose methods to test hypotheses
treatment effects in Section 3.2.
∫ ′ concerning heterogeneous
−
p +
p − ′
2p+1
Define the kernel-dependent constant matrix N =
ūū K (u)du, where ū = [1, ud+
,
u , udu , . . . , u du , u du ] ∈ R
−
<
x
and
x̄
>
x
such
that
the
following
d+
=
1
{
u
>
0
}
and
d
=
1
{
u
<
0
}
.
We
assume
that
there
exist
constants
x
0
0
u
u
conditions are satisfied.
Assumption 6. (i) (a) The density function fX (·) exists and is continuously differentiable in a neighborhood of x0 and
0 < fX (x0 ) < ∞. (b) {(yi , xi )}ni=1 is an i.i.d. sample of n observations of the bivariate random vector (Y , X ). (ii) (a)
fY |X (QY |X ( · |x0 )|x0 ) is Lipschitz continuous on T . (b) There exist finite constants fL > 0, fU > 0, and ξ > 0, such that
fY |X (QY |X (τ |x) + η|x) lies between fL and fU for all τ ∈ T , |η|≤ ξ and x ∈ [x, x̄]. (iii) (a) QY |X ( · |x0 ), ∂ QY |X ( · |x+
0 )/∂τ ,
and ∂ QY |X ( · |x−
0 )/∂τ exist and are Lipschitz continuous on T . (b) QY |X (τ | · ) is continuous at x0 . For v = 0, 1, . . . , p + 1,
(x, τ ) ↦ → ∂ v QY |X (τ |x)/∂ xv exists and is Lipschitz continuous on {(x, τ )|x ∈ (x0 , x̄], τ ∈ T } and {(x, τ )|x ∈ ∫[x, x0 ), τ ∈ T }.
(iv) The
∫ kernel K is compactly supported, having finite first-order derivative and satisfying K (·) ≥ 0, K (u)du = 1,
and uK (u)du = 0. The matrix N is positive definite. (v) The bandwidths satisfy hn,τ = c(τ )hn , where nh3n → ∞ and
2p+3
nhn
→ 0 as n → ∞, and c(·) is Lipschitz continuous satisfying 0 < c ≤ c(τ ) ≤ c < ∞ for all τ ∈ T .
Parts (i)–(v) of this assumption correspond to Assumptions 1–5, respectively, of Qu and Yoon (2015a), adapted to
our framework. Part (i) (a) also implies Assumption 6 of Qu and Yoon (2015a). Part (i) (a) requires smoothness of the
density of the running variable. This assumption can be interpreted as the design requirement for absence of endogenous
sorting across the kink point x0 . The i.i.d assumption in part (i) (b) is usually considered to be satisfied for micro data
of random samples. Part (ii) concerns about regularities of the conditional density function of Y given X . It requires
sufficient smoothness, but does not rule out a quantile regression kink at x0 , which is the main crucial assumption for
our identification argument. Part (iii) concerns about regularities of the conditional quantile function of Y given X . Like
part (ii), it does not rule out a quantile regression kink at x0 . For conciseness of the statements, we write parts (ii) and
(iii) of Assumption 6 in terms of high-level objects, but we also provide sufficient conditions stated in terms of structural
primitives in Appendix B.5. Part (iv) prescribes requirements for a kernel function to be chosen by a user. In Section 4 for
simulation studies, we propose an example of such a choice to satisfy this requirement. Part (v) specifies admissible rates
at which the bandwidth parameters diminish as the sample size becomes large. It obeys the standard rate for a first-order
2p+3
derivative estimation, but we also require its uniformity over quantiles τ in T . While nhn
→ 0 is required for a valid
inference with higher order bias reduction, it is not necessary for the uniform Bahadur representation to hold.
Under this set of assumptions, we obtain uniform Bahadur representations for the component estimators, β̂ + (τ ) and
β̂ − (τ ), of our interest similarly to Qu and Yoon (2015a) – see Lemma 1 in Appendix B.1. The following weak convergence
result in turn derives from the uniform Bahadur representations.
Theorem 2.

Suppose that Assumption 6 holds. Let Zn = Zn (·, ·) be defined by

Zn (τ1 , 2)
=
Zn (τ2 , 3)

[

⎡√
⎣√

]

(

nh3n,τ1 β̂1+ (τ1 ) −

(

nh3n,τ2 β̂1− (τ2 ) −

∂ QY |X (τ1 |x+
)
0
∂x
∂ QY |X (τ2 |x−
)
0
∂x

ι′2 (N)−1
(p+1)!
ι′3 (N)−1
p
hn,τ2 (p+1)!

− hpn,τ1
−

∂ p+1 QY |X (τ1 |x+
) +
0
du
∂ xp+1
(
∫
∂ p+1 QY |X (τ2 |x+
)
0
ū
d+
u
R
∂ xp+1

(

∫

R

ū

+
+

∂ p+1 QY |X (τ1 |x−
) −
0
du up+1 K (u)du
∂ xp+1
)
)⎦ .
∂ p+1 QY |X (τ2 |x−
) −
p+1
0
d
u
K
(u)du
p
+
1
u
∂x

)

)⎤

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

411

We have

[

]

[

Zn (·, 2)
G(·, 2)
⇒
Zn (·, 3)
G(·, 3)

]

for a tight zero-mean Gaussian process G : Ω ↦ → ℓ∞ (T × {2, 3}) with covariance function given by
E [G(τ1 , j1 )G(τ2 , j2 )] =

ι′j1 N −1 T (τ1 , τ2 )N −1 ιj2 (τ1 ∧ τ2 − τ1 τ2 )
fX (x0 )fY |X (QY |X (τ1 |x0 )|x0 )fY |X (QY |X (τ2 |x0 )|x0 )

for each τ1 , τ2 ∈ T and j1 , j2 ∈ {2, 3}, where T (τ1 , τ2 ) = (c(τ1 )c(τ2 ))−1/2
1,

[

u
d+
c(τ ) u

,

u
d−
c(τ ) u

,...,

up
d+
c p (τ ) u

,

up
d
c p (τ ) u

]
− ′

∫
R

ū(τ1 )ū′ (τ2 )K ( c(uτ ) )K ( c(uτ ) )du and ū(τ ) =
1

2

.

This result can be established by adapting Qu and Yoon (2015a) to our framework, and a proof is provided in
Appendix B.2. In this theorem, we explicitly write the pth order bias terms for the purpose of emphasizing on what
is the remaining order of biases. The next weak convergence result for the QRKD estimator (3.1) follows from Theorem 2.
Corollary 2.

√

Suppose that Assumptions 1 and 6 hold. We have

)
ˆ τ ) − QRKD(τ ) ⇒ Y (τ ) = (G(τ , 2) − G(τ , 3)) ,
nh3n,τ QRKD(
′ −
b′ (x+
0 ) − b (x0 )
(

τ ∈ T,

where Y is a zero mean Gaussian process with covariance function given by
E [Y (τ1 )Y (τ2 )] = (τ1 ∧ τ2 − τ1 τ2 )×

ι′2 N −1 T (τ1 , τ2 )N −1 ι2 + ι′3 N −1 T (τ1 , τ2 )N −1 ι3 − ι′2 N −1 T (τ1 , τ2 )N −1 ι3 − ι′3 N −1 T (τ1 , τ2 )N −1 ι2
′ − 2
fX (x0 )fY |X (QY |X (τ1 |x0 )|x0 )fY |X (QY |X (τ2 |x0 )|x0 )(b′ (x+
0 ) − b (x0 ))
for all τ1 , τ2 ∈ T .
The random process Y (·) has mean zero, as G(·, 2) and G(·, 3) do. In practice, we can compute its covariance structure
by using the pivotal method suggested in Qu and Yoon (2015a) – see Appendix C.2 for a practical guide on the
implementation. To account for possibly higher variance from the conditional quantiles at the localities where the
conditional density is small, we may also consider the following standardized version of the weak convergence results.
Let σ s (τ ) := {EY 2 (τ )}1/2 , and σ̂ s (τ ) be the uniformly consistent standard error estimate based on the pivotal method
(see Appendix C.2). An application of Slutsky’s theorem and the continuous mapping theorem to Corollary 2 leads to the
next result.
Corollary 3.

√

nh3n,τ

Suppose that Assumptions 1 and 6 hold. If σ s (·) is uniformly bounded away from 0 on T , then we have

( QRKD(
ˆ τ)
σ̂ s (τ )

−

QRKD(τ ) )

σ s (τ )

⇒ Y std (τ ) :=

Y (τ )
G(τ , 2) − G(τ , 3)
= s
,
′ −
σ s (τ )
σ (τ )(b′ (x+
0 ) − b (x0 ))

τ ∈ T,

where Y std is a zero mean Gaussian process with covariance function given by
E [Y std (τ1 )Y std (τ2 )] = (τ1 ∧ τ2 − τ1 τ2 )×

ι′2 N −1 T (τ1 , τ2 )N −1 ι2 + ι′3 N −1 T (τ1 , τ2 )N −1 ι3 − ι′2 N −1 T (τ1 , τ2 )N −1 ι3 − ι′3 N −1 T (τ1 , τ2 )N −1 ι2
′ − 2
σ s (τ1 )σ s (τ2 )fX (x0 )fY |X (QY |X (τ1 |x0 )|x0 )fY |X (QY |X (τ2 |x0 )|x0 )(b′ (x+
0 ) − b (x0 ))
and E(Y std (τ ))2 = 1 for all τ1 , τ2 ∈ T .
These weak convergence results are applicable for many purposes. They are readily applicable to computing uniform
confidence bands for the QRKD. Of particular interest may be the uniform tests regarding heterogeneous treatment effects.
We discuss these applications in Section 3.2.
3.2. Testing for heterogeneous treatment effects
Researchers are often interested in the following hypotheses regarding heterogeneous treatment effects.
Treatment Significance H0S : QRKD(τ ) = 0

for all τ ∈ T .

Treatment Heterogeneity H0H : QRKD(τ ) = QRKD(τ ′ )

for all τ , τ ′ ∈ T .

By the result in Section 2.1, under the case of rank invariance, these hypotheses regarding QRKD are equivalent to the
corresponding structural hypotheses:
H0S ⇐⇒

g1 (b(x0 ), x0 , Qε|X =x0 (τ )) = 0

H0H ⇐⇒

g1 (b(x0 ), x0 , Qε|X =x0 (τ )) = g1 (b(x0 ), x0 , Qε|X =x0 (τ ′ ))

for all τ ∈ T .
for all τ , τ ′ ∈ T .

412

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

Furthermore, by the result in Section 2.2, even under the general case without rank invariance, the hypotheses regarding
QRKD are logically implied by the corresponding structural hypotheses, i.e.,
H0S ⇐H

g1 (b(x0 ), x0 , ϵ ) = 0

H0H

g1 (b(x0 ), x0 , ϵ ) = g1 (b(x0 ), x0 , ϵ ′ )

⇐H

for all ϵ ∈ RM .
for all ϵ, ϵ ′ ∈ RM .

Therefore, by the contrapositive logic, a rejection of the null hypothesis H0S implies a rejection of the structural hypothesis
of uniform zero. Likewise, a rejection of the null hypothesis H0H implies a rejection of the structural hypothesis of
homogeneity. For these logical equivalences or implications, the hypotheses H0S and H0H may well be of practical interest.
Both of the two hypotheses, H0S and H0H , are considered in Koenker and Xiao (2002), Chernozhukov and Fernández-Val
(2005) and Qu and Yoon (2015b), among others. Following the approach of these preceding papers, the two hypotheses,
H0S and H0H , may be tested using the statistics
WSn (T ) = sup

√

τ ∈T

ˆ τ )⏐
nh3n,τ ⏐QRKD(

⏐

⏐

and

⏐
⏐
∫
√
⏐
⏐
′
′⏐
−1
3
ˆ
ˆ
⏐
QRKD(τ )dτ ⏐,
WHn (T ) = sup nhn,τ ⏐QRKD(τ ) − |T |
τ ∈T
T

or their standardized versions

⏐
⏐
ˆ τ)⏐
⏐ QRKD(
⏐
and
σ̂ s (τ ) ⏐
τ ∈T
∫
⏐ˆ
√
ˆ τ ′ )dτ ′ ⏐⏐
⏐ QRKD(τ ) − |T |−1 T QRKD(
⏐,
WHnstd (T ) = sup nh3n,τ ⏐⏐
⏐
σ̂ h (τ )
τ ∈T
WSnstd (T ) = sup

√

nh3n,τ ⏐⏐

respectively, where |T | denotes the length (Lebesgue measure) of the interval T ⊂ (0, 1), and σ̂ h (τ ) denotes the uniformly
′
(Y )(τ )]2 }1/2 based on the pivotal method (Appendix C.2).
consistent estimator of σ h (τ ) := {E [φQRKD
∫
ˆ τ ′)
For the second term in the statistic WHn (T ), we could also substitute a mean RKD estimator in place of |T |−1 QRKD(
T

ˆ ·).
dτ ′ . Nonetheless, we use the above definition for its convenient feature that it is written as a functional only of QRKD(
Consequences of Corollaries 2 and 3 are the following asymptotic distributions of these test statistics. A proof is provided
in Appendix B.4.
Corollary 4. Suppose that Assumptions 1 and 6 hold. If σ s ( · ) and σ h ( · ) are bounded away from zero uniformly on T , then
(i) WSn (T ) ⇒ supτ ∈T |Y (τ )| and WSnstd (T ) ⇒ supτ ∈T |Y (τ )/σ s (τ )| under the null hypothesis H0S ; and
′
′
(Y )(τ )/σ h (τ )| under the null hypothesis H0H , where
(Y )(τ )| and WHnstd (T ) ⇒ supτ ∈T |φQRKD
(ii) WHn (T ) ⇒ supτ ∈T |φ∫QRKD
′
−1
′
′
∞
φQRKD (λ)(τ ) = λ(τ ) − |T | T λ(τ )dτ for all λ ∈ ℓ (T ), the space of all bounded, measurable, real-valued functions defined
on T .
3.3. Covariates
In empirical researches, we often face the circumstances where covariates are observed in addition to the basic
variables. Under a mean regression setting, Calonico et al. (2016) have investigated regression discontinuity using
covariates. This subsection presents an extension of the baseline QRKD method and its asymptotic results to models with
covariates. Let W = (W1 , . . . , Wk )′ denote the covariate random vector of dimension k ∈ N. We suppose that the model
is compatible with the following partial linear structure:
y = g(b(x), x, ϵ ) + w′ θ (ϵ ) = QY |X (ϵ|x) + w′ θ (ϵ ) = QY |X (ϵ|x, w′ ).

(3.2)

where ε is normalized to ε ∼ Uniform(0, 1). We focus on this simple quantile regression representation with additive
covariates and a univariate ε in this section to provide a practical solution in the presence of covariates. We could maintain
the non-separability of covariates and the multi-dimensionality of ε by naively extending the baseline framework, but such
a naive extension would be doomed to a non-practicality in the curse of dimensionality. For the model (3.2), we are able
to obtain the same convergence rate for the estimator as in the baseline estimator.
Adding W′ γ to the baseline estimator, we propose

β̂1+ (τ ) =ι′2

p
n
(x − x ) (
)
v
∑
∑
i
0
− − (xi − x0 )
K
ρτ yi − α −
(βv+ d+
− W′i γ
i + βv d i )
hn,τ
v!
(α,β + ,β − ,...,βp+ ,βp− ,γ ′ )′ ∈R1+2p+k

argmin

1

1

i=1

v=1

p
)
v
∑ ( xi − x0 ) (
∑
− − (xi − x0 )
′
β̂1− (τ ) =ι′3
argmin
K
ρτ yi − α −
−
W
γ
(βv+ d+
+
β
d
)
i
v
i
i
hn,τ
v!
(α,β + ,β − ,...,βp+ ,βp− ,γ ′ )′ ∈R1+2p+k
n

1

1

i=1

v=1

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

413

With these local linear estimators, the QRKD is estimated in turn by

ˆ cov (τ ) =
QRKD

β̂1+ (τ ) − β̂1− (τ )
.
′ −
b′ (x+
0 ) − b (x0 )

For convenience of concisely presenting assumptions and results, we introduce the following
short-hand notations: ũ =
∫
′
−
p +
p −
′ ′
1+2p+k
′
k
ũ
ũ
K
(u)fW|X (w′ |x0 )dudw1 ...dwk ,
[1, ud+
,
ud
,
.
.
.
,
u
d
,
u
d
,
w
]
∈
R
where
w
=
[w
,
.
.
.
,
w
]
∈
R
,
R
=
1
k
k
+
1
u
u ∫
u
u
R
′
′
′
′
and Γ (τ ) = Rk+1 ũũ K (u)fY |WX (g(b(x0 ), x0 , τ ) + w θ (τ )|w , x0 ) fW|X (w |x0 )dudw1 ...dwk . Most of the required assumptions
stated in Assumption 7 are direct analogues of Assumption 6. Let y ≤
inf
g(b(x), x, ϵ ) + w′ θ (ϵ )
and y ≥

(ϵ,w′ ,x)∈T ×supp(W)×([x,x0 )∪(x0 ,x])

g(b(x), x, ϵ ) + w′ θ (ϵ ).

sup

(ϵ,w′ ,x)∈T ×supp(W)×([x,x0 )∪(x0 ,x])

Assumption 7. (i) (a) {(yi , xi , W′i )}ni=1 is an i.i.d. sample of n observations of (k + 2)-dimensional random vector (Y , X , W′ ).
Random vector W has a compact support. (b) fW|X is continuously differentiable in x on supp(W) × [x, x0 ) and supp(W) ×
(x0 , x]. fX is continuously differentiable in a neighborhood of x0 and 0 < fX (x0 ) < ∞.
(ii) (a) fY |WX is continuous on [y, y] × supp(W) × [x, x] and is continuously differentiable and Lipschitz continuous on
[y, y] × supp(W) × [x, x0 ) and [y, y] × supp(W) × (x0 , x]. (b) There exist finite constants fL > 0, fU > 0 and ξ > 0 such that
fY |WX (g(b(x), x, ϵ ) + w′ θ (ϵ ) + η|w′ , x) lies between fL and fU for all ϵ ∈ T , |η|≤ ξ and (w′ , x) ∈ supp(W) × [x, x̄]. (iii) (a)
∂
g(b(x0 ), x0 , ϵ ) exist and are Lipschitz continuous in ϵ on T . Each coordinate of θ (ϵ ) is continuously
g(b(x0 ), x0 , ϵ ) and ∂ϵ
differentiable and their derivatives are Lipschitz continuous in ϵ on T . (b) g(b(x), x, ϵ ) is continuous in x at x0 . For
v
v = 0, 1, . . . , p + 1, (x, ϵ ) ↦→ ∂∂xv [g(b(x), x, ϵ )] exists and is Lipschitz continuous on {(x, ϵ )|x ∈ (x0 , x̄], ϵ ∈ T } and
{(x, ϵ )|x ∈∫ [x, x0 ), ϵ ∈ T }. (iv)
∫ The kernel K is compactly supported, having finite first-order derivative and satisfying
K (·) ≥ 0, K (u)du = 1, and uK (u)du = 0. The matrices R and Γ (ϵ ) are positive definite for each ϵ ∈ T and the entries
of their inverse matrices are uniformly bounded functions of ϵ on T . (v) The bandwidths satisfy hn,ϵ = c(ϵ )hn , where
2p+3
nh3n → ∞ and nhn
→ 0 as n → ∞, and c(·) is Lipschitz continuous satisfying 0 < c ≤ c(ϵ ) ≤ c < ∞ for all ϵ ∈ T .
The following theorem states weak convergence results for the model (3.2) with covariates, analogously to Theorems 2
and 2 for the baseline model. The proofs are similar to their baseline counterparts and are therefore omitted.
Theorem 3.

[

Suppose that Assumption 7 holds for (3.2). Define X′′n = X′′n (·, ·) by

⎡√

Xn (τ1 , 2)
= ⎣√
X′′n (τ2 , 3)

]

′′

(

nh3n,τ1 β̂1+ (τ1 ) −

(

nh3n,τ2 β̂1− (τ2 ) −

)
∂ QY |X (τ1 |x+
0
∂x
⎦.
− )
∂ QY |X (τ2 |x0 )
∂x

)⎤

We have

[

X′′n (·, 2)
X′′n (·, 3)

]

[
⇒

Gcov (·, 2)
Gcov (·, 3)

]

for a tight zero mean Gaussian process Gcov : Ω ↦ → ℓ∞ (T × {2, 3}) with covariance function given by
E [Gcov (τ1 , j1 )Gcov (τ2 , j2 )] =

ι′j1 (Γ (τ1 ))−1 T̃ (τ1 , τ2 )(Γ (τ2 ))−1 ιj2 (τ1 ∧ τ2 − τ1 τ2 )
fX (x0 )

for all τ1 , τ2 ∈ T and j1 , j2 ∈ {2, 3}, where
−1/2

T̃ (τ1 , τ2 ) =(c(τ1 )c(τ2 ))
and

∫

ũ(τ1 )ũ′ (τ2 )K (u/c(τ1 ))K (u/c(τ2 ))fW|X (w1 , . . . , wk |x0 )dudw1 ...dwk

−
+
p
−
p
′
1+2p+k
ũ(τ ) =[1, ud+
.
u /(τ ), udu /(τ ), . . . , (udu /c(τ )) , (udu /c(τ )) , w1 , . . . , wk ] ∈ R

Consequently, if Assumption 1 also holds, then we have

√

(

)

ˆ cov (τ ) − QRKDcov (τ ) ⇒ Ycov (τ ) :=
nh3n,τ QRKD

Gcov (τ , 2) − Gcov (τ , 3)
′ −
b′ (x+
0 ) − b (x0 )

,

τ ∈ T.

4. Simulation studies
In this section, we report the performance of our causal inference methods using simulated data. The main building
blocks for the model consist of the policy function b, the outcome production function g, and the joint distribution of
(x, ε ). Consider the following policy function with a kink at x0 = 0.

{
−x if x ⩽ 0
b(x) =
x
if x > 0

414

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433
Table 1
Simulated finite-sample statistics of the QRKD estimates.
Structure 1

|Bias|

N =

1000

2000

4000

1000

2000

4000

1000

2000

4000

τ
τ
τ
τ
τ
τ
τ
τ
τ

= 0.10
= 0.20
= 0.30
= 0.40
= 0.50
= 0.60
= 0.70
= 0.80
= 0.90

0.00
0.00
0.00
0.01
0.00
0.00
0.00
0.00
0.01

0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00

0.02
0.01
0.01
0.01
0.00
0.00
0.00
0.00
0.00

0.28
0.22
0.19
0.18
0.18
0.18
0.19
0.21
0.28

0.24
0.19
0.17
0.15
0.15
0.16
0.17
0.18
0.24

0.20
0.16
0.14
0.13
0.13
0.14
0.14
0.16
0.21

0.28
0.22
0.19
0.18
0.18
0.18
0.19
0.21
0.28

0.24
0.19
0.17
0.16
0.15
0.16
0.17
0.18
0.24

0.20
0.16
0.14
0.13
0.13
0.14
0.14
0.16
0.21

Structure 2

|Bias|

N =

1000

2000

4000

1000

2000

4000

1000

2000

4000

τ
τ
τ
τ
τ
τ
τ
τ
τ

0.04
0.00
0.00
0.00
0.01
0.02
0.04
0.04
0.02

0.03
0.00
0.00
0.00
0.01
0.02
0.03
0.04
0.02

0.02
0.00
0.00
0.00
0.00
0.02
0.03
0.04
0.04

0.38
0.33
0.28
0.25
0.22
0.20
0.19
0.21
0.28

0.34
0.28
0.25
0.22
0.19
0.17
0.15
0.15
0.20

0.29
0.24
0.21
0.18
0.16
0.14
0.11
0.11
0.15

0.38
0.33
0.28
0.25
0.23
0.21
0.19
0.21
0.28

0.34
0.28
0.25
0.22
0.19
0.17
0.15
0.16
0.20

0.29
0.24
0.21
0.18
0.16
0.14
0.12
0.12
0.15

= 0.10
= 0.20
= 0.30
= 0.40
= 0.50
= 0.60
= 0.70
= 0.80
= 0.90

SD

RMSE

SD

RMSE

For convenience of assessing the performance of our estimator for homogeneous treatment effects and heterogeneous
treatment effects, we consider the following three outcome structures.
Structure 0: g(b, x, ϵ ) = 0.0b + 1.0x + 0.1x2 + ϵ
Structure 1: g(b, x, ϵ ) = 0.5b + 1.0x + 0.1x2 + ϵ
Structure 2: g(b, x, ϵ ) = Fε|X =x0 (ϵ )b + 1.0x + 0.1x2 + ϵ
where Fε|X =x0 denotes the conditional CDF of ε given X = x0 . Note that Structures 0 and 1 entail homogeneous treatment
effects, while Structure 2 entails heterogeneous treatment effects across quantiles τ as follows.
Structure 0: g1 (b, x, Qε|X =x0 (τ )) = 0.0
Structure 1: g1 (b, x, Qε|X =x0 (τ )) = 0.5
Structure 2: g1 (b, x, Qε|X =x0 (τ )) = τ
To allow for endogeneity, we generate the primitive data according to

(

xi

)

εi

i.i.d.

((

∼ N

0
0

) (
,

σX2
ρσX σε

ρσX σε
σε2

))

,

where σX = 1.0 and σε = ρ = 0.5. For estimation, we use the tricube kernel function K defined by
K (u) =

70 (
81

1 − |u|3

)3

1{|u| < 1}.

We set p = 2, and the bandwidths are selected with the choice rule based on the MSE minimization for local linear
estimator — see Appendix C.1 for details.
Fig. 1 shows simulated distributions of the QRKD estimates under Structure 1 (left) and Structure 2 (right). The top row,
the middle row, and the bottom row report results for the sample sizes of N = 1, 000, 2,000, and 4,000, respectively.
In each graph, the horizontal axis measures quantiles τ , while the vertical axis measures the QRKD. The true QRKD is
indicated by solid gray lines. Note that it is constant at 0.5 in the left column for Structure 1, while it is increasing in τ
in the right column for Structure 2. The other broken curves indicate the 5-th, 10-th, 50-th, 90-th, and 95-th percentiles
of the simulated distributions of the QRKD estimates based on Monte Carlo 2,500 iterations. Observe that the displayed
distribution shrinks for each structure at each quantile τ as the sample size N increases. The biases appear to be minor
relative to the variances, which is consistent with our employment of the bias corrected estimation approach.
In order to more quantitatively analyze the finite sample pattern, we summarize some basic statistics for the simulated
distributions in Table 1 for Structure 1 (top panel) and Structure 2 (bottom panel). In each panel, the three column groups
list the absolute biases (|Bias|), the standard deviations (SD), and the root mean squared errors (RMSE). For each structure
at each quantile τ , we again observe that SD and RMSE decrease as the sample size N increases. The biases are minor
relative to the variances. These patterns are of course consistent with our previous discussions in Fig. 1.

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

Fig. 1. Simulated distributions of QRKD estimates.

415

416

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

Fig. 2. Acceptance probabilities for the 95% level uniform test of significance (panel A) and the 95% level uniform test of heterogeneity (panel B)
based on 2,500 replications.

Finally, we present uniform inference results using the techniques introduced in Section 3.2. Fig. 2 shows acceptance
probabilities for the 95% level uniform test of significance (panel A) and the 95% level uniform test of heterogeneity
(panel B) based on 2,500 iterations. Panel A shows that the acceptance probability for the test of the null hypothesis of
insignificance converges to the nominal probability 95% for Structure 0, while the acceptance probability decreases toward
zero as the sample size increase for each of Structure 1 and Structure 2. These results are consistent with the construction
of Structure 0, Structure 1, and Structure 2. Structure 0 exhibits the uniform zero QRKD, while neither of Structure 1 nor
Structure 2 has the uniform zero QRKD. Panel B shows that the acceptance probability for the test of the null hypothesis of
homogeneity converges to the nominal probability 95% for Structure 0 and Structure 1, while the acceptance probability
decreases toward zero as the sample size increases for Structure 2. These results are again consistent with the construction
of Structure 0, Structure 1, and Structure 2. Each of Structure 0 and Structure 1 exhibits a constant QRKD across τ , while
Structure 2 has non-constant QRKD across τ .

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

417

Table 2
Empirical estimates and inference for the causal effects of UI benefits on unemployment durations based
on the RKD and QRKD. The period of data is from September 1981 to September 1982. The numbers in
parentheses indicate standard errors.
September 1981–September 1982
Dependent Variable

UI Claimed

RKD (Landais, 2015)

0.038

(0.009)

0.040

(0.009)

0.000
0.037
0.053
0.070
0.081
0.093
0.086
0.154
0.145

(0.010)
(0.011)
(0.012)
(0.013)
(0.014)
(0.015)
(0.015)
(0.024)
(0.017)

0.022
0.036
0.060
0.070
0.080
0.089
0.068
0.142
0.159

(0.008)
(0.011)
(0.011)
(0.012)
(0.013)
(0.016)
(0.012)
(0.022)
(0.016)

QRKD

τ
τ
τ
τ
τ
τ
τ
τ
τ

= 0.10
= 0.20
= 0.30
= 0.40
= 0.50
= 0.60
= 0.70
= 0.80
= 0.90

Test of Significance
Standardized Test of Significance
Test of Heterogeneity
Standardized Test of Heterogeneity

p-Value
p-Value
p-Value
p-Value

0.000
0.000
0.000
0.000

UI Paid

0.000
0.000
0.000
0.000

5. An empirical illustration
In labor economics, causal effects of the unemployment insurance (UI) benefits on the duration of unemployment are
of interest from policy perspectives. Landais (2015) proposes an empirical strategy using the RKD to identify the causal
effects of UI on the duration. Using the data set of the Continuous Wage and Benefit History Project (CWBH — see Moffitt,
1985), Landais estimates the effects of benefit amounts on the duration of unemployment. In this section, we apply our
QRKD methods, and aim to discover potential heterogeneity in these causal effects. Using quantiles in this application
also has an advantage of informing a likely direction of the selection bias of the mean RKD estimator that stems from not
observing the mass of employed individuals at the low quantile (y = 0).
In all of the states in the United States, a compensated unemployed individual receives a weekly benefit amount b that
is determined as a fraction τ1 of his or her highest earning quarter x in the base period (the last four completed calendar
quarters immediately preceding the start of the claim) up to a fixed maximum amount bmax , i.e. b = min{τ1 · x, bmax }.
The both parameters, τ1 and bmax , of the policy rule vary from state to state. Furthermore, the ceiling level bmax changes
over time within a state. For these reasons, empirical analysis needs to be conducted for each state for each restricted
time period. The potential duration of benefits is determined in a somewhat more complicated manner. Yet, it also can
be written as a piecewise linear and kinked function of a fraction of a running variable x in the CWBH data set.
Following Landais (2015), we make our QRKD empirical illustration by using the CWBH data for Louisiana. The data
cleaning procedure is conducted in the same manner as in Landais. As a result of the data processing, we obtain the same
descriptive statistics (up to deflation) as those in Landais for those variables that we use in our analysis. For the dependent
variable y, we consider both the claimed number of weeks of UI and the actually paid number of weeks. For the running
variable x, we use the highest quarter wage in the based period. The treatment intensity b is computed by using the
formula b(x) = min{(1/25) · x, bmax }, with a kink where the maximum amount is bmax = $4,575 for the period between
September 1981 and September 1982 and bmax = $5,125 for the period between September 1982 and December 1983.
Table 2 summarizes empirical results for the time period between September 1981 and September 1982. Table 3
summarizes empirical results for the time period between September 1982 and December 1983. In each table, we display
the RKD results by Landais (2015) for a reference. In the following rows, the QRKD estimates are reported with respective
standard errors in parentheses for quantiles τ ∈ {0.10, . . . , 0.90}. At the bottom of each table, we report the p-values for
the test of significance and the test of heterogeneity.
Observe the following patterns in these result tables. First, the estimated causal effects have positive signs throughout
all the quantiles but for one (τ = 0.10 in Table 2), implying that higher benefit amounts cause longer unemployment
durations consistently across the outcome levels. Second, these causal effects are smaller at lower quantiles (e.g., τ =
0.10), while they are larger at middle and higher quantiles. This pattern implies that unemployed individuals who have
longer unemployment durations tend to have larger unemployment elasticities with respect to benefit levels. The extent
of this increase of the causal effects in quantiles is more prominent for the results in Table 2 (1981–1982) than in Table 3
(1982–1983).5 This result implies that the causal effects are heterogeneous. Third, the causal effects are very similar
between the results for claimed UI as the outcome and the results for paid UI as the outcome variable. The respective
standard errors are almost the same between these two outcome variables, but they are not exactly the same. Fourth,
the uniform tests show that the causal effects are significantly different from zero for the both time periods. Lastly, the
5 We remark that the qualitative differences in the results that we find between the non-recession period (1981–1982) and the recession period
(1982–1983) can be perhaps useful for telling apart the two potential routes of the causal effects, namely the moral hazard and liquidity effects.

418

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433
Table 3
Empirical estimates and inference for the causal effects of UI benefits on unemployment durations based
on the RKD and QRKD. The period of data is from September 1982 to December 1983. The numbers in
parentheses indicate standard errors.
September 1982–December 1983
Dependent Variable

UI Claimed

RKD (Landais, 2015)
QRKD

τ
τ
τ
τ
τ
τ
τ
τ
τ

= 0.10
= 0.20
= 0.30
= 0.40
= 0.50
= 0.60
= 0.70
= 0.80
= 0.90

Test of Significance
Standardized Test of Significance
Test of Heterogeneity
Standardized Test of Heterogeneity

p-Value
p-Value
p-Value
p-Value

UI Paid

0.046

(0.006)

0.042

(0.006)

0.030
0.067
0.083
0.091
0.112
0.072
0.094
0.026
0.065

(0.014)
(0.019)
(0.019)
(0.021)
(0.016)
(0.021)
(0.016)
(0.014)
(0.034)

0.029
0.066
0.082
0.085
0.118
0.075
0.100
0.032
0.068

(0.014)
(0.019)
(0.021)
(0.023)
(0.017)
(0.020)
(0.020)
(0.015)
(0.037)

0.002
0.000
0.140
0.000

0.005
0.000
0.142
0.000

uniform tests show that the causal effects are also significantly heterogeneous for the both time periods. Indeed, the
heterogeneity is insignificant in Table 3 (1982–1983) according to the non-standardized test statistics, but it is significant
according to the standardized ones.
6. Summary
Economists have taken advantage of policy irregularities to assess causal effects of endogenous treatment intensities. A
new approach along this line is the regression kink design (RKD) used by recent empirical papers, including Nielsen et al.
(2010), Landais (2015), Simonsen et al. (2016), Card et al. (2016), and Dong (2016). While the prototypical framework is
only able to assess the average treatment effect at the kink point, inference for heterogeneous treatment effects using the
RKD is of potential interest by empirical researchers (e.g., Landais (2011) considers it). In this light, this paper develops
causal analysis and methods of inference for the quantile regression kink design (QRKD).
We first develop causal interpretations of the QRKD estimand. It is shown that the QRKD estimand measures the
marginal effect of the treatment variable on the outcome variable at the conditional quantile of the outcome given the
design point of the running variable provided that the causal structure exhibits rank invariance. This result is generalized
to the case of no rank invariance, where the QRKD estimand is shown to measure a weighted average of the marginal
effects of the treatment variable on the outcome variable at the conditional quantile of the outcome given the design
point of the running variable. Second, we propose a sample counterpart QRKD estimator, and develop its asymptotic
properties for statistical inference of heterogeneous treatment effects. Under some extra assumptions, a variation of
the QRKD estimand that accounts for covariates is also provided. We obtain weak convergence results for the QRKD
estimators. Applying the weak convergence results, we propose procedures for statistical tests of treatment significance
and treatment heterogeneity. Simulation studies support our theoretical results. Applying our methods to the Continuous
Wage and Benefit History Project (CWBH) data, we find significantly heterogeneous causal effects of unemployment
insurance benefits on unemployment durations in the state of Louisiana for the period between September 1981 and
December 1983.
Appendix A. Proof of Theorem 1
Proof. For the first part of the proof, we branch into two cases: (i) M = 1 and (ii) M > 1.
−1
(i) For M = 1: That µM
is a probability measure on ∂ V (y, x) follows from (2.3) under Assumption 4. By Leibniz
y,x
integral rule and the implicit function theorem under Assumption 2, 3(i) and 4, the QPD ∂∂x Q (τ | x) exists and

∂
Q (τ | x) =
∂x

hx (x,ϵ )
ϵ∈∂ V (y,x) |hϵ (x,ϵ )| fε|X (ϵ

∑

∑

| x) −

where A is defined by
A(y, x) := ∑

∂

f (
V (y,x) ∂ x ε|X

ϵ | x)dϵ

1
ϵ∈∂ V (y,x) |hϵ (x,ϵ )| fε|X (

ϵ | x)

∂

f (
V (y,x) ∂ x ε|X

1
ϵ∈∂ V (y,x) |hϵ (x,ϵ )| fε|X (

= Eµ0y,x [hx (x, ε)] − A(y, x),

∫

∫

ϵ | x)

ϵ | x)dϵ

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

419

−1
(ii) For M > 1: That µM
y,x is a probability measure on ∂ V (y, x) follows from Lemma 2 of Sasaki (2015) under Assumption 4.
Next, by Lemma 1 of Sasaki (2015) under Assumption 2, 3 (ii) and 4, the QPD ∂∂x Q (τ | x) exists and

∂
Q (τ | x) =
∂x

(M −1)/2
hx (x,ϵ ) fε|X (ϵ|x)·M π
dH M −1 (ϵ )
∂ V (y,x) ∥∇ϵ h(x,ϵ )∥
2M −1 Γ ( M 2+1 )

∫

1

∫

∂ V (y,x) ∥∇ϵ h(x,ϵ )∥

−

∂

∫

f (
V (y,x) ∂ x ε|X

fε|X (ϵ|x)·M π (M −1)/2
dH M −1 (
2M −1 Γ ( M +1 )

ϵ | x)dmM (ϵ )

ϵ)

2

= EµM −1 [hx (x, ε)] − A(y, x),
y,x

where Γ is the Gamma function and A is defined by
∂

∫
A(y, x) := ∫

f (
V (y,x) ∂ x ε|X
1

∂ V (y,x) ∥∇ϵ h(x,ϵ )∥

ϵ | x)dmM (ϵ )

fε|X (ϵ|x)·M π (M −1)/2
dH M −1 (
2M −1 Γ ( M +1 )

ϵ)

2

∂g

From this point on, we treat both cases (i) M = 1 and (ii) M > 1 together. Note that g2 = ∂ x is continuous in x by
−1
Assumption 2(i). Also, µM
y,x (ϵ ) is continuous in x for each fixed y according to parts (i), (ii) and (iii) of Assumption 2.
Furthermore, Assumption 2(i), (ii), (iii) and (iv) imply that A(y, x) is well-defined and is continuous in x for all y ∈ Y .
Therefore, applying the dominated convergence theorem under Assumption 2 (iv), 4 and 5 yields
lim

x→x+
0

∂
Q (τ | x) = lim
∂x
x→x+
∫ 0
=

∫
∂ V (y,x)

−1
{hx (x, ϵ )}dµM
y,x (ϵ ) − lim A(y, x)

lim

+

∂ V (y,x0 ) x→x0

∫

x→x+
0

∂
−1
{g(b(x), x, ϵ )}dµM
y,x0 (ϵ ) − A(y, x0 )
∂x

−1
lim {g1 (b(x), x, ϵ )b′ (x) + g2 (b(x), x, ϵ )}dµM
y,x0 (ϵ ) − A(y, x0 )

=

+
∂ V (y,x0 ) x→x0

∫
=

M −1
{g1 (b(x0 ), x0 , ϵ )b′ (x+
0 ) + g2 (b(x0 ), x0 , ϵ )}dµy,x0 (ϵ ) − A(y, x0 )

Similarly, taking the limit from the left, we have

∂
lim
Q (τ | x) =
− ∂x
x→x0

∫
∂ V (y,x0 )

M −1
{g1 (b(x0 ), x0 , ϵ )b′ (x−
0 ) + g2 (b(x0 ), x0 , ϵ )}dµy,x0 (ϵ ) − A(y, x0 ).

Taking the difference of the right and left limits eliminates
lim

+

x→x0

−1
g (b(x0 ), x0 , ϵ )dµM
y,x0 (ϵ )
∂ V (y,x0 ) 2

∫

− A(y, x0 ), and thus produces

∂
∂
′ −
Q (τ | x) − lim
Q (τ | x) = [b′ (x+
−1 [g1 (b(x0 ), x0 , ε )] .
0 ) − b (x0 )]EµM
y,x0
− ∂x
∂x
x→x0

′ −
Finally, note that Assumption 1 has b′ (x+
0 ) − b (x0 ) ̸ = 0, and hence we can divide both sides of the above equality by
′ +
′ −
b (x0 ) − b (x0 ). This gives the desired result. □

Appendix B. Appendix for the large sample results

In this appendix, we abbreviate QY |X as Q for conservation of the space. In addition to those notations introduced in
the main text, we define the linear extrapolation error and the estimation errors follows.

[

ei (τ ) = Q (τ |x0 ) +

p
∑
(xi − x0 )v ( ∂ v Q (τ |x+ )
0

v=1

v!

∂ xv

d+
i +

)]
∂ v Q (τ |x−
0) −
di
− Q (τ |xi ),
v
∂x

−
−
ui (τ ) = yi − α (τ ) − β1+ (τ )d+
i (xi − x0 ) − β1 (τ )di (xi − x0 ) −

p
∑
(xi − x0 )v

v=2

u0i (τ ) = yi − Q (τ |xi ).

v!

−
−
[βv+ (τ )d+
i − βv (τ )di ],

420

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

Furthermore, we define the vector of centered and rescaled candidate parameter values as

⎤
(α (τ ) − Q (τ |x0 ) + )
∂
Q
(
τ
|
x
)
+
⎥
⎢ h
0
n,τ β1 (τ ) −
⎥
⎢
∂x
(
⎥
⎢
− )
∂ Q ( τ |x0 )
⎥
⎢ h
−
n,τ β1 (τ ) −
⎥
⎢
∂x
√
⎥
⎢
φn (τ ) = nhn,τ ⎢
⎥ ∈ R1+2p .
..
⎥
⎢
.
⎢
)⎥
(
⎢ p
∂ p Q ( τ |x+
) ⎥
+
0
⎥
⎢(hn,τ /p!) βp (τ ) − ∂ xp
⎦
⎣
(
p Q ( τ |x− ) )
∂
p
0
(hn,τ /p!) βp− (τ ) −
p
∂x
⎡

Although it is not a direct object of interest, the level estimator is denoted by

α̂ (τ ) = ι′1

p
n
(x − x ) (
v)
∑
∑
i
0
− − (xi − x0 )
ρτ yi − α −
,
(βv+ d+
K
i + βv d i )
hn,τ
v!
(α,β + ,β − ,...,βp+ ,βp− )∈R1+2p

argmin

1

v=1

i=1

1

where ι1 = [1, 0, . . . , 0] ∈ R
′

xi −x0 p −
. . . , ( xhi −n,τx0 )p d+
i , ( hn,τ ) di

]′

2p+1

, du = 1{u > 0}, du = 1{u < 0}, Ki,n,τ = K (
+

−

xi −x0
)
hn,τ

[

and zi,n,τ = 1, (

xi − x0
)d+
i
hn,τ

, ( xhi −n,τx0 )d−
i ,

∈ R1+2p . With the similarly defined derivative estimators, β̂1+ (τ ), β̂2− (τ ), . . . , β̂p+ (τ ), β̂p− (τ ),

we now define

⎤
(α̂ (τ ) − Q (τ |x0 ) + )
∂ Q ( τ |x0 )
+
⎢ h
⎥
n,τ β̂1 (τ ) −
⎢
⎥
∂x
(
)
⎢
⎥
)
∂ Q ( τ |x−
⎢ h
⎥
−
0
β̂
(
τ
)
−
n
,τ
⎢
⎥
1
∂x
√
⎢
⎥
φ̂n (τ ) = nhn,τ ⎢
⎥.
..
⎢
⎥
.
⎢
⎥
)
(
p Q ( τ |x+ ) ⎥
⎢ p
∂
⎢(hn,τ /p!) β̂p+ (τ ) − ∂ xp 0 ⎥
⎣
(
)⎦
)
∂ p Q ( τ |x−
p
0
(hn,τ /p!) β̂p− (τ ) −
∂ xp
⎡

Furthermore, the following notations will be used in the subsequent proofs.
Vn,τ (φn (τ )) =

n
∑

ρτ (u0i (τ ) − ei (τ ) − (nhn,τ )−1/2 zi′,n,τ φn (τ ))Ki,n,τ −

i=1

n
∑

ρτ (u0i (τ ) − ei (τ ))Ki,n,τ ,

i=1

n
∑
Sn (τ , φn (τ ), ei (τ )) = (nhn )−1/2
{P((u0i (τ ) ≤ ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φn (τ ))|xi )
i=1

− 1(u0i (τ ) ≤ ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φn (τ ))}zi,n,τ Ki,n,τ .
B.1. Uniform bahadur representation
The following lemma states the uniform Bahadur representation from Qu and Yoon (2015a, Theorem 1) adapted to
our framework.
Lemma 1.

Under Assumption 6, we have

⎡
√

nh3n,τ ⎣

⎡

β̂1+ (τ ) −
β̂1− (τ ) −
ι′2 N −1

∑n

√ i=1

∂ Q ( τ |x+
)
0
∂x
∂ Q ( τ |x−
)
0
∂x

− hpn,τ

∫ ( ∂ p+1 Q (τ |x+0 )

−

∫ ( ∂ p+1 Q (τ |x+0 )

ι′2 (N)−1
(p+1)!
′
−1
p ι3 (N)
hn,τ (p+1)!

zi,n,τ Ki,n,τ (τ −1{yi ≤Q (τ |xi )})

R
R

+ op (1)

∂ xp+1

d+
u +

∂ xp+1

d+
u +

∂ p+1 Q (τ |x−
) −
0
du up+1 ūK (u)du
∂ xp+1
⎦
)
−
p
+
1
∂
Q ( τ |x0 ) −
p+1
d
u
ūK
(u)du
u
∂ xp+1

)

⎤

⎤

nh f (x )f
(Q (τ |x )|x )
⎢
⎥
= ⎣ ι′ N −1 ∑n n,τz X 0K Y |X(τ −1{y0 ≤Q0(τ |x )})
⎦
i
i
3
√ i=1 i,n,τ i,n,τ
+ op (1)
nhn,τ fX (x0 )fY |X (Q (τ |x0 )|x0 )

uniformly in τ ∈ T .
For this lemma, we mostly follow the proof of Theorem 1 in Qu and Yoon (2015a). The major difference is that we
define our zi,n,τ , φn (τ ), u0i (τ ), ui (τ ) and ei (τ ) slightly differently in order to incorporate the constraint Q (τ |x−
0 ) = Q (τ |x0 ) =
Q (τ |x+
0 ).

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

421

Proof. We prove the lemma in three steps.
Step 1. Let Kn = log1/2 (nhn ), Φn = {(τ , φn (τ )) : τ ∈ T , ∥φn (τ )∥ ≤ log1/2 (nhn )}. In this step, we show that φ̂n (τ ) ∈ Φn with
probability 1 − o(1). Since Vn,τ (0) = 0, Vn,τ (φ̂n (τ )) ≤ 0 always holds for τ ∈ T and any n. We now claim that for each
ϵ > 0, there exist some finite constants N0 and η > 0 independent of quantile such that if ∥φn (τ )∥ ≥ Kn for some τ , then

(

P Vn,τ (φn (τ )) > ηKn2

)

>1−ϵ

holds for n ≥ N0 . It then suffices to show
P

(

inf Vn,τ (φn ) > ηKn2

inf

)

>1−ϵ

∥φn ∥≥Kn τ ∈T

for all n ≥ N0 . By convexity of Vn,τ (·), it holds that Vn,τ (γ φn ) − Vn,τ (0) ≥ γ (Vn,τ (φn ) − Vn,τ (0)) for any γ > 1. Thus, it
suffices to show for all n ≥ N0
P

(

inf Vn,τ (φn ) > ηKn2

inf

)

> 1 − ϵ.

∥φn ∥=Kn τ ∈T

Using Knight’s (1998) decomposition, we write Vn,τ = Wn,τ + Zn,τ with the summands defined by
Wn,τ (φn ) = −(nhn,τ )−1/2

n
∑

Ki,n,τ ψτ (u0i (τ ) − ei (τ ))zi′,n,τ φn

and

i=1

Zn,τ (φn ) =

n
∑

(nhn,τ )−1/2 zi′,n,τ φn

∫
Ki,n,τ

{1(u0i (τ ) − ei (τ ) ≤ s) − 1(u0i (τ ) − ei (τ ) ≤ 0)}ds,

0

i=1

where ψτ (u) = τ − 1(u < 0). Therefore, we obtain
inf Kn−2 Vn,τ (φn ) ≥

inf

∥φn ∥=Kn τ ∈T

inf

inf Kn−2 Zn,τ (φn ) − sup sup|Kn−2 Wn,τ (φn )|= (I) − (II).

∥φn ∥=Kn τ ∈T

∥φn ∥=Kn τ ∈T

First, (II) is bounded as
(II) ≤Kn−1 sup ∥(nhn,τ )−1/2
τ ∈T

n
∑

{ψτ (u0i (τ ) − ei (τ )) − ψτ (u0i (τ ))}zi′,n,τ Ki,n,τ ∥

i=1

+Kn−1 sup ∥(nhn,τ )−1/2
τ ∈T

n
∑

ψτ (u0i (τ ))zi′,n,τ Ki,n,τ ∥

i=1

Lemma 8 implies the first term is Op (Kn−1 ) = op (1). An application of the Lindeberg–Feller CLT for each fixed τ combined
with stochastic equicontinuity from Lemma 5 shows that the second term is Op (Kn−1 ) = op (1).
Next, we show that (I) is strictly positive with probability 1 − o(1). First note that Zn,τ (φn ) is nonnegative and satisfies
(nhn,τ )−1/2 zi′,n,τ φn

∫

{1(u0i (τ ) − ei (τ ) ≤ s) − 1(u0i (τ ) − ei (τ ) ≤ 0)}ds

0

(
)}
zi′,n,τ φn { ( 0
zi′,n,τ φn )
1 ui (τ ) − ei (τ ) ≤ (nhn,τ )−1/2
− 1 u0i (τ ) − ei (τ ) ≤ 0
2
2
following the same argument as in Lemma A.1 of Oka and Qu (2011).
Applying the inequality to Zn,τ yields
≥(nhn,τ )−1/2

√
Kn Zn,τ (φn ) ≥Kn
−2

−2

nhn φn′
nhn,τ 2

+Kn−2 (nhn,τ )−1/2

{Sn (τ , 0, ei (τ )) − Sn (τ , φn /2, ei (τ ))}
n
φn′ ∑{ (

2

P u0i (τ ) − ei (τ ) ≤ (nhn,τ )−1/2

i=1
⏐ )}
⏐
− P u0i (τ ) − ei (τ ) ≤ 0⏐xi zi,n,τ Ki,n,τ = (III) + (IV )

zi′,n,τ φn ⏐⏐ )
⏐ xi
2

(

Note that (III) = Op (Kn−1 ) = op (1) because of Lemma 7, ∥φn ∥ = Kn and
(IV ) =

1
4

nhn,τ
nh

= O(1). The mean value theorem implies

n

Kn−2 (nhn,τ )−1

∑

fY |X (ỹi |xi )Ki,n,τ φn′ zi,n,τ zi′,n,τ φn ,

i=1

for some ỹi lying between Q (τ |xi ) + ei (τ ) and Q (τ |xi ) + ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φn /2. Note that xi is vanishing in a
neighborhood of xi . Furthermore, ỹi → Q (τ |xi ) as n → ∞. Assumption 6 (ii)(b) suggests fY |X (ỹi |xi ) ≥ fL asymptotically.

422

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

Therefore,
(IV ) ≥

1
4

(

Kn−2 fL φn′ (nhn,τ )−1

n
∑

)

Ki,n,τ zi,n,τ zi′,n,τ φn

i=1

uniformly on T for n large enough. By Assumption 6(iv), we have (IV ) ≥ 81 fL λmin (τ ) with probability 1 − o(1) on T , where
λmin (τ ) > 0 is the minimum eigenvalue of fX (x0 )N. Thus we have shown that (I) is strictly positive uniformly in τ with
probability going to one.
Step 2. We now focus on the behavior of the subgradient
(subgradient) =

n
∑
{τ − 1(u0i (τ ) ≤ ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φˆn (τ ))}zi,n,τ Ki,n,τ
i=1

on the set Φn .
Theorem 2.1 of Koenker (2005) and Assumption 6 (iv) imply (nhn )−1/2 · (subgradient) = Op ((nhn )−1/2 ) uniformly in
τ ∈ T.
Following Qu and Yoon (2015a), we can rewrite the subgradient (scaled by (nhn )−1/2 ) as
(nhn )−1/2

n
∑
{τ − 1(u0i (τ ) ≤ ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φˆn (τ ))}zi,n,τ Ki,n,τ
i=1

={Sn (τ , φˆn (τ ), ei (τ )) − Sn (τ , 0, ei (τ ))} + {Sn (τ , 0, ei (τ )) − Sn (τ , 0, 0)} + Sn (τ , 0, 0)
n
∑
+(nhn )−1/2
{τ − P(u0i (τ ) ≤ ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φˆn (τ )|xi )}zi,n,τ Ki,n,τ
i=1

The differences inside the first two pairs of curly brackets are of order op (1) on the set Φn by Lemma 7. The conditional
probability in the last term is a conditional CDF of Y |X . Applying the first order mean value expansion to the last term at
y = Q (τ |xi ) yields
(nhn )−1/2

n
∑
{τ − P(u0i (τ ) ≤ ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φˆn (τ )|xi )}zi,n,τ Ki,n,τ
i=1

= − (nhn )−1/2

n
∑

fY |X (ỹni |xi )ei (τ )zi,n,τ Ki,n,τ

i=1

− (nhn )−1/2 (nhn,τ )−1/2

n
(∑

ˆn (τ ),
fY |X (ỹni |xi )Ki,n,τ zi,n,τ zi′,n,τ φ
)

i=1

ˆn (τ ).
where ỹni lies between Q (τ |xi ) and Q (τ |xi ) + ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φ
Taking the above auxiliary results together, we can now rewrite the subgradient (scaled by (nhn )−1/2 ) as
Sn (τ , 0, 0) − (nhn )−1/2

− (nhn )−1/2 (nhn,τ )

n
∑

fY |X (ỹni |xi )ei (τ )zi,n,τ Ki,n,τ

i=1
n
−1/2

(∑

ˆn (τ ).
fY |X (ỹni |xi )Ki,n,τ zi,n,τ zi′,n,τ φ
)

i=1

Recall that this subgradient (scaled by (nhn )−1/2 ) is op (1) uniformly in τ ∈ T . Note that, since (nhn,τ )−1
zi,n,τ zi′,n,τ

P

∑n

i=1 fY |X (ỹni

|xi )Ki,n,τ

−
→ fY |X (Q (τ |x0 )|x0 )fX (x0 )N uniformly in τ ∈ T , we have

Sn (τ , 0, 0) − (nhn )−1/2

n
∑

fY |X (ỹni |xi )ei (τ )zi,n,τ Ki,n,τ

i=1

=(

hn,τ
hn

ˆn (τ ) + op (1)
)1/2 fY |X (Q (τ |x0 )|x0 )fX (x0 )N + op (1) φ
[

]

uniformly in τ ∈ T . Since N is positive definite and fY |X (Q (τ |x0 )|x0 )fX (x0 ) > 0 by Assumption 6(i)(a),(ii)(b), we obtain

(
)−1
φˆn (τ ) = fX (x0 )fY |X (Q (τ |x0 )|x0 )N + op (1)
×
[(
)1/2
]
n
∑
hn
Sn (τ , 0, 0) − (nhn,τ )−1/2 fY |X (Q (τ |x0 )|x0 )
ei (τ )zi,n,τ Ki,n,τ + op (1)
hn,τ

uniformly in τ ∈ T .

i=1

(B.1)

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

423

Step 3. We finally obtain the uniform Bahadur representation. Under Assumption 6(iii)(b),(iv) for any xi such that
(xi − x0 )/hn,τ ∈ supp(K ), we have
e i (τ ) = −

( x − x )p+1 ( ∂ p+1 Q (τ |x+ )
)
∂ p+1 Q (τ |x−
i
0
0
0) −
p+1
1
d+
di hpn+
,τ + o(hn,τ )
i +
p
+
1
p
+
1
(p + 1)!
hn,τ
∂x
∂x
1

uniformly in τ ∈ T . Also note that we have

√
+3
− nh2p
n,τ

n
∑

1
p+1

nhn,τ

√

P

2p+3

ei (τ )zi,n,τ Ki,n,τ d+
−
→ − nhn,τ
i

i=1

∫ ( p+1
)
∂ p+1 Q (τ |x−
∂ Q (τ | x +
0) −
0) +
+
up+1 ūK (u)du
d
d
u
u
(p + 1)! R
∂ xp+1
∂ xp+1
fX (x0 )

uniformly in τ ∈ T . Applying this convergence result and substituting Sn (τ , 0, 0) into Eq. (B.1), we have
1

φˆn (τ ) =

N −1 (nhn,τ )− 2

∑n

i=1 (

τ − 1{yi ≤ Q (τ |xi )})zi,n,τ Ki,n,τ

fX (x0 )fY |X (Q (τ |x0 )|x0 )




√

∫ (
∂

N −1

2p+3

nhn,τ

+



Stochastic Term
p+1

(p + 1)!

R

Q (τ |x+
0)

∂

xp+1



d+
i +



Bias Term

)
∂ p+1 Q (τ |x−
0) −
di up+1 ūK (u)du +op (1)
p
+
1
∂x


uniformly in τ ∈ T . The first term on RHS is the pivotal part (stochastic term) and the second is the bias term.
Premultiplying both sides by [ι2 , ι3 ]′ then gives the desired result. □
B.2. Proof of Theorem 2
Proof. Lemmas 1 and 6 (iii) (b), (v) imply Zn = Xn + op (1) uniformly in (τ , j), where
Xn (τ , j) =

n
∑

Wni (τ , j) where Wni (τ , j) =

i=1

ι′j N −1 zi,n,τ Ki,n,τ (τ − 1{yi ≤ Q (τ |xi )})
√
nhn,τ fX (x0 )fY |X (Q (τ |x0 )|x0 )

Therefore, in light of Theorem 18.10 (iv), Theorem 18.14, and Lemma 18.15 of van der Vaart (1998), it suffices to show
that the leading term in the uniform Bahadur representation Xn (τ , j) is asymptotically tight and has finite dimensional
convergence in distribution to the Gaussian distribution with the proposed covariance function.
The finite dimensional convergence follows from the multivariate version of Lindeberg–Feller CLT van der Vaart (1998,
Proposition 2.27). For each m ∈ N, fix any T ′ = (τ1 , . . . , τm ), τk ∈ T and any J ′ = (j1 , . . . , jm ), jk ∈ {2, 3} for all
k ∈ {1, . . . , m}, then denote Yni = Yni (T ′ , J ′ ) = [Wni (τ1 , j1 ), . . . , Wni (τK , jm )]′ , an m-dimensional random vector. We will
verify that
1.

∑n

E [∥Yni ∥2 1{∥Yni ∥ > ϵ}] → 0 for all ϵ > 0;

2.

∑n

Cov (Yni ) → Σ .

i=1
i=1

and

∑n

Then the multivariate Lindeberg–Feller CLT implies i=1 (Yni − EYni ) converges in distribution to N(0, Σ ). Also, by the law
of iterated expectations, E [Wni (τ , j)] = 0 for all (τ , j), and thus EYni = 0. For calculation of the covariance, pick any τ1 ,
τ2 ∈ T ′ and j1 , j2 ∈ J ′ . Under Assumption 6(i)(ii)(iv)(v), the law of iterated expectations implies that
E Xn (τ1 , j1 )Xn (τ2 , j2 )

=E

n
∑
ι′j1 N −1 zi,n,τ1 zi′,n,τ2 N −1 ιj2 Ki,n,τ1 Ki,n,τ2 (τ1 − 1{yi ≤ Q (τ1 |xi )})(τ2 − 1{yi ≤ Q (τ2 |xi )})
√
nhn c(τ1 )c(τ2 )fX2 (x0 )fY |X (Q (τ1 |x0 )|x0 )fY |X (Q (τ2 |x0 )|x0 )
i=1

=E

n
∑
ι′j1 N −1 zi,n,τ1 zi′,n,τ2 N −1 ιj2 Ki,n,τ1 Ki,n,τ2 E [(τ1 − 1{yi ≤ Q (τ1 |xi )})(τ2 − 1{yi ≤ Q (τ2 |xi )})|xi ]
√
nhn c(τ1 )c(τ2 )fX2 (x0 )fY |X (Q (τ1 |x0 )|x0 )fY |X (Q (τ2 |x0 )|x0 )
i=1

ι′j1 N −1 zi,n,τ1 zi′,n,τ2 N −1 ιj2 Ki,n,τ1 Ki,n,τ2 (τ1 ∧ τ2 − τ1 τ2 )
√
hn c(τ1 )c(τ2 )fX2 (x0 )fY |X (Q (τ1 |x0 )|x0 )fY |X (Q (τ2 |x0 )|x0 )
ι′j N −1 T (τ1 , τ2 )N −1 ιj2 (τ1 ∧ τ2 − τ1 τ2 )
= 1
+ O(hn ) = O(1).
fX (x0 )fY |X (Q (τ1 |x0 )|x0 )fY |X (Q (τ2 |x0 )|x0 )
∑n
′
Therefore,
i=1 E [Yni Yni ] → Σ . It now remains to verify the Lindeberg–Feller condition, i.e. for any ϵ > 0,
=E

lim

m
n
[∑
∑

E

n→∞
i=1

k=1

m
{∑

Wni2 (τk , jk ) 1

k=1

Wni2 (τk , jk ) > ϵ 2

}]

=0

424

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

Note for any ϵ > 0, RHS can be bounded by a Lyapunov type condition
n
m
[∑
∑

E

i=1

m
{∑

Wni2 (τk , jk ) 1

Wni2 (τk , jk ) > ϵ 2

}]

k=1

k=1

m
m
n
⏐3/2 {∑
}]
∑
1 [⏐⏐ ∑ 2
⏐
≤
E ⏐
Wni (τk , jk )⏐
1
Wni2 (τk , jk ) > ϵ 2
ϵ
i=1
k=1
k=1
n
m
⏐3/2 ]
∑ 1 [⏐⏐ ∑
⏐
≤
E ⏐
Wni2 (τk , jk )⏐
ϵ
i=1

(B.2)

k=1

Since, under Assumption 6(i) (a), and (ii) (b), all entries of N are finite, K has bounded support and |τ − 1(yi ≤ Q (τ |xi ))|≤ 1
and the densities are bounded away from zero, we have for all τ and j, there exist finite constants cj,l (independent of n
and τ ) and C ′ (independent of n, τ and j) such that

) (
)
⏐
⏐(
x −x
x −x
⏐ cj,1 + cj,2 ( xhi −x0 )d+
+
·
·
·
+
cj,2p+1 ( hi 0 )p d−
K hi 0 (τ − 1{yi ≤ Q (τ |xi )}) ⏐
i
i
n,τ
n,τ
n,τ
⏐
⏐
√
|Wni (τ , j)|=⏐
⏐
⏐
⏐
nhn,τ fX (x0 )fY |X (Q (τ |x0 )|x0 )
(
)
′
xi − x0
C
K
.
≤√
chn

nhn

′′

Thus for C = (m)

3/2

′ 2

(C ) , we have

m

[⏐ ∑
⏐

E ⏐

m ( ′ −1
[⏐ ∑
ιj N zi,n,τ Ki,n,τ (τ − 1{yi ≤ Q (τ |xi )}) )2 ⏐⏐3/2 ]
⏐
√
=E ⏐
⏐
nhn,τ fX (x0 )fY |X (Q (τ |x0 )|x0 )
k=1
∫
(x − x )
C ′′
i
0
≤
K3
fX (xi )dxi
3
/
2
(nhn )
chn
∫
C ′′ hn
≤
K 3 (u/c)(fX (x0 ) − uhn M)du
(nhn )3/2
( 1 )
,
=O
1/2

⏐3/2 ]
⏐

Wni2 (τk , jk )⏐

k=1

n3/2 hn

where M is a finite constant coming from the local Lipschitzness of fX at x0 implied by the continuous differentiability at
x0 and the fact that K has a bounded support from Assumption 6(i)(iv). Under Assumption 6(i)(b),(v), by this intermediate
result and identical distribution of data for each sample size n, Eq. (B.2) yields
n
m
[∑
∑

E

i=1

m
{∑

Wni2 (τk , jk ) 1

k=1

k=1

Wni2 (τk , jk ) > ϵ 2

}]

( 1 )
=O √
= o(1).
ϵ nhn
∑n

This establishes the finite dimensional asymptotic normality that
i=1 Yni converges in distribution to N(0, Σ ).
The tightness follows because the denominator is bounded away from zero by Assumption 6(i), (ii), and because the
numerator is tight by Lemma 5. □
B.3. Proof of Corollary 2
The result follows from an application of the delta method under Assumption 1. That the limiting distribution in
G(τ ,2)−G(τ ,3)
Theorem 2 is zero-mean Gaussian implies that the limiting distribution ′ + ′ − is also zero-mean Gaussian. The
b (x0 )−b (x0 )

covariance is obtained by
E

=
=

[( G(τ , 2) − G(τ , 3) )( G(τ , 2) − G(τ , 3) )]
1
1
2
2
′ −
′ −
b′ (x+
b′ (x+
0 ) − b (x0 )
0 ) − b (x0 )
1

′ − 2
(b′ (x+
0 ) − b (x0 ))
(τ1 ∧ τ2 − τ1 τ2 )
′ − 2
(b′ (x+
0 ) − b (x0 ))

E [G(τ1 , 2)G(τ2 , 2) + G(τ1 , 3)G(τ2 , 3) − G(τ1 , 2)G(τ2 , 3) − G(τ1 , 3)G(τ2 , 2)]

×

ι′2 N −1 T (τ1 , τ2 )N −1 ι2 + ι′3 N −1 T (τ1 , τ2 )N −1 ι3 − ι′2 N −1 T (τ1 , τ2 )N −1 ι3 − ι′3 N −1 T (τ1 , τ2 )N −1 ι2
fX (x0 )fY |X (QY |X (τ1 |x0 )|x0 )fY |X (QY |X (τ2 |x0 )|x0 )
for each τ1 , τ2 ∈ T , where the last equality follows from the covariance expression of G derived in Theorem 2.

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

425

B.4. Proof of Corollary 4
Proof. We focus on the non-standardized tests since results for the standardized tests will follow from those for the
non-standardized ones through Slutsky’s Theorem under the stated assumptions that σ s , σ h are bounded away from
zero uniformly on T . Part (i) of the corollary follows from Corollaries 2 and 3. Part (ii) of the corollary follows by an
application of the functional delta method (van der Vaart,1998; Theorem 20.8) with Corollaries 2 and 3. Finally, note that
φ

the functional g ↦ → g −|T |−1 T gdτ is linear with an operator norm bounded by 2, and is therefore Hadamard differentiable
at QRKD tangentially to ℓ∞ (T ). □

∫

B.5. Sufficient primitive conditions
In this section, we present primitive conditions for the high-level statements in parts (ii) and (iii) of Assumption 6. We
introduce the short-hand notations
hx (x, ϵ )
fε|X (ϵ | x)dH M −1 (ϵ )
∥∇
ϵ h(x, ϵ )∥
∂ V (y,x)
∫
∂
fε|X (ϵ | x)dmM (ϵ )
f2 (y, x) =
V (y,x) ∂ x
∫
1
f3 (y, x) =
fε|X (ϵ | x)dH M −1 (ϵ )
∥∇
h(x
, ϵ )∥
ϵ
∂ V (y,x)
f1 (y, x) =

∫

where h, V and ∂ V are defined in Section 2.2. We show that Assumption 8 stated below in terms of the structural
primitives is sufficient
high-level conditions in parts∫(ii) and (iii) of Assumption 6. Define y∗ =
∫ for the aforementioned
M
sup
inf{y ∈ Y | V (y,x) fε|X (ϵ|x)dm (ϵ ) ≥ τ } and y∗ =
inf
inf{y ∈ Y | V (y,x) fε|X (ϵ|x)dmM (ϵ ) ≥ τ }.
(τ ,x)∈T ×[x,x]

(τ ,x)∈T ×[x,x]

q
∂q
f and ∂ xj ∂∂ yq−j f2 exist for each 0 ≤ j, q ≤ p − 1, j + q ≤ p − 1 and are Lipschitz continuous on
∂ xj ∂ yq−j 1
q
[y∗ , y∗ ]×[x, x0 ) and [y∗ , y∗ ]× (x0 , x]. (ii) f3 is Lipschitz continuous on [y∗ , y∗ ]×[x, x]. ∂ xj ∂∂yq−j f3 exists for each 0 ≤ j ≤ q ≤ p
and is Lipschitz continuous on [y∗ , y∗ ] × [x, x0 ) and [y∗ , y∗ ] × (x0 , x]. (iii) For each κ ∈ (0, ∞), there exist finite positive
′
′
′
′

Assumption 8. (i)

constants fL (κ ) and fU (κ ) such that 0 < fL (κ ) < f3 (y, x) < fU∫(κ ) < ∞ uniformly in (y, x) on [−κ, κ] × [x, x]. (iv)
y∗ > −∞ and y∗ < ∞. (v) For each τ ∈ T , x ↦ → inf{y ∈ Y | V (y,x) fε|X (ϵ|x)dmM (ϵ ) ≥ τ } is p − 1-time differentiable
∫
on [x, x]. Furthermore, τ ↦ → inf{y ∈ Y | V (y,x ) fε|X (ϵ|x0 )dmM (ϵ ) ≥ τ } is Lipschitz continuous on T . (vi) fε|X (·|x0 ) is Lipschitz
0
continuous.
Lemma 2.

Assumption 2, 3, 4, 5, and 8 imply parts (ii) and (iii) of Assumption 6.

Proof. Following the proof of Lemma 1 of Sasaki (2015) under Assumption 2, 3, 4, and 5, we obtain constants cj , j = 1,
2, 3, such that c3 ̸ = 0,
∂
FY |X (Q (τ |x)|x)
∂
c1 f1 (Q (τ |x), x) − c2 f2 (Q (τ |x), x)
Q (τ |x) = − ∂ x
=−
,
∂x
fY |X (Q (τ |x)|x)
c3 f3 (Q (τ |x), x)
∂
1
1
Q (τ |x) =
=
.
∂τ
fY |X (Q (τ |x)|x)
c3 f3 (Q (τ |x), x)

Assumption 8 (iv) implies

sup
(τ ,x)∈T ×[x,x]

and

(B.3)
(B.4)

|Q (τ |x)|< ∞. Assumption 8 (iii) allows us to pick κ large enough to ensure that the

denominator f3 (Q (τ |x), x) is uniformly bounded away from zero. Using these calculations, we argue that Assumption 8
implies parts (ii) and (iii) of Assumption 6.
First, as in the calculation for (B.4) above under Assumption 2, 3, 4, and 5, we can write

⏐∫
⏐
fY |X (QY |X ( · |x0 )|x0 ) = c3 f3 inf y ∈ Y ⏐
(

{

}

V (y,x0 )

)

fε|X (ϵ|x0 )dmM (ϵ ) ≥ τ , x0 .

By Assumption 8(v) and (vi), fY |X (QY |X ( · |x0 )|x0 ) is Lipschitz continuous on T . This shows that Assumption 6 (ii) (a) holds.
Second, set κ = max{|y∗ |, |y∗ |} + δ for a small δ > 0 and invoke Assumption 8 (iii), (iv), so we have 0 <
′
fL (κ ) < fY |X (y|x)/c3 = f3 (y, x) < fU′ (κ ) < ∞ uniformly in (y, x) on [−κ, κ] × [x, x]. By definitions of κ , y∗ , and y∗ ,
it holds that −κ < y∗ − δ/2 < y∗ ≤ Q (τ |x) ≤ y∗ < y∗ + δ/2 < κ on T × [x, x]. Take ξ = δ/2, and we have
fL (κ ) ≤ fY |X (QY |X (τ |x) + η|x) ≤ fU (κ ) for all τ ∈ T , |η| ≤ ξ and x ∈ [x, x̄]. This shows that Assumption 6 (ii) (b) holds.
∂
+
Third, Assumption 8(v) implies that Q (τ |x0 ) is Lipschitz continuous. For ∂τ
Q (τ | x +
0 ), since limx→x0 f3 (·|x) is uniformly
bounded away from zero and is Lipschitz in y by the argument in the second step under Assumption 8 (ii), (iii), and
(iv), (B.4) is well defined when it is evaluated at x = x+
0 . We can then conclude that it is Lipschitz continuous using the

426

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

∂
Lipschitz continuity of Q (τ |x0 ), which also follows from Assumption 8(v). The same reasoning applies to ∂τ
Q (τ |x−
0 ). This
shows that Assumption 6 (iii) (a) holds.
Fourth, Assumption 8(v) implies that Q (τ |·) is continuous at x0 for each τ ∈ T . This shows that the first statement of
Assumption 6 (iii) (b) holds. Finally, note that, by Assumption 8(i)–(v) and by the chain rule,

=

∂2
Q (τ |x)
∂ x2
[c1 f1 (Q (τ |x), x) − c2 f2 (Q (τ |x), x)]c3 ∂∂x f3 (Q (τ |x), x) − c3 f3 (Q (τ |x), x) ∂∂x [c1 f1 (Q (τ |x), x) − c2 f2 (Q (τ |x), x)]
c32 f32 (Q (τ |x), x)

exists and is Lipschitz continuous. A similar argument holds for higher order derivatives. This shows that the second
statement of Assumption 6 (iii) (b) holds. □
B.6. Auxiliary lemmata
The following Lemmata correspond to Lemma B.1-B.6 of Qu and Yoon (2015a), and proofs follow very closely from
theirs. We define our zi,n,τ , φn (τ ), u0i (τ ), ui (τ ) and ei (τ ) slightly differently to accommodate our setting.
Lemma 3. Suppose that Assumption 6(i)(iv) and (v) hold.
(1) For any γ ≥ 1, there exists B > 0 such that for any τ1 , τ2 ∈ T with τ1 ≤ τ2 ,
E ∥zi,n,τ1 Ki,n,τ1 − zi,n,τ2 Ki,n,τ2 ∥2γ ≤ Bhn (τ2 − τ1 )2γ .
1
(2) Let bn = (nhn )1/2+κ for κ ∈ (0, 1/2) and hn → 0, nhn → ∞ as n → ∞. Let δn = {(τ1 , τ2 ) : τ1 , τ2 ∈ T , τ1 ≤ τ2 ≤ τ1 +b−
n }.
Then,

sup (nhn )−1/2

(τ1 ,τ2 )∈δn

n
∑

∥zi,n,τ1 Ki,n,τ1 − zi,n,τ2 Ki,n,τ2 ∥ = op (1).

i=1

Proof. Without loss of generality, we assume supp(K ) = D = [−1, 1]. Note that (τ2 − τ1 )v ≤ (τ2 − τ1 ) for all 1 ≤ v ≤ p.
Thus Assumption 6(iv),(v) suggest that there is a constant C̄ independent of τ such that

∥zi,n,τ1 Ki,n,τ1 − zi,n,τ2 Ki,n,τ2 ∥ ≤ 1̄(xi − x0 ∈ c̄Dhn )(τ2 − τ1 ).

(B.5)

Hence,
E ∥zi,n,τ1 Ki,n,τ1 − zi,n,τ2 Ki,n,τ2 ∥2γ ≤ C̄ 2γ (τ2 − τ1 )2γ P(xi − x0 ∈ c̄Dhn ).
Assumption 6(i)(a) then implies the existence of a positive constant A such that P(xi − x0 ∈ c̄Dhn ) ≤ Ahn . This shows (1).
Eq. (B.5) implies
(nhn )−1/2

n
∑

∥zi,n,τ1 Ki,n,τ1 − zi,n,τ2 Ki,n,τ2 ∥ ≤ C̄ (nhn )1/2 (τ2 − τ1 ){(nhn )−1/2

n
∑

i=1

1(xi − x0 ∈ c̄Dhn )}

i=1

An application of the weak law of large numbers implies the part in the curly brackets is Op (1). Finally, sup(τ1 ,τ2 )∈δn
C̄ (nhn )1/2 (τ2 − τ1 ) ≤ C̄ (nhn )−κ → 0 as n → ∞. □
Lemma 4. Let bn = (nhn )1/2+κ with κ ∈ (0, 1/2), hn → 0 and nhn → ∞ as n → ∞. There exist γ > 1 and C̄ < ∞ such
1
that for any τ1 , τ2 ∈ T , |τ2 − τ1 |≥ b−
n ,
E ∥Sn (τ2 , 0, 0) − Sn (τ1 , 0, 0)∥2γ ≤ C̄ |τ2 − τ1 |γ .
Proof. Without loss of generality, we assume τ2 ≥ τ1 . Let

{(
) (
)}
τ2 − 1(u0i (τ2 ) ≤ 0) − τ1 − 1(u0i (τ1 ) ≤ 0) zi,n,τ2 Ki,n,τ2
(
)
A2i = τ1 − 1(u0i (τ1 ) ≤ 0) (zi,n,τ2 Ki,n,τ2 − zi,n,τ1 Ki,n,τ1 )
A1i =

and Akij stands for the jth element of Aki . By the Minkowski’s inequality,
2p+1

(E ∥Sn (τ2 , 0, 0) − Sn (τ1 , 0, 0)∥)

1/γ

≤

∑{
j=1

(nhn )

−γ

n
⏐∑
⏐2γ }1/γ
⏐
⏐
E⏐
A1ij + A2ij ⏐
i=1

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

427

Applying the Rosenthal’s inequality and the Minkowski’s inequality, we get
n
⏐∑
⏐

(nhn )−γ E ⏐

⏐2γ
⏐

A1ij + A2ij ⏐

i=1

≤2γ C (nhn )−γ

n
(∑

E ∥A1i ∥2 + E ∥A2i ∥2

)γ

n (
∑

+ 2γ C (nhn )−γ

(E ∥A1i ∥2γ )1/γ + (E ∥A2i ∥2γ )1/γ

i=1

)γ

(B.6)

i=1

Using an argument similar to those in Lemma 3, we obtain

(

E ∥A1i ∥2γ ≤E E {[τ2 − 1(u0i (τ2 ) ≤ 0) − τ1 + 1(u0i (τ1 ) ≤ 0)]2 |xi }∥zi,n,τ2 Ki,n,τ2 ∥2γ

)

≤(τ2 − τ1 )E ∥zi,n,τ2 Ki,n,τ2 ∥2γ ≤ Chn (τ2 − τ1 )
Also, E ∥A2i ∥2γ ≤ E ∥(zi,n,τ2 Ki,n,τ2 − zi,n,τ1 Ki,n,τ1 )∥2γ ≤ Bhn (τ2 − τ1 )2γ by Lemma 3(1). Similarly, E ∥A1i ∥2 ≤ Bhn (τ2 − τ1 ) and
E ∥A2i ∥2 ≤ Bhn (τ2 − τ1 )2 . Combining all these, we have the right-hand side of (B.6) bounded by M(τ2 − τ1 )γ + M(nhn (τ2 −
τ1 ))(1−γ ) (τ2 − τ1 )γ for some finite M. It is then further bounded by 2M(τ2 − τ1 )γ by definition of bn and γ > 1. Thus
(E ∥Sn (τ2 , 0, 0) − Sn (τ1 , 0, 0)∥)1/γ ≤ (2p + 1)(2M)1/γ (τ2 − τ1 ),
which completes the proof. □
Lemma 5.
P

For any ϵ > 0, η > 0, there exists δ > 0 such that for large n,

(

sup
τ ′′ ,τ ′ ∈T ,|τ ′′ −τ ′ |≤δ

)
∥Sn (τ ′′ , 0, 0) − Sn (τ ′ , 0, 0)∥ > ϵ < η.

Proof. We can without loss of generality assume that the components of zi,n,τ are nonnegative. Given a δ > 0, T contains
at most 1/δ intervals of length δ . So it suffices to show that for any ϵ > 0, η > 0, there exists δ > 0 such that
P

(

sup

s≤τ ≤δ+s,τ ∈T

)
∥Sn (τ , 0, 0) − Sn (s, 0, 0)∥ > ϵ < δη

(B.7)

for all s ∈ T for large n.
Partition [s, δ + s] into bn = (nhn )1/2+κ intervals of equal sizes with 0 < κ < 1/2. Let τj stand for the lower limit of
the jth interval and τ1 = s. Then,

∥Sn (τ , 0, 0) − Sn (s, 0, 0)∥ ≤ sup

sup

sup

1≤j≤bn τ ∈[τj ,τj+1 ]

s≤τ ≤δ+s,τ ∈T

∥Sn (τ , 0, 0) − Sn (τj , 0, 0)∥

+ sup ∥Sn (τj , 0, 0) − Sn (s, 0, 0)∥.
1≤j≤bn

For any τ ∈ [τj , τj+1 ], one has
Sn (τ , 0, 0) − Sn (τj , 0, 0) ≥Sn (τj+1 , 0, 0) − Sn (τj , 0, 0)

+ (nhn )−1/2

n
∑

(τj+1 − u0i (τj+1 < 0))(zi,n,τ Ki,n,τ − zτi,n,τ

i=1
n

− (nhn )−1/2

∑

(τj+1 − τj )zi,n,τ Ki,n,τ

i=1

By Lemma 3,

∥(nhn )−1/2

n
∑

(τj+1 − u0i (τj+1 < 0))(zi,n,τ Ki,n,τ − zτi,n,τ

j+1

Kτi,n,τ

i=1
n

≤(nhn )−1/2

∑

∥(zi,n,τ Ki,n,τ − zτi,n,τj+1 Kτi,n,τj+1 )∥ = op (1)

i=1

Also, since |τj+1 − τj |≤ (nhn )−1/2−κ ,

∥(nhn )−1/2

n
∑

(τj+1 − τj )zi,n,τ Ki,n,τ ∥ = op (1)

i=1

Therefore,
Sn (τ , 0, 0) − Sn (τj , 0, 0) ≥ Sn (τj+1 , 0, 0) − Sn (τj , 0, 0) − ϵ/5

j+1

)∥

j+1

Kτi,n,τ

j+1

)

428

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

with probability at least 1 − δη uniformly on T for large n. Similarly, we have for any τ ∈ [τj , τj+1 ], one has
Sn (τ , 0, 0) − Sn (τj , 0, 0) ≤(nhn )−1/2

n
∑

1(u0i (τj ) < 0)(zτi,n,τ Kτi,n,τ − zi,n,τ Ki,n,τ )
j
j

i=1

+ (nhn )−1/2

n
∑

(τj+1 − τj )zi,n,τ Ki,n,τ

i=1
n

− (nhn )−1/2

∑

τj (zτi,n,τj Kτi,n,τj − zi,n,τ Ki,n,τ )

i=1

=op (1) + op (1) + op (1).
Therefore
Sn (τ , 0, 0) − Sn (τj , 0, 0) ≤ ϵ/5
with probability at least 1 − δη uniformly on T for large n. So we have
sup ∥Sn (τ , 0, 0) − Sn (s, 0, 0)∥ ≤ sup ∥Sn (τj+1 , 0, 0) − Sn (τj , 0, 0)∥ +
s≤τ ≤s+δ

2ϵ

1≤j≤bn

≤3 sup ∥Sn (τj , 0, 0) − Sn (s, 0, 0)∥ +
1≤j≤bn

5

+ sup ∥Sn (τj , 0, 0) − Sn (s, 0, 0)∥
1≤j≤bn

2ϵ
5

with probability at least 1 − δη uniformly on T for large n. Thus, to show (B.7), it suffices to show
P( sup ∥Sn (τj , 0, 0) − Sn (τ1 , 0, 0)∥ > ϵ/5) < δη
1≤j≤bn

for large n. Theorem 12.2 of Billingsley∑
(1968) states that, if there exists β ≥ 0, α > 1 and ul ≥ 0 for l ∈ {1, . . . , bn } such
that E(∥Sn (τj , 0, 0) − Sn (τi , 0, 0)∥β ) ≤ ( i<l≤j ul )α , 0 ≤ i ≤ j ≤ bn , then
P( sup ∥Sn (τj , 0, 0) − Sn (τ1 , 0, 0)∥ > ϵ ) ≤ ϵ −α Cβ,α (u1 + · · · + ubn )α .
1≤j≤bn

Apply this statement with β = 2γ and α = γ . Lemma 4 implies for 0 ≤ i ≤ j ≤ bn , one has E ∥Sn (τj , 0, 0) − Sn (τi , 0, 0)∥β ≤
C̄ (τj − τi )α . Therefore

ϵ

P( sup ∥Sn (τj , 0, 0) − Sn (τ1 , 0, 0)∥ > ϵ/5) ≤ δ (( )−α Cβ,α C̄ δ α−1 ).
5
1≤j≤bn
We may choose δ so δ (( 5ϵ )−α Cβ,α C̄ δ α−1 ) ≤ η and this completes the proof.

□

Lemma 6. Suppose that Assumption 6 holds. Let bn = (nhn )1/2+κ , κ ∈ (0, 1/2) and consider a partition of T into bn intervals
of equal sizes. Let τj denote the lower limit of the jth interval. Then,
sup

sup

1≤j≤bn τj−1 ≤τ ≤τj

sup

n


∑


zi,n,τ Ki,n,τ {1(u0i (τj ) ≤ ei (τ )) − 1(u0i (τj ) ≤ ei (τj ))} = op (1) and
(nhn )−1/2
i=1

sup

sup

1≤j≤bn τj−1 ≤τ ≤τj ∥φn ∥≤log1/2 (nhn,τ )

− (nhn )−1/2

n
∑

(

n

{ (
)
∑

zi,n,τ Ki,n,τ 1 u0i (τj ) ≤ ei (τ ) + (nhn,τ )−1/2 zi′,n,τ φn
(nhn )−1/2
i=1

zi,n,τj Ki,n,τj 1 u0i (τj ) ≤ ei (τj ) + (nhn,τj )−1/2 zi′,n,τj φn

)}

 = op (1).

i=1

Proof. We can assume without loss of generality that zi,n,τ is a nonnegative scalar. First, consider the left-hand side of
the first equation in the statement of lemma. By part (2) of Lemma 3, the left-hand side has the same order as
sup

sup

1≤j≤bn τj−1 ≤τ ≤τj

∥(nhn )−1/2

n
∑

zi,n,τj Ki,n,τj {1(u0i (τj ) ≤ ei (τ )) − 1(u0i (τj ) ≤ ei (τj ))}∥

(B.8)

i=1

Furthermore, for any τ ∈ [τj , τj+1 ], for any ϵ > 0, if n is large enough, it holds that ei (τ )−ei (τj ) = op ((nhn )−1/2 ) ≤ ϵ (nhn )−1/2
uniformly on T with probability approaching one. Thus, (B.8) is bounded by
sup ∥(nhn )−1/2
1≤j≤bn

n
∑
i=1

zi,n,τj Ki,n,τj 1(ei (τj ) − ϵ (nhn )−1/2 ≤ u0i (τj ) ≤ ei (τj ) + ϵ (nhn )−1/2 )∥.

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

429

Let

ξi,τj =1(ei (τj ) − ϵ (nhn )−1/2 ≤ u0i (τj ) ≤ ei (τj ) + ϵ (nhn )−1/2 )
− E [1(ei (τj ) − ϵ (nhn )−1/2 ≤ u0i (τj ) ≤ ei (τj ) + ϵ (nhn )−1/2 )|xi ].
Then, (B.8) can be further bounded by
sup (nhn )−1/2 ∥
1≤j≤bn

+ sup (nhn )

n
∑

zi,n,τj Ki,n,τj ξi,τj ∥

i=1
n
−1/2

1≤j≤bn

⏐ ]
⏐

∑ [

E 1(ei (τj ) − ϵ (nhn )−1/2 ≤ u0i (τj ) ≤ ei (τj ) + ϵ (nhn )−1/2 )⏐xi .

i=1

The second term is op (1). Note that by a union bound, the first term satisfies
P

(

sup (nhn )−1/2 ∥

1≤j≤bn

n
∑

)

zi,n,τj Ki,n,τj ξi,τj ∥ > η ≤

i=1

bn
(
∑

n
∑

j=1

i=1

P (nhn )−1/2 ∥

)

zi,n,τj Ki,n,τj ξi,τj ∥ .

Applying Rosenthal inequality with γ > 1 to the jth term on the right-hand side above shows that it is bounded by
Cη

−2γ

(nhn )

−γ /2

{ (

−1/2

E (nhn )

n
∑

2

2

E(∥ξi,τj ∥ |xi )∥zi,n,τj Ki,n,τj ∥

)γ

i=1

+(nhn )−γ /2

n
)}
(
∑
E ∥zi,n,τj Ki,n,τj ∥2γ E(∥ξi,τj ∥2 |xi )
i=1

Note that E(∥ξi,τj ∥ |xi ) ≤ E(∥ξi,τj ∥2 |xi ) ≤ B(nhn )−1/2 for some B > 0. The term inside the curly brackets is finite. Therefore,
the display above can be bounded by CM η−2γ (nhn )−γ /2 . After summing over j, it is bounded by CM η−2γ (nhn )1/2+κ−γ /2 → 0
for γ > 1 + 2κ . This proves the first statement.
One can prove the second result using similar arguments since the difference between (nhn,τ )−1/2 zi′,n,τ φn and
(nhn,τ )−1/2 zi,n,τj φn is of a smaller order than (nhn )−1/2 by Assumption 6(v). The uniformity can be shown as in Lemma 7. □
2γ

Lemma 7.

Suppose that Assumption 6 holds. Let Kn = log1/2 (nhn ). We have

sup sup ∥Sn (τ , φn , ei (τ )) − Sn (τ , 0, ei (τ ))∥ = op (1).
τ ∈T ∥φn ∥≤Kn

Proof. We again assume without loss of generality that the components of zi,n,τ are all nonnegative. Partition T into
bn = (nhn )1/2+κ intervals and let τj be the lower limit of the jth interval. Applying Eq. (B.8) and a similar argument as in
Eq. (B.7) gives that for any τ ∈ [τj , τj+1 ] and any ϵ > 0, it holds uniformly for large n that
Sn (τj+1 , φn , ei (τj+1 )) − Sn (τj , 0, ei (τj )) + 2ϵ

≤Sn (τ , φn , ei (τ )) − Sn (τ , 0, ei (τ ))
≤Sn (τj , φn , ei (τj )) − Sn (τj+1 , 0, ei (τj+1 )) + 2ϵ.
By adding and subtracting terms, we obtain
sup sup ∥Sn (τ , φn , ei (τ )) − Sn (τ , 0, ei (τ ))∥ ≤2 sup ∥Sn (τj+1 , 0, 0) − Sn (τj , 0, 0)∥
τ ∈T ∥φn ∥≤Kn

1≤j≤bn

+4

sup

∥Sn (τj+1 , 0, ei (τj )) − Sn (τj , 0, 0)∥

1≤j≤bn +1

+2

sup

sup ∥Sn (τj , φn , ei (τj )) − Sn (τj , 0, ei (τj ))∥ + 4ϵ.

(B.9)

1≤j≤bn +1 ∥φn ∥≤Kn

Consider the third term on the right-hand side. For any ϵ > 0, the set {φn : ∥φn ∥ ≤ Kn } can be partitioned into N(δ )
spheres such that each of them has a diameter smaller than or equal to δ . Note N(δ ) = O((Kn /δ )2p+1 ). Denote by Dh the
spheres with center φh,n for h ∈ {1, . . . , N(δ )}. For any φn ∈ Dh , one has
zi′,n,τj φh,n − ∥zi,n,τj ∥δ ≤ zi′,n,τj φn ≤ zi′,n,τj φh,n + ∥zi,n,τj ∥δ.

430

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

Therefore,
sup ∥Sn (τj , φn , ei (τj )) − Sn (τj , 0, ei (τj ))∥

sup

1≤j≤bn +1 ∥φn ∥≤Kn

sup

≤

sup

1≤j≤bn +1 k∈{1,2},φn ∈Dh
1≤h≤N(δ )

n

}
{
∑

zi,n,τj Ki,n,τj E 1(u0i (τj ) ≤ ei (τj ) + (nhn,τj )−1/2 [zi′,n,τj φh,n + (−1)k ∥zi,n,τj ∥δ])|xi
(nhn )−1/2
i=1



− E {1(u0i (τj ) ≤ ei (τj ) + (nhn,τj )−1/2 zi′,n,τj φn )}
n
∑
+ sup
max max ∥(nhn )−1/2
zi,n,τj Ki,n,τj ξi,j,h,k ∥
1≤j≤bn +1 1≤h≤N(δ ) k=1,2

(B.10)

i=1

where

⏐ }
{
⏐
ξi,j,h,k =E 1(u0i (τj ) ≤ ei (τj ) + (nhnτj )−1/2 [zi′,n,τj φn + (−1)k ∥zi,n,τj ∥δ])⏐xi
− 1(u0i (τj ) ≤ ei (τj ) + (nhnτj )−1/2 [zi′,n,τj φn + (−1)k ∥zi,n,τj ∥δ])
+ E {1(u0i (τj ) ≤ ei (τj ))|xi } − 1(u0i (τj ) ≤ ei (τj )).

An application of the Taylor expansion shows that the first term on the right-hand side of (B.10) is of the same order as
δ , which can be made arbitrarily small. For the second term, an application of Rosenthal inequality shows that for any
ϵ > 0, 1 ≤ j ≤ bn + 1, 1 ≤ h ≤ N(δ ) and k ∈ {1, 2}, we have

(


bn N(δ )P (nhn )−1/2

n
∑




zi,n,τj Ki,n,τj ξi,j,h,k  > ϵ

)

≤ M ϵ −2γ bn N(δ )(nhn )−γ /2 Knγ

i=1

for large n, which can be shown to converge to zero for δ = Kn−κ using the definition of bn , N(δ ) and Kn and choosing
γ = 1 + 2κ + c for some c > 0.
The second term on the right-hand side of (B.9) can be analyzed similarly and is op (1). The first term on the right-hand
side of (B.9) is op (1) by Lemma 5. □
Lemma 8.

Under Assumption 6, we have

n


∑


{ψτ (u0i (τ ) − ei (τ )) − ψτ (u0i (τ ))}zi,n,τ Ki,n,τ  = Op (1).
sup (nhn )−1/2

τ ∈T

i=1

Proof. The terms inside the norm can be written as
Sn (τ , 0, 0) − Sn (τj , 0, ei (τ )) + (nhn )−1/2

n
∑

zi,n,τ Ki,n,τ {P(u0i (τ ) ≤ 0) − E [1(u0i (τ ) ≤ ei (τ ))|xi ]} + op (1).

i=1
p+1

The third term is op (1) as shown in Lemma 7 and the rest is Op (1) by the Taylor expansion and due to ei (τ ) = O(hn

). □

Appendix C. Practical guideline

C.1. Bandwidth choice
This section presents a guide to practice for bandwidth choice. Imbens and Kalyanaraman (2012), Calonico et al.
(2014), and Arai and Ichimura (2016) provide data-driven optimal bandwidth selection algorithms for the mean regression
discontinuity design. In this section, we propose a bandwidth selection rule based on the MSE for the local linear
estimation of the conditional CDF, which is compatible with orders p∫ > 1 for biased-corrected estimation.
− ′
−
+
− ′
−1
the following notations: u1 = [1, ud+
[1, ud+
u , udu ] , N1 =
u , udu ][1, udu , udu ]1 K (u)du, T1 = (c(τ ))
R
∫ We define
+
−
+
− ′ 2
′
′
[
1
,
ud
,
ud
][
1
,
ud
,
ud
]
K
(u)du
and
ȷ
=
[
0
,
1
,
0
]
,
ȷ
=
[
0
,
0
,
1
]
.
With
the
order
of
polynomial
set
to
one,
Lemma
1
2
3
u
u
u
u
R
and Theorem 2 together imply that the approximate MSE is MSE(β̂1+ (τ ) − β̂1− (τ )) = Bias2 (β̂1+ (τ ) − β̂1− (τ )) + Var(β̂1+ (τ ) −
β̂1− (τ )), where

[ ȷ′ (N )−1 ∫ ( ∂ 2 Q (τ |x+ )
)
∂ 2 Q (τ | x −
1
0
0) −
Bias(β̂1 (τ ) − β̂1 (τ )) =hn,τ 2
d+
du u2 u′1 K (u)du
u +
2
2
2!
∂x
∂x
∫ (R 2
)
]
2
)
ȷ′3 (N1 )−1
∂ Q (τ |x+
∂
Q
(
τ
|x−
0
0) −
+
2 ′
−
d
+
d
u
u
K
(u)du
and
u
u
1
2!
∂ x2
∂ x2
R
1 τ (1 − τ )(ȷ′2 N1−1 T1 (τ )N1−1 ȷ2 + ȷ′3 N1−1 T1 (τ )N1−1 ȷ3 − 2ȷ′2 N1−1 T1 (τ )N1−1 ȷ3 )
Var(β̂1+ (τ ) − β̂1− (τ )) = 3
nhn,τ
fX (x0 )fY |X (Q (τ |x0 )|x0 )
+

−

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

431

Taking the first order condition with respect to the bandwidth, under Assumption 6, we obtain the approximate optimal
choice of hn,τ for the QRKD estimand:
h∗n,τ (s) =

( 3 C (τ ) ) 12 1
2
n− 5 ,
2 C12 (τ )

where
C 1 (τ ) =

ȷ′2 (N1 )−1
2!
ȷ3 (N1 )−1
′

−
C 2 (τ ) =

2!

∫ ( 2
)
∂ 2 Q (τ | x −
∂ Q (τ | x +
0) −
0) +
du +
du u2 u′1 K (u)du
2
2
∂x
∂x
R
∫ ( 2
+
)
2
∂ Q (τ | x 0 ) + ∂ Q (τ | x −
0) −
+
u2 u′1 K (u)du
d
d
u
u
∂ x2
∂ x2
R

and

τ (1 − τ )(ȷ′2 N1−1 T1 (τ )N1−1 ȷ2 + ȷ′3 N1−1 T1 (τ )N1−1 ȷ3 − 2ȷ′2 N1−1 T1 (τ )N1−1 ȷ3 )
.
fX (x0 )fY |X (Q (τ |x0 )|x0 )

For bias-corrected estimation with an order p > 1, this bandwidth rule above provides a rate that is required by
Assumption 6(v). In the above formulas, the unknown densities, fX and fY |X , and the unknown conditional quantile function
Q and its derivative
C1 (τ ) and C2 (τ ) by
Ĉ1 (τ ) =

ȷ′2 (N1 )−1

Ĉ2 (τ ) =

need to be replaced by the respective estimates ˆ
fX , ˆ
fY |X , α̌ , and β̌2± . We thus propose to replace

∫ (

2!

R

ȷ3 (N1 )−1

∫ (

2!

R

′

−

∂2
Q
∂ x2

)
−
−
2 ′
β̌2+ (τ )d+
u + β̌2 (τ )du u u1 K (u)du
)
−
−
2 ′
β̌2+ (τ )d+
u + β̌2 (τ )du u u1 K (u)du

and

τ (1 − τ )(ȷ′2 N1−1 T1 (τ )N1−1 ȷ2 + ȷ′3 N1−1 T1 (τ )N1−1 ȷ3 − 2ȷ′2 N1−1 T1 (τ )N1−1 ȷ3 )
,
ˆ
fX (x0 )ˆ
fY |X (α̌ (τ )|x0 )

respectively, where

α̌ (τ ) =ι′1

argmin

n
∑

(α,β1+ ,β1− ,β2+ ,β2− )∈R5 i=1

v=1

n

β̌2+ (τ ) =ι′4

β̌2− (τ ) =ι′5

argmin

∑

(α,β1+ ,β1− ,β2+ ,β2− )∈R5 i=1

argmin

2
(
v)
∑
− − (xi − x0 )
ρτ yi − α −
(βv+ d+
,
i + βv d i )
v!

and

v=1

n
∑

(α,β1+ ,β1− ,β2+ ,β2− )∈R5 i=1

2
(
v)
∑
− − (xi − x0 )
ρτ yi − α −
(βv+ d+
,
i + βv d i )
v!

2
(
v)
∑
− − (xi − x0 )
ρτ yi − α −
(βv+ d+
.
i + βv d i )
v!

v=1

Bandwidth choices for the preliminary estimates, ˆ
fX and ˆ
fY |X , can be conducted by standard rule-of-thumb or datay
driven methods. Let hxn and (h̄n , h̄xn )′ denote the bandwidths used for estimating ˆ
fX and ˆ
fY |X , respectively. First, hxn may

)−2/5 (∫

)1/5 (

)−1/5

3
√
σ −5
n−1/5 ,
be obtained by minimizing approximate MISE. In other words, hxn =
u2 K (u)du
K (u)2 du
8 π X
where σX can be estimated by sample variance of X . See Sections 3.3 and 3.4 of Silverman (1986). Second, Bashtannyk
y
and Hyndman (2001) suggest that (h̄n , h̄xn )′ may be obtained by

(∫

(h̄yn , h̄xn )′ =

((

d2 v

√

2.85 2πσX5

)1/4

h̄xn ,

(

32R2 (K )σY5 (260π 9 σX58 )1/8
nσK4 d5/2 v 3/4 [v 1/2 + d(16.25πσX10 )1/4 ]

)1/6 )′
, ,

√

where R(K ) = K 2 (u)du, v = 0.95 2πσX3 (3d2 σX2 + 8σY2 ) − 32σX2 σY2 exp(−2), and d is the slope of an OLS of yi on [1, xi ]′ .
Here, σK2 is the variance with respect to the kernel function K . The variances, σX2 and σY2 , can be replaced by sample
variances of xi and yi , respectively.

∫

C.2. Pivotal simulation and implementation of uniform inference
As pointed out in Section 6 of Qu and Yoon (2015a) and Remark 2 of Qu and Yoon (2015b), the distribution of
the process G(τ , j) is conditionally pivotal and the randomness of Uniform Bahadur Representations come only from
{τ − 1{yi ≤ Q (τ |xi )}}ni=1 conditional on data. In this light, we can simulate the distribution of G(τ , j) in the following
i.i.d.

manner. In each iteration, we generate {ui }ni=1 ∼ Uniform(0, 1) independently from data, and evaluate {τ − 1{ui ≤ τ }}ni=1
in place of {τ − 1{yi ≤ Q (τ |xi )}}ni=1 in the Uniform Bahadur representations. Repeat this process many times. With this

432

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

procedure, we can perform the tests of significance and heterogeneity as in Section 3.2 via simulating the supremum of
G(τ , j). The following algorithm presents a complete procedure to implement the non-standardized test of significance
and test of heterogeneity in Corollary 4.
Algorithm 1.
1. Discretize T into a grid points Td = {t1 , . . . , tT }. For each τ ∈ Td , estimate (α̂ (τ ), β̂1+ (τ ), β̂1− (τ )).
2. Estimate ˆ
fX (x0 ) and estimate ˆ
fY |X (α̂ (τ )|x0 ) for each τ ∈ Td .
i.i.d.

3. Generate {ui }ni=1 ∼ Uniform(0, 1) independently from data.
4. For each τ ∈ Td , compute
Ŷ1 (τ ) =

(b′ (x+ )
0

−

∑n

i=1 zi,n,τ Ki,n,τ (τ − 1{ui ≤ τ })
√
−
′
b (x0 )) nhn,τˆ
fX (x0 )ˆ
fY |X (α̂ (τ )|x0 )

(ι′2 − ι′3 )N −1

5. Iterate the third and fourth steps M times to obtain {Ŷj (·)}M
j=1 on Td .
6. Compute the test statistic(s) WSn (Td ) and/or WHn (Td ).
′
7. Compute the pth quantile(s) of maxτ ∈Td |Ŷj (τ )| and/or maxτ ∈Td |φQRKD
(Ŷj )(τ )|, the simulated critical values for the test
statistic(s), WSn (Td ) and/or WHn (Td ), respectively.
To compute standardized version of the test statistics, we also need to obtain estimates for σ̂ s and σ̂ h . We compute
them based on the standard deviations of
Asn (τ ) =

√

ˆ τ)
nh3n,τ QRKD(

Ahn (τ ) = sup
τ ∈T

√

[

and

ˆ τ ) − |T |−1
nh3n,τ QRKD(

∫

]

ˆ τ ′ )dτ ′ .
QRKD(
T

The following algorithm outlines a procedure for the standardized version of the test.
Algorithm 2.

Steps 1–5 remain the same as those in Algorithm 1.

6. Compute the test statistic(s) WSnstd (Td ) and/or WHnstd (Td ).
′
7. Compute the pth quantile(s) of maxτ ∈Td |Ŷj (τ )/σ̂ s (τ )| and/or maxτ ∈Td |φQRKD
(Ŷj )(τ )/σ̂ h (τ )|, the simulated critical
std
std
values for the test statistic(s), WSn (Td ) and/or WHn (Td ), respectively.
References
Angrist, Joshua D., Graddy, Kathryn, Imbens, Guido W., 2000. The interpretation of instrumental variables estimators in simultaneous equations
models with an application to the demand for fish. Rev. Econom. Stud. 67 (3), 499–527.
Angrist, Joshua D., Imbens, Guido W., 1995. Two-stage least squares estimation of average causal effects in models with variable treatment intensity.
J. Amer. Statist. Assoc. 90 (430), 431–442.
Arai, Yoichi, Ichimura, Hidehiko, 2016. Optimal bandwidth selection for the fuzzy regression discontinuity estimator. Econom. Lett. 141, 103–106.
Bashtannyk, David M., Hyndman, Rob J., 2001. Bandwidth selection for kernel conditional density estimation. Comput. Statist. Data Anal. 36 (3),
279–298.
Billingsley, Patrick, 1968. Convergence of Probability Measures. John Wiley and Sons.
Calonico, Sebastian, Cattaneo, Matias D., Farrell, Max, Titiunik, Rocio, 2016. Regression discontinuity designs using covariates, Working Paper.
Calonico, Sebastian, Cattaneo, Matias D., Titiunik, Rocio, 2014. Robust nonparametric confidence intervals for regression-discontinuity designs.
Econometrica 82 (6), 2295–2326.
Card, David, Lee, David, Pei, Zhuan, Weber, Andrea, 2016. Inference on causal effects in a generalized regression kink design. Econometrica 83 (6),
2453–2483.
Cattaneo, Matias D., Escanciano, Juan Carlos, 2017. Regression discontinuity designs: theory and applications. Adv. Econom. 38.
Chernozhukov, Victor, Fernández-Val, Iván, 2005. Subsampling inference on quantile regression processes. Sankhya 67 (2), 253–276.
Cook, Thomas D., 2008. Waiting for life to arrive: a history of the regression-discontinuity design in psychology, statistics and economics. J.
Econometrics 142 (2), 636–654.
Dong, Yingying, 2016. Jump or kink? Identifying education effects by regression discontinuity design without the discontinuity, Working Paper.
Frandsen, Brigham R., Frölich, Markus, Melly, Blaise, 2012. Quantile treatment effects in the regression discontinuity design. J. Econometrics 168 (2),
382–395.
Guerre, Emmanuel, Sabbah, Camille, 2012. Uniform bias study and bahadur representation for local polynomial estimators of the conditional quantile
function. Econom. Theory 26 (5), 1529–1564.
Heckman, James J., Vytlacil, Edward, 2005. Structural equations, treatment effects, and econometric policy evaluation. Econometrica 73 (3), 669–738.
Imbens, Guido W., Kalyanaraman, Karthik, 2012. Optimal bandwidth choice for the regression discontinuity estimator. Rev. Econom. Stud. 79 (3),
933–959.
Imbens, Guido, Lemieux, Thomas, 2008. Special issue editors’ introduction: the regression discontinuity design – theory and applications. J.
Econometrics 142 (2), 611–614.
Imbens, Guido W., Wooldridge, Jeffrey M., 2009. Recent developments in the econometrics of program evaluation. J. Econ. Lit. 47 (1), 5–86.
Kato, Ryutah, Sasaki, Yuya, 2017. On using linear quantile regressions for causal inference. Econom. Theory 33 (3), 664–690.
Knight, Keith, 1998. Limiting distributions for L1 regression estimators under general conditions. Ann. Statist. 26 (2), 755–770.
Koenker, Roger, 2005. Quantile Regression. Cambridge University Press, Cambridge.

H.D. Chiang and Y. Sasaki / Journal of Econometrics 210 (2019) 405–433

433

Koenker, Roger, Xiao, Zhijie, 2002. Inference on the quantile regression process. Econometrica 70 (4), 1583–1612.
Kong, Efang, Linton, Oliver B., Xia, Yingcun, 2010. Uniform bahadur representation for local polynomial estimates of M-regression and its application
to the additive model. Econom. Theory 26 (5), 1529–1564.
Landais, Camille, 2011. Heterogeneity and behavioral responses to unemployment benefits over the business cycle, Working Paper, LSE.
Landais, Camille, 2015. Assessing the welfare effects of unemployment benefits using the regression kink design. Am. Econ. J. 7 (4), 243–278.
Lee, S., Lemieux, Thomas, 2010. Regression discontinuity designs in economics. J. Econ. Lit. 48 (2), 281–355.
Moffitt, Robert, 1985. The effect of the duration of unemployment benefits on work incentives: an analysis of four datasets, Unemployment Insurance
Occasional Papers 85-4, U.S. Department of Labor, Employment and Training Administration.
Nielsen, Helena Skyt, Sørensen, Torben, Taber, Christopher, 2010. Estimating the effect of student aid on college enrollment: evidence from a
government grant policy reform. Am. Econ. J. 2 (2), 185–215.
Oka, Tatsushi, Qu, Zhongjun, 2011. Estimating structural changes in regression quantiles. J. Econometrics 162 (2), 248–267.
Padula, Mariarosaria, 2011. Asymptotic Stability of Steady Compressive Fluids. Springer.
Qu, Zhongjun, Yoon, Jungmo, 2015a. Nonparametric estimation and inference on conditional quantile processes. J. Econometrics 185 (1), 1–19.
Qu, Zhongjun, Yoon, Jungmo, 2015b. Uniform inference on quantile effects under sharp regression discontinuity designs, Working Paper, 2015.
Sabbah, Camille, 2014. Uniform confidence bands for local polynomial quantile estimators. ESAIM Probab. Stat. 18, 265–276.
Sasaki, Yuya, 2015. What do quantile regressions identify for general structural functions?. Econom. Theory 31 (5), 1102–1116.
Silverman, Bernard W., 1986. Density Estimation for Statistics and Data Analysis. Chapman & Hall/CRC, London.
Simonsen, Marianne, Skipper, Lars, Skipper, Niels, 2016. Price sensitivity of demand for prescription drugs: Exploiting a regression kink design. J.
Appl. Econometrics 31 (2), 320–337.
van der Vaart, Aad W., 1998. Asymptotic Statistics. Cambridge University Press, Cambridge.
Yitzhaki, Shlomo, 1996. On using linear regressions in welfare economics. J. Bus. Econom. Statist. 14 (4), 478–486.

