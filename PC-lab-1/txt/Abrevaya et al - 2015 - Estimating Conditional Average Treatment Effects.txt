Journal of Business & Economic Statistics

ISSN: 0735-0015 (Print) 1537-2707 (Online) Journal homepage: https://www.tandfonline.com/loi/ubes20

Estimating Conditional Average Treatment Effects
Jason Abrevaya, Yu-Chin Hsu & Robert P. Lieli
To cite this article: Jason Abrevaya, Yu-Chin Hsu & Robert P. Lieli (2015) Estimating Conditional
Average Treatment Effects, Journal of Business & Economic Statistics, 33:4, 485-505, DOI:
10.1080/07350015.2014.975555
To link to this article: https://doi.org/10.1080/07350015.2014.975555

Accepted author version posted online: 30
Oct 2014.
Published online: 27 Oct 2015.
Submit your article to this journal

Article views: 1427

View related articles

View Crossmark data

Citing articles: 12 View citing articles

Full Terms & Conditions of access and use can be found at
https://www.tandfonline.com/action/journalInformation?journalCode=ubes20

Estimating Conditional Average
Treatment Effects
Jason ABREVAYA
Department of Economics, University of Texas, Austin, TX 78712 (abrevaya@eco.utexas.edu)

Yu-Chin HSU
Institute of Economics, Academia Sinica, Taipei 115, Taiwan (ychsu@econ.sinica.edu.tw)

Robert P. LIELI
Department of Economics, Central European University, H-1051 Budapest, Hungary and Magyar Nemzeti Bank,
1850 Budapest, Hungary (lielir@ceu.hu)
We consider a functional parameter called the conditional average treatment effect (CATE), designed
to capture the heterogeneity of a treatment effect across subpopulations when the unconfoundedness
assumption applies. In contrast to quantile regressions, the subpopulations of interest are defined in terms
of the possible values of a set of continuous covariates rather than the quantiles of the potential outcome
distributions. We show that the CATE parameter is nonparametrically identified under unconfoundedness
and propose inverse probability weighted estimators for it. Under regularity conditions, some of which are
standard and some are new in the literature, we show (pointwise) consistency and asymptotic normality
of a fully nonparametric and a semiparametric estimator. We apply our methods to estimate the average
effect of a first-time mother’s smoking during pregnancy on the baby’s birth weight as a function of the
mother’s age. A robust qualitative finding is that the expected effect becomes stronger (more negative) for
older mothers.
KEY WORDS: Birth weight; Inverse probability weighted estimation; Nonparametric method; Treatment
effect heterogeneity.

1.

INTRODUCTION

When individual treatment effects in the population are heterogeneous, but treatment assignment is unconfounded given
a vector X of observable covariates, it is a well-known result
that the average treatment effect (ATE) in the population is nonparametrically identified (see, e.g., Rosenbaum and Rubin 1983,
1985). Given the heterogeneity of individual effects, it may also
be of interest to estimate ATE in various subpopulations defined
by the possible values of some component(s) of X. We will refer
to the value of the ATE parameter within such a subpopulation
as a conditional average treatment effect (CATE). For example,
if one of the covariates is gender, one might be interested in
estimating ATE separately for males and females. As treatment
assignment in the two subpopulations is unconfounded given
the rest of the components of X, one can simply split the sample by gender and apply standard nonparametric estimators of
ATE to the two subsamples. A second example, considered by
a number of authors, is to define CATE as a function of the full
set of conditioning variables X. In this case CATE(x) gives the
conditional mean of the treatment effect for any point x in the
support of X.
Though not referred to by this name, the CATE function introduced in the second example already appears in Hahn (1998)
and Heckman, Ichimura, and Todd (1997, 1998) as a “first stage”
estimand in the (imputation-based) nonparametric estimation of
ATE. Heckman and Vytlacil (2005) discussed the identification
and estimation of CATE(x), which they called ATE(x), in terms
of the marginal treatment effect in a general structural model.
Khan and Tamer (2010) mentioned CATE(x) explicitly, but their

focus was on ATE. Lee and Whang (2009) and Hsu (2012)
considered estimating and testing hypotheses about CATE(x)
when X is absolutely continuous, and provided detailed asymptotic theory. MaCurdy, Chen, and Hong (2011) also discussed
the identification and estimation of CATE(x).
In this article we extend the concept of CATE to the technically more challenging situation in which the conditioning
covariates X1 are continuous and form a strict subset of X. As
the unconfoundedness assumption will not generally hold conditional on X1 alone, it is not possible to simply apply, say, the
Lee and Whang (2009) CATE estimator with X1 playing the
role of X. Rather, one needs to estimate CATE as a function of
X, and then average out the unwanted components by integrating with respect to the conditional distribution of X(1) given X1 ,
where X(1) denotes those components of X that are not in X1 .
This distribution is, however, generally unknown and has to be
estimated.
When X1 is a discrete variable (such as in the first example),
averaging with respect to the empirical distribution of X(1) | X1
is accomplished “automatically” by virtue of the ATE estimator
being implemented subsample-by-subsample. The result is an
estimate of CATE(x1 ) for each point x1 in the support of X1 .
This suggests that when X1 is continuous one could at least

485

© 2015 American Statistical Association
Journal of Business & Economic Statistics
October 2015, Vol. 33, No. 4
DOI: 10.1080/07350015.2014.975555
Color versions of one or more of the figures in the article can be
found online at www.tandfonline.com/r/jbes.

486

approximate CATE by discretizing X1 and estimating ATE on
the resulting subsamples provided that they are large enough.
However, the CATE estimate obtained this way will depend on
the discretization used and will be rather crude and discontinuous, just as a histogram is generally a crude and discontinuous
estimate of the underlying density function.
The technical contribution of this article consists of proposing “smooth” nonparametric and semiparametric estimators of
CATE when X1 is continuous and a strict subset of X, and developing the first-order asymptotic theory of these estimators. The
estimators are constructed as follows. First, the propensity score,
the probability of treatment conditional on X, is estimated by either a kernel-based regression (the fully nonparametric case) or
by a parametric model (the semiparametric case). In the second
step the observed outcomes are weighted based on treatment
status and the inverse of the estimated propensity score, and
local averages are computed around points in the support X1 ,
using another set of kernel weights. (Intuitively, the second stage
can be interpreted as integrating with respect to a smoothed estimate of the conditional distribution of the inverse propensity
weighted outcomes given X1 .) Under regularity conditions the
estimator is shown to be consistent and asymptotically normal;
the results allow for pointwise inference about CATE as a function of X1 . Of the conditions used to prove these results, the
most noteworthy ones are those that are used in the fully nonparametric case to restrict the relative convergence rates of the
two smoothing parameters employed in steps one and two, and
prescribe the order of the kernels.
The CATE estimators described above can be regarded as generalizations of the inverse probability weighted ATE estimator
proposed by Hirano, Imbens, and Ridder (2003). An alternative
(first-order equivalent) estimator of CATE could be based on
nonparametric imputation (e.g., Hahn 1998). In this article we
restrict attention to the first approach.
We present simulation results as well as an empirical exercise
to illustrate the finite sample properties and the practical implementation of our estimators. Specifically, we estimate the expected effect of a first-time mother’s smoking during pregnancy
on the birth weight of her child conditional on the mother’s age,
using vital statistics data from North Carolina. In this exercise
we focus on the semiparametric estimator, as in most applied
settings, such as the one at hand, the applicability of a fully
nonparametric procedure is likely to be hampered by curse of
dimensionality problems.
The intended contribution of the application to the pertaining empirical literature is to explore the heterogeneity of the
smoking effect along a given dimension in an unrestricted and
intuitive fashion. Previous estimates reported in the literature
are typically constrained to be a single number by the functional form of the underlying regression model. If the effect of
smoking is actually heterogeneous, such an estimate is of course
not informative about how much the effect varies across relevant
subpopulations and may not even be consistent for the overall
population mean.
Nevertheless, there have been some attempts in the literature
to capture the heterogeneity of the treatment effect in question.
Most notably, Abrevaya and Dahl (2008) estimated the effect of
smoking separately for various quantiles of the birth weight distribution. Though insightful, a drawback of the quantile regression approach is that it allows for heterogeneity in the treatment

Journal of Business & Economic Statistics, October 2015

effect across subpopulations that are not identifiable based on the
mother’s characteristics alone. Hence, the estimated effects are
hard to translate into targeted “policy” recommendations. For
instance, Abrevaya and Dahl (2008) reported that the negative
effect of smoking on birth weight is more pronounced at the median of the birth weight distribution than at the 90th percentile.
However, it is not clear, before actual birth, or at least without
additional modeling, which quantile should be “assigned” to a
mother with a given set of observable characteristics. In addition, the treatment effect for any given quantile could also be
a function of these characteristics (this is assumed away by the
linear specification they use). In contrast, the CATE parameter
is defined as a function of variables that are observable a priori, and the estimator proposed in this article places only mild
restrictions on the shape of this function.
Qualitatively, the main story that emerges from our empirical
exercise is that the predicted average effect of smoking becomes
stronger (more negative) at higher age. This finding is reasonably robust with respect to race, smoothing parameters, and the
specification of the propensity score. Nevertheless, there is a
fair amount of specification and estimation uncertainty about
the numerical extent of this variation.
The rest of the article is organized as follows. Section 2 introduces the CATE parameter and discusses its identification and
estimation. The first-order asymptotic properties of the proposed
estimators are developed. Section 3 presents the simulation results, and Section 4 is devoted to the empirical exercise. Section
5 outlines possible extensions of the basic framework, including multivalued treatments and instrumental variables. Section
6 concludes.
2.

THEORY

2.1 The Formal Framework and the Proposed
Estimators
Let D be a dummy variable indicating treatment status in a
population of interest with D = 1 if an individual (unit) receives
treatment and D = 0 otherwise. Define Y (1) as the potential
outcome for an individual if treatment is imposed exogenously;
Y (0) is the corresponding potential outcome without treatment.
Let X be a k-dimensional vector of covariates with k ≥ 2. The
econometrician observes D, X, and Y ≡ D · Y (1) + (1 − D) ·
Y (0). In particular, we make the following assumption.
Assumption 1 (Sampling). The data, denoted {(Di ,
Xi , Yi )}ni=1 , is a random sample of size n from the joint distribution of the vector (D, X, Y ).
Throughout the article we maintain the assumption that the
observed vector X can fully control for any endogeneity in treatment choice. Stated formally:

Assumption 2 (Unconfoundedness). (Y (0), Y (1)) ⊥ D X.
Assumption 2 is also known as (strongly) “ignorable treatment assignment” (Rosenbaum and Rubin 1983), and it is a
rather strong but standard identifying assumption in the treatment effect literature. In particular, it rules out the existence
of unobserved factors that affect treatment choice and are also
correlated with the potential outcomes.

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

Let X1 ∈ R be a subvector of X ∈ Rk , 1 ≤  < k, X absolutely continuous. The conditional average treatment effect
(CATE) given X1 = x1 is defined as
τ (x1 ) ≡ E[Y (1) − Y (0)|X1 = x1 ].
Under Assumption 2, τ (x1 ) can be identified from the joint
distribution of (X, D, Y ) as
τ (x1 ) = E[E[Y |D = 1, X] − E[Y |D = 0, X]| X1 = x1 ] (1)
or
τ (x1 ) = E





(1 − D)Y 
DY
X
−
=
x
1
1 ,
p(X)
1 − p(X) 

487

potential outcomes is a linear function. As noted by Imbens and
Wooldridge (2009), the treatment effect literature has gradually
moved away from this baseline model over the last 10–15 years.
The main reason is that the estimated average treatment effect
can be severely biased if the linear functional form is not correct.
Nevertheless, as the general CATE parameter introduced in this
article has not yet been in use in the treatment effect literature, it
is useful to develop further intuition by relating it to a standard
linear regression framework.
Given the vector X of covariates, we can, without loss of
generality, write

(2)

where p(x) = P [D = 1|X = x] denotes the propensity score
function. These identification results follow from a simple string
of equalities justified by the law of iterated expectations and unconfoundedness. While Equation (1) identifies CATE somewhat
more intuitively, we will base our estimators on Equation (2).
In particular, we propose the following procedure for estimating τ (x1 ). The first step consists of estimating the propensity
score. We consider two options. Option (i) is a nonparametric estimator given by a kernel-based (Nadaraya-Watson) regression,
that is,
 Xi −x 
1 n
i=1 Di K
nhk
p̂(x) = 1 n
(3)
 Xi −xh  ,
K
i=1
h
nhk
where K(·) is a kernel function and h is a smoothing parameter (bandwidth). Option (ii) is a parametric estimate of p(x),
for example, a logit or probit model estimated by maximum
likelihood.
Given an estimator p̂(x) for the propensity score, in the second
stage we estimate τ (x1 ) by inverse probability weighting and
kernel-based local averaging, that is, we propose



Di Y i
1 n
i )Yi
1
K1 X1ih−x
− (1−D

i=1
1−p̂(Xi )
p̂(Xi )
nh1
1
τ̂ (x1 ) =
,
 X1i −x1 
1 n
i=1 K1
h1
nh
1

where K1 (u) is a kernel function and h1 is a bandwidth (different
from K and h). As in the second stage p̂(x) is evaluated at the
sample observations Xi , in the nonparametric case we employ
the “leave-one-out” version of (3).
As far as econometric theory is concerned, it is the development of the asymptotics of the fully nonparametric case that is
the central contribution of this article. Though the asymptotics
are less novel and challenging, the semiparametric estimator is
easier to implement and a more robust practical alternative (at
the cost of potential misspecification bias and loss of efficiency).
Even though we work out the asymptotic theory of τ̂ (x1 ) for
any  < k, in our assessment the most relevant case in practice
is  = 1 (and maybe  = 2). When X1 is a scalar, τ̂ (x1 ) can
easily be displayed as a two-dimensional graph while for higher
dimensional X1 the presentation and interpretation of the CATE
estimator can become rather cumbersome.
2.2 CATE in a Linear Regression Framework
The standard linear regression model for program evaluation
combines a weaker version of the unconfoundedness assumption with the assumption that the conditional expectation of the

E[Y (d) | X] = μd + rd (X),

d = 0, 1,

where μd = E[Y (d)] and rd (·) is some function with
E[rd (X)] = 0. Under the unconfoundedness assumption, the
mean of the observed outcome conditional on D and X can be
represented as
E(Y | X, D) = μ0 + (μ1 − μ0 )D + r0 (X)
+[r1 (X) − r0 (X)]D.

(4)

If one assumes r0 (X) = [X − E(X)] β and r1 (X) = [X −
E(X)] (β + δ), then CATE(X1 ) is given by
CATE(X1 ) = μ1 − μ0 + E[(X − E(X)) | X1 ]δ.
Further assuming that the above conditional expectation w.r.t.
X1 is a linear function of X1 gives rise to a three-step parametric
estimator of CATE. The first step consists of regressing Y on a
constant, D, X and D · (X − X̄); specifically, we write
Yi = κ̂ + α̂Di + Xi β̂ + Di (Xi − X̄) δ̂ + ˆi ,

i = 1, . . . , n.
(5)
The second step consists of regressing each component of X −
X̄ on a constant and X1 :

γ̂ (j ) + ûi ,
Xi − X̄(j ) = X̃1i
(j )

(j )

i = 1, . . . , n, j = 1, . . . , k,
(6)
where X̃1 ≡ (1, X1 ) , and X(j ) and X̄(j ) denote the jth component of X and X̄, respectively. Finally, for X1 = x1 , one takes
α̂ + (x̃1 γ̂ )δ̂

(7)

as an estimate of CATE(x1 ), where γ̂ ≡ (γ̂ , . . . , γ̂ ) is an
( + 1) × k matrix.
The special case in which δ = 0, that is, r0 (X) = r1 (X), corresponds to assuming that individual treatment effects do not
systematically depend on X. Accordingly, CATE reduces to a
constant function whose value is equal to ATE= μ1 − μ0 everywhere, and ATE itself can be estimated as the coefficient on
D from regression (5) without the interaction terms.
Though it requires entirely standard methods, calculating the
standard error of (7) is somewhat cumbersome. Specifically,
one can write the k + 1 regressions in (5) and (6) as a SUR
system (see, e.g., Wooldridge 2010, Ch. 7) and estimate the
joint variance-covariance matrix of all regression coefficients.
Then one can invoke the multivariate delta method to obtain
the standard error of (7) for any given x1 . The construction
is described in detail in Appendix A. Alternatively, one could
resample from the empirical distribution of the residuals and
compute bootstrapped standard errors.
(1)

(k)

488

Journal of Business & Economic Statistics, October 2015

2.3 Asymptotic Properties of τ̂(x1 ): The Fully
Nonparametric Case

The following theorem states our main theoretical result. The
proof is given in Appendices B and C.

In the fully nonparametric case we estimate the propensity
score by a kernel-based nonparametric regression:

Theorem 1. Suppose that Assumptions 1 through 8 are satisfied. Then, for each point x1 in the support of X1 ,

Assumption 3 (Estimated propensity score). p̂(Xi ) is given
by the leave-i-out version of the estimator in (3).

(a)

We derive the asymptotic properties of the resulting CATE
estimator under the following regularity conditions.
Assumption 4 (Distribution of X). The support X of the kdimensional covariate X is a Cartesian product of compact intervals, and the density of X, f (x), is bounded away from 0 on
X.
Let s and s1 denote positive even integers such that s ≥ k and
s1 ≥ k.
Assumption 5 (Conditional moments and smoothness). (i)
supx∈X E[Y (j )2 | X = x] < ∞ for j = 0, 1; (ii) the functions
mj (x) = E[Y (j ) | X = x], j = 0, 1 and f (x) are s-times continuously differentiable on X .
Assumption 6 (Population propensity score). (i) p(x) is
bounded away from 0 and 1 on X ; (ii) p(x) is s-times continuously differentiable on X .
A function κ : Rk → R is a kernel of order s if it integrates to
p
p
one over Rk , and u1 1 · . . . · uk k κ(u)du
 = 0 for all nonnegative
integers p1 , . . . , pk such that 1 ≤ i pi < s.
Assumption 7 (Kernels).
(i) K(u) is a kernel of order s, is symmetric around zero, is
equal to zero outside ki=1 [−1, 1], and is continuously
differentiable.
(ii) K1 (u) is a kernel of order s1 , is symmetric around zero,
and is s times continuously differentiable.
Assumption 8 (Bandwidths). The bandwidths h and h1 satisfy
the following conditions as n → ∞:
(i) h → 0 and log(n)/(nhk+s ) → 0.
1 +
→ 0 and nh1 → ∞.
(ii) nh2s
1
2s −2s−
→ 0 and nh1 h2s → 0.
(iii) h h1
Define the function ψ(x, y, d) as
ψ(x, y, d) ≡

d(y − m1 (x)) (1 − d)(y − m0 (x))
−
p(x)
1 − p(x)
+m1 (x) − m0 (x).

(b)

n

1
− τ (x1 )) =
[ψ(Xi , Yi , Di )
f
(x
nh1 1 1 ) i=1


X1i −x1
−τ (x1 )]K1
+op (1)
h1


2 2
K
σ
(x
)
1
1
d
ψ
2
nh1 (τ̂ (x1 ) − τ (x1 )) → N 0,
,
f1 (x1 )
nh1 (τ̂ (x1 )

1

where f1 (x1 ) is the pdf of X1 , K1

2

≡ ( K1 (u)2 du)1/2 , and

σψ2 (x1 ) ≡ E[(ψ(X, Y, D) − τ (x1 ))2 |X1 = x1 ].
Comments
1. The technical restrictions imposed on the distribution of X
and on various conditional moment functions in Assumptions
4 and 5 are analogous to those in Hirano, Imbens, and Ridder
(2003) and are common in the literature on nonparametric
estimation. As pointed out by Khan and Tamer (2010), the
assumption that the propensity score is bounded away from
zero and one plays an important role in determining the
convergence rate of inverse probability weighted estimators.
2. Assumptions 7(i) and 8(i) ensure that p̂(x) − p(x) =
op (hs/2 ), uniformly in x; see Lemma 6.1 part (b) in Appendix B. This is the convergence rate needed to establish
the influence function representation in Theorem 1(a). The
influence function itself is analogous to the influence function
that efficient nonparametric estimators of ATE possess; see,
for example, Hahn (1998) and Hirano, Imbens, and Ridder
(2003).

1
3. The influence function [ψ(Xi , Yi , Di ) − τ (x1 )]K1 X1ih−x
1
does not have mean zero; rather, it decomposes into a “bias
term” that depends on h1 and a mean zero term to which
Lyapunov’s CLT directly applies. Assumptions 7(ii) and 8(ii)
ensure the asymptotic negligibility of the bias term (and the
applicability of the CLT). See Appendix C for further details.
4. Assumption 8(iii) underlies the novel aspects of our asymptotic theory. It controls the relative and “joint” convergence
rates of h (the bandwidth used to estimate the propensity
score) and h1 (the bandwidth used in the integration step).
These rates, along with the kernel orders, are chosen subject
to numerous tradeoffs that need to be considered to ensure
the asymptotic negligibility of all remainder terms in our
expansion of τ̂ (x1 ).
5. More specifically, our asymptotic analysis builds on the expansion of the Hirano, Imbens, and Ridder (2003) ATE estimator by Ichimura and Linton (2005). However, the integration step causes the factor K1 (·/ h1 ) to appear in each
term, which has a number of consequences. First, the leading
terms in the expansion converge at the rate of nh1 rather
√
than n. Second, as the convergence rates of the original
remainder terms depend on h, the presence of K1 and the

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

scaling by nh1 introduce interactions between h and h1 .
These interactions require that h1 converges to zero slower
than h. In particular, if one were to set h1 equal to a constant,
then all remainder terms could be made to vanish by requiring h → 0 at an appropriate rate as in Ichimura and Linton
(2005) or Donald, Hsu, and Lieli (2014b). However, the bias
in the leading term, described in comment 3 above, would
of course not disappear. Hence, one also needs h1 → 0, but
slowly enough to satisfy part two of Assumption 8(ii) and
part one of 8(iii). One can then employ a kernel K1 of sufficiently high order to satisfy the first part of Assumption
8(ii), and a kernel K of sufficiently high order to satisfy part
two of Assumption 8(iii), which is needed to ensure that the
(conditional) bias of p̂(x) remains asymptotically negligible
when scaled by nh1 . Note, however, that increasing s, the
order of K, is not costless—it slows the convergence of h to
zero via Assumption 8(i), which then slows the convergence
of h1 to zero via the first part of 8(iii), which again requires
an increase in s1 and possibly s, etc.
6. We have yet to show that there actually exist bandwidth
sequences and kernel orders satisfying all the requirements
posed by Assumption 8 (otherwise the asymptotic theory
would be vacuous). We set
−1

h = a · n k+s+δ ,
h1 = a1 · n

−1
+2s1 −δ1

a > 0, δ > 0,
,

a1 > 0, δ1 > 0,

where δ and δ1 can be made as small as necessary or desired. It
is clear that Assumptions 8(i) and (ii) hold with these choices.
To satisfy Assumption 8(iii), we further set the kernel orders
as s = k for k even, s = k + 1 for k odd, and s1 = s + 2.
→ 0, note that δ and δ1 can be arbiTo verify h2s h−2s−
1
trarily small, so it is sufficient to check

489

nontreated subpopulations, respectively. Then, we estimate
σψ2 (x1 ) by

σ̂ψ2 (x1 )

ψ̂(x, y, d) =

−s
s+2
+
< 0,
k+s
2s + 4 + 
which is obvious because −s/(k + s) < −1/2 and (s +
2)/(2s + 4 + ) < 1/2 under our selections.
7. To use Theorem 1 for statistical inference, one needs to consistently estimate σψ2 (x1 ) and f1 (x1 ). The latter is easily ac
complished by, say, fˆ1 (x1 ) = nh1  ni=1 K1 [(X1i − x1 )/h1 ].

n

1
(ψ̂(Xi , Yi , Di ) − τ̂ (x1 ))2
nh1 i=1

 
X1i − x1
fˆ1 (x1 ),
K1
h1

(8)

d(y − m̂1 (x)) (1 − d)(y − m̂0 (x))
−
p̂(x)
1 − p̂(x)
+ m̂1 (x) − m̂0 (x).

The consistency of σ̂ψ2 (x1 ) can be shown as follows. First,
let σ̃ψ2 (x1 ) be the (infeasible) estimator for σψ2 (x1 ) where we
replace ψ̂(Xi , Yi , Di ) − τ̂ (x1 ) with ψ(Xi , Yi , Di ) − τ (x1 ) in
(8). It is easy to see that σ̃ψ2 (x1 ) is a consistent estimator for
σψ2 (x1 ). Next, note that ψ̂(x, y, d) is a uniformly consistent
estimator for ψ(x, y, d) and τ̂ (x1 ) is a consistent estimator
for τ (x1 ). Therefore, using ψ̂(Xi , Yi , Di ) − τ̂ (x1 ) in (8) is
as good as ψ(Xi , Yi , Di ) − τ (x1 ) in that the estimation error
will disappear in the limit.
8. Assumption 4 does not allow X to have discrete components,
which is of course restrictive in applications. One way to
incorporate discrete covariates into the analysis is as follows. For concreteness, suppose that in addition to some
continuous variables, X contains gender. Let M denote the
indicator of the male subpopulation and define p(x, m) =
P (D = 1 | X = x, M = m) for m = 0, 1. We can estimate
these functions by kernel based regressions of D on X in each
subsample:


2s + 
−2s
+
< 0.
k+s
2s + 4 + 
This is obviously true because −2s/(k + s) < −1 and (2s +
)/(2s + 4 + ) < 1 under our selections.
To verify nh1 h2s → 0, note that by Assumption 8(ii),
1 +
1
1
· h2s h−2s
→ 0 when hs h−s
→ 0, so it is
nh1 h2s = nh2s
1
1
1
sufficient to check the latter. Again, since δ and δ1 can be
arbitrarily small, we only need

=

p̂(x, 1) =

Xi −x
1 
{i:Mi =1} Di K
h
nhk



Xi −x
1
K
k
{i:Mi =1}
h
nh



=





Xi −x
1 n
i Mi D i K
h
nhk



n
Xi −x
1
M
K
i
k
i=1
h
nh

,

and p̂(x, 0) is obtained analogously. We claim that τ (x) can
be estimated by

τ̂ (x) =

1
nh1

n 
i=1

Di Y i
i )Yi
− 1−(1−D
p̂(Xi ,Mi )
p̂(Xi ,Mi )
 X1i −x1 
1 n
i=1 K1
h1
nh1

K1

 X1i −x1 
h1

. (9)

In particular, as we show in Appendix D, the following influence function representation applies to τ̂ (x1 ):

1

It is more involved to estimate σψ2 (x1 ) because ψ includes
unknown functions: m1 (x), m0 (x), and p(x). Let m̂1 (x) be
a uniformly consistent estimator for m1 (x) over X in that
supx∈X |m̂1 (x) − m1 (x)| = op (1). Similarly, let m̂0 (x) and
p̂(x) be uniformly consistent estimators for m0 (x) and p(x)
over X . In particular, the p̂(x) we use is uniformly consistent for p(x). Also, such m̂1 (x) and m̂0 (x) can be obtained
by performing kernel regressions of Y on X in the treated and

nh1 (τ̂ (x1 ) − τ (x1 ))
=

1

n

[ψ(Mi , Xi , Yi , Di ) − τ (x1 )]
f1 (x1 ) nh1 i=1


X1i − x1
+ op (1),
(10)
×K1
h1

490

Journal of Business & Economic Statistics, October 2015

where

where f1 (x1 ) is the pdf of X1 , K1

ψ(Mi , Xi , Yi , Di ) ≡

Di (Yi − m(Xi , Mi ))
p(Xi , Mi )
−

(1 − Di )(Yi − m0 (Xi , Mi ))
1 − p(Xi , Mi )

+ m1 (Xi , Mi ) − m0 (Xi , Mi ),
and mj (x, m) ≡ E[Y (j )|X = x, M = m] for j = 0, 1 and
m = 0, 1. Therefore, Theorem 1 continues to hold for (9)
after replacing ψ(Xi , Yi , Di ) with ψ(Mi , Xi , Yi , Di ).
9. Kernels satisfying Assumption 7 can be constructed by taking products of higher order univariate kernels. A general
method for obtaining higher order kernels from “regular”
ones is described, for example, by Imbens and Ridder (2009).
The “support” condition imposed on K is for expositional
convenience only; we can extend the proof of Theorem 1 to
kernels with exponential tails.
2.4 Asymptotic Properties of τ̂(x1 ): The Semiparametric
Case
The asymptotic theory of estimating CATE simplifies considerably if a parametric model is postulated for the propensity
score. In particular, we replace Assumption 3 with the following.
Assumption 9 (Parametric propensity score estimator). The
estimator θ̂n of the propensity score model p(x; θ ), θ ∈ ⊂
Rd , d < ∞, satisfies supx∈X |p(x; θ̂n ) − p(x; θ0 )| = Op (n−1/2 )
where θ0 ∈ such that p(x) = p(x; θ0 ) for all x ∈ X .
Assumption 9 will typically hold for standard parametric estimation methods under reasonably mild regularity conditions.
For example, a logit model or a probit model based on a linear
index and estimated by maximum likelihood will satisfy (9) if
X is bounded. Obviously, Assumption 9 eliminates the need for
those conditions stated in Section 2.3 whose role is to govern the
behavior of the Nadaraya–Watson regression estimator and the
interaction between the two bandwidths. Of course, the bandwidth h1 used in the second, local averaging, stage still needs to
be controlled to ensure consistency and asymptotic normality.
Assumption 8(ii) with any s1 ≥ 2 is sufficient in this regard.
To state the result formally, define
ψθ (x, y, d) ≡

(1 − d)y
dy
−
.
p(x) 1 − p(x)

2

≡ ( K1 (u)2 du)1/2 , and

σψ2θ (x1 ) ≡ E[(ψθ (X, Y, D) − τ (x1 ))2 |X1 = x1 ].
The proof of Theorem 2 is given in Appendix E.
Comments
1. The form of the influence function highlights an important
difference between estimating ATE and CATE. If ATE
√ is
estimated by inverse probability weighting, then even a nconsistent parametric estimate of the propensity score will
make a nontrivial contribution to the influence function (since
the ATE estimator itself converges at the same rate). In contrast,
the CATE estimator converges at a rate slower than
√
n, so employing a (correctly specified) parametric estimator is asymptotically equivalent to the propensity score being
known.
2. The semiparametric approach offers several practical advantages over the fully nonparametric estimator: (i) It can help
circumvent the curse of dimensionality problem when X is
large. (ii) Discrete and continuous covariates can be treated
the same way, that is, one can simply include, say, a gender
dummy in a logit or probit regression rather than follow the
partitioning approach described in comment 8 after Theorem 1. This is very useful if one of the categories has a small
number of observations. (iii) Only the bandwidth used in the
integration step needs to be chosen.
3. Of course, the advantages listed above do not come without
costs. While the semparametric approach is still reasonably
flexible, misspecification of the score function will generally
bias the resulting CATE estimates. Furthermore, the semiparametric CATE estimator is less efficient than the nonparametric one. In particular, we can show that

σ 2 (X)
σψ2 (x1 ) = E (m1 (X) − m0 (X) − τ (x1 ))2 + 1
p(X)


2
σ (X) 
X1 = x1 ,
+ 0
1 − p(X) 


m1 (X)
2
2
σψθ (x1 ) = σψ (x1 ) + E p(X)(1 − p(X))
p(X)

2 

m0 (X)
X1 = x1 ,
+
1 − p(X) 

where σd2 (x) = var(Y (d)|X = x) for d = 0 and 1. Hence,
clearly σψ2θ (x1 ) ≥ σψ2 (x1 ). Therefore, for a given choice of
h1 and K1 satisfying the conditions in Theorems 1 and 2,
Theorem 2. Suppose that Assumptions 1, 2, 8(ii), and 9 are
the semiparametric CATE estimator is less efficient. This
satisfied for some s1 ≥ 2. Then, under some additional regularity
result is not surprising given that the influence function of
conditions, the following statements hold for each point x1 in
the semiparametric estimator is the same as if p(x) were
the support of X1 :
known
(see comment 1 above). It is well known from the
n
1
1

work
of
Hahn (1998) and Hirano, Imbens, and Ridder (2003)
nh1 (τ̂ (x1 ) − τ (x1 )) =
[ψθ (Xi , Yi , Di )
(a)
 f1 (x1 )
that
such
estimators of ATE do not attain the semiparametric
nh1
i=1
efficiency
bound constructed with or without the knowledge


X1i − x1
of p(x).
+ op (1)
−τ (x1 )]K1
4. The “additional regularity conditions” mentioned in the theh1


orem are needed to ensure that (i) Lyapunov’s CLT can be
K1 22 σψ2θ (x1 )
d

applied to the leading term (A.17) in the expansion of the
(b)
nh1 (τ̂ (x1 ) − τ (x1 )) → N 0,
,
f1 (x1 )
estimator in Appendix E, and (ii) that the remainder term is
The following theorem corresponds closely to Theorem 1.

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

491

The true CATE function

0.5
0.4

CATE

0.3
0.2
0.1
0
−0.1
−0.2
−0.5 −0.4 −0.3 −0.2 −0.1 0

6

The distribution of p(X) for k=2

2000

0.1 0.2 0.3 0.4 0.5
2.5 x10

The distribution of p(X) for k=4

1800
2

1600
1400

1.5

1200
1000

1

800
600

0.5

400
200

0

0
0.2

0.3

0.4

0.5

0.6

0.7

0.8

0.9

1

0.5 0.55 0.6 0.65 0.7 0.75 0.8 0.85 0.9 0.95 1

Figure 1. The CATE(x1 ) function and the distribution of p(X).

well behaved in that the second factor in (A.18) is Op (1).
A set of primitive sufficient conditions could be obtained by
suitable changes to Assumptions 4, 5, 6, and 7(ii).
5. K1 no longer needs to be a higher order kernel in the semiparametric case, but such kernels could still be used in
practice.

3.

MONTE CARLO SIMULATIONS

In this section we present a Monte Carlo exercise aimed at
evaluating the finite sample accuracy of the asymptotic approximations given in Theorems 1 and 2. Part of the design is admittedly artificial in that we set k = dim(X) ∈ {2, 4}, while in
practice justifying the unconfoundedness assumption typically
requires conditioning on a much larger set of covariates. Nevertheless, the setup is rich enough to allow us to make a number
of salient and practically relevant points without taking on an
undue computational burden. We pay particular attention to exploring the sensitivity of the finite sample distribution of τ̂ (x1 )
to the smoothing parameter(s) as first-order asymptotic theory
has virtually no implications about how to choose these parameters in practice. Curse of dimensionality issues in the fully
nonparametric case are already apparent with four covariates.

3.1 The Data-Generating Process and the Exercise
We consider two data-generating processes (DGPs); one with
k = 2 and another with k = 4. In the bivariate case the covariates

X = (X1 , X2 ) are given by
X1 = 1 , X2 = (1 + 2X1 )2 (−1 + X1 )2 + 2 ,
where i ∼ iid unif[−0.5, 0.5], i = 1, 2.
outcomes are defined as
Y (1) = X1 X2 + ν

and

The

potential

Y (0) = 0,

where ν ∼ N (0, 0.252 ) and is independent of (1 , 2 ). These
definitions imply
CATE(x1 ) = x1 (1 + 2x1 )2 (−1 + x1 )2 ,
plotted in the top panel of Figure 1. The propensity score is set
as p(X) = (X1 + X2 ), where (·) is the c.d.f. of the logistic
distribution. The distribution of the random variable p(X1 , X2 )
is shown in the lower left panel of Figure 1.
To investigate the impact of the curse of dimensionality on
our estimator, we also consider the following modification to
the DGP:
X1 = 1 , X2 = 1 + 2X1 + 2 , X3 = 1 + 2X1 + 3 ,
X4 = (−1 + X1 )2 + 4
Y (1) = X1 X2 X3 X4 + ν, Y (0) = 0
p(X) = (.5(X1 + X2 + X3 + X4 )),
where again i ∼ iid unif[−0.5, 0.5], i = 1, 2, 3, 4 and ν ∼
N (0, 0.252 ), independent of the ’s. The distribution of the the
random variable p(X1 , . . . , X4 ) is shown in lower right panel
of Figure 1. These modifications leave the CATE(x1 ) function
unchanged, but make it harder to estimate.

492

We estimate CATE(x1 ), x1 ∈ {−0.4, −0.2, 0, 0.2, 0.4}, for
samples of size n = 500 and n = 5000. The number of Monte
Carlo repetitions is 1000 in the fully nonparametric case and
5000 in the semiparametric case.
√
 1 ) − CATE(x1 )] and S(x1 ) =
Let T (x1 ) = nh1 [CATE(x
 (x1 )). For each x1 , we √
report (the
(T (x1 ) − ET (x1 ))/s.e.(T
Monte Carlo estimate of) the mean of T (x1 )/ nh1 (i.e.,
the raw bias of CATE(x1 )), the standard deviation of T (x1 ),
the estimated standard deviation of T (x1 ), the MSE of
T (x1 ), the probability that S(x1 ) exceeds 1.645 and 1.96,
respectively, and the probability that S(x1 ) is below −1.645
and −1.96, respectively.
We implement the fully nonparametric and semiparametric
version of the estimator for various choices of the bandwidths h
and h1 . Motivated by Comment 6 after Theorem 1, for k = 2 we
set s = 2, s1 = 4, h = an−1/4 for a ∈ {0.5, 0.167, 1.5} and h1 =
a1 n−1/9 for a1 ∈ {0.2, 0.067, 0.6}. For k = 4, the corresponding
choices are s = 4, s1 = 6, h = an−1/8 for a ∈ {0.5, 0.167, 1.5}
and h1 = a1 n−1/13 for a1 ∈ {0.2, 0.067, 0.6}. We will refer to the
choices a = 0.5 and a1 = 0.2 as “baseline;” these values were
calibrated to ensure that for n = 5000 the actual distribution of
τ̂ (x1 ) is reasonably close to its theoretical limit for most of the
five points considered, as measured by the statistics listed above.
We then vary h and/or h1 (by tripling and/or thirding a and a1 ) to
illustrate how oversmoothing or undersmoothing relative to this
crude baseline affects the quality of the inferences drawn from
the asymptotic results given in Theorems 1 and 2. Note that in
specifying h and h1 as above, we ignore the (small) positive
constants δ and δ1 and simply set them to zero.
Regarding further computational details, we use a normal
kernel (and higher order kernels derived from it) throughout. In
computing the variance of τ̂ (x1 ), we use the bandwidth h and
a regular kernel to estimate the functions m0 and m1 (in the
fully nonparametric case); the bandwidth h1 and the kernel K1
to estimate f1 (x1 ), and the bandwidth h1 and a regular kernel
to estimate σψ2 (x1 ) and σψ2θ (x1 ). The estimated propensity score
is trimmed to lie in the interval [0.005, 0.995]. This constraint
affects the fully nonparametric estimator for n = 500, but it is
basically inconsequential for the semiparametric estimator or in
larger samples.
There are other relevant issues we do not investigate here in
detail due to constraints on space and scope. One is the sensitivity of our asymptotic approximations to the propensity score
approaching zero or one with high probability. Based on results, both theoretical (Khan and Tamer 2010) and experimental
(Huber et al. 2012; Donald, Hsu, and Lieli 2014a), we expect
the asymptotic distributions given in Theorems 1 and 2 to be
worse small sample approximations in this case. Another issue
not addressed by the simulations is the sensitivity of the semiparametric estimator to the misspecification of the propensity
score model. Nevertheless, the empirical exercise presented in
Section 4 will provide an illustration of the possible impact and
handling of these problems in practice.

3.2 Simulation Results
We highlight several aspects of the simulation results reported
in Tables 1 through 3.

Journal of Business & Economic Statistics, October 2015

First, as seen in Panel 1 of Tables 1 and 2, the distribution
of the fully nonparametric estimator for n = 5000 is reasonably close to its theoretical limit under the baseline bandwidth
choices, and the studentized estimator leads to reliable inferences without major size distortions. In fact, for k = 2 the
asymptotic theory seems to work well even for n = 500, but
for k = 4 there is a significant improvement in the approximations as one goes from n = 500 to n = 5000. In particular, there
is a marked reduction in the bias of the estimator at most points
x1 , as well as the bias of the estimated standard error. More
generally, comparing Tables 1 and 2 across panels provides evidence on the curse of dimensionality—for a given sample size,
CATE(x1 ) can be estimated much less precisely in terms of MSE
when the dimensionality of X is larger, and the asymptotic approximation captures finite sample properties to a much lesser
degree. (As explained in the previous section, the bandwidths
across the two tables are adjusted for the change in the dimensionality of X by adjusting the exponent of n but not the scaling
factor.) Viewed somewhat differently, for k = 2, results tend to
change much less across the two sample sizes, while for k = 4,
asymptotic theory generally starts “kicking in” much slower.
Second, as can be expected, the bias of τ̂ (x1 ) is generally
larger if x1 is close to the boundary of the support of X1 . (Moreover, boundary bias is often accompanied by evidence of skewness.) Bias can be a result of oversmoothing with a large h1
(compare, e.g., Panels 1 and 3 in Tables 1 and 2) or undersmoothing with a small h (compare Panels 1 and 4 in Table 1
and especially Table 2). Choosing h too small for the sample
size has the additional effect of causing severe bias in the estimated standard errors, which, in turn, can throw the p-values
of S(x1 ) completely off. Oversmoothing with h1 also biases the
standard errors, but this problem seems much milder in comparison. Nevertheless, biased standard errors do not always lead to
bad inference. For example, as seen in Panel 1 of Table 2, for
n = 5000 the estimated standard errors are still biased downward at points close to the boundary (x1 = −0.4 and x1 = 0.4),
but the p-values of the studentized estimator are very close to
their nominal levels. This suggests that the observed s.e. of
T (±0.4) is blown up by just a few outlier estimates.
Third, while Assumption 8(iii) implies that the ratio h/ h1
should go to zero as n → ∞, the results described in the previous paragraph caution against necessarily imposing h << h1
in practice. Panel 6 in Tables 1 and 2 contains results for h
small and h1 large. As expected, there is severe bias in both the
estimator and the standard errors, and inference is misleading
(especially for k = 4). In contrast, if one takes the opposite extreme, that is, oversmooths with h and undersmooths with h1 ,
as shown in Panel 7 of Tables 1 and 2, the asymptotic theory
delivers very nice approximations even for n = 500 and k = 4
and despite the fact that h/ h1 is very large. This does not mean
that the asymptotics are invalid; it just means, as usual, that
first-order asymptotic theory has little to say about how to pick
the smoothing parameters in finite samples.
The observation that oversmoothing the propensity score estimate can be beneficial in finite samples leads naturally to
considering the semiparametric version of the estimator. The
results are displayed in Table 3.
Our fourth observation then is that the asymptotic normal
approximation for the semiparametric estimator performs well

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

Table 1. The distribution of

√

493

nh1 [τ̂ (x1 ) − τ (x1 )]: the fully nonparametric case with k = 2

n = 500
x1
Panel 1
−0.4
0.2
0
0.2
0.4
Panel 2
−0.4
−0.2
0
0.2
0.4
Panel 3
−0.4
−0.2
0
0.2
0.4
Panel 4
−0.4
−0.2
0
0.2
0.4
Panel 5
−0.4
−0.2
0
0.2
0.4
Panel 6
−0.4
−0.2
0
0.2
0.4
Panel 7
−0.4
−0.2
0
0.2
0.4

Mean
√
nh1

s.e.

E(s.e.)


MSE

p-val. p-val.
1.65 −1.65

n = 5000
p-val
1.96

h = 0.5n−1/4 = 0.106, h1 = 0.2n−1/9 = 0.100
−0.002 0.337 0.276 0.114 0.074 0.080 0.044
0.002 0.245 0.237 0.061 0.059 0.056 0.030
0.001 0.213 0.218 0.046 0.050 0.044 0.025
0.003 0.209 0.215 0.044 0.043 0.044 0.024
0.001 0.222 0.218 0.049 0.052 0.055 0.027
h = 0.5n−1/4 = 0.106, h1 = 0.067n−1/9 = 0.034
0.002 0.324 0.275 0.105 0.074 0.078 0.043
−0.001 0.246 0.233 0.060 0.063 0.060 0.035
−0.000 0.213 0.206 0.045 0.056 0.054 0.030
0.001 0.213 0.199 0.045 0.063 0.059 0.035
0.007 0.238 0.208 0.057 0.071 0.081 0.041
h = 0.5n−1/4 = 0.106, h1 = 0.6n−1/9 = 0.301
−0.042 0.375 0.308 0.405 0.076 0.075 0.046
0.062 0.257 0.259 0.648 0.048 0.047 0.027
0.064 0.218 0.248 0.660 0.034 0.031 0.015
−0.030 0.232 0.258 0.185 0.033 0.033 0.016
−0.100 0.272 0.305 1.582 0.030 0.034 0.012
h = 0.167n−1/4 = 0.035, h1 = 0.2n−1/9 = 0.100
0.074 2.236 0.315 5.271 0.239 0.504 0.225
−0.018 0.790 0.237 0.640 0.199 0.179 0.160
−0.000 0.330 0.216 0.109 0.090 0.090 0.060
0.013 0.247 0.215 0.070 0.059 0.061 0.035
0.031 0.621 0.224 0.435 0.084 0.142 0.064
h = 1.5n−1/4 = 0.317, h1 = 0.2n−1/9 = 0.100
−0.006 0.273 0.259 0.076 0.059 0.063 0.031
0.006 0.235 0.234 0.057 0.054 0.047 0.027
0.001 0.211 0.221 0.044 0.046 0.038 0.023
0.008 0.218 0.221 0.051 0.047 0.047 0.026
0.014 0.248 0.230 0.071 0.060 0.064 0.031
h = 0.167n−1/4 = 0.035, h1 = 0.6n−1/9 = 0.301
−0.003 2.354 0.323 5.543 0.259 0.480 0.241
0.073 1.096 0.256 2.011 0.239 0.322 0.220
0.066 0.450 0.244 0.856 0.124 0.116 0.093
−0.020 0.396 0.257 0.216 0.087 0.087 0.059
−0.076 0.819 0.311 1.542 0.069 0.118 0.054
h = 1.5n−1/4 = 0.317, h1 = .067n−1/9 = 0.034
−0.001 0.271 0.255 0.073 0.057 0.064 0.029
0.003 0.236 0.233 0.056 0.058 0.048 0.030
−0.000 0.210 0.210 0.044 0.052 0.043 0.029
0.006 0.220 0.204 0.049 0.065 0.061 0.035
0.021 0.252 0.222 0.071 0.066 0.084 0.037

p-val
−1.96
0.047
0.026
0.022
0.019
0.029
0.045
0.030
0.025
0.031
0.042
0.045
0.022
0.012
0.016
0.017
0.466
0.142
0.056
0.033
0.090
0.035
0.024
0.018
0.021
0.038
0.442
0.276
0.085
0.055
0.068
0.034
0.024
0.021
0.034
0.045

with a fairly wide range of bandwidths, but small choices of
h1 seem to work particular well. Results for the baseline h1
are shown in Table 3, Panel 1 (k = 2) and Panel 4 (k = 4). In
both cases, bias is minimal (even for n = 500) and the p-values
are acceptable (though there are some instances where they are
somewhat below their nominal levels). When one triples h1
relative to baseline (Panels 3 and 6), bias starts creeping into
both the estimator and the standard errors, and the p-values
become somewhat attenuated. In contrast, as shown by Panels
2 and 5, cutting h1 by a factor of three yields a textbook-perfect
approximation for n = 5000. In fact, additional experimentation
shows that making h1 an order of magnitude smaller still works
very well.

Mean
√
nh1

s.e.

E(s.e.)


MSE

p-val. p-val.
1.65 −1.65

p-val
1.96

h = 0.5n−1/4 = 0.059, h1 = 0.2n−1/9 = 0.078
−0.000 0.277 0.275 0.077 0.051 0.053 0.026
0.001 0.235 0.235 0.056 0.052 0.050 0.025
0.000 0.205 0.211 0.042 0.047 0.044 0.023
0.000 0.202 0.209 0.041 0.042 0.043 0.021
0.000 0.210 0.209 0.044 0.048 0.052 0.025
h = 0.5n−1/4 = 0.059, h1 = 0.067n−1/9 = 0.026
0.000 0.287 0.280 0.082 0.052 0.059 0.027
−0.000 0.240 0.233 0.057 0.058 0.055 0.030
−0.000 0.204 0.204 0.042 0.051 0.047 0.025
0.000 0.208 0.198 0.043 0.058 0.062 0.031
0.001 0.235 0.207 0.056 0.074 0.072 0.043
h = 0.5n−1/4 = 0.059, h1 = 0.6n−1/9 = 0.233
−0.038 0.325 0.299 1.746 0.067 0.066 0.037
0.033 0.235 0.248 1.344 0.042 0.038 0.021
0.038 0.209 0.242 1.743 0.025 0.033 0.009
−0.007 0.217 0.245 0.099 0.027 0.030 0.012
−0.059 0.258 0.280 4.096 0.036 0.037 0.014
h = 0.167n−1/4 = 0.020, h1 = 0.2n−1/9 = 0.078
0.002 0.334 0.275 0.113 0.080 0.081 0.050
−0.002 0.251 0.235 0.065 0.063 0.059 0.034
0.000 0.210 0.211 0.044 0.052 0.047 0.025
0.003 0.203 0.209 0.044 0.046 0.041 0.021
0.003 0.211 0.208 0.049 0.047 0.053 0.026
h = 1.5n−1/4 = 0.178, h1 = 0.2n−1/9 = 0.078
−0.001 0.268 0.266 0.072 0.051 0.056 0.026
0.002 0.237 0.236 0.057 0.054 0.047 0.025
0.000 0.204 0.213 0.042 0.044 0.043 0.022
0.002 0.210 0.210 0.045 0.046 0.052 0.023
0.007 0.228 0.213 0.069 0.058 0.063 0.034
h = 0.167n−1/4 = 0.020, h1 = 0.6n−1/9 = 0.233
−0.037 0.421 0.299 1.771 0.103 0.104 0.070
0.032 0.259 0.247 1.263 0.059 0.055 0.033
0.038 0.215 0.241 1.725 0.029 0.036 0.011
−0.005 0.220 0.245 0.074 0.030 0.031 0.013
−0.056 0.265 0.280 3.676 0.037 0.041 0.017
h = 1.5n−1/4 = 0.178, h1 = .067n−1/9 = 0.026
−0.000 0.276 0.270 0.076 0.052 0.057 0.027
0.001 0.241 0.235 0.058 0.058 0.054 0.028
−0.000 0.203 0.206 0.041 0.049 0.046 0.023
0.001 0.214 0.199 0.046 0.063 0.070 0.034
0.008 0.251 0.212 0.071 0.081 0.082 0.049

p-val
−1.96
0.028
0.025
0.022
0.024
0.027
0.029
0.028
0.026
0.033
0.040
0.036
0.019
0.013
0.012
0.017
0.051
0.034
0.025
0.024
0.026
0.029
0.026
0.020
0.025
0.033
0.065
0.027
0.015
0.014
0.017
0.030
0.028
0.023
0.035
0.049

Fifth, as stated in Comment 3 after Theorem 2, theory predicts
that for a given choice of h1 and K1 , the asymptotic variance of
the fully nonparametric CATE estimator is smaller than that of
the semiparametric one. Comparing the results in Tables 1 versus
3 and Tables 2 versus 3 shows that in finite samples the efficiency
ranking can go either way, depending also on the choice of h.
Take, for example, k = 2 and n = 5000 with the baseline choice
of h1 (i.e., h1 = 0.078). Though the differences are rather small,
in this case the standard error of the nonparametric estimator is
indeed smaller than that of the semiparametric estimator almost
uniformly in h and x1 (compare Panel 1 of Table 3 with Panels
1, 4 and 5 of Table 1). Exceptions arise only when the nonparametric estimator undersmooths the propensity score (Panel 4 of

494

Journal of Business & Economic Statistics, October 2015

Table 2. The distribution of

√

nh1 [τ̂ (x1 ) − τ (x1 )]: the fully nonparametric case with k = 4

n = 500
x1
Panel 1
−0.4
−0.2
0
0.2
0.4
Panel 2
−0.4
−0.2
0
0.2
0.4
Panel 3
−0.4
−0.2
0
0.2
0.4
Panel 4
−0.4
−0.2
0
0.2
0.4
Panel 5
−0.4
−0.2
0
0.2
0.4
Panel 6
−0.4
−0.2
0
0.2
0.4
Panel 7
−0.4
−0.2
0
0.2
0.4

Mean
√
nh1

s.e.

E(s.e.)


MSE

n = 5000

p-val. p-val. p-val p-val
1.65 −1.65 1.96 −1.96

h = 0.5n−1/8 = 0.230, h1 = 0.2n−1/13 = 0.124
−0.006 3.050 1.141
9.305 0.133 0.136 0.089
−0.035 1.862 0.837
3.543 0.159 0.059 0.099
−0.002 1.430 0.653
2.044 0.059 0.047 0.035
0.031 1.704 0.646
2.962 0.042 0.108 0.035
0.095 4.155 0.873
17.82 0.062 0.458 0.057
h = 0.5n−1/8 = 0.230, h1 = 0.067n−1/13 = 0.042
−0.010 2.671 0.999
7.139 0.076 0.057 0.043
−0.039 1.798 0.603
3.266 0.147 0.040 0.093
0.004 1.468 0.493
2.157 0.050 0.064 0.029
0.032 1.648 0.437
2.738 0.032 0.118 0.023
0.075 3.601 0.802
13.08 0.028 0.193 0.021
h = 0.5n−1/8 = 0.230, h1 = 0.6n−1/13 = 0.372
−0.077 3.432 1.289
12.87 0.211 0.158 0.157
0.040 1.997 1.026
4.290 0.153 0.107 0.093
0.067 1.448 0.934
2.926 0.063 0.064 0.042
0.007 2.253 0.955
5.086 0.086 0.188 0.075
−0.018 4.578 1.145
21.02 0.081 0.378 0.074
h = 0.167n−1/8 = 0.077, h1 = 0.2n−1/13 = 0.124
−0.612 14.03 2.266 219.9
0.427 0.397 0.410
−1.805 13.57 2.657 386.2
0.409 0.347 0.391
0.001 11.52 2.224 132.7
0.387 0.382 0.365
3.089 15.31 3.231 826.0
0.321 0.420 0.290
4.212 23.66 3.962 1659
0.330 0.462 0.308
h = 1.5n−1/8 = 0.690, h1 = 0.2n−1/13 = 0.124
−0.004 0.245 0.247
0.061 0.048 0.047 0.024
−0.001 0.239 0.240
0.057 0.055 0.042 0.025
−0.001 0.228 0.249
0.052 0.040 0.035 0.018
0.004 0.263 0.296
0.070 0.031 0.033 0.014
0.009 0.414 0.390
0.177 0.055 0.065 0.029
h = 0.167n−1/8 = 0.077, h1 = 0.6n−1/13 = 0.372
−1.411 16.92 2.853 656.7
0.412 0.383 0.395
−0.745 13.05 2.166 273.3
0.412 0.387 0.395
0.609 11.97 1.977 212.3
0.388 0.409 0.368
2.252 16.55 2.743 1217
0.369 0.429 0.347
3.666 26.04 4.425 3177
0.346 0.438 0.324
h = 1.5n−1/8 = 0.690, h1 = 0.067n−1/13 = 0.041
−0.001 0.247 0.245
0.061 0.048 0.049 0.025
−0.003 0.244 0.238
0.060 0.060 0.048 0.031
0.000 0.226 0.226
0.051 0.049 0.045 0.026
0.004 0.255 0.253
0.065 0.047 0.048 0.025
0.012 0.424 0.406
0.183 0.052 0.063 0.026

Mean
√
nh1

0.094 −0.000
0.045 −0.001
0.028 −0.000
0.063
0.000
0.358
0.003
0.032
0.000
0.029 −0.001
0.031 −0.000
0.067
0.001
0.128
0.003
0.123 −0.051
0.072
0.031
0.037
0.045
0.118 −0.007
0.295 −0.056
0.380 −0.403
0.321 −1.395
0.361 −0.005
0.404
2.347
0.447
3.263
0.026 −0.001
0.019 −0.002
0.017 −0.000
0.013
0.001
0.034
0.008
0.363 −1.040
0.368 −0.831
0.389
0.335
0.417
1.975
0.420
3.096
0.023 −0.001
0.023 −0.001
0.021 −0.000
0.022
0.002
0.032
0.008

Table 1, x1 = −0.4, −0.2), but even in these cases the expected
value of the estimated standard error is smaller for the nonparametric estimator. For k = 4, the results are more mixed; we see
that the nonparametric estimator is more efficient only when
the propensity score estimator is sufficiently smoothed, that is,
when h is large.
In conclusion, while our first-order asymptotic theory is unable to guide bandwidth selection in applications, these simulations do offer a few useful pointers for practitioners: (i) for the
fully nonparametric estimator, one should avoid undersmoothing the propensity score; (ii) for the semiparametric estimator
undersmoothing with h1 does not seem to be very costly while

s.e.

E(s.e.)


MSE

p-val. p-val. p-val p-val
1.65 −1.65 1.96 −1.96

h = 0.5n−1/8 = 0.172, h1 = 0.2n−1/13 = 0.104
0.437 0.322
0.191 0.051 0.047 0.026
0.310 0.263
0.097 0.054 0.052 0.024
0.261 0.252
0.068 0.045 0.036 0.020
0.284 0.288
0.081 0.034 0.035 0.016
0.527 0.395
0.283 0.059 0.062 0.030
h = 0.5n−1/8 = 0.172, h1 = 0.067n−1/13 = 0.035
0.342 0.284
0.117 0.052 0.050 0.025
0.311 0.249
0.097 0.065 0.054 0.030
0.283 0.232
0.080 0.048 0.051 0.025
0.263 0.250
0.069 0.048 0.052 0.027
0.443 0.393
0.197 0.052 0.056 0.027
h = 0.5n−1/8 = 0.172, h1 = 0.6n−1/13 = 0.312
0.644 0.376
4.481 0.078 0.075 0.041
0.331 0.323
1.621 0.027 0.032 0.012
0.258 0.320
3.237 0.017 0.016 0.005
0.341 0.353
0.184 0.026 0.032 0.012
0.770 0.458
5.450 0.059 0.069 0.031
h = 0.167n−1/8 = 0.058, h1 = 0.2n−1/13 = 0.104
11.84 4.111
224.6
0.294 0.288 0.257
11.89 4.423 1152
0.278 0.263 0.246
10.02 4.174
100.5
0.248 0.245 0.210
13.69 4.365 3048
0.291 0.317 0.252
20.50 4.363 5950
0.336 0.383 0.310
h = 1.5n−1/8 = 0.517, h1 = 0.2n−1/13 = 0.104
0.236 0.243
0.056 0.042 0.044 0.024
0.238 0.238
0.058 0.052 0.049 0.025
0.223 0.240
0.050 0.041 0.037 0.017
0.255 0.282
0.066 0.032 0.035 0.015
0.401 0.383
0.195 0.060 0.061 0.031
h = 0.167n−1/8 = 0.058, h1 = 0.6n−1/13 = 0.312
14.60 4.977 1897
0.289 0.283 0.259
11.38 4.166 1205
0.274 0.266 0.237
10.46 3.915
284.1
0.264 0.266 0.224
14.29 4.239 6280
0.301 0.317 0.273
23.65 5.441 15494
0.334 0.376 0.307
h = 1.5n−1/8 = 0.517, h1 = 0.067n−1/13 = 0.035
0.246 0.245
0.060 0.052 0.054 0.025
0.240 0.236
0.058 0.056 0.049 0.028
0.222 0.223
0.049 0.049 0.049 0.026
0.251 0.248
0.064 0.050 0.052 0.027
0.409 0.397
0.179 0.054 0.056 0.027

0.020
0.026
0.018
0.017
0.034
0.026
0.032
0.023
0.027
0.030
0.043
0.012
0.006
0.014
0.033
0.248
0.224
0.211
0.283
0.356
0.023
0.026
0.018
0.016
0.035
0.245
0.233
0.231
0.289
0.346
0.027
0.027
0.023
0.027
0.028

oversmoothing potentially is; (iii) estimation of CATE close to
the boundary of the support of X1 is by all means problematic.
4.

EMPIRICAL ILLUSTRATION

As documented by a number of authors, low birth weight is
associated with increased health care costs during infancy as
well as adverse health, educational and labor market outcomes
later in life; see, for example, Abrevaya (2006) or Almond,
Chay, and Lee (2005) for a set of references. Smoking is generally regarded as one of the major modifiable risk factors for low
birth weight, and there are many studies that attempt to estimate

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

Table 3. The distribution of

√

495

nh1 [τ̂ (x1 ) − τ (x1 )]: the semiparametric case

n = 500
x1
Panel 1
−0.4
−0.2
0
0.2
0.4
Panel 2
−0.4
−0.2
0
0.2
0.4
Panel 3
−0.4
−0.2
0
0.2
0.4
Panel 4
−0.4
−0.2
0
0.2
0.4
Panel 5
−0.4
−0.2
0
0.2
0.4
Panel 6
−0.4
−0.2
0
0.2
0.4

Mean
√
nh1

−0.004
0.003
0.001
0.001
−0.006
0.002
0.000
0.000
0.001
−0.000
−0.043
0.062
0.063
−0.032
−0.105
−0.002
0.001
0.000
0.001
−0.003
0.001
0.000
0.001
0.001
−0.000
−0.056
0.057
0.064
−0.029
−0.093

s.e.

E(s.e.)


MSE

n = 5000

p-val. p-val.
1.65 −1.65

h1 = 0.2n−1/9 = 0.100
0.302 0.296 0.092 0.053
0.241 0.244 0.059 0.049
0.209 0.220 0.044 0.042
0.216 0.232 0.047 0.031
0.233 0.257 0.056 0.029
h1 = 0.067n−1/9 = 0.034
0.300 0.295 0.090 0.046
0.248 0.240 0.062 0.061
0.204 0.204 0.042 0.049
0.218 0.216 0.047 0.048
0.241 0.252 0.058 0.045
h1 = 0.6n−1/9 = 0.301
0.339 0.324 0.390 0.058
0.246 0.270 0.640 0.035
0.216 0.258 0.648 0.023
0.239 0.273 0.209 0.027
0.282 0.329 1.722 0.023
h1 = 0.2n−1/13 = 0.124
0.251 0.251 0.063 0.051
0.237 0.236 0.056 0.054
0.225 0.217 0.051 0.055
0.264 0.251 0.070 0.054
0.411 0.418 0.169 0.046
h1 = 0.067n−1/13 = 0.041
0.250 0.244 0.063 0.061
0.241 0.234 0.058 0.057
0.223 0.215 0.050 0.061
0.256 0.251 0.065 0.048
0.412 0.399 0.170 0.050
h1 = 0.6n−1/13 = 0.372
0.303 0.256 0.682 0.080
0.236 0.229 0.665 0.059
0.233 0.268 0.824 0.030
0.307 0.332 0.253 0.031
0.454 0.437 1.801 0.052

p-val
1.96

0.059
0.046
0.038
0.044
0.039

0.023
0.025
0.025
0.014
0.013

0.053
0.049
0.050
0.058
0.045

0.025
0.032
0.023
0.024
0.022

0.059
0.032
0.027
0.031
0.032

0.029
0.015
0.010
0.011
0.010

0.052
0.047
0.059
0.067
0.048

0.024
0.030
0.032
0.026
0.022

0.056
0.051
0.064
0.065
0.066

0.032
0.035
0.031
0.022
0.028

0.086
0.053
0.033
0.042
0.062

0.047
0.030
0.012
0.013
0.026

p-val
−1.96
k
0.029
0.019
0.018
0.022
0.021
k
0.026
0.020
0.024
0.029
0.023
k
0.029
0.015
0.010
0.014
0.014
k
0.026
0.026
0.034
0.038
0.026
k
0.031
0.029
0.033
0.036
0.036
k
0.055
0.027
0.012
0.021
0.031

its average causal effect. As we point out in the introduction, our
goal is not to provide another estimate of the average effect per
se, but rather to illustrate how to explore the heterogeneity of
this effect across subpopulations defined by the values of some
continuous covariates. In particular, we will designate mother’s
age as X1 , that is, we are interested in estimating how the expected smoking effect changes with age, while averaging out all
other confounders. We focus on the semiparametric estimator
primarily because of the large number of covariates needed to
make the unconfoundedness assumption plausible.
4.1 The Dataset and the Identification Strategy
We use a dataset of vital statistics recorded between 1988
and 2002 by the North Carolina State Center Health Services,
accessible through the Odum Institute at the University of North
Carolina. We focus on first-time mothers, a restriction which we
will motivate shortly. As routine in the literature, we treat blacks

Mean
√
nh1

=2
−0.000
0.001
0.000
0.000
−0.001
=2
0.000
0.001
0.000
−0.000
−0.000
=2
−0.037
0.034
0.038
−0.007
−0.060
=4
−0.000
−0.000
0.000
−0.001
−0.001
=4
−0.001
0.000
0.000
−0.000
−0.001
=4
−0.050
0.032
0.045
−0.008
−0.059

s.e.

E(s.e.)


0.294
0.237
0.205
0.215
0.229

0.291
0.242
0.213
0.226
0.250

0.298
0.239
0.201
0.212
0.250

0.296
0.241
0.204
0.214
0.252

0.341
0.239
0.213
0.224
0.269

0.314
0.257
0.251
0.261
0.309

0.244
0.241
0.222
0.262
0.396

0.246
0.240
0.240
0.292
0.395

0.249
0.240
0.218
0.252
0.410

0.248
0.239
0.222
0.259
0.411

0.302
0.238
0.232
0.291
0.453

0.306
0.281
0.295
0.337
0.445

MSE

p-val. p-val.
1.65 −1.65

p-val
1.96

h1 = 0.2n−1/9 = 0.078
0.087 0.051 0.054 0.025
0.057 0.047 0.045 0.023
0.042 0.044 0.044 0.020
0.046 0.044 0.044 0.019
0.053 0.036 0.037 0.015
h1 = 0.067n−1/9 = 0.026
0.089 0.049 0.050 0.025
0.057 0.046 0.049 0.023
0.040 0.046 0.048 0.022
0.045 0.047 0.047 0.024
0.063 0.047 0.049 0.023
h1 = 0.6n−1/9 = 0.233
1.739 0.067 0.068 0.036
1.369 0.041 0.036 0.018
1.749 0.027 0.025 0.011
0.109 0.027 0.028 0.011
4.252 0.026 0.030 0.012
h1 = 0.2n−1/13 = 0.104
0.059 0.048 0.047 0.024
0.058 0.053 0.054 0.024
0.049 0.039 0.037 0.017
0.069 0.032 0.038 0.014
0.158 0.051 0.054 0.023
h1 = 0.067n−1/13 = 0.035
0.062 0.048 0.049 0.027
0.058 0.050 0.047 0.025
0.047 0.048 0.049 0.024
0.063 0.043 0.050 0.020
0.168 0.048 0.054 0.021
h1 = 0.6n−1/13 = 0.312
4.013 0.048 0.048 0.025
1.632 0.027 0.026 0.010
3.198 0.018 0.021 0.006
0.191 0.027 0.031 0.008
5.663 0.049 0.058 0.024

p-val
−1.96
0.027
0.024
0.023
0.021
0.017
0.026
0.022
0.023
0.023
0.027
0.036
0.017
0.009
0.010
0.014
0.023
0.026
0.016
0.016
0.027
0.026
0.023
0.024
0.025
0.025
0.024
0.011
0.006
0.012
0.028

and whites as separate populations throughout. The number of
observations is 157,989 for the former group and 433,558 for
the latter.
In accordance with our theory, the key identifying assumption is that the potential birth weight outcomes are independent
of the smoking decision conditional on a sufficiently rich vector of observables X. Almond, Chay, and Lee (2005), da Veiga
and Wilder (2008), and Walker, Tekin, and Wallace (2009) also
used variants of the unconfoundedness assumption to identify
the average effect of smoking on birth weight. Specifically, we
include into X the mother’s age, education, month of first prenatal visit (=10 if prenatal care is foregone), number of prenatal
visits, and indicators for the baby’s gender, the mother’s marital
status, whether or not the father’s age is missing, gestational diabetes, hypertension, amniocentesis, ultra sound exams, previous
(terminated) pregnancies, and alcohol use.
By contrast, Abrevaya (2006) and Abrevaya and Dahl (2008)
controlled for unobserved heterogeneity by using a panel of

496

mothers with multiple births. Nevertheless, their approach still
imposes restrictions on the channels through which unobservables are allowed to operate. In particular, there cannot be feedback from unobserved factors affecting the birth weight of the
first child to the decision whether or not to smoke during the second pregnancy. This is likely violated in practice. The presence
of such feedback also affects the plausibility of the unconfoundedness assumption; our focus on first births is an attempt to deal
with this problem (we cannot identify mothers with multiple
births in the data).

Journal of Business & Economic Statistics, October 2015

benchmark estimations we pick α using the data-driven method
proposed by Crump et al. (2009), which gives α = 0.03 for
blacks (about 20% of the observations dropped), and α = 0.08
for whites (about 33% of the observations dropped).
Compared with the choice of the smoothing parameter and
trimming, the specification of the kernel function K1 is a secondorder issue. We use a regular Gaussian kernel (a kernel with
unbounded support) rather than the Epanechnikov (a kernel with
bounded support) mainly because the former gives smoother,
nicer looking estimates that are somewhat less sensitive to the
bandwidth.

4.2 Implementation Issues
We estimate the CATE (mother’s age) function over a grid
between the first and fourth quintile of the age distribution. In particular, for blacks the corresponding age-range is
17.4–26.0 years and for whites it is 19.6–29.9 years. In both
cases CATE is estimated at 50 equally spaced grid points in these
intervals. (While it is tempting to estimate CATE further out in
the tails of the age distribution, the simulation results suggest
that estimates can be very unreliable closer to the boundary.)
We use a logit model based on a linear index to estimate
the propensity score. More precisely, the index is constrained
to be linear in the parameters, but we allow the components of
X to enter through more flexible functional forms. To obtain
sensible results, it is particularly important to account for the
apparent nonlinearity of the propensity score with respect to
age. Specifically, in addition to X itself, the benchmark model
also incorporates a constant, the square of the mother’s age, and
cross products between mother’s age and all other variables in
X.
The choice of the smoothing parameter h1 is another critical
issue in practice. As is typical for estimators with a nonparametric component, the choice of the smoothing parameter drives a
finite sample bias-variance tradeoff. Smaller values of h1 produce more variable, often nonmonotonic, CATE estimates with
a wider, sometimes even extreme, range. On the other hand,
very large values of h1 force the estimated CATE function to be
essentially constant; in this case, our estimator can be thought of
as an implementation of the Hirano, Imbens, and Ridder (2003)
ATE estimator.
Using a grid search, we calibrate h1 in a way that the resulting
CATE estimates are “reasonable” in that they correspond well
to previous estimates of ATE. Specifically, by the law of iterated expectations, the average of CATE estimates computed at
each sample observation is an implicit estimate of ATE. Typical
ATE estimates obtained under some form of the unconfoundedness assumption (OLS, propensity score matching) range from
about −120 to −250 grams; see, for example, Abrevaya (2006),
da Veiga and Wilder (2008), and Walker, Tekin, and Wallace
(2009). Note, however, that no study known to us restricts attention to first time mothers.
A further consideration is to prevent the estimated CATE
function from taking on values that appear extreme in light of
prior knowledge. The occurrence of such values, particularly
for small h1 , is due in part to propensity score estimates that are
close to zero. As advocated by Crump et al. (2009), we therefore
drop the observations with propensity score estimates outside
the interval [α, 1 − α] for a suitably small value of α. In our

4.3 Estimation Results and Some Robustness Checks
Our benchmark estimates are depicted in Figure 2 (blacks)
and Figure 3 (whites). We report four different CATE estimates
corresponding to bandwidths h1 = 0.25σ̂ , 0.5σ̂ , 1σ̂ , 5σ̂ , where
σ̂ is the sample standard deviation of X1 (mother’s age). In
both figures the top panel shows the four estimates together; the
bottom panels show them separately along with ±2 standard
errors. As h1 increases, the estimated CATE functions become
flatter, less variable, and their range shrinks. The CATE estimate
corresponding to the smallest value of h1 actually shows a positive and somewhat significant smoking effect around age 19–20
for both races; increasing the bandwidth causes this anomaly to
disappear. While more smoothing might guard against CATE
estimates with unreasonable values, it also goes against the general philosophy of the exercise—to let the data speak about the
heterogeneity of the smoking effect with as mild restrictions as
possible. Indeed, for h1 = 5σ̂ , the estimates are only informative about the overall average effect, estimated to be about −155
grams for blacks and −190 for whites.
Taken globally, all the nonconstant CATE estimators tell a
similar story—the predicted average effect of smoking, by and
large, becomes stronger (more negative) at higher ages. For
blacks, this monotone relationship is possibly broken by a hump
around age 19–20, and for whites by a “check mark” shape in the
late 20s. However, these features become less pronounced with
more smoothing. The overall negative slope is consistent with
the results obtained by Walker, Tekin, and Wallace (2009), who
reported OLS and matching estimates that are more negative
for adult mothers than for teen mothers. The advantage of our
approach over simple and somewhat arbitrary sample splitting
is that CATE is potentially capable of delivering a more detailed
picture of age-related heterogeneity. A natural but speculative
explanation for the results is that age is positively correlated
with how long an individual has smoked, and long-term smoking has a cumulative negative effect on birth weight. Another
possibility is that the correlation between smoking and other
unobserved harmful behaviors that are not picked up by our
controls becomes stronger with age.
For a given age, the numerical values of the CATE point
estimates can vary substantially with h1 . For example, for blacks
at age 26 the estimated effect ranges from about −150 g to
−480 g, a factor of 3. Similarly, if we consider, say, whites
at age 20, we again see differences in point estimates on the
order of 300 g, despite the fact that the estimated confidence
intervals do not suggest such large sampling variation. Again,

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

497

Semiparametric CATE estimates for blacks
200
h1=0.25σ
h1=0.5σ

100
Effect on birthweight (grams)

h1=1σ
h1=5σ

0

−100

−200

−300

−400

−500
17

18

19

20

21
22
23
Mother’s age (years)

24

25

CATE with h1=0.25σ, ± 2s.e.

CATE with h1=0.5σ, ± 2s.e.

400

200

100
Effect on birthweight (grams)

Effect on birthweight (grams)

200

0

−200

−400

−600

−800
17

26

0

−100

−200

−300

−400

18

19

20

21
22
23
Mother’s age (years)

24

25

−500
17

26

18

19

CATE with h1=1σ, ± 2s.e.

20

21
22
23
Mother’s age (years)

24

25

26

24

25

26

CATE with h =5σ, ± 2s.e.
1

0

−80
−100

Effect on birthweight (grams)

Effect on birthweight (grams)

−50

−100

−150

−120
−140
−160
−180
−200

−200
−220
−250
17

18

19

20

21
22
23
Mother’s age (years)

24

25

26

−240
17

18

19

20

21
22
23
Mother’s age (years)

Figure 2. Baseline estimates of CATE (mother’s age) for blacks.

this underscores the need for sensitivity analysis and data-driven
procedures to guide bandwidth choice in finite samples.
We perform a number of robustness checks in addition to
varying h1 . First, we estimate CATE using the linear regression
method proposed in Section 2.2; the results are displayed in
Figure 4. Consistent with the overall shape of the semiparametric estimates, the regression-based CATE functions also have
a negative slope. In fact, while a bit steeper, the semiparametric estimates for h1 = 1 × σ̂ are reasonably close to the OLS
estimates for both groups.
Regarding the sufficiency of our controls, the level differences
in the estimates for blacks versus whites could be interpreted as
evidence that confounding factors are not completely accounted
for by the conditioning variables (we are grateful to a referee

for pointing this out). Nevertheless, it is not straightforward to
pinpoint the omitted factors. A potential concern could be the
decline in smoking incidence during the sample period (or that
it might have taken place differently among the two groups).
However, adding “year fixed effects” (i.e., birth year) to X does
not change the baseline results in a noteworthy way. As the
North Carolina vital statistics include the mother’s zip code,
we can link some zip-code level characteristics, such as annual
mean income, to individuals. Adding such controls does not
appreciably change the results either.
Varying the point at which the propensity score estimates
are trimmed has a more substantial effect. For example, setting
α = 2% implies dropping only 4% of observations for whites
and 6.5% for blacks. The general shape of the estimated CATE

498

Journal of Business & Economic Statistics, October 2015
Semiparametric CATE estimates for whites
100
h1=0.25σ
h1=0.5σ

Effect on birthweight (grams)

0

h1=1σ
h1=5σ

−100

−200

−300

−400

−500
18

20

22

24
26
Mothers age (years)

28

CATE with h1=0.5σ, ± 2s.e.

CATE with h1=0.25σ, ± 2s.e.
200

0

100

−50
−100

0

Effect on birthweight (grams)

Effect on birthweight (grams)

30

−100
−200
−300
−400

−200
−250
−300
−350

−500
−600
18

−150

−400

20

22

24
26
Mothers age (years)

28

−450
18

30

20

CATE with h1=1σ, ± 2s.e.

22

24
26
Mothers age (years)

28

30

28

30

CATE with h1=5σ, ± 2s.e.

−100

−160

−120
−170
Effect on birthweight (grams)

Effect on birthweight (grams)

−140
−160
−180
−200
−220
−240

−180

−190

−200

−260
−210
−280
−300
18

20

22

24
26
Mothers age (years)

28

30

−220
18

20

22

24
26
Mothers age (years)

Figure 3. Baseline estimates of CATE (mother’s age) for whites.

functions remains similar for all bandwidths, but their means
shift downward by about 40 g for blacks and 180 g for whites.
For small bandwidths, and particularly for whites, the range
of the estimated effect also expands, pushing the boundaries of
credibility.

5.

THEORETICAL EXTENSIONS

In this section we discuss several extensions of our theory.
First, we define the conditional average treatment effect for the

treated (CATT) and state the analog of Theorem 1 for this parameter. Second, we allow for selection on unobservables and
consider suitable estimands in an instrumental variable (IV)
framework. In particular, if the unconfoundedness assumption
is violated, but there exists a valid binary instrument, we define the conditional local average treatment effect (CLATE) and
the conditional local average treatment effect for the treated
(CLATT), and extend our theory to these parameters. Finally, in
cases where the treatment is multivalued and unconfoundedness
holds, we extend our theory to the conditional marginal average
treatment effect (CMATE).

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

possess; see, for example, Hahn (1998) and Hirano, Imbens,
and Ridder (2003).
2. Some comments about the proof of Theorem 3 are provided
in Appendix F. The details of the derivations are similar to
the proof of Theorem 1 and are omitted.
3. The semiparametric results (i.e., Theorem 2) can also be extended in a straightforward manner. In this case the influence
function is analogous to the influence function that Hahn
(1998) and Hirano, Imbens, and Ridder (2003) derived for
their ATT estimators in the case when p(x) is known.

Estimated CATE: basic linear regression
−40
−60

Effect on birthweight (grams)

−80
−100
−120

Blacks

−140
−160
−180

499

Whites

−200
−220
−240
16

18

20

22
24
Mother’s age (years)

26

28

30

Figure 4. OLS estimates of CATE (mother’s age).

5.1 Conditional Average Treatment Effect of the Treated
The average treatment effect for the treated (ATT) is often
more relevant for policy making than the average effect for
the entire population. Of course, individual treatment effects
might be heterogeneous within the treated subpopulation as
well. This motivates defining the conditional average treatment
effect (CATT) as
CATT(x1 ) ≡ τt (x1 ) ≡ E[Y (1) − Y (0)|D = 1, X1 = x1 ],
where X1 ∈ R is a (continuous) subvector of X ∈ Rk . It can be
shown that τ (x1 ) can be identified as



p(X)(1 − D)Y 
X1 = x1
τt (x1 ) = E DY −
1 − p(X) 

E[p(X)|X1 = x1 ],
(11)
which suggests the estimator



p̂(Xi )(1−Di )Yi
1 n
1
K1 X1ih−x
i=1 Di Yi −
1−p̂(Xi )
nh1
1
τ̂t (x1 ) =
, (12)
 X1i −x1 
1 n
i=1 p̂(Xi )K1
h1
nh
1

where p̂(Xi ) is again given by the leave-i-out version of (3).
The following theorem is analogous to Theorem 1 and summarizes the first-order asymptotic of τ̂t (x1 ).
Theorem 3. Suppose that Assumptions 1 through 8 are satisfied. Then, for each point x1 in the support of X1 ,


K1 22 σψ2t (x1 )
d

nh1 (τ̂t (x1 ) − τt (x1 )) → N 0,
,
f1 (x1 )
where σψ2t (x1 ) ≡ E[ψt2 (X, Y, D)|X1 = x1 ] with

1
p(x)(1 − d)(y − m0 (x))
d(y − m1 (x)) −
ψt (x, y, d) ≡
px1
1 − p(x)

+d(m1 (x) − m0 (x) − τt (x1 )) ,
px1 ≡ E[D = 1|X1 = x1 ].
Comments
1. The influence function ψt (x, y, d) is analogous to the influence function that efficient nonparametric estimators of ATT

5.2

Endogenous Treatment Assignment

We will now relax the unconfoundedness assumption and allow for selection to treatment based on unobserved confounders.
We will, therefore, need an instrument to control for selection
bias. In a pure nonparametric framework (C)ATE and (C)ATT
are no longer identified by an instrument alone; we will rather
extend our theory to the local average treatment effect (LATE)
and the local average treatment effect for the treated (LATT).
The following IV framework, augmented by covariates, is
now standard in the treatment effect literature; see, for example,
Abadie (2003), Frolich (2007), Hong and Nekipelov (2010),
and Donald, Hsu, and Lieli (2014a). In addition to Y, D, and
X, we observe the value of a binary instrument Z ∈ {0, 1} for
each individual in the sample. For Z = z, the random variable D(z) ∈ {0, 1} specifies individuals’ potential treatment status with D(z) = 1 corresponding to treatment and D(z) = 0
to no treatment. The actually observed treatment status is then
given by D ≡ D(Z) = D(1)Z + D(0)(1 − Z). The following
assumptions, taken from Donald, Hsu, and Lieli (2014a) with
some modifications, describe the relationships between the variables defined above.
Assumption 10.



(i) (Instrument Validity): Y (0), Y (1), D(1), D(0) ⊥ Z X.
(ii) (First stage): P [D(1) = 1 | X] > P [D(0) = 1 | X] and
0 < P (Z = 1 | X) < 1.
(iii) (Monotonicity): P [D(1) ≥ D(0)] = 1.
Assumption 10(i) is the analog of the unconfoundedness assumption in the IV framework—it requires that conditional on
X, Z is independent of the potential outcomes and the potential treatment status. Part (ii) postulates that the instrument is
(positively) related to the probability of being treated and implies that the distributions X|Z = 0 and X|Z = 1 have common
support. Finally, the monotonicity of D(z) in z, required in part
(iii), implies that there are no defiers [D(0) = 1, D(1) = 0] in
the population.
We define the conditional local average treatment effect
(CLATE) and the conditional local average treatment effect of
the treated (CLATT) parameters as
CLATE(x1 ) ≡ E[Y (1) − Y (0) | D(1) = 1, D(0) = 0, X1 = x1 ]
CLATT(x1 ) ≡ E[Y (1) − Y (0) | D(1) = 1, D(0) = 0, D = 1,
X1 = x1 ].

500

Following Donald, Hsu, and Lieli (2014a), we can show that
CLATE(x1 ) and CLATT(x1 ) are identified by



(1 − Z)Y 
ZY
X
−
=
x
γ (x1 ) = E
1
1
q(X) 1 − q(X) 

 

ZD
(1 − Z)D 
X1 = x1 ,
E
−
q(X)
1 − q(X) 



q(X)(1 − Z)Y 
X
γt (x1 ) = E ZY −
=
x
1
1
1 − q(X) 


 
q(X)(1 − Z)D 
X
E ZD −
=
x
1
1 ,
1 − q(X) 
where q(x) ≡ P [Z = 1|X = x]. That is, the CLATE (CLATT)
is identified by the CATE (CATT) of Z on Y over the CATE
(CATT) of Z on D. Therefore, we can use the CATE and CATT
estimators developed in previous sections to estimate the numerators and denominators of CLATE and CLATT. Under regularity
conditions similar to those in Theorems 1 and 2, one can obtain
the asymptotic properties of the CLATE and CLATT estimators
by the delta method. We omit the formal statements.
5.3 Multivalued Treatment
In this section, we consider multivalued (rather than binary)
treatments. For example, Walker, Tekin, and Wallace (2009) and
Cattaneo (2010) further divide the smoking indicator into several
groups depending on the intensity of the smoking. In particular,
Walker, Tekin, and Wallace (2009) consider four groups: nonsmokers, smokers with tobacco use between 1 and 10 cigarettes
per day, smokers with tobacco use between 11 and 20 cigarettes
per day, and smokers with tobacco use more than 20 cigarettes
per day. On the other hand, Cattaneo (2010) divides smokers
into five groups depending on the daily tobacco use: 1–5, 6–10,
11–15, 16–20, and 20+. By doing this, one can study the effect
of maternal smoking intensity on birth weight in detail.
We introduce the model and the notation following Cattaneo
(2010). Treatment status (categorical or ordinal) is indexed by
t ∈ {0, 1, . . . , J } ≡ T with J ∈ N fixed. For given t ∈ T , let
Y (t) be the potential outcome under treatment level t. Let the
random variable T ∈ T indicate which of the J + 1 potential
outcomes is observed and let Dt ≡ 1(T = t) for all t ∈ T , where
1(·)
 is the indicator function. The observed outcome Y is given by
t∈T Dt Y (t). The parameters considered in Cattaneo (2010) are
the marginal average treatment effects (MATE): E[Y (t) − Y (s)]
for all t, s ∈ T . Just as before, we can define the conditional
marginal average treatment effect (CMATE) given X1 = x1 as:
E[Y (t) − Y (s)|X1 = x1 ] for all t, s ∈ T .
Define the generalized propensity score as pt (x) ≡ P (Dt =
1|X = x) for t ∈ T . The following assumption is the main assumption we need to identify the MATE or CMATE:
Assumption 11 (i) (Unconfoundedness Assumption): For all
t ∈ T , Y (t) ⊥ Dt |X. (ii) (Generalized Propensity Score): For
all t ∈ T , pt (x) ≥ δ > 0 on X .
Assumption 11 is similar to the binary treatment case, so we
omit the discussion. Under Assumption 11, E[Y (t)|X1 = x1 ] is

Journal of Business & Economic Statistics, October 2015

identified as



E[Y (t)|X1 = x1 ] = E



Dt Y 
X
=
x
1
1 ,
pt (X) 

and E[Y (t)|X1 = x1 ] ≡ λt (x1 ) can be estimated by

 X1i −x1 
Dti Yi
1 n

i=1 p̂t (Xi ) K1
h1
nh1
λ̂t (x1 ) =
,
 X1i −x1 
1 n
i=1 K1
h1
nh
1

where p̂t (Xi ) is the leave-i-out Nadaraya–Watson estimator for
pt (Xi ) as in (3). Under similar regularity conditions as in Theorem 1, one can obtain the asymptotic properties of the CMATE
estimator and we omit the formal statements. Alternatively, one
can model the generalized propensity score parametrically for
each t and extend the semiparametric results in a straightforward
manner.
6.

CONCLUSIONS

We study the estimation of the conditional average treatment
effect (CATE), a functional parameter designed to capture the
variation in the average treatment effect conditional on some
covariate(s) used in identifying it. We propose inverse probability weighted estimators of this function and provide pointwise first-order asymptotic theory. We also discuss extensions
to multivalued treatments, instrumental variable frameworks,
etc. Using the semiparametric version of the estimator, we estimate the average effect of a first time mother’s smoking on
her baby’s birth weight conditional on the mother’s age. The
main qualitative finding is that smoking has a more negative
impact at higher ages. Nevertheless, the numerical estimates
are rather sensitive to bandwidth choice and, to a variable extent, some aspects of the specification and trimming of the estimated propensity score function. Overall, the sempiarametric
CATE estimator appears to be a promising practical tool for
exploring the heterogeneous effects of a treatment, but the empirical exercise highlights the need for formal, preferably datadriven, criteria for bandwidth choice. We consider this an important problem for future research.
APPENDIX
A.

Deriving Standard Errors for the Parametric CATE
Estimator

(k) 
Define yi ≡ (Yi , (Xi − X̄) ) , ûi ≡ (ˆi , û(1)
i , . . . , ûi ) , both (k +
1) × 1 vectors, and
⎛
⎞
(1, Di , Xi , Di (Xi − X̄) ) 0 . . . 0

⎜
0
X̃1i . . . 0 ⎟
⎜
⎟
Zi ≡ ⎜
..
..
. ⎟,
⎝
.
. . . . .. ⎠

0
0 . . . X̃1i

a (k + 1) × (2 + 2k + k( + 1)) matrix. Furthermore, collect the OLS
coefficient estimates in (5) and (6) into the (2 + 2k + k( + 1)) × 1
vector
θ̂ ≡ (ĉ, α̂, β̂  , δ̂  , γ̂ (1) , . . . , γ̂ (k) ) .
With these definitions, (5) and (6) can be represented as the SUR
system yi = Zi θ̂ + ûi . Furthermore, it is easy to see that θ̂ coincides


with the system OLS estimator, that is, θ̂ = ( ni=1 Zi Zi )−1 ni=1 Zi yi .

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

By standard asymptotic results for iid data (see, e.g., Thm. 7.2 of
Wooldridge 2010),
√
(Â−1 B̂ Â−1 )−1/2 n(θ̂ − θ ) →d N (0, I ),
(A.1)
n
n
−1

−1
 
where θ ≡ plim θ̂, Â ≡ n
i=1 Zi Zi , B̂ ≡ n
i=1 Zi ûi ûi Zi , and
I is the identity matrix conformable with θ̂ . (Note that this result allows
for arbitrary correlations between the components of ui = plim ûi as
well as heteroscedasticity.) For x1 fixed, let g(θ̂) ≡ α̂ + (x̃1 γ̂ )δ̂ denote
the CATE estimator in (7). It is easy to verify that the gradient of g is
given by
∇g(θ̂ ) = (0(1×1) , 1, 0(1×k) , x̃1 γ̂ (1) , . . . , x̃1 γ̂ (k) , δ̂1 x̃1 , . . . , δ̂k x̃1 ) .
It follows from (A.1) and the delta method that for large n, the variance
of α̂ + (x̃1 γ̂ ) is approximately ∇g(θ̂ ) Â−1 B̂ Â−1 ∇g(θ̂ )/n.

B.

Properties of p̂(·)

First we establish some properties of the proposed propensity score
estimator needed to show Theorem 1. For i = 1, . . . , n, write
p̂(Xi ) =

ωij Yj ,

(A.2)

501

As s ≥ k ≥ 2, Assumption 8(i) implies that the quantity in (A.6) is
op (h). By the mean value theorem,
1
sup |fˆ−1 (Xi ) − f −1 (Xi )| ≤ sup 2 sup |fˆ(Xi ) − f (Xi )|,
˜i i
f
i
i

(A.7)

where f˜i is a quantity between fˆ(Xi ) and f (Xi ). Since f is bounded
away from zero, supi f˜i−2 = Op (1), and so the rhs of (A.7) is op (h).
Obviously, the same argument applies to the second term. As for
the last term, the mean value theorem and the fact that f is continuously differentiable on its compact support and bounded away from
zero implies |f −1 (x1 ) − f −1 (x2 )| ≤ M x1 − x2 ∞ for all x1 , x2 ∈ X
and some constant M > 0. Hence, |f −1 (Xi ) − f −1 (Xj )| = O(h) given
Xj − Xi ∞ ≤ h. Combining these observations yields (A.3), where
Cn can be taken as Mh plus twice the lhs (or rhs) of (A.7).
Part (b) is a standard result in kernel based nonparametric regression
theory; see, for example, Pagan and Ullah (1999) and Su (2011). The
term hs is the leading term in the expansion of the bias of p̂(x) and
1/(nhk ) is the leading term in the variance expansion (the log(n) factor
arises if one requires uniform convergence). Note also that the bias
of the estimator conditional on X1 , . . . , Xn is also of order O(hs )
uniformly in x.


j :j =i

where
ωij ≡

1
nhk
1
nhk



C.

K

Xi −Xj
h

t:t=i

K



For purposes of exposition only, we present the proof with  =
1. All arguments remain valid in the general case with minimal and
straightforward modifications. In this section we use the letter M to
denote a generic positive constant whose value can change from context
to context.

 Xi −Xt 
h

depends on X1 , . . . , Xn only.
Lemma A.1. Given Assumptions 1 through 8, the propensity score
estimator satisfies
 

Xi − Xj 
Cn 
(A.3)
K
(a) |ωij − ωj i | ≤
,
nhk 
h
where Cn = Op (h) and does not depend on i, j . Furthermore,



log n
s
,
(b) sup |p̂(x) − p(x)| = Op h +
nhk
x∈X

The Proof of Theorem 1

Expanding τ̂ (x1 ). We build on the expansion of the Hirano, Imbens,
and Ridder (2003) estimator by Ichimura and Linton (2005). We start
by establishing notation. Let w = (y, d, x), τ = τ (x1 ), and
(w, p) ≡

(A.4)

and, in particular, E[p̂(x) | X1 , . . . , Xn ] − p(x) = Op (hs ) uniformly
in x.

The first and second partial derivatives of  w.r.t. the argument p are
denoted as p and pp , respectively.
We further define
Sp (Xi ) ≡ E[p (Wi , p(Xi ))|Xi ]


m0 (Xi )
m1 (Xi )
+
,
=−
p(Xi )
1 − p(Xi )

Proof. To see part (a), first note that by Assumption 7(i), ωij =
ωj i = 0 for Xj − Xi ∞ > h. Now assume Xj − Xi ∞ ≤ h. For all
i, define


1
Xi − Xt
.
fˆ(Xi ) ≡
K
nhk t:t=i
h

ζi ≡ p (Wi , p(Xi )) − Sp (Xi ),
i ≡ Di − p(Xi ),
βn (Xi ) ≡ E[p̂(Xi )|X1 , . . . , Xn ] − p(Xi )

Then

 


Xi − Xj   ˆ−1
1 

ˆ−1
K
|ωij − ωj i | =
 · f (Xi ) − f (Xj )
nhk 
h
 


Xi − Xj   ˆ−1
1 
−1

K
≤
 · f (Xi ) − f (Xi )

nhk
h


+ fˆ−1 (Xj ) − f −1 (Xj )


(A.5)
+ f −1 (Xi ) − f −1 (Xj ) .

We will bound the three terms in the braces, uniformly in i, j . Using
standard arguments in nonparametric estimation (similar to the proof
of, e.g., Corollary 1 of Masry 1996), it is possible to show that, under
the maintained assumptions,



log
n
s
.
(A.6)
sup |fˆ(Xi ) − f (Xi )| = Op h +
nhk
i

(1 − d)y
dy
−
.
p
1−p

ωij p(Xj ) − p(Xi ),

=
j :j =i

where the last quantity is the bias of the propensity score estimator
conditional on X1 , . . . , Xn .
We can write the proposed CATE estimator as


nh1 (τ̂ − τ (x1 ))
 X1i −x1 
n
√1
[(Wi , p̂(Xi ) − τ (x1 ))]
i=1 K1
h1
nh1
=
,
 X1i −x1 
n
1
i=1 K1
nh1
h1

where Wi = (Yi , Di , Xi ). As
1
nh1



n

K1
i=1

X1i − x1
h1



p

→ f1 (x1 )

502

Journal of Business & Economic Statistics, October 2015

under the stated assumptions, Theorem 1 part (a) will follow from
showing that


n
1
X1i − x1
[(Wi , p̂(Xi )) − τ (x1 )]
K1
√
h
nh1 i=1
1
= √
nh1



n

K1
i=1

X1i − x1
h


[ψ(Wi ) − τ (x1 )] + op (1).

+√

+√



n

K1
i=1



n

1
nh1

K1
i=1

−p(Xi ))
+√

K1
i=1

−p(Xi ))

+√

K1
i=1

1
nh1

1
nh1

−p(Xi ))


[(Wi , p(Xi )) − τ (x1 )]

X1i − x1
h1

X1i − x1
h1

p (Wi , p(Xi ))(p̂(Xi )


pp (Wi , p ∗ (Xi ))(p̂(Xi )

X − x
1i
1
[(Wi , p(Xi )) − τ (x1 )]
h1

n

K1
i=1
n

i=1
n

i=1

K1
i=1

X − x
1i
1
Sp (Xi )(p̂(Xi ) − p(Xi ))
h1

X − x
1i
1
ζi (p̂(Xi ) − p(Xi ))
K1
h1
X − x
1i
1
pp (Wi , p ∗ (Xi ))(p̂(Xi )
K1
h1

where p (Xi ) is a value between p̂(Xi ) and p(Xi ) for all i, and the J
terms are defined line by line.
We can further expand J1 as


n
X1i − x1
1
Sp (Xi )(p̂(Xi ) − p(Xi ))
J1 = √
K1
h1
nh1 i=1

⎛
⎝



n

K1
i=1

X1i − x1
h
⎞


Sp (Xi )

ωij Dj − p(Xi )⎠
1
nh1

⎛
⎝



n

K1
i=1

X1i − x1
h1


Sp (Xi )
⎞

ωij (j + p(Xj )) − p(Xi )⎠
j :j =i

= √

1
nh1



n

K1
i=1

X1i − x1
h1

⎞

Sp (Xi ) ⎝

ωij j − i ⎠

j :j =i


Sp (Xi )

ωij p(Xj ) − p(Xi )⎠

j :j =i

= √

1
nh1



n

K1
i=1
n

1
+√
nh1

X1i − x1
h1
⎛

i ⎝


Sp (Xi )i


ωj i K1

j :j =i

i=1

X1j − x1
h1


Sp (Xj )





X1i − x1
Sp (Xi )
h1


n
X1i − x1
1
Sp (Xi )βn (Xi )
K1
+√
h1
nh1 i=1
≡ J11 + J12 + J13 ,
where the J1· terms are again defined line by line. Note that J0 and J11
can be combined to yield the expression in (A.8). Hence, it is sufficient
to show that J12 , J13 , J2 , and J3 are all op (1).
Bounding J12 . We start by writing
⎛


1 ⎝
X1j − x1
Sp (Xj )
ωj i K1
√
h1
h1 j :j =i

−K1

X1i − x1
h1

1
= √
h1




Sp (Xi )


(ωj i − ωij )K1
j :j =i

X1j − x1
h1


Sp (Xj )

(A.9)


−K1

X1i − x1
h1




Sp (Xi )

(A.10)

and bounding (A.9) and (A.10) separately.
Turning to (A.9),








1
X
−
x
1j
1
Sp (Xj )
(ωj i − ωij )K1
√ sup 
h
h1 i j :j =i
1


 




X1j − x1
|ωj i − ωij | K1
Sp (Xj )
h1
i
j :j =i
 

MCn
Xj − Xi 
h
1 
≤
K
· √ · sup

h
h
h1 i j :j =i nhk 
≤ sup

j :j =i

= √

⎛

⎛


X1j − x1
1 ⎝
Sp (Xj )
+√
ωij K1
h1
h1 j :j =i

2

≡ J0 + J1 + J2 + J3 ,

1
nh1

X1i − x1
h1



⎞

∗

= √

X1i − x1
h1

−K1



2

n

1
+√
nh1
+√



n

1
nh1

1
= √
nh1

X1i − x1
h1



n

1
nh1

×⎝

By a Taylor series expansion around p(Xi ),


n
X1i − x1
1
[(Wi , p̂(Xi )) − τ (x1 )]
K1
√
h
nh1 i=1
1
= √
nh1

K1
i=1

⎛

(A.8)



n

1
+√
nh1


Sp (Xi )i

= Op (1) · op (1) · Op (1) = op (1),

(A.11)

where the second inequality follows from Lemma 6.1 part (a) and the
fact that K1 (·)Sp (·) is bounded on X by some constant M > 0 by Assumptions 5, 6, and 7(ii). As for the order
√ of the factors, note that
Cn / h = Op (1) by Lemma 6.1 part (a), h/ h1 = op (1) by Assumption
  X −X 

8(iii), and supi j :j =i nh1 k K j h i  = Op (1) by standard nonparametric estimation theory.

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects


Turning to (A.10), first note that j :j =i ωij K1j Sp (Xj ) is an estimator
of K1i Sp (Xi ), and (A.10) can be regarded as the bias of this estimator
conditional on X1 , . . . , Xn . One can use standard arguments in the
nonparametric econometrics literature to analyze the order of such
conditional bias terms (see, e.g., Pagan and Ullah 1999, pp. 102–103).
The novelty is the presence of the factor K1 (·/ h1 ), which changes
somewhat the order of the bias term from the usual O(hs ) (as in say
Lemma 6.1 part (b)). More specifically, under Assumptions 8(i) and
(ii), we can show that




X1j − x1
Sp (Xj )
ωij K1
sup 
h1
i
j :j =i


−K1

(A.12)

Combining (A.11) and (A.12) yields




X1j − x1
1
Sp (Xj )
ωj i K1
√ sup 
h1
h1 i j :j =i




X1i − x1
Sp (Xi ) = op (1).
−K1
h1
As the i ’s are mutually independent conditional on the sample path of
the Xi ’s, it further follows that



n
1
X1j − x1
1
Sp (Xj )
i √
ωj i K1
J12 = √
h1
n i=1
h1 j :j =i


(A.13)
1
1
+√
nh1 f1 (x1 )


X1i − x1
Sp (Xi ) = op (1),
h1

D.



nh1 sup |βn (x)|
x∈X

=



1
·
nh1

i=1

i=1

X1i − x1
h1

(A.14)

Handling Discrete Covariates

Let qm (x1 ) ≡ P (M = 1|X1 = x1 ) and τm (x1 ) ≡ E[Y (1) −
Y (0)|X1 = x1 , M = 1]. For the female subpopulation the quantities
qf (x1 ) and τf (x1 ) are defined analogously. For simplicity only, take
again  = 1. Note that the parameter of interest can be written as
τ (x1 ) = qm (x1 )τm (x1 ) + qf (x1 )τf (x1 ). Then, we estimate τm (x1 ),
τf (x1 ), qm (x1 ), and qm (x1 ) by
τ̂m (x1 ) ≡

Bounding J13 . Note that βn (x) is the bias of p̂(x), conditional on
s
X1 , . . . , Xn , which is Op (h ) uniformly in x (see Lemma 6.1 part (b)).
We can then bound J13 as follows:




n
 1

X1i − x1

Sp (Xi )βn (Xi )
K1
|J13 | =  √
h1
nh1 i=1
≤

[τ (X1i ) − τ (x1 )]K1



It is straightforward to show that E([ψ(Xi , Yi , Di ) −
τ (X1i )]K1in ) = 0, where we write K1in = K1 ((X1i − x1 )/ h1 ) to
make it explicit that this quantity depends on n through h1 . For
each n, the random variables {[ψ(Xi , Yi , Di ) − τ (X1i )]K1in }ni=1 are
independent and one can apply Lyapunov’s CLT for triangular arrays
to (A.13) to obtain the asymptotic distribution shown in part (b) of
Theorem 1. The verification of the conditions of Lyapunov’s CLT
mimics exactly the proof of Theorem 3.5 by Pagan and Ullah (1999).
The bias term given in (A.14) is op (1) under Assumption 8(ii) and
therefore has no bearing on the limit distribution. The verification of
this claim follows, in turn, the proof of Theorem 3.6 by Pagan and
Ullah (1999) coupled with the subsequent discussion about higher
order kernels.

 



K1 X1i − x1 |Sp (Xi )|


h
1

τ̂f (x1 ) ≡

q̂m (x1 ) ≡

1
nh1

i:Mi =1
1
nh1

1
nh1

i:Mi =0
1
nh1

Bounding J3 . Note that p ∗ (Xi ) is between p̂(Xi ) and p(Xi ), so
it is uniformly bounded away from zero and one. Furthermore,
by Lemma 6.1(b) and Assumption 8(i),√ supx∈X |p̂(x) − p(x)|2 =
op (hs ). Therefore, by Assumption 8(iii), nh1 hs · h−s supi (p̂(Xi ) −
p(Xi ))2 = op (1) · op (1) = op (1), and the same argument used to control J13 yields J3 = op (1).

Di Yi
p̂m (Xi )



−

i:Mi =1
Di Yi
p̂f (Xi )



(1−Di )Yi
1−p̂m (Xi )

K1

−

i:Mi =0

K1
 X1i −x1 

h1

,

h1

(1−Di )Yi
1−p̂f (Xi )

K1

 X1i −x1 

K1
 X1i −x1 

 X1i −x1 
h1

,

h1


1
Mi K1 X1ih−x
1

,
n
X1i −x1
i=1 K1
h1

n

1
nh1

i=1

q̂f (x1 ) ≡ 1 − q̂m (x1 ) =

nh1 Op (h ) · Op (1) = op (1) · Op (1) = op (1),

Bounding J2 . By Lemma 6.1(b) and Assumption 8(i),
supx∈X |p̂(x) − p(x)| = op (hs/2 ). Hence, by Assumption 8(iii),
−1/2
h1 supx∈X |p̂(x) − p(x)| = op (1). As the {ζi } are mutually independent conditional on the sample path of the Xi ’s, we have J2 = op (1) by
the same argument used to show J12 = op (1).





s

where the second part of Assumption 8(iii) is used on the last line.





1
nh1

conditional on the sample path of the Xi ’s with probability approaching
one.

n



n

+ op (1).

Therefore, by Assumption 8(iii),

−K1

Combining the bounds above establishes (A.8) and hence Theorem
1 part (a).
Turning to Theorem 1 part (b), we write

nh1 (τ̂ (x1 ) − τ (x1 ))


n
1
X1i − x1
1
= √
[ψ(Xi , Yi , Di ) − τ (X1i )]K1
h1
nh1 f1 (x1 ) i=1


 s


X1i − x1
h

Sp (Xi )  = Op s .
h1
h1




 1
X1j − x1
sup  √
ωij K1
Sp (Xj )
h1
h1 j :j =i
i




X1i − x1
Sp (Xi ) = op (1).
−K1
h1

503

1
nh1

n


1
− Mi )K1 X1ih−x
1

.
n
X1i −x1
i=1 K1
h1

i=1 (1

1
nh1

(A.15)

Last, τ (x1 ) is estimated by
τ̂ (x1 ) = q̂m (x1 )τ̂m (x1 ) + q̂f (x1 )τ̂f (x1 ).

(A.16)

After we plug in those expressions in (A.15) into (A.16), the expression
of τ̂ (x1 ) in (A.16) reduces to that in (9).
Next, we verify the influence function representation displayed in
(10). Note that the CATE estimator for the male group can be written
as


nm h1 (τ̂m (x1 ) − τm (x1 )) =

1
√
fm (x1 ) nm h1

n

(ψi
i=1

−τm (x1 ))Mi K1i + op (1),

504

Journal of Business & Economic Statistics, October 2015

where K1i = K((X1i − x1 )/ h1 ) and ψi = ψ(Mi , Xi , Yi , Di ). We replace nm with n in the scaling factor by writing

 

1
n
nh1 τ̂m (x1 ) − τm (x1 ) =
√
nm fm (x1 ) nh1

n

We can combine the previous four displays to obtain the representation
in (10):

nh1 (τ̂ (x1 ) − τ (x1 ))

= nh1 [q̂m (x1 )τ̂m (x1 ) + q̂f (x1 )τ̂f (x1 )

(ψi

−qm (x1 )τm (x1 ) − qf (x1 )τf (x1 )]


= nh1 qm (x1 )(τ̂m (x1 ) − τm (x1 )) + nh1 (q̂m (x1 )



−qm (x1 ))τ̂m (x1 ) + nh1 qf (x1 ) τ̂f (x1 ) − τf (x1 )
 

+ nh1 q̂f (x1 ) − qf (x1 ) τ̂f (x1 )

i=1

−τm (x1 ))Mi K1i + op (1)
=

n

1
√
qm fm (x1 ) nh1

ψi Mi K1i
i=1

+ op (1),

=

where qm ≡ P (M = 1) and fm (x1 ) is the conditional density of X1 on
M = 1. Also, note that

+
+

P (X1 = x1 , M = 1) = f1 (x1 )qm (x1 ) = qm fm (x1 ).
+
Therefore,
=


1
nh1 (τ̂m (x1 ) − τm (x1 )) =
√
f1 (x1 )qm (x1 ) nh1

estimators

q̂m (x1 )

n

(ψi − τf (x1 ))
i=1

and

i=1
n

1
√
f1 (x1 ) nh1

(ψi − τf (x1 ))(1 − Mi )K1i
i=1
n

1
√
f1 (x1 ) nh1



1 − Mi − qf (x1 ) τf (x1 )K1i + op (1)

i=1
n

1
√
f1 (x1 ) nh1

(ψi − qm (x1 )τm (x1 )
i=1

q̂f (x1 )

The Proof of Theorem 2

Using the notation introduced in Appendix C, we again expand the
numerator of the CATE estimator around p(Xi ) = p(Xi ; θ0 ) as


n
X1i − x1
1
[(Wi , p(Xi ; θ̂n )) − τ (x1 )]
K1
√
h
nh1 i=1

(1 − Mi )K1i + op (1).

Furthermore, the
represented as



Mi − qm (x1 ) τm (x1 )K1i

where the last equality follows from that τ (x1 ) = qm (x1 )τm (x1 ) +
qf (x1 )τf (x1 ).

E.

1
√
f1 (x1 )qf (x1 ) nh1

n

1
√
f1 (x1 ) nh1

= (10),
i=1

Similarly,

nh1 (τ̂f (x1 ) − τf (x1 )) =

(ψi − τm (x1 ))Mi K1i
i=1

−qf (x1 )τf (x1 ))K1i + op (1)

n

(ψi − τm (x1 ))Mi K1i + op (1).



n

1
√
f1 (x1 ) nh1

= √

can

1
nh1

+√

be



n

K1
i=1

1
nh1


X1i − x1
[(Wi , p(Xi )) − τ (x1 )] (A.17)
h1


n

K1
i=1


X1i − x1
p (Wi , p ∗ (Xi ))
h1

(p̂(Xi ; θ̂n ) − p(Xi )),
∗



n

1
nh1 (q̂m (x1 ) − qm (x1 )) =
√
f1 (x1 ) nh1

i=1

(Mi − qm (x1 ))K1i + op (1),

and

where p (Xi ) is between p(Xi ; θ̂n ) and p(Xi ). We bound the second
term as
 n


1 
X1i − x1
p (Wi , p ∗ (Xi ))
K
√
1
h1
nh1  i=1


(p(Xi ; θ̂n ) − p(Xi ))
≤



nh1 sup |p(x; θ̂n ) − p(x)| ·
x∈X



nh1 (q̂f (x1 ) − qf (x1 )) =

1
√
f1 (x1 ) nh1

n

i=1

(1 − Mi − qf (x1 ))K1i + op (1).

1
nh1

n

i=1

 




K1 X1i − x1 p (Wi , p ∗ (Xi )),


h1

(A.18)

where the first factor is op (1) by Assumption 9 and the second factor
is Op (1) under mild regularity conditions. Since (Wi , p(Xi , θ )) =

Abrevaya, Hsu, and Lieli: Estimating Conditional Average Treatment Effects

ψθ (Xi , Yi , Di ), part (a) of Theorem 2 is proven. The proof of part (b)
is identical to the the proof of Theorem 1(b) and is therefore omitted.

F.

Proof of Theorem 3

The proof
representations:
⎛

is
1

⎜ nh
nh1 ⎝ 1

based

on

establishing

the

n 

 X1i −x1 

i=1

h1

i )(1−Di )Yi
Di Yi − p̂(X1−
K1
p̂(Xi )



n
X
−x
1
1i
1
i=1 K1
h1
nh

following

1


−τt (x1 )px1
1
1
=  
f
(x
nh1 1 1 )
−

n


Di (Yi − m1 (Xi ))

i=1

p(Xi )(1 − Di )(Yi − m0 (Xi ))
1 − p(Xi )



+Di (m1 (Xi ) − m0 (Xi )) − τt (x1 )px1



X1i − x1
+ op (1),
h1
⎛ 1 n
⎞
 X1i −x1 

i=1 Di K1
h1
 ⎝ nh1
nh1
 X1i −x1  − px1 ⎠
n
1
i=1 K1
h1
nh

×K1

1

1
1
= 
nh1 f1 (x1 )

n

(Di − px1 )K1
i=1

X − x
1i
1
+ op (1).
h1

The second equation
the denominator of

 suggests that we can replace
τ̂t (x1 ) in (12) with ni=1 Di K1 (X1i − x1 )/ h1 /(nh1 ) without changing
the first-order asymptotic of τ̂t (x1 ).

ACKNOWLEDGMENTS
The authors thank Fabio Canova, Steven Durlauf, Kei Hirano,
Gábor Kézdi, Miklós Koren, Botond Kőszegi, Hon Ho Kwok,
Francis Vella, the editors, and two anonymous referees for useful
comments. All errors are authors’ responsibility.
[Received July 2012. Revised March 2014.]
REFERENCES
Abadie, A. (2003), “Semiparametric Instrument Variable Estimation of Treatment Response Models,” Journal of Econometrics, 113, 231–263. [499]
Abrevaya, J. (2006), “Estimating the Effect of Smoking on Birth Outcomes
Using a Matched Panel Data Approach,” Journal of Applied Econometrics,
21, 489–519. [494,495,496]
Abrevaya, J., and Dahl, C. (2008), “The Effects of Birth Inputs on Birthweight:
Evidence From Quantile Estimation on Panel Data,” Journal of Business
and Economic Statistics, 26, 379–397. [486,495]
Almond, D., Chay, K. Y., and Lee, D. S. (2005), “The Costs of Low Birth
Weight,” Quarterly Journal of Economics, 120, 1031–1083. [494,495]
Cattaneo, M. D. (2010), “Efficient Semiparametric Estimation of Multi-Valued
Treatment Effects Under Ignorability,” Journal of Econometrics, 155, 138–
154. [500]

505

Crump, R. K., Hotz, V. J., Imbens, G. W., and Mitnik, O. A. (2009), “Dealing With Limited Overlap in Estimation of Average Treatment Effects,”
Biometrika, 96, 187–199. [496]
da Veiga, P. V., and Wilder, R. P. (2008), “Maternal Smoking During Pregnancy
and Birthweight: A Propensity Score Matching Approach,” Maternal and
Child Health Journal, 12, 194–203. [495,496]
Donald, S. G., Hsu, Y.-C., and Lieli, R. P. (2014a), “Testing the Unconfoundedness Assumption via Inverse Probability Weighted Estimators of (L)ATT,”
Journal of Business and Economic Statistics, 32, 395–415. [492,499]
——— (2014b), “Inverse Probability Weighted Estimation of Local Average
Treatment Effects: A Higher Order MSE Expansion,” Statistics and Probability Letters, 95, 132–138. [489]
Frölich, M. (2007), “Nonparametric IV Estimation of Local Average Treatment
Effects With Covariates,” Journal of Econometrics, 139, 35–75. [499]
Hahn, J. (1998), “On the Role of the Propensity Score in Efficient Semiparametric Estimation of Average Treatment Effects,” Econometrica, 66, 315–331.
[485,486,488,490,499]
Heckman, J., Ichimura, H., and Todd, P. (1997), “Matching as an Econometric
Evaluation Estimator: Evidence From Evaluating a Job Training Program,”
Review of Economic Studies, 64, 605–654. [485]
——— (1998), “Matching as an Econometric Evaluations Estimator,” Review
of Economic Studies, 65, 261–294. [485]
Heckman, J., and Vytlacil, E. (2005), “Structural Equations, Treatment Effects,
and Econometric Policy Evaluation,” Econometrica, 73, 669–738. [485]
Hirano, K., Imbens, G. W., and Ridder, G. (2003), “Efficient Estimation of
Average Treatment Effects Using the Estimated Propensity Score,” Econometrica, 71, 1161–1189. [486,488,490,496,499,501]
Hong, H., and Nekipelov, D. (2010), “Semiparametric Efficiency in Nonlinear
LATE Models,” Quantitative Economics, 1, 279–304. [499]
Hsu, Y.-C. (2012), “Consistent Tests for Conditional Treatment Effects,” Working Paper, Institute of Economics, Academia Sinica, Taiwan. [485]
Ichimura, H., and Linton, O. (2005), “Asymptotic Expansions for Some Semiparametric Program Evaluation Estimators,” in Identification and Inference
for Econometric Models: Essays in Honor of Thomas Rothenberg, eds. D.
W. K. Andrews and J. Stock, Cambridge, UK: Cambridge University Press.
[488,501]
Imbens, G., and Ridder, G. (2009), “Estimation and Inference for Generalized
Full and Partial Means and Derivatives,” Working Paper, Department of
Economics, Harvard University. [490]
Imbens, G. W., and Wooldridge, J. W. (2009), “Recent Developments in the
Econometrics of Program Evaluation,” Journal of Economic Literature, 47,
5–86. [487]
Khan, S., and Tamer, E. (2010), “Irregular Identification, Support Conditions, and Inverse Weight Estimation,” Econometrica, 6, 2021–2042.
[485,488,492]
Lee, S., and Whang, J.-Y. (2009), “Nonparametric Tests of Conditional Treatment Effects,” Cowles Foundation Discussion Papers 1740, Cowles Foundation, Yale University. [485]
MaCurdy, T., Chen, X., and Hong, H. (2011), “Flexible Estimation of Treatment
Effect Parameters,” American Economic Review, 101, 544–551. [485]
Masry, E. (1996), “Multivariate Local Polynomial Regression for Time Series:
Uniform Strong Consistency and Rates,” Journal of Time Series Analysis,
17, 571–599. [501]
Pagan, A., and Ullah, A. (1999), Nonparametric Econometrics, Cambridge, UK:
Cambridge University Press. [501,503]
Rosenbaum, P., and Rubin, D. (1983), “The Central Role of the Propensity
Score in Observational Studies for Causal Effects,” Biometrika, 70, 41–55.
[485,486]
——— (1985), “Reducing Bias in Observational Studies Using Subclassfication
on the Propensity Score,” Journal of American Statistical Association, 79,
516–524. [485]
Su, L. (2011), “A Brief Introduction to Nonparametric Econometrics,” Lecture Notes, School of Economics, Singapore Management University.
[501]
Walker, M. B., Tekin, E., and Wallace, S. (2009), “Teen Smoking and Birth Outcomes,” Southern Economic Journal, 75, 892–907.
[495,496,500]
Wooldridge, J. M. (2010), Econometric Analysis of Cross Section and Panel
Data (2nd ed.), Cambridge, MA: MIT Press. [487]

