12-356

October 2012

“Matching vs Differencing when
Estimating Treatment Effects with
Panel Data: the Example of the Effect
of Job Training Programs on Earnings”
Sylvain Chabé-Ferret

Matching vs Differencing when Estimating
Treatment Effects with Panel Data: the Example of
the Effect of Job Training Programs on Earnings∗
Sylvain Chabé-Ferret†
Irstea, Umr 1273 Métafort, Aubière, France.
First version : 15 July 2010, this version: October 8, 2012.
Abstract
This paper compares matching and Difference-In-Difference matching (DID)
when estimating the effect of a program on a dynamic outcome. I detail the
sources of bias of each estimator in a model of entry into a Job Training Program (JTP) and earnings dynamics that I use as a working example. I show that
there are plausible settings in which DID is consistent while matching on past
outcomes is not. Unfortunately, the consistency of both estimators relies on conditions that are at odds with properties of earnings dynamics. Using calibration
and Monte-Carlo simulations, I show that deviations from the most favorable
conditions severely bias both estimators. The behavior of matching is nevertheless less erratic: its bias generally decreases when controlling for more past
outcomes and it generally provides a lower bound on the true treatment effect.
I finally point to previously unnoticed empirical results that confirm that DID
does well, and generally better than matching on past outcomes, at replicating
the results of an experimental benchmark.
Keywords: Matching - Difference in Difference - Evaluation of Job training
Programs.
JEL codes: C21, C23.
∗

A previous version of this paper was circulated under the title “To Control or Not to Control? Bias
of Simple Matching vs Difference-In-Difference Matching in a Dynamic Framework”. This paper is a
heavily revised version of this previous work and replaces it. The first version of this paper has been
written as I was visiting Cowles Foundation for the Research in Economics at Yale University. I thank
Don Andrews and Philip Haile for their invitation and Cemagref for its financial support. I thank Joe
Altonji, Martin Browning, Sidd Chib, Xavier d’Hautfoeuille, Jim Heckman, Stefan Hoderlein, Martin
Huber, Fabian Lange, Michael Lechner, Yoonseok Lee, Thierry Magnac, Giovanni Mellace, Christoph
Röthe, Julie Subervie, Petra Todd, Neese Yildiz, Ed Vytlacil and seminar participants at Yale, the
University of Pennsylvania, CERDI, TSE, CREST, the University of Orléans, the University of Sankt
Gallen and the University of Chicago for their valuable comments and suggestions on this research.
I also thank the editor, one associate editor and four anonymous referees for their comments on an
earlier version of this paper. All remaining errors are my own.
†
Correspondence to: Sylvain Chabé-Ferret, Toulouse School of Economics, Lerna 21 Allée de
Brienne, 31015 Toulouse Cedex 6, France. Email: sylvain.chabe-ferret@tse-fr.eu. Tel: +33 (0)5 61
12 88 28. Fax:+33 (0)5 61 12 85 20.

1

Introduction

This paper compares two different ways of using pre-treatment outcomes when estimating the effect of a program with panel data: including pre-treatment outcomes in
the set of control variables or using them in a Difference-In-Difference (DID) strategy.
In their review of recent developments in the econometrics of program evaluation,
Imbens and Wooldridge (2009) seem to favor matching as a default option, but call
for more substantive knowledge on that issue:
In the end, the two approaches make fundamentally different assumptions.
One needs to choose between them based on substantive knowledge. [. . . ]
As a practical matter, the DID approach appears less attractive than the
unconfoundedness based approach in the context of panel data. It is difficult
to see how making treated and control units comparable on lagged outcomes
will make the causal interpretation of their difference less credible, as suggested by the DID assumptions.
I approach this problem by using a model of earnings and entry into a Job Training
Program (JTP) as a working example, thereby bringing substantive prior knowledge
from labor economics. I study the conditions on this model that ensure the consistency of either matching or DID. Models of wage or earnings dynamics indeed offer
a good rationale for both approaches. They generally include a random intercept
and/or a random trend that is unobserved to the econometrician and captures unobserved ability. These types of terms are easily dealt with by time-differencing, which
calls for a DID or fixed-effects type of approach. At the same time, these processes
include ARMA terms so that transitory shocks persist. A classical stylized fact in
labor economics is that individuals entering a JTP experience a transitory decrease in
earnings, a phenomenon known as Ashenfelter’s dip (Ashenfelter, 1978). This creates
time-varying selection bias which calls for matching on past outcomes to capture these
transitory declines in earnings. There is thus a tension between these two sources of
bias: the one due to selection on a permanent unobserved component and the other
1

due to transitory income shocks and Ashenfelter’s dip. Whether or not matching or
DID can get rid of one or both of these bias terms remains an open question. In
this paper, I carefully decompose the bias of matching and DID and state sufficient
conditions that drive these terms to zero.
My first result is that there are plausible settings in which DID is consistent while
matching on past outcomes is not. This is obviously true when selection bias is only
due to additive unobserved individual fixed effects. In that case, past outcomes are not
a good proxy for unobserved fixed effects and matching is biased whereas differencing
gets rid of the unobserved fixed effects and is consistent. I also show a less obvious
result that DID is consistent and matching is biased in a model allowing for selection on
transitory shocks, even in the absence of fixed effects. This result has more empirical
content because it allows for an Ashenfelter’s dip. This is thus a credible case where
making treated and control units comparable on lagged outcomes makes the causal
interpretation of their difference less credible than the DID assumptions. This result
nuances the intuition expressed in Imbens and Wooldridge (2009)’s statement and thus
sheds new light on the tension between matching and DID.
This result relies on the fact that DID, when applied symmetrically around the
treatment date and under plausible conditions, can get rid of selection bias due to
transitory shocks and is thus robust to Ashenfelter’s dip. The intuition for the consistency of symmetric DID is simple: under certain conditions, Ashenfelter’s dip forms
and dissipates at the same pace, thereby generating a symmetric wedge around the
treatment date. The conditions for ensuring this symmetry are somewhat stringent,
but they can credibly hold simultaneously. The first condition requires that the agents
have full information on the wages they would have earned had they not entered the
program. The second condition requires that the expectation of earnings conditional
on some increasing transformation of the net utility of entering the program is linear. This obviously holds when error terms are normally distributed, but also extends
to the whole class of elliptical disturbances (Chu, 1973), including for instance the
lognornmal, Student’s t and Cauchy distributions. The third condition imposes that
2

the idiosyncratic component of the wage process is stationary. This holds if there is
no random slope term, transitory shocks are mean-reverting (i.e. there is no random
walk) and initial conditions are drawn in the long run stable distribution.
Under these conditions, matching is biased. Indeed, in order to ensure the consistency of matching, I need to assume away both the random slopes and intercepts
and the moving average terms in the dynamics of earnings and I have to impose that
agents cannot perfectly forecast their forgone earnings.
My second main result is that the consistency of both estimators unfortunately
relies on conditions that are at odds with properties of earnings dynamics (see Meghir
and Pistaferri (2011) for a survey). There is a heated debate in the literature on
empirical income dynamics as to whether random slopes and intercepts are needed
to account for income dynamics or not. The Heterogeneous Income Profile (HIP)
model advocated by Guvenen (2007) includes these terms. The Restricted Income
Profile (RIP) model does not (MaCurdy, 1982). Both estimators are not consistent
under the HIP. Under the RIP, and apart from restrictions on agent’s information set,
the consistency of DID also requires stationarity while that of matching requires the
absence of MA terms. Both of these conditions are at odds with empirical estimates
of the earnings process (Meghir and Pistaferri, 2011). For example, MaCurdy (1982)
estimates sizable MA terms and an increasing variance over the life cycle.
The third contribution of this paper is to explore the sensitivity of both estimators
to deviations from the specific conditions under which they are consistent and to
study their small sample properties. I conduct a calibration exercise and Monte-Carlo
simulations using estimates of the wage process from the literature. I vary several
dimensions of the model: HIP vs RIP, full information vs limited information and
initial conditions. I also check the sensitivity of both estimators to the inclusion of
additional pre-treatment outcomes in the set of control variables. Results from the
simulations show that both estimators are severely biased when the model deviates
from the optimal conditions. The results show that, although matching is generally
not consistent under credible parameterizations, its behavior is less erratic: it generally
3

underestimates the true treatment effect and thus provides a useful lower bound and
its bias generally decreases when controlling for additional pre-treatment outcomes.
DID is consistent under credible conditions, but is more sensitive to deviations from
these conditions. Moreover, the different bias terms generated by deviations from these
conditions do not always go in the same direction: lower initial variance of the ARMA
process yields to an underestimation of the treatment effect, as does the introduction
of a random slope, whereas limited information yields to an overestimation of the true
treatment effect. Finally, adding more control variables increases the bias of DID in
the RIP, but decreases it in the HIP.
The fourth contribution of this paper is to revisit the results of studies comparing
matching and DID to an experimental benchmark (Heckman, Ichimura, Smith, and
Todd, 1996; Smith and Todd, 2005). I point to previously unnoticed results in both
papers favoring the use of symmetric DID. In these applications, matching controlling
for past wages exhibits higher bias than DID.
Overall the combined results in this paper seems to picture a view somewhat more
favorable to DID than the one advocated by Imbens and Wooldridge (2009). At the
very least, presenting the results of both approaches and the sensitivity of those to the
inclusion of past outcomes as control variables is to be recommended when applying
matching on panel data.
The results in this paper shed also light on the evaluation of JTP with repeated
cross-sectional data. Because only DID can be applied in this case, the results in this
paper help understand the likely sources of bias with this approach. Implementing
DID symmetrically around the treatment date is recommended in order to capture
Ashenfelter’s dip. The results in this paper also shed light on the evaluation of programs with similar selection rules and outcome processes, as for example the effect
of payments for environmental services on agricultural practices (Chabé-Ferret and
Subervie, Forthcoming), statutory sick pay on health (Puhani and Sonderhof, 2010;
Ziebarth and Karlsson, 2010), fair trade certification on product quality and income
(Balineau, 2012) and the effect of enterprise zones on firms’ location (Mayer, Mayneris,
4

and Py, 2012). However, the results results in this paper do not apply to duration outcomes as the length of unemployment spells for instance, except when unemployment
duration is averaged over geographical area (Gobillon, Magnac, and Selod, 2010).
While the trade-off between matching and DID has never been studied per se in
the literature, the choice of control variables when using matching has already been
studied. Wooldridge (2005) shows that controlling for variables altered by the treatment generates selection bias. Heckman and Navarro-Lozano (2004) show, in a static
selection model, that including an additional variable to the set of control variables
may increase selection bias. More recently, several papers have shown that controlling
for instrumental variables amplifies bias when it is already present (Bhattacharya and
Vogt, 2007; Wooldridge, 2009; Pearl, 2010, 2011; Myers, Rassen, Gagne, Huybrechts,
Schneeweiss, Rothman, Joffe, and Glynn, 2011). The consistency of symmetric DID
with time varying selection bias is an extension of a similar result in Heckman (1978)
to a more general selection rule and wage process. I also extend the Monte-Carlo results of Heckman, LaLonde, and Smith (1999) to the HIP model, varying both initial
conditions and agents’ information set.
This paper is structured as follows: section 2 presents the model and the estimators
I consider; section 3 presents separate sufficient conditions ensuring the consistency of
matching and DID; in sections 4 and 5, I report the results of a calibration exercise and
Monte-Carlo simulations checking the sensitivity of these results to deviations from the
sufficient conditions; section 6 points to previously unnoticed results in the literature
comparing matching and DID to an experimental benchmark and concludes.

2

The setting: a model of the wage process and of
entry into a job training program

In order to give economic content to the results in this paper, I study the canonical
case of a Job Training Program (JTP), as in Heckman and Robb (1985). I model

5

individuals facing an exogenous stochastic wage process and deciding whether or not
to enter a JTP that is available only for one period. As in Heckman and NavarroLozano (2004), I vary the information that agents have when deciding to enter the
program. In the remaining of this section, I describe each component of the model in
turn and I end with a description of the estimation strategies that I am comparing for
the estimation of the average treatment effect on the treated.

Wage dynamics
I use a model of earnings dynamics that nests the two leading views in the literature
on the nature of the labor income process (Meghir and Pistaferri, 2011): the so-called
heterogeneous income profile (HIP), that allows for a random idiosyncratic trend in
income (Guvenen, 2007, 2009), and the restricted income profile (RIP) that does not
(MaCurdy, 1982). The log-wage process of individual i at time t in the absence of the
treatment has the following form:

Yi,t0 = g(Xi , δt ) + µi + βi t + Uit

(1a)

with Ui,t = ρUi,t−1 + m1 vi,t−1 + m2 vi,t−2 + vi,t

(1b)

vi,t i.i.d. mean-zero shocks with finite variance σ 2 ,

(1c)

vi,t ⊥
⊥ (Xi , βi , µi ), ∀t,

(1d)

(Ui,0 , vi,0 , vi,−1 ) mean-zero shocks with covariance matrix Σ0 ,

(1e)

(Ui,0 , vi,0 , vi,−1 ) ⊥
⊥ (Xi , βi , µi , vi,t ), ∀t

(1f)

with µi and βi fixed factors unobserved by the econometrician, Xi a set of observed
variables,1 δt an economy-wide shock and Ui,t an ARMA(1,2) process.2,3 Note that
1

I abstract from the problem of time varying covariates other than past outcomes in this analysis. A previous version of the paper available on my webpage (https://sites.google.com/site/
sylvainchabeferret/research) develops some results for that case.
2
I assume that vi,t is i.i.d. mostly for convenience. The results in this paper could accommodate
heteroskedasticity at the individual level, except for economy-wide variations in the variance of logwages. Then the wage process would not be stationary and symmetric DID would not be consistent.
3
I assume that the error term is an ARMA(1,2) mostly for convenience. The results in this paper
generalize to an arbitrary ARMA(p,q).

6

this model allows for the common time shock to interact with observed characteristics.
I note Σt the covariance matrix of (Ui,t , vi,t , vi,t−1 ) and Σ∞ = limt→∞ Σt . Finally, Yi,t1
denotes the log-wage of agent i after she has received the treatment. I leave this
process unspecified. Let αi,t = Yi,t1 − Yi,t0 denote the individual level causal effect of the
program on log wages.

Selection rule
As in Heckman and Robb (1985) and Heckman, LaLonde, and Smith (1999), agents
are offered the possibility of entering a JTP at period k, and only at this period. I
0
assume that agents consume all their income at each period.4 Let Wi,t
= exp(Yi,t0 )

denote wages in levels, Ti,k transfers received by the agents if they enter the program
and Ci,k direct costs of the program for the agents. Let G denote a time separable
strictly concave utility function,

1
1+r

the discount rate used by the agents and T the

total number of periods of their working life. Maximization of expected discounted
utility yields to the following program participation rule:

ι
Di,k
= 1[E[

TX
−k
j=1

0
1
)
) − G(Wi,k+j
G(Wi,k+j
0
ι
+ G(Ti,k − Ci,k ) − G(Wi,k
)|Ii,k
] ≥ 0].
(1 + r)j

(2)

ι
where Ii,k
, denotes the information set of agent i when she considers entering the

program (more on this below).
In order to simplify the formulation, I assume that G = ln and T → ∞ and that
the effect of the treatment is constant over time (αi,t = αi ,∀t). This yields to the
following simple participation rule:

ι
= 1[
Di,k

αi
0
ι
|Ii,k
] ≥ 0],
− ci − E[Yi,k
r
|
{z
}

(3)

∗ι
Di,k

∗ι
with ci = − ln(Ti,k − Ci,k ) and Di,k
the index measuring the value of entering the
4

Note that I could have assumed perfect credit markets, as in Heckman, LaLonde, and Smith
(1999). Under this assumption, agents would maximize discounted income. It seems more credible
that agents participating in a JTP cannot borrow in order to finance it.

7

program. Selection into the program is driven by gains from program participation
( αri ), direct costs (ci ) and opportunity costs that takes the form of expected forgone
earnings.5 This simple selection rule can generate an Ashenfelter’s dip as long as the
agent’s information set is correlated to transitory idiosyncratic shocks to past earnings.
Note that I allow for αi and ci to be correlated to µi and βi , so that even if the
0
ι
econometrician observes E[Yi,k
|Ii,k
], there still is selection on unobservables. Because

agents can only enter the program at period k, we have:




0

ι
Di,t
=


if t < k
,


D ι

i,k

(4)

if t ≥ k

along with the usual switching model governing observed outcomes:

ι
ι
Yi,t = Di,t
Yi,t1 + (1 − Di,t
)Yi,t0 , if t 6= k,

(5)

ι
0
Yi,k = (1 − Di,k
)Yi,k

(6)

For simplicity, I omit the dependence of Yi,t on ι. Note that wages for the treated are
unobserved at period k, when agents are actually enrolled in the program. We observe
a zero wage, but it is not equal to the wage the agents would have earned had the
program not existed. Because wages are censored at period k, we cannot use period-k
wages as control variables.

Agents’ information set
I vary the information that agents have on their forgone earnings when they consider
entering the program. I consider four different informational contents:

5

I assume that the only uncertainty the agent faces is with respect to forgone earnings. As
suggested by a referee, the agents could also learn about their idiosyncratic gains αi . Modelling
how past earnings inform agents about their gains from program participation is a very nice area for
further research but is beyond the scope of this paper.

8

(i) Agents know all the shocks up to period k:
n

o

f
Iik
= Xi , αi , ci , µi , βi , {δj }kj=0 , {vi,j }kj=0 .

(7)

In that case, because I assume that agents know the parameters of the wage
f
] = Yik0 .
process, they can perfectly forecast their forgone earnings: E[Yik0 |Iik

(ii) Agents does not know the last idiosyncratic shock to their earnings:6
n

o

l
Iik
= Xi , αi , βi , ci , µi , {δj }kj=0 , {vi,j }k−1
j=0 .

(8)

Limited information can arise because agents have to decide whether or not to
enter the program in period k at the end of period k − 1, not knowing the last
innovation to their earnings. Note that in that case they forecast their forgone
l
0
] = g 0 (Xi , δk ) + µi + ρUi,k−1 +
|Ii,k
earnings with the information at hand: E[Yi,k

m1 vi,k−1 + m2 vi,k−2 .
(iii) Agents only know time and individual fixed effects:
n

o

c
Iik
= Xi , αi , ci , µi , βi , {δj }kj=0 .

(9)

With this very coarse information set, there is no Ashenfelter’s dip.
(iv) Agents observe their own earnings up to period k − 1, the overall shocks to the
economy and they have initial information about their unobserved intercept and
trend:
o

n

b
Iik
= Xi , αik , βik , ci , {δj }kj=0 , {Yi,j }k−1
j=0 ,

(10)

where µi = µki +µui and βi = βik +βiu . Agents update their prior on the distribution
of the unobserved variables at every period after observing their realized wage.
The prior has covariance matrix P1|0 . I closely follow Guvenen (2007)’s bayesian
6

Note that I assume that agent know the shock to the overall economy δk . This is only for
comparability with the full information case: I just vary information components one at a time.

9

learning model (see appendix C for a detailed description).

Parameters and estimators
The causal effect of interest is the average treatment effect on the treated τ periods
1
0
ι
after the treatment on log-wages:7 AT Tτ,ι = E[Yi,k+τ
−Yi,k+τ
|Di,k+τ
= 1], where τ > 0.

In order to save notation, I note ∆Yτ,τi 0 = Yi,k+τ − Yi,k−τ 0 , with τ, τ 0 > 0. I compare the
ˆ τ,τ 0 and M̂τ,τ 0 such that, for any (τ, τ 0 ) > 0:8
properties of two estimators, DID
ι
ˆ τ,τ 0 ,ι = E[∆Yi 0 − E[∆Yi 0 |Xi , Dι
plimDID
i,k+τ = 0]|Di,k+τ = 1],
τ,τ
τ,τ
ι
ι
plimM̂τ,τ 0 ,ι = E[Yi,k+τ − E[Yi,k+τ |Xi , Yi,k−τ 0 , Di,k+τ
= 0]|Di,k+τ
= 1].

(11)
(12)

I also consider an unfeasible version of the matching estimator where I allow for con0
. By convention, I write, ∀τ > 0:
ditioning on the censored Yi,k

0
ι
ι
plimM̂τ,0,ι = E[Yi,k+τ − E[Yi,k+τ |Xi , Yi,k
, Di,k+τ
= 0]|Di,k+τ
= 1].

(13)

In this paper, I study the asymptotic bias of these two estimators of AT Tτ :
DID
ˆ
Bτ,τ
0 ,ι = plimDID τ,τ 0 ,ι − AT Tτ,ι

(14)

M
Bτ,τ
0 ,ι = plimM̂τ,τ 0 ,ι − AT Tτ,ι .

(15)

In order to save space, I will note, for any two random variables Ti and Zi , the average
conditional difference between treated and untreated individuals:

ι
ι
= 1] − E[Zi |Ti , Di,k
= 0]
CDι (Zi |Ti ) = E[Zi |Ti , Di,k

7

(16)

Note that it is possible to recover the effect on wages in levels by taking the exponential and
multiplying
by the average earnings of the treated at period k + τ in levels.
√
8
N -consistent estimators of these quantities can be built using results in the literature (Heckman, Ichimura, and Todd, 1998; Hahn, 1998; Hirano, Imbens, and Ridder, 2003; Abadie, 2005).

10

In this section, I will repeatedly use the following results:

M
0
0
ι
ι
Bτ,τ
0 ,ι = E[Yi,k+τ − E[Yi,k+τ |Xi , Yi,k−τ 0 , Di,k+τ = 0]|Di,k+τ = 1],
0
ι
= E[CDι (Yi,k+τ
|Xi , Yi,k−τ 0 )|Di,k+τ
= 1].
Y0

Y0

ι
ι
DID
i
i
Bτ,τ
0 ,ι = E[∆τ,τ 0 − E[∆τ,τ 0 |Xi , Di,k+τ = 0]|Di,k+τ = 1],
Y0

ι
= 1].
= E[CDι (∆τ,τi 0 |Xi )|Di,k+τ

(17)
(18)
(19)
(20)

In section 3, I derive sufficient conditions on the economic model that ensure consistency of these estimators. In section 4, I derive closed form formulas for these bias
terms when all the error terms are normally distributed and I simulate them using
MaCurdy (1982)’s estimates of the wage process. In section 5, I use Monte-Carlo simulations in order to grasp the small sample properties of both estimators. I also test
the sensitivity of my results to the HIP process.

3

Conditions ensuring the consistency of matching
and DID

In this section, I first study in more detail the asymptotic bias of the two estimators,
and I derive conditions for their consistency. I derive two sets of conditions for M̂τ,τ 0 to
ˆ τ,τ 0 and symmetric DID (DID
ˆ τ,τ )
be consistent. I derive sufficient conditions for DID
to be consistent. Under these two sets of restrictions, M̂τ,τ 0 is biased.

Consistency of matching estimators
In this section, I derive a two sets of sufficient conditions for matching estimators using
only one pre-treatment outcome as a control variable to be consistent.
M
Proposition 1 (Infeasible matching) If (µi , βi ) ⊥
⊥ (ci , αi )|Xi , then Bτ,0,f
= 0,

∀τ > 0.
Proof: See in appendix A.
11

Proposition 1 shows that, under full information and if there is no selection on
unobservables, matching on forgone earnings is consistent. Unfortunately, forgone
earnings are generally unobserved, rendering this estimator infeasible. The following
proposition states one set of conditions for a feasible matching estimator with τ 0 > 0
to be consistent:
Proposition 2 (Feasible matching estimator) If Fµ,β is degenerate and if m1 =
M
m2 = 0, then Bτ,1,l
= 0, ∀τ > 0.

Proof: See in appendix A.
Proposition 2 rests on the following decomposition of the bias of matching condi0
) that is an intermediate output of the proof of proposition 2 (it is
tional on (Xi , Yi,k−1

valid for τ ≥ 2):

0
CDι (Yi,k+τ
|Xi , Yi,k−1 ) = (1 − ρτ +1 )CDι (µi |Xi , Yi,k−1 )

(21a)

+ (k + τ − ρτ +1 (k − 1))CDι (βi |Xi , Yi,k−1 )

(21b)

+ ρτ −1 (ρm1 + m2 )CDι (vi,k−1 |Xi , Yi,k−1 )

(21c)

+ ρτ m2 CDι (vi,k−2 |Xi , Yi,k−1 )

(21d)

+ ρτ −2 (ρ2 + ρm1 + m2 )CDι (vi,k |Xi , Yi,k−1 ).

(21e)

The terms (21a) and (21b) are due to selection on the random intercept and random
trend. They cancel out when when Fµ,β is degenerate. The terms (21c) and (21d) are
due to selection on recent shocks through the moving average terms: the econometrician does not observe the outcome of these corrections, but they are correlated with
expected forgone earnings. These terms cancel when m1 = m2 = 0. The last term
(21e) is due to the last shock to earnings that the agent observes under full information
but that the econometrician cannot observe. This term obviously cancels out under
limited information.
Proposition 2 shows that in order to ensure that the feasible matching estimator
is consistent, we need the following conditions: limited information, so that the last
12

shock to the wages is unknown to the agents when they decide to enter the program;
no fixed effects and no moving average terms. These conditions impose selection
l∗
0
=
). Under these restrictions, we indeed have: Di,k
on the observables (Xi , Yi,k−1
αi
r

0
0
− ci − g(Xi , δk ) + ρg(Xi , δk−1 ) − µ(1 − ρ) − Yi,k−1
. As (αi , ci ) ⊥
⊥ Ui,k+τ |(Xi , Yi,k−1
),

l
0
0
we have Di,k
⊥
⊥ Yi,k+τ
|(Xi , Yi,k−1
).

One could argue that conditioning on additional pre-treatment outcomes could
ensure the consistency of matching under less stringent conditions. First, note that the
bias term under full information is due to the last shock to earnings being unobserved
by the econometrician. This is going to remain whatever the amount of pre-treatment
data we observe. Consistency of matching thus at the very least requires limited
information. Second, one could condition on a sufficient statistic for µi , for example
by using the average of pre-treatment wages over T periods. But unfortunately, this
proxy would converge to µi only as T becomes large. Under finite T , this estimator
is biased. This problem is akin to an incidental parameters problem in classical panel
data estimation. Third, it seems that we could get rid of the bias due to the moving
average terms by controlling for two or three pre-treatment periods instead of one.
Fourth, when the agent observes only her own wages up to period k − 1 (ι = b), and
if her initial prior on (αi , βi ) is not informative (i.e. if Fµk ,β k is degenerate), then
matching controlling for all past wages ({Yi,j }k−1
j=0 ) is consistent. Note however that
dimensionality of the control set is very large. I explore how these fixes perform in the
Monte-Carlo simulations presented in section 5.

Consistency of DID estimators
In this section, I state two sets of sufficient conditions for DID matching on Xi to be
unbiased. Under these conditions, matching on (Xi , Yi,k−τ 0 ) is biased. The second set
of conditions allows for an Ashenfelter’s dip.
Proposition 3 (DID without dip) Under coarse information and if Fβ is degenerDID
0
ate, the DID matching estimator is consistent: Bτ,τ
0 ,c = 0, ∀τ, τ > 0. Under the same

13

0
M
set of conditions, matching is biased: Bτ,τ
0 ,c 6= 0, ∀τ, τ > 0.

Proof: See in appendix A.
Proposition 3 thus shows that, in the RIP model, if agents do not know the transitory shocks and there is selection on an unobservable fixed effect, DID is unbiased
whereas matching is. Conditioning on pre-treatment outcomes thus generates bias in
this case: increments are independent of the treatment conditional on Xi , but they
are not independent of treatment conditional on (Xi , Yi,k−τ 0 ). This is because forcing
treated and untreated individuals to have similar pre-treatment outcomes generates
correlation between pre-treatment transitory shocks and the treatment: individuals
having large values of their fixed effects and receiving the same pre-treatment wages
as the treated have experienced a series of negative transitory shocks. The influence
of these shocks is going to progressively fade away, thereby generating bias. Note that
I have assumed away the random trend to obtain this result. With a random trend,
consistency could be restored by using the matching version of the triple difference
estimator of Heckman and Hotz (1989).
The following proposition deals with the more credible case of selection both on
permanent and transitory unobserved income shocks.
Proposition 4 (DID with dip) Under full information, if Fβ is degenerate, |ρ| < 1,
f∗
f∗
, ∀t, the symmetric DID
, Xi ] is linear in Di,k
Σ0 = Σ∞ (or k → ∞) and E[Ui,t |Di,k
DID
matching estimator is consistent: Bτ,τ,f
= 0, ∀τ > 0. Matching is biased under the
M
0
same set of conditions: Bτ,τ
0 ,f 6= 0, ∀τ, τ > 0.

Proof: See in appendix A.
Under the conditions in proposition 4, Ashenfelter’s dip, and thus selection bias, is
symmetric around the treatment date and as a consequence, symmetric DID is consistent. This is an extension of a result of Heckman (1978) to a more complex selection
rule and to the matching version of DID. This result follows from the stationarity of
∗ι
the Ui,t process and the linearity of the expectation of Ui,t conditional on Di,k
that

together imply that the dip forms and dissipates at the same pace.
14

This result rests on the following decomposition of the bias of DID under the
assumption of linear conditional expectation and for ι ∈ {f, l} and (τ, τ 0 ) > 0 (see the
proof of proposition 4):

DID
0
ι
Bτ,τ
0 ,ι = (τ + τ )E[CDι (βi |Xi )|Di,k = 1]



0

(22a)


+ ρτ Var(Ui,k−τ 0 ) − ρτ Var(Ui,k ) Aιk

(22b)

+ 1[ι = l](ρτ −2 )(ρ2 + m1 ρ + m2 )σ 2 Aιk ,

(22c)

Part (22a) of the bias term is due to selection on the random slopes. It disappears
when Fβ is degenerate. The second term is due to selection on transitory shocks.
When τ = τ 0 (i.e. when DID is applied symmetrically), this term cancels out if the
variance of Ui,t is constant over time. This is the case when the ARMA process is at
its long run equilibrium.9 Finally, the last term is due to limited information: when
agents do not know the last shock to their earnings, the covariance between Ui,k+τ and
the treatment index is not proportional to the variance of Ui,k . This term cancels out
under full information.
Matching is biased in this model for three reasons: first, the selection on unobserved
fixed effects (equation (21a)), second, the selection on the unobserved shock to earnings
at period k (equation (21e)) and finally the relative composition of recent vs past shocks
due to the moving average terms (equations (21c) and (21d)).

Discussion
The general take away message of this section is that it is possible to find restrictions
that ensure that either matching or DID are consistent. A nice feature of DID is that
9

Note that if Ui,t follows a random walk (i.e. ρ = 1), the long run variance is infinite and the
process has no long run equilibrium. The variance of Ui,t increases with t and as a consequence, the
bias term (22b) is negative and DID underestimates the true treatment effect. Note that when ρ = 1,
it is possible to use a modified version of an insight of Heckman (1978) to build a consistent DID
estimator with the additional assumption that Fµ is degenerate. In a random walk, the variance is
proportional to time. If Fµ,β is degenerate and under full information, the bias term (22b) is equal
k−3
to the difference in variances at periods k − τ 0 and k. Properly rescaling Yi,k−τ 0 by a factor k−τ
0 −3
cancels this bias term. This assumes that the order of the MA component is known.

15

it can get rid of selection bias due both to unobserved fixed effects and time-varying
idiosyncratic shocks when applied symmetrically around the treatment date. I have
not been able to find instances where matching is consistent without assuming away
selection on the fixed effects.
I have stated two sets of restrictions under which DID is consistent whereas matching is biased. Thus, contrary to what Imbens and Wooldridge (2009)’s citation seems
to suggest, it is possible to find instances where the DID assumptions are more credible than the unconfoundedness based approach. Furthermore, this result still holds
even when assuming away selection on fixed effects and allowing for selection on timevarying idiosyncratic shocks. Symmetric DID is consistent in that case, under a set of
restrictions that I make precise. Under the same set of restrictions, matching is biased.
In order to assess the empirical relevance of these results, I compare the restrictions
that ensure the consistency of each estimator with estimates taken from the literature
on earnings dynamics. There is a heated debate in the literature on empirical income
dynamics as to whether random slopes and intercepts are needed to account for income
dynamics or not. The Heterogeneous Income Profile (HIP) model advocated by Guvenen (2007) includes these terms. The Restricted Income Profile (RIP) model does not
(MaCurdy, 1982). The theoretical advantage of symmetric DID (being able to solve
both selection on a fixed effect and time varying selection bias) does thus not import
in practice. Under the HIP, the random trend term biases both symmetric DID and
matching.
Under the RIP, both estimators can be consistent. Apart from specific restrictions
on agent’s information set, the consistency of symmetric DID also requires stationarity
and linearity of conditional expectations while that of matching requires the absence of
MA terms. It is a general result from the literature estimating earnings processes that
MA terms are needed to account for their dynamics and that the variance of earnings
increases over time (MaCurdy, 1982; Meghir and Pistaferri, 2011). As a consequence,
both estimators are likely to be biased in applications. Note that symmetric DID could
be unbiased when the variance of the Ui,t process stabilizes (if it ever does). In general,
16

authors using the RIP model impose the existence of permanent shocks following a
random walk (ρ = 1). MaCurdy (1982)’s estimates for ρ oscillate between 0.975
and 0.995. This is very close to a random walk (MaCurdy (1982) does not reject the
existence of a random walk) but these coefficients still characterize a stationary process.
The main problem for symmetric DID is that these coefficients imply that reaching
the long run stable distribution can take time. Finally, the linearity of the conditional
expectation may seem rather restrictive. It is obviously true for jointly normally
distributed variables, but is also a property of the much larger family of elliptical
disturbances (Chu, 1973), that include Student’s t and the Cauchy distributions for
example.
Overall, the conditions for the consistency of both estimators seem to be at odds
with stylized properties of earnings processes. But these biases may be small in real
applications. In what follows, I assess the relative severity of these biases using a
calibration exercise and Monte-Carlo simulations.

4

Calibration results: size of the bias of matching
and DID in the RIP model

The aim of this section is to gain more insight in the sources of bias of both estimators
in the RIP model and to assess the likely importance of the bias of matching under
limited information, where only MA terms are at play. I derive closed form formulas
for the asymptotic bias terms of matching and DID in the model laid out in section 2
under the RIP, with error terms at their long run equilibrium and in the case of normally distributed error terms. I then calibrate these formulas with MaCurdy (1982)’s
estimates of the wage process and compare the size of the bias of these two estimators
as a function of the period at which we control for and the agent’s information set.
The derivation of the bias terms under normally distributed disturbances can be found
in appendix B.

17

Figure 1 presents the absolute values of the bias terms of DID matching (equation
19) and simple matching (equation 17) with the values of the parameters estimated by
MaCurdy (1982) under two information sets: full and limited. This figure illustrates
the results from previous section and allows to compute how the asymptotic bias varies
when moving away from the conditions ensuring consistency.
Figure 1 – Absolute value of bias of matching and DID for τ = 4 under the
RIP and with a stationary ARMA process
●

0.5

●

0.4

●

●

Matching
DID
Matching shock
DID shock

●
●
●

τ=4
σµ2 = 0
ρ = 0.99
σα2 = 0
m1 = −0.4
σc2 = 0.055
ρµc = 0
m2 = −0.1
ρµα = 0
α = 0.1
c=3
σY2 = 0.722
σ2 = 0.055
σD2 = 0.777
σU2 = 0.722 σD2shock = 0.722

0.3

●

0.2

●

0.0

0.1

Absolute value of bias

●

●

●

0

2

4

6
τ

8

10

'

Note: the value of the bias for DID (resp. simple) matching are the absolute values of the terms in
equation (19) (resp. (17)) under full information (ι = f ) computed in appendix B and calibrated with
MaCurdy (1982)’s estimates of the log-wage process. τ indicates the number of period after assignment to
treatment. τ 0 measures the period at which matching is performed. (shock) corresponds to the value of the
corresponding terms under limited information ι = l (i.e. when vi,k is not observed when the individual
decides to participate).

Note first that, under full information, the infeasible matching estimator that con0
trols for the unobserved opportunity cost of the treatment (Yi,k
) is consistent. This

is because MaCurdy (1982) estimates that the variance of the fixed effect µi is null,
thereby complying with the conditions of proposition 1. Moving from this infeasible
estimator to the next best feasible alternative, matching on Yi,k−1 , generates bias.
With MaCurdy (1982)’s estimates of the wage process, this bias is equal to 200% of
the assumed treatment effect (0.1). There is thus a very large loss when moving from
the infeasible matching estimator to the feasible one.

18

Figure 2(a) provides an illustration of what drives the bias in matching under full
information. This figure represents the average potential outcomes in the absence of
the treatment (Yi,t0 ) for the treated, the untreated and the matched untreated, i.e.
the untreated agents that have the same potential outcomes at period k − 1 as the
treated.10
Figure 2 – Evolution of average potential outcomes for the treated, the
untreated and the matched untreated under the RIP and with a
stationary ARMA process

0.0
−1.0

−0.5

Mean log wage residual

0.0
−0.5

σµ2 = 0
σα2 = 0
σc2 = 0.055
ρµc = 0
ρµα = 0
σY2 = 0.722
σD2 = 0.722

τ' = 1
ρ = 0.99
m1 = −0.4
m2 = −0.1
α = 0.1
c=3
σ2 = 0.055
σU2 = 0.722

D=0
Matched
D=1

●

−1.0

Mean log wage residual

●

σµ2 = 0
σα2 = 0
σc2 = 0.055
ρµc = 0
ρµα = 0
σY2 = 0.722
σD2 = 0.777

τ' = 1
ρ = 0.99
m1 = −0.4
m2 = −0.1
α = 0.1
c=3
σ2 = 0.055
σU2 = 0.722

D=0
Matched
D=1

●

●

●

●

●

●

●

●

●

●

●

●

●

●

●

●

●

●

●

●
●

●

●

●

●

●

●

−10

−5

0

5

10

−10

τ

−5

●

●

●

●

●

●

●

●

●

●

●

●

●

●

●

0

5

10

τ

(a) Full information

(b) Incomplete information

Note: this figure plots the average potential outcomes in the absence of the treatment net of economywide shocks for three groups: the treated (◦), the untreated (×) and the matched untreated (4), i.e.
untreated that have the same potential outcomes at period k − 1 as the treated. Because the variance of
ι
ι
µ is null in these simulations, these curves respectively stand for E[Ui,k+τ |Di,k
= 1], E[Ui,k+τ |Di,k
= 0]
ι
ι
and E[E[Ui,k+τ |Di,k
= 0, Yi,k−1 ]Di,k
= 1]. The outcomes are simulated from the formulas derived in
appendix B calibrated with MaCurdy (1982)’s estimates of the log-wage process. τ indicates the number
of period after assignment to treatment. τ 0 measures the period at which matching is performed. ρ is
the autocorrelation parameter. (shock) corresponds to the value of the corresponding terms under limited
information ι = l (i.e. when vi,k is not observed when the individual decides to participate).

The difference between the treated and the untreated measures overall selection
bias before matching. The difference between the treated and the matched untreated
measures the bias of the matching estimator. The difference in the difference between
the treated and the untreated at period k + τ and at period k − τ 0 measures the bias
of the DID estimator applied at both periods.
10

I choose to present these averages net of the economy-wide shocks g(Xi , δt ), in order to make
the graph more easy to read. Because the variance of µ is null in these simulations, these curves
ι
ι
ι
ι
respectively stand for E[Ui,k+τ |Di,k
= 1], E[Ui,k+τ |Di,k
= 0] and E[E[Ui,k+τ |Di,k
= 0, Yi,k−1 ]Di,k
=
1].

19

We can see that the treated experience a transitory decrease in their earnings when
they enter the treatment: this is Ashenfelter’s dip. It is due to a series of negative
transitory shocks that drives the opportunity cost of entering the treatment down.
Matching on Yi,k−1 imperfectly mimics this process. It selects untreated individuals
that also experience a series of negative transitory shocks up to period k − 1. But,
under full information, these individuals do not participate because they receive good
news on their earnings at period k (e.g. they expect to receive a promotion or a
bonus) which drives their opportunity cost of entering the treatment up and drives
them out of the treatment. At the same time, this last unobserved shock persists and
creates a wedge between the average wages of the treated and that of their matched
counterparts. This yields to negative selection bias and would underestimate the true
effect of the treatment.
The second lesson from figure 1 is that DID applied symmetrically around the
treatment date (here at τ 0 = 4 = τ ) is consistent under full information. This is an
instance of the more general result of proposition 4. Figure 2(a) illustrates why this
estimator is unbiased: Ashenfelter’s dip is symmetric, and thus selection bias forms
and dissipates at the same pace around the treatment date.
The third lesson from figure 1 is that DID is inconsistent under limited information,
as was expected after the results in the previous section. DID is biased because
Ashenfelter’s dip is no longer symmetric: agents do not know the last shock to their
earnings and thus the covariance between wages and the selection index is larger before
the treatment date. The lower point of the dip is at k − 1, and thus selection bias
is not symmetric around the treatment date, nor is it around k − 1 for that matter.
Note that it seems that DID is consistent under limited information for τ 0 = 8 = 2τ .
This result is an artifact from improper scaling: the true bias term is non null, albeit
very close to zero. Indeed, because selection bias is larger in pre-treatment periods, we
have to go further away in time to find a period where pre-treatment selection bias is
similar to the post-treatment one. The fact that this happens at τ 0 = 2τ is an artifact

20

from the parameterization, and does not seem to be a general result.11 Note that the
bias term is positive in that case: DID overestimates the true treatment effect, because
it overestimates the size of the selection bias.
The fourth lesson from figure 1 is that matching is also inconsistent under limited
information, as was expected after the results in the previous section. Since there are
no fixed effects under MaCurdy (1982)’s parameterization, the bias term of matching
under limited information is due to the moving average terms. Figure 2(b) illustrates
this result: before period k − 1, the matched untreated have higher earnings than the
treated. They thus experience a sharper decrease in their earnings just before period
k − 1, that makes them comparable to the treated. These very shocks are nevertheless
corrected by the negative moving average terms (not all the innovation passes through
to the next period). This correction yields to slightly higher wages for the matched
untreated at period k that persist thereafter, generating negative selection bias and
an underestimation of the true treatment effect.
The last lesson drawn from figure 1 is the relative size of the asymptotic bias terms
of matching and DID matching under limited information. Matching at period k − 1
yields a sizable bias term of 95% of the treatment effect. Symmetric DID matching
generates a lower bias of 65% of the treatment effect. It thus seems that symmetric
DID matching is to be preferred even under limited information.
These results nevertheless require the RIP, that the initial conditions are set at their
long run values and that we use only one period of lagged outcomes as control variables.
In the next section, I perform Monte-Carlo simulations to assess the sensitivity of these
results to deviations from these assumptions.

In fact, using equation (22), one can show that the bias of DID cancels when τ 0 = τ + 2, under
limited information and when both MA terms are null. In the presence of MA terms, this result does
not hold.
11

21

5

Simulation results: sensitivity of matching and
DID to deviations from optimal conditions

In this section, I present results from Monte-Carlo simulations assessing the small
sample performances of matching and DID and the sensitivity of both estimators to
deviations from the conditions ensuring their consistency. I simulate both the HIP and
the RIP versions of earnings dynamics varying initial conditions, agents’ information
set and the number of pre-treatment outcomes used as control variables.

Setting
The wage process is simulated according to equation (1). Time goes from t = 1 to
t = 40, in order to model the working lifetime of an individual. The set of control
variables Xi includes years of education Ei and experience Ai,t . The function g has
two distinct additive parts: returns to schooling and experience. The latter is modeled
as in Browning, Ejrnaes, and Alvarez (2010): 8.83 + 0.56Ai,t − 0.057A2i,t , with Ai,t age
in decades (Ai,t = (18 + t)/10). The former includes time varying returns to education
in order to capture individual specific responses to economy-wide shocks: δt Ei , where
Ei follows a lognormal distribution with parameters 2.3 and 0.2, which yields to 10.17
years of education on average. I model education as a continuous variable in order
to avoid matching on discrete covariates. δt = δ + rt d, with δ = 0.08, d = 0.02 and
rt follows a uniform distribution on [0, 1]. For the RIP process, I impose βi = 0,
∀i and use MaCurdy (1982)’s estimates of the wage process (see appendix C for the
detailed parameterization). Note that MaCurdy (1982) finds that µi = 0, ∀i. For
the HIP process, I use the parameters estimated by Guvenen (2007). I consider two
different types of initial conditions: either the first shocks are drawn from the long run
distribution (Σ0 = Σ∞ ) or there is only one shock vi,0 with variance σ, Ui,0 = vi,0 and
vi,−1 = 0, ∀i. All the disturbances are normally distributed.
For the selection equation, I use equation (3). I add a linear term βx Ei to generate

22

selection on education. With the RIP (resp. HIP) model, I allow for both full information and limited information (resp. bayesian updating). Bayesian updating closely
follows Guvenen (2007)’s Kalman filter approach and is described in appendix C. At
each period, the agent uses her observed log-wages up to the previous period to update
her prior about (µi , βi , Ui,t ). This enables her in turn to forecast her forgone log wage.
I use the same starting values for the prior distribution of (µi , βi , Ui,0 ) as in Guvenen
(2007): the agent knows nothing of µi (µki = 0, ∀i) and knows βik . The variance of βik
is a fraction (1 − λ) of the variance of βi . I use Guvenen (2007)’s preferred estimates
for λ: 0.6. I also vary the treatment date by making the program available at periods
5, 10, 20 or 30.
I use the Local Linear Regression (LLR) Matching on the propensity score estimator proposed by Heckman, Ichimura, and Todd (1998). I follow closely Smith and
Todd (2005) for the implementation. I first estimate a linear probit and use predicted
values as the propensity score. I exclude observations not on the common support. I
also trim the data in order to avoid well known problems with LLR at low densities in
small samples (Frölich, 2004). Because matching on past outcomes drastically reduces
the variance of the propensity score, I have to use a large trimming level (0.4). I use
a biweight kernel. There is no agreed upon method to select the optimal bandwith
for matching. After experimenting with the data, I set the bandwidth at 0.15. I experiment with four different sets of control variables: Ei alone, or Ei supplemented
with {Yi,k−j }τj=1 , with τ ∈ {1, 2, 3}. DID-matching is always implemented symmetrically around treatment period k and outcomes are measured at period k + 4. For the
Monte-Carlo simulations, I draw 500 samples with 1000 individuals each.

Results
I investigate the respective performances of matching and DID when conditions for
their consistency are relaxed. I examine in turn the role of initial conditions,12 in12

Note that with an AR term very close to one, altering initial conditions is very similar to allowing
for a a random walk.

23

formation and finally the importance of the income process (HIP vs RIP). I interpret
the consequences of relaxing these assumptions thanks to the decomposition of the
bias terms of both estimators in equations (21) and (22). I also report results on the
sensitivity of these estimators to the number of lagged pre-treatment outcomes used
as control variables.

Initial conditions
The bias of matching should not be altered dramatically by changing the initial conditions of the ARMA process. Indeed, only the most recent shocks play a role in the bias
term. This is not the case for DID. Moving from equilibrium long run initial conditions
to off-equilibrium short run ones prevents term (22b) to cancel out: the variance of
Ui,t now varies with t. In the Monte-Carlo simulations, I start with an initial shock
whose variance is lower than the long run variance σU2 ∞ . Because Aιk is always positive,13 term (22b) is negative and DID underestimates the true treatment effect. This
is because the pre-treatment average difference in outcomes between participants and
non participants is lower in absolute value than the post-treatment difference.
The comparison of panels (a) and (c) in figures 3, 4, 5 and 6 confirms this analysis:
matching is not sensitive to changes in initial conditions while DID estimates are
always lower under short run initial conditions. DID is severely biased under short
run initial conditions, but because the variance of Ui,t increases with time, this bias
decreases with experience. Under the RIP, at period 30, symmetric DID has the lowest
absolute mean bias and MSE of all the estimators, as figures 3 and 4 show. Because it
takes almost 100 periods for the Ui,t process to reach the long run stable distribution,
symmetric DID is nevertheless still biased after 30 periods.

ι∗
The average difference between Di,k
and its mean conditional on Xi is indeed positive for the
treated and negative for the untreated, so that their difference is always positive.
13

24

0.04

●

●

●

MSE

0.01

−0.10

●

●

5

10

5

10

15

20

25

30

15

Periods

20

25

30

Periods

(b) Long run, MSE

●

0.03

−0.05

0.04

0.00

0.05

(a) Long run, Bias

●

MSE

−0.10

●

0.02

●

−0.15

Average bias

●

●

0.00

−0.20

−0.15

Average bias

0.02

0.03

●

−0.05

0.00

Figure 3 – Mean bias and MSE of matching and symmetric DID-matching
in the RIP under full information by type of initial condition

●

0.01

●

0.00

−0.20

●

●

5

10

15

20

25

30

5

Periods

10

15

20

25

30

Periods

(c) Short run, Bias

(d) Short run, MSE

Legend: ◦, 4, + and × respectively stand for 0, 1, 2 and 3 periods of lagged outcomes as control variables.
Solid lines are for symmetric DID and dotted lines for matching.
Note: mean bias and mean squared error (MSE) are calculated thanks to 500 Monte-Carlo replications.
Each sample contains 1000 individuals with roughly 100 to 200 participants. The parameterization of
the wage process uses MaCurdy (1982)’s estimates. “Long run” (resp. “short run”) stands for the initial
conditions of the ARMA process being drawn in the long run stable distribution (resp. in the distribution of
the idiosyncratic shock vi,t ). The bias is estimated using local linear regression matching on the propensity
score with a biweight kernel. The bandwidth is set to 0.15 and the trimming level is set to 0.4. The model
and its parameterization are detailed in appendix C.

25

●

●

0.010

0.00

MSE

0.015

●

−0.05

Average bias

0.05

●

0.020

0.10

0.025

Figure 4 – Mean bias and MSE of matching and symmetric DID-matching
in the RIP under limited information by type of initial condition

●

0.005
0.000

−0.10

●

●

●

5

10

15

20

25

30

5

10

15

Periods

20

25

30

Periods

(b) Long run, MSE

●

MSE

0.010

0.00

●

●
●

0.005

−0.05

Average bias

0.05

0.015

0.10

0.15

0.020

(a) Long run, Bias

−0.10

●

●
●

0.000

−0.15

●

5

10

15

20

25

30

5

Periods

10

15

20

25

30

Periods

(c) Short run, Bias

(d) Short run, MSE

Legend: ◦, 4, + and × respectively stand for 0, 1, 2 and 3 periods of lagged outcomes as control variables.
Solid lines are for symmetric DID and dotted lines for matching.
Note: mean bias and mean squared error (MSE) are calculated thanks to 500 Monte-Carlo replications.
Each sample contains 1000 individuals with roughly 100 to 200 participants. The parameterization of
the wage process uses MaCurdy (1982)’s estimates. “Long run” (resp. “short run”) stands for the initial
conditions of the ARMA process being drawn in the long run stable distribution (resp. in the distribution of
the idiosyncratic shock vi,t ). The bias is estimated using local linear regression matching on the propensity
score with a biweight kernel. The bandwidth is set to 0.15 and the trimming level is set to 0.4. The model
and its parameterization are detailed in appendix C.

26

Information
Moving from limited information (or bayesian updating) to full information adds the
term (21e) to the bias of the matching estimator. This term is negative (the last shock
to earnings is lower for participants). As a consequence, matching must underestimate
the true treatment effect under full information. As for DID, moving from full information to limited information adds the bias term (22c). This term is positive and is
due to the fact that when agents do not know the period k shock to their earnings, the
covariance between future income and treatment utility is weaker than that between
past income and treatment utility. As a consequence, DID must overestimate the true
treatment effect under limited information.
This is what we observe when comparing figures 3 and 4 and figures 5 and 6:
the matching and DID estimates always decrease when moving from limited to full
information.

HIP vs RIP
Moving form the RIP to the HIP adds the random intercept and slope terms (21a) and
(21b) to the bias of matching and the term (22a) to the bias of DID. We suspect that
they are all negative, as individuals with high productivity level and/or growth will
tend to select out of the treatment as their unobserved opportunity cost will be higher.
This is true in the long run, after roughly 20 years, when random slopes start kicking
in (see figures figures 5 and 6). The bias due to the random intercept (21a) should
kick in immediately, at least under full information, but it does not seem to make a
difference in the simulations during the first periods. It may be because the variance
of µi is small. One obvious way to get around the bias due to the random trend in the
HIP would be to implement a symmetric version of Heckman and Hotz (1989) triple
difference estimator. Another solution would be to condition on averages of past logwages and past variations in log-wages in a matching procedure.14 I experiment with

14

I thank an anonymous referee for suggesting this approach.

27

both approaches in Monte-Carlo results not shown here. The former approach works
very well under bayesian updating, with a remaining downward bias oscillating between
-0.01 and -0.04. The latter approach works extremely well under full information, but
only at later periods (when k ≥ 20).

Increasing the number of pre-treatment outcomes used as control variables
Finally, adding more pre-treatment outcomes to the set of control variables almost
always decreases the bias of matching estimators. First, under the RIP and limited
information, the MA terms still generate a sizable bias when controlling for only one
pre-treatment outcome: this bias is on average -0.05 with long run initial conditions
(figure 4(a)), confirming the results of section 4. Adding Yi,k−2 as a control variable
almost completely cancels the bias. At the same time, adding also Yi,k−3 does a
little worse. The bias of matching always decreases when adding more pre-treatment
outcomes as control variables in all the remaining experiments. The same is not true
for DID. Under the RIP, adding more control variables may or may not decrease the
bias of DID. Under the HIP, adding more control variables to the DID estimator
generally decreases its mean bias.

DID vs matching
To sum up the results of this section, although matching is generally not consistent
under credible parameterizations, it is less sensitive to deviations from the most favorable setting. It is not sensitive to initial conditions, generally underestimates the
true treatment and thus provides a useful lower bound. Note that matching provides
a lower bound in the HIP because I have assumed that the direct costs of entering the
JTP (ci ) are independent of the random slope and intercept µi and βi . Allowing for
costs to be decreasing with both terms could reverse this effect. Finally, when more
pre-treatment outcomes are added to the set of control variables, the bias of matching
generally decreases in absolute value. Note that the RIP and with under limited information, controlling for additional pre-treatment outcomes almost completely cancels
28

Figure 5 – Mean bias and MSE of matching and symmetric DID-matching
in the HIP under full information by type of initial condition

0.10

0.00

●

0.08

−0.05

●

●

MSE

0.06

−0.10

●

0.04

−0.15

Average bias

●

●

0.02

−0.20

●

●

0.00

−0.25

●
●

5

10

15

20

25

30

●

5

10

15

Periods

20

25

30

Periods

(a) Long run, Bias

(b) Long run, MSE

0.08
0.06

−0.05

0.00

●

●

−0.10

0.04

MSE

●

−0.15

Average bias

●

●

●

−0.20

●

0.02

●

−0.25

●
●

0.00

●

5

10

15

20

25

30

5

10

15

20

25

30

●

Periods

Periods

(c) Short run, Bias

(d) Short run, MSE

Legend: ◦, 4, + and × respectively stand for 0, 1, 2 and 3 periods of lagged outcomes as control variables.
Solid lines are for symmetric DID and dotted lines for matching.
Note: mean bias and mean squared error (MSE) are calculated thanks to 500 Monte-Carlo replications.
Each sample contains 1000 individuals with roughly 100 to 200 participants. The parameterization of
the wage process uses Guvenen (2007)’s estimates. “Long run” (resp. “short run”) stands for the initial
conditions of the ARMA process being drawn in the long run stable distribution (resp. in the distribution of
the idiosyncratic shock vi,t ). The bias is estimated using local linear regression matching on the propensity
score with a biweight kernel. The bandwidth is set to 0.15 and the trimming level is set to 0.4. The model
and its parameterization are detailed in appendix C.

29

0.15

0.035

Figure 6 – Mean bias and MSE of matching and symmetric DID-matching
in the HIP under bayesian updating by type of initial condition

0.025
0.020

MSE

●

●

0.010

0.015

0.00

●

−0.05

Average bias

0.05

0.10

0.030

●

−0.10

●

●

0.005

●

0.000

−0.15

●

5

10

15

20

25

30

5

10

15

20

25

30

●

Periods

Periods

(a) Long run, Bias

(b) Long run, MSE

●

0.03

0.05

●

0.02

MSE

−0.05

●

●

0.01

−0.10

Average bias

0.00

●

●
●

●

0.00

−0.15

●

●
5

10

15

20

25

30

5

Periods

10

15

20

25

30

Periods

(c) Short run, Bias

(d) Short run, MSE

Legend: ◦, 4, + and × respectively stand for 0, 1, 2 and 3 periods of lagged outcomes as control variables.
Solid lines are for symmetric DID and dotted lines for matching.
Note: mean bias and mean squared error (MSE) are calculated thanks to 500 Monte-Carlo replications.
Each sample contains 1000 individuals with roughly 100 to 200 participants. The parameterization of
the wage process uses Guvenen (2007)’s estimates. “Long run” (resp. “short run”) stands for the initial
conditions of the ARMA process being drawn in the long run stable distribution (resp. in the distribution of
the idiosyncratic shock vi,t ). The bias is estimated using local linear regression matching on the propensity
score with a biweight kernel. The bandwidth is set to 0.15 and the trimming level is set to 0.4. The model
and its parameterization are detailed in appendix C.

30

the remaining bias due to the MA terms.
DID is consistent under plausible conditions, but is much more sensitive to deviations from these conditions. Moreover, the bias generated by deviations from these
conditions does not always go in the same direction: lower initial variance of the
ARMA process yields to an underestimation of the treatment effect, as do the introduction of a random slope, whereas limited information yields to an overestimation of
the true treatment effect. Results from the simulations do not suggest that the size of
either the overestimation or the underestimation are innocuous. Finally, adding more
control variables may increase bias in absolute value, but it can also decrease it.
Ideally, one would like to test for some of these conditions so as to discard some
possible sources of bias. For example, if it was possible to choose either the HIP or the
RIP and to know the distribution of the initial conditions, the only remaining source
of uncertainty would be about agents’ information set. Under the RIP and with long
run initial conditions, DID overestimates the true treatment effect. The combination
of matching and DID would then yield bounds on the true treatment effect. Under the
HIP, controlling for more periods would decrease absolute bias, but it would not be
possible to know whether DID overestimates (limited information) or underestimates
(full information) the true effect.
Unfortunately, it is very hard to differentiate the HIP from the RIP (Guvenen,
2009). Indeed, rejecting the common trend assumption on pre-treatment data, as
suggested by Heckman and Hotz (1989), can be a sign of the HIP or of an Ashenfelter’s
dip. As Guvenen (2009) shows, autocovariances of wage innovations are equal to the
sum of the variance of the random trend and the effect of persistent shocks (when
ρ < 1). In the long run, this second term eventually vanishes. But tests using this
insight lack power with finite autocovariances (Guvenen, 2009). Hryshko (2012) argues
that using all the autocovariances at once identifies the variance of the random trend
(and that it is zero). This is an important area for further research.

31

6

Discussion

Only results from applied work comparing both matching and DID to an experimental
benchmark can provide evidence on whether the consistency of DID is overturned in
practice by its sensitivity to deviations from the conditions ensuring its consistency.
Indeed, previously unnoticed results in Heckman, Ichimura, Smith, and Todd (1998)
and Smith and Todd (2005) provide evidence that DID is stable and most often the
least biased estimator in empirical applications.15 Heckman, Ichimura, Smith, and
Todd (1998, p.1062) compare the relative ability of different sets of control variables
to reproduce the experimental results of the evaluation of the Job Training Partnership
Act (JTPA) thanks to matching and DID matching. When using a crude control set
not including wages at the date of enrollment, the average bias of the symmetric DID
estimator is of 73 % of the treatment effect, lower than that obtained with matching on
past wages at enrollment and labor market transitions (382 % of the treatment effect).
Note however that the inclusion of labor market transitions, a topic not discussed
in this paper, improves the performance of matching noticeably (58% to 88% of the
treatment effect). Note that matching still does not outperform symmetric DID in that
case. Smith and Todd (2005) use two sets of control variables when estimating the
bias of propensity score matching and DID propensity score matching in the National
Support for Work experimental study: the first set (they name it the Lalonde set) does
not contain past income while the second set (the Dehejia and Wahba (DW) set) does
contain past income. When they apply DID matching with the first set of controls,
the bias is of respectively -2 %, 22 % and -16 % of the treatment effect when using
the most efficient matching estimators (respectively nearest neighbour matching with
one neighbour restricted to the common support, local linear matching with a small
15

Note nevertheless that these papers apply matching and DID matching to earnings in levels, not
in logarithms, as I study in this paper. This does not change the symmetry property of Ashenfelter’s
dip, because taking the exponential of both the selection index and earnings preserves the ellipticity
of their joint distribution. This is confirmed in Monte-Carlo simulations not presented here. The
main problem comes from the assumption on parallel trend: it is not fulfilled anymore because trends
are now exponential. This is mitigated in the studies under investigation as the time scope is rather
small.

32

bandwith (1.0) and local linear regression adjusted matching with the same bandwith,
see their table 6 p.340). When using matching controlling for past outcomes, the bias
is larger: respectively -95 %, -156 % and -159 % with the same estimators (see their
table 5, p.336). In both of these works, matching generally underestimates the true
treatment effect and adding past outcomes in the set of control variables when using
matching decreases selection bias, as results in this paper predict.
Overall, the results presented in this paper tend to mitigate Imbens and Wooldridge
(2009)’s statement that matching is more credible than DID. In the context of JTP,
credible conditions for the consistency of symmetric DID matching can be stated
whereas the conditions I have been able to state in order to ensure the consistency of
matching contradict important properties of empirical earnings processes. Matching is
nevertheless more stable: it is less sensitive to deviations from the conditions ensuring
its consistency, generally yields a lower bound and its bias decreases with the number
of pre-treatment outcomes included in the set of control variables.
In view of the results in this paper, what is an empirical researcher to do when
evaluating a JTP with panel data? First, it seems recommended to apply DID symmetrically around the treatment date. Second, comparing the results of symmetric
DID with those of matching would give a sense of how sensitive the results are to the
sources of bias delineated in this paper.
Devising procedures for testing whether the conditions ensuring the consistency
of symmetric DID are met is an interesting avenue for further research. This would
involve telling apart HIP from RIP (a very difficult undertaking from income data alone
(Guvenen, 2009; Hryshko, 2012)); inferring agents’ information set when entering the
treatment, using insights from Cunha, Heckman, and Navarro-Lozano (2005); and
testing for initial conditions.

33

References
Abadie, A. (2005): “Semiparametric Difference-in-Differences Estimators,” Review
of Economic Studies, 72(1), 1–19.
Arnold, B., R. Beaver, R. Groeneveld, and W. Meeker (1993): “The Nontruncated Marginal of a Truncated Bivariate Normal Distribution,” Psychometrika,
58(3), 471–488.
Ashenfelter, O. (1978): “Estimating the Effect of Training Programs on Earnings,”
The Review of Economics and Statistics, 60(1), 47–57.
Balineau, G. (2012): “Disentangling the Effects of Fair Trade on the Quality of
Malian Cotton,” FERDI Working Paper 39.
Bhattacharya, J., and W. B. Vogt (2007): “Do Instrumental Variables Belong
in Propensity Scores?,” NBER Working Paper 343.
Browning, M., M. Ejrnaes, and J. Alvarez (2010): “Modelling Income Processes with Lots of Heterogeneity,” Review of Economic Studies, 77(4), 1353–1381.
Chabé-Ferret, S., and J. Subervie (Forthcoming): “How Much Green for the
Buck? Estimating Additional and Windfall Effects of French Agro-Environmental
Schemes by Difference-In-Difference Matching,” Journal of Environmental Economics and Management.
Chu, K.-C. (1973): “Estimation and Decision for Linear Systems with Elliptical
Random Processes ,” IEEE Transactions on Automatic Control, 18(5), 199–505.
Cunha, F., J. J. Heckman, and S. Navarro-Lozano (2005): “Separating Uncertainty from Heterogeneity in Life Cycle Earnings, the 2004 Hicks Lecture,” Oxford
Economic Papers, 57(2), 191–261.
Dawid, A. P. (1979): “Conditional Independence in Statistical Theory,” Journal of
the Royal Statistical Society. Series B (Methodological), 41(1), 1–31.
34

Frölich, M. (2004): “Finite-Sample Properties of Propensity-Score Matching and
Weighting Estimators,” Review of Economics and Statistics, 86(1), 77–90.
Gobillon, L., T. Magnac, and H. Selod (2010): “Do Unemployed Workers
Benefit from Enterprise Zones? The French Experience,” IDEI Working Paper 645.
Guvenen, F. (2007): “Learning Your Earning: Are Labor Income Shocks Really
Very Persistent?,” American Economic Review, 97(3), 687 – 712.
(2009): “An Empirical Investigation of Labor Income Processes,” Review of
Economic Dynamics, 12(1), 58–79.
Hahn, J. (1998): “On the Role of the Propensity Score in Efficient Semiparametric
Estimation of Average Treatment Effects,” Econometrica, 66(2), 315–331.
Heckman, J., H. Ichimura, J. Smith, and P. Todd (1996): “Sources of selection bias in evaluating social programs: An interpretation of conventional measures
and evidence on the effectiveness of matching as a program evaluation method,”
Proceedings of the National Academy of Sciences, 93(23), 13416–13420.
Heckman, J. J. (1978): “Longitudinal Studies in Labor Economics: A Methodological Review,” Mimeo, University of Chicago.
Heckman, J. J., and V. J. Hotz (1989): “Choosing Among Alternative Nonexperimental Methods for Estimating the Impact of Social Programs: the Case
of Manpower Training,” Journal of the American Statistical Association, 84(408),
862–874.
Heckman, J. J., H. Ichimura, J. Smith, and P. Todd (1998): “Characterizing
Selection Bias Using Experimental Data,” Econometrica, 66, 1017–1099.
Heckman, J. J., H. Ichimura, and P. Todd (1998): “Matching as an Econometric
Evaluation Estimator,” The Review of Economic Studies, 65(2), 261–294.

35

Heckman, J. J., R. J. LaLonde, and J. A. Smith (1999): “The Economics and
Econometrics of Active Labor Market Programs,” in Handbook of Labor Economics,
ed. by O. C. Ashenfelter, and D. Card, vol. 3, chap. 31, pp. 1865–2097. Elsevier,
North Holland.
Heckman, J. J., and S. Navarro-Lozano (2004): “Using Matching, Instrumental
Variables, and Control Functions to Estimate Economic Choice Models,” The Review
of Economics and Statistics, 86(1), 30–57.
Heckman, J. J., and R. Robb (1985): “Alternative Methods for Evaluating the
Impact of Interventions,” in Longitudinal Analysis of Labor Market Data, ed. by
J. J. Heckman, and B. Singer, pp. 156–245. Cambridge University Press, New-York.
Hirano, K., G. W. Imbens, and G. Ridder (2003): “Efficient Estimation of
Average Treatment Effects Using the Estimated Propensity Score,” Econometrica,
71(4), 1161–1189.
Hryshko, D. (2012): “Labor Income Profiles are Not Heterogeneous: Evidence from
Income Growth Rates,” Quantitative Economics, 3(2), 177–209.
Imbens, G. W., and J. M. Wooldridge (2009): “Recent Developments in the
Econometrics of Program Evaluation,” Journal of Economic Literature, 47(1), 5–
86.
MaCurdy, T. E. (1982): “The Use of Time Series Processes to Model the Error
Structure of Earnings in a Longitudinal Data Analysis,” Journal of Econometrics,
18(1), 83–114.
Mayer, T., F. Mayneris, and L. Py (2012): “The Impact of Urban Enterprise
Zones on Establishments’ Location Decisions: Evidence from French ZFUs,” CEPR
Discussion Paper 9074.
Meghir, C., and L. Pistaferri (2011): “Earnings, Consumption and Life Cycle

36

Choices,” in Handbook of Labor Economics, ed. by O. Ashenfelter, and D. Card, vol.
4, Part B, chap. 9, pp. 773 – 854. Elsevier.
Myers, J. A., J. A. Rassen, J. J. Gagne, K. F. Huybrechts, S. Schneeweiss,
K. J. Rothman, M. M. Joffe, and R. J. Glynn (2011): “Effects of Adjusting
for Instrumental Variables on Bias and Precision of Effect Estimates,” American
Journal of Epidemiology, 174(11), 1213–1222.
Pearl, J. (2010): “On a Class of Bias-Amplifying Variables that Endanger Effect
Estimates,” in Proceedings of the 26th Conference on Uncertainty in Artificial Intelligence (UAI 2010), ed. by P. Grunwald, and P. Sprites, pp. 417–424. AUAI Press,
Corvallis, Oregon.
(2011): “Invited Commentary: Understanding Bias Amplification,” American
Journal of Epidemiology, 174(11), 1223–1227.
Puhani, P. A., and K. Sonderhof (2010): “The Effects of a Sick Pay Reform on
Absence and on Health-related Outcomes,” Journal of Health Economics, 29(2), 285
– 302.
Smith, J. A., and P. E. Todd (2005): “Does Matching Overcome LaLonde’s Critique of Nonexperimental Estimators?,” Journal of Econometrics, 125(1-2), 305–353.
Wooldridge, J. M. (2005): “Violating Ignorability of Treatment by Controlling for
Too Many Factors,” Econometric Theory, 21(05), 1026–1028.
(2009): “Should Instrumental Variables be Used as Matching Variables?,”
Unpublished.
Ziebarth, N. R., and M. Karlsson (2010): “A Natural Experiment on Sick Pay
Cuts, Sickness Absence, and Labor Costs,” Journal of Public Economics, 94(11-12),
1108 – 1122.

37

A

Proof of the propositions in section 3

Proof of proposition 1
0
M
From equation (18), CDι (Yi,k+τ
|Xi , Yi,k−τ 0 ) = 0 is a sufficient condition for Bτ,τ
0 ,ι to be

null. We have:

0
0
0
)
) = CDι (µi + βi (k + τ ) + Ui,k+τ |Xi , Yi,k
|Xi , Yi,k
CDι (Yi,k+τ

(23)

Under full information, this will be null if:


αi
− ci − y ≥ 0]
r
αi
= y, 1[ − ci − y < 0]]
r

0
E µi + βi (k + τ ) + Ui,k+τ |Xi = x, Yi,k
= y, 1[
0
= E[µi + βi (k + τ ) + Ui,k+τ |Xi = x, Yi,k



(24)

In our model, we have assumed that (Ui,0 , {vi,j }kj=−1 ) ⊥
⊥ (αi , βi , ci , µi , Xi ), so that
(Ui,0 , {vi,j }kj=−1 ) ⊥
⊥ (αi , ci )|(µi , βi , Xi ). If we assume that (µi , βi ) ⊥
⊥ (ci , αi )|Xi , then
we have that (µi , βi , Ui,0 , {vi,j }kj=−1 ) ⊥
⊥ (αi , ci )|Xi , using lemma 4.3 in Dawid (1979).
0
Because µi + βi (k + τ ) + Ui,k+τ and Yi,k
are a function of (µi , βi , Ui,0 , {vi,j }kj=−1 ) con0
), using lemma 4.2
ditional on Xi , we have (µi + βi (k + τ ) + Ui,k+τ ) ⊥
⊥ (αi , ci )|(Xi , Yi,k

in Dawid (1979), which proves equation (24) and completes the proof.

Proof of proposition 2
Because Uit follows an ARMA(1,2), we have, for τ ≥ 2 (the proof for τ = 1 is similar
and thus omitted):

Ui,k+τ = ρτ +1 Ui,k−1 + ρτ m2 vi,k−2 + ρτ −1 (ρm1 + m2 )vi,k−1
2

+ (ρ + ρm1 + m2 )

τX
−2

ρτ −2−j vi,k+j + (ρ + m1 )vi,k+τ −1 + vi,k+τ

j=0

38

(25)

Substituting for Ui,k−1 and acknowledging that all shocks posterior to period k are
orthogonal to the conditioning set, we have, for τ ≥ 2:

0
CDι (Yi,k+τ
|Xi , Yi,k−1 ) = (1 − ρτ +1 )CDι (µi |Xi , Yi,k−1 )

(26a)

+ (k + τ − ρτ +1 (k − 1))CDι (βi |Xi , Yi,k−1 )

(26b)

+ ρτ −1 (ρm1 + m2 )CDι (vi,k−1 |Xi , Yi,k−1 )

(26c)

+ ρτ m2 CDι (vi,k−2 |Xi , Yi,k−1 )

(26d)

+ ρτ −2 (ρ2 + ρm1 + m2 )CDι (vi,k |Xi , Yi,k−1 ).

(26e)

Note that parts (26a) and (26b) are equal to zero when Fµ,β is degenerate and that
parts (26c) and (26d) are zero when m1 = m2 = 0. Finally, let’s write the expected
foregone wage in terms of the conditioning variable under limited information:

0
l
E[Yi,k
|Ii,k
] = g(Xi , δk ) + µi + ρUi,k−1 + m1 vi,k−1 + m2 vi,k−2

(27)

0
= g(Xi , δk ) − ρg(Xi , δk−1 ) + µi (1 − ρ) + Yi,k−1
+ m1 vi,k−1 + m2 vi,k−2 (28)

This result comes from vi,k being mean-zero and not contained in the limited information set and by substituting for Ui,k−1 . We see that the conditioning set in (26e) is
not correlated with vik , so that this bias term is also zero. Using the law of iterated
expectation proves the result.

Proof of proposition 3
Y0

DID
i
Bτ,τ
0 ,ι = 0 if CDι (∆τ,τ 0 |Xi ) = 0. If Fβ is degenerate, it is easy to show that this is

equivalent to CDι (∆Uτ,τi 0 |Xi ) = 0. Under coarse information and Fβ degenerate, we
c∗
have: Di,k
=

αi
r

− ci − g(Xi , δk ) − µi , so that:
h

i

c∗
c∗
E ∆Uτ,τi 0 |Xi , 1[Di,k
≥ 0] = E[∆Uτ,τi 0 |Xi , 1[Di,k
< 0]],

39

(29)

because {vi,j }k+τ
⊥ (αi , ci , µi , Xi ), by assumption. This completes the proof of the
j=0 ⊥
consistency of DID matching. Matching is inconsistent even though (26e) is equal to
zero. The first bias term (26a) is non null: since the agent knows µi and self-selects
on it, CDc (µi |Xi , Yi,k−1 ) 6= 0. Moreover, (26c) and (26d) are also non null under these
c
conditions. This is because conditioning on Yi,k−1 makes them correlated with Di,k

through µi . These terms do not cancel out in general, which proves the result.

Proof of proposition 4
We have:
Y0

DID
ι
i
Bτ,τ
0 ,ι = E[CDι (∆τ,τ 0 |Xi )|Di,k = 1]
ι
= E[CDι (βi (τ + τ 0 ) + ∆Uτ,τi 0 |Xi )|Di,k
= 1].

(30)
(31)

ι∗
, Xi ] is linear, we can write:
Because E[Ui,t |Di,k

∗ι
ι
ι
]|Xi , Di,k
= 1]
= 1] = E[E[∆Uτ,τi 0 |Xi , Di,k
E[∆Uτ,τi 0 |Xi , Di,k

=

E[E[∆Uτ,τi 0 |Xi ]

∗ι
|Xi ) ∗ι
Cov(∆Uτ,τi 0 , Di,k
∗ι
ι
+
(Di,k − E[Di,k
|Xi ])|Xi , Di,k
= 1]
∗ι
Var(Di,k |Xi )

(32)
(33)

When ι ∈ {f, l}, we have:

∗ι
Cov(∆Uτ,τi 0 , Di,k
|Xi ) = Cov(∆Uτ,τi 0 ,

αi
0
− ci − Yi,k
+ 1[ι = l]vi,k |Xi )
r

= −Cov(∆Uτ,τi 0 , Ui,k ) + 1[ι = l]Cov(∆Uτ,τi 0 , vi,k ).

(34)
(35)

The second equality follows from {vi,j }k+τ
⊥ (αi , ci , µi , Xi ), which also implies that
j=−1 ⊥
E[∆Uτ,τi 0 |Xi ] = 0. Now, we have:
∗ι
Cov(∆Uτ,τi 0 , Di,k
|Xi ) = Cov(Ui,k−τ 0 , Ui,k ) − Cov(Ui,k+τ , Ui,k )

+ 1[ι = l](ρτ −2 )(ρ2 + m1 ρ + m2 )Var(vi,k ).

40

(36)

This follows from the ARMA(1,2) process: only Ui,k+τ is correlated to vi,k .
Note first that, for τ ≥ 2:

Cov(Ui,k−τ , Ui,k ) = Cov(Ui,k−τ , ρτ −2 (ρ2 Ui,k−τ + ρm2 vi,k−τ −1 + (ρm1 + m2 )vi,k−τ ))
(37)
= ρτ Var(Ui,k−τ ) + ρτ −1 m2 (ρ + m1 )Var(vi,k−τ −1 )
+ ρτ −2 (ρm1 + m2 )Var(vi,k−τ ).

(38)

Because vi,t is an i.i.d. process, Var(vi,t ) = σ 2 , ∀t. Using the fact that {Ui,t }∞
⊥ Xi ,
t=0 ⊥
we thus have, for τ ≥ 2:

DID
0
ι
Bτ,τ
0 ,ι = (τ + τ )E[CDι (βi |Xi )|Di,k = 1]
0



(39a)


+ ρτ Var(Ui,k−τ 0 ) − ρτ Var(Ui,k ) Aιk

(39b)

+ 1[ι = l](ρτ −2 )(ρ2 + m1 ρ + m2 )σ 2 Aιk ,

(39c)

with:
Aιk = E[CDι (

∗ι
∗ι
Di,k
− E[Di,k
|Xi ]
ι
|Xi )|Di,k
= 1]
∗ι
Var(Di,k |Xi )

(40)

We can write, for k > 2:

k

Ui,k = ρ Ui,0 + ρ

k−1

k−2

m2 vi,−1 + ρ

2

(ρm1 + m2 )vi,0 + (ρ + ρm1 + m2 )

k−3
X

ρj vi,k−j−2

j=0

+ (ρ + m1 )vi,k−1 + vi,k .

(41)

As a consequence:

2

21

2

Var(Ui,k ) = 1 + (ρ + m1 ) + (ρ + ρm1 + m2 )

!

− ρ2(k−2)
σ2
1 − ρ2

+ ρ2k Var(Ui,0 ) + ρ2(k−1) m2 Var(vi,−1 ) + ρ2(k−2) (ρm1 + m2 )Var(vi,0 )
+ 2ρ2k−1 m2 Cov(Ui,0 , vi,−1 ) + 2ρ2k−2 (ρm1 + m2 )Cov(Ui,0 , vi,0 ).

41

(42)

First, note that when |ρ| < 1, we have:
!

σU2 ∞

1
= lim Var(Ui,k ) = 1 + (ρ + m1 ) + (ρ + ρm1 + m2 )
σ2,
k→∞
1 − ρ2
2

2

2

(43)

If we replace Σ0 with Σ∞ in equation (42), we also have that Var(Ui,k ) = σU2 ∞ , ∀k.
Indeed we have:

Var(ρk Ui,0 + ρk−1 m2 vi,−1 + ρk−2 (ρm1 + m2 )vi,0 )
= ρ2(k−2) ρ4 VarUi,0 + ρ2 m22 Var(vi,−1 ) + (ρm1 + m2 )2 Var(vi,0 )
!

+ 2ρ3 m2 Cov(Ui,0 , vi,−1 ) + 2ρ2 (ρm1 + m2 )Cov(Ui,0 , vi,0 )
= ρ2(k−2) σ 2

(44)

ρ4
(ρ2 + ρm1 + m2 ) + ρ4 + ρ4 (m1 + ρ)2 + ρ2 m22
1 − ρ2
!
2

3

2

+ (ρm1 + m2 ) + 2ρ m2 (m1 + ρ) + 2ρ (ρm1 + m2 )
ρ4
=ρ
σ (ρ + ρm1 + m2 )
+ 1 + ρ2
1 − ρ2
!
1
2(k−2) 2 2
=ρ
σ (ρ + ρm1 + m2 )
.
1 − ρ2
2(k−2) 2

2

(45)

!

(46)
(47)

Replacing the two last lines of equation (42) by the right hand side of equation (47)
yields the result.
We thus have Var(Ui,k ) = σU2 ∞ , |ρ| < 1 and k → ∞ (or ∀k when Σ0 = Σ∞ ).
Using equation (39), we can see that this, together with Fβ degenerate, implies that
DID
Bτ,τ,f
= 0.
M
In order to prove that Bτ,τ
0 ,f 6= 0, it is enough to find a sub-model that follows the

restriction of the proposition and in which matching is biased. The model in section
4 fulfills these conditions.

42

B

Derivation of bias terms in the labor example
with normal MA terms

Not controlling for past outcomes
In this section, I derive closed form expressions for the asymptotic bias terms of section
3 under the assumption that the i.i.d MA terms are normal with variance σ 2 . I also
assume that the process generating the outcomes began sufficiently far in the past
so that I can abstract from the dependence on t by considering that the MA terms
are a sum of an infinite number of shocks. I moreover posit that αi , ci , µi is normally
distributed with variance σα2 , σc2 , σµ2 and corresponding covariances. To obtain the
asymptotic bias terms, I study the joint distribution of normal variables conditional
on Xi = x. Keeping the conditioning on Xi = x implicit, the bias term of DID is equal
to (see equation 20):
Y0

DID
i
Bτ,τ
0 ,ι = CDι (∆τ,τ 0 )

(48)

0
∗ι
0
∗ι
Cov(Yi,k+τ
, Di,k
) − Cov(Yi,k−τ
0 , Di,k )
∗ι
(CDι (Di,k
))
=
2
σD
∗ι

(49)

After some calculations, we can show that, ∀τ ∈ Z:

0
∗ι
Cov(Yi,k+τ
, Dik
)=

σµ,α
− (1 − ρ|τ | )σµ2 − σµ,c − ρ|τ | σY2
r

− ρ|τ |−2 σ 2 1[τ 6= 0](ρm2 (m1 + ρ) + 1[ι = f or τ < 0]ρm1 )
!

+ 1[τ 6= 1 and τ 6= 0]1[ι = f or τ < 0]m2 − 1[ι = l and τ ≥ 0]ρ

2

, (50)

and:

∗ι
CDι (Di,k
)

=

1
σD∗ι

!

φ (Ax )
φ (Ax )
+
,
1 − Φ (Ax ) Φ (Ax )

43

(51)

with:

σY2 = σU2 ∞ + σµ2

(52)
2!

(ρ2 + ρm1 + m2 )
= σ 1 + (m1 + ρ) +
1 − ρ2
σα2
σc,α σµ,α
2
2
2
2
2
σD
+
− σµ,c )
− 2(
∗ι = σU − 1[ι = l]σ + σµ + σc +
2
r
r
r
g(x, δk ) − ᾱr + c̄ + µ̄
Ax =
.
σD∗ι
σU2 ∞

2

2

(53)
(54)
(55)

Controlling for past outcomes
To derive the bias term of matching on past outcomes, I use the fact that it can be
rewritten in the following way:

0
0
ι
0
ι
B m (τ, τ 0 , ι, y) = E[Yi,k+τ
|Dι = 1] − E[E[Yi,k+τ
|Dik
= 0, Yi,k−τ
0 ]|D = 1].

(56)

The average outcome for the treated can be obtained by results in the previous
section. The main difficulty is to form the second part of the term on the right hand
side of equation (56): the mean outcome of the matched non-participants. To form
this quantity, first note that, because these variables are jointly normally distributed,
their conditional expectation is linear, so that, , ∀(τ, τ 0 ) ∈ Z2 :
h

0
∗ι
0
E Yi,k+τ
|Dik
, Yi,k−τ
0

i




0
∗ι
∗ι
0
0
= E[Yi,k+τ
] + βτ,D∗ι (Dik
− E[Dik
]) + βτ,τ 0 Yi,k−τ
0 − E[Yi,k−τ 0 ] ,

44

(57)

with:

βτ,D∗ι =
βτ,τ 0 =

∗ι
0
∗ι
0
)σY2 − Cov(Yi,k−τ
, Dik
Cov(Yi,k+τ
0 , Dik )σY 0 ,Y 0
k+τ

k−τ 0

(58)

,

∗ι 2
0
2
2
σD
∗ι σY − Cov(Yi,k−τ 0 , Dik )
∗ι
0
∗ι
0
2
0 ,Y 0
σYk+τ
σD
∗ι − Cov(Yi,k+τ , Dik )Cov(Yi,k−τ 0 , Dik )
k−τ 0
∗ι 2
0
2
2
σD
∗ι σY − Cov(Yi,k−τ 0 , Dik )

(59)

,

0

σYk+τ ,Yk−τ 0 = σUk+τ ,Uk−τ 0 + (1 − ρ|τ +τ | )σµ2 ,
0

σUk+τ ,Uk−τ 0 = ρ|τ +τ | σU2 + ρ|τ +τ

0 |−2

(60)

σ 2 1[|τ + τ 0 | > 0]ρ(m2 (m1 + ρ) + m1 )
!

+ 1[|τ + τ 0 | > 1]m2 .

(61)

From this, we again use the law of iterated expectation to derive the conditional
expectation of non-participants’ outcomes:

0
ι
0
0
∗ι
0
∗ι
0
E[Yi,k+τ
|Dik
= 0, Yi,k−τ
0 ] = E[E[Yi,k+τ |Dik , Yi,k−τ 0 ]|Dik < 0, Yi,k−τ 0 ]



(62)



0
0
0
= E[Yi,k+τ
] + γτ,τ 0 Yi,k−τ
0 − E[Yi,k−τ 0 ]

+ γτ,D∗ι

φ(Axy )
,
Φ(Axy )

(63)

with:

γτ,τ 0 = βτ,D∗ι
γτ,D∗ι = βτ,D

0
∗ι
Cov(Yi,k−τ
0 , Dik )
+ βτ,τ 0 ,
σY2

v
u
u
tσ 2
∗ι

c̄ + µ̄ −
Axy =

D∗ι

ᾱ
r

(64)

0
∗ι 2
Cov(Yi,k−τ
0 , Dik )
−
,
σY2

(65)

+ g(x, δk ) + (y − g(x, δk−τ 0 ) − µ̄)
r
2
σD
∗ι

−

0
∗ι
Cov(Yi,k−τ
0 ,Dik )
2
σY

0
∗ι 2
Cov(Yi,k−τ
0 ,Dik )

.

(66)

2
σY

In order to obtain bias terms that are comparable to those calculated for DID
m1
m2
ι =1 (y),
matching, we have to integrate Bxy
and Bxy
with respect to the distribution FYi,k−τ 0 |Di,k

which has the following density (Arnold, Beaver, Groeneveld, and Meeker, 1993):
y − g(x, δk−τ 0 )
1
ι =1 (y) =
fY 0 0 |Di,k
φ
i,k−τ
σY
σY
45

!

1 − Φ(Axy )
.
1 − Φ(Ax )

(67)

After integrating out Yi,k−τ 0 |Dik = 1, we have:
0
∗ι
Cov(Yi,k−τ
0 , Dik )
φ(Ax )
σD∗ι
1 − Φ(Ax )
!
y − g(x, δk−τ 0 ) − µ̄ 1 − Φ(Axy )
1 φ(Axy )
φ
dy. (68)
σY Φ(Axy )
σY
1 − Φ(Ax )

0
ι
0
ι
0
E[E[Yi,k+τ
|Dik
= 0, Yi,k−τ
0 ]|D = 1] = E[Yi,k+τ ] − γτ,τ 0

+ γτ,D∗ι

Z +∞
−∞

There is no closed form expression for the last integral. I use 32-point GaussHermite quadrature to compute this integral numerically.

C

Parameterizations of the Monte-Carlo simulations

The g function and the selection equation take the following from:

g(Xi , δt ) = αa + βa Ai,t + γa A2i,t + (δ + rt d)Ei
∗ι
Di,k
= αx + βx Ei,t +

αi
0
ι
− ci − E[Yi,k
|Ii,k
].
r

(69)
(70)

Bayesian updating in the HIP model follows Guvenen (2007). The state and equations have the following form:









|



µi 












}

|




=
βi 


Ui,t+1
{z

Si,t+1



1 0 0
0 1 0
0 0 ρ
{z













µi 




 
 
+
βi 
 
 
 

Ui,t

} | {z }

F

Si,t


0
yi,t
=



1 t 1
|

{z

H0t






}

|

0
where yi,t
= Yi,t0 − g(Xi , δt ).

46



|



0 




0 


vi,t+1
{z

vi,t+1

(71)



}



µi 



βi 
,
Ui,t
{z

Si,t



}

(72)

As all variables are normally distributed, the prior belief over (µi , βi , Ui,0 ) is a
multivariate normal distribution with mean Ŝi,1|0 ≡ (0, βik , 0) and covariance matrix:


P1|0 =









σα2
√

1 − λσα,β

√
1 − λσα,β
√
1 − λσα,β

0



0 
0
σ2

0



.




(73)

After observing t periods of outcomes, the individual’s posterior for (µi , βi , Ui,t )
is a normal distribution with mean Ŝi,t|t and covariance matrix Pt|t . From this, the
individual can form one period ahead forecasts of these variables. They will also be
normally distributed with mean Ŝi,t+1|t and covariance matrix Pt+1|t . The evolution
of these matrices induced by optimal learning is:
h

Ŝi,t|t = Ŝi,t|t−1 + Pt|t−1 Ht H0t Pt|t−1 Ht

i−1



× yi,t − H0t Ŝi,t|t−1

Ŝi,t+1|t = FŜi,t|t



(74)
(75)

h

Pt|t = Pt|t−1 − Pt|t−1 Ht H0t Pt|t−1 Ht
Pt+1|t = FPt|t F0 + Q,

i−1

× H0t Pt|t−1

(76)
(77)

with Q the covariance matrix of vi,t+1 .
Conditional on individual’s beliefs at period t, log wages is normally distributed
with mean H0t Ŝi,t+1|t + g(Xi , δt+1 ). These expected foregone wages are then fed in the
selection equation.

47

Table 1 – Parameters used for the Monte-Carlo simulations
Trimming level
Sample size
Number of periods
δ
d
αa
βa
γa
αx
βx
ρ
m1
m2
ᾱ
c̄
r
µ̄
β̄
x̄
σx2
σµ2
σβ2
σ2
σc2
σα2
σµ,β
ρµ,c
ρµ,x
ρµ,α
ρβ,c
ρβ,x
ρβ,α
ρc,x
λ
σU2 0

RIP, long run
0.4
1000
40
0.08
0.02
8.83
0.56
-0.057
0
-0.001
0.99
-0.4
-0.1
0.1
3
0.1
0
0
2.3
0.2
0
0
0.055
0.05
0
0
0
0
0
0
0
0
0
0
σ2

RIP, short run
0.4
1000
40
0.08
0.02
8.83
0.56
-0.057
0.5
-0.001
0.99
-0.4
-0.1
0.1
3
0.1
0
0
2.3
0.2
0
0
0.055
0.05
0
0
0
0
0
0
0
0
0
0
σU2 ∞

48

HIP, long run
0.4
1000
40
0.08
0.02
8.83
0.56
-0.057
0.5
-0.001
0.821
0
0
0.1
3
0.1
0
0
2.3
0.2
0.022
0.00038
0.055
0.05
0
-0.002
0
0
0
0
0
0
0
0.6
σ2

HIP, short run
0.4
1000
40
0.08
0.02
8.83
0.56
-0.057
0.6
-0.001
0.821
0
0
0.1
3
0.1
0
0
2.3
0.2
0.022
0.00038
0.055
0.05
0
-0.002
0
0
0
0
0
0
0
0.6
σU2 ∞

