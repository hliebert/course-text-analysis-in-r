ARTICLE IN PRESS

Journal of Econometrics 139 (2007) 35–75
www.elsevier.com/locate/jeconom

Nonparametric IV estimation of local average
treatment effects with covariates
Markus Frölicha,b,,1
a
University College London, UK
Universität St.Gallen, Bodanstrasse 8, SIAW, 9000 St. Gallen, Switzerland

b

Available online 4 August 2006

Abstract
In this paper nonparametric instrumental variable estimation of local average treatment effects
(LATE) is extended to incorporate covariates. Estimation of LATE is appealing since identiﬁcation
relies on much weaker assumptions than the identiﬁcation of average treatment effects in other
nonparametric instrumental variable models. Including covariates in the estimation of LATE is
necessary when the instrumental variable itself is confounded, such that the IV assumptions are valid
only conditional on covariates. Previous approaches to handle covariates in the estimation of LATE
relied on parametric or semiparametric methods. In this paper, a nonparametric estimator for the
estimation of LATE with covariates is suggested that is root-n asymptotically normal and efﬁcient.
r 2006 Elsevier B.V. All rights reserved.
JEL classification: C13; C14
Keywords: Instrumental variables; LATE; Evaluation; Treatment effect; Matching; Unobserved heterogeneity

1. Introduction
In this paper the concept of thepﬃﬃlocal
average treatment effect (LATE) is extended
ﬃ
to incorporate covariates and a n consistent nonparametric instrumental variables
estimator is proposed.
Corresponding author at: Universität St.Gallen, Bodanstrasse 8, SIAW, 9000 St. Gallen, Switzerland.
Tel.: 41 71 224 2329; fax:41 71 224 2298.
E-mail address: markus.froelich@unisg.ch.
URL: http://www.siaw.unisg.ch/froelich.
1
The author is also afﬁliated with the Institute for the Study of Labor (IZA), Bonn.

0304-4076/$ - see front matter r 2006 Elsevier B.V. All rights reserved.
doi:10.1016/j.jeconom.2006.06.004

ARTICLE IN PRESS
36

M. Frölich / Journal of Econometrics 139 (2007) 35–75

Instrumental variables regression is a fundamental approach to causal reasoning in
econometrics. In many applications one wants to uncover the causal relationship between a
variable D and an outcome variable Y, where the variable D is itself endogenous. For
example, if D is years of schooling and Y is wages, it is of interest to learn by how much wages
increase due to an additional year of schooling. In another example, if D represents
participation in a training programme and Y is subsequent employment status, it is of interest
how the employment probability is affected by participation in the training programme. In
these examples, one would like to know how D causally affects Y, i.e. how an exogenous
variation in D would change the variable Y. Since the variable D is endogenous, a regression
of Y on D does not uncover a causal relationship. Nevertheless, if a variable Z exists that
affects only D but not Y, then an exogenous variation in Z induces an exogenous variation in
D and thus overcomes the endogeneity of D. Such a variable Z is called an instrumental
variable and has been exploited in numerous studies to identify the effects of D on Y.
If the values of the instrumental variable Z are assigned completely at random, any
variation in Z is exogenous and thus generates an unconfounded variation in D to identify
the relationship between D and Y. For example, Hearst et al. (1986) and Angrist (1990) use
the Vietnam era conscription lottery as an instrument to identify the effects of mandatory
military conscription on subsequent civilian mortality and earnings. Imbens et al. (2001)
use ‘winning a prize in the lottery’ as an instrument to identify the effects of unearned
income on subsequent labour supply, earnings and consumption behaviour. In both
examples the instrument is randomly assigned (by a lottery).
However, in many applications the instrument Z is not randomly assigned and may be
confounded with D or Y. For example, college proximity may be used as an instrument to
identify the returns to schooling, noting that living close to a college during childhood may
induce some children to go to college but is unlikely to directly affect the wages earned in
their adulthood (Card, 1995). Nevertheless, whether living close to or far from a college is
not random but an active choice by their parents. Their choice, however, might itself be
related to characteristics that affect their children’s subsequent wages directly. Parental
education is another example of an instrumental variable that is often used to identify the
returns to schooling. It may appear reasonable to assume that parental schooling itself has
no direct impact on their children’s wages. Nevertheless, it is likely to be correlated with
parents’ profession, family income and wealth, which may directly affect the wage
prospects of their offspring. In these cases, Z may only be a proper instrumental variable
after conditioning on some covariates X.
Conventional approaches to accommodate covariates X in instrumental variables
estimation (such as two-stage least squares) proceed by specifying functional form
restrictions on the conditional expectation functions of Y and D. Recently, nonparametric
identiﬁcation and estimation in instrumental variable models, avoiding such delicate
functional form assumptions, has received a lot of interest.2 However, their approaches
still impose identifying assumptions which may not be satisﬁed in many applications. Most
models suppose additive separability in the error term, which amounts to assuming that,
conditional on X, the relationship between D and Y is identical for each individual up to an
intercept. In other words, a constant treatment effect for individuals with the same value of
X is assumed. Additively separable models, thus, rule out unobserved heterogeneity and
2

See Blundell and Powell (2003), Chesher (2003, 2005), Das (2005), Darolles et al. (2001), Florens (2003),
Florens et al. (2002), Imbens and Newey (2003), Newey et al. (1999) and Newey and Powell (2003).

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

37

therefore may not be appropriate in many applications. Non-separable models permit
unobserved heterogeneity in the treatment effects. Identiﬁcation, however, often relies on
an instrument that is sufﬁciently powerful to move the value of Di (for any individual i)
over the entire support of the variable D, see Blundell and Powell (2003), Florens et al.
(2002) and Imbens and Newey (2003).3 Yet, such powerful instruments are often not
available. In this case, the relationship between D and Y can only be uncovered for the
subpopulation that reacts on changes of the instrument Z.
This is the concept of the LATE of Imbens and Angrist (1994). The LATE is the mean
effect on Y of a change in D for the subpopulation of compliers, where the compliers are all
individuals whose value of D would change if the instrument Z were modiﬁed exogenously.
In spite of its appealing properties, however, the LATE-concept has not been fully
extended to accommodate covariates X. Previous approaches to incorporate covariates for
estimating LATE, e.g. Abadie (2003), Angrist et al. (2000), Hirano et al. (2000), Yau and
Little (2001), resorted to parametric or semiparametric estimation approaches.
In this paper nonparametric identiﬁcation and estimation of LATE with covariates is
analysed.
pﬃﬃA
ﬃ nonparametric estimator in the form of a ratio of two matching estimators is shown
to be n-consistent and efﬁcient. Thus, using nonparametric regression to accommodate
covariates X in the estimation of LATE does not give rise to a curse of dimensionality.
Section 2 discusses nonparametric estimation of the LATE with covariates. Section 3
proposes a nonparametric estimator and derives its properties. Section 4 discusses
propensity score versions of the LATE estimator. Section 5 examines extensions to nonbinary treatments and non-binary instruments. Section 6 concludes.
2. Instrumental variables regression and nonparametric LATE
Consider the triangular model
Y i ¼ jðDi ; Zi ; X i ; i Þ,

(1)

Di ¼ zðZ i ; X i ; vi Þ,

(2)

where Y is an outcome variable and D is an endogenous regressor. We are interested in
estimating the causal effect of D on Y. The variable Z will be referred to as an instrumental
variable.  and v are unobserved variables. X is a vector of observed covariates. It will be
assumed that conditional on X certain instrumental variables assumptions (speciﬁed
below) are satisﬁed. Hence X contains all variables (if any) that are necessary to make these
assumptions hold.
For a more compact notation, deﬁne
Y di;z  jðd; z; X i ; i Þ,
Di;z  zðz; X i ; vi Þ,
i
and notice that Y D
i;Zi ¼ Y i and Di;Z i ¼ Di are the observed values of Y and D.

3
This is similar to the identiﬁcation-at-inﬁnity argument in selection models. These models largely rely on some
kind of monotonicity assumption in the relationship determining the endogenous regressor. Chesher (2003) assumes
monotonicity in the outcome equation and in the relationship determining the endogenous regressor. He studies
identiﬁcation of systems of equations and identiﬁcation under local exclusion restrictions. Chesher (2005) extends this
to discrete endogenous regressors. Chernozhukov and Hansen (2005) rely on monotonicity in the outcome equation.

ARTICLE IN PRESS
38

M. Frölich / Journal of Econometrics 139 (2007) 35–75

The causal interpretation of j is as follows: for unit i the variables Zi , i , vi and X i are
determined by nature and Di and Y i are determined according to (2) and (1), respectively.
If the variable Di were manipulated by an external intervention to take the value d (without
affecting the values of Z i , i , vi or X i ), the outcome jðd; Z i ; X i ; i Þ would be observed. For
example, if D 2 f0; 1g is union status and Y is wages, the potential wages for person i are the
wages that person i would receive if union membership were set for this person by some
external intervention to 0 or to 1, respectively. Analogously, if D is years of schooling, the
potential wages for person i are the wages that person i would receive if years of schooling
were set externally to different levels. Differences between potential outcomes are also
called causal effects (Rubin, 1974). This causal interpretation of j requires that Y is not a
cause to any of the other variables and that D is a cause only to Y, see Pearl (2000).4
For causal inference, we are interested in estimating the average structural function
(Blundell and Powell, 2003)
Z
E½Y d  ¼ jðd; Z; X ; Þ dF Z;X ;
or the average treatment effect
Z
0
E½Y d  Y d  ¼ ðjðd 0 ; Z; X ; Þ  jðd; Z; X ; ÞÞ dF Z;X ;
or the marginal average treatment effect qE½Y d =qd if D is continuous.
Nonparametric instrumental variable estimation of the relationship between an
endogenous variable D and an outcome variable Y is often analysed in an additively
separable model where it is assumed that5
Y i ¼ jðDi ; X i Þ þ i .
However, the assumption of an additively separable structure is often inadequate, since it
heavily restricts the permitted heterogeneity among persons: the causal effect of setting Di
to d 1 versus setting Di to d 2 is supposed to be identical for all persons with the same x
value. This amounts to assuming that the effect of union membership or of an additional
year of schooling is identical for all persons with the same X characteristics. This constant
treatment effect assumption (conditional on X) is in many situations rather implausible
(Heckman, 1997). For example, the return to schooling may interact with unobserved
ability.
Identiﬁcation in non-separable models is analysed by Blundell and Powell (2003),
Chesher (2003, 2005), Florens et al. (2002) and Imbens and Newey (2003). Suppose that
the instrumental variable Z has no direct effect on Y conditional on X and 
Y i ¼ jðDi ; X i ; i Þ
and that the selection equation zðZ i ; X i ; vi Þ is either additive in Z i and vi (Florens et al.,
2002) or strictly monotone in vi (Imbens and Newey, 2003). By imposing a normalization
on vi , such as being uniformly½0;1 distributed, vi can be identiﬁed from Di , Z i
4
If D is also a cause to X, in the sense that changing D would imply also a change in X, only the direct effect of
D on Y would be recovered with the following identiﬁcation strategy, but not the total effect (i.e. including the
effect of D on Y that is channelled through X ).
5
See Blundell and Powell (2003), Das (2005), Darolles et al. (2001), Florens (2003), Newey et al. (1999) and
Newey and Powell (2003).

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

39

and X i .6 If one assumes that the endogeneity of Di (i.e. the difference between E½Y d  and
E½Y d jD ¼ d) is generated entirely through the error term vi , the endogeneity can be
controlled for by conditioning on v
E½jðd; X ; ÞjX ; V ; D ¼ d ¼ E½jðd; X ; ÞjX ; V .

(3)

With this assumption, the average structural function can be identiﬁed by
Z
Z
E½Y jX ; V ; D ¼ d dF X ;V ¼
E½jðD; X ; ÞjX ; V ; D ¼ d dF X ;V
Z
¼
E½jðd; X ; ÞjX ; V  dF X ;V ¼ E½Y d .
However, a central condition for identiﬁcation is that the conditional expectation
E½Y jX ; V ; D ¼ d is deﬁned at every v in the support of V (conditional on X). This requires
that the support of the distribution of V given D ¼ d is the same as the support of the
marginal distribution of V (conditional on X). For this condition to be satisﬁed, either the
distribution of V needs to be restricted, or the instrument Zi must be sufﬁciently powerful
to move the regressor Di for every unit i to any value d where E½Y d  shall be estimated
(Imbens and Newey, 2003).
However, in many applications the instruments available are not so powerful. It is often
highly unreasonable to assume that all units i could be induced, through a modiﬁcation of
the instrument Z i , to change Di to a particular value. Consider the situation where D and
Z are binary. The above assumption would require that all units switch D from 0 to 1 or
vice versa if Z is changed from 0 to 1. If this assumption does not hold, the relationship
between D and Y can no longer be analysed for the full population, but only for the
subpopulation which reacts to the instrumental variable. This is the concept of the LATE,
which restricts the analysis to the subpopulation of units that could be induced to change
D through a variation in the instrumental variable.
The LATE has been introduced by Imbens and Angrist (1994) and further been analysed
in several papers.7 Most of the discussion on LATE focuses on the case where Z is a proper
instrumental variable without conditioning on X covariates. Often, however, the
instrumental variable assumptions are only satisﬁed conditional on covariates. Identiﬁcation of LATE with covariates X is discussed in Angrist and Imbens (1995), Heckman and
Vytlacil (1999), Abadie (2003) and Imbens (2001). Covariates are usually included in the
estimation of LATE via parametric or semiparametric estimation approaches.8 However,
nonparametric estimation of LATE with confounding covariates X has not been analysed
so far, which is the aim of this paper.
6

If zðZi ; X i ; vi Þ is monotone in vi , then vi ¼ F DjZ;X ðDi ; Zi ; X i Þ, see Imbens and Newey (2003). If zðZi ; X i ; vi Þ ¼
xðZi ; X i Þ þ vi is additive, then vi ¼ Di  E½DjZi ; X i , see Blundell and Powell (2003) and Florens et al. (2002).
7
See Angrist and Imbens (1995), Angrist et al. (1996), Imbens and Rubin (1997), Heckman and Vytlacil (1999),
Abadie (2003) and Imbens (2001), among others.
8
Angrist et al. (2000) and Yau and Little (2001) incorporate covariates by assuming that they enter linearly in
the conditional expectation functions. Hirano et al. (2000) suggest to model the probability of being an alwaystaker, never-taker or a complier given covariates X by a trinomial logistic distribution and to model the outcome
distributions separately for these types. Abadie (2003) initially introduces covariates in a nonparametric way but
proposes parametric and semiparametric estimation methods to avoid the curse of dimensionality of
nonparametric regression.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

40

Consider ﬁrst the case where the endogenous regressor D 2 f0; 1g and the instrument
Z 2 f0; 1g are both binary. For example, D could be attending/not attending college and Z
could be living close to or far from a college. (Extensions to non-binary D and non-binary
Z are discussed in Section 5.)
According to the reaction of D on an external intervention on Z in Eq. (2), the units i
can be distinguished into different types: For some units, D would remain unchanged if Z
were changed from 0 to 1, whereas for others D would change. With D and Z binary, four
different types t 2 fn; c; d; ag are possible:
ti
ti
ti
ti

¼n
¼c
¼d
¼a

if
if
if
if

Di;0
Di;0
Di;0
Di;0

¼0
¼0
¼1
¼1

and
and
and
and

Di;1
Di;1
Di;1
Di;1

¼0
¼1
¼0
¼1

Never-taker
Complier
Deﬁer
Always-taker

Since the units of type always-taker and of type never-taker cannot be induced to change D
through a variation in the instrumental variable, the impact of D on Y can at most be
ascertained for the subpopulations of compliers and deﬁers. Under certain assumptions
given below, the LATE g for the subpopulation of compliers
Z
g ¼ E½Y 1  Y 0 jt ¼ c ¼ ðjð1; Z; X ; Þ  jð0; Z; X ; ÞÞ dF Z;X ;jt¼c
(4)
is identiﬁed. This is the effect for the largest subpopulation for which an effect can be
identiﬁed without parametric or constant treatment effect assumptions.
Deﬁne also the treatment effect for the compliers with characteristics x as
gðxÞ ¼ E½Y 1  Y 0 jX ¼ x; t ¼ c.
To identify the LATE g, consider the model (1) and (2) and assume that:
Assumption 1 (Monotonicity). The subpopulation of deﬁers has probability measure zero:
PðDi;0 4Di;1 Þ ¼ 0.
Assumption 2 (Existence of compliers). The subpopulation of compliers has positive
probability:
PðDi;0 oDi;1 Þ40.
Assumption 3 (Unconfounded type). The relative size of the subpopulations always-takers,
never-takers and compliers is independent of the instrument: for all x 2 SuppðX Þ
Pðti ¼ tjX i ¼ x; Z i ¼ 0Þ ¼ Pðti ¼ tjX i ¼ x; Zi ¼ 1Þ

for t 2 fa; n; cg.

Assumption 4 (Mean exclusion restriction). The potential outcomes are mean independent
of the instrumental variable Z in each subpopulation: for all x 2 SuppðX Þ
E½Y 0i;Zi jX i ¼ x; Z i ¼ 0; ti ¼ t ¼ E½Y 0i;Zi jX i ¼ x; Z i ¼ 1; ti ¼ t for t 2 fn; cg,
E½Y 1i;Zi jX i ¼ x; Z i ¼ 0; ti ¼ t ¼ E½Y 1i;Zi jX i ¼ x; Z i ¼ 1; ti ¼ t for t 2 fa; cg.
Assumption 5 (Common support). The support of X is identical in both subpopulations:
SuppðX jZ ¼ 1Þ ¼ SuppðX jZ ¼ 0Þ.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

41

An equivalent representation of the common support condition is that 0opðxÞo1 8x with
f x ðxÞ40, where pðxÞ ¼ PðZ ¼ 1jX ¼ xÞ.
Assumptions 1 and 2 rule out the existence of subpopulations that are affected by the
instrument in an opposite direction. Monotonicity ensures that the effect of Z on D has
the same direction for all units. For college proximity as an instrument to identifying the
returns to attending college, monotonicity requires that any child which would not have
attended college if living close to a college, would also not have done so if living far from a
college. The existence assumption requires that the college attendance decision depends,
for at least some children, on the proximity to the nearest college.
Assumption 3 allows to identify the effect of Z on D and to estimate the fraction of
compliers. Without conditioning on covariates X this assumption may often be invalidated
because of selection effects. For example, parents who would like to see their children
attending college but fear that they might not want to attend if living too far away, might
decide to reside closer to a college. In this case, the subpopulation living close to a college
would contain a higher fraction of compliers than those living far away. Validity of
Assumption 3 requires that the vector X contains all variables that affect the choice of
residence Z as well as the type t (which is determined by Di;0 and Di;1 ).
Assumption 4 rules out a direct effect of Z on Y. Conditional on X, any effect of Z
should be channelled through D such that the potential outcomes are not correlated with
the instrument. Without conditioning on X, this assumption may often be invalid, for
example, if college proximity itself has a direct effect on the child’s wages in its later career
or if the families who decided to reside close to a college are different from those who
decided to live far from a college.
Assumption 5 requires that for any value of X (in its support) both values of the
instrument Z can be observed.
Theorem 1 (Identification of LATE). Under Assumptions 1–5 and supposing that E½Y o1,
the LATE g for the subpopulation of compliers is nonparametrically identified as
R
ðE½Y jX ¼ x; Z ¼ 1  E½Y jX ¼ x; Z ¼ 0Þf x ðxÞ dx
g ¼ E½Y 1  Y 0 jt ¼ c ¼ R
.
(5)
ðE½DjX ¼ x; Z ¼ 1  E½DjX ¼ x; Z ¼ 0Þf x ðxÞ dx
To prove Theorem 1 note that the size of the complier-subpopulation with
characteristics x is identiﬁed as
Pðt ¼ cjX ¼ xÞ ¼ E½DjX ¼ x; Z ¼ 1  E½DjX ¼ x; Z ¼ 0,

(6)

and that for all x with Pðt ¼ cjX ¼ xÞ40 the treatment effect gðxÞ is identiﬁed as
gðxÞ ¼ E½Y 1i;Zi  Y 0i;Zi jX i ¼ x; ti ¼ c ¼

E½Y jX ¼ x; Z ¼ 1  E½Y jX ¼ x; Z ¼ 0
,
E½DjX ¼ x; Z ¼ 1  E½DjX ¼ x; Z ¼ 0
(7)

see Appendix.
gðxÞ identiﬁes the treatment effect for the compliers with characteristics X ¼ x. More
interesting, however, would often be an estimate of the average treatment effect for the
subpopulation of all compliers, which is the largest subpopulation for which a treatment
effect is identiﬁed.
If Assumptions 1–4 are valid without conditioning on X, the LATE g would be identiﬁed
by ðE½Y jZ ¼ 1  E½Y jZ ¼ 0Þ=ðE½DjZ ¼ 1  E½DjZ ¼ 0Þ. If conditioning on X is

ARTICLE IN PRESS
42

M. Frölich / Journal of Econometrics 139 (2007) 35–75

necessary, the conditional effects gðxÞ need to be weighted by the distribution of x in the
all-compliers subpopulation to obtain the average treatment effect g for all compliers:
Z
g ¼ E½Y 1i;Zi  Y 0i;Zi jti ¼ c ¼ gðxÞ dF xjt¼c ,
where F xjt¼c denotes the distribution function of X in the subpopulation of all compliers.9
Since the subpopulation of compliers is not identiﬁed, dF xjt¼c is also not identiﬁed.
However, by Bayes’ theorem dF xjt¼c ¼ ðPðt ¼ cjX ¼ xÞ=Pðt ¼ cÞÞ dF x , which gives
Z
Pðt ¼ cjX ¼ xÞ
dF x .
g ¼ gðxÞ 
Pðt ¼ cÞ
Inserting (7) and noting that the fraction of compliers corresponds to (6) gives
R
ðE½Y jX ¼ x; Z ¼ 1  E½Y jX ¼ x; Z ¼ 0Þf x ðxÞ dx
.
g¼
Pðt ¼ cÞ
R
With Pðt ¼ cÞ ¼ Pðt ¼ cjX ¼ xÞ dF x and using (6), the LATE on all compliers is given
by (5). By Assumption 5 the conditional expectations are identiﬁed in the Z ¼ 1 and 0
subpopulations.
3. Nonparametric conditional LATE estimation
In this section nonparametric estimation of the LATE g is discussed. Deﬁne the
conditional mean functions mz ðxÞ ¼ E½Y jX ¼ x; Z ¼ z and mz ðxÞ ¼ E½DjX ¼ x; Z ¼ z
^ z ðxÞ and m^ z ðxÞ be corresponding nonparametric regression estimators thereof.
and let m
A nonparametric imputation estimator of g is
P
^ ðX Þ  m
^ 0 ðX i ÞÞ
ðm
Pi 1 i
,
^ 1 ðX i Þ  m^ 0 ðX i ÞÞ
i ðm
where the expected values E½Y jX ; Z and E½DjX ; Z are imputed for each observation X i .
Using the observed values Y i and Di as estimates of E½Y i jX i ; Z ¼ z and
E½Di jX i ; Z ¼ z, whenever z ¼ Zi , gives the conditional LATE estimator g^ as
P
P
^ 0 ðX i ÞÞ  i:Zi ¼0 ðY i  m
^ 1 ðX i ÞÞ
i:Zi ¼1 ðY i  m
P
.
(8)
g^ ¼ P
^ 0 ðX i ÞÞ  i:Zi ¼0 ðDi  m^ 1 ðX i ÞÞ
i:Zi ¼1 ðDi  m
The estimator g^ corresponds to a ratio of two matching estimators, which are frequently
used in treatment evaluation to estimate average treatment effects when the endogeneity of
the regressor D can be completely controlled for by observed covariates (Angrist and
Krueger, 1999; Heckman et al., 1999).
To analyse the properties of g^ , it is useful to ﬁrst derive the semiparametric efﬁciency
bound for the estimation of the LATE g. In the following theorems it is supposed that X is
continuous. X could easily be allowed to contain both continuous and discrete regressors
or only discrete regressors, at the expense of a more complex notation.
9
An alternative approach would be to weight gðxÞ by the distribution dF x , as has beenRsuggested forRexample by
Das (2005) and others. Unless gðxÞ is constant or Pðt ¼ cjX Þ ¼ Pðt ¼ cÞ, the weighting gðxÞ dF x ¼ ððE½Y jX ¼
x; Z ¼ 1  E½Y jX ¼ x; Z ¼ 0Þ=ðE½DjX ¼Rx; Z ¼ 1  E½DjX ¼ x; Z ¼ 0ÞÞf x ðxÞ dx would represent a different
causal parameter. In addition, estimation of gðxÞ dF x might be more difﬁcult in small samples than of (5) if the effect
of Z on D (i.e. the denominator) is small.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

43

Theorem 2 (Efficiency bound). The semiparametric variance bound for g is
"
#
s2Y 1 ðX Þ  2gs2Y 1 D1 ðX Þ þ g2 s2D1 ðX Þ s2Y 0 ðX Þ  2gs2Y 0 D0 ðX Þ þ g2 s2D0 ðX Þ
1
þ
V ¼ 2E
pðX Þ
1  pðX Þ
G
þ
R

1
E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 ,
G2

ð9Þ

where G ¼ ðm1 ðxÞ  m0 ðxÞÞf x ðxÞ dx is the denominator in (5), pðxÞ ¼ PðZ ¼ 1jX ¼ xÞ is the
probability that Z takes the value one given X, and s2Y z ðxÞ, s2Dz ðxÞ and s2Y z Dz ðxÞ are the
conditional variances and covariances in the Z ¼ z subpopulation: s2Y 1 ðX Þ ¼ Var½Y jX ¼ x;
Z ¼ 1 , and s2Y 1 D1 ðxÞ ¼ Cov½Y ; DjX ¼ x; Z ¼ 1 etc. (Proof in Appendix.)
In the following Theorem 3, the asymptotic distribution of g^ is derived and conditions
^ z ðxÞ and m^ z ðxÞ are given for obtaining efﬁciency.
on the preliminary estimators m
In Theorems 4 and 5 it is shown that local polynomial regression as well as series
estimation can yield efﬁcient estimates.
Theorem 3 (Asymptotic normality of g^ ). Suppose that
(i)
(ii)
(iii)
(iv)

(A)
(B)
(C)
(D)
(E)

the LATE g is identified,
fðY i ; Di ; Z i ; X i Þgni¼1 are iid, Z i 2 f0; 1g and X i 2 Rk ,
E½Y 2 o1,
^ 1 of m1 ðxÞ ¼ E½Y jX ¼ x; Z ¼ 1 is asymptotically linear
the nonparametric estimator m
X
1
m
^ 1 ðxÞ  m1 ðxÞ ¼
xm ðY j ; X j ; xÞ þ bm
m
1 ðxÞ þ R1 ðxÞ,
j:Zj ¼1 1
n1
P
where nz ¼ ni¼1 1ðZi ¼ zÞ, with the properties:
E½xm
1 ðY j ; X j ; X ÞjX ¼ x; Z j ¼ 1 ¼ 0;
2
E½xm
1 ðY j ; X j ; X i Þ jZ j ¼ 1; Z i ¼ 0 ¼ oðnÞ;
P
m
p1ﬃﬃﬃﬃ
i:Z i ¼0 b1 ðX i Þ ¼ op ð1Þ;
n0
P
m
p1ﬃﬃﬃﬃ
i:Z i ¼0 R1 ðX i Þ ¼ op ð1Þ;
n0
f xjz¼0 ðX j Þ
þ op ð1Þ,
E½xm
1 ðY j ; X j ; X i ÞjY j ; X j ; Z j ¼ 1; Z i ¼ 0 ¼ ðY j  m1 ðX j ÞÞ
f xjz¼1 ðX j Þ
^ 0 , m^ 1 , m^ 0 . Then the estimator (8) of the LATE g is asymptotically
and analogously for m
normally distributed
pﬃﬃﬃ
nð^g  gÞ ! Nð0; VÞ,
(10)
where V is given by (9).

Condition (i) requires that the LATE g is identiﬁed by the Assumptions 1–5 discussed
previously. Condition (ii) supposes random sampling. This condition readily could be
relaxed to allow for stratiﬁed sampling on X and Z,10 as long as the population density
function f x ðxÞ can be recovered, for example through known sampling weights.
^ z ðxÞ and m^ z ðxÞ. The
Condition (iv) gives conditions on the nonparametric estimators m
^
term xm
ðY
;
X
;
xÞ
is
the
mean-zero
local
inﬂuence
function
of
m
ðxÞ
and captures its
j
j
z
z
10

For example, iid sampling within ðY ; D; X ÞjZ ¼ 1 and ðY ; D; X ÞjZ ¼ 0.

ARTICLE IN PRESS
44

M. Frölich / Journal of Econometrics 139 (2007) 35–75

^ z ðxÞ, and Rm
variance bm
z ðxÞ is a residual term. Condition (B)
z ðxÞ is the local bias of m
m
requires that the variance of xz does not grow too fast. Condition (C) constrains the local
bias term to be of order op ðnð1=2Þ Þ. This assumption could be relaxed to permit a local bias
term of order Op ðn1=2 Þ, but this would introduce an asymptotic bias term in (10). The
pﬃﬃﬃ
condition (E) is not necessary for n-asymptotic normality, but is imposed to achieve
efﬁciency.
^ z ðxÞ and m^ z ðxÞ that satisfy the conditions
It remains to ﬁnd nonparametric estimators m
of Theorem 3. Potential estimators are kernel and local polynomial regression, nearestneighbour regression and series estimators. Theorem 4 shows that local polynomial
regression, which include Nadaraya–Watson and
pﬃﬃﬃ local linear regression, satisﬁes the
conditions of Theorem 3 and thus leads to n-asymptotically normal and efﬁcient
estimation of LATE.
Theorem 4 (Efficiency of local polynomial regression). Consider the assumptions:
(1) m1 ðxÞ, m0 ðxÞ, m1 ðxÞ and m0 ðxÞ are p̄-times continuously differentiable with p̄th derivative
Hölder continuous,11 where p̄4k and k ¼ dimðX Þ,
(2) the bandwidth sequence hn1 satisfies n1 hkn1 = ln n1 ! 1 and n1 h2p̄
n1 ! 0,
(3) the Kernel function K is symmetric, compact and Lipschitz continuous,12
(4) the density f xjz¼1 of X is p̄-times continuously differentiable with its p̄th derivative
Hölder continuous,
(5a) the Kernel function K has moments of order 1 through p̄ equal to zero,
(5b) the Kernel function K has moments of order 1 through p̄  1 equal to zero,
(6) m1 ðxÞ, m0 ðxÞ, m1 ðxÞ and m0 ðxÞ are estimated at an interior point of SuppðX jZ ¼ 1Þ,13
Therem 4a. If Assumptions 1–4 and 5a are satisfied, local polynomial regression of order p̄
satisfies the conditions of Theorem 3.
Theorem 4b. If Assumptions 1–4 and 5b and 6 are satisfied, local polynomial regression of
order 0ppop̄ satisfies the conditions of Theorem 3.
Nearest-neighbour regression is not covered by Theorem 4. Nearest-neighbour
regression may lead to efﬁcient estimation of LATE if the number of neighbours increases
with sample size at an appropriate rate. For a ﬁxed number of neighbours, however, the
estimator would be inefﬁcient. Abadie and Imbens (2006) analyse the asymptotic
properties of matching estimators with a ﬁxed number of matches (i.e. using nearestneighbour regression with a ﬁxed number of neighbours). They show that these matching
estimators are inefﬁcient and have bias terms of p
stochastic
order n1=k . Consequently, they
ﬃﬃﬃ
are asymptotically biased for k ¼ 2 and are not n-consistent if X contains more than two
continuous regressors. Since the LATE g corresponds to a ratio of two matching
estimators,
pﬃﬃﬃ both the numerator and the denominator of (5) would be estimated inefﬁciently
or not n-consistently if matching estimators with a ﬁxed number of matches were used.
11

Hölder continuity of a function zðxÞ at x0 means that there exist a 2 ð0; 1 and C40 such that jzðxÞ  zðx0 ÞjpC 
kx  x0 ka for all x.
12
Lipschitz continuous means Hölder continuous of order a ¼ 1.
13
This requires a trimming function to trim observations in the boundary.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

45

^ z ðxÞ and m^ z ðxÞ could also be estimated
As an alternative to local polynomial regression, m
by nonparametric series regression. Under the assumptions of Theorem
pﬃﬃﬃ 5, the LATE
^ z ðxÞ and m^ z ðxÞ is n-asymptotically
estimator based on series regression estimates of m
normal and efﬁcient. Let pK ðxÞ ¼ ððp1K ðxÞ; . . . ; pKK ðxÞÞ0 be a vector of basis functions,
where K is the (nonrandom) number of series terms included, which grows to inﬁnity with
increasing sample size. Let pK ¼ ðpK ðX 1 Þ; . . . ; pK ðX n ÞÞ0 be the matrix for the data
^ jX ¼ X i  ¼
observations. A series estimator of, for example, E½Y jX ¼ X i  is E½Y
pK ðX i Þ0 Z^ where the coefﬁcient vector is Z^ ¼ ðpK0 pK Þ pK0 ðY 1 ; . . . ; Y n Þ0 . For the estimation
of the conditional LATE, series estimators of the four conditional mean functions
m1 ðxÞ, m0 ðxÞ, m1 ðxÞ and m0 ðxÞ are needed. These can be obtained by separate regressions in
the Z ¼ 0 and Z ¼ 1 subpopulations, respectively. Alternatively, by noting that
E½Y jX ; Z ¼ 1 ¼ E½YZjX =E½ZjX , one can estimate m1 by using series estimators of
E½YZjX  and E½ZjX , and analogously for m0 , m1 and m0 . The proof is based on the latter
approach, where the ﬁve conditional expectations E½YZjX , E½Y ð1  ZÞjX , E½DZjX ,
E½Dð1  ZÞjX  and E½ZjX  are estimated by series regression, using orthogonal power
series. For convenience of notation it is assumed that the same basis functions are used in
all ﬁve series regressions.
Theorem 5 (Efficiency of series estimation). Suppose that:
(i) the LATE g is identified,
(ii) fðY i ; Di ; Zi ; X i Þgni¼1 are iid with Z i 2 f0; 1g and X i 2 Rk ,
(iii) m1 ðxÞ, m0 ðxÞ, m1 ðxÞ, m0 ðxÞ are bounded on the support of X and pðxÞ is bounded away
from zero and from one on the support of X,
(iv) s2Y 1 ðxÞ; s2Y 0 ðxÞ; s2D1 ðxÞ; s2D0 ðxÞ are bounded on the support of X,
(v) pðxÞ, m1 ðxÞ, m0 ðxÞ, m1 ðxÞ, m0 ðxÞ are continuously differentiable of order s, with s43k
where k is the dimension of X
(vi) X is continuously distributed with support equal to a Cartesian product of compact
intervals,
(vii) the density of X is bounded away from zero on its support,
(viii) the series terms pkK ðxÞ are products of polynomials that are orthonormal with respect to
the uniform weight, with K ¼ nv for some 1=ð4ðs=k  1ÞÞovo17.
Then the conditional LATE estimator g^ series based on series estimates of E½YZjX ,
E½Y ð1  ZÞjX , E½DZjX , E½Dð1  ZÞjX  and E½ZjX  is asymptotically normal
pﬃﬃﬃ
nð^gseries  gÞ!Nð0; VÞ,
where V is given by (9).
4. LATE with propensity score
The conditional LATE estimator g^ corresponds to a ratio of two matching estimators.
In the treatment evaluation literature, two alternative approaches to matching on X are
widely used: matching on the propensity score and weighting by the propensity score,
where the propensity score is the (one-dimensional) treatment participation probability.
Matching and weighting by the propensity score have the advantage that they do not
require high-dimensional nonparametric regression of mz ðxÞ and mz ðxÞ.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

46

Propensity score based estimators can also be constructed for the estimation of
R g, with
pðxÞ ¼ PðZ ¼ 1jX ¼ xÞ as
the
propensity
score.
By
noting
that
E½YZ=pðX
Þ
¼
ð1=pðxÞÞ
R
E½YZjX ¼ xf x ðxÞ dx ¼ m1 ðxÞf x ðxÞ dx, the conditional LATE can be written as
g¼

E½YZ=pðX Þ  Y ð1  ZÞ=ð1  pðX ÞÞ
E½DZ=pðX Þ  Dð1  ZÞ=ð1  pðX ÞÞ

and estimated by the propensity score weighting estimator
P
ðY i Z i =pðX i Þ  Y i ð1  Z i Þ=ð1  pðX i ÞÞÞ
g^ pw ¼ Pi
.
i ðDi Z i =pðX i Þ  Di ð1  Z i Þ=ð1  pðX i ÞÞÞ

(11)

(12)

To derive the propensity score matching estimator, note that the conditional LATE can
also be written as
R
ðmp1 ðrÞ  mp0 ðrÞÞ  f p ðrÞ dr
g¼ R
,
(13)
ðmp1 ðrÞ  mp0 ðrÞÞ  f p ðrÞ dr
where mp1 ðrÞ ¼ E½Y jpðX Þ ¼ r; Z ¼ 1 and mp1 ðrÞ ¼ E½DjpðX Þ ¼ r; Z ¼ 1 are the conditional means given the propensity score and f p is the density function of pðxÞ in the
population. The propensity score matching estimator is
P
^ p1 ðpi Þ  m
^ p0 ðpi ÞÞ
ðm
,
(14)
g^ pm ¼ Pi
^
^
ð
m
ðp
Þ

m
p0 ðpi ÞÞ
i p1 i
where pi ¼ pðX i Þ. An advantage of propensity score matching g^ pm over g^ is that it requires
only one-dimensional nonparametric regression.
To prove Eq. (13), note that by the law of iterated expectations




YZ
YZ
jpðX Þ ¼ r
E
¼ EE
pðX Þ
pðX Þ


1
¼ E E½Y jpðX Þ ¼ r; Z ¼ 1P½Z ¼ 1jpðX Þ ¼ r
r
Z
¼ E½E½Y jpðX Þ ¼ r; Z ¼ 1 ¼ mp1 ðrÞf p ðrÞ dr.
R
RSince furthermore,R E½YZ=pðX Þ ¼ m1 ðxÞf x ðxÞ dx, as shown above, it follows that
m1 ðxÞf x ðxÞ dx ¼ mp1 ðrÞf p ðrÞ dr. With analogous results for mp0 , mp1 and mp0 , Eq. (13)
follows.
In many applications, the propensity score pðxÞ might be unknown and needs to be
estimated. Even when the propensity score is known, using an estimated propensity score
in the estimator might be worthwhile. Whether knowledge of the true propensity score
affects efﬁcient estimation has been analysed in several articles for matching estimators.
Analogous results can be derived here for the estimation of LATE. Theorem 6 shows that
the efﬁciency bound for the estimator g^ is not affected by knowledge of the propensity
score. This result is similar to Hahn (1998).
Theorem 6 (Efficiency bound with knowledge of propensity score). Suppose that the
propensity score pðxÞ is known. The semiparametric variance bound for g is V, where V is
given by (9).

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

47

For the propensity score weighting estimator, noting the similarities to Hirano et al.
(2003), I conjecture that weighting with an appropriately estimated propensity score would
be efﬁcient, whereas weighting with the true propensity score would not be. A proof,
however, is beyond the scope of this paper.
For the propensity score matching estimator, to assess efﬁciency consider ﬁrst the
situation where the propensity score pðxÞ is known. Provided that the conditions of
Theorems 3 or 5 are satisﬁed with X replaced by pðX Þ, the asymptotic variance of
propensity score matching with respect to the known propensity score p is
"
#
s2pY 1 ðpÞ  2gs2pY 1 D1 ðpÞ þ g2 s2pD1 ðpÞ s2pY 0 ðpÞ  2gs2pY 0 D0 ðpÞ þ g2 s2pD0 ðpÞ
1
V pm ¼ 2 E
þ
p
1p
G
h
i

2
1
þ 2 E mp1 ðpÞ  mp0 ðpÞ  gmp1 ðpÞ þ gmp0 ðpÞ ,
ð15Þ
G
where s2pY 1 ðrÞ ¼ Var½Y jpðX Þ ¼ r; Z ¼ 1 and s2pY 1 D1 ðrÞ ¼ Cov½Y ; DjpðX Þ ¼ r; Z ¼ 1. The
following theorem shows that this variance is generally larger than V. If the propensity
score is unknown, its estimation would add even further to the variance of the propensity
score matching estimator.14 Therefore, matching on the propensity score is generally
inefﬁcient.
Theorem 7 (Inefficiency of propensity score matching). The difference between the
asymptotic variance when matching on the known propensity score and the asymptotic
variance when matching on X is non-negative and given by






1
1p
p
Var m1 ðX Þ  gm1 ðX Þjp þ
Var m0 ðX Þ  gm0 ðX Þjp
V pm  V ¼ 2 E
p
1p
G
2
þ 2 E½Covðm1 ðX Þ  gm1 ðX Þ; m0 ðX Þ  gm0 ðX ÞjpÞX0.
G
Generally, V pm  V is strictly positive unless the support of the propensity score
pðxÞ
contains only values where both variances are zero or where
pﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
ðVarðm
ðX Þ  gm1 ðX ÞjpÞÞ=ðVarðm0 ðX Þ  gm0 ðX ÞjpÞÞ
p1ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
pð1 þ ðVarðm1 ðX Þ  gm1 ðX ÞjpÞÞ=ðVarðm0 ðX Þ  gm0 ðX ÞjpÞÞÞ ¼ 0.
5. Non-binary treatments and non-binary instruments
Whereas the previous two sections considered the estimation of LATE with D and Z
binary, extensions to non-binary instrumental variables Z and non-binary endogenous
regressors D are considered here. It will be seen that the formula (5) still applies to the
estimation of the LATE, such that the results derived in Theorems 2–7 largely carry
through to non-binary instrumental variables and non-binary endogenous regressors.
Examine ﬁrst the situation with a binary regressor D and a single non-binary instrument
Z, which has bounded support SuppðZÞ ¼ ½zmin ; zmax . Obviously, a LATE could be deﬁned
with respect to any two distinct values of Z. However, this would yield a multitude of pairwise treatment effects, each of them referring to a different population. Instead of
estimating many pair-wise effects, one would often prefer to estimate the average treatment
14

Unless a joint estimator of p, mp1 , mp0 , mp1 and mp0 with smaller variance can be constructed.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

48

effect in the largest subpopulation for which an effect can be identiﬁed, which is the
subpopulation of all individuals who react to the instrument.
Deﬁne the subpopulation of compliers as all individuals with Di;zmin ¼ 0 and Di;zmax ¼ 1.
The compliers comprise all individuals who switch from D ¼ 0 to 1 at some point when the
instrument Z is increased from zmin to zmax . The value of z which triggers the switch can be
different for different individuals. If monotonicity holds with respect to any two values z
and z0 , each individual switches D at most once. The following assumptions are extensions
of Assumptions 1–5 to a non-binary instrument.
Assumption 1 (Monotonicity). The effect of Z on D is monotonous
PðDi;z 4Di;z0 Þ ¼ 0

for any values z; z0 with zmin pzoz0 pzmax .

Assumption 2 (Existence of compliers). The subpopulation of compliers has positive
probability
Pðt ¼ cÞ40

where ti ¼ c if Di;zmin oDi;zmax .

Assumption 3 (Unconfounded type). For any two values z; z0 2 SuppðZÞ, any d; d 0 2 f0; 1g
and for all x 2 SuppðX Þ
PðDi;z ¼ d; Di;z0 ¼ d 0 jX i ¼ x; Zi ¼ zÞ ¼ PðDi;z ¼ d; Di;z0 ¼ d 0 jX i ¼ xÞ.
Assumption 4 (Mean exclusion restriction). For any two values z; z0 2 SuppðZÞ, any d; d 0 2
f0; 1g and for all x 2 SuppðX Þ
E½Y di;Zi jX i ¼ x; Di;z ¼ d; Di;z0 ¼ d 0 ; Z i ¼ z ¼ E½Y di;Zi jX i ¼ x; Di;z ¼ d; Di;z0 ¼ d 0 .
Assumption 5 (Common support). The support of X is identical for zmin and zmax
SuppðX jZ ¼ zmin Þ ¼ SuppðX jZ ¼ zmax Þ ¼ SuppðX Þ.
Theorem 8 (LATE with non-binary instrument). Suppose that D is binary, the instrument Z
has bounded support SuppðZÞ ¼ ½zmin ; zmax  and Assumptions 1–5’ are satisfied. The LATE
for the subpopulation of compliers is nonparametrically identified as
R
ðE½Y jX ¼ x; Z ¼ zmax   E½Y jX ¼ x; Z ¼ zmin Þf x ðxÞ dx
E½Y 1  Y 0 jt ¼ c ¼ R
.
ðE½DjX ¼ x; Z ¼ zmax   E½DjX ¼ x; Z ¼ zmin Þf x ðxÞ dx
(16)
This formula is analogous to (5) with Z ¼ 0 and Z ¼ 1 replaced with the endpoints of
the support of Z. If Z is discrete,
results of Theorems 2–7 can be applied. For a
pﬃﬃthe
ﬃ
continuous instrument, however, n-consistency usually cannot be achieved, unless it is
mixed continuous-discrete with mass points at zmin and zmax .
From (16) a bias-variance trade-off in the estimation of the LATE with non-binary
Z becomes visible. Although (16) incorporates the proper weighting of the different
complier subgroups and leads to an unbiased estimator of LATE, only observations with
Zi equal (or close) to zmin or zmax are used for estimation. Observations with Z i between
the endpoints zmin and zmax are neglected, which might lead to a large variance. Variance
could be reduced, at the expense of a larger bias, by weighting the complier subgroups
^ z ðxÞ and m^ z ðxÞ.
differently or by choosing larger bandwidth values for the estimators m
A detailed analysis is left for future research.
Now consider the situation with multiple instrumental variables, i.e. Z being vector
valued. Since the different instrumental variables act through their effect on D, the

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

49

different components of Z can be summarized conveniently by using pðz; xÞ ¼ PðD ¼
1jX ¼ x; Z ¼ zÞ as instrument. If D follows an index structure in the sense that Di depends
on Zi only via pðZ i ; X i Þ,15 and Assumption 1–5’ are satisﬁed with respect to pðz; xÞ, the
LATE is identiﬁed as
R
1

0

E½Y  Y jt ¼ c ¼ R

ðE½Y jX ¼ x; pðZ; X Þ ¼ p̄x   E½Y jX ¼ x; pðZ; X Þ ¼ px Þf x ðxÞ dx
ðE½DjX ¼ x; pðZ; X Þ ¼ p̄x   E½DjX ¼ x; pðZ; X Þ ¼ px Þf x ðxÞ dx

,

(17)

where p̄x ¼ maxz pðz; xÞ and px ¼ minz pðz; xÞ. Again, this formula is analogous to (5).16
The two groups of observations on which estimation is based are those with pðz; xÞ ¼ p̄x
and those with pðz; xÞ ¼ px . Exact knowledge of pðz; xÞ is not needed for estimation; it is
sufﬁcient to identify the set of observations for which pðZ; X Þ is highest and lowest,
respectively. For example, if Z contains two binary instrumental variables (Z 1 ; Z 2 ) which,
for any value of X, both have a positive effect on D, then the observations with Z 1 ¼
Z 2 ¼ 0 and those with Z 1 ¼ Z2 ¼ 1 represent the endpoints of the support of pðZ; X Þ given
X and are used for the estimation.
Finally, consider the situation where the endogenous regressor D is non-binary. Suppose
that D 2 f0; . . . ; Kg is discrete and that the instrument Z is binary. With D taking many
different values, the compliance intensity can differ among units. Some units might be
induced to change from Di ¼ d to Di ¼ d þ 1 as a reaction on changing Zi from 0 to 1.
Other units might change, for example, from Di ¼ d 0 to Di ¼ d 0 þ 2. Suppose D is years of
schooling and Z an instrument that inﬂuences the schooling decision. If Z were changed
exogenously, some individuals might respond by increasing school attendance by an
additional year. Other individuals might increase school attendance even by two or three
years. Furthermore, even if Z were set to zero for all individuals, they would attend
different years of schooling. Hence a change in Z induces a variety of different reactions in
D, which cannot be disentangled. Only a weighted average of these effects can be identiﬁed.
According to their reaction on a change in Z from 0 to 1, the population can be partitioned
into the types c0;0 ; c0;1 ; . . . ; cK;K where
ti ¼ ck;l

if Di;0 ¼ k and Di;1 ¼ l.

(18)

Assuming monotonicity, the deﬁer-types ck;l for k4l do not exist. The types ck;k
represent those units that do not react on a change in Z (these are the always-takers
and the never-takers in the setup where D is binary). The types ck;l for kol are the
compliers, which comply by increasing Di from k to l. These compliers comply at different
base levels k and with different intensities l  k. In the returns to schooling example,
E½Y kþ1  Y k jX ; t ¼ ck;kþ1  measures the return to one additional year of schooling for the
ck;kþ1 subpopulations. E½Y kþ2  Y k jX ; t ¼ ck;kþ2  measures the return to two additional
years of schooling, which can be interpreted as twice the average return of one additional
year. Similarly, E½Y kþ3  Y k jX ; t ¼ ck;kþ3  is three times the average return to one
additional year. Hence the effective weight contribution of the ck;l subpopulation to the
measurement of the return to one additional year of schooling is ðl  kÞ  Pðt ¼ ck;l Þ.
Accordingly, the weighted average treatment effect gw ðxÞ for all compliers with
15

I.e. Di;z ¼ Di;z0 if pðz; X i Þ ¼ pðz0 ; X i Þ. In other words, Di does not change if Zi is varied within a set where
pð; X i Þ remains constant. See e.g. Heckman and Vytlacil, 2001. If the index structure is not satisﬁed, a more
involved monotonicity condition would be needed. R
16
The denominator of (17) can also be written as ðp̄x  px Þf x ðxÞ dx.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

50

characteristics x can be deﬁned as17
PK PK
E½Y l  Y k jX ; t ¼ ck;l   Pðt ¼ ck;l jX Þ
gw ðX Þ ¼ k l4k
,
PK PK
k
l4k ðl  kÞ  Pðt ¼ ck;l jX Þ

(19)

where gw ðxÞ is the effect of the induced treatment change, averaged over the different
complier groups and normalized by the intensity of compliance.
To obtain the weighted average effect for the subpopulation of all compliers (i.e. all
subpopulations ck;l with kol), one would need to weight gw ðxÞ by the distribution of X in
the complier subpopulation
Z
gw ðxÞ dF xjcomplier ,
where F xjcomplier is the distribution of X in the all-compliers subpopulation.
Unfortunately, the distribution of X in the all-compliers subpopulation is not identiﬁed if D
takes more than two different values. In particular, the size of the all-compliers subpopulation
is no longer identiﬁed by the distribution of D and Z.18 Nevertheless, if one deﬁnes the allcompliers subpopulation in terms of compliance intensity units, the distribution of X is
identiﬁed. In the intensity-weighted complier subpopulation, each complier is weighted by its
compliance intensity. In the case where D 2 f0; 1; 2g, the subpopulation c0;2 receives twice the
weight of the subpopulation c0;1 . In the years-of-schooling example, the subpopulation c0;2
complies with two additional years of schooling. If the returns to a year of schooling are the
same for each year of schooling, an individual who complies with two additional years can be
thought of as an observation that measures twice the effect of one additional year of
schooling. Or, in other words, as two (correlated) measurements of the return to a year of
schooling. Unless these two measurements are perfectly correlated, the individual who
complies with two additional years contributes more to the estimation of the return to
schooling than an individual who complies with only one additional year. Consequently, the
individuals who comply with more than one year should receive a higher weight when
averaging the return to schooling over the distribution of X. If each individual is weighted by
its number of additional years, the weighted distribution function of X in the all-compliers
subpopulation, in the case where D 2 f0; 1; 2g, is
f wxjcomplier ¼

f xjt¼c0;1 Pðt ¼ c0;1 Þ þ f xjt¼c1;2 Pðt ¼ c1;2 Þ þ 2f xjt¼c0;2 Pðt ¼ c0;2 Þ
Pðt ¼ c0;1 Þ þ Pðt ¼ c1;2 Þ þ 2Pðt ¼ c0;2 Þ

or in the general case
PK PK
f wxjcomplier ¼

k

l4k ðl  kÞ  f xjt¼ck;l Pðt ¼ ck;l Þ
.
PK PK
k
l4k ðl  kÞ  Pðt ¼ ck;l Þ

(20)

17
The presentation in Angrist and Imbens (1995) looks different from the deﬁnition of gw used here, as they
present the effect in terms of overlapping subpopulations. Nevertheless, both deﬁnitions are equivalent.
18
Consider the following example: for D taking values in f0; 1; 2g, the population can be partitioned in the
subpopulations: fc00 , c01 , c02 , c11 , c12 , c22 g with the all-compliers subpopulation consisting of fc01 , c02 , c12 g. The
two partitions fc00 , c01 , c02 , c11 , c12 , c22 g ¼ f0:1, 0:1, 0:3, 0:3, 0:1, 0:1g and f0:1, 0:2, 0:2, 0:2, 0:2, 0:1g generate the
same distribution of D given Z: PðD ¼ 0jZ ¼ 0Þ ¼ 0:5, PðD ¼ 1jZ ¼ 0Þ ¼ 0:4, PðD ¼ 2jZ ¼ 0Þ ¼ 0:1,
PðD ¼ 0jZ ¼ 1Þ ¼ 0:1, PðD ¼ 1jZ ¼ 1Þ ¼ 0:4, PðD ¼ 2jZ ¼ 1Þ ¼ 0:5. However, the size of the all-compliers
subpopulation is different for the two partitions (0:5 and 0:6, respectively). Hence the size of the all-compliers
subpopulation is not identiﬁed from the observable variables.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

51

With respect to this weighted distribution function, the weighted LATE is identiﬁed, again by
a formula analogous to (5).
Theorem 9 (LATE with non-binary endogenous regressor). Suppose that D is discrete with
bounded support, the instrument Z is binary and Assumptions 1, 2, 5 are satisfied as well as
Assumptions 3 and 4 with respect to all types t 2 fck;l : kplg, defined in (18). The weighted
LATE for the subpopulation of compliers is nonparametrically identified as
Z
gw ¼
gw ðxÞ  f wxjcomplier ðxÞ dx
ð21Þ
R
ðE½Y jX ¼ x; Z ¼ 1  E½Y jX ¼ x; Z ¼ 0Þ  f x ðxÞ dx
¼ R
.
ð22Þ
ðE½DjX ¼ x; Z ¼ 1  E½DjX ¼ x; Z ¼ 0Þ  f x ðxÞ dx

6. Conclusions
In this paper nonparametric instrumental variables estimation of LATE has been
extended to accommodate confounding covariates X. A nonparametric LATE estimator
has been proposed and its asymptotic properties have been derived.
Identiﬁcation of LATE requires weaker assumptions than many alternative nonparametric instrumental variable models. Identiﬁcation and estimation of LATE has usually
been discussed without covariates. However, when the instrument is not randomly
assigned, the instrumental variable assumptions are often only valid conditional on a
vector of confounding covariates X. Usually covariates X have been included via
parametric modelling. The LATE estimator proposed in this paper, however, incorporates
covariates X in a fully nonparametric
way. This estimator corresponds to a ratio of two
pﬃﬃﬃ
matching estimators and it is n-consistent, asymptotically normal and efﬁcient.
Acknowledgements
I am grateful for discussions and comments to Joshua Angrist, Manuel Arellano,
Richard Blundell, Bernd Fitzenberger, Per Johansson, Michael Lechner, Costas Meghir,
Hidehiko Ichimura, Jeff Smith, the editors and two anonymous referees. The paper was
presented at the Econometric Society European Winter Meeting (Budapest, 2002), the EC2
meeting in London (December, 2003) and at seminars in Dublin, Konstanz and München.
This research was supported by the Swiss National Science Foundation (project NSF
4043-058311), the Grundlagenforschungsfonds HSG (project G02110112) and the Marie
Curie Individual Fellowship MEIF-CT-2004-006873.
Appendix A
A.1. Derivation of the treatment effect gðxÞ
It is shown that Assumptions 1–4 identify the LATE gðxÞ for all x with Pðt ¼ cjX ¼
xÞ40 according to (7). By partitioning the population into the subpopulations alwaystakers, never-takers, compliers and deﬁers, the expected value of Y given X and Z can be

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

52

written as
i
E½Y i jX i ¼ x; Z i ¼ z ¼ E½Y D
i;Zi jX i ¼ x; Z i ¼ z; ti ¼ n  Pðti ¼ njX i ¼ x; Z i ¼ zÞ
i
þ E½Y D
i;Z i jX i ¼ x; Z i ¼ z; ti ¼ c  Pðti ¼ cjX i ¼ x; Z i ¼ zÞ
i
þ E½Y D
i;Z i jX i ¼ x; Z i ¼ z; ti ¼ d  Pðti ¼ djX i ¼ x; Z i ¼ zÞ
i
þ E½Y D
i;Z i jX i ¼ x; Z i ¼ z; ti ¼ a  Pðti ¼ ajX i ¼ x; Z i ¼ zÞ

¼ E½Y 0i;Zi jX i ¼ x; Z i ¼ z; ti ¼ n  Pðti ¼ njX i ¼ xÞ
i
þ E½Y D
i;Z i jX i ¼ x; Z i ¼ z; ti ¼ c  Pðti ¼ cjX i ¼ xÞ

þ E½Y 1i;Zi jX i ¼ x; Z i ¼ z; ti ¼ a  Pðti ¼ ajX i ¼ xÞ
by Assumptions 1 and 3 and the deﬁnition of the types. By the mean exclusion restriction
(Assumption 4) the potential outcomes are independent of Z in the always- and in
the never-taker subpopulation. Hence when taking the difference E½Y jX ; Z ¼ 1 
E½Y jX ; Z ¼ 0 the respective terms for the always- and for the never-takers cancel,
such that
E½Y i jX i ¼ x; Z i ¼ 1  E½Y i jX i ¼ x; Z i ¼ 0
¼ ðE½Y 1i;Zi jX i ¼ x; Z i ¼ 1; ti ¼ c  E½Y 0i;Zi jX i ¼ x; Z i ¼ 0; ti ¼ cÞ  Pðti ¼ cjX i ¼ xÞ.

Exploiting the mean exclusion restriction for the compliers gives
E½Y i jX i ¼ x; Z i ¼ 1  E½Y i jX i ¼ x; Z i ¼ 0
¼ E½Y 1i;Zi  Y 0i;Zi jX i ¼ x; ti ¼ c  Pðti ¼ cjX i ¼ xÞ.

ð23Þ

Hence,
gðxÞ ¼ E½Y 1i;Zi  Y 0i;Zi jX i ¼ x; ti ¼ c ¼

E½Y i jX i ¼ x; Z i ¼ 1  E½Y i jX i ¼ x; Zi ¼ 0
.
Pðti ¼ cjX i ¼ xÞ

Noticing that E½DjX ; Z ¼ 0 ¼ PðD ¼ 1jX ; Z ¼ 0Þ ¼ Pðt ¼ ajX Þ þ Pðt ¼ djX Þ and E½DjX ;
Z ¼ 1 ¼ PðD ¼ 1jX ; Z ¼ 1Þ ¼ Pðt ¼ ajX Þ þ Pðt ¼ cjX Þ, the relative size of the subpopulation of compliers is identiﬁed as
Pðti ¼ cjX i ¼ xÞ ¼ E½Di jX i ¼ x; Z i ¼ 1  E½Di jX i ¼ x; Z i ¼ 0,
and it follows that the average treatment effect in the subpopulation of compliers is
gðxÞ ¼

E½Y i jX i ¼ x; Zi ¼ 1  E½Y i jX i ¼ x; Z i ¼ 0
.
E½Di jX i ¼ x; Zi ¼ 1  E½Di jX i ¼ x; Z i ¼ 0

A.2. Proof of Theorem 2
Semiparametric efﬁciency bounds were introduced by Stein (1956) and developed by
Koshevnik and Levit (1976), Pfanzagl and Wefelmeyer (1982), Begun et al. (1983) and
Bickel et al. (1993). See also the survey of Newey (1990, 1994). The approach followed here
is similar to Hahn (1998).

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

53

The joint density of ðY ; D; Z; X Þ with Z binary can be written as
f ðy; d; z; xÞ ¼ f ðy; djz; xÞf ðzjxÞf ðxÞ ¼ ff 1 ðy; djxÞpðxÞgz ff 0 ðy; djxÞð1  pðxÞÞg1z f ðxÞ,
where f 1 ðy; djxÞ  f ðy; djz ¼ 1; xÞ and pðxÞ ¼ PðZ ¼ 1jX ¼ xÞ.
Consider a regular parametric submodel indexed by y with y0 corresponding to the true
model: f ðy; d; z; xjy0 Þ ¼ f ðy; d; z; xÞ. The density f ðy; d; z; xjyÞ can be written as
f ðy; d; z; xjyÞ ¼ ff 1 ðy; djx; yÞpðx; yÞgz ff 0 ðy; djx; yÞð1  pðx; yÞÞg1z f ðx; yÞ,
where f 1 and f 0 admit an interchange of the order of integration and differentiation
Z
Z
qf 1 ðy; djx; yÞ
q
dy dd ¼
f 1 ðy; djx; yÞ dy dd ¼ 0
qy
qy
and analogously for f 0 . Sufﬁcient conditions for permitting interchanging differentiation
and integration are, for example, given by Theorem 1.3.2 of AmemiyaR (1985). These are
qf 1 ðy; djx; yÞ=qy
is continuous in y 2 Y and y, where Y is an open set; f 1 ðy; djx; yÞ dy dd
R
exists; and jqf 1 ðy; djx; yÞ=qyj dy ddo1 for all y 2 Y.
The corresponding score of f ðy; d; z; xjyÞ is
Sðy; d; z; xjyÞ ¼

q ln f ðy; d; z; xjyÞ
qy

z  pðx; yÞ
 yÞ þ fðx; yÞ,
¼ z  f1 ðy; djx; yÞ þ ð1  zÞ  f0 ðy; djx; yÞ þ
pðx;
1  pðx; yÞ
 yÞ ¼ q ln pðx; yÞ=qy
where f1 ðy; djx; yÞ ¼ q ln f 1 ðy; djx; yÞ=qy, and f0 analogously, and pðx;
and fðx; yÞ ¼ q ln f ðx; yÞ=qy.
At the true value y0 the expectation of the score is zero. The tangent space of the model
is the set of functions that are mean zero and satisfy the additive structure of the score
I ¼ fz  s1 ðy; djxÞ þ ð1  zÞ  s0 ðy; djxÞ þ ðz  pðxÞÞ  sp ðxÞ þ sx ðxÞg

(24)

for any functions s1 ; s0 ; sp ; sx satisfying the mean-zero property:
Z
s1 ðy; djxÞf 1 ðy; djxÞ dy dd ¼ 0 8x,
Z
s0 ðy; djxÞf 0 ðy; djxÞ dy dd ¼ 0 8x,
Z
sx ðxÞf ðxÞ dx ¼ 0,
and sp ðxÞ being a square-integrable measurable function of x.
The semiparametric variance bound of g is the variance of the projection on I of a
function cðY ; D; Z; X Þ (with E½c ¼ 0 and E½kcðÞk2 o1) that satisﬁes for all regular
parametric submodels
qgðF y Þ
¼ E½cðY ; D; Z; X Þ  SðY ; D; Z; X Þjy¼y0 .
qy jy¼y0

(25)

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

54

Write g as
R
ðEy ½Y jX ; Z ¼ 1  Ey ½Y jX ; Z ¼ 0Þ  f ðx; yÞ dx
D
g¼ ¼R
G
ðEy ½DjX ; Z ¼ 1  Ey ½DjX ; Z ¼ 0Þ  f ðx; yÞ dx

RR
R R R
yf 0 ðy; djx; yÞ dy dd  f ðx; yÞ dx
yf 1 ðy; djx; yÞ dy dd 

RR
¼ R R R
df 0 ðy; djx; yÞ dy dd  f ðx; yÞ dx
df 1 ðy; djx; yÞ dy dd 
RRR
RRR
yf ðy; djx; yÞf ðx; yÞ dy dd dx
yf 1 ðy; djx; yÞf ðx; yÞ dy dd dx 
R
R
R
RRR 0
¼
df 1 ðy; djx; yÞf ðx; yÞ dy dd dx 
df 0 ðy; djx; yÞf ðx; yÞ dy dd dx
RR
since E½Y jX ; Z ¼ 1 ¼
yf 1 ðy; djxÞ dy dd.19
Computing the pathwise derivative and evaluating it at y0 gives
qgðF y Þ
ðqD=qyÞG  DðqG=qyÞ
qD=qy
qG=qy
g
¼
¼
qy jy¼y0
G
G jy¼y0
G2
jy¼y0
RRR
RRR
_
_
_
yðf 0 f þ f 0 f_Þ dy dd dx
yðf 1 f þ f 1 f Þ dy dd dx 
¼
G
RRR
RRR
dðf_0 f þ f 0 f_Þ dy dd dx
dðf_1 f þ f 1 f_Þ dy dd dx 
g
G
RRR
RRR
_
_
yff 1  f 0 gf dy dd dx
dff_1  f_0 gf dy dd dx
g
¼
G
G
R
ðm1 ðxÞ  m0 ðxÞ  gm1 ðxÞ þ gm0 ðxÞÞf_ðxÞ dx
þ
G
where f_1 ¼ ðq=qyÞf 1 ðy; djx; yÞjy¼y0 , f_0 ¼ ðq=qyÞf 0 ðy; djx; yÞjy¼y0 and f_ ¼ ðq=qyÞf ðx; yÞjy¼y0 .
Choose cðY ; D; Z; X Þ as
cðy; d; z; xÞ ¼

z y  m1 ðxÞ  gd þ gm1 ðxÞ 1  z gd  gm0 ðxÞ  y þ m0 ðxÞ
þ
G
pðxÞ
G
1  pðxÞ
m1 ðxÞ  m0 ðxÞ  gm1 ðxÞ þ gm0 ðxÞ
.
þ
G

Note that c satisﬁes (25)
qgðF y Þ
¼ E½cðY ; D; Z; X Þ  SðY ; D; Z; X Þjy¼y0
qy jy¼y0
and that c lies in the tangent space (24)20
c 2 I.
19

And analogously for E½DjX ; Z ¼ 1, E½Y jX ; Z ¼ 0 and E½DjX ; Z ¼ 0.
The calculations are available from the author.

20

ð26Þ

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

55

Since c lies in the tangent space, the variance bound is the expected square of c:

" 
 #
1
Y  m1 ðX Þ  gD þ gm1 ðX Þ 2
E½cðY ; D; Z; X Þ  ¼ 2 E Z
pðX Þ
G
"

 #
1
gD  gm0 ðX Þ  Y þ m0 ðX Þ 2
þ 2 E ð1  ZÞ
1  pðX Þ
G


1
Y  m1 ðX Þ  gD þ gm1 ðX Þ
 ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ
þ 2E Z
pðX Þ
G


1
gD  gm0 ðX Þ  Y þ m0 ðX Þ
þ 2 E ð1  ZÞ
 ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ
1  pðX Þ
G
1
þ 2 E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 
G


1
PðZ ¼ 1jX Þ
¼ 2 E E½ðY  m1 ðX Þ  gD þ gm1 ðX ÞÞ2 jX ; Z ¼ 1
G
pðX Þ2


1
PðZ ¼ 0jX Þ
þ 2 E E½ðgD  gm0 ðX Þ  Y þ m0 ðX ÞÞ2 jX ; Z ¼ 0
G
ð1  pðX ÞÞ2
1
þ 2 E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 
G
2

by iterated expectations. Deﬁning s2Y 1 ðxÞ ¼ Var½Y jX ; Z ¼ 1, s2D1 ðxÞ ¼ Var½DjX ; Z ¼ 1
and s2Y 1 D1 ðxÞ ¼ Cov½Y ; DjX ; Z ¼ 1 and analogously s2Y 0 ðxÞ, s2D0 ðxÞ, s2Y 0 D0 ðxÞ for Z ¼ 0,
gives the asymptotic variance bound:
"
#
s2Y 1 ðX Þ  2gs2Y 1 D1 ðX Þ þ g2 s2D1 ðX Þ s2Y 0 ðX Þ  2gs2Y 0 D0 ðX Þ þ g2 s2D0 ðX Þ
þ
E
G2 pðX Þ
G2 ð1  pðX ÞÞ


ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2
þE
.
G2
A.3. Proof of Theorem 3
^ G
^ denote the estimator (8) of the average treatment effect on the compliers (5)
Let g^ ¼ D=
R
ðm1 ðxÞ  m0 ðxÞÞf x ðxÞ dx
D
.
g¼ ¼ R
G
ðm1 ðxÞ  m0 ðxÞÞf x ðxÞ dx
To derive the asymptotic distribution of g^ , note that g^  g can be written as
!
!
^ D
^ G
D
D^  D
G
G^  G
g
 1
.
ð^g  gÞ ¼  ¼
^ G
^
G
G
G
G

(27)

^ in
The derivation proceeds in two steps. First it is shown that the last term ð1  ðG^  GÞ=GÞ
(27) is 1 þ op ð1Þ. Hence the ﬁrst-order behaviour of g^  g is determined by the term ðD^ 
^  GÞ=G in
DÞ=G  gðG
!
^ G


D^  D
G
g
g^  g ¼
(28)
 1 þ op ð1Þ .
G
G
In the second step the asymptotic distribution of this ﬁrst-order term is derived.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

56

^  D is analysed. (The derivations for G
^  G are
In a preliminary step the term D
^  D as
analogous.) Write D
!
X
X
X
X
^D  D ¼ 1
^ 1 ðX i Þ 
^ 0 ðX i Þ  E½m1 ðX Þ  m0 ðX Þ
Yi þ
Yi 
m
m
n i:Z ¼1
i:Z i ¼0
i:Zi ¼0
i:Z i ¼1
i
!
X
1 X
^ 1 ðX i Þ  m1 ðX i ÞÞ
ðY i  m1 ðX i ÞÞ þ
ðm
¼
n i:Z ¼1
i:Zi ¼0
i
!
X
1 X
^ 0 ðX i Þ  m0 ðX i ÞÞ

ðY i  m0 ðX i ÞÞ þ
ðm
n i:Z ¼0
i:Zi ¼1
i
1X
þ
ðm1 ðX i Þ  m0 ðX i ÞÞ  E½m1 ðX Þ  m0 ðX Þ,
n i
^z
and introducing the asymptotic linear representation of the nonparametric estimators m
X
X
1
^ D¼ 1
D
ðY i  m1 ðX i ÞÞ 
ðY i  m0 ðX i ÞÞ
n i:Z ¼1
n i:Z ¼0
i
i
n0 1 X X m
1 X m
þ
x1 ðY j ; X j ; X i Þ þ
½b ðX i Þ þ Rm
1 ðX i Þ
n i:Z ¼0 1
n n0 n1 i:Z ¼0 j:Z ¼1
i

j

i

n1 1
1 X m

xm
½b ðX i Þ þ Rm
0 ðY j ; X j ; X i Þ 
0 ðX i Þ
n i:Z ¼1 0
n n0 n1 i:Z ¼1 j:Z ¼0
X X
i

j

i

1X
þ
ðm1 ðX i Þ  m0 ðX i ÞÞ  E½m1 ðX Þ  m0 ðX Þ.
n i
P
P
The terms ð1=n0 n1 Þ i:Zi ¼0 j:Zj ¼1 xm represent mean-zero two-sample U-statistics, to
which a projection theorem can be applied:
1 X X m
1 X
x1 ðY j ; X j ; X i Þ ¼
E½xm
1 ðY 1 ; X 1 ; X 2 ÞjX 2 ¼ X i 
n0 n1 i:Z ¼0 j:Z ¼1
n0 i:Z ¼0
i

j

i

1 X
ð1=2Þ
þ
E½xm
Þ
1 ðY 1 ; X 1 ; X 2 ÞjY 1 ¼ Y j ; X 1 ¼ X j  þ op ðn
n1 j:Z ¼1
j

1 X
ð1=2Þ
¼
E½xm
Þ,
1 ðY j ; X j ; X ÞjY j ; X j  þ op ðn
n1 j:Z ¼1
j

where the latter equality follows from condition (A) of Theorem 3. Application of the
2
projection theorem requires that E½kxm
1 ðY j ; X j ; X i Þk  ¼ oðnÞ, see Hoeffding (1948), Serﬂing
(1980) or Heckman et al. (1998), which is satisﬁed from condition (B) of Theorem 3.
With this projection theorem it follows that
1 X
1 X
D^  D ¼
ðY i  m1 ðX i ÞÞ 
ðY i  m0 ðX i ÞÞ
n i:Z ¼1
n i:Z ¼0
i
i
n0 X
n1 X
þ
E½xm
E½xm
1 ðY j ; X j ; X ÞjY j ; X j  
0 ðY j ; X j ; X ÞjY j ; X j 
nn1 j:Z ¼1
nn0 j:Z ¼0
j

j

1X
þ
ðm1 ðX i Þ  m0 ðX i ÞÞ  E½m1 ðX Þ  m0 ðX Þ þ op ðn1=2 Þ,
n i

ð29Þ

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

57

wherePit has also been taken
P into account that the average bias and residual terms
ð1=nÞ bm ðX i Þ and ð1=nÞ Rm ðX i Þ are op ðn1=2 Þ by the conditions (C) and (D) of
Theorem 3.
By a weak law of large numbers, sample means converge to their expectations and thus
^  D ¼ op ð1Þ and analogously G^  G ¼ op ð1Þ. Hence
D
!1
^ G
^ G
^ G
G
G
G
¼ Op ð1Þ  op ð1Þ ¼ op ð1Þ,

¼ 1þ
G
G
G^
because ð1 þ op ð1ÞÞ1 ¼ Op ð1Þ (Van der Vaart, 1998, p. 13). This implies (28).
^  DÞ=G  gðG
^  GÞ=GÞ. The approximation to
the leading term in (28) is ððD
pﬃﬃHence
ﬃ
nð^g  gÞ up to ﬁrst order is thus
!
^ D
^ G
pﬃﬃﬃ
pﬃﬃﬃ D
G
g
nð^g  gÞ ¼ n
.
G
G
Inserting the expression (29) and the analogous expression for G^  G gives
pﬃﬃﬃ X
pﬃﬃﬃ
n1
nð^g  gÞ ¼
Xi
G n i
up to ﬁrst order, where
Xi ¼ Z i ðY i  m1 ðX i ÞÞ  ð1  Z i ÞðY i  m0 ðX i ÞÞ þ m1 ðX i Þ  m0 ðX i Þ
n0
n1
ð1  Z i ÞE½xm
þ Zi E½xm
1 ðY i ; X i ; X ÞjY i ; X i  
0 ðY i ; X i ; X ÞjY i ; X i 
n1
n0
 gZ i ðDi  m1 ðX i ÞÞ þ gð1  Z i ÞðDi  m0 ðX i ÞÞ  gðm1 ðX i Þ  m0 ðX i ÞÞ
gn0
gn1
Zi E½xd1 ðY i ; X i ; X ÞjY i ; X i  þ
ð1  Z i ÞE½xd0 ðY i ; X i ; X ÞjY i ; X i 

n1
n0
 E½m1 ðX Þ  m0 ðX Þ þ gE½m1 ðX Þ  m0 ðX Þ.
Note that the last line is zero, because E½m1 ðX Þ  m0 ðX Þ þ gE½m1 ðX Þ  m0 ðX Þ ¼ Dþ
gG ¼ D þ ðD=GÞG ¼ 0. By condition (E) the inﬂuence functions xm and xd have
the form
f xjz¼0 ðX j Þ
þ op ð1Þ
f xjz¼1 ðX j Þ
PðZ ¼ 1Þ 1  pðX j Þ
þ op ð1Þ,
¼ ðY j  m1 ðX j ÞÞ
PðZ ¼ 0Þ pðX j Þ

E½xm
1 ðY j ; X j ; X i ÞjY j ; X j ; Z j ¼ 1; Z i ¼ 0 ¼ ðY j  m1 ðX j ÞÞ

where pðxÞ ¼ PðZ ¼ 1jX ¼ xÞ is the probability that Z takes the value one given
characteristics X. With n0 =n1 ¼ PðZ ¼ 0Þ=PðZ ¼ 1Þ þ op ð1Þ it follows that


1  pðX i Þ
Xi ¼ Zi Y i  m1 ðX i Þ þ ðY i  m1 ðX i ÞÞ
pðX i Þ


pðX i Þ
 ð1  Zi Þ Y i  m0 ðX i Þ þ ðY i  m0 ðX i ÞÞ
1  pðX i Þ


1  pðX i Þ
 gZ i Di  m1 ðX i Þ þ ðDi  m1 ðX i ÞÞ
pðX i Þ

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

58


þ gð1  Z i Þ Di  m0 ðX i Þ þ ðDi  m0 ðX i ÞÞ


pðX i Þ
1  pðX i Þ

þ m1 ðX i Þ  m0 ðX i Þ  gðm1 ðX i Þ  m0 ðX i ÞÞ
plus an op ð1Þ term. Collecting terms gives




ðY i  m1 ðX i ÞÞ  gðDi  m1 ðX i ÞÞ
gðDi  m0 ðX i ÞÞ  ðY i  m0 ðX i ÞÞ
Xi ¼ Z i
þ ð1  Z i Þ
pðX i Þ
1  pðX i Þ
þ m1 ðX i Þ  m0 ðX i Þ  gðm1 ðX i Þ  m0 ðX i ÞÞ.
Computing the variance of Xi gives
VarðXi Þ
"


#
ðY i  m1 ðX i ÞÞ  gðDi  m1 ðX i ÞÞ 2
¼E
pðX i Þ
"

2 #
2 gðDi  m0 ðX i ÞÞ  ðY i  m0 ðX i ÞÞ
þ E ð1  Z i Þ
1  pðX i Þ
Z2i

þ E½ðm1 ðX i Þ  m0 ðX i Þ  gðm1 ðX i Þ  m0 ðX i ÞÞÞ2 
 



ðY i  m1 ðX i ÞÞ  gðDi  m1 ðX i ÞÞ
gðDi  m0 ðX i ÞÞ  ðY i  m0 ðX i ÞÞ
ð1  Zi Þ
þ E Zi
pðX i Þ
1  pðX i Þ
 


ðY i  m1 ðX i ÞÞ  gðDi  m1 ðX i ÞÞ
þ E Zi
ðm1 ðX i Þ  m0 ðX i Þ  gðm1 ðX i Þ  m0 ðX i ÞÞÞ
pðX i Þ




gðDi  m0 ðX i ÞÞ  ðY i  m0 ðX i ÞÞ
ðm1 ðX i Þ  m0 ðX i Þ  gðm1 ðX i Þ  m0 ðX i ÞÞÞ ,
þ E ð1  Z i Þ
1  pðX i Þ

where the fourth term is zero because Zð1  ZÞ ¼ 0 and the ﬁfth and sixth terms are zero
conditional on X and Z. Since Z2 ¼ Z, it follows


½ðY  m1 ðX ÞÞ  gðD  m1 ðX ÞÞ2
VarðXÞ ¼ E Z
pðX Þ2


½gðD  m0 ðX ÞÞ  ðY  m0 ðX ÞÞ2
þ E ð1  ZÞ
ð1  pðX ÞÞ2
þ E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 
 

PðZ ¼ 1jX Þ
jX
¼ E E E½½ðY  m1 ðX ÞÞ  gðD  m1 ðX ÞÞ2 jX ; Z ¼ 1 
pðX Þ2
 

PðZ ¼ 0jX Þ
þ E E E½½gðD  m0 ðX ÞÞ  ðY  m0 ðX ÞÞ2 jX ; Z ¼ 0 
jX
ð1  pðX ÞÞ2
þ E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 
"
#
s2Y 1 ðX Þ  2gs2Y 1 D1 ðX Þ þ g2 s2D1 ðX Þ s2Y 0 ðX Þ  2gs2Y 0 D0 ðX Þ þ g2 s2D0 ðX Þ
þ
¼E
pðX Þ
1  pðX Þ
þ E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

59

by iterated expectations, where s2Y 1 ðxÞ ¼ Var½Y jX ; Z ¼ 1 ¼ E½ðY  m1 ðX ÞÞ2 jX ¼ x; Z ¼ 1,
and s2Y 1 D1 ðxÞ ¼ Cov½Y ; DjX ; Z ¼ 1, and s2D1 ðxÞ, s2Y 0 ðxÞ, s2D0 ðxÞ, s2Y 0 D0 ðxÞ deﬁned
analogously.
Applying the Lindberg–Levy central limit theorem to
pﬃﬃﬃ X
pﬃﬃﬃ
n1
nð^g  gÞ ¼
Xi
G n i
gives that the estimator g^ is root-n asymptotically normal
pﬃﬃﬃ
nð^g  gÞ ! Nð0; VÞ
with asymptotic variance
"
#
s2Y 1 ðX Þ  2gs2Y 1 D1 ðX Þ þ g2 s2D1 ðX Þ s2Y 0 ðX Þ  2gs2Y 0 D0 ðX Þ þ g2 s2D0 ðX Þ
1
þ
V¼ 2E
pðX Þ
1  pðX Þ
G
þ

1
E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 .
G2

A.4. Proof of Theorem 4
Consider the local polynomial regression estimator of order p. By Heckman et al. (1998,
Theorem 3), if p ¼ p̄ and Assumptions 1–3 of (Theorem 4) hold, the local polynomial
^ 1 is asymptotically linear21
regression estimator m
1 X m
m
^ 1 ðxÞ  m1 ðxÞ ¼
x ðY j ; X j ; xÞ þ bm
(30)
m
1 ðxÞ þ R1 ðxÞ,
n1 j:Z ¼1 1
j
pﬃﬃﬃﬃﬃ P
p̄
m
with bm
1 ðxÞ ¼ oðhn1 Þ and ð1= n1 Þ
j:Zj ¼1 R1 ðxÞ ¼ op ð1Þ. Alternatively, if 0ppop̄ and
^ 1 is asymptotically linear with
Assumptions 1–4, 5a and 6 of (Theorem 4) hold, m
p̄
bm
1 ðxÞ ¼ Oðhn1 Þ.
q
q
To specify the inﬂuence function, let xq ¼ x11    xkk =ðq1 !    qk !Þ for a row vector x ¼
ðx1 ; . . . ; xk Þ and a multi-index q ¼ ðq1 ; . . . ; qk Þ of non-negative integers. Deﬁne a row vector
xQðsÞ ¼ ðxq Þq1 þþqk ¼s . This vector of length ðs þ k  1Þ!=s!ðk  1Þ! contains all polynomials
xq of degree s. By Heckman et al. (1998, Theorem 3), the inﬂuence function is for
Nadaraya–Watson regression (p ¼ 0)


Xj  x
m
1
x1 ðY j ; X j ; xÞ ¼ ðY j  m1 ðX j ÞÞ  K0 K
hn 1
and for p40
xm
1 ðY j ; X j ; xÞ

21

K0
¼ ðY j  m1 ðX j ÞÞ  ð1; 0; . . . ; 0Þ

K01

K1

!1

K2
( 


 )0 

X j  x Qð1Þ
X j  x QðpÞ
Xj  x
 1;
;...;
K
,
hn1
hn 1
hn 1

^ 0 ðxÞ, m^ 1 ðxÞ and m^ 0 ðxÞ are analogous.
The derivations for m

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

60

where
K0 ¼ k0;0 ,
K1 ¼ ðk0;1 ; . . . ; k0;p Þ,
0

k1;1
B .
.
K2 ¼ B
@ .
kp;1
and

"
ks;t ¼ E


..
.


Xj  x
hn 1

1
k1;p
.. C
. C
A,
kp;p

QðsÞ0 

Xj  x
hn 1

#
QðtÞ 

Xj  x
Zj ¼ 1
K
hn 1

is a matrix of dimension ðs þ k  1Þ!=s!ðk  1Þ!  ðs þ k  1Þ!=s!ðk  1Þ!.
The following proof is for p40. The derivations for Nadaraya–Watson regression
(p ¼ 0) are analogously. Before analyzing xm
1 further, it is useful to derive some properties
of the matrix ks;t . Let X j;1 to X j;k refer to the k elements of the vector X j . The matrix ks;t
can be written as





Z
Z 
X j  x QðsÞ0 X j  x QðtÞ
Xj  x
ks;t ¼

K
f xjz¼1 ðX j Þ dX j;1    dX j;k
hn 1
hn 1
hn 1
Z
Z
¼ hkn1    uQðsÞ0 uQðtÞ KðuÞf xjz¼1 ðx þ uhn1 Þ du1    duk
with the change in variables u ¼ ðX j  xÞ=hn1 .
Examine ﬁrst the 1  1 matrix k0;0 . By a Taylor series expansion, f xjz¼1 ðx þ uhn1 Þ can be
written as f xjz¼1 ðxÞ þ Oðhn1 Þ which gives:
Z
Z
k
K0 ¼ k0;0 ¼ hn1    KðuÞf xjz¼1 ðx þ uhn1 Þ du1    duk
Z
Z
k
kþ1
¼ hkn1    KðuÞf xjz¼1 ðxÞ du1    duk þ Oðhkþ1
n1 Þ ¼ hn1 f xjz¼1 ðxÞl0 þ Oðhn1 Þ,
ð31Þ
where
l0 ¼

Z

Z


KðuÞ du1    duk .

Now consider the matrix ks;t . Suppose for the moment that the ﬁrst cX1 moments of the
kernel function are zero. If s þ t4c, then
Z
Z
k
ks;t ¼ hn1 f xjz¼1 ðxÞ    uQðsÞ0 uQðtÞ KðuÞ du1    duk þ Oðhkþ1
n1 Þ.
Otherwise, if s þ tpc, the ﬁrst terms of a Taylor series expansion vanish. Supposing that
the ﬁrst c þ 1  s  t derivatives of f xjz¼1 exist, the elements of the matrix ks;t are of the
order Oðhcþ1st
Þ  hkn1 . Taken together, the elements of the matrix ks;t are of the order
n1
Þ  hkn1 .
Oðhmaxðcþ1st;0Þ
n1

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

61

Hence, the largest order of any element of the vector K1 is
K1 ¼ Oðhmaxðcþ1p;0Þ
Þ  hkn1 ,
n1
whereas the largest order of any element of the matrix K2 is
K2 ¼ Oðhmaxðcþ12p;0Þ
Þ  hkn1 .
n1
Hence, as long as cXp, the largest element of the vector K1 is of order hkþ1
n1 or smaller.
In addition, it is of smaller order than the largest element of K2 . This gives the following
important intermediate result:
If cXp

1
then K1 ¼ Oðhkþ1
n1 Þ and K1 K2 ¼ Oðhn1 Þ

(32)

or of even smaller order. By Assumption 5a and b, respectively, of Theorem 4, cXp and
(32) is satisﬁed.
With these preliminaries, the inﬂuence function xm
1 can be examined further. Writing j
for ðY j  m1 ðX j ÞÞ and using partitioned inverses, xm
1 can be written as
xm
1 ðY j ; X j ; xÞ ¼



j
 1; K1 K1
2
1
0
K0  K1 K2 K1
( 


 )0 

X j  x Qð1Þ
X j  x QðpÞ
Xj  x
;...;
K
 1;
.
hn1
hn 1
hn 1

0
1
Inserting the expression (31) for K0 and noting from (32) that K1 K1
2 K1 and K1 K2
are of lower order, it follows:

xm
1 ðY j ; X j ; xÞ ¼

j
hkn1 f xjz¼1 ðxÞl0 þ Oðhkþ1
n1 Þ
(


 )!


X j  x Qð1Þ
X j  x QðpÞ
Xj  x
 1 þ Oðhn1 Þ
;...;
,
i K
hn1
hn 1
hn 1

where i is a column vector of ones.
For this expression, the condition (iv) of Theorem 3 needs to be veriﬁed. The conditions
(A), (C) and (D) follow directly from Heckman et al. (1998, Theorem 3). It remains to
verify conditions (B) and (E). Verify ﬁrst condition (E):
E xm
1 ðY j ; X j ; X i ÞjY j ; X j ; Z j ¼ 1; Z i ¼ 0
Z
Z
¼    xm
1 ðY j ; X j ; X i Þf xjz¼0 ðX i Þ dX i;1    dX i;k


Z
Z
j
Xj  Xi
¼ 
K
hn 1
hkn1 f xjz¼1 ðX i Þl0 þ Op ðhkþ1
n1 Þ
(
Qð1Þ

 )!
Xj  Xi
X j  X i QðpÞ
i f xjz¼0 ðX i Þ dX i;1    dX i;k .
 1 þ Op ðhn1 Þ
;...;
hn1
hn1

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

62

With the change in variables u ¼ ðX i  X j Þ=hn1 and a Taylor series expansion f xjz¼0 ðX j þ
uhn1 Þ ¼ f xjz¼0 ðX j Þ þ Op ðhn1 Þ and analogously for f xjz¼1 , it follows:
Z
Z
f xjz¼0 ðX j þ uhn1 Þ
¼ j   
f xjz¼1 ðX j þ uhn1 Þl0 þ Op ðhn1 Þ


 1 þ Op ðhn1 Þ ðuÞQð1Þ ; . . . ; ðuÞQðpÞ i  KðuÞ du1    duk
Z
Z
f xjz¼0 ðX j Þ þ Op ðhn1 Þ
    ð1 þ Op ðhn1 Þ
¼ j
f xjz¼1 ðX j Þl0 þ Op ðhn1 Þ
fðuÞQð1Þ ; . . . ; ðuÞQðpÞ giÞ  KðuÞ du1    duk

Z
Z
f xjz¼0 ðX j Þ þ Op ðhn1 Þ
l0 þ Op ðhn1 Þ   
¼ j
f xjz¼1 ðX j Þl0 þ Op ðhn1 Þ

fðuÞQð1Þ ; . . . ; ðuÞQðpÞ gi  KðuÞ du1    duk
f xjz¼0 ðX j Þ þ Op ðhn1 Þ
fl0 þ Op ðhn1 Þg
f xjz¼1 ðX j Þl0 þ Op ðhn1 Þ
f xjz¼0 ðX j Þ
þ Op ðhn1 Þ.
¼ ðY j  m1 ðX j ÞÞ
f xjz¼1 ðX j Þ

¼ j

Condition (B) is a rather weak condition and can be veriﬁed using a similar argument.
2
E½xm
1 ðY j ; X j ; X i Þ jZ j ¼ 1; Z i ¼ 0


Z
Z
s2Y 1 ðX j Þ
Xj  Xi 2
¼ 
K
2
2
2kþ1
hn 1
h2k
Þ
n1 f xjz¼1 ðX i Þl0 þ Op ðhn1
(


 ) !2
X j  X i Qð1Þ
X j  X i QðpÞ
 1 þ Op ðhn1 Þ
;...;
i
hn 1
hn 1

f xjz¼0 ðX i Þ dX i;1    dX i;k .
With the change in variables u ¼ ðX i  X j Þ=hn1 and a Taylor series expansion f xjz¼0 ðX j þ
uhn1 Þ ¼ f xjz¼0 ðX j Þ þ Op ðhn1 Þ and analogously for f xjz¼1 it follows:
Z
Z
s2 ðX j Þ
f xjz¼0 ðX j þ uhn1 ÞKðuÞ2

¼ Yk1 2
f 2xjz¼1 ðX j Þ þ Op ðhn1 Þ
hn 1 l0
ð1 þ Op ðhn1 ÞfðuÞQð1Þ ; . . . ; ðuÞQðpÞ giÞ2 du1    duk
Z
Z
s2 ðX j Þf xjz¼0 ðX j Þ
   KðuÞ2 du1    duk þ Op ðhn1 Þ ¼ Op ð1Þ.
¼ Yk1 2 2
hn1 l0 f xjz¼1 ðX j Þ

A.5. Proof of Theorem 5
The proof is based on Theorem 6.1 of Newey (1994) and on Newey (1995).
To apply Newey’s theorem it is useful to express the conditional LATE estimator using
Newey’s notation. The conditional LATE estimator can be written as an m-estimator

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

63

which solves
1X
^ 1 ðX i Þ  m
^ 0 ðX i Þ  g^ m^ 1 ðX i Þ þ g^ m^ 0 ðX i Þg ¼ 0
fm
n
based on the moment condition:
E½E½Y jX ; Z ¼ 1  E½Y jX ; Z ¼ 0  gE½DjX ; Z ¼ 1 þ gE½DjX ; Z ¼ 0 ¼ 0.
Since E½YZjX  ¼ E½Y jX ; Z ¼ 1  E½ZjX  for Z binary, the moment condition can also be
expressed as


E½YZjX  E½Y ð1  ZÞjX 
E½DZjX 
E½Dð1  ZÞjX 

g
þg
E
¼ 0.
E½ZjX 
E½1  ZjX 
E½ZjX 
E½1  ZjX 
To use Newey’s notation, write this moment condition as
E½mðX i ; g; hÞ ¼ 0,
where the moment function m is
mðxi ; g; hÞ ¼

h1 ðxi Þ
h2 ðxi Þ
h3 ðxi Þ
h4 ðxi Þ

g
þg
h5 ðxi Þ 1  h5 ðxi Þ
h5 ðxi Þ
1  h5 ðxi Þ

(33)

with hðxÞ ¼ ðh1 ðxÞ; . . . ; h5 ðxÞÞ0 and the true conditional expectation functions:
h1 ðxÞ ¼ E½YZjX ¼ x,
h2 ðxÞ ¼ E½Y ð1  ZÞjX ¼ x,
h3 ðxÞ ¼ E½DZjX ¼ x,
h4 ðxÞ ¼ E½Dð1  ZÞjX ¼ x,
h5 ðxÞ ¼ E½ZjX ¼ x.
In the following, h ¼ hðxÞ refers to the vector of true conditional expectation functions,
~
whereas h~ ¼ hðxÞ
refers to any other function from an appropriate space that includes h.
Deﬁne the residuals u1 ¼ YZ  E½YZjX  and u2 ¼ Y ð1  ZÞ  E½Y ð1  ZÞjX  and u3 ¼
DZ  E½DZjX  and u4 ¼ Dð1  ZÞ  E½Dð1  ZÞjX  and u5 ¼ Z  E½ZjX . Let u ¼
ðu1 ; . . . ; u5 Þ0 be the vector of residuals.
^ ¼ Z^ 0 pK ðxÞ be a series estimator of hðxÞ, where Z^ is a K  5 matrix of coefﬁcients.
Let hðxÞ
Z^ is computed as


Z^ ¼ pK0 pK pK0 Y,
where Y is the n  5 data matrix with the ith row being
ðY i Z i ; Y i ð1  Zi Þ; Di Z i ; Di ð1  Z i Þ; Z i Þ.
In the following conditions, j:j refers to the Euclidean norm and j:jd refers to the
supremum Sobolev norm. The Sobolev norm for a vector of functions BðxÞ is deﬁned as
jBjd ¼ max

sup

jqjpd x2SuppðX Þ

jqq BðxÞj

with jBjd equal to inﬁnity if qq BðxÞ does not exist for some jqjpd. Here, q ¼ ðq1 ; . . . ; qk Þ0 is a
q
q
vector of non-negative integers and qq BðxÞ ¼ qjqj BðxÞ=qx11    qxkk is the partial derivative.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

64

Deﬁne the magnitude of the basis functions pK ðxÞ by
zd ðKÞ ¼

sup

jqq pK ðxÞj.

jqj¼d;x2SuppðX Þ

To apply the Theorem 6.1 of Newey (1994), the following conditions, corresponding to
his Assumptions 5.4–5.6 and 6.1–6.6, need to be satisﬁed. In the conditions, g and h always
refer to the true value of LATE and the true conditional expectation functions, whereas g~
and h~ stand for any arbitrary values and functions from an appropriate set, respectively.
~
Condition 1. There are , bðxÞ, bðxÞ40
and a compact subset B of R with g 2 B such that
for all g~ 2 B:
(i) mðx; g~ ; hÞ is continuous at g~ with probability one;
(ii) jmðx; g~ ; hÞjd pbðxÞ;

~  mðx; g~ ; hÞjd pbðxÞð
~
(iii) jmðx; g~ ; hÞ
h~  hjd .
Condition 2. E½mðx; g~ ; hÞ ¼ 0 has a unique solution on B at g.
Condition 3. (i) The solution g is an interior point of B.
~ is
(ii) There is a neighbourhood of g such that for all jh~  hjd o the functional mðx; g~ ; hÞ
differentiable in g~ on this neighbourhood,
(iii) E½qmðx; g~ ; hÞ=q~gj~g¼g a0,
~ replaced by qmðx; g~ ; hÞ=q~
~ g,
(iv) Condition 1 is also satisﬁed for mðx; g~ ; hÞ
2
(v) E½jmðx; g; hÞjd o1.
Condition 4. E½juj2 jX  is bounded, where u ¼ ðu1 ; . . . ; u5 Þ0 .
Condition 5. (i) The smallest eigenvalue of E½pK ðX ÞpK ðX Þ0  is bounded away from zero
uniformly in K,
(ii) pK ðxÞ is a subvector of pKþ1 ðxÞ for all K,
(iii) For each K there exists a nonzero Z̄ such that Z̄0 pK ðxÞ is a nonzero constant on the
support of X.
Condition 6. For a nonnegative integer d, if jhjd is ﬁnite then there are constants C, ad 40
such that for all K there is Z with jhðxÞ  Z0 pK ðxÞjd pCK ad .
~ that is linear in h~ such that for all h~ with jh~  hjd
Condition 7. (i) There is a function Dðx; hÞ
~
small enough, jmðx; g; hÞ  mðx; g; hÞ  Dðx; h~  hÞjd pbðxÞjh~  hj2d .
qﬃﬃﬃ
pﬃﬃﬃ
(ii) E½bðX Þzd ðKÞð Kn þ K a Þ!0 and E½bðX Þ nzd ðKÞ2 ðK=n þ K 2a Þ!0.
Condition 8. There is bðxÞ and d40 with E½bðX Þ2 o1 such that
(i)
(ii)
(iii)

~
~ d,
jDðx; hÞjpbðxÞj
hj
2a
KP !0,
pﬃﬃﬃﬃﬃﬃﬃﬃﬃ
2 1=2
ð K
ð K=n þ K a Þ!0.
l¼1 jplK jd Þ

Condition 9. There is dðxÞ such that for all h~
~
~ ¼ E½dðxÞ0 h
(i) E½Dðx; hÞ
(ii) For each K there are K  5 matrices ZK and nK such that n  E½jdðX Þ  n0K pK ðX Þ j2 

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

65

E½jhðX Þ  Z0K pK ðX Þj2 !0 and Kðz0 ðKÞ4 =nÞ!0 and z0 ðKÞ2 E½jhðX Þ  Z0K pK ðX Þj2 !0
and E½jdðX Þ  n0K pK ðX Þj2 !0.
Conditions 1–3 correspond to Assumption 5.4–5.6 of Newey (1994). The Conditions 4–9
correspond to Assumptions 6.1–6.6 of Newey (1994), with the exception of Condition 7(i),
which corresponds to his Assumption 5.1(i). (This is a weaker version of his Assumption
6.4(i), which he invokes to show consistency of the asymptotic
variance estimator.)
pﬃﬃﬃ
d
By Theorem 6.1 of Newey (1994), it follows that nð^g  gÞ ! Nð0; V Þ with
1
E½fmðX i ; g; hÞ þ dðX i Þ0 ui g2 ,
G2
where u are the residuals deﬁned above and dðxÞ is
1
0
1
C
B
h5 ðxÞ
C
B
C
B
1
C
B

C
B
1  h5 ðxÞ
C
B
C
B
g
C
B

C.
dðxÞ ¼ B
C
B
h5 ðxÞ
C
B
g
C
B
C
B
C
B
1

h
ðxÞ
5
C
B
C
B h1 ðxÞ
h
ðxÞ
h
ðxÞ
h
ðxÞ
2
3
4
A
@

þg 2 þg
2
2
2
h5 ðxÞ ð1  h5 ðxÞÞ
h5 ðxÞ
ð1  h5 ðxÞÞ
V¼

(34)

(35)

It is shown below that the above assumptions are satisﬁed for this dðxÞ.
With this expression dðxÞ, the asymptotic variance (34) can be calculated. Inserting (33)
and the deﬁnition of the residuals u gives
mðX ; g; hÞ þ dðX Þ0 u


Z
h1 ðX Þ
gh3 ðX Þ
Y
 gD þ
¼
h5 ðX Þ
h5 ðX Þ
h5 ðX Þ


1Z
gh4 ðX Þ
h2 ðX Þ
gD 
Y þ
þ
1  h5 ðX Þ
1  h5 ðX Þ
1  h5 ðX Þ
h1 ðX Þ
h2 ðX Þ
gh3 ðX Þ
gh4 ðX Þ


þ
.
þ
h5 ðX Þ 1  h5 ðX Þ h5 ðX Þ 1  h5 ðX Þ
The asymptotic variance (34) is
1
E½fmðX i ; g; hÞ þ dðX i Þ0 ui g2 
G2
"

 #
1
Z2
h1 ðX Þ
gh3 ðX Þ 2
Y
 gD þ
¼ 2E 2
h5 ðX Þ
h5 ðX Þ
G
h5 ðX Þ
"

2 #
1
ð1  ZÞ2
gh4 ðX Þ
h2 ðX Þ
þ 2E
Y þ
gD 
1  h5 ðX Þ
1  h5 ðX Þ
G
ð1  h5 ðX ÞÞ2
"
 #
1
h1 ðX Þ
h2 ðX Þ
gh3 ðX Þ
gh4 ðX Þ 2
þ 2E


þ
h5 ðX Þ 1  h5 ðX Þ h5 ðX Þ 1  h5 ðX Þ
G

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

66

"
"
##

1
PðZ ¼ 1jX Þ
h1 ðX Þ
gh3 ðX Þ 2
X; Z ¼ 1
E Y
 gD þ
¼ 2E
h5 ðX Þ
h5 ðX Þ
G
h25 ðX Þ
"
"
##
2
1
PðZ ¼ 0jX Þ
gh4 ðX Þ
h2 ðX Þ
þ 2E
Y þ
X; Z ¼ 0
E gD 
1  h5 ðX Þ
1  h5 ðX Þ
G
ð1  h5 ðX ÞÞ2
"
 #
1
h1 ðX Þ
h2 ðX Þ
gh3 ðX Þ
gh4 ðX Þ 2
þ 2E


þ
h5 ðX Þ 1  h5 ðX Þ h5 ðX Þ 1  h5 ðX Þ
G
"
#
"
#
s2Y 0  2gs2Y 0 D0 þ g2 s2D0
s2Y 1  2gs2Y 1 D1 þ g2 s2D1
1
1
¼ 2E
þ 2E
h5 ðX Þ
1  h5 ðX Þ
G
G
"
 #
1
h1 ðX Þ
h2 ðX Þ
gh3 ðX Þ
gh4 ðX Þ 2


þ
þ 2E
,
h5 ðX Þ 1  h5 ðX Þ h5 ðX Þ 1  h5 ðX Þ
G
which, when returning to the notation of Section 3, corresponds to the expression (9).
It remains to verify the above conditions. Condition 1 is veriﬁed for d ¼ 0. Condition
1(i) is satisﬁed since mðx; g~ ; hÞ is linear in g~ . Condition 1(ii) is satisﬁed for bðxÞ a sufﬁciently
large constant because h1 =h5 , h2 =ð1  h5 Þ, h3 =h5 , h4 =ð1  h5 Þ are bounded by Assumption
(iii) and because B is bounded.
For condition 1(iii) and  ¼ 1
~  mðx; g~ ; hÞj0
jmðx; g~ ; hÞ



h~1
h~2
h~3
h~4
h1
h2
h3
h4
¼

 g~ þ g~


 g~ þ g~
h5 1  h5
h5
1  h5
h~5 1  h~5
h~5
1  h~5

0

p h~  h 0  b~
with
h5  h1 þ g~ h3  g~ h5
h2 þ ð1  h5 Þ  g~ h4  g~ ð1  h5 Þ
þ
,
b~ ¼
~
h5 h5
ð1  h5 Þð1  h~5 Þ
0
0
where b~ is a ﬁnite constant because h5 is bounded away from zero.
Condition 2 is satisﬁed by assumption. Condition 3(i) is satisﬁed by an appropriate
choice of B. Condition 3(ii) is trivially satisﬁed since m is linear in g~ . The
~ g is h~4 =ð1  h~5 Þ  h~3 =h~5 . For condition 3(iii) note that its expected
derivative qmðx; g~ ; hÞ=q~
value E½qmðx; g~ ; hÞ=q~gj~g¼g at the true g and the true h is G, which is nonzero by
the assumption that LATE is identiﬁed. The veriﬁcation of condition 3(iv) is analogous
to condition 1. Condition 3(v) is satisﬁed by mðx; g; hÞbeing bounded on the support
of X.
Condition 4 is satisﬁed by Assumption (iv).
Condition 5 is satisﬁed for power series by Assumptions (vi) and (vii) and by Lemma
A.15 of Newey (1995), which further implies zd ðKÞpCK 1þ2d and jpkK jd pCK 1=2þ2d .
Condition 6 is satisﬁed for power series for d ¼ 0 and a ¼ s=k by e.g. Lemma A.12 of
Newey (1995).

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

67

Condition 7 is veriﬁed for d ¼ 0. Begin with condition 7(i) and let
~
~
~
~
~ ¼ h1 ðxÞ  h2 ðxÞ  g h3 ðxÞ þ g h4 ðxÞ
Dðx; hÞ
h5 ðxÞ 1  h5 ðxÞ
h5 ðxÞ
1  h5 ðxÞ
h1 ðxÞ
h2 ðxÞ
h3 ðxÞ
h4 ðxÞ
 h~5 ðxÞ 2 þ
g 2 g
h5 ðxÞ ð1  h5 ðxÞÞ2
h5 ðxÞ
ð1  h5 ðxÞÞ2

!

~ in condition 7(i) gives after some calculations
be the functional derivative. Inserting Dðx; hÞ
~  mðx; g; hÞ  Dðx; h~  hÞ
mðx; g; hÞ
(
)
gh~3 ðxÞ  h~1 ðxÞ
gh~4 ðxÞ  h~2 ðxÞ
~
¼ ðh5 ðxÞ  h5 ðxÞÞ
þ
h~5 ðxÞh5 ðxÞ
ð1  h5 ðxÞÞð1  h~5 ðxÞÞ
h1 ðxÞ
h2 ðxÞ
h3 ðxÞ
h4 ðxÞ
þ ðh~5 ðxÞ  h5 ðxÞÞ 2 þ
g 2 g
h5 ðxÞ ð1  h5 ðxÞÞ2
h5 ðxÞ
ð1  h5 ðxÞÞ2
¼

!

h1  gh3 ~
g ~
1 ~
ðh5  h5 Þ2 þ
ðh5  h5 Þðh~3  h3 Þ 
ðh5  h5 Þðh~1  h1 Þ
2
~
~
~
h5 h
h5 h5
h5 h5
5

ðgh4  h2 Þðh~5  h5 Þ2
ðh~5  h5 Þðh~4  h4 Þ ðh~5  h5 Þðh~2  h2 Þ
þ
þ
g

,
ð1  h~5 Þð1  h5 Þ
ð1  h~5 Þð1  h5 Þ
ð1  h~5 Þð1  h5 Þ2
where in the last equation the dependence of h and of h~ on x is suppressed. This gives
~  mðx; g; hÞ  Dðx; h~  hÞj0
jmðx; g; hÞ
p

h1  gh3
g
jðh~5  h5 Þ2 j0 þ
jðh~5  h5 Þðh~3  h3 Þj0
2
~
~
h5 h5 0
h5 h5 0
1
gh4  h2
jðh~5  h5 Þðh~1  h1 Þj0 þ
jðh~5  h5 Þ2 j0
~
ð1  h~5 Þð1  h5 Þ2 0
h5 h5 0
1
þ
fjgjjðh~5  h5 Þðh~4  h4 Þj0 þ jðh~5  h5 Þðh~2  h2 Þj0 g
~
ð1  h5 Þð1  h5 Þ
þ

0

~  hðxÞj2 ,
pb  jhðxÞ
0
where
b ¼ jðh1  gh3 Þ=h~5 h25 j0 þ jðgh4  h2 Þ=ð1  h~5 Þð1  h5 Þ2 j0 þ ð1 þ jgjÞðj1=h~5 h5 j0 þ j1=
ð1  h~5 Þð1  h5 Þj0 Þ is a positive non-inﬁnite constant b is non-inﬁnite, because by
Assumption (iii) the functions h1 =h5 , h2 =ð1  h5 Þ, h3 =h5 and h4 =ð1  h5 Þ are bounded on
the support of X and h5 is bounded away from 0 and 1. For h~ sufﬁciently close to h, also h~5
will be bounded away from 0 and 1, which bounds the expressions j1=h~5 h5 j0 and
j1=ð1  h~5 Þð1  h5 Þj0 .
To verify Condition 7(ii) for d ¼ 0, note that bðxÞ is a positive non-inﬁnite constant and
that a ¼ s=k and z0 ðKÞpCK. Hence,
0sﬃﬃﬃﬃﬃﬃ1
!
rﬃﬃﬃﬃ
K
K 3A
þ OðK 1s=k Þ
E½bðX Þz0 ðKÞ
þ K a ¼ O@
n
n

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

68

and
0sﬃﬃﬃﬃﬃﬃ1


pﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
pﬃﬃﬃ
K
K 6A
þ K 2a ¼ O@
þO
nK 4ð1s=kÞ .
E½bðX Þ nz0 ðKÞ2
n
n
All terms have to be of order oð1Þ. This requires that K increases at a smaller rate than n1=6 ,
that s4k and that K increases at a larger rate than n0:25=ðs=k1Þ . This is implied by
Assumptions (v) and (viii) of Theorem 5.
~ with Dðx; hÞ
~ given above
Condition 8 is veriﬁed for d ¼ 1. Examine ﬁrst jDðx; hÞj
~
~ 0 bðxÞpjhðxÞj
~ 1 bðxÞ,
jDðx; hÞjpj
hðxÞj
where
bðxÞ ¼

1þg
1þg
h1 ðxÞ
h2 ðxÞ
h3 ðxÞ
h4 ðxÞ
.
þ
þ
þ
g 2 g
h5 ðxÞ 1  h5 ðxÞ h25 ðxÞ ð1  h5 ðxÞÞ2
h5 ðxÞ
ð1  h5 ðxÞÞ2

Because h1 =h5 , h2 =ð1  h5 Þ, h3 =h5 , h4 =ð1  h5 Þ are assumed to be bounded, E½bðX Þ2 o1.
Condition 8(ii) is satisﬁed if s=k40. For Condition 8(iii) note that jpkK jd pCK 1=2þ2d .
Hence,
!1=2
!1=2
K
K
X
X
jplK j2d
pC
K 1þ4d
pCðK 2þ4d Þ1=2 ¼ CK 1þ2d .
l¼1

l¼1

This gives
K
X
l¼1

sﬃﬃﬃﬃﬃﬃ
!1=2 rﬃﬃﬃﬃ
K
K7
!0
jplK j21
pC
n
n

if K increases slower than n1=7 , and
!1=2
K
X
2
jplK j1
K s=k pCK 3s=k !0
l¼1

if s=k43.
Condition 9(i) is satisﬁed with dðxÞ given by (35). For Condition 9(ii) note that by
condition 6
jhðxÞ  Z0K pK ðxÞj0 pCK s=k .
Since dðxÞ is continuously differentiable of the same order as hðxÞ, it follows by
Lemma A.12 of Newey (1995) that
jdðxÞ  n0K pK ðxÞj0 pCK s=k .
Because jj0 is the supremum norm, it follows that
n  E½jdðX Þ  n0K pK ðX Þj2 E½jhðX Þ  Z0K pK ðX Þj2 
pn  ðjdðX Þ  n0K pK ðX Þj0 Þ2 ðjhðX Þ  Z0K pK ðX Þj0 Þ2
¼ OðnK 4s=k Þ.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

69

For this term to vanish requires K to increase at a rate faster than n1=4s=k , which is implied
by the rate conditions.
Second, for the term
 5
z ðKÞ4
K
¼O
K 0
n
n
to vanish requires K to increase slower than n1=5 , which is implied.
Third,
z0 ðKÞ2 E½jhðX Þ  Z0K pK ðX Þj2 
pz0 ðKÞ2 ðjhðX Þ  Z0K pK ðX Þj0 Þ2
¼ OðK 2 K 2s=k Þ ¼ OðK 2ð1s=kÞ Þ!0
if s=k41.
Finally,
E½jdðX Þ  n0K pK ðX Þj2 
pðjdðX Þ  n0K pK ðX Þj0 Þ2 ¼ OðK 2s=k Þ!0
if s=k40.
The necessary conditions on the rate of K were that s=k43 and that K ¼ nv with
1=4ðs=k  1Þovo 17.
A.6. Proof of Theorem 6
With knowledge of the propensity score, the parametric submodel becomes
f ðy; d; z; xjyÞ ¼ ff 1 ðy; djx; yÞpðxÞgz ff 0 ðy; djx; yÞð1  pðxÞÞg1z f ðx; yÞ,
with the corresponding score
Sðy; d; z; xjyÞ ¼

q ln f ðy; d; z; xjyÞ
¼ z  f1 ðy; djx; yÞ þ ð1  zÞ  f0 ðy; djx; yÞ þ fðx; yÞ
qy

and tangent space
I ¼ fz  s1 ðy; djxÞ þ ð1  zÞ  s0 ðy; djxÞ þ sx ðxÞg.
Note that the pathwise derivative qgðF y Þ=qyjy¼y0 is the same as in Theorem 2. Choose
cðY ; D; Z; X Þ as in (26). After some tedious calculations, it can be veriﬁed ﬁrst that
qgðF y Þ
¼ E½cðY ; D; Z; X Þ  SðY ; D; Z; X Þjy¼y0
qy jy¼y0
and second that c lies in the tangent space of the model
c 2 I.
Since c lies in the tangent space, the variance bound is the expected square of c. Because c
is the same as in Theorem 2, the asymptotic variance bound is V.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

70

A.7. Proof of Theorem 7
Rewrite the expressions s2pY 1 ðpÞ and s2pY 1 D1 ðpÞ as
s2pY 1 ðrÞ ¼ E½ðY  mp1 ðrÞÞ2 jpðX Þ ¼ r; Z ¼ 1
¼ E½E½ðY  mp1 ðrÞ  m1 ðX Þ þ m1 ðX ÞÞ2 jX ; Z ¼ 1jpðX Þ ¼ r; Z ¼ 1
¼ E½E½ðY  m1 ðX ÞÞ2 jX ; Z ¼ 1jpðX Þ ¼ r; Z ¼ 1
þ E½E½ðm1 ðX Þ  mp1 ðrÞÞ2 jX ; Z ¼ 1jpðX Þ ¼ r; Z ¼ 1
þ E½E½ððY  m1 ðX ÞÞðm1 ðX Þ  mp1 ðrÞÞÞjX ; Z ¼ 1jpðX Þ ¼ r; Z ¼ 1
Z
¼ fs2Y 1 ðxÞ þ ðm1 ðxÞ  mp1 ðrÞÞ2 gf xjp;z ðxjr; 1Þ dx
¼ E½s2Y 1 ðX Þ þ ðm1 ðX Þ  mp1 ðrÞÞ2 jpðX Þ ¼ r
¼ E½s2Y 1 ðX ÞjpðX Þ ¼ r þ Var½m1 ðX ÞjpðX Þ ¼ r
because
f xjp;z ðxjr; 1Þ ¼

PðZ ¼ 1jp ¼ r; X ¼ xÞf xjp ðxjrÞ
¼ f xjp ðxjrÞ.
PðZ ¼ 1jp ¼ rÞ

Similarly,
s2pY 1 D1 ðrÞ ¼ E½ðY  mp1 ðrÞÞðD  mp1 ðrÞÞjpðX Þ ¼ r; Z ¼ 1
¼ E½E½ðY  m1 ðX Þ þ m1 ðX Þ  mp1 ðrÞÞ
ðD  m1 ðX Þ þ m1 ðX Þ  mp1 ðrÞÞjX ; Z ¼ 1jpðX Þ ¼ r; Z ¼ 1
¼ E½s2Y 1 D1 ðX Þ þ ðm1 ðX Þ  mp1 ðrÞÞðm1 ðX Þ  mp1 ðrÞÞjpðX Þ ¼ r; Z ¼ 1
¼ E½s2Y 1 D1 ðX ÞjpðX Þ ¼ r þ Covðm1 ðX Þ; m1 ðX ÞjpðX Þ ¼ rÞ.
Furthermore with
Varðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞjpÞ
¼ E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 jp  ðmp1 ðpÞ  mp0 ðpÞ  gmp1 ðpÞ
þ gmp0 ðpÞÞ2
it follows that
E½ðmp1 ðpÞ  mp0 ðpÞ  gmp1 ðpÞ þ gmp0 ðpÞÞ2 
¼ E½ðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞÞ2 
 E½Varðm1 ðX Þ  m0 ðX Þ  gm1 ðX Þ þ gm0 ðX ÞjpÞ.
By inserting these expressions in (15), the difference in the variance of propensity score
matching and the variance of matching on X can be written after some calculations as


1
1p
p
V 1 ðpÞ þ
V 0 ðpÞ þ 2CðpÞ ,
V pm  V ¼ 2 E
p
1p
G
where V 1 ðpÞ ¼ Varðm1 ðX Þ  gm1 ðX ÞjpÞ and V 0 ðpÞ ¼ Varðm0 ðX Þ  gm0 ðX ÞjpÞ and CðpÞ ¼
Covððm1 ðX Þ  gm1 ðX ÞÞ; ðm0 ðX Þ  gm0 ðX ÞÞjpÞ. The two variance terms are necessarily
non-negative, but the covariance term could be negative. It is to be shown that the

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

71

whole expression V pm  V is non-negative.
Note that
ﬃ the covariance is bounded
pﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
in absolute value by the variances: jCðpÞjp V 1 ðpÞV 0 ðpÞ. This gives a lower bound on
V pm  V


pﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1
1p
p
V 1 ðpÞ þ
V 0 ðpÞ  2 V 1 ðpÞV 0 ðpÞ
V pm  VX 2 E
p
1p
G
i
pﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
pﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
1 h
¼ 2 E V 0 ðpÞð V 1 ðpÞ=V 0 ðpÞ  pð1 þ V 1 ðpÞ=V 0 ðpÞÞÞ2 =pð1  pÞ .
G
Since all terms are non-negative it follows that V pm  VX0. Generally, V pm  V is
strictly positive unless the support ofppðxÞ
contains only values
where the variances V 1 ðpÞ
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
pﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
and V 0 ðpÞ are both zero or where V 1 ðpÞ=V 0 ðpÞ  pð1 þ V 1 ðpÞ=V 0 ðpÞÞ ¼ 0 holds. In
this special case, V pm ¼ V.
A.8. Proof of Theorem 8
The proof of Theorem 8 is illustrated for Z being discrete and taking values Z 2 f0; 1; 2g.
The extension to discrete Z with more than three distinct values in its support is obvious.
An extension to continuous Z is also straightforward and similar to the derivations in
Heckman and Vytlacil (2001). First, it is shown that the average treatment effect for the
compliers with characteristics X can be expressed as
E½Y 1  Y 0 jX ; t ¼ c ¼

E½Y jX ; Z ¼ zmax   E½Y jX ; Z ¼ zmin 
.
Pðt ¼ cjX Þ

(36)

With Z taking values in f0; 1; 2g and by monotonicity (Assumption 10 ), the
subpopulation of compliers consists of two groups: those who switch D when Z is
increased from 0 to 1 (i.e. Di;0 oDi;1 ¼ Di;2 ) and those who switch D when Z is increased
from 1 to 2 (i.e. Di;0 ¼ Di;1 oDi;2 ). By monotonicity each individual switches at most once,
and therefore these two subpopulations are a partition of the complier subpopulation. The
treatment effect for compliers with characteristics X is
E½Y 1  Y 0 jX ; t ¼ c ¼ E½Y 1  Y 0 jX ; D0 oD1   PðD0 oD1 jX ; t ¼ cÞ
þ E½Y 1  Y 0 jX ; D1 oD2   PðD1 oD2 jX ; t ¼ cÞ.
0

0

ð37Þ

0

By Assumptions 1 , 3 and 4 and derivations similar to those used in Theorem 1, the
treatment effect in the ﬁrst subpopulation is identiﬁed as
E½Y 1  Y 0 jX ; D0 oD1  ¼

E½Y jX ; Z ¼ 1  E½Y jX ; Z ¼ 0
PðD0 oD1 jX Þ

(38)

if PðD0 oD1 jX Þ40. The treatment effect in the second subpopulation is
E½Y 1  Y 0 jX ; D1 oD2  ¼

E½Y jX ; Z ¼ 2  E½Y jX ; Z ¼ 1
,
PðD1 oD2 jX Þ

if PðD1 oD2 jX Þ40. Note furthermore that
PðD0 oD1 jX ; D0 oD2 Þ ¼

PðD0 oD1 jX Þ
PðD0 oD2 jX Þ

(39)

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

72

and analogously
PðD1 oD2 jX ; D0 oD2 Þ ¼

PðD1 oD2 jX Þ
,
PðD0 oD2 jX Þ

provided PðD0 oD2 jX Þ40.
Inserting these two expressions in (37) yields
E½Y jX ; Z ¼ 1  E½Y jX ; Z ¼ 0
PðD0 oD2 jX Þ
E½Y jX ; Z ¼ 2  E½Y jX ; Z ¼ 1
þ
PðD0 oD2 jX Þ
E½Y jX ; Z ¼ 2  E½Y jX ; Z ¼ 0
¼
PðD0 oD2 jX Þ
E½Y jX ; Z ¼ zmax   E½Y jX ; Z ¼ zmin 
,
¼
Pðt ¼ cjX Þ

E½Y 1  Y 0 jX ; t ¼ c ¼

which equals (36).
The LATE can now be derived by an analogous reasoning as in Theorem 1 as
Z
E½Y 1  Y 0 jt ¼ c ¼
E½Y 1  Y 0 jX ; t ¼ c dF xjt¼c
Z
Pðt ¼ cjX Þ
dF x
¼
E½Y 1  Y 0 jX ; t ¼ c
Pðt ¼ cÞ
R
ðE½Y jX ¼ x; Z ¼ zmax   E½Y jX ¼ x; Z ¼ zmin Þf x ðxÞ dx
.
¼
Pðt ¼ cÞ
To identify the denominator, note that
E½DjX ; Z ¼ 2 ¼ PðD2 ¼ 1jX ; Z ¼ 2Þ
¼ PðD2 ¼ 1; D0 ¼ 0jX ; Z ¼ 2Þ þ PðD2 ¼ 1; D0 ¼ 1jX ; Z ¼ 2Þ
¼ PðD2 ¼ 1; D0 ¼ 0jX Þ þ PðD2 ¼ 1; D0 ¼ 1jX Þ
by Assumption 30 . Analogously
E½DjX ; Z ¼ 0 ¼ PðD0 ¼ 1jX ; Z ¼ 0Þ
¼ PðD0 ¼ 1; D2 ¼ 0jX ; Z ¼ 0Þ þ PðD0 ¼ 1; D2
¼ 1jX ; Z ¼ 0Þ
¼ PðD0 ¼ 1; D2 ¼ 0jX Þ þ PðD0 ¼ 1; D2 ¼ 1jX Þ
¼ PðD0 ¼ 1; D2 ¼ 1jX Þ
because PðD0 ¼ 1; D2 ¼ 0jX Þ ¼ 0 by monotonicity (Assumption 10 ). This gives
E½DjX ; Z ¼ 2  E½DjX ; Z ¼ 0 ¼ PðD0 oD2 jX Þ ¼ Pðt ¼ cjX Þ.
R
Using Pðt ¼ cÞ ¼ Pðt ¼ cjX Þ dF x , the LATE can be expressed as
R
ðE½Y jX ¼ x; Z ¼ zmax   E½Y jX ¼ x; Z ¼ zmin Þf x ðxÞ dx
.
E½Y 1  Y 0 jt ¼ c ¼ R
ðE½DjX ¼ x; Z ¼ zmax   E½DjX ¼ x; Z ¼ zmin Þf x ðxÞ dx

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

73

A.9. Proof of Theorem 9
In a ﬁrst step, it is shown that gw ðxÞ is identiﬁed as
gw ðX Þ ¼

E½Y jX ; Z ¼ 1  E½Y jX ; Z ¼ 0
.
E½DjX ; Z ¼ 1  E½DjX ; Z ¼ 0

(40)

To see this,
the population is partitioned by t ¼ ck;l for kpl.
 note that

P
P
P
t
¼
c
jX
¼
1
and E½Y jX ; Z ¼ 1 ¼ kpl E½Y jX ; Z ¼ 1; t ¼ ck;l Pðt ¼
Hence
k;l
kpl
P
ck;l j X ; Z ¼ 1Þ ¼ kpl E½Y l jX ; t ¼ ck;l Pðt ¼ ck;l jX Þ by the exclusion and the unconfoundP
edness assumption. Analogously, E½Y jX ; Z ¼ 0 ¼ kpl E½Y k jX ; t ¼ ck;l Pðt ¼ ck;l jX Þ
P
P
and E½DjX ; Z ¼ 1 ¼ kpl l  Pðt ¼ ck;l jX Þ and E½DjX ; Z ¼ 0 ¼ kpl k  Pðt ¼ ck;l jX Þ.
R
In a second step, it is to show that the weighted treatment effect gw ¼ gw ðxÞ 
f wxjcomplier ðxÞ dx is given by (22). Using Bayes’ theorem f xjt¼ck;l ¼ Pðt ¼ ck;l jX Þf x =
Pðt ¼ ck;l Þ, the weighted distribution function of X in the all-compliers subpopulation is
PK PK
w
k
l4k Pðt ¼ ck;l jX Þ  ðl  kÞ
f xjcomplier ¼ P
(41)
 f x,
K PK
k
l4k Pðt ¼ ck;l Þ  ðl  kÞ
where f x ðxÞ is the density function of X in the full population. With this weighted
distribution function the treatment effect in the subpopulation of all compliers is
Z
gw ðxÞ  f wxjcomplier ðxÞ dx
gw ¼
Z
E½Y jX ¼ x; Z ¼ 1  E½Y jX ¼ x; Z ¼ 0
P P
¼
 f x ðxÞ dx
k
l4k Pðt ¼ ck;l Þ  ðl  kÞ
R
E½Y jX ¼ x; Z ¼ 1  E½Y jX ¼ x; Z ¼ 0  f x ðxÞ dx
RP P
¼
k
l4k Pðt ¼ ck;l jX ¼ xÞ  ðl  kÞ  f x ðxÞ dx
R
ðE½Y jX ¼ x; Z ¼ 1  E½Y jX ¼ x; Z ¼ 0Þ  f x ðxÞ dx
¼ R
.
ðE½DjX ¼ x; Z ¼ 1  E½DjX ¼ x; Z ¼ 0Þ  f x ðxÞ dx

References
Abadie, A., 2003. Semiparametric instrumental variable estimation of treatment response models. Journal of
Econometrics 113, 231–263.
Abadie, A., Imbens, G., 2006. Large sample properties of matching estimators for average treatment effects.
Econometrica 74, 235–267.
Amemiya, T., 1985. Advanced Econometrics. Harvard University Press, Cambridge, MA.
Angrist, J., 1990. Lifetime earnings and the vietnam era draft lottery: evidence from social security administrative
records. American Economic Review 80, 313–336.
Angrist, J., Imbens, G., 1995. Two-stage least squares estimation of average causal effects in models with variable
treatment intensity. Journal of American Statistical Association 90, 431–442.
Angrist, J., Krueger, A., 1999. Empirical strategies in labor economics. In: Ashenfelter, O., Card, D. (Eds.), The
Handbook of Labor Economics. North-Holland, New York, pp. 1277–1366.
Angrist, J., Imbens, G., Rubin, D., 1996. Identiﬁcation of causal effects using instrumental variables. Journal of
American Statistical Association 91, 444–472 (with discussion).
Angrist, J., Graddy, K., Imbens, G., 2000. The interpretation of instrumental variables estimators in simultaneous
equations models with an application to the demand for ﬁsh. Review of Economic Studies 67, 499–527.

ARTICLE IN PRESS
74

M. Frölich / Journal of Econometrics 139 (2007) 35–75

Begun, J., Hall, W., Huang, W., Wellner, J., 1983. Information and asymptotic efﬁciency in parametricnonparametric models. Annals of Statistics 11, 432–452.
Bickel, P., Klaassen, C.A.J., Ritov, Y., Wellner, J.A., 1993. Efﬁcient and Adaptive Estimation for Semiparametric
Models. John Hopkins University Press, Baltimore.
Blundell, R., Powell, J., 2003. Endogeneity in nonparametric and semiparametric regression models. In: Hansen,
L., Dewatripont, M., Turnovsky, S.J. (Eds.), Advances in Economics and Econometrics. Cambridge
University Press, Cambridge, pp. 312–357.
Card, D., 1995. Using geographic variation in college proximity to estimate the return to schooling. In:
Christoﬁdes, L., Grant, E., Swidinsky, R. (Eds.), Aspects of Labor Market Behaviour: Essays in Honour of
John Vanderkamp. University of Toronto Press, Toronto, pp. 201–222.
Chernozhukov, V., Hansen, C., 2005. An IV model of quantile treatment effects. Econometrica 73, 245–261.
Chesher, A., 2003. Identiﬁcation in nonseparable models. Econometrica 71, 1405–1441.
Chesher, A., 2005. Nonparametric identiﬁcation under discrete variation. Econometrica 73, 1525–1550.
Darolles, S., Florens, J., Renault, E., 2001. Nonparametric instrumental regression. Mimeo, Toulouse.
Das, M., 2005. Instrumental variables estimators of nonparametric models with discrete endogenous regressors.
Journal of Econometrics 124, 335–361.
Florens, J., 2003. Inverse problems and structural econometrics: the example of instrumental variables. In:
Hansen, L., Dewatripont, M., Turnovsky, S.J. (Eds.), Advances in Economics and Econometrics. Cambridge
University Press, Cambridge, pp. 284–311.
Florens, J., Heckman, J., Meghir, C., Vytlacil, E., 2002. Instrumental variables, local instrumental variables and
control functions. cemmap Working Paper 15/02.
Hahn, J., 1998. On the role of the propensity score in efﬁcient semiparametric estimation of average treatment
effects. Econometrica 66, 315–331.
Hearst, N., Newman, T., Hulley, S., 1986. Delayed effects of the military draft on mortality: a randomized natural
experiment. New England Journal of Medicine 314, 620–624.
Heckman, J., 1997. Instrumental variables—a study of implicit behavioral assumptions used in making program
evaluations. Journal of Human Resources 32, 441–462.
Heckman, J., Vytlacil, E., 1999. Local instrumental variables and latent variable models for identifying and
bounding treatment effects. Proceedings National Academic Sciences, USA Economic Sciences 96, 4730–4734.
Heckman, J., Vytlacil, E., 2001. Local instrumental variables. In: Hsiao, C., Morimune, K., Powell, J. (Eds.),
Nonlinear Statistical Inference: Essays in Honor of Takeshi Amemiya. Cambridge University Press,
Cambridge.
Heckman, J., Ichimura, H., Todd, P., 1998. Matching as an econometric evaluation estimator. Review of
Economic Studies 65, 261–294.
Heckman, J., LaLonde, R., Smith, J., 1999. The economics and econometrics of active labour market programs.
In: Ashenfelter, O., Card, D. (Eds.), The Handbook of Labor Economics. North-Holland, New York,
pp. 1865–2097.
Hirano, K., Imbens, G., Rubin, D., Zhou, X., 2000. Assessing the effect of an inﬂuenza vaccine in an
encouragement design. Biostatistics 1, 69–88.
Hirano, K., Imbens, G., Ridder, G., 2003. Efﬁcient estimation of average treatment effects using the estimated
propensity score. Econometrica 71, 1161–1189.
Hoeffding, W., 1948. A class of statistics with asymptotically normal distribution. Annals of Mathematical
Statistics 19, 293–325.
Imbens, G., 2001. Some remarks on instrumental variables. In: Lechner, M., Pfeiffer, F. (Eds.), Econometric
Evaluation of Labour Market Policies. Physica/Springer, Heidelberg, pp. 17–42.
Imbens, G., Angrist, J., 1994. Identiﬁcation and estimation of local average treatment effects. Econometrica 62,
467–475.
Imbens, G., Newey, W., 2003. Identiﬁcation and estimation of triangular simultaneous equations models without
additivity. Presented at the EC2 Conference, London, December 2003.
Imbens, G., Rubin, D., 1997. Estimating outcome distributions for compliers in instrumental variables models.
Review of Economic Studies 64, 555–574.
Imbens, G., Rubin, D., Sacerdote, B., 2001. Estimating the effect of unearned income on labor earnings, savings,
and consumption: evidence from a survey of lottery players. American Economic Review 91, 778–794.
Koshevnik, Y.A., Levit, B.Y., 1976. On a non-parametric analogue of the information matrix. Theory of
Probability and Applications 21, 738–753.
Newey, W., 1990. Semiparametric efﬁciency bounds. Journal of Applied Econometrics 5, 99–135.

ARTICLE IN PRESS
M. Frölich / Journal of Econometrics 139 (2007) 35–75

75

Newey, W., 1994. The asymptotic variance of semiparametric estimators. Econometrica 62, 1349–1382.
Newey, W., 1995. Convergence rates for series estimators. In: Maddala, G.S., Phillips, P., Srinivasan, T.N. (Eds.),
Advances in Econometrics and Quantitative Economics: Essays in Honor of Professor C.R. Rao. Blackwell,
Oxford, pp. 254–275.
Newey, W., Powell, J., 2003. Instrumental variable estimation of nonparametric models. Econometrica 71,
1565–1578.
Newey, W., Powell, J., Vella, F., 1999. Nonparametric estimation of triangular simultaneous equations models.
Econometrica 67, 565–603.
Pearl, J., 2000. Causality: Models, Reasoning, and Inference. Cambridge University Press, Cambridge.
Pfanzagl, J., Wefelmeyer, W., 1982. Contributions to a General Asymptotic Statistical Theory. Springer,
Heidelberg.
Rubin, D., 1974. Estimating causal effects of treatments in randomized and nonrandomized studies. Journal of
Educational Psychology 66, 688–701.
Serﬂing, R.J., 1980. Approximation Theorems of Mathematical Statistics. Wiley, New York.
Stein, C., 1956. Efﬁcient nonparametric testing and estimation. In: Proceedings of the Third Berkeley Symposium on Mathematical Statistics and Probability, vol. 1. University of California Press, Berkeley,
pp. 1–2.
van der Vaart, A.W., 1998. Asymptotic Statistics. Cambridge University Press, Cambridge.
Yau, L., Little, R., 2001. Inference for the complier-average causal effect from longitudinal data subject to
noncompliance and missing data, with application to a job training assessment for the unemployed. Journal of
American Statistical Association 96, 1232–1244.

